window.jest_html_reporters_callback__({"numFailedTestSuites":128,"numFailedTests":186,"numPassedTestSuites":131,"numPassedTests":444,"numPendingTestSuites":0,"numPendingTests":4,"numRuntimeErrorTestSuites":63,"numTodoTests":0,"numTotalTestSuites":259,"numTotalTests":634,"startTime":1745168589070,"success":false,"testResults":[{"numFailingTests":2,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168591467,"runtime":2248,"slow":false,"start":1745168589219},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/services/generateNeuroImage.test.ts","failureMessage":"  ‚óè generateNeuroImage ‚Ä∫ calls axios.post and returns data on success\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"http://local/generate/neuro-photo\", {\"bot_name\": \"botX\", \"is_ru\": false, \"model_url\": \"http://model\", \"num_images\": 2, \"prompt\": \"a prompt\", \"telegram_id\": \"42\", \"username\": \"usr\"}, {\"headers\": {\"Content-Type\": \"application/json\", \"x-secret-key\": \"secret\"}}\n\n    Number of calls: 0\n\n      58 |     axios.post.mockResolvedValueOnce({ data })\n      59 |     const res = await generateNeuroImage(prompt, model_url, numImages, telegram_id, ctx, botName)\n    > 60 |     expect(axios.post).toHaveBeenCalledWith(\n         |                        ^\n      61 |       'http://local/generate/neuro-photo',\n      62 |       {\n      63 |         prompt,\n\n      at Object.<anonymous> (__tests__/services/generateNeuroImage.test.ts:60:24)\n      at fulfilled (__tests__/services/generateNeuroImage.test.ts:4:58)\n\n  ‚óè generateNeuroImage ‚Ä∫ handles axios error, logs and replies\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–µ–π—Ä–æ–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:\", [Error: api fail]\n    Received\n           1: \"‚ùå [DIRECT] –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä—è–º–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–µ–π—Ä–æ—Ñ–æ—Ç–æ: Cannot read properties of undefined (reading 'bot')\"\n           2: \"üìö [DIRECT] –°—Ç–µ–∫ –æ—à–∏–±–∫–∏:\"\n           3: \"TypeError: Cannot read properties of undefined (reading 'bot')\n\n      88 |\n      89 |     const botResult = getBotByName(botName)\n    > 90 |     if (!botResult.bot) {\n         |                    ^\n      91 |       logger.error({\n      92 |         message: '‚ùå [DIRECT] –ë–æ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω',\n      93 |         description: 'Bot not found for direct generation',\n\n      at src/services/generateNeuroPhotoDirect.ts:90:20\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at generateNeuroPhotoDirect (src/services/generateNeuroPhotoDirect.ts:33:20)\n      at src/services/generateNeuroImage.ts:37:56\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at generateNeuroImage (src/services/generateNeuroImage.ts:9:20)\n      at Object.<anonymous> (__tests__/services/generateNeuroImage.test.ts:79:23)\n      at __tests__/services/generateNeuroImage.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/services/generateNeuroImage.test.ts:3:12)\n      at Object.<anonymous> (__tests__/services/generateNeuroImage.test.ts:76:58)\n      Number of calls: 4\n      at Object.<anonymous> (__tests__/services/generateNeuroImage.test.ts:80:26)\n      at fulfilled (__tests__/services/generateNeuroImage.test.ts:4:58)\n","testResults":[{"ancestorTitles":["generateNeuroImage"],"duration":384,"failureMessages":[],"fullName":"generateNeuroImage throws error when ctx.session.prompt missing","status":"passed","title":"throws error when ctx.session.prompt missing"},{"ancestorTitles":["generateNeuroImage"],"duration":38,"failureMessages":[],"fullName":"generateNeuroImage throws error when ctx.session.userModel missing","status":"passed","title":"throws error when ctx.session.userModel missing"},{"ancestorTitles":["generateNeuroImage"],"duration":37,"failureMessages":[],"fullName":"generateNeuroImage throws error when numImages is zero","status":"passed","title":"throws error when numImages is zero"},{"ancestorTitles":["generateNeuroImage"],"duration":50,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"http://local/generate/neuro-photo\", {\"bot_name\": \"botX\", \"is_ru\": false, \"model_url\": \"http://model\", \"num_images\": 2, \"prompt\": \"a prompt\", \"telegram_id\": \"42\", \"username\": \"usr\"}, {\"headers\": {\"Content-Type\": \"application/json\", \"x-secret-key\": \"secret\"}}\n\nNumber of calls: 0\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/services/generateNeuroImage.test.ts:60:24)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/__tests__/services/generateNeuroImage.test.ts:4:58)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"generateNeuroImage calls axios.post and returns data on success","status":"failed","title":"calls axios.post and returns data on success"},{"ancestorTitles":["generateNeuroImage"],"duration":53,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–µ–π—Ä–æ–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:\", [Error: api fail]\nReceived\n       1: \"‚ùå [DIRECT] –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä—è–º–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–µ–π—Ä–æ—Ñ–æ—Ç–æ: Cannot read properties of undefined (reading 'bot')\"\n       2: \"üìö [DIRECT] –°—Ç–µ–∫ –æ—à–∏–±–∫–∏:\"\n       3: \"TypeError: Cannot read properties of undefined (reading 'bot')\n    at /Users/playom/999-multibots-telegraf/src/services/generateNeuroPhotoDirect.ts:90:20\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at generateNeuroPhotoDirect (/Users/playom/999-multibots-telegraf/src/services/generateNeuroPhotoDirect.ts:33:20)\n    at /Users/playom/999-multibots-telegraf/src/services/generateNeuroImage.ts:37:56\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at generateNeuroImage (/Users/playom/999-multibots-telegraf/src/services/generateNeuroImage.ts:9:20)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/services/generateNeuroImage.test.ts:79:23)\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/__tests__/services/generateNeuroImage.test.ts:7:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/playom/999-multibots-telegraf/__tests__/services/generateNeuroImage.test.ts:3:12)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/services/generateNeuroImage.test.ts:76:58)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\"\n\nNumber of calls: 4\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/services/generateNeuroImage.test.ts:80:26)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/__tests__/services/generateNeuroImage.test.ts:4:58)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"generateNeuroImage handles axios error, logs and replies","status":"failed","title":"handles axios error, logs and replies"}]},{"numFailingTests":6,"numPassingTests":6,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168592085,"runtime":605,"slow":false,"start":1745168591480},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/registerCommands.test.ts","failureMessage":"  ‚óè registerCommands ‚Ä∫ should register hears handlers for menu items\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: [\"level_103_ru\", \"level_103_en\"], Any<Function>\n    Received\n           1\n              Array [\n            -   \"level_103_ru\",\n            -   \"level_103_en\",\n            +   \"üí¨ –¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞\",\n            +   \"üí¨ Support\",\n              ],\n              [Function anonymous],\n           2\n              Array [\n            -   \"level_103_ru\",\n            -   \"level_103_en\",\n            +   \"üí´ –û—Ñ–æ—Ä–º–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É\",\n            +   \"üí´ Subscribe\",\n              ],\n              [Function anonymous],\n\n    Number of calls: 2\n\n       99 |\n      100 |   it('should register hears handlers for menu items', () => {\n    > 101 |     expect(bot.hears).toHaveBeenCalledWith(\n          |                       ^\n      102 |       [levels[103].title_ru, levels[103].title_en],\n      103 |       expect.any(Function)\n      104 |     )\n\n      at Object.<anonymous> (__tests__/registerCommands.test.ts:101:23)\n\n  ‚óè registerCommands ‚Ä∫ command callbacks ‚Ä∫ /start should reset session and enter startScene\n\n    expect(received).toEqual(expected) // deep equality\n\n    - Expected  -  1\n    + Received  + 38\n\n    - Object {}\n    + Object {\n    +   \"amount\": 0,\n    +   \"attempts\": 0,\n    +   \"audioUrl\": \"\",\n    +   \"buttons\": Array [],\n    +   \"cursor\": 0,\n    +   \"email\": \"\",\n    +   \"imageUrl\": \"\",\n    +   \"images\": Array [],\n    +   \"memory\": Object {\n    +     \"messages\": Array [],\n    +   },\n    +   \"mode\": \"start_scene\",\n    +   \"modelName\": \"\",\n    +   \"neuroPhotoInitialized\": false,\n    +   \"prompt\": \"\",\n    +   \"selectedModel\": \"\",\n    +   \"selectedPayment\": Object {\n    +     \"amount\": 0,\n    +     \"stars\": 0,\n    +     \"subscription\": \"stars\",\n    +     \"type\": \"system\",\n    +   },\n    +   \"selectedSize\": \"\",\n    +   \"steps\": 0,\n    +   \"subscription\": \"stars\",\n    +   \"targetUserId\": \"0\",\n    +   \"translations\": Array [],\n    +   \"triggerWord\": \"\",\n    +   \"userModel\": Object {\n    +     \"finetune_id\": \"\",\n    +     \"model_name\": \"\",\n    +     \"model_url\": \"placeholder/placeholder:placeholder\",\n    +     \"trigger_word\": \"\",\n    +   },\n    +   \"videoModel\": \"\",\n    +   \"videoUrl\": \"\",\n    + }\n\n      122 |       const mockCtx = { session: { someData: 'test' }, scene: { enter: jest.fn() } }\n      123 |       await startCallback(mockCtx)\n    > 124 |       expect(mockCtx.session).toEqual({}) // Session should be reset\n          |                               ^\n      125 |       expect(mockCtx.scene.enter).toHaveBeenCalledWith(ModeEnum.StartScene)\n      126 |     })\n      127 |\n\n      at __tests__/registerCommands.test.ts:124:31\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ‚óè registerCommands ‚Ä∫ command callbacks ‚Ä∫ /menu should check subscription and enter correct scene (active)\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: 456\n    Received: \"456\"\n\n    Number of calls: 1\n\n      146 |       }\n      147 |       await menuCallback(mockCtx)\n    > 148 |       expect(getUserDetails).toHaveBeenCalledWith(456)\n          |                              ^\n      149 |       expect(mockCtx.scene.enter).toHaveBeenCalledWith(ModeEnum.MainMenu) // –î–æ–ª–∂–µ–Ω –≤–æ–π—Ç–∏ –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\n      150 |     })\n      151 |\n\n      at __tests__/registerCommands.test.ts:148:30\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ‚óè registerCommands ‚Ä∫ command callbacks ‚Ä∫ /menu should check subscription and enter correct scene (inactive)\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: 789\n    Received: \"789\"\n\n    Number of calls: 1\n\n      161 |       }\n      162 |       await menuCallback(mockCtx)\n    > 163 |       expect(getUserDetails).toHaveBeenCalledWith(789)\n          |                              ^\n      164 |       expect(mockCtx.scene.enter).toHaveBeenCalledWith(ModeEnum.SubscriptionScene) // –î–æ–ª–∂–µ–Ω –≤–æ–π—Ç–∏ –≤ —Å—Ü–µ–Ω—É –ø–æ–¥–ø–∏—Å–∫–∏\n      165 |     })\n      166 |\n\n      at __tests__/registerCommands.test.ts:163:30\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ‚óè registerCommands ‚Ä∫ hears callbacks ‚Ä∫ support hears should call handleTechSupport\n\n    TypeError: Cannot read properties of undefined (reading '1')\n\n      182 |       const supportHearsCallback = bot.hears.mock.calls.find(\n      183 |         (call: any) => call[0][0] === levels[103].title_ru\n    > 184 |       )[1]\n          |        ^\n      185 |       const mockCtx = {}\n      186 |       await supportHearsCallback(mockCtx)\n      187 |       expect(handleTechSupport).toHaveBeenCalledWith(mockCtx)\n\n      at __tests__/registerCommands.test.ts:184:8\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/registerCommands.test.ts:181:66)\n\n  ‚óè registerCommands ‚Ä∫ hears callbacks ‚Ä∫ subscribe hears should enter SubscriptionScene\n\n    TypeError: Cannot read properties of undefined (reading '1')\n\n      191 |       const subscribeHearsCallback = bot.hears.mock.calls.find(\n      192 |         (call: any) => call[0][0] === levels[105].title_ru\n    > 193 |       )[1]\n          |        ^\n      194 |       const mockCtx = { scene: { enter: jest.fn() } }\n      195 |       await subscribeHearsCallback(mockCtx)\n      196 |       expect(mockCtx.scene.enter).toHaveBeenCalledWith(ModeEnum.SubscriptionScene)\n\n      at __tests__/registerCommands.test.ts:193:8\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/registerCommands.test.ts:190:69)\n","testResults":[{"ancestorTitles":["registerCommands"],"duration":1,"failureMessages":[],"fullName":"registerCommands should register session middleware","status":"passed","title":"should register session middleware"},{"ancestorTitles":["registerCommands"],"duration":0,"failureMessages":[],"fullName":"registerCommands should register stage middleware","status":"passed","title":"should register stage middleware"},{"ancestorTitles":["registerCommands"],"duration":1,"failureMessages":[],"fullName":"registerCommands should register basic commands","status":"passed","title":"should register basic commands"},{"ancestorTitles":["registerCommands"],"duration":2,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: [\"level_103_ru\", \"level_103_en\"], Any<Function>\nReceived\n       1\n          Array [\n        -   \"level_103_ru\",\n        -   \"level_103_en\",\n        +   \"üí¨ –¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞\",\n        +   \"üí¨ Support\",\n          ],\n          [Function anonymous],\n       2\n          Array [\n        -   \"level_103_ru\",\n        -   \"level_103_en\",\n        +   \"üí´ –û—Ñ–æ—Ä–º–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É\",\n        +   \"üí´ Subscribe\",\n          ],\n          [Function anonymous],\n\nNumber of calls: 2\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/registerCommands.test.ts:101:23)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"registerCommands should register hears handlers for menu items","status":"failed","title":"should register hears handlers for menu items"},{"ancestorTitles":["registerCommands"],"duration":1,"failureMessages":[],"fullName":"registerCommands should register action handler for top_up","status":"passed","title":"should register action handler for top_up"},{"ancestorTitles":["registerCommands","command callbacks"],"duration":2,"failureMessages":["Error: expect(received).toEqual(expected) // deep equality\n\n- Expected  -  1\n+ Received  + 38\n\n- Object {}\n+ Object {\n+   \"amount\": 0,\n+   \"attempts\": 0,\n+   \"audioUrl\": \"\",\n+   \"buttons\": Array [],\n+   \"cursor\": 0,\n+   \"email\": \"\",\n+   \"imageUrl\": \"\",\n+   \"images\": Array [],\n+   \"memory\": Object {\n+     \"messages\": Array [],\n+   },\n+   \"mode\": \"start_scene\",\n+   \"modelName\": \"\",\n+   \"neuroPhotoInitialized\": false,\n+   \"prompt\": \"\",\n+   \"selectedModel\": \"\",\n+   \"selectedPayment\": Object {\n+     \"amount\": 0,\n+     \"stars\": 0,\n+     \"subscription\": \"stars\",\n+     \"type\": \"system\",\n+   },\n+   \"selectedSize\": \"\",\n+   \"steps\": 0,\n+   \"subscription\": \"stars\",\n+   \"targetUserId\": \"0\",\n+   \"translations\": Array [],\n+   \"triggerWord\": \"\",\n+   \"userModel\": Object {\n+     \"finetune_id\": \"\",\n+     \"model_name\": \"\",\n+     \"model_url\": \"placeholder/placeholder:placeholder\",\n+     \"trigger_word\": \"\",\n+   },\n+   \"videoModel\": \"\",\n+   \"videoUrl\": \"\",\n+ }\n    at /Users/playom/999-multibots-telegraf/__tests__/registerCommands.test.ts:124:31\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"registerCommands command callbacks /start should reset session and enter startScene","status":"failed","title":"/start should reset session and enter startScene"},{"ancestorTitles":["registerCommands","command callbacks"],"duration":1,"failureMessages":[],"fullName":"registerCommands command callbacks /support should call handleTechSupport","status":"passed","title":"/support should call handleTechSupport"},{"ancestorTitles":["registerCommands","command callbacks"],"duration":4,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: 456\nReceived: \"456\"\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/registerCommands.test.ts:148:30\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"registerCommands command callbacks /menu should check subscription and enter correct scene (active)","status":"failed","title":"/menu should check subscription and enter correct scene (active)"},{"ancestorTitles":["registerCommands","command callbacks"],"duration":1,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: 789\nReceived: \"789\"\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/registerCommands.test.ts:163:30\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"registerCommands command callbacks /menu should check subscription and enter correct scene (inactive)","status":"failed","title":"/menu should check subscription and enter correct scene (inactive)"},{"ancestorTitles":["registerCommands","command callbacks"],"duration":1,"failureMessages":[],"fullName":"registerCommands command callbacks /buy should set session and enter payment scene","status":"passed","title":"/buy should set session and enter payment scene"},{"ancestorTitles":["registerCommands","hears callbacks"],"duration":0,"failureMessages":["TypeError: Cannot read properties of undefined (reading '1')\n    at /Users/playom/999-multibots-telegraf/__tests__/registerCommands.test.ts:184:8\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/registerCommands.test.ts:181:66)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"registerCommands hears callbacks support hears should call handleTechSupport","status":"failed","title":"support hears should call handleTechSupport"},{"ancestorTitles":["registerCommands","hears callbacks"],"duration":0,"failureMessages":["TypeError: Cannot read properties of undefined (reading '1')\n    at /Users/playom/999-multibots-telegraf/__tests__/registerCommands.test.ts:193:8\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/registerCommands.test.ts:190:69)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"registerCommands hears callbacks subscribe hears should enter SubscriptionScene","status":"failed","title":"subscribe hears should enter SubscriptionScene"}]},{"numFailingTests":2,"numPassingTests":8,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168592267,"runtime":174,"slow":false,"start":1745168592093},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/voiceAvatarWizard.test.ts","failureMessage":"  ‚óè voiceAvatarWizard ‚Ä∫ step 1: should handle voice message, generate avatar and leave\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    - Expected\n    + Received\n\n      \"https://api.telegram.org/file/botmock_token/path/to/file\",\n    - \"No text provided\",\n    + \"\",\n      \"123\",\n      {\"answerCbQuery\": [Function mockConstructor], \"answerPreCheckoutQuery\": [Function mockConstructor], \"botInfo\": {\"can_join_groups\": false, \"can_read_all_group_messages\": false, \"first_name\": \"Bot\", \"id\": 1, \"is_bot\": true, \"supports_inline_queries\": false, \"username\": \"test_bot\"}, \"callback_query\": undefined, \"chat\": {\"first_name\": \"Test\", \"id\": 12345, \"type\": \"private\", \"username\": \"testuser\"}, \"debug\": {\"currentScene\": \"\", \"replies\": [], \"replyMessages\": [Function replyMessages]}, \"from\": {\"first_name\": \"Tester\", \"id\": 123, \"is_bot\": false, \"language_code\": \"ru\", \"username\": \"testuser\"}, \"match\": [Function mockConstructor], \"message\": {\"chat\": {\"first_name\": \"Test\", \"id\": 12345, \"type\": \"private\", \"username\": \"testuser\"}, \"date\": 1745168592.252, \"from\": {\"first_name\": \"Tester\", \"id\": 123, \"is_bot\": false, \"language_code\": \"ru\", \"username\": \"testuser\"}, \"message_id\": 1, \"text\": \"\", \"voice\": {\"file_id\": \"voice_file_id\"}}, \"reply\": [Function mockConstructor], \"replyWithInvoice\": [Function mockConstructor], \"replyWithPhoto\": [Function mockConstructor], \"scene\": {\"enter\": [Function mockConstructor], \"leave\": [Function mockConstructor], \"reenter\": [Function mockConstructor], \"session\": {\"state\": {}}}, \"session\": {\"cursor\": 0, \"images\": [], \"targetUserId\": \"12345\", \"userModel\": {\"model_name\": \"test-model\", \"model_url\": \"org/repo:version\", \"trigger_word\": \"test\"}}, \"telegram\": {\"callApi\": [Function mockConstructor], \"getFile\": [Function mockConstructor], \"sendChatAction\": [Function mockConstructor], \"sendMessage\": [Function mockConstructor], \"token\": \"mock_token\"}, \"update\": {\"message\": {\"chat\": {\"first_name\": \"Test\", \"id\": 12345, \"type\": \"private\", \"username\": \"testuser\"}, \"date\": 1745168592.252, \"from\": {\"first_name\": \"Tester\", \"id\": 123, \"is_bot\": false, \"language_code\": \"ru\", \"username\": \"testuser\"}, \"message_id\": 1, \"text\": \"\", \"voice\": {\"file_id\": \"voice_file_id\"}}, \"update_id\": 1}, \"wizard\": {\"back\": [Function mockConstructor], \"cursor\": 0, \"next\": [Function mockConstructor], \"state\": {}, \"steps\": []}},\n      true,\n      \"test_bot\",\n\n    Number of calls: 1\n\n      172 |     expect(mockedHandleHelpCancel).toHaveBeenCalledWith(ctx)\n      173 |     expect(mockGetFile).toHaveBeenCalledWith('voice_file_id')\n    > 174 |     expect(mockedGenerateVoiceAvatar).toHaveBeenCalledWith(\n          |                                       ^\n      175 |       `https://api.telegram.org/file/bot${ctx.telegram.token}/path/to/file`,\n      176 |       'No text provided',\n      177 |       '123',\n\n      at __tests__/scenes/voiceAvatarWizard.test.ts:174:39\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ‚óè voiceAvatarWizard ‚Ä∫ step 1: should handle audio message, generate avatar and leave\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    - Expected\n    + Received\n\n      \"https://api.telegram.org/file/botmock_token/path/to/file\",\n    - \"No text provided\",\n    + \"\",\n      \"123\",\n      {\"answerCbQuery\": [Function mockConstructor], \"answerPreCheckoutQuery\": [Function mockConstructor], \"botInfo\": {\"can_join_groups\": false, \"can_read_all_group_messages\": false, \"first_name\": \"Bot\", \"id\": 1, \"is_bot\": true, \"supports_inline_queries\": false, \"username\": \"test_bot\"}, \"callback_query\": undefined, \"chat\": {\"first_name\": \"Test\", \"id\": 12345, \"type\": \"private\", \"username\": \"testuser\"}, \"debug\": {\"currentScene\": \"\", \"replies\": [], \"replyMessages\": [Function replyMessages]}, \"from\": {\"first_name\": \"Tester\", \"id\": 123, \"is_bot\": false, \"language_code\": \"ru\", \"username\": \"testuser\"}, \"match\": [Function mockConstructor], \"message\": {\"audio\": {\"file_id\": \"audio_file_id\"}, \"chat\": {\"first_name\": \"Test\", \"id\": 12345, \"type\": \"private\", \"username\": \"testuser\"}, \"date\": 1745168592.261, \"from\": {\"first_name\": \"Tester\", \"id\": 123, \"is_bot\": false, \"language_code\": \"ru\", \"username\": \"testuser\"}, \"message_id\": 1, \"text\": \"\"}, \"reply\": [Function mockConstructor], \"replyWithInvoice\": [Function mockConstructor], \"replyWithPhoto\": [Function mockConstructor], \"scene\": {\"enter\": [Function mockConstructor], \"leave\": [Function mockConstructor], \"reenter\": [Function mockConstructor], \"session\": {\"state\": {}}}, \"session\": {\"cursor\": 0, \"images\": [], \"targetUserId\": \"12345\", \"userModel\": {\"model_name\": \"test-model\", \"model_url\": \"org/repo:version\", \"trigger_word\": \"test\"}}, \"telegram\": {\"callApi\": [Function mockConstructor], \"getFile\": [Function mockConstructor], \"sendChatAction\": [Function mockConstructor], \"sendMessage\": [Function mockConstructor], \"token\": \"mock_token\"}, \"update\": {\"message\": {\"audio\": {\"file_id\": \"audio_file_id\"}, \"chat\": {\"first_name\": \"Test\", \"id\": 12345, \"type\": \"private\", \"username\": \"testuser\"}, \"date\": 1745168592.261, \"from\": {\"first_name\": \"Tester\", \"id\": 123, \"is_bot\": false, \"language_code\": \"ru\", \"username\": \"testuser\"}, \"message_id\": 1, \"text\": \"\"}, \"update_id\": 1}, \"wizard\": {\"back\": [Function mockConstructor], \"cursor\": 0, \"next\": [Function mockConstructor], \"state\": {}, \"steps\": []}},\n      true,\n      \"test_bot\",\n\n    Number of calls: 1\n\n      197 |     expect(mockedHandleHelpCancel).toHaveBeenCalledWith(ctx)\n      198 |     expect(mockGetFile).toHaveBeenCalledWith('audio_file_id')\n    > 199 |     expect(mockedGenerateVoiceAvatar).toHaveBeenCalledWith(\n          |                                       ^\n      200 |       `https://api.telegram.org/file/bot${ctx.telegram.token}/path/to/file`,\n      201 |       'No text provided',\n      202 |       '123',\n\n      at __tests__/scenes/voiceAvatarWizard.test.ts:199:39\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["voiceAvatarWizard"],"duration":1,"failureMessages":[],"fullName":"voiceAvatarWizard step 0: should leave if no user ID","status":"passed","title":"step 0: should leave if no user ID"},{"ancestorTitles":["voiceAvatarWizard"],"duration":0,"failureMessages":[],"fullName":"voiceAvatarWizard step 0: should leave if balance is insufficient","status":"passed","title":"step 0: should leave if balance is insufficient"},{"ancestorTitles":["voiceAvatarWizard"],"duration":1,"failureMessages":[],"fullName":"voiceAvatarWizard step 0: should prompt for voice, send balance and advance if balance sufficient","status":"passed","title":"step 0: should prompt for voice, send balance and advance if balance sufficient"},{"ancestorTitles":["voiceAvatarWizard"],"duration":1,"failureMessages":[],"fullName":"voiceAvatarWizard step 1: should prompt if message is invalid (no voice/audio/text)","status":"passed","title":"step 1: should prompt if message is invalid (no voice/audio/text)"},{"ancestorTitles":["voiceAvatarWizard"],"duration":1,"failureMessages":[],"fullName":"voiceAvatarWizard step 1: should leave if handleHelpCancel returns true","status":"passed","title":"step 1: should leave if handleHelpCancel returns true"},{"ancestorTitles":["voiceAvatarWizard"],"duration":1,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n- Expected\n+ Received\n\n  \"https://api.telegram.org/file/botmock_token/path/to/file\",\n- \"No text provided\",\n+ \"\",\n  \"123\",\n  {\"answerCbQuery\": [Function mockConstructor], \"answerPreCheckoutQuery\": [Function mockConstructor], \"botInfo\": {\"can_join_groups\": false, \"can_read_all_group_messages\": false, \"first_name\": \"Bot\", \"id\": 1, \"is_bot\": true, \"supports_inline_queries\": false, \"username\": \"test_bot\"}, \"callback_query\": undefined, \"chat\": {\"first_name\": \"Test\", \"id\": 12345, \"type\": \"private\", \"username\": \"testuser\"}, \"debug\": {\"currentScene\": \"\", \"replies\": [], \"replyMessages\": [Function replyMessages]}, \"from\": {\"first_name\": \"Tester\", \"id\": 123, \"is_bot\": false, \"language_code\": \"ru\", \"username\": \"testuser\"}, \"match\": [Function mockConstructor], \"message\": {\"chat\": {\"first_name\": \"Test\", \"id\": 12345, \"type\": \"private\", \"username\": \"testuser\"}, \"date\": 1745168592.252, \"from\": {\"first_name\": \"Tester\", \"id\": 123, \"is_bot\": false, \"language_code\": \"ru\", \"username\": \"testuser\"}, \"message_id\": 1, \"text\": \"\", \"voice\": {\"file_id\": \"voice_file_id\"}}, \"reply\": [Function mockConstructor], \"replyWithInvoice\": [Function mockConstructor], \"replyWithPhoto\": [Function mockConstructor], \"scene\": {\"enter\": [Function mockConstructor], \"leave\": [Function mockConstructor], \"reenter\": [Function mockConstructor], \"session\": {\"state\": {}}}, \"session\": {\"cursor\": 0, \"images\": [], \"targetUserId\": \"12345\", \"userModel\": {\"model_name\": \"test-model\", \"model_url\": \"org/repo:version\", \"trigger_word\": \"test\"}}, \"telegram\": {\"callApi\": [Function mockConstructor], \"getFile\": [Function mockConstructor], \"sendChatAction\": [Function mockConstructor], \"sendMessage\": [Function mockConstructor], \"token\": \"mock_token\"}, \"update\": {\"message\": {\"chat\": {\"first_name\": \"Test\", \"id\": 12345, \"type\": \"private\", \"username\": \"testuser\"}, \"date\": 1745168592.252, \"from\": {\"first_name\": \"Tester\", \"id\": 123, \"is_bot\": false, \"language_code\": \"ru\", \"username\": \"testuser\"}, \"message_id\": 1, \"text\": \"\", \"voice\": {\"file_id\": \"voice_file_id\"}}, \"update_id\": 1}, \"wizard\": {\"back\": [Function mockConstructor], \"cursor\": 0, \"next\": [Function mockConstructor], \"state\": {}, \"steps\": []}},\n  true,\n  \"test_bot\",\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/voiceAvatarWizard.test.ts:174:39\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"voiceAvatarWizard step 1: should handle voice message, generate avatar and leave","status":"failed","title":"step 1: should handle voice message, generate avatar and leave"},{"ancestorTitles":["voiceAvatarWizard"],"duration":1,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n- Expected\n+ Received\n\n  \"https://api.telegram.org/file/botmock_token/path/to/file\",\n- \"No text provided\",\n+ \"\",\n  \"123\",\n  {\"answerCbQuery\": [Function mockConstructor], \"answerPreCheckoutQuery\": [Function mockConstructor], \"botInfo\": {\"can_join_groups\": false, \"can_read_all_group_messages\": false, \"first_name\": \"Bot\", \"id\": 1, \"is_bot\": true, \"supports_inline_queries\": false, \"username\": \"test_bot\"}, \"callback_query\": undefined, \"chat\": {\"first_name\": \"Test\", \"id\": 12345, \"type\": \"private\", \"username\": \"testuser\"}, \"debug\": {\"currentScene\": \"\", \"replies\": [], \"replyMessages\": [Function replyMessages]}, \"from\": {\"first_name\": \"Tester\", \"id\": 123, \"is_bot\": false, \"language_code\": \"ru\", \"username\": \"testuser\"}, \"match\": [Function mockConstructor], \"message\": {\"audio\": {\"file_id\": \"audio_file_id\"}, \"chat\": {\"first_name\": \"Test\", \"id\": 12345, \"type\": \"private\", \"username\": \"testuser\"}, \"date\": 1745168592.261, \"from\": {\"first_name\": \"Tester\", \"id\": 123, \"is_bot\": false, \"language_code\": \"ru\", \"username\": \"testuser\"}, \"message_id\": 1, \"text\": \"\"}, \"reply\": [Function mockConstructor], \"replyWithInvoice\": [Function mockConstructor], \"replyWithPhoto\": [Function mockConstructor], \"scene\": {\"enter\": [Function mockConstructor], \"leave\": [Function mockConstructor], \"reenter\": [Function mockConstructor], \"session\": {\"state\": {}}}, \"session\": {\"cursor\": 0, \"images\": [], \"targetUserId\": \"12345\", \"userModel\": {\"model_name\": \"test-model\", \"model_url\": \"org/repo:version\", \"trigger_word\": \"test\"}}, \"telegram\": {\"callApi\": [Function mockConstructor], \"getFile\": [Function mockConstructor], \"sendChatAction\": [Function mockConstructor], \"sendMessage\": [Function mockConstructor], \"token\": \"mock_token\"}, \"update\": {\"message\": {\"audio\": {\"file_id\": \"audio_file_id\"}, \"chat\": {\"first_name\": \"Test\", \"id\": 12345, \"type\": \"private\", \"username\": \"testuser\"}, \"date\": 1745168592.261, \"from\": {\"first_name\": \"Tester\", \"id\": 123, \"is_bot\": false, \"language_code\": \"ru\", \"username\": \"testuser\"}, \"message_id\": 1, \"text\": \"\"}, \"update_id\": 1}, \"wizard\": {\"back\": [Function mockConstructor], \"cursor\": 0, \"next\": [Function mockConstructor], \"state\": {}, \"steps\": []}},\n  true,\n  \"test_bot\",\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/voiceAvatarWizard.test.ts:199:39\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"voiceAvatarWizard step 1: should handle audio message, generate avatar and leave","status":"failed","title":"step 1: should handle audio message, generate avatar and leave"},{"ancestorTitles":["voiceAvatarWizard"],"duration":1,"failureMessages":[],"fullName":"voiceAvatarWizard step 1: should reply with error and leave if text message is not help/cancel","status":"passed","title":"step 1: should reply with error and leave if text message is not help/cancel"},{"ancestorTitles":["voiceAvatarWizard"],"duration":1,"failureMessages":[],"fullName":"voiceAvatarWizard step 1: should handle getFile error","status":"passed","title":"step 1: should handle getFile error"},{"ancestorTitles":["voiceAvatarWizard"],"duration":1,"failureMessages":[],"fullName":"voiceAvatarWizard step 1: should handle generateVoiceAvatar error","status":"passed","title":"step 1: should handle generateVoiceAvatar error"}]},{"numFailingTests":3,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168592408,"runtime":138,"slow":false,"start":1745168592270},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/levelQuestWizardHandlers.test.ts","failureMessage":"  ‚óè levelQuestWizard handlers ‚Ä∫ handleQuestRules ‚Ä∫ calls errorMessage on exception\n\n    fail\n\n      94 |       ctx = makeMockContext({ message: { from: mockFrom } }, sessionData)\n      95 |       mockedIsRussian.mockReturnValue(false)\n    > 96 |       mockedGetSubChannel.mockImplementation(() => { throw new Error('fail') })\n         |                                                            ^\n      97 |\n      98 |       // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–∞–º –ª–æ–≤–∏—Ç –æ—à–∏–±–∫—É, –ø–æ—ç—Ç–æ–º—É –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º rejects.toThrow\n      99 |       await handleQuestRules(ctx)\n\n      at __tests__/scenes/levelQuestWizardHandlers.test.ts:96:60\n      at src/scenes/levelQuestWizard/handlers.ts:11:53\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at handleQuestRules (src/scenes/levelQuestWizard/handlers.ts:25:20)\n      at __tests__/scenes/levelQuestWizardHandlers.test.ts:99:29\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/levelQuestWizardHandlers.test.ts:92:54)\n\n  ‚óè levelQuestWizard handlers ‚Ä∫ handleQuestComplete ‚Ä∫ replies with completion message and keyboard\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    - Expected\n    + Received\n\n    - StringContaining \"NeuroQuest completed\",\n    + \"üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏ –æ–±—É—á–µ–Ω–∏–µ.\",\n      {\"reply_markup\": {\"keyboard\": [[\"m\"]]}},\n\n    Number of calls: 1\n\n      113 |       await handleQuestComplete(ctx)\n      114 |\n    > 115 |       expect(ctx.reply).toHaveBeenCalledWith(\n          |                         ^\n      116 |         expect.stringContaining('NeuroQuest completed'),\n      117 |         { reply_markup: { keyboard: [['m']] } }\n      118 |       )\n\n      at __tests__/scenes/levelQuestWizardHandlers.test.ts:115:25\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ‚óè levelQuestWizard handlers ‚Ä∫ handleQuestComplete ‚Ä∫ calls errorMessage on exception\n\n    oops\n\n      123 |       ctx = makeMockContext({ message: { from: mockFrom } }, sessionData)\n      124 |       mockedIsRussian.mockReturnValue(true)\n    > 125 |       const error = new Error('oops')\n          |                     ^\n      126 |       mockedGetReferals.mockRejectedValue(error)\n      127 |\n      128 |       await handleQuestComplete(ctx)\n\n      at __tests__/scenes/levelQuestWizardHandlers.test.ts:125:21\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/levelQuestWizardHandlers.test.ts:121:54)\n","testResults":[{"ancestorTitles":["levelQuestWizard handlers","handleQuestRules"],"duration":1,"failureMessages":[],"fullName":"levelQuestWizard handlers handleQuestRules replies with rules message in Russian","status":"passed","title":"replies with rules message in Russian"},{"ancestorTitles":["levelQuestWizard handlers","handleQuestRules"],"duration":0,"failureMessages":["Error: fail\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/levelQuestWizardHandlers.test.ts:96:60\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-mock@29.7.0/node_modules/jest-mock/build/index.js:397:39\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-mock@29.7.0/node_modules/jest-mock/build/index.js:404:13\n    at mockConstructor (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-mock@29.7.0/node_modules/jest-mock/build/index.js:148:19)\n    at getSubScribeChannel (eval at _createMockFunction (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-mock@29.7.0/node_modules/jest-mock/build/index.js:566:31), <anonymous>:3:65)\n    at /Users/playom/999-multibots-telegraf/src/scenes/levelQuestWizard/handlers.ts:11:53\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at handleQuestRules (/Users/playom/999-multibots-telegraf/src/scenes/levelQuestWizard/handlers.ts:25:20)\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/levelQuestWizardHandlers.test.ts:99:29\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/levelQuestWizardHandlers.test.ts:92:54)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"levelQuestWizard handlers handleQuestRules calls errorMessage on exception","status":"failed","title":"calls errorMessage on exception"},{"ancestorTitles":["levelQuestWizard handlers","handleQuestComplete"],"duration":1,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n- Expected\n+ Received\n\n- StringContaining \"NeuroQuest completed\",\n+ \"üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏ –æ–±—É—á–µ–Ω–∏–µ.\",\n  {\"reply_markup\": {\"keyboard\": [[\"m\"]]}},\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/levelQuestWizardHandlers.test.ts:115:25\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"levelQuestWizard handlers handleQuestComplete replies with completion message and keyboard","status":"failed","title":"replies with completion message and keyboard"},{"ancestorTitles":["levelQuestWizard handlers","handleQuestComplete"],"duration":1,"failureMessages":["Error: oops\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/levelQuestWizardHandlers.test.ts:125:21\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/levelQuestWizardHandlers.test.ts:121:54)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"levelQuestWizard handlers handleQuestComplete calls errorMessage on exception","status":"failed","title":"calls errorMessage on exception"}]},{"numFailingTests":4,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168592550,"runtime":137,"slow":false,"start":1745168592413},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/payments/starPaymentScene.test.ts","failureMessage":"  ‚óè Star Payment Scene ‚Ä∫ should enter the scene and call handleSelectStars if no subscription in session\n\n    expect(jest.fn()).toHaveBeenCalledTimes(expected)\n\n    Expected number of calls: 1\n    Received number of calls: 0\n\n      159 |     }\n      160 |\n    > 161 |     expect(mockedHandlers.handleSelectStars).toHaveBeenCalledTimes(1)\n          |                                              ^\n      162 |     expect(mockedHandlers.handleSelectStars).toHaveBeenCalledWith(\n      163 |       expect.objectContaining({ ctx, isRu: true })\n      164 |     )\n\n      at __tests__/payments/starPaymentScene.test.ts:161:46\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/payments/starPaymentScene.test.ts:147:100)\n\n  ‚óè Star Payment Scene ‚Ä∫ should enter the scene and call handleBuySubscription if subscription in session\n\n    expect(jest.fn()).toHaveBeenCalledTimes(expected)\n\n    Expected number of calls: 1\n    Received number of calls: 0\n\n      178 |     }\n      179 |\n    > 180 |     expect(mockedHandlers.handleBuySubscription).toHaveBeenCalledTimes(1)\n          |                                                  ^\n      181 |     expect(mockedHandlers.handleBuySubscription).toHaveBeenCalledWith({\n      182 |       ctx,\n      183 |       isRu: true,\n\n      at __tests__/payments/starPaymentScene.test.ts:180:50\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/payments/starPaymentScene.test.ts:168:101)\n\n  ‚óè Star Payment Scene ‚Ä∫ should handle selecting a star package (action top_up_X)\n\n    Action handler not registered\n\n      193 |     // @ts-ignore - –î–æ–±–∞–≤–ª—è–µ–º match –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ç–µ—Å—Ç–∞\n      194 |     ctx.match = [`top_up_${starsAmount}`, starsAmount.toString()]\n    > 195 |     if (!starCallbackHandler) throw new Error('Action handler not registered')\n          |                                     ^\n      196 |     await starCallbackHandler(ctx, jest.fn() as any)\n      197 |\n      198 |     expect(ctx.answerCbQuery).toHaveBeenCalled()\n\n      at __tests__/payments/starPaymentScene.test.ts:195:37\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/payments/starPaymentScene.test.ts:188:77)\n\n  ‚óè Star Payment Scene ‚Ä∫ should handle error during payment saving\n\n    Action handler not registered\n\n      225 |     // @ts-ignore - –î–æ–±–∞–≤–ª—è–µ–º match –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ç–µ—Å—Ç–∞\n      226 |     ctx.match = [`top_up_${starsAmount}`, starsAmount.toString()]\n    > 227 |     if (!starCallbackHandler) throw new Error('Action handler not registered')\n          |                                     ^\n      228 |     await starCallbackHandler(ctx, jest.fn() as any)\n      229 |\n      230 |     expect(ctx.answerCbQuery).toHaveBeenCalled()\n\n      at __tests__/payments/starPaymentScene.test.ts:227:37\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/payments/starPaymentScene.test.ts:218:62)\n","testResults":[{"ancestorTitles":["Star Payment Scene"],"duration":1,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledTimes(expected)\n\nExpected number of calls: 1\nReceived number of calls: 0\n    at /Users/playom/999-multibots-telegraf/__tests__/payments/starPaymentScene.test.ts:161:46\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/payments/starPaymentScene.test.ts:147:100)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"Star Payment Scene should enter the scene and call handleSelectStars if no subscription in session","status":"failed","title":"should enter the scene and call handleSelectStars if no subscription in session"},{"ancestorTitles":["Star Payment Scene"],"duration":1,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledTimes(expected)\n\nExpected number of calls: 1\nReceived number of calls: 0\n    at /Users/playom/999-multibots-telegraf/__tests__/payments/starPaymentScene.test.ts:180:50\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/payments/starPaymentScene.test.ts:168:101)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"Star Payment Scene should enter the scene and call handleBuySubscription if subscription in session","status":"failed","title":"should enter the scene and call handleBuySubscription if subscription in session"},{"ancestorTitles":["Star Payment Scene"],"duration":1,"failureMessages":["Error: Action handler not registered\n    at /Users/playom/999-multibots-telegraf/__tests__/payments/starPaymentScene.test.ts:195:37\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/payments/starPaymentScene.test.ts:188:77)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"Star Payment Scene should handle selecting a star package (action top_up_X)","status":"failed","title":"should handle selecting a star package (action top_up_X)"},{"ancestorTitles":["Star Payment Scene"],"duration":0,"failureMessages":["Error: Action handler not registered\n    at /Users/playom/999-multibots-telegraf/__tests__/payments/starPaymentScene.test.ts:227:37\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/payments/starPaymentScene.test.ts:218:62)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"Star Payment Scene should handle error during payment saving","status":"failed","title":"should handle error during payment saving"},{"ancestorTitles":["Star Payment Scene"],"duration":0,"failureMessages":[],"fullName":"Star Payment Scene should handle buying a subscription with stars","status":"passed","title":"should handle buying a subscription with stars"}]},{"numFailingTests":6,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168592677,"runtime":122,"slow":false,"start":1745168592555},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/payments/rublePaymentScene.test.ts","failureMessage":"  ‚óè Ruble Payment Scene ‚Ä∫ should enter the scene and call handleSelectRubAmount\n\n    next(ctx) called with invalid context\n\n      184 |\n      185 |   it('should enter the scene and call handleSelectRubAmount', async () => {\n    > 186 |     await rublePaymentScene.enterMiddleware()(ctx, jest.fn() as any)\n          |                                              ^\n      187 |     expect(mockedLogger.info).toHaveBeenCalledWith(\n      188 |       `Entering ${ModeEnum.RublePaymentScene}`,\n      189 |       { telegram_id: ctx.from?.id }\n\n      at execute (node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:511:27)\n      at node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:507:20\n      at __tests__/payments/rublePaymentScene.test.ts:186:46\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/payments/rublePaymentScene.test.ts:185:74)\n\n  ‚óè Ruble Payment Scene ‚Ä∫ should handle error during enterMiddleware and leave the scene\n\n    next(ctx) called with invalid context\n\n      203 |     ) // –ò—Å–ø–æ–ª—å–∑—É–µ–º enterError\n      204 |\n    > 205 |     await rublePaymentScene.enterMiddleware()(ctx, jest.fn() as any)\n          |                                              ^\n      206 |\n      207 |     expect(handlers.handleSelectRubAmount).toHaveBeenCalledTimes(1)\n      208 |     expect(mockedLogger.error).toHaveBeenCalledWith(\n\n      at execute (node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:511:27)\n      at node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:507:20\n      at __tests__/payments/rublePaymentScene.test.ts:205:46\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/payments/rublePaymentScene.test.ts:199:83)\n\n  ‚óè Ruble Payment Scene ‚Ä∫ should handle selecting a ruble amount via action callback\n\n    TypeError: Cannot read properties of undefined (reading 'get')\n\n      228 |\n      229 |     // @ts-ignore\n    > 230 |     const actionCallback = rublePaymentScene.actions.get('top_up_rub_(d+)')\n          |                                                      ^\n      231 |     if (!actionCallback) throw new Error('Action handler not found')\n      232 |\n      233 |     // @ts-ignore\n\n      at __tests__/payments/rublePaymentScene.test.ts:230:54\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/payments/rublePaymentScene.test.ts:222:79)\n\n  ‚óè Ruble Payment Scene ‚Ä∫ should handle error when Robokassa invoice generation fails\n\n    TypeError: Cannot read properties of undefined (reading 'get')\n\n      274 |\n      275 |     // @ts-ignore\n    > 276 |     const actionCallback = rublePaymentScene.actions.get('top_up_rub_(d+)')\n          |                                                      ^\n      277 |     if (!actionCallback) throw new Error('Action handler not found')\n      278 |\n      279 |     // @ts-ignore\n\n      at __tests__/payments/rublePaymentScene.test.ts:276:54\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/payments/rublePaymentScene.test.ts:271:80)\n\n  ‚óè Ruble Payment Scene ‚Ä∫ should handle selecting an invalid ruble amount option\n\n    TypeError: Cannot read properties of undefined (reading 'get')\n\n      309 |\n      310 |     // @ts-ignore\n    > 311 |     const actionCallback = rublePaymentScene.actions.get('top_up_rub_(d+)')\n          |                                                      ^\n      312 |     if (!actionCallback) throw new Error('Action handler not found')\n      313 |\n      314 |     // @ts-ignore\n\n      at __tests__/payments/rublePaymentScene.test.ts:311:54\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/payments/rublePaymentScene.test.ts:307:75)\n\n  ‚óè Ruble Payment Scene ‚Ä∫ should handle error when saving payment to DB fails\n\n    TypeError: Cannot read properties of undefined (reading 'get')\n\n      349 |\n      350 |     // @ts-ignore\n    > 351 |     const actionCallback = rublePaymentScene.actions.get('top_up_rub_(d+)')\n          |                                                      ^\n      352 |     if (!actionCallback) throw new Error('Action handler not found')\n      353 |     // @ts-ignore\n      354 |     ctx.updateType = 'callback_query'\n\n      at __tests__/payments/rublePaymentScene.test.ts:351:54\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/payments/rublePaymentScene.test.ts:341:72)\n","testResults":[{"ancestorTitles":["Ruble Payment Scene"],"duration":1,"failureMessages":["Error: next(ctx) called with invalid context\n    at execute (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:511:27)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:507:20\n    at /Users/playom/999-multibots-telegraf/__tests__/payments/rublePaymentScene.test.ts:186:46\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/payments/rublePaymentScene.test.ts:185:74)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"Ruble Payment Scene should enter the scene and call handleSelectRubAmount","status":"failed","title":"should enter the scene and call handleSelectRubAmount"},{"ancestorTitles":["Ruble Payment Scene"],"duration":3,"failureMessages":["Error: next(ctx) called with invalid context\n    at execute (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:511:27)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:507:20\n    at /Users/playom/999-multibots-telegraf/__tests__/payments/rublePaymentScene.test.ts:205:46\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/payments/rublePaymentScene.test.ts:199:83)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"Ruble Payment Scene should handle error during enterMiddleware and leave the scene","status":"failed","title":"should handle error during enterMiddleware and leave the scene"},{"ancestorTitles":["Ruble Payment Scene"],"duration":1,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'get')\n    at /Users/playom/999-multibots-telegraf/__tests__/payments/rublePaymentScene.test.ts:230:54\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/payments/rublePaymentScene.test.ts:222:79)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"Ruble Payment Scene should handle selecting a ruble amount via action callback","status":"failed","title":"should handle selecting a ruble amount via action callback"},{"ancestorTitles":["Ruble Payment Scene"],"duration":1,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'get')\n    at /Users/playom/999-multibots-telegraf/__tests__/payments/rublePaymentScene.test.ts:276:54\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/payments/rublePaymentScene.test.ts:271:80)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"Ruble Payment Scene should handle error when Robokassa invoice generation fails","status":"failed","title":"should handle error when Robokassa invoice generation fails"},{"ancestorTitles":["Ruble Payment Scene"],"duration":0,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'get')\n    at /Users/playom/999-multibots-telegraf/__tests__/payments/rublePaymentScene.test.ts:311:54\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/payments/rublePaymentScene.test.ts:307:75)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"Ruble Payment Scene should handle selecting an invalid ruble amount option","status":"failed","title":"should handle selecting an invalid ruble amount option"},{"ancestorTitles":["Ruble Payment Scene"],"duration":1,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'get')\n    at /Users/playom/999-multibots-telegraf/__tests__/payments/rublePaymentScene.test.ts:351:54\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/payments/rublePaymentScene.test.ts:341:72)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"Ruble Payment Scene should handle error when saving payment to DB fails","status":"failed","title":"should handle error when saving payment to DB fails"}]},{"numFailingTests":3,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168592806,"runtime":126,"slow":false,"start":1745168592680},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/services/generateImageToPrompt.test.ts","failureMessage":"  ‚óè generateImageToPrompt ‚Ä∫ skips API call and replies when ELESTIO_URL not set\n\n    TypeError: Cannot read properties of undefined (reading 'bot')\n\n      18 |\n      19 |   const botResult = getBotByName(botName)\n    > 20 |   if (!botResult.bot) {\n         |                  ^\n      21 |     logger.error('Bot instance not found by name', { botName, telegram_id })\n      22 |     throw new Error(`Telegraf instance (bot) not found for botName: ${botName}`)\n      23 |   }\n\n      at src/services/generateImageToPrompt.ts:20:18\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at generateImageToPrompt (src/services/generateImageToPrompt.ts:16:5)\n      at Object.<anonymous> (__tests__/services/generateImageToPrompt.test.ts:28:26)\n      at __tests__/services/generateImageToPrompt.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/services/generateImageToPrompt.test.ts:3:12)\n      at Object.<anonymous> (__tests__/services/generateImageToPrompt.test.ts:22:72)\n\n  ‚óè generateImageToPrompt ‚Ä∫ makes API call when ELESTIO_URL is set\n\n    TypeError: Cannot read properties of undefined (reading 'bot')\n\n      18 |\n      19 |   const botResult = getBotByName(botName)\n    > 20 |   if (!botResult.bot) {\n         |                  ^\n      21 |     logger.error('Bot instance not found by name', { botName, telegram_id })\n      22 |     throw new Error(`Telegraf instance (bot) not found for botName: ${botName}`)\n      23 |   }\n\n      at src/services/generateImageToPrompt.ts:20:18\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at generateImageToPrompt (src/services/generateImageToPrompt.ts:16:5)\n      at Object.<anonymous> (__tests__/services/generateImageToPrompt.test.ts:41:26)\n      at __tests__/services/generateImageToPrompt.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/services/generateImageToPrompt.test.ts:3:12)\n      at Object.<anonymous> (__tests__/services/generateImageToPrompt.test.ts:34:59)\n\n  ‚óè generateImageToPrompt ‚Ä∫ replies with error message on axios error\n\n    TypeError: Cannot read properties of undefined (reading 'bot')\n\n      18 |\n      19 |   const botResult = getBotByName(botName)\n    > 20 |   if (!botResult.bot) {\n         |                  ^\n      21 |     logger.error('Bot instance not found by name', { botName, telegram_id })\n      22 |     throw new Error(`Telegraf instance (bot) not found for botName: ${botName}`)\n      23 |   }\n\n      at src/services/generateImageToPrompt.ts:20:18\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at generateImageToPrompt (src/services/generateImageToPrompt.ts:16:5)\n      at Object.<anonymous> (__tests__/services/generateImageToPrompt.test.ts:59:26)\n      at __tests__/services/generateImageToPrompt.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/services/generateImageToPrompt.test.ts:3:12)\n      at Object.<anonymous> (__tests__/services/generateImageToPrompt.test.ts:51:62)\n","testResults":[{"ancestorTitles":["generateImageToPrompt"],"duration":32,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'bot')\n    at /Users/playom/999-multibots-telegraf/src/services/generateImageToPrompt.ts:20:18\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at generateImageToPrompt (/Users/playom/999-multibots-telegraf/src/services/generateImageToPrompt.ts:16:5)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/services/generateImageToPrompt.test.ts:28:26)\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/__tests__/services/generateImageToPrompt.test.ts:7:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/playom/999-multibots-telegraf/__tests__/services/generateImageToPrompt.test.ts:3:12)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/services/generateImageToPrompt.test.ts:22:72)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"generateImageToPrompt skips API call and replies when ELESTIO_URL not set","status":"failed","title":"skips API call and replies when ELESTIO_URL not set"},{"ancestorTitles":["generateImageToPrompt"],"duration":34,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'bot')\n    at /Users/playom/999-multibots-telegraf/src/services/generateImageToPrompt.ts:20:18\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at generateImageToPrompt (/Users/playom/999-multibots-telegraf/src/services/generateImageToPrompt.ts:16:5)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/services/generateImageToPrompt.test.ts:41:26)\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/__tests__/services/generateImageToPrompt.test.ts:7:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/playom/999-multibots-telegraf/__tests__/services/generateImageToPrompt.test.ts:3:12)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/services/generateImageToPrompt.test.ts:34:59)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"generateImageToPrompt makes API call when ELESTIO_URL is set","status":"failed","title":"makes API call when ELESTIO_URL is set"},{"ancestorTitles":["generateImageToPrompt"],"duration":32,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'bot')\n    at /Users/playom/999-multibots-telegraf/src/services/generateImageToPrompt.ts:20:18\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at generateImageToPrompt (/Users/playom/999-multibots-telegraf/src/services/generateImageToPrompt.ts:16:5)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/services/generateImageToPrompt.test.ts:59:26)\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/__tests__/services/generateImageToPrompt.test.ts:7:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/playom/999-multibots-telegraf/__tests__/services/generateImageToPrompt.test.ts:3:12)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/services/generateImageToPrompt.test.ts:51:62)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"generateImageToPrompt replies with error message on axios error","status":"failed","title":"replies with error message on axios error"}]},{"numFailingTests":7,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168592928,"runtime":116,"slow":false,"start":1745168592812},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/payments/paymentScene.test.ts","failureMessage":"  ‚óè Payment Scene ‚Ä∫ should enter the scene and show payment options for RU user\n\n    next(ctx) called with invalid context\n\n       95 |   it('should enter the scene and show payment options for RU user', async () => {\n       96 |     // –ò—Å–ø–æ–ª—å–∑—É–µ–º enterMiddleware\n    >  97 |     await paymentScene.enterMiddleware()(ctx, async () => {})\n          |                                         ^\n       98 |\n       99 |     expect(replyMock).toHaveBeenCalledTimes(1)\n      100 |     expect(replyMock).toHaveBeenCalledWith(\n\n      at execute (node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:511:27)\n      at node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:507:20\n      at __tests__/payments/paymentScene.test.ts:97:41\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/payments/paymentScene.test.ts:95:80)\n\n  ‚óè Payment Scene ‚Ä∫ should enter the scene and show payment options for EN user\n\n    next(ctx) called with invalid context\n\n      128 |     mockedIsRussian.mockReturnValue(false)\n      129 |     // –ò—Å–ø–æ–ª—å–∑—É–µ–º enterMiddleware\n    > 130 |     await paymentScene.enterMiddleware()(ctx, async () => {})\n          |                                         ^\n      131 |\n      132 |     expect(replyMock).toHaveBeenCalledTimes(1)\n      133 |     expect(replyMock).toHaveBeenCalledWith(\n\n      at execute (node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:511:27)\n      at node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:507:20\n      at __tests__/payments/paymentScene.test.ts:130:41\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/payments/paymentScene.test.ts:127:80)\n\n  ‚óè Payment Scene ‚Ä∫ should handle \"‚≠êÔ∏è –ó–≤–µ–∑–¥–∞–º–∏\" and enter StarPaymentScene\n\n    next(ctx) called with invalid context\n\n      162 |     ctx.update.message = ctx.message\n      163 |     // –ò—Å–ø–æ–ª—å–∑—É–µ–º middleware\n    > 164 |     await paymentScene.middleware()(ctx, async () => {})\n          |                                    ^\n      165 |\n      166 |     expect(ctx.scene.enter).toHaveBeenCalledWith(ModeEnum.StarPaymentScene)\n      167 |   })\n\n      at execute (node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:511:27)\n      at node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:507:20\n      at __tests__/payments/paymentScene.test.ts:164:36\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/payments/paymentScene.test.ts:156:75)\n\n  ‚óè Payment Scene ‚Ä∫ should handle \"üí≥ –†—É–±–ª—è–º–∏\" and enter RublePaymentScene\n\n    next(ctx) called with invalid context\n\n      175 |     ctx.update.message = ctx.message\n      176 |     // –ò—Å–ø–æ–ª—å–∑—É–µ–º middleware\n    > 177 |     await paymentScene.middleware()(ctx, async () => {})\n          |                                    ^\n      178 |\n      179 |     expect(ctx.scene.enter).toHaveBeenCalledWith(ModeEnum.RublePaymentScene)\n      180 |     expect(mockedLogger.info).toHaveBeenCalledWith(\n\n      at execute (node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:511:27)\n      at node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:507:20\n      at __tests__/payments/paymentScene.test.ts:177:36\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/payments/paymentScene.test.ts:169:75)\n\n  ‚óè Payment Scene ‚Ä∫ should handle \"üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\" and enter MenuScene\n\n    next(ctx) called with invalid context\n\n      192 |     ctx.update.message = ctx.message\n      193 |     // –ò—Å–ø–æ–ª—å–∑—É–µ–º middleware\n    > 194 |     await paymentScene.middleware()(ctx, async () => {})\n          |                                    ^\n      195 |\n      196 |     expect(ctx.scene.enter).toHaveBeenCalledWith(ModeEnum.MenuScene)\n      197 |     expect(mockedLogger.info).toHaveBeenCalledWith(\n\n      at execute (node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:511:27)\n      at node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:507:20\n      at __tests__/payments/paymentScene.test.ts:194:36\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/payments/paymentScene.test.ts:186:72)\n\n  ‚óè Payment Scene ‚Ä∫ should handle unexpected message\n\n    next(ctx) called with invalid context\n\n      210 |     ctx.update.message = ctx.message\n      211 |     // –ò—Å–ø–æ–ª—å–∑—É–µ–º middleware\n    > 212 |     await paymentScene.middleware()(ctx, async () => {})\n          |                                    ^\n      213 |\n      214 |     expect(replyMock).toHaveBeenCalledWith(\n      215 |       '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã (‚≠êÔ∏è –∏–ª–∏ üí≥) –∏–ª–∏ –≤–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é.',\n\n      at execute (node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:511:27)\n      at node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:507:20\n      at __tests__/payments/paymentScene.test.ts:212:36\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/payments/paymentScene.test.ts:204:53)\n\n  ‚óè Payment Scene ‚Ä∫ should handle error during enterMiddleware and leave scene\n\n    next(ctx) called with invalid context\n\n      231 |\n      232 |     // –ò—Å–ø–æ–ª—å–∑—É–µ–º enterMiddleware\n    > 233 |     await paymentScene.enterMiddleware()(ctx, async () => {})\n          |                                         ^\n      234 |\n      235 |     expect(replyMock).toHaveBeenCalledTimes(2)\n      236 |     expect(replyMock).toHaveBeenNthCalledWith(\n\n      at execute (node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:511:27)\n      at node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:507:20\n      at __tests__/payments/paymentScene.test.ts:233:41\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/payments/paymentScene.test.ts:226:79)\n","testResults":[{"ancestorTitles":["Payment Scene"],"duration":1,"failureMessages":["Error: next(ctx) called with invalid context\n    at execute (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:511:27)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:507:20\n    at /Users/playom/999-multibots-telegraf/__tests__/payments/paymentScene.test.ts:97:41\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/payments/paymentScene.test.ts:95:80)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"Payment Scene should enter the scene and show payment options for RU user","status":"failed","title":"should enter the scene and show payment options for RU user"},{"ancestorTitles":["Payment Scene"],"duration":3,"failureMessages":["Error: next(ctx) called with invalid context\n    at execute (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:511:27)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:507:20\n    at /Users/playom/999-multibots-telegraf/__tests__/payments/paymentScene.test.ts:130:41\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/payments/paymentScene.test.ts:127:80)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"Payment Scene should enter the scene and show payment options for EN user","status":"failed","title":"should enter the scene and show payment options for EN user"},{"ancestorTitles":["Payment Scene"],"duration":0,"failureMessages":["Error: next(ctx) called with invalid context\n    at execute (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:511:27)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:507:20\n    at /Users/playom/999-multibots-telegraf/__tests__/payments/paymentScene.test.ts:164:36\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/payments/paymentScene.test.ts:156:75)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"Payment Scene should handle \"‚≠êÔ∏è –ó–≤–µ–∑–¥–∞–º–∏\" and enter StarPaymentScene","status":"failed","title":"should handle \"‚≠êÔ∏è –ó–≤–µ–∑–¥–∞–º–∏\" and enter StarPaymentScene"},{"ancestorTitles":["Payment Scene"],"duration":1,"failureMessages":["Error: next(ctx) called with invalid context\n    at execute (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:511:27)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:507:20\n    at /Users/playom/999-multibots-telegraf/__tests__/payments/paymentScene.test.ts:177:36\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/payments/paymentScene.test.ts:169:75)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"Payment Scene should handle \"üí≥ –†—É–±–ª—è–º–∏\" and enter RublePaymentScene","status":"failed","title":"should handle \"üí≥ –†—É–±–ª—è–º–∏\" and enter RublePaymentScene"},{"ancestorTitles":["Payment Scene"],"duration":1,"failureMessages":["Error: next(ctx) called with invalid context\n    at execute (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:511:27)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:507:20\n    at /Users/playom/999-multibots-telegraf/__tests__/payments/paymentScene.test.ts:194:36\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/payments/paymentScene.test.ts:186:72)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"Payment Scene should handle \"üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\" and enter MenuScene","status":"failed","title":"should handle \"üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\" and enter MenuScene"},{"ancestorTitles":["Payment Scene"],"duration":0,"failureMessages":["Error: next(ctx) called with invalid context\n    at execute (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:511:27)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:507:20\n    at /Users/playom/999-multibots-telegraf/__tests__/payments/paymentScene.test.ts:212:36\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/payments/paymentScene.test.ts:204:53)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"Payment Scene should handle unexpected message","status":"failed","title":"should handle unexpected message"},{"ancestorTitles":["Payment Scene"],"duration":1,"failureMessages":["Error: next(ctx) called with invalid context\n    at execute (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:511:27)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:507:20\n    at /Users/playom/999-multibots-telegraf/__tests__/payments/paymentScene.test.ts:233:41\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/payments/paymentScene.test.ts:226:79)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"Payment Scene should handle error during enterMiddleware and leave scene","status":"failed","title":"should handle error during enterMiddleware and leave scene"}]},{"numFailingTests":4,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168593037,"runtime":107,"slow":false,"start":1745168592930},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/avatarBrainWizard.test.ts","failureMessage":"  ‚óè avatarBrainWizard ‚Ä∫ step 3: should save skills, update soul, check level <= 2 and leave\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"555\", \"AcmeCorp\", \"Developer\", \"JS, TS\"\n\n    Number of calls: 0\n\n      124 |     await (step3 as MiddlewareFn<MyContext>)(ctx, mockNext)\n      125 |\n    > 126 |     expect(mockedUpdateUserSoul).toHaveBeenCalledWith(\n          |                                  ^\n      127 |       '555',        // userId\n      128 |       'AcmeCorp',   // company (–∏–∑ state)\n      129 |       'Developer',  // position (–∏–∑ state)\n\n      at __tests__/scenes/avatarBrainWizard.test.ts:126:34\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ‚óè avatarBrainWizard ‚Ä∫ step 3: should save skills, update soul, check level = 3, update level and leave\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"666\", \"BigCorp\", \"Manager\", \"Leadership\"\n\n    Number of calls: 0\n\n      150 |     await (step3 as MiddlewareFn<MyContext>)(ctx, mockNext)\n      151 |\n    > 152 |     expect(mockedUpdateUserSoul).toHaveBeenCalledWith('666', 'BigCorp', 'Manager', 'Leadership')\n          |                                  ^\n      153 |     expect(ctx.reply).toHaveBeenCalledWith(expect.stringContaining('‚úÖ –ê–≤–∞—Ç–∞—Ä —É—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–∏–ª –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é'), { parse_mode: 'HTML' })\n      154 |     expect(mockedGetUserByTelegramId).toHaveBeenCalledWith(ctx)\n      155 |     expect(mockedUpdateUserLevelPlusOne).toHaveBeenCalledWith('666', 3) // –£—Ä–æ–≤–µ–Ω—å –¥–æ–ª–∂–µ–Ω –æ–±–Ω–æ–≤–∏—Ç—å—Å—è\n\n      at __tests__/scenes/avatarBrainWizard.test.ts:152:34\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ‚óè avatarBrainWizard ‚Ä∫ step 3: should save skills, update soul, check level > 3 and leave\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"777\", \"Startup\", \"CTO\", \"Strategy\"\n\n    Number of calls: 0\n\n      168 |     await (step3 as MiddlewareFn<MyContext>)(ctx, mockNext)\n      169 |\n    > 170 |     expect(mockedUpdateUserSoul).toHaveBeenCalledWith('777', 'Startup', 'CTO', 'Strategy')\n          |                                  ^\n      171 |     expect(ctx.reply).toHaveBeenCalledWith(expect.stringContaining('‚úÖ –ê–≤–∞—Ç–∞—Ä —É—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–∏–ª –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é'), { parse_mode: 'HTML' })\n      172 |     expect(mockedGetUserByTelegramId).toHaveBeenCalledWith(ctx)\n      173 |     expect(mockedUpdateUserLevelPlusOne).not.toHaveBeenCalled() // –£—Ä–æ–≤–µ–Ω—å –Ω–µ –¥–æ–ª–∂–µ–Ω –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è\n\n      at __tests__/scenes/avatarBrainWizard.test.ts:170:34\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ‚óè avatarBrainWizard ‚Ä∫ step 3: should throw error if user not found\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"404\", \"Ghost Inc.\", \"Phantom\", \"Invisibility\"\n\n    Number of calls: 0\n\n      189 |\n      190 |     // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ updateUserSoul –±—ã–ª –≤—ã–∑–≤–∞–Ω –¥–æ –æ—à–∏–±–∫–∏\n    > 191 |     expect(mockedUpdateUserSoul).toHaveBeenCalledWith('404', 'Ghost Inc.', 'Phantom', 'Invisibility')\n          |                                  ^\n      192 |     expect(mockedUpdateUserLevelPlusOne).not.toHaveBeenCalled()\n      193 |     expect(ctx.scene.leave).not.toHaveBeenCalled() // –ù–µ –¥–æ–ª–∂–µ–Ω –≤—ã–π—Ç–∏ —à—Ç–∞—Ç–Ω–æ\n      194 |   })\n\n      at __tests__/scenes/avatarBrainWizard.test.ts:191:34\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["avatarBrainWizard"],"duration":1,"failureMessages":[],"fullName":"avatarBrainWizard step 0: should ask for company name","status":"passed","title":"step 0: should ask for company name"},{"ancestorTitles":["avatarBrainWizard"],"duration":1,"failureMessages":[],"fullName":"avatarBrainWizard step 1: should save company and ask for position","status":"passed","title":"step 1: should save company and ask for position"},{"ancestorTitles":["avatarBrainWizard"],"duration":0,"failureMessages":[],"fullName":"avatarBrainWizard step 2: should save position and ask for skills","status":"passed","title":"step 2: should save position and ask for skills"},{"ancestorTitles":["avatarBrainWizard"],"duration":1,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"555\", \"AcmeCorp\", \"Developer\", \"JS, TS\"\n\nNumber of calls: 0\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/avatarBrainWizard.test.ts:126:34\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"avatarBrainWizard step 3: should save skills, update soul, check level <= 2 and leave","status":"failed","title":"step 3: should save skills, update soul, check level <= 2 and leave"},{"ancestorTitles":["avatarBrainWizard"],"duration":1,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"666\", \"BigCorp\", \"Manager\", \"Leadership\"\n\nNumber of calls: 0\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/avatarBrainWizard.test.ts:152:34\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"avatarBrainWizard step 3: should save skills, update soul, check level = 3, update level and leave","status":"failed","title":"step 3: should save skills, update soul, check level = 3, update level and leave"},{"ancestorTitles":["avatarBrainWizard"],"duration":0,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"777\", \"Startup\", \"CTO\", \"Strategy\"\n\nNumber of calls: 0\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/avatarBrainWizard.test.ts:170:34\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"avatarBrainWizard step 3: should save skills, update soul, check level > 3 and leave","status":"failed","title":"step 3: should save skills, update soul, check level > 3 and leave"},{"ancestorTitles":["avatarBrainWizard"],"duration":2,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"404\", \"Ghost Inc.\", \"Phantom\", \"Invisibility\"\n\nNumber of calls: 0\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/avatarBrainWizard.test.ts:191:34\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"avatarBrainWizard step 3: should throw error if user not found","status":"failed","title":"step 3: should throw error if user not found"}]},{"numFailingTests":3,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168593080,"runtime":40,"slow":false,"start":1745168593040},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/startScene.test.ts","failureMessage":"  ‚óè startScene ‚Ä∫ –¥–æ–ª–∂–Ω–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ñ–æ—Ç–æ –∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π\n\n    TypeError: Cannot read properties of undefined (reading 'username')\n\n      21 |\n      22 |     const isRu = ctx.from?.language_code === 'ru'\n    > 23 |     const botName = ctx.botInfo.username\n         |                                 ^\n      24 |\n      25 |     logger.info({\n      26 |       message: 'üì° [StartScene] –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–¥–∞ –¥–ª—è —Å—Ç–∞—Ä—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è',\n\n      at src/scenes/startScene/index.ts:23:33\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at src/scenes/startScene/index.ts:11:15\n      at __tests__/scenes/startScene.test.ts:59:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/startScene.test.ts:51:83)\n\n  ‚óè startScene ‚Ä∫ –¥–æ–ª–∂–Ω–∞ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ menuScene –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏\n\n    TypeError: secondHandler is not a function\n\n      87 |     const secondHandler = startScene.steps[1]\n      88 |     // @ts-ignore - –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫—É —Ç–∏–ø–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–æ–≤\n    > 89 |     await secondHandler(ctx)\n         |           ^\n      90 |\n      91 |     // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –±—ã–ª –æ—Å—É—â–µ—Å—Ç–≤–ª–µ–Ω –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ menuScene\n      92 |     expect(ctx.scene.enter).toHaveBeenCalledWith('menuScene')\n\n      at __tests__/scenes/startScene.test.ts:89:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/startScene.test.ts:75:69)\n\n  ‚óè startScene ‚Ä∫ –¥–æ–ª–∂–Ω–∞ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ subscriptionScene –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏\n\n    TypeError: secondHandler is not a function\n\n      107 |     const secondHandler = startScene.steps[1]\n      108 |     // @ts-ignore - –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫—É —Ç–∏–ø–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–æ–≤\n    > 109 |     await secondHandler(ctx)\n          |           ^\n      110 |\n      111 |     // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –±—ã–ª –æ—Å—É—â–µ—Å—Ç–≤–ª–µ–Ω –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ subscriptionScene\n      112 |     expect(ctx.scene.enter).toHaveBeenCalledWith('subscriptionScene')\n\n      at __tests__/scenes/startScene.test.ts:109:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/startScene.test.ts:95:80)\n","testResults":[{"ancestorTitles":["startScene"],"duration":3,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'username')\n    at /Users/playom/999-multibots-telegraf/src/scenes/startScene/index.ts:23:33\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at /Users/playom/999-multibots-telegraf/src/scenes/startScene/index.ts:11:15\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/startScene.test.ts:59:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/startScene.test.ts:51:83)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"startScene –¥–æ–ª–∂–Ω–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ñ–æ—Ç–æ –∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π","status":"failed","title":"–¥–æ–ª–∂–Ω–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ñ–æ—Ç–æ –∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π"},{"ancestorTitles":["startScene"],"duration":1,"failureMessages":["TypeError: secondHandler is not a function\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/startScene.test.ts:89:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/startScene.test.ts:75:69)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"startScene –¥–æ–ª–∂–Ω–∞ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ menuScene –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏","status":"failed","title":"–¥–æ–ª–∂–Ω–∞ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ menuScene –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏"},{"ancestorTitles":["startScene"],"duration":3,"failureMessages":["TypeError: secondHandler is not a function\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/startScene.test.ts:109:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/startScene.test.ts:95:80)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"startScene –¥–æ–ª–∂–Ω–∞ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ subscriptionScene –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏","status":"failed","title":"–¥–æ–ª–∂–Ω–∞ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ subscriptionScene –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏"}]},{"numFailingTests":6,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168593178,"runtime":96,"slow":false,"start":1745168593082},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/subscriptionCheckScene.test.ts","failureMessage":"  ‚óè subscriptionCheckScene ‚Ä∫ should enter main menu if user is admin\n\n    TypeError: step is not a function\n\n      85 |     // –ü–µ—Ä–µ–¥–∞–µ–º from —á–µ—Ä–µ–∑ message\n      86 |     ctx = makeMockContext({ message: { from: { id: adminId, is_bot: false, first_name: 'Admin' } } }, sessionData)\n    > 87 |     await step(ctx, mockNext)\n         |           ^\n      88 |     expect(ctx.scene.enter).toHaveBeenCalledWith(ModeEnum.MainMenu)\n      89 |     expect(mockedCheckSubscription).not.toHaveBeenCalled()\n      90 |     expect(ctx.reply).not.toHaveBeenCalled() // –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ\n\n      at __tests__/scenes/subscriptionCheckScene.test.ts:87:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/subscriptionCheckScene.test.ts:82:60)\n\n  ‚óè subscriptionCheckScene ‚Ä∫ should call checkSubscription for non-admin user\n\n    TypeError: step is not a function\n\n       95 |     ctx = makeMockContext({ message: { from: { id: userId, is_bot: false, first_name: 'User' } } }, sessionData)\n       96 |     mockedCheckSubscription.mockResolvedValue(SubscriptionType.NEUROBASE) // –ü—Ä–∏–º–µ—Ä —É—Ä–æ–≤–Ω—è\n    >  97 |     await step(ctx, mockNext)\n          |           ^\n       98 |     expect(mockedCheckSubscription).toHaveBeenCalledWith(userId.toString())\n       99 |     // –û–∂–∏–¥–∞–µ–º –≤—Ö–æ–¥ –≤ MainMenu, —Ç.–∫. –ø–æ–¥–ø–∏—Å–∫–∞ –µ—Å—Ç—å\n      100 |     expect(ctx.scene.enter).toHaveBeenCalledWith(ModeEnum.MainMenu)\n\n      at __tests__/scenes/subscriptionCheckScene.test.ts:97:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/subscriptionCheckScene.test.ts:93:69)\n\n  ‚óè subscriptionCheckScene ‚Ä∫ should enter subscription scene if check returns unsubscribed\n\n    TypeError: step is not a function\n\n      107 |     ctx = makeMockContext({ message: { from: { id: userId, is_bot: false, first_name: 'User' } } }, sessionData)\n      108 |     mockedCheckSubscription.mockResolvedValue('unsubscribed')\n    > 109 |     await step(ctx, mockNext)\n          |           ^\n      110 |     expect(ctx.scene.enter).toHaveBeenCalledWith(ModeEnum.SubscriptionScene)\n      111 |     expect(mockedCheckSubscription).toHaveBeenCalledWith(userId.toString())\n      112 |     expect(ctx.reply).toHaveBeenCalledWith(expect.stringContaining('–Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–¥–ª–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É'), expect.anything())\n\n      at __tests__/scenes/subscriptionCheckScene.test.ts:109:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/subscriptionCheckScene.test.ts:105:82)\n\n  ‚óè subscriptionCheckScene ‚Ä∫ should enter main menu if check returns a valid level\n\n    TypeError: step is not a function\n\n      118 |     ctx = makeMockContext({ message: { from: { id: userId, is_bot: false, first_name: 'User' } } }, sessionData)\n      119 |     mockedCheckSubscription.mockResolvedValue(level)\n    > 120 |     await step(ctx, mockNext)\n          |           ^\n      121 |     expect(ctx.scene.enter).toHaveBeenCalledWith(ModeEnum.MainMenu)\n      122 |     expect(ctx.session.subscription).toBe(level)\n      123 |     expect(mockedCheckSubscription).toHaveBeenCalledWith(userId.toString())\n\n      at __tests__/scenes/subscriptionCheckScene.test.ts:120:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/subscriptionCheckScene.test.ts:115:74)\n\n  ‚óè subscriptionCheckScene ‚Ä∫ should enter subscription scene on checkSubscription error\n\n    TypeError: step is not a function\n\n      130 |     const error = new Error('DB failed')\n      131 |     mockedCheckSubscription.mockRejectedValue(error)\n    > 132 |     await step(ctx, mockNext)\n          |           ^\n      133 |     expect(ctx.scene.enter).toHaveBeenCalledWith(ModeEnum.SubscriptionScene)\n      134 |     expect(mockedCheckSubscription).toHaveBeenCalledWith(userId.toString())\n      135 |     expect(ctx.reply).toHaveBeenCalledWith(expect.stringContaining('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞'), expect.anything())\n\n      at __tests__/scenes/subscriptionCheckScene.test.ts:132:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/subscriptionCheckScene.test.ts:127:79)\n\n  ‚óè subscriptionCheckScene ‚Ä∫ should enter subscription scene if user ID is missing\n\n    TypeError: step is not a function\n\n      140 |     // –ù–µ –ø–µ—Ä–µ–¥–∞–µ–º from\n      141 |     ctx = makeMockContext({}, sessionData)\n    > 142 |     await step(ctx, mockNext)\n          |           ^\n      143 |     expect(ctx.scene.enter).toHaveBeenCalledWith(ModeEnum.SubscriptionScene)\n      144 |     expect(mockedCheckSubscription).not.toHaveBeenCalled()\n      145 |     expect(ctx.reply).toHaveBeenCalledWith(expect.stringContaining('–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è'), expect.anything())\n\n      at __tests__/scenes/subscriptionCheckScene.test.ts:142:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/subscriptionCheckScene.test.ts:138:74)\n","testResults":[{"ancestorTitles":["subscriptionCheckScene"],"duration":1,"failureMessages":["TypeError: step is not a function\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/subscriptionCheckScene.test.ts:87:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/subscriptionCheckScene.test.ts:82:60)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"subscriptionCheckScene should enter main menu if user is admin","status":"failed","title":"should enter main menu if user is admin"},{"ancestorTitles":["subscriptionCheckScene"],"duration":0,"failureMessages":["TypeError: step is not a function\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/subscriptionCheckScene.test.ts:97:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/subscriptionCheckScene.test.ts:93:69)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"subscriptionCheckScene should call checkSubscription for non-admin user","status":"failed","title":"should call checkSubscription for non-admin user"},{"ancestorTitles":["subscriptionCheckScene"],"duration":1,"failureMessages":["TypeError: step is not a function\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/subscriptionCheckScene.test.ts:109:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/subscriptionCheckScene.test.ts:105:82)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"subscriptionCheckScene should enter subscription scene if check returns unsubscribed","status":"failed","title":"should enter subscription scene if check returns unsubscribed"},{"ancestorTitles":["subscriptionCheckScene"],"duration":0,"failureMessages":["TypeError: step is not a function\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/subscriptionCheckScene.test.ts:120:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/subscriptionCheckScene.test.ts:115:74)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"subscriptionCheckScene should enter main menu if check returns a valid level","status":"failed","title":"should enter main menu if check returns a valid level"},{"ancestorTitles":["subscriptionCheckScene"],"duration":0,"failureMessages":["TypeError: step is not a function\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/subscriptionCheckScene.test.ts:132:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/subscriptionCheckScene.test.ts:127:79)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"subscriptionCheckScene should enter subscription scene on checkSubscription error","status":"failed","title":"should enter subscription scene on checkSubscription error"},{"ancestorTitles":["subscriptionCheckScene"],"duration":0,"failureMessages":["TypeError: step is not a function\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/subscriptionCheckScene.test.ts:142:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/subscriptionCheckScene.test.ts:138:74)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"subscriptionCheckScene should enter subscription scene if user ID is missing","status":"failed","title":"should enter subscription scene if user ID is missing"}]},{"numFailingTests":3,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168593283,"runtime":102,"slow":false,"start":1745168593181},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.test.ts","failureMessage":"  ‚óè updateUserSubscription ‚Ä∫ updates subscription and returns data on success\n\n    expect(received).toEqual(expected) // deep equality\n\n    Expected: [{\"subscription\": \"vip\"}]\n    Received: undefined\n\n      24 |     builder.eq.mockResolvedValue({ data: resultData, error: null })\n      25 |     const res = await updateUserSubscription(userId, subscription)\n    > 26 |     expect(res).toEqual(resultData)\n         |                 ^\n      27 |     const { supabase } = require('@/core/supabase')\n      28 |     expect(supabase.from).toHaveBeenCalledWith('users')\n      29 |     expect(builder.update).toHaveBeenCalledWith({ subscription })\n\n      at Object.<anonymous> (__tests__/core/supabase/updateUserSubscription.test.ts:26:17)\n      at fulfilled (__tests__/core/supabase/updateUserSubscription.test.ts:4:58)\n\n  ‚óè updateUserSubscription ‚Ä∫ throws and logs error when update error occurs\n\n    expect(received).rejects.toEqual(expected) // deep equality\n\n    - Expected  - 3\n    + Received  + 1\n\n    - Object {\n    -   \"message\": \"fail\",\n    - }\n    + [Error: –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è]\n\n      34 |     const err = { message: 'fail' }\n      35 |     builder.eq.mockResolvedValue({ data: null, error: err })\n    > 36 |     await expect(updateUserSubscription(userId, subscription)).rejects.toEqual(err)\n         |                                                                        ^\n      37 |     expect(console.error).toHaveBeenCalledWith('Error updating subscription:', err)\n      38 |   })\n      39 |\n\n      at Object.toEqual (node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n      at Object.<anonymous> (__tests__/core/supabase/updateUserSubscription.test.ts:36:72)\n      at __tests__/core/supabase/updateUserSubscription.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/core/supabase/updateUserSubscription.test.ts:3:12)\n      at Object.<anonymous> (__tests__/core/supabase/updateUserSubscription.test.ts:33:67)\n\n  ‚óè updateUserSubscription ‚Ä∫ throws and logs error when exception occurs\n\n    expect(received).rejects.toThrow(expected)\n\n    Expected substring: \"oops\"\n    Received message:   \"–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\"\n\n          17 |   } catch (error) {\n          18 |     console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error)\n        > 19 |     throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è')\n             |           ^\n          20 |   }\n          21 | }\n          22 |\n\n      at src/core/supabase/updateUserSubscription.ts:19:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at updateUserSubscription (src/core/supabase/updateUserSubscription.ts:6:20)\n      at Object.<anonymous> (__tests__/core/supabase/updateUserSubscription.test.ts:42:18)\n      at __tests__/core/supabase/updateUserSubscription.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/core/supabase/updateUserSubscription.test.ts:3:12)\n      at Object.<anonymous> (__tests__/core/supabase/updateUserSubscription.test.ts:40:64)\n      at Object.toThrow (node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n      at Object.<anonymous> (__tests__/core/supabase/updateUserSubscription.test.ts:42:72)\n      at __tests__/core/supabase/updateUserSubscription.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/core/supabase/updateUserSubscription.test.ts:3:12)\n      at Object.<anonymous> (__tests__/core/supabase/updateUserSubscription.test.ts:40:64)\n","testResults":[{"ancestorTitles":["updateUserSubscription"],"duration":25,"failureMessages":["Error: expect(received).toEqual(expected) // deep equality\n\nExpected: [{\"subscription\": \"vip\"}]\nReceived: undefined\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.test.ts:26:17)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.test.ts:4:58)"],"fullName":"updateUserSubscription updates subscription and returns data on success","status":"failed","title":"updates subscription and returns data on success"},{"ancestorTitles":["updateUserSubscription"],"duration":26,"failureMessages":["Error: expect(received).rejects.toEqual(expected) // deep equality\n\n- Expected  - 3\n+ Received  + 1\n\n- Object {\n-   \"message\": \"fail\",\n- }\n+ [Error: –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è]\n    at Object.toEqual (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.test.ts:36:72)\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.test.ts:7:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.test.ts:3:12)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.test.ts:33:67)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"updateUserSubscription throws and logs error when update error occurs","status":"failed","title":"throws and logs error when update error occurs"},{"ancestorTitles":["updateUserSubscription"],"duration":25,"failureMessages":["Error: expect(received).rejects.toThrow(expected)\n\nExpected substring: \"oops\"\nReceived message:   \"–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\"\n\n      17 |   } catch (error) {\n      18 |     console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error)\n    > 19 |     throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è')\n         |           ^\n      20 |   }\n      21 | }\n      22 |\n\n      at src/core/supabase/updateUserSubscription.ts:19:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at updateUserSubscription (src/core/supabase/updateUserSubscription.ts:6:20)\n      at Object.<anonymous> (__tests__/core/supabase/updateUserSubscription.test.ts:42:18)\n      at __tests__/core/supabase/updateUserSubscription.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/core/supabase/updateUserSubscription.test.ts:3:12)\n      at Object.<anonymous> (__tests__/core/supabase/updateUserSubscription.test.ts:40:64)\n    at Object.toThrow (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.test.ts:42:72)\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.test.ts:7:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.test.ts:3:12)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.test.ts:40:64)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"updateUserSubscription throws and logs error when exception occurs","status":"failed","title":"throws and logs error when exception occurs"}]},{"numFailingTests":4,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168593376,"runtime":91,"slow":false,"start":1745168593285},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/textToImageWizard.test.ts","failureMessage":"  ‚óè textToImageWizard steps ‚Ä∫ step 0: leaves when no user ID\n\n    TypeError: step0 is not a function\n\n      91 |     // @ts-ignore - —É–±–∏—Ä–∞–µ–º ctx.from = undefined\n      92 |\n    > 93 |     await step0(ctx, mockNext)\n         |           ^\n      94 |\n      95 |     expect(ctx.reply).toHaveBeenCalledWith('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è')\n      96 |     expect(ctx.scene.leave).toHaveBeenCalled()\n\n      at __tests__/scenes/textToImageWizard.test.ts:93:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/textToImageWizard.test.ts:87:51)\n\n  ‚óè textToImageWizard steps ‚Ä∫ step 0: prompts and advances\n\n    TypeError: step0 is not a function\n\n      102 |     ctx = makeMockContext({ message: { from: mockFrom } }, sessionData, { botInfo: mockBotInfo })\n      103 |\n    > 104 |     await step0(ctx, mockNext)\n          |           ^\n      105 |\n      106 |     expect(ctx.reply).toHaveBeenCalledWith(\n      107 |       'üé® –í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:',\n\n      at __tests__/scenes/textToImageWizard.test.ts:104:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/textToImageWizard.test.ts:99:49)\n\n  ‚óè textToImageWizard steps ‚Ä∫ step 2: invalid prompt leaves\n\n    TypeError: step2 is not a function\n\n      117 |     // @ts-ignore - —É–±–∏—Ä–∞–µ–º ctx.message = {} as any\n      118 |\n    > 119 |     await step2(ctx, mockNext)\n          |           ^\n      120 |\n      121 |     expect(ctx.reply).toHaveBeenCalledWith('‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø—Ä–æ–º–ø—Ç')\n      122 |     expect(ctx.scene.leave).toHaveBeenCalled()\n\n      at __tests__/scenes/textToImageWizard.test.ts:119:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/textToImageWizard.test.ts:113:50)\n\n  ‚óè textToImageWizard steps ‚Ä∫ step 2: valid prompt generates image and leaves\n\n    TypeError: step2 is not a function\n\n      130 |     mockedGenerateTextToImage.mockResolvedValue(undefined)\n      131 |\n    > 132 |     await step2(ctx, mockNext)\n          |           ^\n      133 |\n      134 |     expect(mockedGenerateTextToImage).toHaveBeenCalledWith(\n      135 |       'hello',\n\n      at __tests__/scenes/textToImageWizard.test.ts:132:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/textToImageWizard.test.ts:126:68)\n","testResults":[{"ancestorTitles":["textToImageWizard steps"],"duration":1,"failureMessages":["TypeError: step0 is not a function\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/textToImageWizard.test.ts:93:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/textToImageWizard.test.ts:87:51)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"textToImageWizard steps step 0: leaves when no user ID","status":"failed","title":"step 0: leaves when no user ID"},{"ancestorTitles":["textToImageWizard steps"],"duration":0,"failureMessages":["TypeError: step0 is not a function\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/textToImageWizard.test.ts:104:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/textToImageWizard.test.ts:99:49)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"textToImageWizard steps step 0: prompts and advances","status":"failed","title":"step 0: prompts and advances"},{"ancestorTitles":["textToImageWizard steps"],"duration":1,"failureMessages":["TypeError: step2 is not a function\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/textToImageWizard.test.ts:119:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/textToImageWizard.test.ts:113:50)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"textToImageWizard steps step 2: invalid prompt leaves","status":"failed","title":"step 2: invalid prompt leaves"},{"ancestorTitles":["textToImageWizard steps"],"duration":0,"failureMessages":["TypeError: step2 is not a function\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/textToImageWizard.test.ts:132:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/textToImageWizard.test.ts:126:68)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"textToImageWizard steps step 2: valid prompt generates image and leaves","status":"failed","title":"step 2: valid prompt generates image and leaves"}]},{"numFailingTests":4,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168593462,"runtime":82,"slow":false,"start":1745168593380},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/services/createModelTraining.test.ts","failureMessage":"  ‚óè createModelTraining ‚Ä∫ posts form data to create-model-training endpoint and unlinks file\n\n    TypeError: Cannot read properties of undefined (reading 'data')\n\n      69 |\n      70 |     await fs.promises.unlink(requestData.filePath)\n    > 71 |     console.log('Model training response:', response.data)\n         |                                                      ^\n      72 |     return response.data\n      73 |   } catch (error) {\n      74 |     // if (axios.isAxiosError(error)) {\n\n      at src/services/createModelTraining.ts:71:54\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ‚óè createModelTraining ‚Ä∫ uses create-model-training-v2 for other mode\n\n    TypeError: Cannot read properties of undefined (reading 'data')\n\n      69 |\n      70 |     await fs.promises.unlink(requestData.filePath)\n    > 71 |     console.log('Model training response:', response.data)\n         |                                                      ^\n      72 |     return response.data\n      73 |   } catch (error) {\n      74 |     // if (axios.isAxiosError(error)) {\n\n      at src/services/createModelTraining.ts:71:54\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ‚óè createModelTraining ‚Ä∫ propagates axios errors and does not unlink file\n\n    expect(received).rejects.toThrow(expected)\n\n    Expected substring: \"net fail\"\n    Received message:   \"Cannot read properties of undefined (reading 'data')\"\n\n          69 |\n          70 |     await fs.promises.unlink(requestData.filePath)\n        > 71 |     console.log('Model training response:', response.data)\n             |                                                      ^\n          72 |     return response.data\n          73 |   } catch (error) {\n          74 |     // if (axios.isAxiosError(error)) {\n\n      at src/services/createModelTraining.ts:71:54\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n      at Object.toThrow (node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n      at __tests__/services/createModelTraining.test.ts:75:15\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/services/createModelTraining.test.ts:71:69)\n\n  ‚óè createModelTraining ‚Ä∫ uses ELESTIO_URL when in production mode\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"https://ele.stio/generate/create-model-training\", Any<FormData>, ObjectContaining {\"headers\": ObjectContaining {\"x-secret-key\": \"secret-key\"}}\n    Received: \"https://ele.stio/generate/create-model-training\", {\"_boundary\": \"--------------------------357793741173485996191380\", \"_currentStream\": null, \"_insideLoop\": false, \"_overheadLength\": 851, \"_pendingNext\": false, \"_released\": false, \"_streams\": [\"----------------------------357793741173485996191380¬∑\n    Content-Disposition: form-data; name=\\\"type\\\"¬∑¬∑¬∑\n    \", \"model\", [Function bound ], \"----------------------------357793741173485996191380¬∑\n    Content-Disposition: form-data; name=\\\"telegram_id\\\"¬∑¬∑¬∑\n    \", \"u\", [Function bound ], \"----------------------------357793741173485996191380¬∑\n    Content-Disposition: form-data; name=\\\"zipUrl\\\"¬∑¬∑¬∑\n    \", \"<stream>\", [Function bound ], \"----------------------------357793741173485996191380¬∑\n    Content-Disposition: form-data; name=\\\"triggerWord\\\"¬∑¬∑¬∑\n    \", ‚Ä¶], \"_valueLength\": 22, \"_valuesToMeasure\": [], \"dataSize\": 0, \"maxDataSize\": 2097152, \"pauseStreams\": true, \"readable\": true, \"writable\": false}, {\"headers\": {\"Content-Type\": \"multipart/form-data\", \"content-type\": \"multipart/form-data; boundary=--------------------------357793741173485996191380\", \"x-secret-key\": \"secret-key\"}}\n\n    Number of calls: 1\n\n      103 |     await expect(createModelTraining(req, ctxProd)).resolves.toEqual({ m: 'ok' })\n      104 |     // Assert URL called correctly\n    > 105 |     expect(axiosMock.post).toHaveBeenCalledWith(\n          |                            ^\n      106 |       'https://ele.stio/generate/create-model-training',\n      107 |       expect.any(FormData),\n      108 |       expect.objectContaining({ headers: expect.objectContaining({ 'x-secret-key': 'secret-key' }) })\n\n      at __tests__/services/createModelTraining.test.ts:105:28\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["createModelTraining"],"duration":9,"failureMessages":[],"fullName":"createModelTraining throws error if file does not exist","status":"passed","title":"throws error if file does not exist"},{"ancestorTitles":["createModelTraining"],"duration":6,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'data')\n    at /Users/playom/999-multibots-telegraf/src/services/createModelTraining.ts:71:54\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"createModelTraining posts form data to create-model-training endpoint and unlinks file","status":"failed","title":"posts form data to create-model-training endpoint and unlinks file"},{"ancestorTitles":["createModelTraining"],"duration":5,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'data')\n    at /Users/playom/999-multibots-telegraf/src/services/createModelTraining.ts:71:54\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"createModelTraining uses create-model-training-v2 for other mode","status":"failed","title":"uses create-model-training-v2 for other mode"},{"ancestorTitles":["createModelTraining"],"duration":9,"failureMessages":["Error: expect(received).rejects.toThrow(expected)\n\nExpected substring: \"net fail\"\nReceived message:   \"Cannot read properties of undefined (reading 'data')\"\n\n      69 |\n      70 |     await fs.promises.unlink(requestData.filePath)\n    > 71 |     console.log('Model training response:', response.data)\n         |                                                      ^\n      72 |     return response.data\n      73 |   } catch (error) {\n      74 |     // if (axios.isAxiosError(error)) {\n\n      at src/services/createModelTraining.ts:71:54\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at Object.toThrow (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n    at /Users/playom/999-multibots-telegraf/__tests__/services/createModelTraining.test.ts:75:15\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/services/createModelTraining.test.ts:71:69)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"createModelTraining propagates axios errors and does not unlink file","status":"failed","title":"propagates axios errors and does not unlink file"},{"ancestorTitles":["createModelTraining"],"duration":11,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"https://ele.stio/generate/create-model-training\", Any<FormData>, ObjectContaining {\"headers\": ObjectContaining {\"x-secret-key\": \"secret-key\"}}\nReceived: \"https://ele.stio/generate/create-model-training\", {\"_boundary\": \"--------------------------357793741173485996191380\", \"_currentStream\": null, \"_insideLoop\": false, \"_overheadLength\": 851, \"_pendingNext\": false, \"_released\": false, \"_streams\": [\"----------------------------357793741173485996191380¬∑\nContent-Disposition: form-data; name=\\\"type\\\"¬∑¬∑¬∑\n\", \"model\", [Function bound ], \"----------------------------357793741173485996191380¬∑\nContent-Disposition: form-data; name=\\\"telegram_id\\\"¬∑¬∑¬∑\n\", \"u\", [Function bound ], \"----------------------------357793741173485996191380¬∑\nContent-Disposition: form-data; name=\\\"zipUrl\\\"¬∑¬∑¬∑\n\", \"<stream>\", [Function bound ], \"----------------------------357793741173485996191380¬∑\nContent-Disposition: form-data; name=\\\"triggerWord\\\"¬∑¬∑¬∑\n\", ‚Ä¶], \"_valueLength\": 22, \"_valuesToMeasure\": [], \"dataSize\": 0, \"maxDataSize\": 2097152, \"pauseStreams\": true, \"readable\": true, \"writable\": false}, {\"headers\": {\"Content-Type\": \"multipart/form-data\", \"content-type\": \"multipart/form-data; boundary=--------------------------357793741173485996191380\", \"x-secret-key\": \"secret-key\"}}\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/services/createModelTraining.test.ts:105:28\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"createModelTraining uses ELESTIO_URL when in production mode","status":"failed","title":"uses ELESTIO_URL when in production mode"}]},{"numFailingTests":2,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168593549,"runtime":82,"slow":false,"start":1745168593467},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/textToSpeechWizard.test.ts","failureMessage":"  ‚óè textToSpeechWizard ‚Ä∫ step 0: prompts and calls next()\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"üéôÔ∏è –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç, –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –µ–≥–æ –≤ –≥–æ–ª–æ—Å\"\n    Received: \"üéôÔ∏è –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç, –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –µ–≥–æ –≤ –≥–æ–ª–æ—Å\", {\"reply_markup\": {\"keyboard\": [[\"–°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–µ\"], [\"–û—Ç–º–µ–Ω–∞\"]], \"resize_keyboard\": true}}\n\n    Number of calls: 1\n\n      31 |     await step0(ctx, async () => {})\n      32 |     expect(isRussianSpy).toHaveBeenCalledWith(ctx)\n    > 33 |     expect(ctx.reply).toHaveBeenCalledWith(\n         |                       ^\n      34 |       'üéôÔ∏è –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç, –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –µ–≥–æ –≤ –≥–æ–ª–æ—Å'\n      35 |     )\n      36 |   })\n\n      at __tests__/scenes/textToSpeechWizard.test.ts:33:23\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ‚óè textToSpeechWizard ‚Ä∫ step 1: no text message prompts ask\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"‚úçÔ∏è Please send text\"\n    Received: \"üéØ For correct operation, train the avatar using üé§ Voice for avatar in the main menu\"\n\n    Number of calls: 1\n\n      43 |     await step1(ctx, async () => {})\n      44 |     expect(isRussianSpy).toHaveBeenCalledWith(ctx)\n    > 45 |     expect(ctx.reply).toHaveBeenCalledWith('‚úçÔ∏è Please send text')\n         |                       ^\n      46 |   })\n      47 |\n      48 |   it('step 1: cancel leaves scene', async () => {\n\n      at __tests__/scenes/textToSpeechWizard.test.ts:45:23\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["textToSpeechWizard"],"duration":1,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"üéôÔ∏è –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç, –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –µ–≥–æ –≤ –≥–æ–ª–æ—Å\"\nReceived: \"üéôÔ∏è –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç, –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –µ–≥–æ –≤ –≥–æ–ª–æ—Å\", {\"reply_markup\": {\"keyboard\": [[\"–°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–µ\"], [\"–û—Ç–º–µ–Ω–∞\"]], \"resize_keyboard\": true}}\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/textToSpeechWizard.test.ts:33:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"textToSpeechWizard step 0: prompts and calls next()","status":"failed","title":"step 0: prompts and calls next()"},{"ancestorTitles":["textToSpeechWizard"],"duration":1,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"‚úçÔ∏è Please send text\"\nReceived: \"üéØ For correct operation, train the avatar using üé§ Voice for avatar in the main menu\"\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/textToSpeechWizard.test.ts:45:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"textToSpeechWizard step 1: no text message prompts ask","status":"failed","title":"step 1: no text message prompts ask"},{"ancestorTitles":["textToSpeechWizard"],"duration":0,"failureMessages":[],"fullName":"textToSpeechWizard step 1: cancel leaves scene","status":"passed","title":"step 1: cancel leaves scene"},{"ancestorTitles":["textToSpeechWizard"],"duration":1,"failureMessages":[],"fullName":"textToSpeechWizard step 1: no voice_id prompts training message and leaves","status":"passed","title":"step 1: no voice_id prompts training message and leaves"},{"ancestorTitles":["textToSpeechWizard"],"duration":1,"failureMessages":[],"fullName":"textToSpeechWizard step 1: generates text to speech and leaves","status":"passed","title":"step 1: generates text to speech and leaves"}]},{"numFailingTests":6,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168593630,"runtime":79,"slow":false,"start":1745168593551},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/subscriptionScene.test.ts","failureMessage":"  ‚óè subscriptionScene ‚Ä∫ step 0: displays subscription info and options\n\n    TypeError: Cannot read properties of undefined (reading 'bot_name')\n\n      72 |   const token = ctx.telegram.token\n      73 |\n    > 74 |   const botName = bot_name ? bot_name : getBotNameByToken(token).bot_name\n         |                                                                 ^\n      75 |\n      76 |   const fetchTranslation = async (name: string) => {\n      77 |     return await supabase\n\n      at src/core/supabase/getTranslation.ts:74:65\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at getTranslation (src/core/supabase/getTranslation.ts:57:20)\n      at src/scenes/subscriptionScene/index.ts:46:58\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ‚óè subscriptionScene ‚Ä∫ step 0: handles error during data fetch\n\n    TypeError: Cannot read properties of undefined (reading 'bot_name')\n\n      72 |   const token = ctx.telegram.token\n      73 |\n    > 74 |   const botName = bot_name ? bot_name : getBotNameByToken(token).bot_name\n         |                                                                 ^\n      75 |\n      76 |   const fetchTranslation = async (name: string) => {\n      77 |     return await supabase\n\n      at src/core/supabase/getTranslation.ts:74:65\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at getTranslation (src/core/supabase/getTranslation.ts:57:20)\n      at src/scenes/subscriptionScene/index.ts:46:58\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ‚óè subscriptionScene ‚Ä∫ step 1: processes valid callback data\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"neurobase\"\n    Received: \"NEUROBASE\"\n\n      63 |     const step1 = Composer.unwrap(subscriptionScene.steps[1])\n      64 |     await step1(ctx, async () => {})\n    > 65 |     expect(ctx.session.subscription).toBe('neurobase')\n         |                                      ^\n      66 |     expect(ctx.scene.enter).toHaveBeenCalledWith('paymentScene')\n      67 |   })\n      68 |\n\n      at __tests__/scenes/subscriptionScene.test.ts:65:38\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ‚óè subscriptionScene ‚Ä∫ step 1: leaves scene on mainmenu callback\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"menuScene\"\n    Received: \"main_menu\"\n\n    Number of calls: 1\n\n      75 |     const step1 = Composer.unwrap(subscriptionScene.steps[1])\n      76 |     await step1(ctx, async () => {})\n    > 77 |     expect(ctx.scene.enter).toHaveBeenCalledWith('menuScene')\n         |                             ^\n      78 |   })\n      79 |\n      80 |   it('step 1: replies on unknown callback data', async () => {\n\n      at __tests__/scenes/subscriptionScene.test.ts:77:29\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ‚óè subscriptionScene ‚Ä∫ step 1: replies on unknown callback data\n\n    expect(jest.fn()).toHaveBeenCalled()\n\n    Expected number of calls: >= 1\n    Received number of calls:    0\n\n      86 |     const step1 = Composer.unwrap(subscriptionScene.steps[1])\n      87 |     await step1(ctx, async () => {})\n    > 88 |     expect(ctx.answerCbQuery).toHaveBeenCalled()\n         |                               ^\n      89 |     expect(ctx.reply).toHaveBeenCalledWith(\n      90 |       '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –≤—ã–±–æ—Ä. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏.'\n      91 |     )\n\n      at __tests__/scenes/subscriptionScene.test.ts:88:31\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ‚óè subscriptionScene ‚Ä∫ step 1: handles message instead of callback\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"Please select a tariff using the buttons.\"\n\n    Number of calls: 0\n\n      101 |     const step1 = Composer.unwrap(subscriptionScene.steps[1])\n      102 |     await step1(ctx, async () => {})\n    > 103 |     expect(ctx.reply).toHaveBeenCalledWith(\n          |                       ^\n      104 |       'Please select a tariff using the buttons.'\n      105 |     )\n      106 |     expect(ctx.scene.leave).toHaveBeenCalled()\n\n      at __tests__/scenes/subscriptionScene.test.ts:103:23\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["subscriptionScene"],"duration":9,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'bot_name')\n    at /Users/playom/999-multibots-telegraf/src/core/supabase/getTranslation.ts:74:65\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at getTranslation (/Users/playom/999-multibots-telegraf/src/core/supabase/getTranslation.ts:57:20)\n    at /Users/playom/999-multibots-telegraf/src/scenes/subscriptionScene/index.ts:46:58\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"subscriptionScene step 0: displays subscription info and options","status":"failed","title":"step 0: displays subscription info and options"},{"ancestorTitles":["subscriptionScene"],"duration":3,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'bot_name')\n    at /Users/playom/999-multibots-telegraf/src/core/supabase/getTranslation.ts:74:65\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at getTranslation (/Users/playom/999-multibots-telegraf/src/core/supabase/getTranslation.ts:57:20)\n    at /Users/playom/999-multibots-telegraf/src/scenes/subscriptionScene/index.ts:46:58\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"subscriptionScene step 0: handles error during data fetch","status":"failed","title":"step 0: handles error during data fetch"},{"ancestorTitles":["subscriptionScene"],"duration":1,"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: \"neurobase\"\nReceived: \"NEUROBASE\"\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/subscriptionScene.test.ts:65:38\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"subscriptionScene step 1: processes valid callback data","status":"failed","title":"step 1: processes valid callback data"},{"ancestorTitles":["subscriptionScene"],"duration":1,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"menuScene\"\nReceived: \"main_menu\"\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/subscriptionScene.test.ts:77:29\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"subscriptionScene step 1: leaves scene on mainmenu callback","status":"failed","title":"step 1: leaves scene on mainmenu callback"},{"ancestorTitles":["subscriptionScene"],"duration":0,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalled()\n\nExpected number of calls: >= 1\nReceived number of calls:    0\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/subscriptionScene.test.ts:88:31\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"subscriptionScene step 1: replies on unknown callback data","status":"failed","title":"step 1: replies on unknown callback data"},{"ancestorTitles":["subscriptionScene"],"duration":4,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"Please select a tariff using the buttons.\"\n\nNumber of calls: 0\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/subscriptionScene.test.ts:103:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"subscriptionScene step 1: handles message instead of callback","status":"failed","title":"step 1: handles message instead of callback"}]},{"numFailingTests":2,"numPassingTests":7,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168593721,"runtime":89,"slow":false,"start":1745168593632},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/payments/robokassaWebhook.test.ts","failureMessage":"  ‚óè handleRobokassaWebhook ‚Ä∫ should process a valid webhook successfully\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: 200\n    Received: 500\n\n    Number of calls: 1\n\n      187 |\n      188 |     // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä—É\n    > 189 |     expect(statusSpy).toHaveBeenCalledWith(200)\n          |                       ^\n      190 |     expect(sendSpy).toHaveBeenCalledWith(`OK${validWebhookQuery.InvId}`)\n      191 |   })\n      192 |\n\n      at __tests__/payments/robokassaWebhook.test.ts:189:23\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ‚óè handleRobokassaWebhook ‚Ä∫ should handle missing shp_ parameters in query\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: 400\n    Received: 200\n\n    Number of calls: 1\n\n      410 |\n      411 |     // –û–∂–∏–¥–∞–µ–º –æ—à–∏–±–∫—É 400\n    > 412 |     expect(statusSpy).toHaveBeenCalledWith(400)\n          |                       ^\n      413 |     expect(sendSpy).toHaveBeenCalledWith('Bad Request: Missing parameters') // –û–±–Ω–æ–≤–ª–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ\n      414 |     expect(validateRobokassaSignatureMock).not.toHaveBeenCalled()\n      415 |   })\n\n      at __tests__/payments/robokassaWebhook.test.ts:412:23\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["handleRobokassaWebhook"],"duration":11,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: 200\nReceived: 500\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/payments/robokassaWebhook.test.ts:189:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"handleRobokassaWebhook should process a valid webhook successfully","status":"failed","title":"should process a valid webhook successfully"},{"ancestorTitles":["handleRobokassaWebhook"],"duration":2,"failureMessages":[],"fullName":"handleRobokassaWebhook should return 400 if signature is invalid","status":"passed","title":"should return 400 if signature is invalid"},{"ancestorTitles":["handleRobokassaWebhook"],"duration":2,"failureMessages":[],"fullName":"handleRobokassaWebhook should return 200 if payment is not found (PENDING) but COMPLETED exists","status":"passed","title":"should return 200 if payment is not found (PENDING) but COMPLETED exists"},{"ancestorTitles":["handleRobokassaWebhook"],"duration":3,"failureMessages":[],"fullName":"handleRobokassaWebhook should return 200 if payment is not found (PENDING and COMPLETED)","status":"passed","title":"should return 200 if payment is not found (PENDING and COMPLETED)"},{"ancestorTitles":["handleRobokassaWebhook"],"duration":2,"failureMessages":[],"fullName":"handleRobokassaWebhook should return 500 if database error occurs during PENDING payment fetch","status":"passed","title":"should return 500 if database error occurs during PENDING payment fetch"},{"ancestorTitles":["handleRobokassaWebhook"],"duration":4,"failureMessages":[],"fullName":"handleRobokassaWebhook should return 400 if amount mismatches","status":"passed","title":"should return 400 if amount mismatches"},{"ancestorTitles":["handleRobokassaWebhook"],"duration":3,"failureMessages":[],"fullName":"handleRobokassaWebhook should return 500 if database error occurs during payment status update","status":"passed","title":"should return 500 if database error occurs during payment status update"},{"ancestorTitles":["handleRobokassaWebhook"],"duration":7,"failureMessages":[],"fullName":"handleRobokassaWebhook should return 200 (but log CRITICAL) if database error occurs during user balance update","status":"passed","title":"should return 200 (but log CRITICAL) if database error occurs during user balance update"},{"ancestorTitles":["handleRobokassaWebhook"],"duration":2,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: 400\nReceived: 200\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/payments/robokassaWebhook.test.ts:412:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"handleRobokassaWebhook should handle missing shp_ parameters in query","status":"failed","title":"should handle missing shp_ parameters in query"}]},{"numFailingTests":5,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168593776,"runtime":51,"slow":false,"start":1745168593725},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/getSubScribeChannel.test.ts","failureMessage":"  ‚óè handlers/getSubScribeChannel ‚Ä∫ returns default channel and logs warning when ctx is falsy\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"neuro_blogger_group\"\n    Received: {Symbol(async_id_symbol): 23771, Symbol(trigger_async_id_symbol): 23759}\n\n      16 |   it('returns default channel and logs warning when ctx is falsy', () => {\n      17 |     const channel = getSubScribeChannel(null as any)\n    > 18 |     expect(channel).toBe('neuro_blogger_group')\n         |                     ^\n      19 |     expect(logger.warn).toHaveBeenCalledWith(\n      20 |       '‚ö†Ô∏è –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏–ª–∏ ID –±–æ—Ç–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–Ω–∞–ª –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é'\n      21 |     )\n\n      at Object.<anonymous> (__tests__/handlers/getSubScribeChannel.test.ts:18:21)\n\n  ‚óè handlers/getSubScribeChannel ‚Ä∫ returns default channel and logs warning when botId is missing\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"neuro_blogger_group\"\n    Received: {Symbol(async_id_symbol): 23937, Symbol(trigger_async_id_symbol): 23925}\n\n      24 |   it('returns default channel and logs warning when botId is missing', () => {\n      25 |     const channel = getSubScribeChannel({} as any)\n    > 26 |     expect(channel).toBe('neuro_blogger_group')\n         |                     ^\n      27 |     expect(logger.warn).toHaveBeenCalled()\n      28 |   })\n      29 |\n\n      at Object.<anonymous> (__tests__/handlers/getSubScribeChannel.test.ts:26:21)\n\n  ‚óè handlers/getSubScribeChannel ‚Ä∫ returns correct channel and logs debug for known botId bot2\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"MetaMuse_AI_Influencer\"\n    Received: {Symbol(async_id_symbol): 24103, Symbol(trigger_async_id_symbol): 24091}\n\n      31 |     const ctx: any = { botId: 'bot2' }\n      32 |     const channel = getSubScribeChannel(ctx)\n    > 33 |     expect(channel).toBe('MetaMuse_AI_Influencer')\n         |                     ^\n      34 |     expect(logger.debug).toHaveBeenCalledWith(\n      35 |       'üîç –î–ª—è –±–æ—Ç–∞ bot2 –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –∫–∞–Ω–∞–ª: MetaMuse_AI_Influencer'\n      36 |     )\n\n      at Object.<anonymous> (__tests__/handlers/getSubScribeChannel.test.ts:33:21)\n\n  ‚óè handlers/getSubScribeChannel ‚Ä∫ returns correct channel and logs debug for known botId bot3\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"motionly_tech\"\n    Received: {Symbol(async_id_symbol): 24269, Symbol(trigger_async_id_symbol): 24257}\n\n      40 |     const ctx: any = { botId: 'bot3' }\n      41 |     const channel = getSubScribeChannel(ctx)\n    > 42 |     expect(channel).toBe('motionly_tech')\n         |                     ^\n      43 |     expect(logger.debug).toHaveBeenCalledWith(\n      44 |       'üîç –î–ª—è –±–æ—Ç–∞ bot3 –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –∫–∞–Ω–∞–ª: motionly_tech'\n      45 |     )\n\n      at Object.<anonymous> (__tests__/handlers/getSubScribeChannel.test.ts:42:21)\n\n  ‚óè handlers/getSubScribeChannel ‚Ä∫ returns default channel and logs info when botId unknown\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"neuro_blogger_group\"\n    Received: {Symbol(async_id_symbol): 24435, Symbol(trigger_async_id_symbol): 24423}\n\n      49 |     const ctx: any = { botId: 'unknownBot' }\n      50 |     const channel = getSubScribeChannel(ctx)\n    > 51 |     expect(channel).toBe('neuro_blogger_group')\n         |                     ^\n      52 |     expect(logger.info).toHaveBeenCalledWith(\n      53 |       '‚ÑπÔ∏è –î–ª—è –±–æ—Ç–∞ unknownBot –Ω–µ –Ω–∞–π–¥–µ–Ω –∫–∞–Ω–∞–ª, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞–Ω–∞–ª –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é'\n      54 |     )\n\n      at Object.<anonymous> (__tests__/handlers/getSubScribeChannel.test.ts:51:21)\n","testResults":[{"ancestorTitles":["handlers/getSubScribeChannel"],"duration":1,"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: \"neuro_blogger_group\"\nReceived: {Symbol(async_id_symbol): 23771, Symbol(trigger_async_id_symbol): 23759}\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/handlers/getSubScribeChannel.test.ts:18:21)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"handlers/getSubScribeChannel returns default channel and logs warning when ctx is falsy","status":"failed","title":"returns default channel and logs warning when ctx is falsy"},{"ancestorTitles":["handlers/getSubScribeChannel"],"duration":1,"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: \"neuro_blogger_group\"\nReceived: {Symbol(async_id_symbol): 23937, Symbol(trigger_async_id_symbol): 23925}\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/handlers/getSubScribeChannel.test.ts:26:21)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"handlers/getSubScribeChannel returns default channel and logs warning when botId is missing","status":"failed","title":"returns default channel and logs warning when botId is missing"},{"ancestorTitles":["handlers/getSubScribeChannel"],"duration":0,"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: \"MetaMuse_AI_Influencer\"\nReceived: {Symbol(async_id_symbol): 24103, Symbol(trigger_async_id_symbol): 24091}\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/handlers/getSubScribeChannel.test.ts:33:21)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"handlers/getSubScribeChannel returns correct channel and logs debug for known botId bot2","status":"failed","title":"returns correct channel and logs debug for known botId bot2"},{"ancestorTitles":["handlers/getSubScribeChannel"],"duration":0,"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: \"motionly_tech\"\nReceived: {Symbol(async_id_symbol): 24269, Symbol(trigger_async_id_symbol): 24257}\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/handlers/getSubScribeChannel.test.ts:42:21)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"handlers/getSubScribeChannel returns correct channel and logs debug for known botId bot3","status":"failed","title":"returns correct channel and logs debug for known botId bot3"},{"ancestorTitles":["handlers/getSubScribeChannel"],"duration":1,"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: \"neuro_blogger_group\"\nReceived: {Symbol(async_id_symbol): 24435, Symbol(trigger_async_id_symbol): 24423}\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/handlers/getSubScribeChannel.test.ts:51:21)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"handlers/getSubScribeChannel returns default channel and logs info when botId unknown","status":"failed","title":"returns default channel and logs info when botId unknown"}]},{"numFailingTests":4,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168593855,"runtime":75,"slow":false,"start":1745168593780},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/sizeWizard.test.ts","failureMessage":"  ‚óè sizeWizard steps ‚Ä∫ step 0: prompts for image size and advances\n\n    TypeError: step0 is not a function\n\n      67 |     mockedIsRussian.mockReturnValueOnce(true)\n      68 |\n    > 69 |     await step0(ctx, mockNext)\n         |           ^\n      70 |\n      71 |     expect(ctx.reply).toHaveBeenCalledWith(\n      72 |       '–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:',\n\n      at __tests__/scenes/sizeWizard.test.ts:69:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/sizeWizard.test.ts:64:64)\n\n  ‚óè sizeWizard steps ‚Ä∫ step 1: leaves when no message\n\n    TypeError: step1 is not a function\n\n      82 |     // @ts-ignore - –£–±–∏—Ä–∞–µ–º ctx.message = undefined\n      83 |\n    > 84 |     await step1(ctx, mockNext)\n         |           ^\n      85 |\n      86 |     expect(mockedHandleSizeSelection).not.toHaveBeenCalled()\n      87 |     expect(ctx.scene.leave).toHaveBeenCalled()\n\n      at __tests__/scenes/sizeWizard.test.ts:84:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/sizeWizard.test.ts:78:51)\n\n  ‚óè sizeWizard steps ‚Ä∫ step 1: rejects invalid size and stays\n\n    TypeError: step1 is not a function\n\n      94 |     mockedIsRussian.mockReturnValueOnce(true)\n      95 |\n    > 96 |     await step1(ctx, mockNext)\n         |           ^\n      97 |\n      98 |     expect(ctx.reply).toHaveBeenCalledWith(\n      99 |       expect.stringContaining('–ù–µ–≤–µ—Ä–Ω—ã–π —Ä–∞–∑–º–µ—Ä')\n\n      at __tests__/scenes/sizeWizard.test.ts:96:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/sizeWizard.test.ts:90:59)\n\n  ‚óè sizeWizard steps ‚Ä∫ step 1: handles valid size and leaves\n\n    TypeError: step1 is not a function\n\n      109 |     mockedIsRussian.mockReturnValueOnce(false)\n      110 |\n    > 111 |     await step1(ctx, mockNext)\n          |           ^\n      112 |\n      113 |     expect(mockedHandleSizeSelection).toHaveBeenCalledWith(ctx, '16:9')\n      114 |     expect(ctx.scene.leave).toHaveBeenCalled()\n\n      at __tests__/scenes/sizeWizard.test.ts:111:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/sizeWizard.test.ts:105:58)\n","testResults":[{"ancestorTitles":["sizeWizard steps"],"duration":1,"failureMessages":["TypeError: step0 is not a function\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/sizeWizard.test.ts:69:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/sizeWizard.test.ts:64:64)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"sizeWizard steps step 0: prompts for image size and advances","status":"failed","title":"step 0: prompts for image size and advances"},{"ancestorTitles":["sizeWizard steps"],"duration":1,"failureMessages":["TypeError: step1 is not a function\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/sizeWizard.test.ts:84:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/sizeWizard.test.ts:78:51)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"sizeWizard steps step 1: leaves when no message","status":"failed","title":"step 1: leaves when no message"},{"ancestorTitles":["sizeWizard steps"],"duration":3,"failureMessages":["TypeError: step1 is not a function\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/sizeWizard.test.ts:96:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/sizeWizard.test.ts:90:59)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"sizeWizard steps step 1: rejects invalid size and stays","status":"failed","title":"step 1: rejects invalid size and stays"},{"ancestorTitles":["sizeWizard steps"],"duration":0,"failureMessages":["TypeError: step1 is not a function\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/sizeWizard.test.ts:111:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/sizeWizard.test.ts:105:58)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"sizeWizard steps step 1: handles valid size and leaves","status":"failed","title":"step 1: handles valid size and leaves"}]},{"numFailingTests":5,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168593921,"runtime":64,"slow":false,"start":1745168593857},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/improvePromptWizard.test.ts","failureMessage":"  ‚óè improvePromptWizard ‚Ä∫ step 0: missing ctx.from leaves scene\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"User identification error\"\n\n    Number of calls: 0\n\n      50 |     const step0 = Composer.unwrap(improvePromptWizard.steps[0])\n      51 |     await step0(ctx, async () => {})\n    > 52 |     expect(ctx.reply).toHaveBeenCalledWith('User identification error')\n         |                       ^\n      53 |     expect(ctx.scene.leave).toHaveBeenCalled()\n      54 |   })\n      55 |\n\n      at __tests__/scenes/improvePromptWizard.test.ts:52:23\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ‚óè improvePromptWizard ‚Ä∫ step 1: yes generate for neuro_photo\n\n    improvePromptWizard: –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ä–µ–∂–∏–º\n\n      153 |               break\n      154 |             default:\n    > 155 |               throw new Error(\n          |                     ^\n      156 |                 isRu\n      157 |                   ? 'improvePromptWizard: –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ä–µ–∂–∏–º'\n      158 |                   : 'improvePromptWizard: Unknown mode'\n\n      at src/scenes/improvePromptWizard/index.ts:155:21\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at src/scenes/improvePromptWizard/index.ts:65:15\n      at __tests__/scenes/improvePromptWizard.test.ts:121:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/improvePromptWizard.test.ts:110:57)\n\n  ‚óè improvePromptWizard ‚Ä∫ should navigate to menuScene if no mode in session\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"An error occurred.\"\n\n    Number of calls: 0\n\n      141 |     const step1 = Composer.unwrap(improvePromptWizard.steps[1])\n      142 |     await step1(ctx, async () => {})\n    > 143 |     expect(ctx.reply).toHaveBeenCalledWith('An error occurred.')\n          |                       ^\n      144 |     expect(ctx.scene.leave).toHaveBeenCalled()\n      145 |   })\n      146 |\n\n      at __tests__/scenes/improvePromptWizard.test.ts:143:23\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ‚óè improvePromptWizard ‚Ä∫ should navigate to menuScene if userModel not in session\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"An error occurred.\"\n\n    Number of calls: 0\n\n      155 |     const step1 = Composer.unwrap(improvePromptWizard.steps[1])\n      156 |     await step1(ctx, async () => {})\n    > 157 |     expect(ctx.reply).toHaveBeenCalledWith('An error occurred.')\n          |                       ^\n      158 |     expect(ctx.scene.leave).toHaveBeenCalled()\n      159 |   })\n      160 |\n\n      at __tests__/scenes/improvePromptWizard.test.ts:157:23\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ‚óè improvePromptWizard ‚Ä∫ should call generateImageFromPrompt for neuro_photo mode (RU)\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: {\"answerCbQuery\": [Function mockConstructor], \"answerPreCheckoutQuery\": [Function mockConstructor], \"callback_query\": undefined, \"chat\": {\"first_name\": \"Test\", \"id\": 12345, \"type\": \"private\", \"username\": \"testuser\"}, \"debug\": {\"currentScene\": \"\", \"replies\": [], \"replyMessages\": [Function replyMessages]}, \"from\": {\"first_name\": \"Test\", \"id\": 1, \"is_bot\": false, \"language_code\": \"ru\", \"username\": \"u\"}, \"match\": [Function mockConstructor], \"message\": {\"chat\": {\"first_name\": \"Test\", \"id\": 12345, \"type\": \"private\", \"username\": \"testuser\"}, \"date\": 1745168593.918, \"from\": {\"first_name\": \"Test\", \"id\": 1, \"is_bot\": false, \"language_code\": \"ru\", \"username\": \"u\"}, \"message_id\": 1, \"text\": \"any\"}, \"reply\": [Function mockConstructor], \"replyWithInvoice\": [Function mockConstructor], \"replyWithPhoto\": [Function mockConstructor], \"scene\": {\"enter\": [Function mockConstructor], \"leave\": [Function mockConstructor], \"reenter\": [Function mockConstructor], \"session\": {\"state\": {}}}, \"session\": {\"mode\": \"neuro_photo_v2\", \"prompt\": \"pr\", \"userModel\": {\"model_name\": \"test_model\", \"model_url\": \"a/b:c\", \"trigger_word\": \"test_trigger\"}}, \"telegram\": {\"callApi\": [Function mockConstructor], \"sendChatAction\": [Function mockConstructor], \"sendMessage\": [Function mockConstructor], \"token\": \"mock_token\"}, \"update\": {\"message\": {\"chat\": {\"first_name\": \"Test\", \"id\": 12345, \"type\": \"private\", \"username\": \"testuser\"}, \"date\": 1745168593.918, \"from\": {\"first_name\": \"Test\", \"id\": 1, \"is_bot\": false, \"language_code\": \"ru\", \"username\": \"u\"}, \"message_id\": 1, \"text\": \"any\"}, \"update_id\": 1}, \"wizard\": {\"back\": [Function mockConstructor], \"cursor\": 0, \"next\": [Function mockConstructor], \"state\": {}, \"steps\": []}}, \"a/b:c\", \"pr\", true\n\n    Number of calls: 0\n\n      172 |     const step1 = Composer.unwrap(improvePromptWizard.steps[1])\n      173 |     await step1(ctx, async () => {})\n    > 174 |     expect(generateImageFromPrompt).toHaveBeenCalledWith(\n          |                                     ^\n      175 |       ctx,\n      176 |       'a/b:c',\n      177 |       'pr',\n\n      at __tests__/scenes/improvePromptWizard.test.ts:174:37\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["improvePromptWizard"],"duration":5,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"User identification error\"\n\nNumber of calls: 0\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/improvePromptWizard.test.ts:52:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"improvePromptWizard step 0: missing ctx.from leaves scene","status":"failed","title":"step 0: missing ctx.from leaves scene"},{"ancestorTitles":["improvePromptWizard"],"duration":1,"failureMessages":[],"fullName":"improvePromptWizard step 0: upgradePrompt fails -> failure message and leave","status":"passed","title":"step 0: upgradePrompt fails -> failure message and leave"},{"ancestorTitles":["improvePromptWizard"],"duration":0,"failureMessages":[],"fullName":"improvePromptWizard step 0: upgradePrompt succeeds -> reply improved and next","status":"passed","title":"step 0: upgradePrompt succeeds -> reply improved and next"},{"ancestorTitles":["improvePromptWizard"],"duration":1,"failureMessages":[],"fullName":"improvePromptWizard step 1: no message leaves scene","status":"passed","title":"step 1: no message leaves scene"},{"ancestorTitles":["improvePromptWizard"],"duration":1,"failureMessages":[],"fullName":"improvePromptWizard step 1: cancel case","status":"passed","title":"step 1: cancel case"},{"ancestorTitles":["improvePromptWizard"],"duration":0,"failureMessages":["Error: improvePromptWizard: –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ä–µ–∂–∏–º\n    at /Users/playom/999-multibots-telegraf/src/scenes/improvePromptWizard/index.ts:155:21\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at /Users/playom/999-multibots-telegraf/src/scenes/improvePromptWizard/index.ts:65:15\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/improvePromptWizard.test.ts:121:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/improvePromptWizard.test.ts:110:57)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"improvePromptWizard step 1: yes generate for neuro_photo","status":"failed","title":"step 1: yes generate for neuro_photo"},{"ancestorTitles":["improvePromptWizard"],"duration":1,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"An error occurred.\"\n\nNumber of calls: 0\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/improvePromptWizard.test.ts:143:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"improvePromptWizard should navigate to menuScene if no mode in session","status":"failed","title":"should navigate to menuScene if no mode in session"},{"ancestorTitles":["improvePromptWizard"],"duration":0,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"An error occurred.\"\n\nNumber of calls: 0\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/improvePromptWizard.test.ts:157:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"improvePromptWizard should navigate to menuScene if userModel not in session","status":"failed","title":"should navigate to menuScene if userModel not in session"},{"ancestorTitles":["improvePromptWizard"],"duration":1,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: {\"answerCbQuery\": [Function mockConstructor], \"answerPreCheckoutQuery\": [Function mockConstructor], \"callback_query\": undefined, \"chat\": {\"first_name\": \"Test\", \"id\": 12345, \"type\": \"private\", \"username\": \"testuser\"}, \"debug\": {\"currentScene\": \"\", \"replies\": [], \"replyMessages\": [Function replyMessages]}, \"from\": {\"first_name\": \"Test\", \"id\": 1, \"is_bot\": false, \"language_code\": \"ru\", \"username\": \"u\"}, \"match\": [Function mockConstructor], \"message\": {\"chat\": {\"first_name\": \"Test\", \"id\": 12345, \"type\": \"private\", \"username\": \"testuser\"}, \"date\": 1745168593.918, \"from\": {\"first_name\": \"Test\", \"id\": 1, \"is_bot\": false, \"language_code\": \"ru\", \"username\": \"u\"}, \"message_id\": 1, \"text\": \"any\"}, \"reply\": [Function mockConstructor], \"replyWithInvoice\": [Function mockConstructor], \"replyWithPhoto\": [Function mockConstructor], \"scene\": {\"enter\": [Function mockConstructor], \"leave\": [Function mockConstructor], \"reenter\": [Function mockConstructor], \"session\": {\"state\": {}}}, \"session\": {\"mode\": \"neuro_photo_v2\", \"prompt\": \"pr\", \"userModel\": {\"model_name\": \"test_model\", \"model_url\": \"a/b:c\", \"trigger_word\": \"test_trigger\"}}, \"telegram\": {\"callApi\": [Function mockConstructor], \"sendChatAction\": [Function mockConstructor], \"sendMessage\": [Function mockConstructor], \"token\": \"mock_token\"}, \"update\": {\"message\": {\"chat\": {\"first_name\": \"Test\", \"id\": 12345, \"type\": \"private\", \"username\": \"testuser\"}, \"date\": 1745168593.918, \"from\": {\"first_name\": \"Test\", \"id\": 1, \"is_bot\": false, \"language_code\": \"ru\", \"username\": \"u\"}, \"message_id\": 1, \"text\": \"any\"}, \"update_id\": 1}, \"wizard\": {\"back\": [Function mockConstructor], \"cursor\": 0, \"next\": [Function mockConstructor], \"state\": {}, \"steps\": []}}, \"a/b:c\", \"pr\", true\n\nNumber of calls: 0\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/improvePromptWizard.test.ts:174:37\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"improvePromptWizard should call generateImageFromPrompt for neuro_photo mode (RU)","status":"failed","title":"should call generateImageFromPrompt for neuro_photo mode (RU)"}]},{"numFailingTests":1,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168593993,"runtime":67,"slow":false,"start":1745168593926},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/services/generateNeuroImage.prod.test.ts","failureMessage":"  ‚óè generateNeuroImage production branch ‚Ä∫ uses ELESTIO_URL when isDev is false\n\n    expect(received).toEqual(expected) // deep equality\n\n    Expected: {\"data\": \"prodOK\"}\n    Received: null\n\n      20 |     const ctx = { session: { prompt: 'p', userModel: 'm' }, from: { username: 'u' }, reply: jest.fn() }\n      21 |     const res = await generateNeuroImage('prompt', 'modelUrl', 1, 'tid', ctx, 'bot')\n    > 22 |     expect(res).toEqual({ data: 'prodOK' })\n         |                 ^\n      23 |     expect(axios.post).toHaveBeenCalledWith(\n      24 |       'https://api.example.com/generate/neuro-photo',\n      25 |       expect.any(Object),\n\n      at Object.<anonymous> (__tests__/services/generateNeuroImage.prod.test.ts:22:17)\n      at fulfilled (__tests__/services/generateNeuroImage.prod.test.ts:4:58)\n","testResults":[{"ancestorTitles":["generateNeuroImage production branch"],"duration":15,"failureMessages":["Error: expect(received).toEqual(expected) // deep equality\n\nExpected: {\"data\": \"prodOK\"}\nReceived: null\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/services/generateNeuroImage.prod.test.ts:22:17)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/__tests__/services/generateNeuroImage.prod.test.ts:4:58)"],"fullName":"generateNeuroImage production branch uses ELESTIO_URL when isDev is false","status":"failed","title":"uses ELESTIO_URL when isDev is false"}]},{"numFailingTests":2,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168594062,"runtime":67,"slow":false,"start":1745168593995},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/elevenlabs/index.test.ts","failureMessage":"  ‚óè core/elevenlabs client creation ‚Ä∫ uses real client when API key is set and module exists\n\n    expect(received).toBeInstanceOf(expected)\n\n    Expected constructor: RealClient\n    Received constructor: ElevenLabsClient\n\n      23 |     jest.mock('elevenlabs', () => ({ ElevenLabsClient: RealClient }), { virtual: true })\n      24 |     const { elevenlabs } = require('@/core/elevenlabs')\n    > 25 |     expect(elevenlabs).toBeInstanceOf(RealClient)\n         |                        ^\n      26 |   })\n      27 |\n      28 |   it('falls back to mock client when real client creation throws', () => {\n\n      at Object.<anonymous> (__tests__/core/elevenlabs/index.test.ts:25:24)\n\n  ‚óè core/elevenlabs client creation ‚Ä∫ falls back to mock client when real client creation throws\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"function\"\n    Received: \"undefined\"\n\n      33 |     const { elevenlabs } = require('@/core/elevenlabs')\n      34 |     expect(elevenlabs).toBeDefined()\n    > 35 |     expect(typeof elevenlabs.getVoices).toBe('function')\n         |                                         ^\n      36 |     expect(errorSpy).toHaveBeenCalledWith(\n      37 |       'Error creating ElevenLabs client, falling back to mock:',\n      38 |       expect.any(Error)\n\n      at Object.<anonymous> (__tests__/core/elevenlabs/index.test.ts:35:41)\n","testResults":[{"ancestorTitles":["core/elevenlabs client creation"],"duration":1,"failureMessages":[],"fullName":"core/elevenlabs client creation uses mock client when API key is not set","status":"passed","title":"uses mock client when API key is not set"},{"ancestorTitles":["core/elevenlabs client creation"],"duration":17,"failureMessages":["Error: expect(received).toBeInstanceOf(expected)\n\nExpected constructor: RealClient\nReceived constructor: ElevenLabsClient\n\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/elevenlabs/index.test.ts:25:24)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"core/elevenlabs client creation uses real client when API key is set and module exists","status":"failed","title":"uses real client when API key is set and module exists"},{"ancestorTitles":["core/elevenlabs client creation"],"duration":21,"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: \"function\"\nReceived: \"undefined\"\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/elevenlabs/index.test.ts:35:41)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"core/elevenlabs client creation falls back to mock client when real client creation throws","status":"failed","title":"falls back to mock client when real client creation throws"}]},{"numFailingTests":3,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168594135,"runtime":71,"slow":false,"start":1745168594064},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getReferalsCountAndUserData.test.ts","failureMessage":"  ‚óè getReferalsCountAndUserData ‚Ä∫ returns default when user lookup fails\n\n    expect(received).toEqual(expected) // deep equality\n\n    - Expected  - 1\n    + Received  + 1\n\n      Object {\n        \"count\": 0,\n        \"isExist\": false,\n        \"level\": 0,\n    -   \"subscription\": \"stars\",\n    +   \"subscriptionType\": \"stars\",\n        \"userData\": null,\n      }\n\n      30 |     mockBuilderUser.single.mockResolvedValue({ data: null, error: { message: 'fail' } })\n      31 |     const res = await getReferalsCountAndUserData(telegram_id)\n    > 32 |     expect(res).toEqual({ count: 0, subscription: 'stars', level: 0, userData: null, isExist: false })\n         |                 ^\n      33 |   })\n      34 |\n      35 |   it('returns default when referral query errors', async () => {\n\n      at Object.<anonymous> (__tests__/core/supabase/getReferalsCountAndUserData.test.ts:32:17)\n      at fulfilled (__tests__/core/supabase/getReferalsCountAndUserData.test.ts:4:58)\n\n  ‚óè getReferalsCountAndUserData ‚Ä∫ returns default when referral query errors\n\n    expect(received).toEqual(expected) // deep equality\n\n    - Expected  - 4\n    + Received  + 8\n\n      Object {\n        \"count\": 0,\n    -   \"isExist\": false,\n    -   \"level\": 0,\n    -   \"subscription\": \"stars\",\n    -   \"userData\": null,\n    +   \"isExist\": true,\n    +   \"level\": 5,\n    +   \"subscriptionType\": \"stars\",\n    +   \"userData\": Object {\n    +     \"level\": 5,\n    +     \"subscription\": \"premium\",\n    +     \"user_id\": \"u1\",\n    +   },\n      }\n\n      39 |     mockBuilderRef.eq.mockReturnValue(Promise.resolve({ data: null, error: { message: 'fail' } }))\n      40 |     const res = await getReferalsCountAndUserData(telegram_id)\n    > 41 |     expect(res).toEqual({ count: 0, subscription: 'stars', level: 0, userData: null, isExist: false })\n         |                 ^\n      42 |   })\n      43 |\n      44 |   it('returns correct count and user data on success', async () => {\n\n      at Object.<anonymous> (__tests__/core/supabase/getReferalsCountAndUserData.test.ts:41:17)\n      at fulfilled (__tests__/core/supabase/getReferalsCountAndUserData.test.ts:4:58)\n\n  ‚óè getReferalsCountAndUserData ‚Ä∫ returns correct count and user data on success\n\n    expect(received).toEqual(expected) // deep equality\n\n    - Expected  - 1\n    + Received  + 1\n\n    @@ -1,10 +1,10 @@\n      Object {\n        \"count\": 2,\n        \"isExist\": true,\n        \"level\": 5,\n    -   \"subscription\": \"premium\",\n    +   \"subscriptionType\": \"stars\",\n        \"userData\": Object {\n          \"level\": 5,\n          \"subscription\": \"premium\",\n          \"user_id\": \"u1\",\n        },\n\n      46 |     mockBuilderRef.eq.mockReturnValue(Promise.resolve({ data: refs, error: null }))\n      47 |     const res = await getReferalsCountAndUserData(telegram_id)\n    > 48 |     expect(res).toEqual({\n         |                 ^\n      49 |       count: refs.length,\n      50 |       level: userData.level,\n      51 |       subscription: userData.subscription,\n\n      at Object.<anonymous> (__tests__/core/supabase/getReferalsCountAndUserData.test.ts:48:17)\n      at fulfilled (__tests__/core/supabase/getReferalsCountAndUserData.test.ts:4:58)\n","testResults":[{"ancestorTitles":["getReferalsCountAndUserData"],"duration":9,"failureMessages":["Error: expect(received).toEqual(expected) // deep equality\n\n- Expected  - 1\n+ Received  + 1\n\n  Object {\n    \"count\": 0,\n    \"isExist\": false,\n    \"level\": 0,\n-   \"subscription\": \"stars\",\n+   \"subscriptionType\": \"stars\",\n    \"userData\": null,\n  }\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getReferalsCountAndUserData.test.ts:32:17)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getReferalsCountAndUserData.test.ts:4:58)"],"fullName":"getReferalsCountAndUserData returns default when user lookup fails","status":"failed","title":"returns default when user lookup fails"},{"ancestorTitles":["getReferalsCountAndUserData"],"duration":13,"failureMessages":["Error: expect(received).toEqual(expected) // deep equality\n\n- Expected  - 4\n+ Received  + 8\n\n  Object {\n    \"count\": 0,\n-   \"isExist\": false,\n-   \"level\": 0,\n-   \"subscription\": \"stars\",\n-   \"userData\": null,\n+   \"isExist\": true,\n+   \"level\": 5,\n+   \"subscriptionType\": \"stars\",\n+   \"userData\": Object {\n+     \"level\": 5,\n+     \"subscription\": \"premium\",\n+     \"user_id\": \"u1\",\n+   },\n  }\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getReferalsCountAndUserData.test.ts:41:17)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getReferalsCountAndUserData.test.ts:4:58)"],"fullName":"getReferalsCountAndUserData returns default when referral query errors","status":"failed","title":"returns default when referral query errors"},{"ancestorTitles":["getReferalsCountAndUserData"],"duration":17,"failureMessages":["Error: expect(received).toEqual(expected) // deep equality\n\n- Expected  - 1\n+ Received  + 1\n\n@@ -1,10 +1,10 @@\n  Object {\n    \"count\": 2,\n    \"isExist\": true,\n    \"level\": 5,\n-   \"subscription\": \"premium\",\n+   \"subscriptionType\": \"stars\",\n    \"userData\": Object {\n      \"level\": 5,\n      \"subscription\": \"premium\",\n      \"user_id\": \"u1\",\n    },\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getReferalsCountAndUserData.test.ts:48:17)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getReferalsCountAndUserData.test.ts:4:58)"],"fullName":"getReferalsCountAndUserData returns correct count and user data on success","status":"failed","title":"returns correct count and user data on success"}]},{"numFailingTests":1,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168594195,"runtime":58,"slow":false,"start":1745168594137},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/setupLevelHandlers.test.ts","failureMessage":"  ‚óè setupLevelHandlers ‚Ä∫ registers 12 actions for levels and completion\n\n    expect(jest.fn()).toHaveBeenCalledTimes(expected)\n\n    Expected number of calls: 12\n    Received number of calls: 14\n\n      25 |       'level_complete',\n      26 |     ]\n    > 27 |     expect(bot.action).toHaveBeenCalledTimes(expectedActions.length)\n         |                        ^\n      28 |     expectedActions.forEach((action, idx) => {\n      29 |       expect(bot.action).toHaveBeenNthCalledWith(\n      30 |         idx + 1,\n\n      at Object.<anonymous> (__tests__/handlers/setupLevelHandlers.test.ts:27:24)\n","testResults":[{"ancestorTitles":["setupLevelHandlers"],"duration":0,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledTimes(expected)\n\nExpected number of calls: 12\nReceived number of calls: 14\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/handlers/setupLevelHandlers.test.ts:27:24)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"setupLevelHandlers registers 12 actions for levels and completion","status":"failed","title":"registers 12 actions for levels and completion"}]},{"numFailingTests":3,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168594252,"runtime":55,"slow":false,"start":1745168594197},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/sendPaymentInfo.test.ts","failureMessage":"  ‚óè sendPaymentInfo ‚Ä∫ returns data when insert succeeds\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"payments\"\n    Received: \"payments_v2\"\n\n    Number of calls: 1\n\n      32 |     builder.single.mockResolvedValueOnce({ data: dataObj, error: null })\n      33 |     const result = await sendPaymentInfo('u1', 'gold')\n    > 34 |     expect(mockFrom).toHaveBeenCalledWith('payments')\n         |                      ^\n      35 |     expect(builder.insert).toHaveBeenCalledWith([{ user_id: 'u1', level: 'gold' }])\n      36 |     expect(builder.single).toHaveBeenCalled()\n      37 |     expect(consoleLog).toHaveBeenCalledWith('Payment info sent successfully:', dataObj)\n\n      at Object.<anonymous> (__tests__/core/supabase/sendPaymentInfo.test.ts:34:22)\n      at fulfilled (__tests__/core/supabase/sendPaymentInfo.test.ts:4:58)\n\n  ‚óè sendPaymentInfo ‚Ä∫ throws error when insert returns error\n\n    expect(received).rejects.toThrow()\n\n    Received promise resolved instead of rejected\n    Resolved to value: false\n\n      42 |     const err = new Error('insert fail')\n      43 |     builder.single.mockResolvedValueOnce({ data: null, error: err })\n    > 44 |     await expect(sendPaymentInfo('u2', 'silver')).rejects.toThrow(\n         |           ^\n      45 |       `Failed to send payment info: ${err.message}`\n      46 |     )\n      47 |     expect(consoleError).toHaveBeenCalledWith('Error sending payment info:', err)\n\n      at expect (node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:113:15)\n      at Object.<anonymous> (__tests__/core/supabase/sendPaymentInfo.test.ts:44:11)\n      at __tests__/core/supabase/sendPaymentInfo.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/core/supabase/sendPaymentInfo.test.ts:3:12)\n      at Object.<anonymous> (__tests__/core/supabase/sendPaymentInfo.test.ts:41:59)\n\n  ‚óè sendPaymentInfo ‚Ä∫ throws error when no data returned\n\n    expect(received).rejects.toThrow()\n\n    Received promise resolved instead of rejected\n    Resolved to value: false\n\n      50 |   it('throws error when no data returned', async () => {\n      51 |     builder.single.mockResolvedValueOnce({ data: null, error: null })\n    > 52 |     await expect(sendPaymentInfo('u3', 'bronze')).rejects.toThrow(\n         |           ^\n      53 |       'No data returned after inserting payment info.'\n      54 |     )\n      55 |   })\n\n      at expect (node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:113:15)\n      at Object.<anonymous> (__tests__/core/supabase/sendPaymentInfo.test.ts:52:11)\n      at __tests__/core/supabase/sendPaymentInfo.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/core/supabase/sendPaymentInfo.test.ts:3:12)\n      at Object.<anonymous> (__tests__/core/supabase/sendPaymentInfo.test.ts:50:55)\n","testResults":[{"ancestorTitles":["sendPaymentInfo"],"duration":12,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"payments\"\nReceived: \"payments_v2\"\n\nNumber of calls: 1\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/sendPaymentInfo.test.ts:34:22)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/sendPaymentInfo.test.ts:4:58)"],"fullName":"sendPaymentInfo returns data when insert succeeds","status":"failed","title":"returns data when insert succeeds"},{"ancestorTitles":["sendPaymentInfo"],"duration":11,"failureMessages":["Error: expect(received).rejects.toThrow()\n\nReceived promise resolved instead of rejected\nResolved to value: false\n    at expect (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:113:15)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/sendPaymentInfo.test.ts:44:11)\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/sendPaymentInfo.test.ts:7:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/sendPaymentInfo.test.ts:3:12)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/sendPaymentInfo.test.ts:41:59)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"sendPaymentInfo throws error when insert returns error","status":"failed","title":"throws error when insert returns error"},{"ancestorTitles":["sendPaymentInfo"],"duration":8,"failureMessages":["Error: expect(received).rejects.toThrow()\n\nReceived promise resolved instead of rejected\nResolved to value: false\n    at expect (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:113:15)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/sendPaymentInfo.test.ts:52:11)\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/sendPaymentInfo.test.ts:7:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/sendPaymentInfo.test.ts:3:12)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/sendPaymentInfo.test.ts:50:55)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"sendPaymentInfo throws error when no data returned","status":"failed","title":"throws error when no data returned"}]},{"numFailingTests":10,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168594302,"runtime":44,"slow":false,"start":1745168594258},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts","failureMessage":"  ‚óè checkPaymentStatus ‚Ä∫ returns false if ctx or ctx.from.id is missing\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: false\n    Received: null\n\n      69 |   it('returns false if ctx or ctx.from.id is missing', async () => {\n      70 |     const result = await checkPaymentStatus({}, 'basic')\n    > 71 |     expect(result).toBe(false)\n         |                    ^\n      72 |   })\n      73 |\n      74 |   it('returns false when payment query errors', async () => {\n\n      at Object.<anonymous> (__tests__/core/supabase/checkPaymentStatus.test.ts:71:20)\n      at fulfilled (__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)\n\n  ‚óè checkPaymentStatus ‚Ä∫ returns false when payment query errors\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"payments\"\n\n    Number of calls: 0\n\n      75 |     mockSinglePayments.mockResolvedValueOnce({ data: null, error: new Error('fail') })\n      76 |     const result = await checkPaymentStatus(ctx, 'basic')\n    > 77 |     expect(mockFromPayments).toHaveBeenCalledWith('payments')\n         |                              ^\n      78 |     expect(result).toBe(false)\n      79 |   })\n      80 |\n\n      at Object.<anonymous> (__tests__/core/supabase/checkPaymentStatus.test.ts:77:30)\n      at fulfilled (__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)\n\n  ‚óè checkPaymentStatus ‚Ä∫ returns true and updates subscription when last payment older than 30 days\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: true\n    Received: null\n\n      84 |     mockSinglePayments.mockResolvedValueOnce({ data: { payment_date: oldDate }, error: null })\n      85 |     const result = await checkPaymentStatus(ctx, 'basic')\n    > 86 |     expect(result).toBe(true)\n         |                    ^\n      87 |     expect(mockFromUsers).toHaveBeenCalledWith('users')\n      88 |     expect(mockUpdateUsers).toHaveBeenCalledWith({ subscription: 'stars' })\n      89 |     expect(mockEqUsers).toHaveBeenCalledWith('telegram_id', '42')\n\n      at Object.<anonymous> (__tests__/core/supabase/checkPaymentStatus.test.ts:86:20)\n      at fulfilled (__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)\n\n  ‚óè checkPaymentStatus ‚Ä∫ returns false and replies when last payment within 30 days and full access\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: false\n    Received: null\n\n       97 |     process.env.NODE_ENV = 'production'\n       98 |     const result = await checkPaymentStatus(ctx, 'basic')\n    >  99 |     expect(result).toBe(false)\n          |                    ^\n      100 |     expect(ctx.reply).toHaveBeenCalled()\n      101 |   })\n      102 |   \n\n      at Object.<anonymous> (__tests__/core/supabase/checkPaymentStatus.test.ts:99:20)\n      at fulfilled (__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)\n\n  ‚óè checkPaymentStatus ‚Ä∫ replies English message when subscription expired and not Russian\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"ü§ëYour subscription has expired. Please update your subscription to continue using the service.\"\n\n    Number of calls: 0\n\n      112 |     process.env.NODE_ENV = 'production'\n      113 |     await checkPaymentStatus(ctx, 'basic')\n    > 114 |     expect(ctx.reply).toHaveBeenCalledWith(\n          |                       ^\n      115 |       'ü§ëYour subscription has expired. Please update your subscription to continue using the service.'\n      116 |     )\n      117 |   })\n\n      at Object.<anonymous> (__tests__/core/supabase/checkPaymentStatus.test.ts:114:23)\n      at fulfilled (__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)\n\n  ‚óè checkPaymentStatus ‚Ä∫ returns true and updates when recent payment but no full access\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: true\n    Received: null\n\n      125 |     cf.mockReturnValue(false)\n      126 |     const result = await checkPaymentStatus(ctx, 'basic')\n    > 127 |     expect(result).toBe(true)\n          |                    ^\n      128 |     expect(mockFromUsers).toHaveBeenCalledWith('users')\n      129 |     expect(mockUpdateUsers).toHaveBeenCalledWith({ subscription: 'stars' })\n      130 |   })\n\n      at Object.<anonymous> (__tests__/core/supabase/checkPaymentStatus.test.ts:127:20)\n      at fulfilled (__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)\n\n  ‚óè checkPaymentStatus ‚Ä∫ returns false without reply when in development environment\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: false\n    Received: null\n\n      140 |     process.env.NODE_ENV = 'development'\n      141 |     const result = await checkPaymentStatus(ctx, 'basic')\n    > 142 |     expect(result).toBe(false)\n          |                    ^\n      143 |     // Reply should NOT be called in dev\n      144 |     expect(ctx.reply).not.toHaveBeenCalled()\n      145 |   })\n\n      at Object.<anonymous> (__tests__/core/supabase/checkPaymentStatus.test.ts:142:20)\n      at fulfilled (__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)\n\n  ‚óè checkPaymentStatus ‚Ä∫ does not reply when subscription is neurotester\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: false\n    Received: null\n\n      155 |     process.env.NODE_ENV = 'production'\n      156 |     const result = await checkPaymentStatus(ctx, 'neurotester')\n    > 157 |     expect(result).toBe(false)\n          |                    ^\n      158 |     // Should not reply for 'neurotester'\n      159 |     expect(ctx.reply).not.toHaveBeenCalled()\n      160 |   })\n\n      at Object.<anonymous> (__tests__/core/supabase/checkPaymentStatus.test.ts:157:20)\n      at fulfilled (__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)\n\n  ‚óè checkPaymentStatus ‚Ä∫ logs error and returns true when updateError present\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: true\n    Received: null\n\n      168 |     const errorSpy = jest.spyOn(console, 'error').mockImplementation(() => {})\n      169 |     const result = await checkPaymentStatus(ctx, 'basic')\n    > 170 |     expect(result).toBe(true)\n          |                    ^\n      171 |     expect(errorSpy).toHaveBeenCalledWith(\n      172 |       '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —É—Ä–æ–≤–Ω—è –ø–æ–¥–ø–∏—Å–∫–∏:',\n      173 |       expect.any(Error)\n\n      at Object.<anonymous> (__tests__/core/supabase/checkPaymentStatus.test.ts:170:20)\n      at fulfilled (__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)\n\n  ‚óè checkPaymentStatus ‚Ä∫ logs error and returns false when update throws exception\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: false\n    Received: null\n\n      184 |     const errorSpy = jest.spyOn(console, 'error').mockImplementation(() => {})\n      185 |     const result = await checkPaymentStatus(ctx, 'basic')\n    > 186 |     expect(result).toBe(false)\n          |                    ^\n      187 |     expect(errorSpy).toHaveBeenCalledWith('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å—Ç–∞—Ç—É—Å–∞ –æ–ø–ª–∞—Ç—ã:', expect.any(Error))\n      188 |     errorSpy.mockRestore()\n      189 |   })\n\n      at Object.<anonymous> (__tests__/core/supabase/checkPaymentStatus.test.ts:186:20)\n      at fulfilled (__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)\n","testResults":[{"ancestorTitles":["checkPaymentStatus"],"duration":2,"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: false\nReceived: null\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:71:20)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)"],"fullName":"checkPaymentStatus returns false if ctx or ctx.from.id is missing","status":"failed","title":"returns false if ctx or ctx.from.id is missing"},{"ancestorTitles":["checkPaymentStatus"],"duration":1,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"payments\"\n\nNumber of calls: 0\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:77:30)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)"],"fullName":"checkPaymentStatus returns false when payment query errors","status":"failed","title":"returns false when payment query errors"},{"ancestorTitles":["checkPaymentStatus"],"duration":5,"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: true\nReceived: null\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:86:20)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)"],"fullName":"checkPaymentStatus returns true and updates subscription when last payment older than 30 days","status":"failed","title":"returns true and updates subscription when last payment older than 30 days"},{"ancestorTitles":["checkPaymentStatus"],"duration":1,"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: false\nReceived: null\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:99:20)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)"],"fullName":"checkPaymentStatus returns false and replies when last payment within 30 days and full access","status":"failed","title":"returns false and replies when last payment within 30 days and full access"},{"ancestorTitles":["checkPaymentStatus"],"duration":1,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"ü§ëYour subscription has expired. Please update your subscription to continue using the service.\"\n\nNumber of calls: 0\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:114:23)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)"],"fullName":"checkPaymentStatus replies English message when subscription expired and not Russian","status":"failed","title":"replies English message when subscription expired and not Russian"},{"ancestorTitles":["checkPaymentStatus"],"duration":0,"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: true\nReceived: null\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:127:20)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)"],"fullName":"checkPaymentStatus returns true and updates when recent payment but no full access","status":"failed","title":"returns true and updates when recent payment but no full access"},{"ancestorTitles":["checkPaymentStatus"],"duration":0,"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: false\nReceived: null\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:142:20)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)"],"fullName":"checkPaymentStatus returns false without reply when in development environment","status":"failed","title":"returns false without reply when in development environment"},{"ancestorTitles":["checkPaymentStatus"],"duration":1,"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: false\nReceived: null\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:157:20)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)"],"fullName":"checkPaymentStatus does not reply when subscription is neurotester","status":"failed","title":"does not reply when subscription is neurotester"},{"ancestorTitles":["checkPaymentStatus"],"duration":1,"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: true\nReceived: null\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:170:20)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)"],"fullName":"checkPaymentStatus logs error and returns true when updateError present","status":"failed","title":"logs error and returns true when updateError present"},{"ancestorTitles":["checkPaymentStatus"],"duration":1,"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: false\nReceived: null\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:186:20)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)"],"fullName":"checkPaymentStatus logs error and returns false when update throws exception","status":"failed","title":"logs error and returns false when update throws exception"}]},{"numFailingTests":4,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168594357,"runtime":54,"slow":false,"start":1745168594303},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserBalance.test.ts","failureMessage":"  ‚óè getUserBalance ‚Ä∫ should return balance for existing user\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 100\n    Received: 0\n\n      43 |\n      44 |     const balance = await getUserBalance('99')\n    > 45 |     expect(balance).toBe(100)\n         |                     ^\n      46 |     expect(mockedFrom).toHaveBeenCalledWith('users')\n      47 |     // –ò—Å–ø–æ–ª—å–∑—É–µ–º as any –¥–ª—è –æ–±—Ö–æ–¥–∞ –æ—à–∏–±–∫–∏ —Ç–∏–ø–∞\n      48 |     expect((mockedFrom('users') as any).select).toHaveBeenCalledWith('balance') \n\n      at __tests__/core/supabase/getUserBalance.test.ts:45:21\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ‚óè getUserBalance ‚Ä∫ should return 0 if user has no balance field (or null)\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"telegram_id\", \"55\"\n\n    Number of calls: 0\n\n      56 |     const balance = await getUserBalance('55')\n      57 |     expect(balance).toBe(0)\n    > 58 |     expect(mockSelectReturn.eq).toHaveBeenCalledWith('telegram_id', '55')\n         |                                 ^\n      59 |   })\n      60 |\n      61 |   it('should throw error if user not found', async () => {\n\n      at __tests__/core/supabase/getUserBalance.test.ts:58:33\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ‚óè getUserBalance ‚Ä∫ should throw error if user not found\n\n    expect(received).rejects.toThrow()\n\n    Received promise resolved instead of rejected\n    Resolved to value: 0\n\n      62 |     mockEqReturn.single.mockResolvedValue({ data: null, error: null })\n      63 |\n    > 64 |     await expect(getUserBalance('1')).rejects.toThrow('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω')\n         |                 ^\n      65 |     expect(mockSelectReturn.eq).toHaveBeenCalledWith('telegram_id', '1')\n      66 |   })\n      67 |\n\n      at expect (node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:113:15)\n      at __tests__/core/supabase/getUserBalance.test.ts:64:17\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/core/supabase/getUserBalance.test.ts:61:57)\n\n  ‚óè getUserBalance ‚Ä∫ should throw error if supabase query fails\n\n    expect(received).rejects.toThrow()\n\n    Received promise resolved instead of rejected\n    Resolved to value: 0\n\n      70 |     mockEqReturn.single.mockResolvedValue({ data: null, error })\n      71 |\n    > 72 |     await expect(getUserBalance('2')).rejects.toThrow('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: Supabase error')\n         |                 ^\n      73 |     expect(mockSelectReturn.eq).toHaveBeenCalledWith('telegram_id', '2')\n      74 |   })\n      75 | })\n\n      at expect (node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:113:15)\n      at __tests__/core/supabase/getUserBalance.test.ts:72:17\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/core/supabase/getUserBalance.test.ts:68:63)\n","testResults":[{"ancestorTitles":["getUserBalance"],"duration":3,"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 100\nReceived: 0\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserBalance.test.ts:45:21\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"getUserBalance should return balance for existing user","status":"failed","title":"should return balance for existing user"},{"ancestorTitles":["getUserBalance"],"duration":1,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"telegram_id\", \"55\"\n\nNumber of calls: 0\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserBalance.test.ts:58:33\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"getUserBalance should return 0 if user has no balance field (or null)","status":"failed","title":"should return 0 if user has no balance field (or null)"},{"ancestorTitles":["getUserBalance"],"duration":4,"failureMessages":["Error: expect(received).rejects.toThrow()\n\nReceived promise resolved instead of rejected\nResolved to value: 0\n    at expect (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:113:15)\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserBalance.test.ts:64:17\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserBalance.test.ts:61:57)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"getUserBalance should throw error if user not found","status":"failed","title":"should throw error if user not found"},{"ancestorTitles":["getUserBalance"],"duration":2,"failureMessages":["Error: expect(received).rejects.toThrow()\n\nReceived promise resolved instead of rejected\nResolved to value: 0\n    at expect (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:113:15)\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserBalance.test.ts:72:17\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserBalance.test.ts:68:63)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"getUserBalance should throw error if supabase query fails","status":"failed","title":"should throw error if supabase query fails"}]},{"numFailingTests":2,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168594415,"runtime":57,"slow":false,"start":1745168594358},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserBalance.unit.test.ts","failureMessage":"  ‚óè getUserBalance Unit Tests ‚Ä∫ should throw error if user not found (simulated via rpc returning null data/error)\n\n    expect(received).rejects.toThrow()\n\n    Received promise resolved instead of rejected\n    Resolved to value: 0\n\n      40 |     mockedRpc.mockResolvedValue({ data: null, error: rpcError, count: null, status: 500, statusText: 'Internal Server Error' })\n      41 |\n    > 42 |     await expect(getUserBalance('123')).rejects.toThrow(\n         |                 ^\n      43 |       '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: User balance function error'\n      44 |     )\n      45 |     expect(mockedRpc).toHaveBeenCalledWith('get_user_balance', {\n\n      at expect (node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:113:15)\n      at __tests__/core/supabase/getUserBalance.unit.test.ts:42:17\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/core/supabase/getUserBalance.unit.test.ts:36:103)\n\n  ‚óè getUserBalance Unit Tests ‚Ä∫ should throw generic error for other Supabase RPC errors\n\n    expect(received).rejects.toThrow()\n\n    Received promise resolved instead of rejected\n    Resolved to value: 0\n\n      53 |     mockedRpc.mockResolvedValue({ data: null, error, count: null, status: 500, statusText: 'Internal Server Error' })\n      54 |\n    > 55 |     await expect(getUserBalance('456')).rejects.toThrow(\n         |                 ^\n      56 |       '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: Generic DB error'\n      57 |     )\n      58 |     expect(mockedRpc).toHaveBeenCalledWith('get_user_balance', {\n\n      at expect (node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:113:15)\n      at __tests__/core/supabase/getUserBalance.unit.test.ts:55:17\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/core/supabase/getUserBalance.unit.test.ts:50:77)\n","testResults":[{"ancestorTitles":["getUserBalance Unit Tests"],"duration":2,"failureMessages":["Error: expect(received).rejects.toThrow()\n\nReceived promise resolved instead of rejected\nResolved to value: 0\n    at expect (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:113:15)\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserBalance.unit.test.ts:42:17\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserBalance.unit.test.ts:36:103)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"getUserBalance Unit Tests should throw error if user not found (simulated via rpc returning null data/error)","status":"failed","title":"should throw error if user not found (simulated via rpc returning null data/error)"},{"ancestorTitles":["getUserBalance Unit Tests"],"duration":4,"failureMessages":["Error: expect(received).rejects.toThrow()\n\nReceived promise resolved instead of rejected\nResolved to value: 0\n    at expect (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:113:15)\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserBalance.unit.test.ts:55:17\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserBalance.unit.test.ts:50:77)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"getUserBalance Unit Tests should throw generic error for other Supabase RPC errors","status":"failed","title":"should throw generic error for other Supabase RPC errors"},{"ancestorTitles":["getUserBalance Unit Tests"],"duration":1,"failureMessages":[],"fullName":"getUserBalance Unit Tests should return balance when user exists and balance is number","status":"passed","title":"should return balance when user exists and balance is number"},{"ancestorTitles":["getUserBalance Unit Tests"],"duration":1,"failureMessages":[],"fullName":"getUserBalance Unit Tests should return 0 when user exists but balance is null/undefined from rpc","status":"passed","title":"should return 0 when user exists but balance is null/undefined from rpc"},{"ancestorTitles":["getUserBalance Unit Tests"],"duration":1,"failureMessages":[],"fullName":"getUserBalance Unit Tests should return 0 when user exists but balance is 0 from rpc","status":"passed","title":"should return 0 when user exists but balance is 0 from rpc"}]},{"numFailingTests":6,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168594509,"runtime":92,"slow":false,"start":1745168594417},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts","failureMessage":"  ‚óè createUser ‚Ä∫ throws if inviter check fails\n\n    expect(received).rejects.toThrow(expected)\n\n    Expected substring: \"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –∏–Ω–≤–∞–π—Ç–µ—Ä–∞: invite error\"\n    Received message:   \"Cannot read properties of undefined (reading 'select')\"\n\n          26 |         telegram_id,\n          27 |         first_name,\n        > 28 |         last_name,\n             |         ^\n          29 |         is_bot,\n          30 |         language_code,\n          31 |         photo_url,\n\n      at src/core/supabase/createUser.ts:28:9\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at createUser (src/core/supabase/createUser.ts:19:22)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:68:18)\n      at __tests__/core/supabase/createUser.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/core/supabase/createUser.test.ts:3:12)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:63:50)\n      at Object.toThrow (node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:68:44)\n      at __tests__/core/supabase/createUser.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/core/supabase/createUser.test.ts:3:12)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:63:50)\n\n  ‚óè createUser ‚Ä∫ throws if existing user select fails\n\n    expect(received).rejects.toThrow(expected)\n\n    Expected substring: \"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: select error\"\n    Received message:   \"Cannot read properties of undefined (reading 'select')\"\n\n          26 |         telegram_id,\n          27 |         first_name,\n        > 28 |         last_name,\n             |         ^\n          29 |         is_bot,\n          30 |         language_code,\n          31 |         photo_url,\n\n      at src/core/supabase/createUser.ts:28:9\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at createUser (src/core/supabase/createUser.ts:19:22)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:75:18)\n      at __tests__/core/supabase/createUser.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/core/supabase/createUser.test.ts:3:12)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:71:57)\n      at Object.toThrow (node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:75:48)\n      at __tests__/core/supabase/createUser.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/core/supabase/createUser.test.ts:3:12)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:71:57)\n\n  ‚óè createUser ‚Ä∫ updates existing user when found without inviter\n\n    TypeError: Cannot read properties of undefined (reading 'select')\n\n      26 |         telegram_id,\n      27 |         first_name,\n    > 28 |         last_name,\n         |         ^\n      29 |         is_bot,\n      30 |         language_code,\n      31 |         photo_url,\n\n      at src/core/supabase/createUser.ts:28:9\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at createUser (src/core/supabase/createUser.ts:19:22)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:84:26)\n      at __tests__/core/supabase/createUser.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/core/supabase/createUser.test.ts:3:12)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:78:69)\n\n  ‚óè createUser ‚Ä∫ inserts new user when not exists\n\n    TypeError: supabase_1.supabase.from(...).insert(...).select is not a function\n\n      39 |       },\n      40 |     ])\n    > 41 |     .select()\n         |      ^\n      42 |\n      43 |   if (error) {\n      44 |     console.error('Error creating user:', error)\n\n      at src/core/supabase/createUser.ts:41:6\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at createUser (src/core/supabase/createUser.ts:19:22)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:93:26)\n      at __tests__/core/supabase/createUser.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/core/supabase/createUser.test.ts:3:12)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:90:53)\n\n  ‚óè createUser ‚Ä∫ throws on update error\n\n    expect(received).rejects.toThrow(expected)\n\n    Expected substring: \"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: upd error\"\n    Received message:   \"Cannot read properties of undefined (reading 'select')\"\n\n          26 |         telegram_id,\n          27 |         first_name,\n        > 28 |         last_name,\n             |         ^\n          29 |         is_bot,\n          30 |         language_code,\n          31 |         photo_url,\n\n      at src/core/supabase/createUser.ts:28:9\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at createUser (src/core/supabase/createUser.ts:19:22)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:103:18)\n      at __tests__/core/supabase/createUser.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/core/supabase/createUser.test.ts:3:12)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:98:43)\n      at Object.toThrow (node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:103:48)\n      at __tests__/core/supabase/createUser.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/core/supabase/createUser.test.ts:3:12)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:98:43)\n\n  ‚óè createUser ‚Ä∫ throws on insert error\n\n    expect(received).rejects.toThrow(expected)\n\n    Expected substring: \"–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ins error\"\n    Received message:   \"supabase_1.supabase.from(...).insert(...).select is not a function\"\n\n          39 |       },\n          40 |     ])\n        > 41 |     .select()\n             |      ^\n          42 |\n          43 |   if (error) {\n          44 |     console.error('Error creating user:', error)\n\n      at src/core/supabase/createUser.ts:41:6\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at createUser (src/core/supabase/createUser.ts:19:22)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:110:18)\n      at __tests__/core/supabase/createUser.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/core/supabase/createUser.test.ts:3:12)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:106:43)\n      at Object.toThrow (node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:110:48)\n      at __tests__/core/supabase/createUser.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/core/supabase/createUser.test.ts:3:12)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:106:43)\n","testResults":[{"ancestorTitles":["createUser"],"duration":30,"failureMessages":["Error: expect(received).rejects.toThrow(expected)\n\nExpected substring: \"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –∏–Ω–≤–∞–π—Ç–µ—Ä–∞: invite error\"\nReceived message:   \"Cannot read properties of undefined (reading 'select')\"\n\n      26 |         telegram_id,\n      27 |         first_name,\n    > 28 |         last_name,\n         |         ^\n      29 |         is_bot,\n      30 |         language_code,\n      31 |         photo_url,\n\n      at src/core/supabase/createUser.ts:28:9\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at createUser (src/core/supabase/createUser.ts:19:22)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:68:18)\n      at __tests__/core/supabase/createUser.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/core/supabase/createUser.test.ts:3:12)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:63:50)\n    at Object.toThrow (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:68:44)\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:7:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:3:12)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:63:50)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"createUser throws if inviter check fails","status":"failed","title":"throws if inviter check fails"},{"ancestorTitles":["createUser"],"duration":2,"failureMessages":["Error: expect(received).rejects.toThrow(expected)\n\nExpected substring: \"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: select error\"\nReceived message:   \"Cannot read properties of undefined (reading 'select')\"\n\n      26 |         telegram_id,\n      27 |         first_name,\n    > 28 |         last_name,\n         |         ^\n      29 |         is_bot,\n      30 |         language_code,\n      31 |         photo_url,\n\n      at src/core/supabase/createUser.ts:28:9\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at createUser (src/core/supabase/createUser.ts:19:22)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:75:18)\n      at __tests__/core/supabase/createUser.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/core/supabase/createUser.test.ts:3:12)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:71:57)\n    at Object.toThrow (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:75:48)\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:7:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:3:12)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:71:57)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"createUser throws if existing user select fails","status":"failed","title":"throws if existing user select fails"},{"ancestorTitles":["createUser"],"duration":3,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'select')\n    at /Users/playom/999-multibots-telegraf/src/core/supabase/createUser.ts:28:9\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at createUser (/Users/playom/999-multibots-telegraf/src/core/supabase/createUser.ts:19:22)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:84:26)\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:7:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:3:12)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:78:69)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"createUser updates existing user when found without inviter","status":"failed","title":"updates existing user when found without inviter"},{"ancestorTitles":["createUser"],"duration":2,"failureMessages":["TypeError: supabase_1.supabase.from(...).insert(...).select is not a function\n    at /Users/playom/999-multibots-telegraf/src/core/supabase/createUser.ts:41:6\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at createUser (/Users/playom/999-multibots-telegraf/src/core/supabase/createUser.ts:19:22)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:93:26)\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:7:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:3:12)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:90:53)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"createUser inserts new user when not exists","status":"failed","title":"inserts new user when not exists"},{"ancestorTitles":["createUser"],"duration":1,"failureMessages":["Error: expect(received).rejects.toThrow(expected)\n\nExpected substring: \"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: upd error\"\nReceived message:   \"Cannot read properties of undefined (reading 'select')\"\n\n      26 |         telegram_id,\n      27 |         first_name,\n    > 28 |         last_name,\n         |         ^\n      29 |         is_bot,\n      30 |         language_code,\n      31 |         photo_url,\n\n      at src/core/supabase/createUser.ts:28:9\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at createUser (src/core/supabase/createUser.ts:19:22)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:103:18)\n      at __tests__/core/supabase/createUser.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/core/supabase/createUser.test.ts:3:12)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:98:43)\n    at Object.toThrow (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:103:48)\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:7:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:3:12)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:98:43)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"createUser throws on update error","status":"failed","title":"throws on update error"},{"ancestorTitles":["createUser"],"duration":1,"failureMessages":["Error: expect(received).rejects.toThrow(expected)\n\nExpected substring: \"–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ins error\"\nReceived message:   \"supabase_1.supabase.from(...).insert(...).select is not a function\"\n\n      39 |       },\n      40 |     ])\n    > 41 |     .select()\n         |      ^\n      42 |\n      43 |   if (error) {\n      44 |     console.error('Error creating user:', error)\n\n      at src/core/supabase/createUser.ts:41:6\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at createUser (src/core/supabase/createUser.ts:19:22)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:110:18)\n      at __tests__/core/supabase/createUser.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/core/supabase/createUser.test.ts:3:12)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:106:43)\n    at Object.toThrow (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:110:48)\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:7:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:3:12)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:106:43)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"createUser throws on insert error","status":"failed","title":"throws on insert error"}]},{"numFailingTests":2,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168594615,"runtime":104,"slow":false,"start":1745168594511},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserBalance.test.ts","failureMessage":"  ‚óè updateUserBalance ‚Ä∫ should update user balance and return no error on success\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"users\"\n\n    Number of calls: 0\n\n      33 |\n      34 |     const result = await updateUserBalance(telegram_id, new_balance, 'money_income')\n    > 35 |     expect(mockFrom).toHaveBeenCalledWith('users')\n         |                      ^\n      36 |     expect(mockUpdate).toHaveBeenCalledWith({ balance: 100 })\n      37 |     expect(mockEq).toHaveBeenCalledWith('telegram_id', '42')\n      38 |   })\n\n      at __tests__/core/supabase/updateUserBalance.test.ts:35:22\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ‚óè updateUserBalance ‚Ä∫ should return an error if Supabase update fails\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞:\", Any<Object>\n\n    Number of calls: 0\n\n      47 |\n      48 |     const result = await updateUserBalance(telegram_id, new_balance, 'money_income')\n    > 49 |     expect(console.error).toHaveBeenCalledWith(\n         |                           ^\n      50 |       '–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞:',\n      51 |       expect.any(Object)\n      52 |     )\n\n      at __tests__/core/supabase/updateUserBalance.test.ts:49:27\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["updateUserBalance"],"duration":12,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"users\"\n\nNumber of calls: 0\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserBalance.test.ts:35:22\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"updateUserBalance should update user balance and return no error on success","status":"failed","title":"should update user balance and return no error on success"},{"ancestorTitles":["updateUserBalance"],"duration":2,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞:\", Any<Object>\n\nNumber of calls: 0\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserBalance.test.ts:49:27\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"updateUserBalance should return an error if Supabase update fails","status":"failed","title":"should return an error if Supabase update fails"}]},{"numFailingTests":1,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168594712,"runtime":95,"slow":false,"start":1745168594617},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/processBalanceOperation.test.ts","failureMessage":"  ‚óè processBalanceOperation ‚Ä∫ returns success and updates balance\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: true\n    Received: false\n\n      32 |       is_ru: true,\n      33 |     })\n    > 34 |     expect(res.success).toBe(true)\n         |                         ^\n      35 |     expect(res.newBalance).toBe(15)\n      36 |     expect(spyUpdate).toHaveBeenCalledWith(telegram_id, 15)\n      37 |   })\n\n      at __tests__/price/processBalanceOperation.test.ts:34:25\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["processBalanceOperation"],"duration":7,"failureMessages":[],"fullName":"processBalanceOperation returns error when balance insufficient","status":"passed","title":"returns error when balance insufficient"},{"ancestorTitles":["processBalanceOperation"],"duration":2,"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: true\nReceived: false\n    at /Users/playom/999-multibots-telegraf/__tests__/price/processBalanceOperation.test.ts:34:25\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"processBalanceOperation returns success and updates balance","status":"failed","title":"returns success and updates balance"}]},{"numFailingTests":5,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168594761,"runtime":45,"slow":false,"start":1745168594716},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getBotsFromSupabase.test.ts","failureMessage":"  ‚óè core/supabase getBotsFromSupabase ‚Ä∫ returns empty array and warns if not configured\n\n    TypeError: Cannot read properties of undefined (reading 'parsed')\n\n      37 |\n      38 | console.log(\n    > 39 |   `[CONFIG] dotenv load result: ${loadResult.parsed ? 'Success' : 'Failed'}`\n         |                                              ^\n      40 | )\n      41 | if (loadResult.error) {\n      42 |   console.error('[CONFIG] dotenv load error:', loadResult.error.message)\n\n      at Object.<anonymous> (src/config/index.ts:39:46)\n      at Object.<anonymous> (src/core/supabase/client.ts:2:1)\n      at Object.<anonymous> (src/core/supabase/index.ts:1:1)\n      at Object.<anonymous> (__tests__/core/supabase/getBotsFromSupabase.test.ts:12:22)\n\n  ‚óè core/supabase getBotsFromSupabase ‚Ä∫ returns empty array and logs error on query error\n\n    TypeError: Cannot read properties of undefined (reading 'parsed')\n\n      37 |\n      38 | console.log(\n    > 39 |   `[CONFIG] dotenv load result: ${loadResult.parsed ? 'Success' : 'Failed'}`\n         |                                              ^\n      40 | )\n      41 | if (loadResult.error) {\n      42 |   console.error('[CONFIG] dotenv load error:', loadResult.error.message)\n\n      at Object.<anonymous> (src/config/index.ts:39:46)\n      at Object.<anonymous> (src/core/supabase/client.ts:2:1)\n      at Object.<anonymous> (src/core/supabase/index.ts:1:1)\n      at Object.<anonymous> (__tests__/core/supabase/getBotsFromSupabase.test.ts:12:22)\n\n  ‚óè core/supabase getBotsFromSupabase ‚Ä∫ returns empty array and logs info when no data\n\n    TypeError: Cannot read properties of undefined (reading 'parsed')\n\n      37 |\n      38 | console.log(\n    > 39 |   `[CONFIG] dotenv load result: ${loadResult.parsed ? 'Success' : 'Failed'}`\n         |                                              ^\n      40 | )\n      41 | if (loadResult.error) {\n      42 |   console.error('[CONFIG] dotenv load error:', loadResult.error.message)\n\n      at Object.<anonymous> (src/config/index.ts:39:46)\n      at Object.<anonymous> (src/core/supabase/client.ts:2:1)\n      at Object.<anonymous> (src/core/supabase/index.ts:1:1)\n      at Object.<anonymous> (__tests__/core/supabase/getBotsFromSupabase.test.ts:12:22)\n\n  ‚óè core/supabase getBotsFromSupabase ‚Ä∫ returns data array and logs info on success\n\n    TypeError: Cannot read properties of undefined (reading 'parsed')\n\n      37 |\n      38 | console.log(\n    > 39 |   `[CONFIG] dotenv load result: ${loadResult.parsed ? 'Success' : 'Failed'}`\n         |                                              ^\n      40 | )\n      41 | if (loadResult.error) {\n      42 |   console.error('[CONFIG] dotenv load error:', loadResult.error.message)\n\n      at Object.<anonymous> (src/config/index.ts:39:46)\n      at Object.<anonymous> (src/core/supabase/client.ts:2:1)\n      at Object.<anonymous> (src/core/supabase/index.ts:1:1)\n      at Object.<anonymous> (__tests__/core/supabase/getBotsFromSupabase.test.ts:12:22)\n\n  ‚óè core/supabase getBotsFromSupabase ‚Ä∫ logs error and returns empty array when supabaseAdmin throws exception\n\n    TypeError: Cannot read properties of undefined (reading 'parsed')\n\n      37 |\n      38 | console.log(\n    > 39 |   `[CONFIG] dotenv load result: ${loadResult.parsed ? 'Success' : 'Failed'}`\n         |                                              ^\n      40 | )\n      41 | if (loadResult.error) {\n      42 |   console.error('[CONFIG] dotenv load error:', loadResult.error.message)\n\n      at Object.<anonymous> (src/config/index.ts:39:46)\n      at Object.<anonymous> (src/core/supabase/client.ts:2:1)\n      at Object.<anonymous> (src/core/supabase/index.ts:1:1)\n      at Object.<anonymous> (__tests__/core/supabase/getBotsFromSupabase.test.ts:12:22)\n","testResults":[{"ancestorTitles":["core/supabase getBotsFromSupabase"],"duration":2,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'parsed')\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/src/config/index.ts:39:46)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/src/core/supabase/client.ts:2:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/src/core/supabase/index.ts:1:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getBotsFromSupabase.test.ts:12:22)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusHook (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:281:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:246:5)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"core/supabase getBotsFromSupabase returns empty array and warns if not configured","status":"failed","title":"returns empty array and warns if not configured"},{"ancestorTitles":["core/supabase getBotsFromSupabase"],"duration":1,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'parsed')\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/src/config/index.ts:39:46)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/src/core/supabase/client.ts:2:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/src/core/supabase/index.ts:1:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getBotsFromSupabase.test.ts:12:22)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusHook (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:281:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:246:5)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"core/supabase getBotsFromSupabase returns empty array and logs error on query error","status":"failed","title":"returns empty array and logs error on query error"},{"ancestorTitles":["core/supabase getBotsFromSupabase"],"duration":1,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'parsed')\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/src/config/index.ts:39:46)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/src/core/supabase/client.ts:2:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/src/core/supabase/index.ts:1:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getBotsFromSupabase.test.ts:12:22)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusHook (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:281:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:246:5)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"core/supabase getBotsFromSupabase returns empty array and logs info when no data","status":"failed","title":"returns empty array and logs info when no data"},{"ancestorTitles":["core/supabase getBotsFromSupabase"],"duration":5,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'parsed')\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/src/config/index.ts:39:46)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/src/core/supabase/client.ts:2:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/src/core/supabase/index.ts:1:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getBotsFromSupabase.test.ts:12:22)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusHook (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:281:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:246:5)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"core/supabase getBotsFromSupabase returns data array and logs info on success","status":"failed","title":"returns data array and logs info on success"},{"ancestorTitles":["core/supabase getBotsFromSupabase"],"duration":2,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'parsed')\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/src/config/index.ts:39:46)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/src/core/supabase/client.ts:2:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/src/core/supabase/index.ts:1:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getBotsFromSupabase.test.ts:12:22)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusHook (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:281:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:246:5)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"core/supabase getBotsFromSupabase logs error and returns empty array when supabaseAdmin throws exception","status":"failed","title":"logs error and returns empty array when supabaseAdmin throws exception"}]},{"numFailingTests":5,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168594802,"runtime":39,"slow":false,"start":1745168594763},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/digitalAvatarBodyWizardV2.test.ts","failureMessage":"  ‚óè digitalAvatarBodyWizardV2 ‚Ä∫ –ø–µ—Ä–≤—ã–π —à–∞–≥: –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ —Å—Ç–æ–∏–º–æ—Å—Ç—å—é –∏ –≤—ã–∑—ã–≤–∞–µ—Ç next()\n\n    TypeError: step0 is not a function\n\n      62 |     menu.mockReturnValue({ reply_markup: { keyboard: [['step']] } })\n      63 |     // @ts-ignore\n    > 64 |     await step0(ctx, jest.fn())\n         |           ^\n      65 |     // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—ã–∑–æ–≤—ã\n      66 |     expect(calc).toHaveBeenCalledTimes(stepsOpt.length)\n      67 |     expect(genMsg).toHaveBeenCalledWith([5, 5, 5], true)\n\n      at __tests__/scenes/digitalAvatarBodyWizardV2.test.ts:64:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/digitalAvatarBodyWizardV2.test.ts:46:85)\n\n  ‚óè digitalAvatarBodyWizardV2 ‚Ä∫ –≤—Ç–æ—Ä–æ–π —à–∞–≥: –ø—Ä–∏ –≤–∞–ª–∏–¥–Ω–æ–º –≤–≤–æ–¥–µ —à–∞–≥–æ–≤ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ trainFluxModelWizard\n\n    TypeError: step1 is not a function\n\n      85 |     })\n      86 |     // @ts-ignore\n    > 87 |     await step1(ctx, jest.fn())\n         |           ^\n      88 |     expect(ctx.session.steps).toBe(2)\n      89 |     expect(costHelper).toHaveBeenCalledWith(ctx, 2, false)\n      90 |     expect(ctx.scene.enter).toHaveBeenCalledWith('trainFluxModelWizard')\n\n      at __tests__/scenes/digitalAvatarBodyWizardV2.test.ts:87:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/digitalAvatarBodyWizardV2.test.ts:73:90)\n\n  ‚óè digitalAvatarBodyWizardV2 ‚Ä∫ –≤—Ç–æ—Ä–æ–π —à–∞–≥: –ø—Ä–∏ leaveScene=true –≤—ã—Ö–æ–¥–∏—Ç –∏–∑ —Å—Ü–µ–Ω—ã\n\n    TypeError: step1 is not a function\n\n      105 |     })\n      106 |     // @ts-ignore\n    > 107 |     await step1(ctx, jest.fn())\n          |           ^\n      108 |     expect(ctx.scene.leave).toHaveBeenCalled()\n      109 |   })\n      110 |\n\n      at __tests__/scenes/digitalAvatarBodyWizardV2.test.ts:107:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/digitalAvatarBodyWizardV2.test.ts:93:69)\n\n  ‚óè digitalAvatarBodyWizardV2 ‚Ä∫ –≤—Ç–æ—Ä–æ–π —à–∞–≥: –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π –≤–≤–æ–¥ –∏ –æ—Ç–º–µ–Ω–∞ => –≤—ã—Ö–æ–¥ –∏–∑ —Å—Ü–µ–Ω—ã\n\n    TypeError: step1 is not a function\n\n      119 |     cancel.mockResolvedValueOnce(true)\n      120 |     // @ts-ignore\n    > 121 |     await step1(ctx, jest.fn())\n          |           ^\n      122 |     expect(ctx.scene.leave).toHaveBeenCalled()\n      123 |   })\n      124 |\n\n      at __tests__/scenes/digitalAvatarBodyWizardV2.test.ts:121:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/digitalAvatarBodyWizardV2.test.ts:111:75)\n\n  ‚óè digitalAvatarBodyWizardV2 ‚Ä∫ –≤—Ç–æ—Ä–æ–π —à–∞–≥: –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π –≤–≤–æ–¥ –±–µ–∑ –æ—Ç–º–µ–Ω—ã => –ø—Ä–æ—Å–∏—Ç –≤—ã–±—Ä–∞—Ç—å —à–∞–≥–∏\n\n    TypeError: step1 is not a function\n\n      133 |     cancel.mockResolvedValueOnce(false)\n      134 |     // @ts-ignore\n    > 135 |     await step1(ctx, jest.fn())\n          |           ^\n      136 |     expect(ctx.reply).toHaveBeenCalledWith(\n      137 |       'üî¢ Please select the number of steps to proceed with model training.'\n      138 |     )\n\n      at __tests__/scenes/digitalAvatarBodyWizardV2.test.ts:135:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/digitalAvatarBodyWizardV2.test.ts:125:82)\n","testResults":[{"ancestorTitles":["digitalAvatarBodyWizardV2"],"duration":0,"failureMessages":["TypeError: step0 is not a function\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/digitalAvatarBodyWizardV2.test.ts:64:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/digitalAvatarBodyWizardV2.test.ts:46:85)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"digitalAvatarBodyWizardV2 –ø–µ—Ä–≤—ã–π —à–∞–≥: –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ —Å—Ç–æ–∏–º–æ—Å—Ç—å—é –∏ –≤—ã–∑—ã–≤–∞–µ—Ç next()","status":"failed","title":"–ø–µ—Ä–≤—ã–π —à–∞–≥: –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ —Å—Ç–æ–∏–º–æ—Å—Ç—å—é –∏ –≤—ã–∑—ã–≤–∞–µ—Ç next()"},{"ancestorTitles":["digitalAvatarBodyWizardV2"],"duration":0,"failureMessages":["TypeError: step1 is not a function\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/digitalAvatarBodyWizardV2.test.ts:87:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/digitalAvatarBodyWizardV2.test.ts:73:90)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"digitalAvatarBodyWizardV2 –≤—Ç–æ—Ä–æ–π —à–∞–≥: –ø—Ä–∏ –≤–∞–ª–∏–¥–Ω–æ–º –≤–≤–æ–¥–µ —à–∞–≥–æ–≤ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ trainFluxModelWizard","status":"failed","title":"–≤—Ç–æ—Ä–æ–π —à–∞–≥: –ø—Ä–∏ –≤–∞–ª–∏–¥–Ω–æ–º –≤–≤–æ–¥–µ —à–∞–≥–æ–≤ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ trainFluxModelWizard"},{"ancestorTitles":["digitalAvatarBodyWizardV2"],"duration":1,"failureMessages":["TypeError: step1 is not a function\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/digitalAvatarBodyWizardV2.test.ts:107:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/digitalAvatarBodyWizardV2.test.ts:93:69)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"digitalAvatarBodyWizardV2 –≤—Ç–æ—Ä–æ–π —à–∞–≥: –ø—Ä–∏ leaveScene=true –≤—ã—Ö–æ–¥–∏—Ç –∏–∑ —Å—Ü–µ–Ω—ã","status":"failed","title":"–≤—Ç–æ—Ä–æ–π —à–∞–≥: –ø—Ä–∏ leaveScene=true –≤—ã—Ö–æ–¥–∏—Ç –∏–∑ —Å—Ü–µ–Ω—ã"},{"ancestorTitles":["digitalAvatarBodyWizardV2"],"duration":0,"failureMessages":["TypeError: step1 is not a function\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/digitalAvatarBodyWizardV2.test.ts:121:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/digitalAvatarBodyWizardV2.test.ts:111:75)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"digitalAvatarBodyWizardV2 –≤—Ç–æ—Ä–æ–π —à–∞–≥: –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π –≤–≤–æ–¥ –∏ –æ—Ç–º–µ–Ω–∞ => –≤—ã—Ö–æ–¥ –∏–∑ —Å—Ü–µ–Ω—ã","status":"failed","title":"–≤—Ç–æ—Ä–æ–π —à–∞–≥: –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π –≤–≤–æ–¥ –∏ –æ—Ç–º–µ–Ω–∞ => –≤—ã—Ö–æ–¥ –∏–∑ —Å—Ü–µ–Ω—ã"},{"ancestorTitles":["digitalAvatarBodyWizardV2"],"duration":1,"failureMessages":["TypeError: step1 is not a function\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/digitalAvatarBodyWizardV2.test.ts:135:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/digitalAvatarBodyWizardV2.test.ts:125:82)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"digitalAvatarBodyWizardV2 –≤—Ç–æ—Ä–æ–π —à–∞–≥: –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π –≤–≤–æ–¥ –±–µ–∑ –æ—Ç–º–µ–Ω—ã => –ø—Ä–æ—Å–∏—Ç –≤—ã–±—Ä–∞—Ç—å —à–∞–≥–∏","status":"failed","title":"–≤—Ç–æ—Ä–æ–π —à–∞–≥: –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π –≤–≤–æ–¥ –±–µ–∑ –æ—Ç–º–µ–Ω—ã => –ø—Ä–æ—Å–∏—Ç –≤—ã–±—Ä–∞—Ç—å —à–∞–≥–∏"}]},{"numFailingTests":3,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168594849,"runtime":41,"slow":false,"start":1745168594808},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/handleSelectStars.test.ts","failureMessage":"  ‚óè handleSelectStars ‚Ä∫ renders a single row of three stars in English\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    - Expected\n    + Received\n\n      \"Choose the number of stars to buy:\",\n    - Object {\n    + Markup {\n        \"reply_markup\": Object {\n          \"inline_keyboard\": Array [\n            Array [\n              Object {\n                \"callback_data\": \"top_up_10\",\n    -           \"text\": \"10‚≠êÔ∏è\",\n    +           \"hide\": false,\n    +           \"text\": \"‚≠êÔ∏è 10\",\n              },\n    +       ],\n    +       Array [\n              Object {\n                \"callback_data\": \"top_up_20\",\n    -           \"text\": \"20‚≠êÔ∏è\",\n    +           \"hide\": false,\n    +           \"text\": \"‚≠êÔ∏è 20\",\n              },\n    +       ],\n    +       Array [\n              Object {\n                \"callback_data\": \"top_up_30\",\n    -           \"text\": \"30‚≠êÔ∏è\",\n    +           \"hide\": false,\n    +           \"text\": \"‚≠êÔ∏è 30\",\n              },\n            ],\n          ],\n        },\n      },\n\n    Number of calls: 1\n\n      12 |   it('renders a single row of three stars in English', async () => {\n      13 |     await handleSelectStars({ ctx: ctx as any, starAmounts: [10, 20, 30], isRu: false })\n    > 14 |     expect(ctx.reply).toHaveBeenCalledWith(\n         |                       ^\n      15 |       'Choose the number of stars to buy:',\n      16 |       {\n      17 |         reply_markup: {\n\n      at __tests__/handlers/handleSelectStars.test.ts:14:23\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ‚óè handleSelectStars ‚Ä∫ renders a single row of two stars in Russian\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    - Expected\n    + Received\n\n      \"–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–≤–µ–∑–¥ –¥–ª—è –ø–æ–∫—É–ø–∫–∏:\",\n    - Object {\n    + Markup {\n        \"reply_markup\": Object {\n          \"inline_keyboard\": Array [\n            Array [\n              Object {\n                \"callback_data\": \"top_up_5\",\n    -           \"text\": \"5‚≠êÔ∏è\",\n    +           \"hide\": false,\n    +           \"text\": \"‚≠êÔ∏è 5\",\n              },\n    +       ],\n    +       Array [\n              Object {\n                \"callback_data\": \"top_up_15\",\n    -           \"text\": \"15‚≠êÔ∏è\",\n    +           \"hide\": false,\n    +           \"text\": \"‚≠êÔ∏è 15\",\n              },\n            ],\n          ],\n        },\n      },\n\n    Number of calls: 1\n\n      30 |   it('renders a single row of two stars in Russian', async () => {\n      31 |     await handleSelectStars({ ctx: ctx as any, starAmounts: [5, 15], isRu: true })\n    > 32 |     expect(ctx.reply).toHaveBeenCalledWith(\n         |                       ^\n      33 |       '–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–≤–µ–∑–¥ –¥–ª—è –ø–æ–∫—É–ø–∫–∏:',\n      34 |       {\n      35 |         reply_markup: {\n\n      at __tests__/handlers/handleSelectStars.test.ts:32:23\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ‚óè handleSelectStars ‚Ä∫ renders multiple rows with leftover items\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    - Expected\n    + Received\n\n      \"Choose the number of stars to buy:\",\n    - Object {\n    + Markup {\n        \"reply_markup\": Object {\n          \"inline_keyboard\": Array [\n            Array [\n              Object {\n                \"callback_data\": \"top_up_1\",\n    -           \"text\": \"1‚≠êÔ∏è\",\n    +           \"hide\": false,\n    +           \"text\": \"‚≠êÔ∏è 1\",\n              },\n    +       ],\n    +       Array [\n              Object {\n                \"callback_data\": \"top_up_2\",\n    -           \"text\": \"2‚≠êÔ∏è\",\n    +           \"hide\": false,\n    +           \"text\": \"‚≠êÔ∏è 2\",\n              },\n    +       ],\n    +       Array [\n              Object {\n                \"callback_data\": \"top_up_3\",\n    -           \"text\": \"3‚≠êÔ∏è\",\n    +           \"hide\": false,\n    +           \"text\": \"‚≠êÔ∏è 3\",\n              },\n            ],\n            Array [\n              Object {\n                \"callback_data\": \"top_up_4\",\n    -           \"text\": \"4‚≠êÔ∏è\",\n    +           \"hide\": false,\n    +           \"text\": \"‚≠êÔ∏è 4\",\n              },\n            ],\n          ],\n        },\n      },\n\n    Number of calls: 1\n\n      47 |   it('renders multiple rows with leftover items', async () => {\n      48 |     await handleSelectStars({ ctx: ctx as any, starAmounts: [1, 2, 3, 4], isRu: false })\n    > 49 |     expect(ctx.reply).toHaveBeenCalledWith(\n         |                       ^\n      50 |       'Choose the number of stars to buy:',\n      51 |       {\n      52 |         reply_markup: {\n\n      at __tests__/handlers/handleSelectStars.test.ts:49:23\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["handleSelectStars"],"duration":3,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n- Expected\n+ Received\n\n  \"Choose the number of stars to buy:\",\n- Object {\n+ Markup {\n    \"reply_markup\": Object {\n      \"inline_keyboard\": Array [\n        Array [\n          Object {\n            \"callback_data\": \"top_up_10\",\n-           \"text\": \"10‚≠êÔ∏è\",\n+           \"hide\": false,\n+           \"text\": \"‚≠êÔ∏è 10\",\n          },\n+       ],\n+       Array [\n          Object {\n            \"callback_data\": \"top_up_20\",\n-           \"text\": \"20‚≠êÔ∏è\",\n+           \"hide\": false,\n+           \"text\": \"‚≠êÔ∏è 20\",\n          },\n+       ],\n+       Array [\n          Object {\n            \"callback_data\": \"top_up_30\",\n-           \"text\": \"30‚≠êÔ∏è\",\n+           \"hide\": false,\n+           \"text\": \"‚≠êÔ∏è 30\",\n          },\n        ],\n      ],\n    },\n  },\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/handlers/handleSelectStars.test.ts:14:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"handleSelectStars renders a single row of three stars in English","status":"failed","title":"renders a single row of three stars in English"},{"ancestorTitles":["handleSelectStars"],"duration":1,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n- Expected\n+ Received\n\n  \"–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–≤–µ–∑–¥ –¥–ª—è –ø–æ–∫—É–ø–∫–∏:\",\n- Object {\n+ Markup {\n    \"reply_markup\": Object {\n      \"inline_keyboard\": Array [\n        Array [\n          Object {\n            \"callback_data\": \"top_up_5\",\n-           \"text\": \"5‚≠êÔ∏è\",\n+           \"hide\": false,\n+           \"text\": \"‚≠êÔ∏è 5\",\n          },\n+       ],\n+       Array [\n          Object {\n            \"callback_data\": \"top_up_15\",\n-           \"text\": \"15‚≠êÔ∏è\",\n+           \"hide\": false,\n+           \"text\": \"‚≠êÔ∏è 15\",\n          },\n        ],\n      ],\n    },\n  },\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/handlers/handleSelectStars.test.ts:32:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"handleSelectStars renders a single row of two stars in Russian","status":"failed","title":"renders a single row of two stars in Russian"},{"ancestorTitles":["handleSelectStars"],"duration":1,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n- Expected\n+ Received\n\n  \"Choose the number of stars to buy:\",\n- Object {\n+ Markup {\n    \"reply_markup\": Object {\n      \"inline_keyboard\": Array [\n        Array [\n          Object {\n            \"callback_data\": \"top_up_1\",\n-           \"text\": \"1‚≠êÔ∏è\",\n+           \"hide\": false,\n+           \"text\": \"‚≠êÔ∏è 1\",\n          },\n+       ],\n+       Array [\n          Object {\n            \"callback_data\": \"top_up_2\",\n-           \"text\": \"2‚≠êÔ∏è\",\n+           \"hide\": false,\n+           \"text\": \"‚≠êÔ∏è 2\",\n          },\n+       ],\n+       Array [\n          Object {\n            \"callback_data\": \"top_up_3\",\n-           \"text\": \"3‚≠êÔ∏è\",\n+           \"hide\": false,\n+           \"text\": \"‚≠êÔ∏è 3\",\n          },\n        ],\n        Array [\n          Object {\n            \"callback_data\": \"top_up_4\",\n-           \"text\": \"4‚≠êÔ∏è\",\n+           \"hide\": false,\n+           \"text\": \"‚≠êÔ∏è 4\",\n          },\n        ],\n      ],\n    },\n  },\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/handlers/handleSelectStars.test.ts:49:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"handleSelectStars renders multiple rows with leftover items","status":"failed","title":"renders multiple rows with leftover items"},{"ancestorTitles":["handleSelectStars"],"duration":1,"failureMessages":[],"fullName":"handleSelectStars throws error when ctx.reply fails","status":"passed","title":"throws error when ctx.reply fails"}]},{"numFailingTests":1,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168594894,"runtime":40,"slow":false,"start":1745168594854},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/services/uploadVideoToServer.test.ts","failureMessage":"  ‚óè uploadVideoToServer ‚Ä∫ posts to LOCAL_SERVER_URL when in dev\n\n    expect(received).resolves.toBeUndefined()\n\n    Received promise rejected instead of resolved\n    Rejected to value: [TypeError: Cannot read properties of undefined (reading 'data')]\n\n      38 |     mockedAxios.post.mockResolvedValue({ data: {} })\n      39 |     const req = { videoUrl: 'v', telegram_id: '1', fileName: 'f' }\n    > 40 |     await expect(uploadDev(req)).resolves.toBeUndefined()\n         |           ^\n      41 |     expect(mockedAxios.post).toHaveBeenCalledWith(\n      42 |       'http://localhost/video/upload',\n      43 |       req,\n\n      at expect (node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:113:15)\n      at __tests__/services/uploadVideoToServer.test.ts:40:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/services/uploadVideoToServer.test.ts:34:58)\n","testResults":[{"ancestorTitles":["uploadVideoToServer"],"duration":1,"failureMessages":[],"fullName":"uploadVideoToServer posts video upload request to server URL in production","status":"passed","title":"posts video upload request to server URL in production"},{"ancestorTitles":["uploadVideoToServer"],"duration":1,"failureMessages":["Error: expect(received).resolves.toBeUndefined()\n\nReceived promise rejected instead of resolved\nRejected to value: [TypeError: Cannot read properties of undefined (reading 'data')]\n    at expect (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:113:15)\n    at /Users/playom/999-multibots-telegraf/__tests__/services/uploadVideoToServer.test.ts:40:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/services/uploadVideoToServer.test.ts:34:58)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"uploadVideoToServer posts to LOCAL_SERVER_URL when in dev","status":"failed","title":"posts to LOCAL_SERVER_URL when in dev"},{"ancestorTitles":["uploadVideoToServer"],"duration":1,"failureMessages":[],"fullName":"uploadVideoToServer throws and logs error when axios.post fails","status":"passed","title":"throws and logs error when axios.post fails"}]},{"numFailingTests":5,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168594935,"runtime":39,"slow":false,"start":1745168594896},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/utils/pulse.test.ts","failureMessage":"  ‚óè pulse helper ‚Ä∫ sends photo when image is provided\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"-4166575919\", {\"source\": Any<Buffer>}, {\"caption\": StringContaining \"test prompt\"}\n\n    Number of calls: 0\n\n      29 |   it('sends photo when image is provided', async () => {\n      30 |     await pulse(ctx, image, prompt, command)\n    > 31 |     expect(ctx.telegram.sendPhoto).toHaveBeenCalledWith(\n         |                                    ^\n      32 |       '-4166575919',\n      33 |       { source: expect.any(Buffer) },\n      34 |       { caption: expect.stringContaining(prompt) }\n\n      at __tests__/utils/pulse.test.ts:31:36\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ‚óè pulse helper ‚Ä∫ sends message when image is null\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"-4166575919\", StringContaining \"–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –∫–æ–º–∞–Ω–¥—É\"\n\n    Number of calls: 0\n\n      38 |   it('sends message when image is null', async () => {\n      39 |     await pulse(ctx, null, prompt, command)\n    > 40 |     expect(ctx.telegram.sendMessage).toHaveBeenCalledWith(\n         |                                      ^\n      41 |       '-4166575919',\n      42 |       expect.stringContaining('–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –∫–æ–º–∞–Ω–¥—É')\n      43 |     )\n\n      at __tests__/utils/pulse.test.ts:40:38\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ‚óè pulse helper ‚Ä∫ retries sendPhoto on migrate_to_chat_id error\n\n    expect(jest.fn()).toHaveBeenCalledTimes(expected)\n\n    Expected number of calls: 2\n    Received number of calls: 0\n\n      51 |       .mockResolvedValue(undefined)\n      52 |     await pulse(ctx, image, prompt, command)\n    > 53 |     expect(ctx.telegram.sendPhoto).toHaveBeenCalledTimes(2)\n         |                                    ^\n      54 |     expect(ctx.telegram.sendPhoto).toHaveBeenLastCalledWith(\n      55 |       'new_chat',\n      56 |       { source: expect.any(Buffer) },\n\n      at __tests__/utils/pulse.test.ts:53:36\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ‚óè pulse helper ‚Ä∫ retries sendMessage on migrate_to_chat_id error\n\n    expect(jest.fn()).toHaveBeenCalledTimes(expected)\n\n    Expected number of calls: 2\n    Received number of calls: 0\n\n      66 |       .mockResolvedValue(undefined)\n      67 |     await pulse(ctx, null, prompt, command)\n    > 68 |     expect(ctx.telegram.sendMessage).toHaveBeenCalledTimes(2)\n         |                                      ^\n      69 |     expect(ctx.telegram.sendMessage).toHaveBeenLastCalledWith(\n      70 |       'new_chat',\n      71 |       expect.stringContaining('–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –∫–æ–º–∞–Ω–¥—É')\n\n      at __tests__/utils/pulse.test.ts:68:38\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ‚óè pulse helper ‚Ä∫ throws on non-migration error\n\n    expect(received).rejects.toThrow()\n\n    Received promise resolved instead of rejected\n    Resolved to value: undefined\n\n      77 |     randomError.response = { parameters: {} }\n      78 |     ctx.telegram.sendMessage = jest.fn().mockRejectedValue(randomError)\n    > 79 |     await expect(pulse(ctx, null, prompt, command))\n         |           ^\n      80 |       .rejects.toThrow('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –ø—É–ª—å—Å–∞')\n      81 |   })\n      82 | })\n\n      at expect (node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:113:15)\n      at __tests__/utils/pulse.test.ts:79:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/utils/pulse.test.ts:75:50)\n","testResults":[{"ancestorTitles":["pulse helper"],"duration":2,"failureMessages":[],"fullName":"pulse helper does nothing in development environment","status":"passed","title":"does nothing in development environment"},{"ancestorTitles":["pulse helper"],"duration":2,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"-4166575919\", {\"source\": Any<Buffer>}, {\"caption\": StringContaining \"test prompt\"}\n\nNumber of calls: 0\n    at /Users/playom/999-multibots-telegraf/__tests__/utils/pulse.test.ts:31:36\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"pulse helper sends photo when image is provided","status":"failed","title":"sends photo when image is provided"},{"ancestorTitles":["pulse helper"],"duration":4,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"-4166575919\", StringContaining \"–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –∫–æ–º–∞–Ω–¥—É\"\n\nNumber of calls: 0\n    at /Users/playom/999-multibots-telegraf/__tests__/utils/pulse.test.ts:40:38\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"pulse helper sends message when image is null","status":"failed","title":"sends message when image is null"},{"ancestorTitles":["pulse helper"],"duration":2,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledTimes(expected)\n\nExpected number of calls: 2\nReceived number of calls: 0\n    at /Users/playom/999-multibots-telegraf/__tests__/utils/pulse.test.ts:53:36\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"pulse helper retries sendPhoto on migrate_to_chat_id error","status":"failed","title":"retries sendPhoto on migrate_to_chat_id error"},{"ancestorTitles":["pulse helper"],"duration":1,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledTimes(expected)\n\nExpected number of calls: 2\nReceived number of calls: 0\n    at /Users/playom/999-multibots-telegraf/__tests__/utils/pulse.test.ts:68:38\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"pulse helper retries sendMessage on migrate_to_chat_id error","status":"failed","title":"retries sendMessage on migrate_to_chat_id error"},{"ancestorTitles":["pulse helper"],"duration":1,"failureMessages":["Error: expect(received).rejects.toThrow()\n\nReceived promise resolved instead of rejected\nResolved to value: undefined\n    at expect (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:113:15)\n    at /Users/playom/999-multibots-telegraf/__tests__/utils/pulse.test.ts:79:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/utils/pulse.test.ts:75:50)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"pulse helper throws on non-migration error","status":"failed","title":"throws on non-migration error"}]},{"numFailingTests":2,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168594973,"runtime":36,"slow":false,"start":1745168594937},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/config/indexExports.test.ts","failureMessage":"  ‚óè config index exports ‚Ä∫ defaults CREDENTIALS to false and NODE_ENV undefined\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: false\n    Received: true\n\n      16 |   it('defaults CREDENTIALS to false and NODE_ENV undefined', () => {\n      17 |     const config = require('../../src/config')\n    > 18 |     expect(config.CREDENTIALS).toBe(false)\n         |                                ^\n      19 |     expect(config.NODE_ENV).toBeUndefined()\n      20 |   })\n      21 |\n\n      at Object.<anonymous> (__tests__/config/indexExports.test.ts:18:32)\n\n  ‚óè config index exports ‚Ä∫ sets isSupabaseConfigured to false when supabase vars missing\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: false\n    Received: true\n\n      47 |     process.env.SUPABASE_SERVICE_ROLE_KEY = 'role'\n      48 |     const config = require('../../src/config')\n    > 49 |     expect(config.isSupabaseConfigured).toBe(false)\n         |                                         ^\n      50 |   })\n      51 | })\n\n      at Object.<anonymous> (__tests__/config/indexExports.test.ts:49:41)\n","testResults":[{"ancestorTitles":["config index exports"],"duration":2,"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: false\nReceived: true\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/config/indexExports.test.ts:18:32)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"config index exports defaults CREDENTIALS to false and NODE_ENV undefined","status":"failed","title":"defaults CREDENTIALS to false and NODE_ENV undefined"},{"ancestorTitles":["config index exports"],"duration":1,"failureMessages":[],"fullName":"config index exports parses CREDENTIALS from env","status":"passed","title":"parses CREDENTIALS from env"},{"ancestorTitles":["config index exports"],"duration":1,"failureMessages":[],"fullName":"config index exports exports PORT and WEBHOOK_URL when set","status":"passed","title":"exports PORT and WEBHOOK_URL when set"},{"ancestorTitles":["config index exports"],"duration":1,"failureMessages":[],"fullName":"config index exports sets isSupabaseConfigured to true when all supabase vars are present","status":"passed","title":"sets isSupabaseConfigured to true when all supabase vars are present"},{"ancestorTitles":["config index exports"],"duration":1,"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: false\nReceived: true\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/config/indexExports.test.ts:49:41)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"config index exports sets isSupabaseConfigured to false when supabase vars missing","status":"failed","title":"sets isSupabaseConfigured to false when supabase vars missing"}]},{"numFailingTests":2,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168595011,"runtime":33,"slow":false,"start":1745168594978},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/menu/startMenu.test.ts","failureMessage":"  ‚óè startMenu ‚Ä∫ replies with Russian text and keyboard\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –≤ –º–µ–Ω—é:\", ObjectContaining {\"reply_markup\": ObjectContaining {\"keyboard\": [[{\"text\": \"üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\"}]]}}\n    Received: \"–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –≤ –º–µ–Ω—é:\", {\"reply_markup\": {\"keyboard\": [[{\"hide\": false, \"text\": \"üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\"}]], \"resize_keyboard\": true}}\n\n    Number of calls: 1\n\n      12 |   it('replies with Russian text and keyboard', async () => {\n      13 |     await startMenu(ctx as any, true)\n    > 14 |     expect(ctx.reply).toHaveBeenCalledWith(\n         |                       ^\n      15 |       '–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –≤ –º–µ–Ω—é:',\n      16 |       expect.objectContaining({\n      17 |         reply_markup: expect.objectContaining({\n\n      at __tests__/menu/startMenu.test.ts:14:23\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ‚óè startMenu ‚Ä∫ replies with English text and keyboard\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"Choose an action in the menu:\", ObjectContaining {\"reply_markup\": ObjectContaining {\"keyboard\": [[{\"text\": \"üè† Main menu\"}]]}}\n    Received: \"Choose an action in the menu:\", {\"reply_markup\": {\"keyboard\": [[{\"hide\": false, \"text\": \"üè† Main menu\"}]], \"resize_keyboard\": true}}\n\n    Number of calls: 1\n\n      24 |   it('replies with English text and keyboard', async () => {\n      25 |     await startMenu(ctx as any, false)\n    > 26 |     expect(ctx.reply).toHaveBeenCalledWith(\n         |                       ^\n      27 |       'Choose an action in the menu:',\n      28 |       expect.objectContaining({\n      29 |         reply_markup: expect.objectContaining({\n\n      at __tests__/menu/startMenu.test.ts:26:23\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["startMenu"],"duration":1,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –≤ –º–µ–Ω—é:\", ObjectContaining {\"reply_markup\": ObjectContaining {\"keyboard\": [[{\"text\": \"üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\"}]]}}\nReceived: \"–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –≤ –º–µ–Ω—é:\", {\"reply_markup\": {\"keyboard\": [[{\"hide\": false, \"text\": \"üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\"}]], \"resize_keyboard\": true}}\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/menu/startMenu.test.ts:14:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"startMenu replies with Russian text and keyboard","status":"failed","title":"replies with Russian text and keyboard"},{"ancestorTitles":["startMenu"],"duration":1,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"Choose an action in the menu:\", ObjectContaining {\"reply_markup\": ObjectContaining {\"keyboard\": [[{\"text\": \"üè† Main menu\"}]]}}\nReceived: \"Choose an action in the menu:\", {\"reply_markup\": {\"keyboard\": [[{\"hide\": false, \"text\": \"üè† Main menu\"}]], \"resize_keyboard\": true}}\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/menu/startMenu.test.ts:26:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"startMenu replies with English text and keyboard","status":"failed","title":"replies with English text and keyboard"}]},{"numFailingTests":4,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168595046,"runtime":34,"slow":false,"start":1745168595012},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getReferalsCountAndUserData.unit.test.ts","failureMessage":"  ‚óè getReferalsCountAndUserData ‚Ä∫ returns defaults when user fetch errors\n\n    expect(received).toEqual(expected) // deep equality\n\n    - Expected  - 1\n    + Received  + 1\n\n      Object {\n        \"count\": 0,\n        \"isExist\": false,\n        \"level\": 0,\n    -   \"subscription\": \"stars\",\n    +   \"subscriptionType\": \"stars\",\n        \"userData\": null,\n      }\n\n      18 |     ;(supabase.from as jest.Mock).mockReturnValue({ select: selectMock })\n      19 |     const result = await getReferalsCountAndUserData(telegram_id)\n    > 20 |     expect(result).toEqual({ count: 0, subscription: 'stars', level: 0, userData: null, isExist: false })\n         |                    ^\n      21 |   })\n      22 |\n      23 |   it('returns defaults when referals fetch errors', async () => {\n\n      at __tests__/core/supabase/getReferalsCountAndUserData.unit.test.ts:20:20\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ‚óè getReferalsCountAndUserData ‚Ä∫ returns defaults when referals fetch errors\n\n    expect(received).toEqual(expected) // deep equality\n\n    - Expected  - 4\n    + Received  + 8\n\n      Object {\n        \"count\": 0,\n    -   \"isExist\": false,\n    -   \"level\": 0,\n    -   \"subscription\": \"stars\",\n    -   \"userData\": null,\n    +   \"isExist\": true,\n    +   \"level\": 2,\n    +   \"subscriptionType\": \"stars\",\n    +   \"userData\": Object {\n    +     \"level\": 2,\n    +     \"subscription\": \"gold\",\n    +     \"user_id\": 5,\n    +   },\n      }\n\n      33 |     fromMock.mockReturnValueOnce({ select: selectRefs })\n      34 |     const result = await getReferalsCountAndUserData(telegram_id)\n    > 35 |     expect(result).toEqual({ count: 0, subscription: 'stars', level: 0, userData: null, isExist: false })\n         |                    ^\n      36 |   })\n      37 |\n      38 |   it('returns correct data on success', async () => {\n\n      at __tests__/core/supabase/getReferalsCountAndUserData.unit.test.ts:35:20\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ‚óè getReferalsCountAndUserData ‚Ä∫ returns correct data on success\n\n    expect(received).toEqual(expected) // deep equality\n\n    - Expected  - 1\n    + Received  + 1\n\n    @@ -1,10 +1,10 @@\n      Object {\n        \"count\": 2,\n        \"isExist\": true,\n        \"level\": 3,\n    -   \"subscription\": \"silver\",\n    +   \"subscriptionType\": \"stars\",\n        \"userData\": Object {\n          \"level\": 3,\n          \"subscription\": \"silver\",\n          \"user_id\": 10,\n        },\n\n      47 |     fromMock.mockReturnValueOnce({ select: selectRefs })\n      48 |     const result = await getReferalsCountAndUserData(telegram_id)\n    > 49 |     expect(result).toEqual({ count: 2, level: 3, subscription: 'silver', userData, isExist: true })\n         |                    ^\n      50 |   })\n      51 |\n      52 |   it('returns defaults on exception', async () => {\n\n      at __tests__/core/supabase/getReferalsCountAndUserData.unit.test.ts:49:20\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ‚óè getReferalsCountAndUserData ‚Ä∫ returns defaults on exception\n\n    expect(received).toEqual(expected) // deep equality\n\n    - Expected  - 1\n    + Received  + 1\n\n      Object {\n        \"count\": 0,\n        \"isExist\": false,\n        \"level\": 0,\n    -   \"subscription\": \"stars\",\n    +   \"subscriptionType\": \"stars\",\n        \"userData\": null,\n      }\n\n      53 |     ;(supabase.from as jest.Mock).mockImplementation(() => { throw new Error('boom') })\n      54 |     const result = await getReferalsCountAndUserData(telegram_id)\n    > 55 |     expect(result).toEqual({ count: 0, subscription: 'stars', level: 0, userData: null, isExist: false })\n         |                    ^\n      56 |     expect(logger.error).toHaveBeenCalledWith('–û—à–∏–±–∫–∞ –≤ getReferalsCountAndUserData:', expect.any(Error))\n      57 |   })\n      58 | })\n\n      at __tests__/core/supabase/getReferalsCountAndUserData.unit.test.ts:55:20\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["getReferalsCountAndUserData"],"duration":1,"failureMessages":["Error: expect(received).toEqual(expected) // deep equality\n\n- Expected  - 1\n+ Received  + 1\n\n  Object {\n    \"count\": 0,\n    \"isExist\": false,\n    \"level\": 0,\n-   \"subscription\": \"stars\",\n+   \"subscriptionType\": \"stars\",\n    \"userData\": null,\n  }\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/getReferalsCountAndUserData.unit.test.ts:20:20\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"getReferalsCountAndUserData returns defaults when user fetch errors","status":"failed","title":"returns defaults when user fetch errors"},{"ancestorTitles":["getReferalsCountAndUserData"],"duration":1,"failureMessages":["Error: expect(received).toEqual(expected) // deep equality\n\n- Expected  - 4\n+ Received  + 8\n\n  Object {\n    \"count\": 0,\n-   \"isExist\": false,\n-   \"level\": 0,\n-   \"subscription\": \"stars\",\n-   \"userData\": null,\n+   \"isExist\": true,\n+   \"level\": 2,\n+   \"subscriptionType\": \"stars\",\n+   \"userData\": Object {\n+     \"level\": 2,\n+     \"subscription\": \"gold\",\n+     \"user_id\": 5,\n+   },\n  }\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/getReferalsCountAndUserData.unit.test.ts:35:20\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"getReferalsCountAndUserData returns defaults when referals fetch errors","status":"failed","title":"returns defaults when referals fetch errors"},{"ancestorTitles":["getReferalsCountAndUserData"],"duration":1,"failureMessages":["Error: expect(received).toEqual(expected) // deep equality\n\n- Expected  - 1\n+ Received  + 1\n\n@@ -1,10 +1,10 @@\n  Object {\n    \"count\": 2,\n    \"isExist\": true,\n    \"level\": 3,\n-   \"subscription\": \"silver\",\n+   \"subscriptionType\": \"stars\",\n    \"userData\": Object {\n      \"level\": 3,\n      \"subscription\": \"silver\",\n      \"user_id\": 10,\n    },\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/getReferalsCountAndUserData.unit.test.ts:49:20\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"getReferalsCountAndUserData returns correct data on success","status":"failed","title":"returns correct data on success"},{"ancestorTitles":["getReferalsCountAndUserData"],"duration":0,"failureMessages":["Error: expect(received).toEqual(expected) // deep equality\n\n- Expected  - 1\n+ Received  + 1\n\n  Object {\n    \"count\": 0,\n    \"isExist\": false,\n    \"level\": 0,\n-   \"subscription\": \"stars\",\n+   \"subscriptionType\": \"stars\",\n    \"userData\": null,\n  }\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/getReferalsCountAndUserData.unit.test.ts:55:20\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"getReferalsCountAndUserData returns defaults on exception","status":"failed","title":"returns defaults on exception"}]},{"numFailingTests":1,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168595087,"runtime":36,"slow":false,"start":1745168595051},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/replicate/index.test.ts","failureMessage":"  ‚óè core/replicate index ‚Ä∫ modelPricing has entries for all defined models\n\n    expect(received).toHaveProperty(path)\n\n    Expected path: \"black-forest-labs/flux-1.1-pro-ultra\"\n    Received path: []\n\n    Received value: {\"black-forest-labs/flux-1.1-pro\": \"$0.040 / image\", \"black-forest-labs/flux-1.1-pro-ultra\": \"$0.060 / image\", \"black-forest-labs/flux-canny-dev\": \"$0.025 / image\", \"black-forest-labs/flux-canny-pro\": \"$0.050 / image\", \"black-forest-labs/flux-depth-dev\": \"$0.025 / image\", \"black-forest-labs/flux-depth-pro\": \"$0.050 / image\", \"black-forest-labs/flux-dev\": \"$0.025 / image\", \"black-forest-labs/flux-dev-lora\": \"$0.032 / image\", \"black-forest-labs/flux-fill-dev\": \"$0.040 / image\", \"black-forest-labs/flux-fill-pro\": \"$0.050 / image\", \"black-forest-labs/flux-pro\": \"$0.055 / image\", \"black-forest-labs/flux-redux-dev\": \"$0.025 / image\", \"black-forest-labs/flux-redux-schnell\": \"$0.003 / image\", \"black-forest-labs/flux-schnell\": \"$0.003 / image\", \"black-forest-labs/flux-schnell-lora\": \"$0.020 / image\", \"ideogram-ai/ideogram-v2\": \"$0.080 / image\", \"ideogram-ai/ideogram-v2-turbo\": \"$0.050 / image\", \"luma/photon\": \"$0.030 / image\", \"luma/photon-flash\": \"$0.010 / image\", \"recraft-ai/recraft-20b\": \"$0.022 / image\", \"recraft-ai/recraft-20b-svg\": \"$0.044 / image\", \"recraft-ai/recraft-v3\": \"$0.040 / image\", \"recraft-ai/recraft-v3-svg\": \"$0.080 / image\", \"stability-ai/stable-diffusion-3\": \"$0.035 / image\", \"stability-ai/stable-diffusion-3.5-large\": \"$0.065 / image\", \"stability-ai/stable-diffusion-3.5-large-turbo\": \"$0.040 / image\", \"stability-ai/stable-diffusion-3.5-medium\": \"$0.035 / image\"}\n\n      57 |     // For each model config, ensure its key exists in pricing map\n      58 |     Object.values(models).forEach((mc) => {\n    > 59 |       expect(modelPricing).toHaveProperty(mc.key)\n         |                            ^\n      60 |     })\n      61 |   })\n      62 |\n\n      at __tests__/core/replicate/index.test.ts:59:28\n          at Array.forEach (<anonymous>)\n      at Object.<anonymous> (__tests__/core/replicate/index.test.ts:58:27)\n","testResults":[{"ancestorTitles":["core/replicate index"],"duration":0,"failureMessages":[],"fullName":"core/replicate index initializes Replicate with auth from env","status":"passed","title":"initializes Replicate with auth from env"},{"ancestorTitles":["core/replicate index"],"duration":1,"failureMessages":[],"fullName":"core/replicate index exports modelPricing mapping","status":"passed","title":"exports modelPricing mapping"},{"ancestorTitles":["core/replicate index"],"duration":1,"failureMessages":[],"fullName":"core/replicate index models.getInput returns correct dimensions for various aspect ratios","status":"passed","title":"models.getInput returns correct dimensions for various aspect ratios"},{"ancestorTitles":["core/replicate index"],"duration":4,"failureMessages":["Error: expect(received).toHaveProperty(path)\n\nExpected path: \"black-forest-labs/flux-1.1-pro-ultra\"\nReceived path: []\n\nReceived value: {\"black-forest-labs/flux-1.1-pro\": \"$0.040 / image\", \"black-forest-labs/flux-1.1-pro-ultra\": \"$0.060 / image\", \"black-forest-labs/flux-canny-dev\": \"$0.025 / image\", \"black-forest-labs/flux-canny-pro\": \"$0.050 / image\", \"black-forest-labs/flux-depth-dev\": \"$0.025 / image\", \"black-forest-labs/flux-depth-pro\": \"$0.050 / image\", \"black-forest-labs/flux-dev\": \"$0.025 / image\", \"black-forest-labs/flux-dev-lora\": \"$0.032 / image\", \"black-forest-labs/flux-fill-dev\": \"$0.040 / image\", \"black-forest-labs/flux-fill-pro\": \"$0.050 / image\", \"black-forest-labs/flux-pro\": \"$0.055 / image\", \"black-forest-labs/flux-redux-dev\": \"$0.025 / image\", \"black-forest-labs/flux-redux-schnell\": \"$0.003 / image\", \"black-forest-labs/flux-schnell\": \"$0.003 / image\", \"black-forest-labs/flux-schnell-lora\": \"$0.020 / image\", \"ideogram-ai/ideogram-v2\": \"$0.080 / image\", \"ideogram-ai/ideogram-v2-turbo\": \"$0.050 / image\", \"luma/photon\": \"$0.030 / image\", \"luma/photon-flash\": \"$0.010 / image\", \"recraft-ai/recraft-20b\": \"$0.022 / image\", \"recraft-ai/recraft-20b-svg\": \"$0.044 / image\", \"recraft-ai/recraft-v3\": \"$0.040 / image\", \"recraft-ai/recraft-v3-svg\": \"$0.080 / image\", \"stability-ai/stable-diffusion-3\": \"$0.035 / image\", \"stability-ai/stable-diffusion-3.5-large\": \"$0.065 / image\", \"stability-ai/stable-diffusion-3.5-large-turbo\": \"$0.040 / image\", \"stability-ai/stable-diffusion-3.5-medium\": \"$0.035 / image\"}\n    at /Users/playom/999-multibots-telegraf/__tests__/core/replicate/index.test.ts:59:28\n    at Array.forEach (<anonymous>)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/replicate/index.test.ts:58:27)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"core/replicate index modelPricing has entries for all defined models","status":"failed","title":"modelPricing has entries for all defined models"},{"ancestorTitles":["core/replicate index"],"duration":2,"failureMessages":[],"fullName":"core/replicate index getInput works for all models","status":"passed","title":"getInput works for all models"}]},{"numFailingTests":2,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168595125,"runtime":36,"slow":false,"start":1745168595089},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/services/generateVoiceAvatar.test.ts","failureMessage":"  ‚óè generateVoiceAvatar ‚Ä∫ production branch calls axios.post and returns data\n\n    expect(received).toEqual(expected) // deep equality\n\n    - Expected  - 2\n    + Received  + 2\n\n      Object {\n    -   \"message\": \"ok\",\n    -   \"success\": true,\n    +   \"message\": \"Function temporarily unavailable\",\n    +   \"success\": false,\n      }\n\n      51 |     const ctx2 = makeCtx()\n      52 |     const result = await generateVoiceAvatar('imgUrl', 'desc', '99', ctx2, false, 'botName')\n    > 53 |     expect(result).toEqual({ success: true, message: 'ok' })\n         |                    ^\n      54 |     expect(axios.post).toHaveBeenCalledWith(\n      55 |       'https://api.prod/generate/voice-avatar',\n      56 |       {\n\n      at __tests__/services/generateVoiceAvatar.test.ts:53:20\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ‚óè generateVoiceAvatar ‚Ä∫ error branch calls sendGenericErrorMessage and returns null\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: {\"from\": {\"username\": \"user\"}, \"reply\": [Function mockConstructor]}, false, [Error: fail]\n\n    Number of calls: 0\n\n      73 |     const ctx3 = makeCtx()\n      74 |     const res = await generateVoiceAvatar('i', 'p', '1', ctx3, false, 'bot')\n    > 75 |     expect(sendGenericErrorMessage).toHaveBeenCalledWith(\n         |                                     ^\n      76 |       ctx3,\n      77 |       false,\n      78 |       err\n\n      at __tests__/services/generateVoiceAvatar.test.ts:75:37\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["generateVoiceAvatar"],"duration":0,"failureMessages":[],"fullName":"generateVoiceAvatar fallback branch when ELESTIO_URL not set","status":"passed","title":"fallback branch when ELESTIO_URL not set"},{"ancestorTitles":["generateVoiceAvatar"],"duration":0,"failureMessages":["Error: expect(received).toEqual(expected) // deep equality\n\n- Expected  - 2\n+ Received  + 2\n\n  Object {\n-   \"message\": \"ok\",\n-   \"success\": true,\n+   \"message\": \"Function temporarily unavailable\",\n+   \"success\": false,\n  }\n    at /Users/playom/999-multibots-telegraf/__tests__/services/generateVoiceAvatar.test.ts:53:20\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"generateVoiceAvatar production branch calls axios.post and returns data","status":"failed","title":"production branch calls axios.post and returns data"},{"ancestorTitles":["generateVoiceAvatar"],"duration":1,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: {\"from\": {\"username\": \"user\"}, \"reply\": [Function mockConstructor]}, false, [Error: fail]\n\nNumber of calls: 0\n    at /Users/playom/999-multibots-telegraf/__tests__/services/generateVoiceAvatar.test.ts:75:37\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"generateVoiceAvatar error branch calls sendGenericErrorMessage and returns null","status":"failed","title":"error branch calls sendGenericErrorMessage and returns null"}]},{"numFailingTests":4,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168595165,"runtime":38,"slow":false,"start":1745168595127},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getTranslation.test.ts","failureMessage":"  ‚óè getTranslation ‚Ä∫ returns translation when first fetch succeeds\n\n    expect(received).toEqual(expected) // deep equality\n\n    - Expected  - 0\n    + Received  + 1\n\n      Object {\n    +   \"buttons\": Array [],\n        \"translation\": \"t1\",\n        \"url\": \"u1\",\n      }\n\n      37 |     mockSingle.mockResolvedValue({ data: { translation: 't1', url: 'u1' }, error: null })\n      38 |     const res = await getTranslation({ key, ctx, bot_name: 'bot1' })\n    > 39 |     expect(res).toEqual({ translation: 't1', url: 'u1' })\n         |                 ^\n      40 |   })\n      41 |\n      42 |   it('falls back to default bot when first fetch errors and default succeeds', async () => {\n\n      at Object.<anonymous> (__tests__/core/supabase/getTranslation.test.ts:39:17)\n      at fulfilled (__tests__/core/supabase/getTranslation.test.ts:4:58)\n\n  ‚óè getTranslation ‚Ä∫ falls back to default bot when first fetch errors and default succeeds\n\n    expect(received).toEqual(expected) // deep equality\n\n    - Expected  - 0\n    + Received  + 1\n\n      Object {\n    +   \"buttons\": Array [],\n        \"translation\": \"t2\",\n        \"url\": \"u2\",\n      }\n\n      47 |     const res = await getTranslation({ key, ctx, bot_name: undefined })\n      48 |     expect(gtbt).toHaveBeenCalledWith('tok1')\n    > 49 |     expect(res).toEqual({ translation: 't2', url: 'u2' })\n         |                 ^\n      50 |   })\n      51 |\n      52 |   it('returns fallback when both fetches error', async () => {\n\n      at Object.<anonymous> (__tests__/core/supabase/getTranslation.test.ts:49:17)\n      at fulfilled (__tests__/core/supabase/getTranslation.test.ts:4:58)\n\n  ‚óè getTranslation ‚Ä∫ returns fallback when both fetches error\n\n    expect(received).toEqual(expected) // deep equality\n\n    - Expected  - 1\n    + Received  + 2\n\n      Object {\n    -   \"translation\": \"–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ NeuroBot! –ë–æ—Ç –≥–æ—Ç–æ–≤ –ø–æ–º–æ—á—å –≤–∞–º —Å –Ω–µ–π—Ä–æ—Å–µ—Ç—è–º–∏.\",\n    +   \"buttons\": Array [],\n    +   \"translation\": \"–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –ë–æ—Ç –≥–æ—Ç–æ–≤ –ø–æ–º–æ—á—å.\",\n        \"url\": \"\",\n      }\n\n      53 |     mockSingle.mockResolvedValue({ data: null, error: { message: 'e' } })\n      54 |     const res = await getTranslation({ key, ctx, bot_name: undefined })\n    > 55 |     expect(res).toEqual(expectedFallback)\n         |                 ^\n      56 |   })\n      57 |\n      58 |   it('returns fallback on exception', async () => {\n\n      at Object.<anonymous> (__tests__/core/supabase/getTranslation.test.ts:55:17)\n      at fulfilled (__tests__/core/supabase/getTranslation.test.ts:4:58)\n\n  ‚óè getTranslation ‚Ä∫ returns fallback on exception\n\n    expect(received).toEqual(expected) // deep equality\n\n    - Expected  - 1\n    + Received  + 2\n\n      Object {\n    -   \"translation\": \"–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ NeuroBot! –ë–æ—Ç –≥–æ—Ç–æ–≤ –ø–æ–º–æ—á—å –≤–∞–º —Å –Ω–µ–π—Ä–æ—Å–µ—Ç—è–º–∏.\",\n    +   \"buttons\": Array [],\n    +   \"translation\": \"–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –ë–æ—Ç –≥–æ—Ç–æ–≤ –ø–æ–º–æ—á—å.\",\n        \"url\": \"\",\n      }\n\n      59 |     mockSelect.mockImplementation(() => { throw new Error('oops') })\n      60 |     const res = await getTranslation({ key, ctx, bot_name: 'bot1' })\n    > 61 |     expect(res).toEqual(expectedFallback)\n         |                 ^\n      62 |   })\n      63 | })\n\n      at Object.<anonymous> (__tests__/core/supabase/getTranslation.test.ts:61:17)\n      at fulfilled (__tests__/core/supabase/getTranslation.test.ts:4:58)\n","testResults":[{"ancestorTitles":["getTranslation"],"duration":2,"failureMessages":["Error: expect(received).toEqual(expected) // deep equality\n\n- Expected  - 0\n+ Received  + 1\n\n  Object {\n+   \"buttons\": Array [],\n    \"translation\": \"t1\",\n    \"url\": \"u1\",\n  }\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getTranslation.test.ts:39:17)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getTranslation.test.ts:4:58)"],"fullName":"getTranslation returns translation when first fetch succeeds","status":"failed","title":"returns translation when first fetch succeeds"},{"ancestorTitles":["getTranslation"],"duration":1,"failureMessages":["Error: expect(received).toEqual(expected) // deep equality\n\n- Expected  - 0\n+ Received  + 1\n\n  Object {\n+   \"buttons\": Array [],\n    \"translation\": \"t2\",\n    \"url\": \"u2\",\n  }\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getTranslation.test.ts:49:17)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getTranslation.test.ts:4:58)"],"fullName":"getTranslation falls back to default bot when first fetch errors and default succeeds","status":"failed","title":"falls back to default bot when first fetch errors and default succeeds"},{"ancestorTitles":["getTranslation"],"duration":0,"failureMessages":["Error: expect(received).toEqual(expected) // deep equality\n\n- Expected  - 1\n+ Received  + 2\n\n  Object {\n-   \"translation\": \"–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ NeuroBot! –ë–æ—Ç –≥–æ—Ç–æ–≤ –ø–æ–º–æ—á—å –≤–∞–º —Å –Ω–µ–π—Ä–æ—Å–µ—Ç—è–º–∏.\",\n+   \"buttons\": Array [],\n+   \"translation\": \"–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –ë–æ—Ç –≥–æ—Ç–æ–≤ –ø–æ–º–æ—á—å.\",\n    \"url\": \"\",\n  }\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getTranslation.test.ts:55:17)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getTranslation.test.ts:4:58)"],"fullName":"getTranslation returns fallback when both fetches error","status":"failed","title":"returns fallback when both fetches error"},{"ancestorTitles":["getTranslation"],"duration":1,"failureMessages":["Error: expect(received).toEqual(expected) // deep equality\n\n- Expected  - 1\n+ Received  + 2\n\n  Object {\n-   \"translation\": \"–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ NeuroBot! –ë–æ—Ç –≥–æ—Ç–æ–≤ –ø–æ–º–æ—á—å –≤–∞–º —Å –Ω–µ–π—Ä–æ—Å–µ—Ç—è–º–∏.\",\n+   \"buttons\": Array [],\n+   \"translation\": \"–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –ë–æ—Ç –≥–æ—Ç–æ–≤ –ø–æ–º–æ—á—å.\",\n    \"url\": \"\",\n  }\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getTranslation.test.ts:61:17)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getTranslation.test.ts:4:58)"],"fullName":"getTranslation returns fallback on exception","status":"failed","title":"returns fallback on exception"}]},{"numFailingTests":3,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168595201,"runtime":35,"slow":false,"start":1745168595166},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/neuroPhotoWizardV2.test.ts","failureMessage":"  ‚óè neuroPhotoWizardV2 ‚Ä∫ step 0: no model replies and leaves\n\n    Property `createHelpCancelKeyboard` does not exist in the provided object\n\n      41 |     const mockReferals = getReferalsCountAndUserData as jest.Mock;\n      42 |     mockReferals.mockResolvedValueOnce({ count: 0, subscription: '', level: 0 });\n    > 43 |     const createKb = jest.spyOn(menu, 'createHelpCancelKeyboard').mockReturnValue({} as any)\n         |                           ^\n      44 |\n      45 |     const step0 = Composer.unwrap(neuroPhotoWizardV2.steps[0])\n      46 |     await step0(ctx, async () => {})\n\n      at ModuleMocker.spyOn (node_modules/.pnpm/jest-mock@29.7.0/node_modules/jest-mock/build/index.js:731:13)\n      at __tests__/scenes/neuroPhotoWizardV2.test.ts:43:27\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/neuroPhotoWizardV2.test.ts:38:56)\n\n  ‚óè neuroPhotoWizardV2 ‚Ä∫ step 0: with model sends description request and next()\n\n    Property `createHelpCancelKeyboard` does not exist in the provided object\n\n      60 |     const mockCancel = handleHelpCancel as jest.Mock;\n      61 |     mockCancel.mockResolvedValueOnce(false);\n    > 62 |     const createKb = jest.spyOn(menu, 'createHelpCancelKeyboard').mockReturnValue({} as any)\n         |                           ^\n      63 |\n      64 |     const step0 = Composer.unwrap(neuroPhotoWizardV2.steps[0])\n      65 |     await step0(ctx, async () => {})\n\n      at ModuleMocker.spyOn (node_modules/.pnpm/jest-mock@29.7.0/node_modules/jest-mock/build/index.js:731:13)\n      at __tests__/scenes/neuroPhotoWizardV2.test.ts:62:27\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/neuroPhotoWizardV2.test.ts:54:76)\n\n  ‚óè neuroPhotoWizardV2 ‚Ä∫ step 1: valid prompt generates image and leaves\n\n    Property `handleHelpCancel` does not exist in the provided object\n\n      72 |     ctx.message = { text: 'desc' };\n      73 |     ctx.session.userModel = { trigger_word: 'x' };\n    > 74 |     const handleHelpCancel = jest.spyOn(handlers, 'handleHelpCancel').mockResolvedValue(false)\n         |                                   ^\n      75 |     const getModel = jest.spyOn(supabase, 'getModel').mockResolvedValue('some_model')\n      76 |\n      77 |     const step1 = Composer.unwrap(neuroPhotoWizardV2.steps[1])\n\n      at ModuleMocker.spyOn (node_modules/.pnpm/jest-mock@29.7.0/node_modules/jest-mock/build/index.js:731:13)\n      at __tests__/scenes/neuroPhotoWizardV2.test.ts:74:35\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/neuroPhotoWizardV2.test.ts:71:68)\n","testResults":[{"ancestorTitles":["neuroPhotoWizardV2"],"duration":1,"failureMessages":["Error: Property `createHelpCancelKeyboard` does not exist in the provided object\n    at ModuleMocker.spyOn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-mock@29.7.0/node_modules/jest-mock/build/index.js:731:13)\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/neuroPhotoWizardV2.test.ts:43:27\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/neuroPhotoWizardV2.test.ts:38:56)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"neuroPhotoWizardV2 step 0: no model replies and leaves","status":"failed","title":"step 0: no model replies and leaves"},{"ancestorTitles":["neuroPhotoWizardV2"],"duration":1,"failureMessages":["Error: Property `createHelpCancelKeyboard` does not exist in the provided object\n    at ModuleMocker.spyOn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-mock@29.7.0/node_modules/jest-mock/build/index.js:731:13)\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/neuroPhotoWizardV2.test.ts:62:27\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/neuroPhotoWizardV2.test.ts:54:76)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"neuroPhotoWizardV2 step 0: with model sends description request and next()","status":"failed","title":"step 0: with model sends description request and next()"},{"ancestorTitles":["neuroPhotoWizardV2"],"duration":0,"failureMessages":["Error: Property `handleHelpCancel` does not exist in the provided object\n    at ModuleMocker.spyOn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-mock@29.7.0/node_modules/jest-mock/build/index.js:731:13)\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/neuroPhotoWizardV2.test.ts:74:35\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/neuroPhotoWizardV2.test.ts:71:68)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"neuroPhotoWizardV2 step 1: valid prompt generates image and leaves","status":"failed","title":"step 1: valid prompt generates image and leaves"}]},{"numFailingTests":1,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168595244,"runtime":41,"slow":false,"start":1745168595203},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/digitalAvatarBodyWizard.test.ts","failureMessage":"  ‚óè digitalAvatarBodyWizard ‚Ä∫ step 0: sends cost message and next\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: [10, 20, 30], true\n    Received: undefined, true, \"v1\"\n\n    Number of calls: 1\n\n      28 |     getStepSelectionMenu.mockReturnValue({ keyboard: [] })\n      29 |     await steps[0](ctx)\n    > 30 |     expect(generateCostMessage).toHaveBeenCalledWith([10,20,30], true)\n         |                                 ^\n      31 |     expect(ctx.reply).toHaveBeenCalledWith('cost msg', {keyboard: []})\n      32 |     expect(ctx.wizard.next).toHaveBeenCalled()\n      33 |   })\n\n      at __tests__/scenes/digitalAvatarBodyWizard.test.ts:30:33\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["digitalAvatarBodyWizard"],"duration":0,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: [10, 20, 30], true\nReceived: undefined, true, \"v1\"\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/digitalAvatarBodyWizard.test.ts:30:33\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"digitalAvatarBodyWizard step 0: sends cost message and next","status":"failed","title":"step 0: sends cost message and next"},{"ancestorTitles":["digitalAvatarBodyWizard"],"duration":1,"failureMessages":[],"fullName":"digitalAvatarBodyWizard step 1: numeric input, leaveScene=false","status":"passed","title":"step 1: numeric input, leaveScene=false"},{"ancestorTitles":["digitalAvatarBodyWizard"],"duration":1,"failureMessages":[],"fullName":"digitalAvatarBodyWizard step 1: numeric input, leaveScene=true","status":"passed","title":"step 1: numeric input, leaveScene=true"},{"ancestorTitles":["digitalAvatarBodyWizard"],"duration":0,"failureMessages":[],"fullName":"digitalAvatarBodyWizard step 1: non-numeric input and cancel","status":"passed","title":"step 1: non-numeric input and cancel"},{"ancestorTitles":["digitalAvatarBodyWizard"],"duration":0,"failureMessages":[],"fullName":"digitalAvatarBodyWizard step 1: non-numeric input and not cancel","status":"passed","title":"step 1: non-numeric input and not cancel"}]},{"numFailingTests":2,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168595279,"runtime":33,"slow":false,"start":1745168595246},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserLevel.unit.test.ts","failureMessage":"  ‚óè getUserLevel ‚Ä∫ returns null on supabase error\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    - Expected\n    + Received\n\n    - \"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —É—Ä–æ–≤–Ω—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:\",\n    + \"–û—à–∏–±–∫–∞ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ getUserLevel:\",\n    - Object {\n    -   \"message\": \"err\",\n    - }\n    + [TypeError: supabase_1.supabase.from(...).select(...).eq is not a function],\n\n    Number of calls: 1\n\n      18 |     const result = await getUserLevel(telegram_id)\n      19 |     expect(result).toBeNull()\n    > 20 |     expect(consoleErrorSpy).toHaveBeenCalledWith('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —É—Ä–æ–≤–Ω—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', { message: 'err' })\n         |                             ^\n      21 |     consoleErrorSpy.mockRestore()\n      22 |   })\n      23 |\n\n      at __tests__/core/supabase/getUserLevel.unit.test.ts:20:29\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ‚óè getUserLevel ‚Ä∫ returns level when data present\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 7\n    Received: null\n\n      28 |     ;(supabase.from as jest.Mock).mockReturnValue({ select: selectMock })\n      29 |     const result = await getUserLevel(telegram_id)\n    > 30 |     expect(result).toBe(7)\n         |                    ^\n      31 |   })\n      32 |\n      33 |   it('returns null when data is null', async () => {\n\n      at __tests__/core/supabase/getUserLevel.unit.test.ts:30:20\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["getUserLevel"],"duration":1,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n- Expected\n+ Received\n\n- \"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —É—Ä–æ–≤–Ω—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:\",\n+ \"–û—à–∏–±–∫–∞ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ getUserLevel:\",\n- Object {\n-   \"message\": \"err\",\n- }\n+ [TypeError: supabase_1.supabase.from(...).select(...).eq is not a function],\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserLevel.unit.test.ts:20:29\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"getUserLevel returns null on supabase error","status":"failed","title":"returns null on supabase error"},{"ancestorTitles":["getUserLevel"],"duration":1,"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 7\nReceived: null\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserLevel.unit.test.ts:30:20\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"getUserLevel returns level when data present","status":"failed","title":"returns level when data present"},{"ancestorTitles":["getUserLevel"],"duration":0,"failureMessages":[],"fullName":"getUserLevel returns null when data is null","status":"passed","title":"returns null when data is null"},{"ancestorTitles":["getUserLevel"],"duration":1,"failureMessages":[],"fullName":"getUserLevel returns null on exception","status":"passed","title":"returns null on exception"}]},{"numFailingTests":2,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168595320,"runtime":39,"slow":false,"start":1745168595281},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/handleTrainingCost.test.ts","failureMessage":"  ‚óè handleTrainingCost ‚Ä∫ should prompt and set leaveScene=true when balance is insufficient (RU)\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: 4, Any<Object>\n\n    Number of calls: 0\n\n      34 |\n      35 |     const result = await handleTrainingCost(ctx, steps, isRu)\n    > 36 |     expect(calculateCostInStars).toHaveBeenCalledWith(steps, expect.any(Object))\n         |                                  ^\n      37 |     expect(getUserBalance).toHaveBeenCalledWith(123)\n      38 |     expect(ctx.reply).toHaveBeenCalledWith(\n      39 |       expect.stringContaining('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤–µ–∑–¥ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏!'),\n\n      at __tests__/price/handleTrainingCost.test.ts:36:34\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ‚óè handleTrainingCost ‚Ä∫ should return leaveScene=false when balance is sufficient\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 1\n    Received: 0.88\n\n      52 |     const result = await handleTrainingCost(ctx, steps, false)\n      53 |     expect(result.leaveScene).toBe(false)\n    > 54 |     expect(result.trainingCostInStars).toBe(steps * 0.25)\n         |                                        ^\n      55 |     expect(result.currentBalance).toBe(steps * 0.25 + 10)\n      56 |     expect(ctx.reply).not.toHaveBeenCalled()\n      57 |   })\n\n      at __tests__/price/handleTrainingCost.test.ts:54:40\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["handleTrainingCost"],"duration":5,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: 4, Any<Object>\n\nNumber of calls: 0\n    at /Users/playom/999-multibots-telegraf/__tests__/price/handleTrainingCost.test.ts:36:34\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"handleTrainingCost should prompt and set leaveScene=true when balance is insufficient (RU)","status":"failed","title":"should prompt and set leaveScene=true when balance is insufficient (RU)"},{"ancestorTitles":["handleTrainingCost"],"duration":1,"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 1\nReceived: 0.88\n    at /Users/playom/999-multibots-telegraf/__tests__/price/handleTrainingCost.test.ts:54:40\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"handleTrainingCost should return leaveScene=false when balance is sufficient","status":"failed","title":"should return leaveScene=false when balance is sufficient"}]},{"numFailingTests":3,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168595354,"runtime":32,"slow":false,"start":1745168595322},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.unit.test.ts","failureMessage":"  ‚óè updateUserSubscription ‚Ä∫ resolves data on successful update\n\n    –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n\n      17 |   } catch (error) {\n      18 |     console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error)\n    > 19 |     throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è')\n         |           ^\n      20 |   }\n      21 | }\n      22 |\n\n      at src/core/supabase/updateUserSubscription.ts:19:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at updateUserSubscription (src/core/supabase/updateUserSubscription.ts:6:20)\n      at __tests__/core/supabase/updateUserSubscription.unit.test.ts:21:48\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/core/supabase/updateUserSubscription.unit.test.ts:15:55)\n\n  ‚óè updateUserSubscription ‚Ä∫ throws error when update returns error\n\n    expect(received).rejects.toBe(expected) // Object.is equality\n\n    - Expected  - 3\n    + Received  + 1\n\n    - Object {\n    -   \"message\": \"errSub\",\n    - }\n    + [Error: –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è]\n\n      30 |     const updateMock = jest.fn().mockResolvedValue({ data: null, error: err })\n      31 |     ;(supabase.from as jest.Mock).mockReturnValue({ update: updateMock, eq: eqMock })\n    > 32 |     await expect(updateUserSubscription(userId, subscription)).rejects.toBe(err)\n         |                                                                        ^\n      33 |   })\n      34 |\n      35 |   it('throws error on unexpected exception', async () => {\n\n      at Object.toBe (node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n      at __tests__/core/supabase/updateUserSubscription.unit.test.ts:32:72\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/core/supabase/updateUserSubscription.unit.test.ts:27:59)\n\n  ‚óè updateUserSubscription ‚Ä∫ throws error on unexpected exception\n\n    expect(received).rejects.toThrow(expected)\n\n    Expected substring: \"boom\"\n    Received message:   \"–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\"\n\n          17 |   } catch (error) {\n          18 |     console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error)\n        > 19 |     throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è')\n             |           ^\n          20 |   }\n          21 | }\n          22 |\n\n      at src/core/supabase/updateUserSubscription.ts:19:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at updateUserSubscription (src/core/supabase/updateUserSubscription.ts:6:20)\n      at __tests__/core/supabase/updateUserSubscription.unit.test.ts:37:40\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/core/supabase/updateUserSubscription.unit.test.ts:35:57)\n      at Object.toThrow (node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n      at __tests__/core/supabase/updateUserSubscription.unit.test.ts:37:72\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/core/supabase/updateUserSubscription.unit.test.ts:35:57)\n","testResults":[{"ancestorTitles":["updateUserSubscription"],"duration":1,"failureMessages":["Error: –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n    at /Users/playom/999-multibots-telegraf/src/core/supabase/updateUserSubscription.ts:19:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at updateUserSubscription (/Users/playom/999-multibots-telegraf/src/core/supabase/updateUserSubscription.ts:6:20)\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.unit.test.ts:21:48\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.unit.test.ts:15:55)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"updateUserSubscription resolves data on successful update","status":"failed","title":"resolves data on successful update"},{"ancestorTitles":["updateUserSubscription"],"duration":1,"failureMessages":["Error: expect(received).rejects.toBe(expected) // Object.is equality\n\n- Expected  - 3\n+ Received  + 1\n\n- Object {\n-   \"message\": \"errSub\",\n- }\n+ [Error: –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è]\n    at Object.toBe (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.unit.test.ts:32:72\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.unit.test.ts:27:59)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"updateUserSubscription throws error when update returns error","status":"failed","title":"throws error when update returns error"},{"ancestorTitles":["updateUserSubscription"],"duration":1,"failureMessages":["Error: expect(received).rejects.toThrow(expected)\n\nExpected substring: \"boom\"\nReceived message:   \"–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\"\n\n      17 |   } catch (error) {\n      18 |     console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error)\n    > 19 |     throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è')\n         |           ^\n      20 |   }\n      21 | }\n      22 |\n\n      at src/core/supabase/updateUserSubscription.ts:19:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at updateUserSubscription (src/core/supabase/updateUserSubscription.ts:6:20)\n      at __tests__/core/supabase/updateUserSubscription.unit.test.ts:37:40\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/core/supabase/updateUserSubscription.unit.test.ts:35:57)\n    at Object.toThrow (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.unit.test.ts:37:72\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.unit.test.ts:35:57)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"updateUserSubscription throws error on unexpected exception","status":"failed","title":"throws error on unexpected exception"}]},{"numFailingTests":2,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168595394,"runtime":38,"slow":false,"start":1745168595356},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/menu/cancelMenu.test.ts","failureMessage":"  ‚óè cancelMenu ‚Ä∫ creates keyboard with Cancel in English\n\n    expect(received).toEqual(expected) // deep equality\n\n    - Expected  - 0\n    + Received  + 1\n\n      Array [\n        Array [\n          Object {\n    +       \"hide\": false,\n            \"text\": \"Cancel\",\n          },\n        ],\n      ]\n\n       5 |     const markup = cancelMenu(false)\n       6 |     // @ts-ignore\n    >  7 |     expect(markup.reply_markup.keyboard).toEqual([[{ text: 'Cancel' }]])\n         |                                          ^\n       8 |   })\n       9 |\n      10 |   it('creates keyboard with –û—Ç–º–µ–Ω–∞ in Russian', () => {\n\n      at Object.<anonymous> (__tests__/menu/cancelMenu.test.ts:7:42)\n\n  ‚óè cancelMenu ‚Ä∫ creates keyboard with –û—Ç–º–µ–Ω–∞ in Russian\n\n    expect(received).toEqual(expected) // deep equality\n\n    - Expected  - 0\n    + Received  + 1\n\n      Array [\n        Array [\n          Object {\n    +       \"hide\": false,\n            \"text\": \"–û—Ç–º–µ–Ω–∞\",\n          },\n        ],\n      ]\n\n      11 |     const markup = cancelMenu(true)\n      12 |     // @ts-ignore\n    > 13 |     expect(markup.reply_markup.keyboard).toEqual([[{ text: '–û—Ç–º–µ–Ω–∞' }]])\n         |                                          ^\n      14 |   })\n      15 | })\n\n      at Object.<anonymous> (__tests__/menu/cancelMenu.test.ts:13:42)\n","testResults":[{"ancestorTitles":["cancelMenu"],"duration":1,"failureMessages":["Error: expect(received).toEqual(expected) // deep equality\n\n- Expected  - 0\n+ Received  + 1\n\n  Array [\n    Array [\n      Object {\n+       \"hide\": false,\n        \"text\": \"Cancel\",\n      },\n    ],\n  ]\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/menu/cancelMenu.test.ts:7:42)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"cancelMenu creates keyboard with Cancel in English","status":"failed","title":"creates keyboard with Cancel in English"},{"ancestorTitles":["cancelMenu"],"duration":4,"failureMessages":["Error: expect(received).toEqual(expected) // deep equality\n\n- Expected  - 0\n+ Received  + 1\n\n  Array [\n    Array [\n      Object {\n+       \"hide\": false,\n        \"text\": \"–û—Ç–º–µ–Ω–∞\",\n      },\n    ],\n  ]\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/menu/cancelMenu.test.ts:13:42)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"cancelMenu creates keyboard with –û—Ç–º–µ–Ω–∞ in Russian","status":"failed","title":"creates keyboard with –û—Ç–º–µ–Ω–∞ in Russian"}]},{"numFailingTests":2,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168595461,"runtime":65,"slow":false,"start":1745168595396},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getLatestUserModel.unit.test.ts","failureMessage":"  ‚óè getLatestUserModel ‚Ä∫ returns null on error\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    - Expected\n    + Received\n\n      \"Error getting user model:\",\n    - Object {\n    -   \"message\": \"err\",\n    - }\n    + [TypeError: supabase_1.supabase.from(...).select(...).eq is not a function],\n\n    Number of calls: 1\n\n      19 |     const result = await getLatestUserModel(telegram_id, api)\n      20 |     expect(result).toBeNull()\n    > 21 |     expect(consoleErrorSpy).toHaveBeenCalledWith('Error getting user model:', { message: 'err' })\n         |                             ^\n      22 |     consoleErrorSpy.mockRestore()\n      23 |   })\n      24 |\n\n      at __tests__/core/supabase/getLatestUserModel.unit.test.ts:21:29\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ‚óè getLatestUserModel ‚Ä∫ returns data on success\n\n    expect(received).toEqual(expected) // deep equality\n\n    Expected: {\"api\": \"apiX\", \"id\": \"x\", \"status\": \"SUCCESS\", \"telegram_id\": 10}\n    Received: null\n\n      30 |     const consoleLogSpy = jest.spyOn(console, 'log').mockImplementation(() => {})\n      31 |     const result = await getLatestUserModel(telegram_id, api)\n    > 32 |     expect(result).toEqual(modelTraining)\n         |                    ^\n      33 |     expect(consoleLogSpy).toHaveBeenCalledWith(modelTraining, 'getLatestUserModel')\n      34 |     consoleLogSpy.mockRestore()\n      35 |   })\n\n      at __tests__/core/supabase/getLatestUserModel.unit.test.ts:32:20\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["getLatestUserModel"],"duration":3,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n- Expected\n+ Received\n\n  \"Error getting user model:\",\n- Object {\n-   \"message\": \"err\",\n- }\n+ [TypeError: supabase_1.supabase.from(...).select(...).eq is not a function],\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/getLatestUserModel.unit.test.ts:21:29\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"getLatestUserModel returns null on error","status":"failed","title":"returns null on error"},{"ancestorTitles":["getLatestUserModel"],"duration":1,"failureMessages":["Error: expect(received).toEqual(expected) // deep equality\n\nExpected: {\"api\": \"apiX\", \"id\": \"x\", \"status\": \"SUCCESS\", \"telegram_id\": 10}\nReceived: null\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/getLatestUserModel.unit.test.ts:32:20\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"getLatestUserModel returns data on success","status":"failed","title":"returns data on success"},{"ancestorTitles":["getLatestUserModel"],"duration":1,"failureMessages":[],"fullName":"getLatestUserModel returns null on exception","status":"passed","title":"returns null on exception"}]},{"numFailingTests":2,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168595547,"runtime":82,"slow":false,"start":1745168595465},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getHistory.unit.test.ts","failureMessage":"  ‚óè getHistory ‚Ä∫ returns empty array on error\n\n    TypeError: supabase_1.supabase.from(...).select(...).order(...).limit(...).eq(...).eq is not a function\n\n      12 |     .limit(10)\n      13 |     .eq('brand', brand)\n    > 14 |     .eq('command', command)\n         |      ^\n      15 |     .eq('type', type)\n      16 |\n      17 |   if (error) {\n\n      at src/core/supabase/getHistory.ts:14:6\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at getHistory (src/core/supabase/getHistory.ts:7:5)\n      at __tests__/core/supabase/getHistory.unit.test.ts:26:36\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/core/supabase/getHistory.unit.test.ts:16:49)\n\n  ‚óè getHistory ‚Ä∫ returns data on success\n\n    TypeError: supabase_1.supabase.from(...).select(...).order(...).limit(...).eq(...).eq is not a function\n\n      12 |     .limit(10)\n      13 |     .eq('brand', brand)\n    > 14 |     .eq('command', command)\n         |      ^\n      15 |     .eq('type', type)\n      16 |\n      17 |   if (error) {\n\n      at src/core/supabase/getHistory.ts:14:6\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at getHistory (src/core/supabase/getHistory.ts:7:5)\n      at __tests__/core/supabase/getHistory.unit.test.ts:42:36\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/core/supabase/getHistory.unit.test.ts:32:44)\n","testResults":[{"ancestorTitles":["getHistory"],"duration":2,"failureMessages":["TypeError: supabase_1.supabase.from(...).select(...).order(...).limit(...).eq(...).eq is not a function\n    at /Users/playom/999-multibots-telegraf/src/core/supabase/getHistory.ts:14:6\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at getHistory (/Users/playom/999-multibots-telegraf/src/core/supabase/getHistory.ts:7:5)\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/getHistory.unit.test.ts:26:36\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getHistory.unit.test.ts:16:49)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"getHistory returns empty array on error","status":"failed","title":"returns empty array on error"},{"ancestorTitles":["getHistory"],"duration":2,"failureMessages":["TypeError: supabase_1.supabase.from(...).select(...).order(...).limit(...).eq(...).eq is not a function\n    at /Users/playom/999-multibots-telegraf/src/core/supabase/getHistory.ts:14:6\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at getHistory (/Users/playom/999-multibots-telegraf/src/core/supabase/getHistory.ts:7:5)\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/getHistory.unit.test.ts:42:36\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getHistory.unit.test.ts:32:44)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"getHistory returns data on success","status":"failed","title":"returns data on success"}]},{"numFailingTests":3,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168595582,"runtime":32,"slow":false,"start":1745168595550},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/bot/getBotByName.test.ts","failureMessage":"  ‚óè getBotByName ‚Ä∫ returns error when bot name not in configuration\n\n    expect(received).toHaveProperty(path)\n\n    Matcher error: received value must not be null nor undefined\n\n    Received has value: undefined\n\n      24 |     const { getBotByName } = require('@/core/bot')\n      25 |     const res = getBotByName('unknown_bot')\n    > 26 |     expect(res).toHaveProperty('error')\n         |                 ^\n      27 |     expect(res.error).toBe('Bot not found in configuration')\n      28 |     expect(res.bot).toBeUndefined()\n      29 |   })\n\n      at Object.<anonymous> (__tests__/core/bot/getBotByName.test.ts:26:17)\n\n  ‚óè getBotByName ‚Ä∫ returns bot instance when bot name exists\n\n    expect(received).toHaveProperty(path)\n\n    Matcher error: received value must not be null nor undefined\n\n    Received has value: undefined\n\n      32 |     const { getBotByName, DEFAULT_BOT_NAME } = require('@/core/bot')\n      33 |     const res = getBotByName(DEFAULT_BOT_NAME)\n    > 34 |     expect(res).toHaveProperty('bot')\n         |                 ^\n      35 |     expect(res.bot).toBeDefined()\n      36 |     // The returned bot should have telegram.sendMessage method\n      37 |     expect(typeof res.bot.telegram?.sendMessage).toBe('function')\n\n      at Object.<anonymous> (__tests__/core/bot/getBotByName.test.ts:34:17)\n\n  ‚óè getBotByName ‚Ä∫ recreates bot instance when existing one lacks telegram.sendMessage\n\n    TypeError: Cannot convert undefined or null to object\n        at Function.keys (<anonymous>)\n\n      44 |     const botName = DEFAULT_BOT_NAME\n      45 |     // Simulate broken bot entry for this name\n    > 46 |     const idx = Object.keys(BOT_NAMES).indexOf(botName)\n         |                        ^\n      47 |     bots[idx] = {} as any\n      48 |     const res = getBotByName(botName)\n      49 |     expect(res.bot).toBeDefined()\n\n      at Object.<anonymous> (__tests__/core/bot/getBotByName.test.ts:46:24)\n","testResults":[{"ancestorTitles":["getBotByName"],"duration":6,"failureMessages":["Error: expect(received).toHaveProperty(path)\n\nMatcher error: received value must not be null nor undefined\n\nReceived has value: undefined\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/bot/getBotByName.test.ts:26:17)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"getBotByName returns error when bot name not in configuration","status":"failed","title":"returns error when bot name not in configuration"},{"ancestorTitles":["getBotByName"],"duration":1,"failureMessages":["Error: expect(received).toHaveProperty(path)\n\nMatcher error: received value must not be null nor undefined\n\nReceived has value: undefined\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/bot/getBotByName.test.ts:34:17)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"getBotByName returns bot instance when bot name exists","status":"failed","title":"returns bot instance when bot name exists"},{"ancestorTitles":["getBotByName"],"duration":1,"failureMessages":["TypeError: Cannot convert undefined or null to object\n    at Function.keys (<anonymous>)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/bot/getBotByName.test.ts:46:24)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"getBotByName recreates bot instance when existing one lacks telegram.sendMessage","status":"failed","title":"recreates bot instance when existing one lacks telegram.sendMessage"}]},{"numFailingTests":2,"numPassingTests":0,"numPendingTests":4,"numTodoTests":0,"perfStats":{"end":1745168595614,"runtime":30,"slow":false,"start":1745168595584},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/utils/logger.test.ts","failureMessage":"  ‚óè logSecurityEvent ‚Ä∫ logs security event with default severity warn\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"–°–æ–±—ã—Ç–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏: EVT\", ObjectContaining {\"eventType\": \"EVT\", \"foo\": \"bar\"}\n\n    Number of calls: 0\n\n      73 |     logSecurityEvent('EVT', details)\n      74 |     // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—ã–∑–æ–≤ –º–µ—Ç–æ–¥–∞ —É –º–æ–∫–∞ securityLogger\n    > 75 |     expect(mockedSecurityLogger.warn).toHaveBeenCalledWith(\n         |                                       ^\n      76 |       '–°–æ–±—ã—Ç–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏: EVT',\n      77 |       expect.objectContaining({ ...details, eventType: 'EVT' })\n      78 |     )\n\n      at Object.<anonymous> (__tests__/utils/logger.test.ts:75:39)\n\n  ‚óè logSecurityEvent ‚Ä∫ logs security event with specified severity\n\n    expect(jest.fn()).toHaveBeenCalled()\n\n    Expected number of calls: >= 1\n    Received number of calls:    0\n\n      82 |     logSecurityEvent('INFO_EVT', { a: 1 }, 'info')\n      83 |     // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—ã–∑–æ–≤ –º–µ—Ç–æ–¥–∞ —É –º–æ–∫–∞ securityLogger\n    > 84 |     expect(mockedSecurityLogger.info).toHaveBeenCalled()\n         |                                       ^\n      85 |   })\n      86 | })\n\n      at Object.<anonymous> (__tests__/utils/logger.test.ts:84:39)\n","testResults":[{"ancestorTitles":["botLogger"],"duration":null,"failureMessages":[],"fullName":"botLogger info logs with bot name prefix","status":"pending","title":"info logs with bot name prefix"},{"ancestorTitles":["botLogger"],"duration":null,"failureMessages":[],"fullName":"botLogger warn logs with bot name prefix","status":"pending","title":"warn logs with bot name prefix"},{"ancestorTitles":["botLogger"],"duration":null,"failureMessages":[],"fullName":"botLogger error logs with bot name prefix","status":"pending","title":"error logs with bot name prefix"},{"ancestorTitles":["botLogger"],"duration":null,"failureMessages":[],"fullName":"botLogger debug logs with bot name prefix","status":"pending","title":"debug logs with bot name prefix"},{"ancestorTitles":["logSecurityEvent"],"duration":2,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"–°–æ–±—ã—Ç–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏: EVT\", ObjectContaining {\"eventType\": \"EVT\", \"foo\": \"bar\"}\n\nNumber of calls: 0\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/utils/logger.test.ts:75:39)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"logSecurityEvent logs security event with default severity warn","status":"failed","title":"logs security event with default severity warn"},{"ancestorTitles":["logSecurityEvent"],"duration":1,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalled()\n\nExpected number of calls: >= 1\nReceived number of calls:    0\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/utils/logger.test.ts:84:39)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"logSecurityEvent logs security event with specified severity","status":"failed","title":"logs security event with specified severity"}]},{"numFailingTests":2,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168595650,"runtime":34,"slow":false,"start":1745168595616},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/bot/createBotByName.test.ts","failureMessage":"  ‚óè createBotByName ‚Ä∫ returns token, groupId and bot for valid bot name\n\n    expect(received).toBeDefined()\n\n    Received: undefined\n\n      28 |     const botName = 'neuro_blogger_bot'\n      29 |     const result = await createBotByName(botName)\n    > 30 |     expect(result).toBeDefined()\n         |                    ^\n      31 |     expect(result!.token).toBe(getTokenByBotName(botName))\n      32 |     expect(result!.groupId).toBe('group1')\n      33 |     expect(result!.bot.telegram).toBeDefined()\n\n      at Object.<anonymous> (__tests__/core/bot/createBotByName.test.ts:30:20)\n      at fulfilled (__tests__/core/bot/createBotByName.test.ts:4:58)\n\n  ‚óè createBotByName ‚Ä∫ returns undefined and logs error when bot instance not found\n\n    TypeError: Cannot convert undefined or null to object\n        at Function.keys (<anonymous>)\n\n      47 |     const botName = 'neuro_blogger_bot'\n      48 |     // Remove bot instance to simulate missing bot\n    > 49 |     const idx = Object.keys(BOT_NAMES).indexOf(botName)\n         |                        ^\n      50 |     bots[idx] = undefined as any\n      51 |     // Spy on logger.error\n      52 |     const logger = require('@/utils/logger')\n\n      at Object.<anonymous> (__tests__/core/bot/createBotByName.test.ts:49:24)\n      at __tests__/core/bot/createBotByName.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/core/bot/createBotByName.test.ts:3:12)\n      at Object.<anonymous> (__tests__/core/bot/createBotByName.test.ts:43:81)\n","testResults":[{"ancestorTitles":["createBotByName"],"duration":1,"failureMessages":["Error: expect(received).toBeDefined()\n\nReceived: undefined\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/bot/createBotByName.test.ts:30:20)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/__tests__/core/bot/createBotByName.test.ts:4:58)"],"fullName":"createBotByName returns token, groupId and bot for valid bot name","status":"failed","title":"returns token, groupId and bot for valid bot name"},{"ancestorTitles":["createBotByName"],"duration":1,"failureMessages":[],"fullName":"createBotByName returns undefined for invalid bot name","status":"passed","title":"returns undefined for invalid bot name"},{"ancestorTitles":["createBotByName"],"duration":0,"failureMessages":["TypeError: Cannot convert undefined or null to object\n    at Function.keys (<anonymous>)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/bot/createBotByName.test.ts:49:24)\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/__tests__/core/bot/createBotByName.test.ts:7:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/playom/999-multibots-telegraf/__tests__/core/bot/createBotByName.test.ts:3:12)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/bot/createBotByName.test.ts:43:81)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"createBotByName returns undefined and logs error when bot instance not found","status":"failed","title":"returns undefined and logs error when bot instance not found"}]},{"numFailingTests":1,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168595686,"runtime":29,"slow":false,"start":1745168595657},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/bot/index.error.test.ts","failureMessage":"  ‚óè core/bot index environment validation ‚Ä∫ throws error if BOT_TOKEN_TEST_2 is not set\n\n    expect(received).toThrow(expected)\n\n    Expected substring: \"BOT_TOKEN_TEST_2 is not set\"\n\n    Received function did not throw\n\n      25 |         require('@/core/bot')\n      26 |       })\n    > 27 |     }).toThrow('BOT_TOKEN_TEST_2 is not set')\n         |        ^\n      28 |   })\n      29 | })\n\n      at Object.<anonymous> (__tests__/core/bot/index.error.test.ts:27:8)\n","testResults":[{"ancestorTitles":["core/bot index environment validation"],"duration":1,"failureMessages":["Error: expect(received).toThrow(expected)\n\nExpected substring: \"BOT_TOKEN_TEST_2 is not set\"\n\nReceived function did not throw\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/bot/index.error.test.ts:27:8)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"core/bot index environment validation throws error if BOT_TOKEN_TEST_2 is not set","status":"failed","title":"throws error if BOT_TOKEN_TEST_2 is not set"}]},{"numFailingTests":1,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168595717,"runtime":30,"slow":false,"start":1745168595687},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/config/index.test.ts","failureMessage":"  ‚óè src/config/index.ts ‚Ä∫ exports correct default flags and constants\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: false\n    Received: true\n\n       9 |     expect(config.isDev).toBe(false)\n      10 |     // Credentials flag false when not set\n    > 11 |     expect(config.CREDENTIALS).toBe(false)\n         |                                ^\n      12 |     // Supabase configured flag false without env vars\n      13 |     expect(config.isSupabaseConfigured).toBe(false)\n      14 |     // NODE_ENV should reflect process.env.NODE_ENV (undefined => undefined)\n\n      at Object.<anonymous> (__tests__/config/index.test.ts:11:32)\n","testResults":[{"ancestorTitles":["src/config/index.ts"],"duration":2,"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: false\nReceived: true\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/config/index.test.ts:11:32)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"src/config/index.ts exports correct default flags and constants","status":"failed","title":"exports correct default flags and constants"}]},{"numFailingTests":1,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168595749,"runtime":30,"slow":false,"start":1745168595719},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserData.unit.test.ts","failureMessage":"  ‚óè getUserData ‚Ä∫ throws error on supabase error\n\n    expect(received).rejects.toThrow(expected)\n\n    Expected substring: \"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: [object Object]\"\n    Received message:   \"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: err\"\n\n          11 |\n          12 |   if (error) {\n        > 13 |     throw new Error(\n             |           ^\n          14 |       `–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${error.message}`\n          15 |     )\n          16 |   }\n\n      at src/core/supabase/getUserData.ts:13:11\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n      at Object.toThrow (node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n      at __tests__/core/supabase/getUserData.unit.test.ts:28:52\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/core/supabase/getUserData.unit.test.ts:25:51)\n","testResults":[{"ancestorTitles":["getUserData"],"duration":2,"failureMessages":["Error: expect(received).rejects.toThrow(expected)\n\nExpected substring: \"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: [object Object]\"\nReceived message:   \"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: err\"\n\n      11 |\n      12 |   if (error) {\n    > 13 |     throw new Error(\n         |           ^\n      14 |       `–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${error.message}`\n      15 |     )\n      16 |   }\n\n      at src/core/supabase/getUserData.ts:13:11\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at Object.toThrow (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserData.unit.test.ts:28:52\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserData.unit.test.ts:25:51)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"getUserData throws error on supabase error","status":"failed","title":"throws error on supabase error"},{"ancestorTitles":["getUserData"],"duration":1,"failureMessages":[],"fullName":"getUserData returns data when successful","status":"passed","title":"returns data when successful"},{"ancestorTitles":["getUserData"],"duration":1,"failureMessages":[],"fullName":"getUserData returns null when user not found","status":"passed","title":"returns null when user not found"}]},{"numFailingTests":1,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168595780,"runtime":29,"slow":false,"start":1745168595751},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/bot/getBotByName.error.test.ts","failureMessage":"  ‚óè getBotByName error handling ‚Ä∫ returns error when recreated bot instance lacks telegram.sendMessage\n\n    TypeError: Cannot convert undefined or null to object\n        at Function.keys (<anonymous>)\n\n      26 |       }))\n      27 |       const { getBotByName, DEFAULT_BOT_NAME, BOT_NAMES, bots } = require('@/core/bot')\n    > 28 |       const idx = Object.keys(BOT_NAMES).indexOf(DEFAULT_BOT_NAME)\n         |                          ^\n      29 |       // Break existing default bot instance to trigger recreation logic\n      30 |       bots[idx] = {} as any\n      31 |       const result = getBotByName(DEFAULT_BOT_NAME)\n\n      at __tests__/core/bot/getBotByName.error.test.ts:28:26\n      at Object.<anonymous> (__tests__/core/bot/getBotByName.error.test.ts:11:10)\n","testResults":[{"ancestorTitles":["getBotByName error handling"],"duration":1,"failureMessages":["TypeError: Cannot convert undefined or null to object\n    at Function.keys (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/__tests__/core/bot/getBotByName.error.test.ts:28:26\n    at Runtime.isolateModules (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1082:7)\n    at Object.isolateModules (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1992:12)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/bot/getBotByName.error.test.ts:11:10)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"getBotByName error handling returns error when recreated bot instance lacks telegram.sendMessage","status":"failed","title":"returns error when recreated bot instance lacks telegram.sendMessage"}]},{"numFailingTests":1,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168595809,"runtime":28,"slow":false,"start":1745168595781},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/middlewares/checkSubscription.test.ts","failureMessage":"  ‚óè checkSubscription ‚Ä∫ returns true for member statuses\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"@mychannel\", 123\n    Received: \"mychannel\", 123\n\n    Number of calls: 1\n\n      15 |     ;(ctx.telegram.getChatMember as jest.Mock).mockResolvedValue({ status: 'member' })\n      16 |     await expect(checkSubscription(ctx, channel)).resolves.toBe(true)\n    > 17 |     expect(ctx.telegram.getChatMember).toHaveBeenCalledWith('@mychannel', 123)\n         |                                        ^\n      18 |   })\n      19 |\n      20 |   it('returns false for non-member statuses', async () => {\n\n      at __tests__/middlewares/checkSubscription.test.ts:17:40\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["checkSubscription"],"duration":1,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"@mychannel\", 123\nReceived: \"mychannel\", 123\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/middlewares/checkSubscription.test.ts:17:40\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"checkSubscription returns true for member statuses","status":"failed","title":"returns true for member statuses"},{"ancestorTitles":["checkSubscription"],"duration":1,"failureMessages":[],"fullName":"checkSubscription returns false for non-member statuses","status":"passed","title":"returns false for non-member statuses"},{"ancestorTitles":["checkSubscription"],"duration":1,"failureMessages":[],"fullName":"checkSubscription throws error when from.id undefined","status":"passed","title":"throws error when from.id undefined"},{"ancestorTitles":["checkSubscription"],"duration":0,"failureMessages":[],"fullName":"checkSubscription propagates error from getChatMember","status":"passed","title":"propagates error from getChatMember"}]},{"numFailingTests":1,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168595839,"runtime":29,"slow":false,"start":1745168595810},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/config/prod.test.ts","failureMessage":"  ‚óè config production logging block ‚Ä∫ logs token existence and supabase warning in production\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"BOT_TOKEN_1 exists:\", false\n    Received\n           1: \"--- Debugging .env loading --- \"\n           2: \"[CONFIG] Current Working Directory: /Users/playom/999-multibots-telegraf\"\n           3: \"[CONFIG] Found .env files: .env\"\n\n    Number of calls: 22\n\n      29 |     expect(logSpy).toHaveBeenCalledWith('Bot tokens check in ENV:')\n      30 |     // Should log existence of BOT_TOKEN_1 (undefined => false)\n    > 31 |     expect(logSpy).toHaveBeenCalledWith('BOT_TOKEN_1 exists:', false)\n         |                    ^\n      32 |     // Should warn about missing Supabase config\n      33 |     expect(warnSpy).toHaveBeenCalledWith(\n      34 |       '‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã Supabase. –ë–æ—Ç—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è.'\n\n      at Object.<anonymous> (__tests__/config/prod.test.ts:31:20)\n","testResults":[{"ancestorTitles":["config production logging block"],"duration":2,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"BOT_TOKEN_1 exists:\", false\nReceived\n       1: \"--- Debugging .env loading --- \"\n       2: \"[CONFIG] Current Working Directory: /Users/playom/999-multibots-telegraf\"\n       3: \"[CONFIG] Found .env files: .env\"\n\nNumber of calls: 22\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/config/prod.test.ts:31:20)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"config production logging block logs token existence and supabase warning in production","status":"failed","title":"logs token existence and supabase warning in production"}]},{"numFailingTests":1,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168595866,"runtime":26,"slow":false,"start":1745168595840},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getAspectRatio.test.ts","failureMessage":"  ‚óè getAspectRatio ‚Ä∫ returns null when single throws\n\n    exception\n\n      30 |\n      31 |   it('returns null when single throws', async () => {\n    > 32 |     mockSingle.mockRejectedValue(new Error('exception'))\n         |                                  ^\n      33 |     const result = await getAspectRatio(0)\n      34 |     expect(result).toBeNull()\n      35 |   })\n\n      at __tests__/core/supabase/getAspectRatio.test.ts:32:34\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/core/supabase/getAspectRatio.test.ts:31:52)\n","testResults":[{"ancestorTitles":["getAspectRatio"],"duration":1,"failureMessages":[],"fullName":"getAspectRatio returns aspect_ratio when data exists and no error","status":"passed","title":"returns aspect_ratio when data exists and no error"},{"ancestorTitles":["getAspectRatio"],"duration":1,"failureMessages":[],"fullName":"getAspectRatio returns null when supabase returns error","status":"passed","title":"returns null when supabase returns error"},{"ancestorTitles":["getAspectRatio"],"duration":0,"failureMessages":["Error: exception\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/getAspectRatio.test.ts:32:34\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getAspectRatio.test.ts:31:52)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"getAspectRatio returns null when single throws","status":"failed","title":"returns null when single throws"}]},{"numFailingTests":1,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168595893,"runtime":22,"slow":false,"start":1745168595871},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/utils/url.test.ts","failureMessage":"  ‚óè urlJoin ‚Ä∫ skips empty or falsy segments\n\n    TypeError: Cannot read properties of null (reading 'startsWith')\n\n      20 |\n      21 |       // –£–¥–∞–ª—è–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π —Å–ª–µ—à, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å\n    > 22 |       if (normalizedPath.startsWith('/')) {\n         |                          ^\n      23 |         normalizedPath = normalizedPath.slice(1)\n      24 |       }\n      25 |\n\n      at src/utils/url.ts:22:26\n          at Array.map (<anonymous>)\n      at urlJoin (src/utils/url.ts:17:6)\n      at Object.<anonymous> (__tests__/utils/url.test.ts:15:19)\n","testResults":[{"ancestorTitles":["urlJoin"],"duration":0,"failureMessages":[],"fullName":"urlJoin joins base URL and paths without extra slashes","status":"passed","title":"joins base URL and paths without extra slashes"},{"ancestorTitles":["urlJoin"],"duration":1,"failureMessages":[],"fullName":"urlJoin returns base URL when no paths provided","status":"passed","title":"returns base URL when no paths provided"},{"ancestorTitles":["urlJoin"],"duration":0,"failureMessages":["TypeError: Cannot read properties of null (reading 'startsWith')\n    at /Users/playom/999-multibots-telegraf/src/utils/url.ts:22:26\n    at Array.map (<anonymous>)\n    at urlJoin (/Users/playom/999-multibots-telegraf/src/utils/url.ts:17:6)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/utils/url.test.ts:15:19)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"urlJoin skips empty or falsy segments","status":"failed","title":"skips empty or falsy segments"}]},{"numFailingTests":1,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168595921,"runtime":23,"slow":false,"start":1745168595898},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/commands/setCommands.test.ts","failureMessage":"  ‚óè setBotCommands ‚Ä∫ should set commands and return true on success\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    - Expected\n    + Received\n\n    @@ -5,6 +5,10 @@\n        },\n        Object {\n          \"command\": \"menu\",\n          \"description\": \"üë§ Menu / –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\",\n        },\n    +   Object {\n    +     \"command\": \"support\",\n    +     \"description\": \"üë§ Support / –¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞\",\n    +   },\n      ],\n\n    Number of calls: 1\n\n      20 |   it('should set commands and return true on success', async () => {\n      21 |     const result = await setBotCommands(mockBot as Telegraf<MyContext>)\n    > 22 |     expect(mockBot.telegram.setMyCommands).toHaveBeenCalledWith([\n         |                                            ^\n      23 |       { command: 'start', description: 'üë§ Start / –ù–∞—á–∞—Ç—å' },\n      24 |       { command: 'menu', description: 'üë§ Menu / –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é' },\n      25 |     ])\n\n      at __tests__/commands/setCommands.test.ts:22:44\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["setBotCommands"],"duration":1,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n- Expected\n+ Received\n\n@@ -5,6 +5,10 @@\n    },\n    Object {\n      \"command\": \"menu\",\n      \"description\": \"üë§ Menu / –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\",\n    },\n+   Object {\n+     \"command\": \"support\",\n+     \"description\": \"üë§ Support / –¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞\",\n+   },\n  ],\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/commands/setCommands.test.ts:22:44\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"setBotCommands should set commands and return true on success","status":"failed","title":"should set commands and return true on success"},{"ancestorTitles":["setBotCommands"],"duration":0,"failureMessages":[],"fullName":"setBotCommands should return false and log error on failure","status":"passed","title":"should return false and log error on failure"}]},{"numFailingTests":1,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168595950,"runtime":24,"slow":false,"start":1745168595926},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/models/imageModelPrices.test.ts","failureMessage":"  ‚óè imageModelPrices mapping ‚Ä∫ contains pro model with correct costPerImage\n\n    expect(received).toHaveProperty(path)\n\n    Expected path: \"black-forest-labs/flux-1.1-pro\"\n    Received path: []\n\n    Received value: {\"black-forest-labs/flux-1.1-pro\": [Object], \"black-forest-labs/flux-1.1-pro-ultra\": [Object], \"black-forest-labs/flux-canny-dev\": [Object], \"black-forest-labs/flux-canny-pro\": [Object], \"black-forest-labs/flux-depth-dev\": [Object], \"black-forest-labs/flux-depth-pro\": [Object], \"black-forest-labs/flux-dev\": [Object], \"black-forest-labs/flux-dev-lora\": [Object], \"black-forest-labs/flux-fill-dev\": [Object], \"black-forest-labs/flux-fill-pro\": [Object], \"black-forest-labs/flux-pro\": [Object], \"black-forest-labs/flux-redux-dev\": [Object], \"black-forest-labs/flux-redux-schnell\": [Object], \"black-forest-labs/flux-schnell\": [Object], \"black-forest-labs/flux-schnell-lora\": [Object], \"ideogram-ai/ideogram-v2\": [Object], \"ideogram-ai/ideogram-v2-turbo\": [Object], \"luma/photon\": [Object], \"luma/photon-flash\": [Object], \"recraft-ai/recraft-20b\": [Object], \"recraft-ai/recraft-20b-svg\": [Object], \"recraft-ai/recraft-v3\": [Object], \"recraft-ai/recraft-v3-svg\": [Object], \"stability-ai/stable-diffusion-3\": [Object], \"stability-ai/stable-diffusion-3.5-large\": [Object], \"stability-ai/stable-diffusion-3.5-large-turbo\": [Object], \"stability-ai/stable-diffusion-3.5-medium\": [Object]}\n\n       5 |   it('contains pro model with correct costPerImage', () => {\n       6 |     const key = 'black-forest-labs/flux-1.1-pro'\n    >  7 |     expect(imageModelPrices).toHaveProperty(key)\n         |                              ^\n       8 |     const info = imageModelPrices[key]\n       9 |     expect(info.costPerImage).toBe(\n      10 |       calculateFinalImageCostInStars(0.04)\n\n      at Object.<anonymous> (__tests__/price/models/imageModelPrices.test.ts:7:30)\n","testResults":[{"ancestorTitles":["imageModelPrices mapping"],"duration":2,"failureMessages":["Error: expect(received).toHaveProperty(path)\n\nExpected path: \"black-forest-labs/flux-1.1-pro\"\nReceived path: []\n\nReceived value: {\"black-forest-labs/flux-1.1-pro\": [Object], \"black-forest-labs/flux-1.1-pro-ultra\": [Object], \"black-forest-labs/flux-canny-dev\": [Object], \"black-forest-labs/flux-canny-pro\": [Object], \"black-forest-labs/flux-depth-dev\": [Object], \"black-forest-labs/flux-depth-pro\": [Object], \"black-forest-labs/flux-dev\": [Object], \"black-forest-labs/flux-dev-lora\": [Object], \"black-forest-labs/flux-fill-dev\": [Object], \"black-forest-labs/flux-fill-pro\": [Object], \"black-forest-labs/flux-pro\": [Object], \"black-forest-labs/flux-redux-dev\": [Object], \"black-forest-labs/flux-redux-schnell\": [Object], \"black-forest-labs/flux-schnell\": [Object], \"black-forest-labs/flux-schnell-lora\": [Object], \"ideogram-ai/ideogram-v2\": [Object], \"ideogram-ai/ideogram-v2-turbo\": [Object], \"luma/photon\": [Object], \"luma/photon-flash\": [Object], \"recraft-ai/recraft-20b\": [Object], \"recraft-ai/recraft-20b-svg\": [Object], \"recraft-ai/recraft-v3\": [Object], \"recraft-ai/recraft-v3-svg\": [Object], \"stability-ai/stable-diffusion-3\": [Object], \"stability-ai/stable-diffusion-3.5-large\": [Object], \"stability-ai/stable-diffusion-3.5-large-turbo\": [Object], \"stability-ai/stable-diffusion-3.5-medium\": [Object]}\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/price/models/imageModelPrices.test.ts:7:30)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"imageModelPrices mapping contains pro model with correct costPerImage","status":"failed","title":"contains pro model with correct costPerImage"},{"ancestorTitles":["imageModelPrices mapping"],"duration":1,"failureMessages":[],"fullName":"imageModelPrices mapping contains ultra pro model with correct cost","status":"passed","title":"contains ultra pro model with correct cost"}]},{"numFailingTests":1,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168595978,"runtime":23,"slow":false,"start":1745168595955},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/helpers/delay.test.ts","failureMessage":"  ‚óè delay ‚Ä∫ resolves after the specified time\n\n    expect(jest.fn()).toHaveBeenCalled()\n\n    Expected number of calls: >= 1\n    Received number of calls:    0\n\n       9 |     promise.then(callback);\n      10 |     jest.advanceTimersByTime(100);\n    > 11 |     expect(callback).toHaveBeenCalled();\n         |                      ^\n      12 |   });\n      13 | });\n\n      at __tests__/helpers/delay.test.ts:11:22\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/helpers/delay.test.ts:6:56)\n","testResults":[{"ancestorTitles":["delay"],"duration":0,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalled()\n\nExpected number of calls: >= 1\nReceived number of calls:    0\n    at /Users/playom/999-multibots-telegraf/__tests__/helpers/delay.test.ts:11:22\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/helpers/delay.test.ts:6:56)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"delay resolves after the specified time","status":"failed","title":"resolves after the specified time"}]},{"numFailingTests":1,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168596006,"runtime":23,"slow":false,"start":1745168595983},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/commands/getAvailableModels.test.ts","failureMessage":"  ‚óè getAvailableModels ‚Ä∫ filters only GPT models and sorts them\n\n    expect(received).toEqual(expected) // deep equality\n\n    - Expected  - 2\n    + Received  + 1\n\n      Array [\n    -   \"gpt-3.5\",\n    -   \"gpt-3.5-turbo\",\n        \"gpt-4\",\n        \"gpt-4-turbo\",\n    +   \"gpt-3.5-turbo\",\n      ]\n\n      31 |     const result = await getAvailableModels()\n      32 |     // Expect only ids including 'gpt', excluding 'instruct', '0613'\n    > 33 |     expect(result).toEqual([\n         |                    ^\n      34 |       'gpt-3.5',\n      35 |       'gpt-3.5-turbo',\n      36 |       'gpt-4',\n\n      at __tests__/commands/getAvailableModels.test.ts:33:20\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["getAvailableModels"],"duration":1,"failureMessages":["Error: expect(received).toEqual(expected) // deep equality\n\n- Expected  - 2\n+ Received  + 1\n\n  Array [\n-   \"gpt-3.5\",\n-   \"gpt-3.5-turbo\",\n    \"gpt-4\",\n    \"gpt-4-turbo\",\n+   \"gpt-3.5-turbo\",\n  ]\n    at /Users/playom/999-multibots-telegraf/__tests__/commands/getAvailableModels.test.ts:33:20\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)"],"fullName":"getAvailableModels filters only GPT models and sorts them","status":"failed","title":"filters only GPT models and sorts them"},{"ancestorTitles":["getAvailableModels"],"duration":0,"failureMessages":[],"fullName":"getAvailableModels returns fallback on error","status":"passed","title":"returns fallback on error"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168596107,"runtime":97,"slow":false,"start":1745168596010},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserLevelPlusOne.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["updateUserLevelPlusOne"],"duration":25,"failureMessages":[],"fullName":"updateUserLevelPlusOne increments level and logs success when no error","status":"passed","title":"increments level and logs success when no error"},{"ancestorTitles":["updateUserLevelPlusOne"],"duration":24,"failureMessages":[],"fullName":"updateUserLevelPlusOne logs error when update returns error","status":"passed","title":"logs error when update returns error"},{"ancestorTitles":["updateUserLevelPlusOne"],"duration":24,"failureMessages":[],"fullName":"updateUserLevelPlusOne catches exception and logs it","status":"passed","title":"catches exception and logs it"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168596239,"runtime":130,"slow":false,"start":1745168596109},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/utils/helpersIndex.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["helpers index exports"],"duration":82,"failureMessages":[],"fullName":"helpers index exports exports isDev based on NODE_ENV","status":"passed","title":"exports isDev based on NODE_ENV"},{"ancestorTitles":["helpers index exports"],"duration":25,"failureMessages":[],"fullName":"helpers index exports re-exports helper functions correctly","status":"passed","title":"re-exports helper functions correctly"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168596364,"runtime":120,"slow":false,"start":1745168596244},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/isLimitAi.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["isLimitAi"],"duration":25,"failureMessages":[],"fullName":"isLimitAi returns false when user lookup error","status":"passed","title":"returns false when user lookup error"},{"ancestorTitles":["isLimitAi"],"duration":25,"failureMessages":[],"fullName":"isLimitAi inserts new record when no limitData or stale date and returns false","status":"passed","title":"inserts new record when no limitData or stale date and returns false"},{"ancestorTitles":["isLimitAi"],"duration":24,"failureMessages":[],"fullName":"isLimitAi updates count when under daily limit and returns false","status":"passed","title":"updates count when under daily limit and returns false"},{"ancestorTitles":["isLimitAi"],"duration":24,"failureMessages":[],"fullName":"isLimitAi returns true when daily limit reached","status":"passed","title":"returns true when daily limit reached"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168596489,"runtime":119,"slow":false,"start":1745168596370},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/index.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["scenes index"],"duration":1,"failureMessages":[],"fullName":"scenes index exports scene modules","status":"passed","title":"exports scene modules"}]},{"numFailingTests":0,"numPassingTests":9,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168596764,"runtime":273,"slow":false,"start":1745168596491},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/utils/config.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["config utils"],"duration":13,"failureMessages":[],"fullName":"config utils validateToken should reject invalid formats","status":"passed","title":"validateToken should reject invalid formats"},{"ancestorTitles":["config utils"],"duration":9,"failureMessages":[],"fullName":"config utils validateToken should accept valid token","status":"passed","title":"validateToken should accept valid token"},{"ancestorTitles":["config utils"],"duration":20,"failureMessages":[],"fullName":"config utils generateSecretKey should return hex string of length 64","status":"passed","title":"generateSecretKey should return hex string of length 64"},{"ancestorTitles":["config utils"],"duration":14,"failureMessages":[],"fullName":"config utils getWebhookConfig should read env variables","status":"passed","title":"getWebhookConfig should read env variables"},{"ancestorTitles":["config utils","loadConfig"],"duration":18,"failureMessages":[],"fullName":"config utils loadConfig should return no bots if no tokens","status":"passed","title":"should return no bots if no tokens"},{"ancestorTitles":["config utils","loadConfig"],"duration":11,"failureMessages":[],"fullName":"config utils loadConfig should include BOT_TOKEN env var","status":"passed","title":"should include BOT_TOKEN env var"},{"ancestorTitles":["config utils","loadBotsConfig"],"duration":15,"failureMessages":[],"fullName":"config utils loadBotsConfig should return empty array when file missing","status":"passed","title":"should return empty array when file missing"},{"ancestorTitles":["config utils","loadBotsConfig"],"duration":44,"failureMessages":[],"fullName":"config utils loadBotsConfig should disable invalid tokens and duplicates","status":"passed","title":"should disable invalid tokens and duplicates"},{"ancestorTitles":["config utils"],"duration":84,"failureMessages":[],"fullName":"config utils loadSecurityConfig should return defaults when no file","status":"passed","title":"loadSecurityConfig should return defaults when no file"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168596940,"runtime":173,"slow":false,"start":1745168596767},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getVoiceId.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getVoiceId"],"duration":56,"failureMessages":[],"fullName":"getVoiceId returns voice_id when present","status":"passed","title":"returns voice_id when present"},{"ancestorTitles":["getVoiceId"],"duration":43,"failureMessages":[],"fullName":"getVoiceId returns undefined when no data","status":"passed","title":"returns undefined when no data"},{"ancestorTitles":["getVoiceId"],"duration":42,"failureMessages":[],"fullName":"getVoiceId throws when error","status":"passed","title":"throws when error"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168597669,"runtime":726,"slow":false,"start":1745168596943},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserSoul.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["updateUserSoul"],"duration":154,"failureMessages":[],"fullName":"updateUserSoul calls update and eq and resolves on success","status":"passed","title":"calls update and eq and resolves on success"},{"ancestorTitles":["updateUserSoul"],"duration":31,"failureMessages":[],"fullName":"updateUserSoul logs and resolves on update error","status":"passed","title":"logs and resolves on update error"},{"ancestorTitles":["updateUserSoul"],"duration":30,"failureMessages":[],"fullName":"updateUserSoul logs and resolves on exception","status":"passed","title":"logs and resolves on exception"}]},{"numFailingTests":0,"numPassingTests":10,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168597780,"runtime":109,"slow":false,"start":1745168597671},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/allHandlers.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["handlers loadable modules"],"duration":1,"failureMessages":[],"fullName":"handlers loadable modules can require handler module checkFullAccess","status":"passed","title":"can require handler module checkFullAccess"},{"ancestorTitles":["handlers loadable modules"],"duration":0,"failureMessages":[],"fullName":"handlers loadable modules can require handler module getBotToken","status":"passed","title":"can require handler module getBotToken"},{"ancestorTitles":["handlers loadable modules"],"duration":0,"failureMessages":[],"fullName":"handlers loadable modules can require handler module getPhotoUrl","status":"passed","title":"can require handler module getPhotoUrl"},{"ancestorTitles":["handlers loadable modules"],"duration":21,"failureMessages":[],"fullName":"handlers loadable modules can require handler module getSubScribeChannel","status":"passed","title":"can require handler module getSubScribeChannel"},{"ancestorTitles":["handlers loadable modules"],"duration":1,"failureMessages":[],"fullName":"handlers loadable modules can require handler module getUserInfo","status":"passed","title":"can require handler module getUserInfo"},{"ancestorTitles":["handlers loadable modules"],"duration":9,"failureMessages":[],"fullName":"handlers loadable modules can require handler module handleMenu","status":"passed","title":"can require handler module handleMenu"},{"ancestorTitles":["handlers loadable modules"],"duration":3,"failureMessages":[],"fullName":"handlers loadable modules can require handler module hearsActions","status":"passed","title":"can require handler module hearsActions"},{"ancestorTitles":["handlers loadable modules"],"duration":10,"failureMessages":[],"fullName":"handlers loadable modules can require handler module index","status":"passed","title":"can require handler module index"},{"ancestorTitles":["handlers loadable modules"],"duration":31,"failureMessages":[],"fullName":"handlers loadable modules can require handler module paymentActions","status":"passed","title":"can require handler module paymentActions"},{"ancestorTitles":["handlers loadable modules"],"duration":3,"failureMessages":[],"fullName":"handlers loadable modules can require handler module —ÅallbackActions","status":"passed","title":"can require handler module —ÅallbackActions"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168597833,"runtime":49,"slow":false,"start":1745168597784},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/pinata.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["core/pinata client"],"duration":3,"failureMessages":[],"fullName":"core/pinata client constructs PinataSDK with correct options","status":"passed","title":"constructs PinataSDK with correct options"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168597930,"runtime":95,"slow":false,"start":1745168597835},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/incrementBalance.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["incrementBalance"],"duration":31,"failureMessages":[],"fullName":"incrementBalance throws when select errors or no data","status":"passed","title":"throws when select errors or no data"},{"ancestorTitles":["incrementBalance"],"duration":39,"failureMessages":[],"fullName":"incrementBalance resolves when update succeeds","status":"passed","title":"resolves when update succeeds"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168598032,"runtime":100,"slow":false,"start":1745168597932},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/setModel.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["setModel"],"duration":34,"failureMessages":[],"fullName":"setModel calls update, eq, and select, and resolves","status":"passed","title":"calls update, eq, and select, and resolves"},{"ancestorTitles":["setModel"],"duration":30,"failureMessages":[],"fullName":"setModel throws when supabase.select rejects","status":"passed","title":"throws when supabase.select rejects"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168598123,"runtime":90,"slow":false,"start":1745168598033},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateModelTraining.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["updateModelTraining"],"duration":36,"failureMessages":[],"fullName":"updateModelTraining resolves when update has no error","status":"passed","title":"resolves when update has no error"},{"ancestorTitles":["updateModelTraining"],"duration":27,"failureMessages":[],"fullName":"updateModelTraining throws when update returns error","status":"passed","title":"throws when update returns error"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168598181,"runtime":57,"slow":false,"start":1745168598124},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/validateAndCalculateImageModelPrice.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["validateAndCalculateImageModelPrice"],"duration":1,"failureMessages":[],"fullName":"validateAndCalculateImageModelPrice returns null and prompts when imageModel is empty or invalid","status":"passed","title":"returns null and prompts when imageModel is empty or invalid"},{"ancestorTitles":["validateAndCalculateImageModelPrice"],"duration":0,"failureMessages":[],"fullName":"validateAndCalculateImageModelPrice returns null and prompts when modelInfo not found","status":"passed","title":"returns null and prompts when modelInfo not found"},{"ancestorTitles":["validateAndCalculateImageModelPrice"],"duration":2,"failureMessages":[],"fullName":"validateAndCalculateImageModelPrice returns null and prompts when currentBalance is insufficient","status":"passed","title":"returns null and prompts when currentBalance is insufficient"},{"ancestorTitles":["validateAndCalculateImageModelPrice"],"duration":1,"failureMessages":[],"fullName":"validateAndCalculateImageModelPrice returns price when model is valid and balance is sufficient","status":"passed","title":"returns price when model is valid and balance is sufficient"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168598243,"runtime":61,"slow":false,"start":1745168598182},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/commands/index.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["commands index re-exports"],"duration":0,"failureMessages":[],"fullName":"commands index re-exports should export get100Command","status":"passed","title":"should export get100Command"},{"ancestorTitles":["commands index re-exports"],"duration":0,"failureMessages":[],"fullName":"commands index re-exports should export selectModelCommand","status":"passed","title":"should export selectModelCommand"},{"ancestorTitles":["commands index re-exports"],"duration":1,"failureMessages":[],"fullName":"commands index re-exports should export priceCommand","status":"passed","title":"should export priceCommand"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168598310,"runtime":65,"slow":false,"start":1745168598245},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/utils/createImagesZip.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["createImagesZip helper"],"duration":24,"failureMessages":[],"fullName":"createImagesZip helper creates a zip file containing provided images","status":"passed","title":"creates a zip file containing provided images"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168598369,"runtime":57,"slow":false,"start":1745168598312},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/lint/noTsNocheck.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["TS-NOCHECK ban in tests"],"duration":31,"failureMessages":[],"fullName":"TS-NOCHECK ban in tests should not contain @ts-nocheck in any test file","status":"passed","title":"should not contain @ts-nocheck in any test file"}]},{"numFailingTests":0,"numPassingTests":5,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168598421,"runtime":50,"slow":false,"start":1745168598371},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/handleModelCallback.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["handleModelCallback"],"duration":1,"failureMessages":[],"fullName":"handleModelCallback –¥–æ–ª–∂–µ–Ω –≤—ã–∑—ã–≤–∞—Ç—å updateUserModel —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏","status":"passed","title":"–¥–æ–ª–∂–µ–Ω –≤—ã–∑—ã–≤–∞—Ç—å updateUserModel —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏"},{"ancestorTitles":["handleModelCallback"],"duration":0,"failureMessages":[],"fullName":"handleModelCallback –¥–æ–ª–∂–µ–Ω –≤—ã–∑—ã–≤–∞—Ç—å reply —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ–± –æ—à–∏–±–∫–µ, –µ—Å–ª–∏ updateUserModel –ø–∞–¥–∞–µ—Ç","status":"passed","title":"–¥–æ–ª–∂–µ–Ω –≤—ã–∑—ã–≤–∞—Ç—å reply —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ–± –æ—à–∏–±–∫–µ, –µ—Å–ª–∏ updateUserModel –ø–∞–¥–∞–µ—Ç"},{"ancestorTitles":["handleModelCallback"],"duration":0,"failureMessages":[],"fullName":"handleModelCallback –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —Ç–µ–∫—Å—Ç, –µ—Å–ª–∏ —è–∑—ã–∫ –Ω–µ ru","status":"passed","title":"–¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —Ç–µ–∫—Å—Ç, –µ—Å–ª–∏ —è–∑—ã–∫ –Ω–µ ru"},{"ancestorTitles":["handleModelCallback"],"duration":0,"failureMessages":[],"fullName":"handleModelCallback –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏, –µ—Å–ª–∏ —è–∑—ã–∫ –Ω–µ ru","status":"passed","title":"–¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏, –µ—Å–ª–∏ —è–∑—ã–∫ –Ω–µ ru"},{"ancestorTitles":["handleModelCallback"],"duration":0,"failureMessages":[],"fullName":"handleModelCallback –Ω–µ –¥–æ–ª–∂–µ–Ω –ø–∞–¥–∞—Ç—å, –µ—Å–ª–∏ ctx.from –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω (—Ö–æ—Ç—è TS –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç)","status":"passed","title":"–Ω–µ –¥–æ–ª–∂–µ–Ω –ø–∞–¥–∞—Ç—å, –µ—Å–ª–∏ ctx.from –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω (—Ö–æ—Ç—è TS –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç)"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168598478,"runtime":52,"slow":false,"start":1745168598426},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/helpers/images/createImagesZip.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["createImagesZip"],"duration":12,"failureMessages":[],"fullName":"createImagesZip creates zip with images","status":"passed","title":"creates zip with images"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168598529,"runtime":50,"slow":false,"start":1745168598479},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/index.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["core index"],"duration":1,"failureMessages":[],"fullName":"core index exports key core modules","status":"passed","title":"exports key core modules"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168598582,"runtime":51,"slow":false,"start":1745168598531},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/menu/index.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["menu index exports"],"duration":1,"failureMessages":[],"fullName":"menu index exports should export all menu builder and send functions","status":"passed","title":"should export all menu builder and send functions"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168598639,"runtime":56,"slow":false,"start":1745168598583},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getBotGroupFromAvatars.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getBotGroupFromAvatars"],"duration":9,"failureMessages":[],"fullName":"getBotGroupFromAvatars returns group when data found","status":"passed","title":"returns group when data found"},{"ancestorTitles":["getBotGroupFromAvatars"],"duration":12,"failureMessages":[],"fullName":"getBotGroupFromAvatars returns null when error in response","status":"passed","title":"returns null when error in response"},{"ancestorTitles":["getBotGroupFromAvatars"],"duration":10,"failureMessages":[],"fullName":"getBotGroupFromAvatars returns null when exception thrown","status":"passed","title":"returns null when exception thrown"}]},{"numFailingTests":0,"numPassingTests":7,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168598700,"runtime":59,"slow":false,"start":1745168598641},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/services/generateNeuroImageV2.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["generateNeuroImageV2"],"duration":6,"failureMessages":[],"fullName":"generateNeuroImageV2 throws if ctx.session.prompt missing","status":"passed","title":"throws if ctx.session.prompt missing"},{"ancestorTitles":["generateNeuroImageV2"],"duration":1,"failureMessages":[],"fullName":"generateNeuroImageV2 throws if ctx.session.userModel missing","status":"passed","title":"throws if ctx.session.userModel missing"},{"ancestorTitles":["generateNeuroImageV2"],"duration":1,"failureMessages":[],"fullName":"generateNeuroImageV2 throws if numImages is zero","status":"passed","title":"throws if numImages is zero"},{"ancestorTitles":["generateNeuroImageV2"],"duration":2,"failureMessages":[],"fullName":"generateNeuroImageV2 calls API and returns data on success","status":"passed","title":"calls API and returns data on success"},{"ancestorTitles":["generateNeuroImageV2"],"duration":1,"failureMessages":[],"fullName":"generateNeuroImageV2 replies specific message on NSFW axios error","status":"passed","title":"replies specific message on NSFW axios error"},{"ancestorTitles":["generateNeuroImageV2"],"duration":1,"failureMessages":[],"fullName":"generateNeuroImageV2 replies generic message on other axios error","status":"passed","title":"replies generic message on other axios error"},{"ancestorTitles":["generateNeuroImageV2"],"duration":1,"failureMessages":[],"fullName":"generateNeuroImageV2 throws original error on non-axios error","status":"passed","title":"throws original error on non-axios error"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168598794,"runtime":92,"slow":false,"start":1745168598702},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/utils/imagesIndex.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["helpers/images index exports"],"duration":0,"failureMessages":[],"fullName":"helpers/images index exports exports createImagesZip and isValidImage","status":"passed","title":"exports createImagesZip and isValidImage"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168598838,"runtime":42,"slow":false,"start":1745168598796},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/utils/tokenStorage.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["tokenStorage utils"],"duration":6,"failureMessages":[],"fullName":"tokenStorage utils stores and retrieves a valid token","status":"passed","title":"stores and retrieves a valid token"},{"ancestorTitles":["tokenStorage utils"],"duration":1,"failureMessages":[],"fullName":"tokenStorage utils getToken returns undefined for nonexistent bot","status":"passed","title":"getToken returns undefined for nonexistent bot"},{"ancestorTitles":["tokenStorage utils"],"duration":7,"failureMessages":[],"fullName":"tokenStorage utils removes a stored token","status":"passed","title":"removes a stored token"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168598874,"runtime":34,"slow":false,"start":1745168598840},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/commands/selectModelCommand.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["selectModelCommand"],"duration":0,"failureMessages":[],"fullName":"selectModelCommand replies with model selection keyboard in Russian","status":"passed","title":"replies with model selection keyboard in Russian"},{"ancestorTitles":["selectModelCommand"],"duration":0,"failureMessages":[],"fullName":"selectModelCommand replies with model selection keyboard in English","status":"passed","title":"replies with model selection keyboard in English"},{"ancestorTitles":["selectModelCommand"],"duration":1,"failureMessages":[],"fullName":"selectModelCommand calls sendGenericErrorMessage on failure","status":"passed","title":"calls sendGenericErrorMessage on failure"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168598916,"runtime":38,"slow":false,"start":1745168598878},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/openai/upgradePrompt.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["upgradePrompt"],"duration":1,"failureMessages":[],"fullName":"upgradePrompt returns upgraded prompt from OpenAI","status":"passed","title":"returns upgraded prompt from OpenAI"},{"ancestorTitles":["upgradePrompt"],"duration":2,"failureMessages":[],"fullName":"upgradePrompt throws error when OpenAI request fails","status":"passed","title":"throws error when OpenAI request fails"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168598958,"runtime":40,"slow":false,"start":1745168598918},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/openai/getMeditationSteps.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getMeditationSteps"],"duration":5,"failureMessages":[],"fullName":"getMeditationSteps returns parsed JSON when response has valid JSON content","status":"passed","title":"returns parsed JSON when response has valid JSON content"},{"ancestorTitles":["getMeditationSteps"],"duration":2,"failureMessages":[],"fullName":"getMeditationSteps throws error when content is null","status":"passed","title":"throws error when content is null"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168598993,"runtime":34,"slow":false,"start":1745168598959},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkSubscriptionByTelegramId.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["checkSubscriptionByTelegramId"],"duration":2,"failureMessages":[],"fullName":"checkSubscriptionByTelegramId returns unsubscribed and logs error if query error","status":"passed","title":"returns unsubscribed and logs error if query error"},{"ancestorTitles":["checkSubscriptionByTelegramId"],"duration":1,"failureMessages":[],"fullName":"checkSubscriptionByTelegramId returns unsubscribed when no data","status":"passed","title":"returns unsubscribed when no data"},{"ancestorTitles":["checkSubscriptionByTelegramId"],"duration":0,"failureMessages":[],"fullName":"checkSubscriptionByTelegramId returns unsubscribed when last payment older than 30 days","status":"passed","title":"returns unsubscribed when last payment older than 30 days"},{"ancestorTitles":["checkSubscriptionByTelegramId"],"duration":1,"failureMessages":[],"fullName":"checkSubscriptionByTelegramId returns level when last payment within 30 days","status":"passed","title":"returns level when last payment within 30 days"}]},{"numFailingTests":0,"numPassingTests":7,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168599032,"runtime":38,"slow":false,"start":1745168598994},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/replicate.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["core/replicate client and utilities"],"duration":2,"failureMessages":[],"fullName":"core/replicate client and utilities constructs Replicate with auth token","status":"passed","title":"constructs Replicate with auth token"},{"ancestorTitles":["core/replicate client and utilities"],"duration":0,"failureMessages":[],"fullName":"core/replicate client and utilities modelPricing contains expected entries","status":"passed","title":"modelPricing contains expected entries"},{"ancestorTitles":["core/replicate client and utilities","models.flux.getInput"],"duration":2,"failureMessages":[],"fullName":"core/replicate client and utilities models.flux.getInput defaults to 16:9","status":"passed","title":"defaults to 16:9"},{"ancestorTitles":["core/replicate client and utilities","models.flux.getInput"],"duration":1,"failureMessages":[],"fullName":"core/replicate client and utilities models.flux.getInput handles 1:1","status":"passed","title":"handles 1:1"},{"ancestorTitles":["core/replicate client and utilities","models.flux.getInput"],"duration":0,"failureMessages":[],"fullName":"core/replicate client and utilities models.flux.getInput handles 9:16","status":"passed","title":"handles 9:16"},{"ancestorTitles":["core/replicate client and utilities","models.flux.getInput"],"duration":0,"failureMessages":[],"fullName":"core/replicate client and utilities models.flux.getInput defaults dims for unknown ratio","status":"passed","title":"defaults dims for unknown ratio"},{"ancestorTitles":["core/replicate client and utilities"],"duration":5,"failureMessages":[],"fullName":"core/replicate client and utilities invokes getInput wrapper for all models","status":"passed","title":"invokes getInput wrapper for all models"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168599070,"runtime":36,"slow":false,"start":1745168599034},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/openai/getSlides.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getSlides"],"duration":1,"failureMessages":[],"fullName":"getSlides returns parsed JSON when response has valid JSON content","status":"passed","title":"returns parsed JSON when response has valid JSON content"},{"ancestorTitles":["getSlides"],"duration":1,"failureMessages":[],"fullName":"getSlides throws error when content is null","status":"passed","title":"throws error when content is null"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168599106,"runtime":32,"slow":false,"start":1745168599074},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/menu/getStepSelectionMenuV2.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getStepSelectionMenuV2"],"duration":0,"failureMessages":[],"fullName":"getStepSelectionMenuV2 builds Russian keyboard correctly","status":"passed","title":"builds Russian keyboard correctly"},{"ancestorTitles":["getStepSelectionMenuV2"],"duration":0,"failureMessages":[],"fullName":"getStepSelectionMenuV2 builds English keyboard correctly","status":"passed","title":"builds English keyboard correctly"}]},{"numFailingTests":0,"numPassingTests":5,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168599138,"runtime":30,"slow":false,"start":1745168599108},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/utils/webhooks.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["configureWebhooks util"],"duration":0,"failureMessages":[],"fullName":"configureWebhooks util returns false when disabled","status":"passed","title":"returns false when disabled"},{"ancestorTitles":["configureWebhooks util"],"duration":0,"failureMessages":[],"fullName":"configureWebhooks util returns false when domain missing","status":"passed","title":"returns false when domain missing"},{"ancestorTitles":["configureWebhooks util"],"duration":1,"failureMessages":[],"fullName":"configureWebhooks util sets webhook when enabled and domain present","status":"passed","title":"sets webhook when enabled and domain present"},{"ancestorTitles":["removeWebhook util"],"duration":0,"failureMessages":[],"fullName":"removeWebhook util deletes webhook and logs info","status":"passed","title":"deletes webhook and logs info"},{"ancestorTitles":["removeWebhook util"],"duration":1,"failureMessages":[],"fullName":"removeWebhook util logs error on delete failure","status":"passed","title":"logs error on delete failure"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168599179,"runtime":33,"slow":false,"start":1745168599146},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/axios/fetchImage.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["fetchImage"],"duration":1,"failureMessages":[],"fullName":"fetchImage should return buffer from response data","status":"passed","title":"should return buffer from response data"},{"ancestorTitles":["fetchImage"],"duration":2,"failureMessages":[],"fullName":"fetchImage should throw error when axios.get rejects","status":"passed","title":"should throw error when axios.get rejects"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168599209,"runtime":28,"slow":false,"start":1745168599181},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/elevenlabs.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["core/elevenlabs client"],"duration":1,"failureMessages":[],"fullName":"core/elevenlabs client getVoices returns an object with voices array","status":"passed","title":"getVoices returns an object with voices array"},{"ancestorTitles":["core/elevenlabs client"],"duration":0,"failureMessages":[],"fullName":"core/elevenlabs client generateVoiceSpeech returns a buffer of length 1","status":"passed","title":"generateVoiceSpeech returns a buffer of length 1"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168599246,"runtime":36,"slow":false,"start":1745168599210},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/openai/getSubtitles.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getSubtitles"],"duration":1,"failureMessages":[],"fullName":"getSubtitles returns parsed JSON when response has valid JSON content","status":"passed","title":"returns parsed JSON when response has valid JSON content"},{"ancestorTitles":["getSubtitles"],"duration":1,"failureMessages":[],"fullName":"getSubtitles throws error when content is null","status":"passed","title":"throws error when content is null"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168599291,"runtime":39,"slow":false,"start":1745168599252},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/openai/getAinews.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getAinews"],"duration":1,"failureMessages":[],"fullName":"getAinews returns content when response has valid content","status":"passed","title":"returns content when response has valid content"},{"ancestorTitles":["getAinews"],"duration":2,"failureMessages":[],"fullName":"getAinews throws error when content is null","status":"passed","title":"throws error when content is null"},{"ancestorTitles":["getAinews"],"duration":2,"failureMessages":[],"fullName":"getAinews throws when OpenAI request fails","status":"passed","title":"throws when OpenAI request fails"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168599332,"runtime":39,"slow":false,"start":1745168599293},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/openai/getTriggerReel.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getTriggerReel"],"duration":0,"failureMessages":[],"fullName":"getTriggerReel returns content when response has valid content","status":"passed","title":"returns content when response has valid content"},{"ancestorTitles":["getTriggerReel"],"duration":1,"failureMessages":[],"fullName":"getTriggerReel throws error when content is null","status":"passed","title":"throws error when content is null"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168599366,"runtime":33,"slow":false,"start":1745168599333},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getModel.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getModel"],"duration":1,"failureMessages":[],"fullName":"getModel returns model when data exists","status":"passed","title":"returns model when data exists"},{"ancestorTitles":["getModel"],"duration":1,"failureMessages":[],"fullName":"getModel throws error when response has error","status":"passed","title":"throws error when response has error"},{"ancestorTitles":["getModel"],"duration":1,"failureMessages":[],"fullName":"getModel throws error when response has no data","status":"passed","title":"throws error when response has no data"},{"ancestorTitles":["getModel"],"duration":1,"failureMessages":[],"fullName":"getModel throws error when supabase chain rejects","status":"passed","title":"throws error when supabase chain rejects"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168599408,"runtime":37,"slow":false,"start":1745168599371},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/services/generateImageToVideo.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["generateImageToVideo"],"duration":5,"failureMessages":[],"fullName":"generateImageToVideo throws if required parameters missing","status":"passed","title":"throws if required parameters missing"},{"ancestorTitles":["generateImageToVideo"],"duration":5,"failureMessages":[],"fullName":"generateImageToVideo calls axios.post and returns data on success","status":"passed","title":"calls axios.post and returns data on success"},{"ancestorTitles":["generateImageToVideo"],"duration":1,"failureMessages":[],"fullName":"generateImageToVideo throws localized error on axios error","status":"passed","title":"throws localized error on axios error"},{"ancestorTitles":["generateImageToVideo"],"duration":1,"failureMessages":[],"fullName":"generateImageToVideo throws original error on non-axios error","status":"passed","title":"throws original error on non-axios error"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168599444,"runtime":34,"slow":false,"start":1745168599410},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getTelegramIdByUserId.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getTelegramIdByUserId"],"duration":1,"failureMessages":[],"fullName":"getTelegramIdByUserId returns telegram_id when found","status":"passed","title":"returns telegram_id when found"},{"ancestorTitles":["getTelegramIdByUserId"],"duration":1,"failureMessages":[],"fullName":"getTelegramIdByUserId returns null on error","status":"passed","title":"returns null on error"},{"ancestorTitles":["getTelegramIdByUserId"],"duration":0,"failureMessages":[],"fullName":"getTelegramIdByUserId returns null when no data","status":"passed","title":"returns null when no data"},{"ancestorTitles":["getTelegramIdByUserId"],"duration":3,"failureMessages":[],"fullName":"getTelegramIdByUserId throws on exception","status":"passed","title":"throws on exception"}]},{"numFailingTests":0,"numPassingTests":13,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168599483,"runtime":38,"slow":false,"start":1745168599445},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/utils/env.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["env utils","isWebhookEnv"],"duration":1,"failureMessages":[],"fullName":"env utils isWebhookEnv returns true in production","status":"passed","title":"returns true in production"},{"ancestorTitles":["env utils","isWebhookEnv"],"duration":0,"failureMessages":[],"fullName":"env utils isWebhookEnv returns true when WEBHOOK_DOMAIN is set","status":"passed","title":"returns true when WEBHOOK_DOMAIN is set"},{"ancestorTitles":["env utils","isWebhookEnv"],"duration":1,"failureMessages":[],"fullName":"env utils isWebhookEnv returns false otherwise","status":"passed","title":"returns false otherwise"},{"ancestorTitles":["env utils","getEnvNumber"],"duration":0,"failureMessages":[],"fullName":"env utils getEnvNumber returns default when not defined","status":"passed","title":"returns default when not defined"},{"ancestorTitles":["env utils","getEnvNumber"],"duration":0,"failureMessages":[],"fullName":"env utils getEnvNumber parses integer values","status":"passed","title":"parses integer values"},{"ancestorTitles":["env utils","getEnvNumber"],"duration":1,"failureMessages":[],"fullName":"env utils getEnvNumber returns default on NaN","status":"passed","title":"returns default on NaN"},{"ancestorTitles":["env utils","getEnvBoolean"],"duration":0,"failureMessages":[],"fullName":"env utils getEnvBoolean returns default when not defined","status":"passed","title":"returns default when not defined"},{"ancestorTitles":["env utils","getEnvBoolean"],"duration":1,"failureMessages":[],"fullName":"env utils getEnvBoolean parses truthy strings (case-insensitive)","status":"passed","title":"parses truthy strings (case-insensitive)"},{"ancestorTitles":["env utils","getEnvBoolean"],"duration":0,"failureMessages":[],"fullName":"env utils getEnvBoolean returns false for non-truthy values","status":"passed","title":"returns false for non-truthy values"},{"ancestorTitles":["env utils","getEnvString"],"duration":4,"failureMessages":[],"fullName":"env utils getEnvString returns default when not defined","status":"passed","title":"returns default when not defined"},{"ancestorTitles":["env utils","getEnvString"],"duration":0,"failureMessages":[],"fullName":"env utils getEnvString returns value when defined","status":"passed","title":"returns value when defined"},{"ancestorTitles":["env utils","isDevelopment & isProduction"],"duration":0,"failureMessages":[],"fullName":"env utils isDevelopment & isProduction isDevelopment true when not production","status":"passed","title":"isDevelopment true when not production"},{"ancestorTitles":["env utils","isDevelopment & isProduction"],"duration":1,"failureMessages":[],"fullName":"env utils isDevelopment & isProduction isProduction true when production","status":"passed","title":"isProduction true when production"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168599517,"runtime":32,"slow":false,"start":1745168599485},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/savePrompt.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["savePrompt"],"duration":1,"failureMessages":[],"fullName":"savePrompt returns null when select throws error","status":"passed","title":"returns null when select throws error"},{"ancestorTitles":["savePrompt"],"duration":0,"failureMessages":[],"fullName":"savePrompt returns existing prompt_id when found","status":"passed","title":"returns existing prompt_id when found"},{"ancestorTitles":["savePrompt"],"duration":1,"failureMessages":[],"fullName":"savePrompt inserts and returns new prompt_id when not found","status":"passed","title":"inserts and returns new prompt_id when not found"},{"ancestorTitles":["savePrompt"],"duration":1,"failureMessages":[],"fullName":"savePrompt returns null when insert fails","status":"passed","title":"returns null when insert fails"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168599548,"runtime":30,"slow":false,"start":1745168599518},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/createModelTraining.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["createModelTraining"],"duration":1,"failureMessages":[],"fullName":"createModelTraining resolves when insert succeeds","status":"passed","title":"resolves when insert succeeds"},{"ancestorTitles":["createModelTraining"],"duration":1,"failureMessages":[],"fullName":"createModelTraining throws error when insert fails","status":"passed","title":"throws error when insert fails"}]},{"numFailingTests":0,"numPassingTests":5,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168599585,"runtime":33,"slow":false,"start":1745168599552},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/incrementGeneratedImages.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["incrementGeneratedImages"],"duration":1,"failureMessages":[],"fullName":"incrementGeneratedImages inserts new user when error code PGRST116 and insert succeeds","status":"passed","title":"inserts new user when error code PGRST116 and insert succeeds"},{"ancestorTitles":["incrementGeneratedImages"],"duration":1,"failureMessages":[],"fullName":"incrementGeneratedImages returns false when insert fails","status":"passed","title":"returns false when insert fails"},{"ancestorTitles":["incrementGeneratedImages"],"duration":4,"failureMessages":[],"fullName":"incrementGeneratedImages updates existing user when data present and update succeeds","status":"passed","title":"updates existing user when data present and update succeeds"},{"ancestorTitles":["incrementGeneratedImages"],"duration":1,"failureMessages":[],"fullName":"incrementGeneratedImages returns false when update fails","status":"passed","title":"returns false when update fails"},{"ancestorTitles":["incrementGeneratedImages"],"duration":1,"failureMessages":[],"fullName":"incrementGeneratedImages returns false when error not PGRST116 and no data","status":"passed","title":"returns false when error not PGRST116 and no data"}]},{"numFailingTests":0,"numPassingTests":5,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168599619,"runtime":32,"slow":false,"start":1745168599587},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUidInviter.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getUidInviter"],"duration":1,"failureMessages":[],"fullName":"getUidInviter returns null and warns when no telegram_id provided","status":"passed","title":"returns null and warns when no telegram_id provided"},{"ancestorTitles":["getUidInviter"],"duration":1,"failureMessages":[],"fullName":"getUidInviter returns null and logs error when supabase returns error","status":"passed","title":"returns null and logs error when supabase returns error"},{"ancestorTitles":["getUidInviter"],"duration":0,"failureMessages":[],"fullName":"getUidInviter returns inviter info when data returned","status":"passed","title":"returns inviter info when data returned"},{"ancestorTitles":["getUidInviter"],"duration":0,"failureMessages":[],"fullName":"getUidInviter returns null fields when data empty","status":"passed","title":"returns null fields when data empty"},{"ancestorTitles":["getUidInviter"],"duration":1,"failureMessages":[],"fullName":"getUidInviter returns null and logs error on exception","status":"passed","title":"returns null and logs error on exception"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168599655,"runtime":30,"slow":false,"start":1745168599625},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserByTelegramId.unit.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getUserByTelegramId"],"duration":1,"failureMessages":[],"fullName":"getUserByTelegramId returns null if select returns error","status":"passed","title":"returns null if select returns error"},{"ancestorTitles":["getUserByTelegramId"],"duration":0,"failureMessages":[],"fullName":"getUserByTelegramId returns data and does not update if bot_name matches","status":"passed","title":"returns data and does not update if bot_name matches"},{"ancestorTitles":["getUserByTelegramId"],"duration":1,"failureMessages":[],"fullName":"getUserByTelegramId updates bot_name when differs and returns data","status":"passed","title":"updates bot_name when differs and returns data"},{"ancestorTitles":["getUserByTelegramId"],"duration":0,"failureMessages":[],"fullName":"getUserByTelegramId returns null on unexpected exception","status":"passed","title":"returns null on unexpected exception"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168599688,"runtime":32,"slow":false,"start":1745168599656},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/handleBuySubscription.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["handleBuySubscription"],"duration":1,"failureMessages":[],"fullName":"handleBuySubscription should send invoice for neurophoto subscription and leave scene","status":"passed","title":"should send invoice for neurophoto subscription and leave scene"},{"ancestorTitles":["handleBuySubscription"],"duration":1,"failureMessages":[],"fullName":"handleBuySubscription should default title and description when subscription type unknown","status":"passed","title":"should default title and description when subscription type unknown"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168599720,"runtime":30,"slow":false,"start":1745168599690},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/menu/getStepSelectionMenu.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getStepSelectionMenu"],"duration":0,"failureMessages":[],"fullName":"getStepSelectionMenu builds Russian keyboard correctly","status":"passed","title":"builds Russian keyboard correctly"},{"ancestorTitles":["getStepSelectionMenu"],"duration":0,"failureMessages":[],"fullName":"getStepSelectionMenu builds English keyboard correctly","status":"passed","title":"builds English keyboard correctly"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168599758,"runtime":32,"slow":false,"start":1745168599726},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/utils/launch.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["Launch Utilities"],"duration":1,"failureMessages":[],"fullName":"Launch Utilities development: deletes webhook and launches bot, logs info","status":"passed","title":"development: deletes webhook and launches bot, logs info"},{"ancestorTitles":["Launch Utilities"],"duration":8,"failureMessages":[],"fullName":"Launch Utilities development: logs error and rethrows on failure","status":"passed","title":"development: logs error and rethrows on failure"},{"ancestorTitles":["Launch Utilities"],"duration":1,"failureMessages":[],"fullName":"Launch Utilities production: sets up webhook and starts express server","status":"passed","title":"production: sets up webhook and starts express server"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168599790,"runtime":31,"slow":false,"start":1745168599759},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/menu/videoModelMenu.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["videoModelKeyboard"],"duration":0,"failureMessages":[],"fullName":"videoModelKeyboard builds keyboard with model names and control buttons in Russian","status":"passed","title":"builds keyboard with model names and control buttons in Russian"},{"ancestorTitles":["videoModelKeyboard"],"duration":0,"failureMessages":[],"fullName":"videoModelKeyboard builds keyboard with model names and control buttons in English","status":"passed","title":"builds keyboard with model names and control buttons in English"}]},{"numFailingTests":0,"numPassingTests":6,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168599828,"runtime":37,"slow":false,"start":1745168599791},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/isLimitAi.unit.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["isLimitAi"],"duration":1,"failureMessages":[],"fullName":"isLimitAi returns false when user query error","status":"passed","title":"returns false when user query error"},{"ancestorTitles":["isLimitAi"],"duration":1,"failureMessages":[],"fullName":"isLimitAi returns false when limit query error not PGRST116","status":"passed","title":"returns false when limit query error not PGRST116"},{"ancestorTitles":["isLimitAi"],"duration":0,"failureMessages":[],"fullName":"isLimitAi inserts new record when no limitData or date mismatch, return false on success","status":"passed","title":"inserts new record when no limitData or date mismatch, return false on success"},{"ancestorTitles":["isLimitAi"],"duration":1,"failureMessages":[],"fullName":"isLimitAi returns false when insert new record fails","status":"passed","title":"returns false when insert new record fails"},{"ancestorTitles":["isLimitAi"],"duration":0,"failureMessages":[],"fullName":"isLimitAi updates existing record when count < limit and returns false","status":"passed","title":"updates existing record when count < limit and returns false"},{"ancestorTitles":["isLimitAi"],"duration":1,"failureMessages":[],"fullName":"isLimitAi returns true when limit reached","status":"passed","title":"returns true when limit reached"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168599861,"runtime":32,"slow":false,"start":1745168599829},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/ensureSupabaseAuth.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["ensureSupabaseAuth"],"duration":1,"failureMessages":[],"fullName":"ensureSupabaseAuth resolves when no error from supabase","status":"passed","title":"resolves when no error from supabase"},{"ancestorTitles":["ensureSupabaseAuth"],"duration":5,"failureMessages":[],"fullName":"ensureSupabaseAuth throws new Error when supabase returns error","status":"passed","title":"throws new Error when supabase returns error"},{"ancestorTitles":["ensureSupabaseAuth"],"duration":2,"failureMessages":[],"fullName":"ensureSupabaseAuth throws new Error on exception","status":"passed","title":"throws new Error on exception"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168599892,"runtime":30,"slow":false,"start":1745168599862},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getPrompt.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getPrompt"],"duration":1,"failureMessages":[],"fullName":"getPrompt returns data when found and no error","status":"passed","title":"returns data when found and no error"},{"ancestorTitles":["getPrompt"],"duration":0,"failureMessages":[],"fullName":"getPrompt returns null and logs error when error in response","status":"passed","title":"returns null and logs error when error in response"},{"ancestorTitles":["getPrompt"],"duration":1,"failureMessages":[],"fullName":"getPrompt returns null and logs error when no data","status":"passed","title":"returns null and logs error when no data"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168599924,"runtime":30,"slow":false,"start":1745168599894},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/deleteFileFromSupabase.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["deleteFileFromSupabase"],"duration":1,"failureMessages":[],"fullName":"deleteFileFromSupabase calls remove with correct bucket and filename","status":"passed","title":"calls remove with correct bucket and filename"},{"ancestorTitles":["deleteFileFromSupabase"],"duration":0,"failureMessages":[],"fullName":"deleteFileFromSupabase handles Supabase error without throwing","status":"passed","title":"handles Supabase error without throwing"},{"ancestorTitles":["deleteFileFromSupabase"],"duration":1,"failureMessages":[],"fullName":"deleteFileFromSupabase catches exception and does not throw","status":"passed","title":"catches exception and does not throw"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168599960,"runtime":31,"slow":false,"start":1745168599929},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getTelegramIdByUserId.unit.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getTelegramIdByUserId"],"duration":1,"failureMessages":[],"fullName":"getTelegramIdByUserId returns null on error","status":"passed","title":"returns null on error"},{"ancestorTitles":["getTelegramIdByUserId"],"duration":0,"failureMessages":[],"fullName":"getTelegramIdByUserId returns telegram_id when data present","status":"passed","title":"returns telegram_id when data present"},{"ancestorTitles":["getTelegramIdByUserId"],"duration":3,"failureMessages":[],"fullName":"getTelegramIdByUserId throws on exception","status":"passed","title":"throws on exception"}]},{"numFailingTests":0,"numPassingTests":5,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168599994,"runtime":32,"slow":false,"start":1745168599962},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUid.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getUid"],"duration":5,"failureMessages":[],"fullName":"getUid returns null and warns when no telegram_id provided","status":"passed","title":"returns null and warns when no telegram_id provided"},{"ancestorTitles":["getUid"],"duration":1,"failureMessages":[],"fullName":"getUid returns null and logs error when supabase returns error","status":"passed","title":"returns null and logs error when supabase returns error"},{"ancestorTitles":["getUid"],"duration":1,"failureMessages":[],"fullName":"getUid returns null and logs error on exception","status":"passed","title":"returns null and logs error on exception"},{"ancestorTitles":["getUid"],"duration":1,"failureMessages":[],"fullName":"getUid returns user_id and username when data returned","status":"passed","title":"returns user_id and username when data returned"},{"ancestorTitles":["getUid"],"duration":1,"failureMessages":[],"fullName":"getUid returns null user_id and username when data empty","status":"passed","title":"returns null user_id and username when data empty"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168600027,"runtime":32,"slow":false,"start":1745168599995},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserData.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getUserData"],"duration":2,"failureMessages":[],"fullName":"getUserData returns user data when found","status":"passed","title":"returns user data when found"},{"ancestorTitles":["getUserData"],"duration":1,"failureMessages":[],"fullName":"getUserData throws error when supabase returns error","status":"passed","title":"throws error when supabase returns error"},{"ancestorTitles":["getUserData"],"duration":1,"failureMessages":[],"fullName":"getUserData returns undefined when no data and no error","status":"passed","title":"returns undefined when no data and no error"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168600060,"runtime":31,"slow":false,"start":1745168600029},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getGeneratedImages.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getGeneratedImages"],"duration":2,"failureMessages":[],"fullName":"getGeneratedImages returns count and limit when data exists","status":"passed","title":"returns count and limit when data exists"},{"ancestorTitles":["getGeneratedImages"],"duration":1,"failureMessages":[],"fullName":"getGeneratedImages returns default when error occurs","status":"passed","title":"returns default when error occurs"},{"ancestorTitles":["getGeneratedImages"],"duration":1,"failureMessages":[],"fullName":"getGeneratedImages returns default when no data and no error","status":"passed","title":"returns default when no data and no error"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168600095,"runtime":30,"slow":false,"start":1745168600065},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserSoul.unit.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["updateUserSoul"],"duration":1,"failureMessages":[],"fullName":"updateUserSoul calls supabase.update with correct data and handles success","status":"passed","title":"calls supabase.update with correct data and handles success"},{"ancestorTitles":["updateUserSoul"],"duration":0,"failureMessages":[],"fullName":"updateUserSoul logs error when supabase update returns error and does not throw","status":"passed","title":"logs error when supabase update returns error and does not throw"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168600126,"runtime":30,"slow":false,"start":1745168600096},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/handleCallback.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["handleCallback"],"duration":0,"failureMessages":[],"fullName":"handleCallback should answer callback query and return on valid data","status":"passed","title":"should answer callback query and return on valid data"},{"ancestorTitles":["handleCallback"],"duration":4,"failureMessages":[],"fullName":"handleCallback should swallow answerCbQuery error but still return on data present","status":"passed","title":"should swallow answerCbQuery error but still return on data present"},{"ancestorTitles":["handleCallback"],"duration":4,"failureMessages":[],"fullName":"handleCallback should throw and answerCbQuery on missing callbackQuery","status":"passed","title":"should throw and answerCbQuery on missing callbackQuery"},{"ancestorTitles":["handleCallback"],"duration":0,"failureMessages":[],"fullName":"handleCallback should throw and call sendGenericErrorMessage on answerCbQuery failure in catch","status":"passed","title":"should throw and call sendGenericErrorMessage on answerCbQuery failure in catch"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168600156,"runtime":28,"slow":false,"start":1745168600128},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getAspectRatio.unit.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getAspectRatio"],"duration":1,"failureMessages":[],"fullName":"getAspectRatio returns null on error","status":"passed","title":"returns null on error"},{"ancestorTitles":["getAspectRatio"],"duration":0,"failureMessages":[],"fullName":"getAspectRatio returns null when data is null","status":"passed","title":"returns null when data is null"},{"ancestorTitles":["getAspectRatio"],"duration":1,"failureMessages":[],"fullName":"getAspectRatio returns aspect_ratio when data present","status":"passed","title":"returns aspect_ratio when data present"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168600187,"runtime":30,"slow":false,"start":1745168600157},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getLatestUserModel.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getLatestUserModel"],"duration":2,"failureMessages":[],"fullName":"getLatestUserModel returns model data on success","status":"passed","title":"returns model data on success"},{"ancestorTitles":["getLatestUserModel"],"duration":0,"failureMessages":[],"fullName":"getLatestUserModel returns null on error","status":"passed","title":"returns null on error"},{"ancestorTitles":["getLatestUserModel"],"duration":1,"failureMessages":[],"fullName":"getLatestUserModel returns null on exception","status":"passed","title":"returns null on exception"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168600223,"runtime":30,"slow":false,"start":1745168600193},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/saveUserEmail.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["saveUserEmail"],"duration":1,"failureMessages":[],"fullName":"saveUserEmail resolves when update succeeds","status":"passed","title":"resolves when update succeeds"},{"ancestorTitles":["saveUserEmail"],"duration":2,"failureMessages":[],"fullName":"saveUserEmail throws and logs error when update fails","status":"passed","title":"throws and logs error when update fails"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168600254,"runtime":29,"slow":false,"start":1745168600225},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/cleanupOldArchives.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["cleanupOldArchives"],"duration":5,"failureMessages":[],"fullName":"cleanupOldArchives does nothing when list errors","status":"passed","title":"does nothing when list errors"},{"ancestorTitles":["cleanupOldArchives"],"duration":1,"failureMessages":[],"fullName":"cleanupOldArchives does nothing when only one file exists","status":"passed","title":"does nothing when only one file exists"},{"ancestorTitles":["cleanupOldArchives"],"duration":1,"failureMessages":[],"fullName":"cleanupOldArchives removes all but latest file","status":"passed","title":"removes all but latest file"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168600286,"runtime":31,"slow":false,"start":1745168600255},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getHistory.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getHistory"],"duration":1,"failureMessages":[],"fullName":"getHistory returns data when query successful","status":"passed","title":"returns data when query successful"},{"ancestorTitles":["getHistory"],"duration":1,"failureMessages":[],"fullName":"getHistory returns empty array when error","status":"passed","title":"returns empty array when error"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168600317,"runtime":30,"slow":false,"start":1745168600287},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserModel.unit.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getUserModel"],"duration":1,"failureMessages":[],"fullName":"getUserModel returns default model when supabase returns error","status":"passed","title":"returns default model when supabase returns error"},{"ancestorTitles":["getUserModel"],"duration":0,"failureMessages":[],"fullName":"getUserModel returns user model when data is present","status":"passed","title":"returns user model when data is present"},{"ancestorTitles":["getUserModel"],"duration":1,"failureMessages":[],"fullName":"getUserModel returns default model when data.model is undefined","status":"passed","title":"returns default model when data.model is undefined"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168600348,"runtime":29,"slow":false,"start":1745168600319},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/utils/errorMessageAdmin.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["errorMessageAdmin"],"duration":1,"failureMessages":[],"fullName":"errorMessageAdmin should send admin notification when not development","status":"passed","title":"should send admin notification when not development"},{"ancestorTitles":["errorMessageAdmin"],"duration":0,"failureMessages":[],"fullName":"errorMessageAdmin should not send when development mode","status":"passed","title":"should not send when development mode"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168600382,"runtime":28,"slow":false,"start":1745168600354},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/middlewares/verifySubscription.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["verifySubscription"],"duration":0,"failureMessages":[],"fullName":"verifySubscription returns true and does not call handleSubscriptionMessage when subscribed","status":"passed","title":"returns true and does not call handleSubscriptionMessage when subscribed"},{"ancestorTitles":["verifySubscription"],"duration":0,"failureMessages":[],"fullName":"verifySubscription calls handleSubscriptionMessage and returns false when not subscribed","status":"passed","title":"calls handleSubscriptionMessage and returns false when not subscribed"},{"ancestorTitles":["verifySubscription"],"duration":6,"failureMessages":[],"fullName":"verifySubscription propagates error from checkSubscription","status":"passed","title":"propagates error from checkSubscription"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168600413,"runtime":30,"slow":false,"start":1745168600383},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getBotGroupFromAvatars.unit.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getBotGroupFromAvatars"],"duration":5,"failureMessages":[],"fullName":"getBotGroupFromAvatars returns group when data present","status":"passed","title":"returns group when data present"},{"ancestorTitles":["getBotGroupFromAvatars"],"duration":1,"failureMessages":[],"fullName":"getBotGroupFromAvatars returns null on error and logs","status":"passed","title":"returns null on error and logs"},{"ancestorTitles":["getBotGroupFromAvatars"],"duration":0,"failureMessages":[],"fullName":"getBotGroupFromAvatars returns null on exception and logs","status":"passed","title":"returns null on exception and logs"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168600444,"runtime":30,"slow":false,"start":1745168600414},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/setAspectRatio.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["setAspectRatio"],"duration":2,"failureMessages":[],"fullName":"setAspectRatio returns true on successful update","status":"passed","title":"returns true on successful update"},{"ancestorTitles":["setAspectRatio"],"duration":1,"failureMessages":[],"fullName":"setAspectRatio returns false on error","status":"passed","title":"returns false on error"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168600473,"runtime":28,"slow":false,"start":1745168600445},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/helpers/error/processApiResponse.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["processApiResponse"],"duration":0,"failureMessages":[],"fullName":"processApiResponse returns string if output is string","status":"passed","title":"returns string if output is string"},{"ancestorTitles":["processApiResponse"],"duration":1,"failureMessages":[],"fullName":"processApiResponse returns first element if output is array","status":"passed","title":"returns first element if output is array"},{"ancestorTitles":["processApiResponse"],"duration":0,"failureMessages":[],"fullName":"processApiResponse returns output property if output is object with output","status":"passed","title":"returns output property if output is object with output"},{"ancestorTitles":["processApiResponse"],"duration":2,"failureMessages":[],"fullName":"processApiResponse throws error for invalid api response","status":"passed","title":"throws error for invalid api response"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168600503,"runtime":28,"slow":false,"start":1745168600475},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/handleBuy.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["handlers/handleBuy"],"duration":1,"failureMessages":[],"fullName":"handlers/handleBuy sends invoice for matching amount in English","status":"passed","title":"sends invoice for matching amount in English"},{"ancestorTitles":["handlers/handleBuy"],"duration":1,"failureMessages":[],"fullName":"handlers/handleBuy sends invoice for matching amount in Russian","status":"passed","title":"sends invoice for matching amount in Russian"},{"ancestorTitles":["handlers/handleBuy"],"duration":0,"failureMessages":[],"fullName":"handlers/handleBuy does not send invoice when data does not match any amount","status":"passed","title":"does not send invoice when data does not match any amount"},{"ancestorTitles":["handlers/handleBuy"],"duration":2,"failureMessages":[],"fullName":"handlers/handleBuy propagates error when replyWithInvoice throws","status":"passed","title":"propagates error when replyWithInvoice throws"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168600533,"runtime":24,"slow":false,"start":1745168600509},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/commands/get100Command.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["get100Command"],"duration":1,"failureMessages":[],"fullName":"get100Command should throw error when from.id missing","status":"passed","title":"should throw error when from.id missing"},{"ancestorTitles":["get100Command"],"duration":1,"failureMessages":[],"fullName":"get100Command should reply error and return when chat.id is missing","status":"passed","title":"should reply error and return when chat.id is missing"},{"ancestorTitles":["get100Command"],"duration":1,"failureMessages":[],"fullName":"get100Command should call generateNeuroImage and deleteMessage on success","status":"passed","title":"should call generateNeuroImage and deleteMessage on success"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168600567,"runtime":28,"slow":false,"start":1745168600539},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/commands/priceCommand.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["priceCommand"],"duration":5,"failureMessages":[],"fullName":"priceCommand replies with English price message for non-Russian user","status":"passed","title":"replies with English price message for non-Russian user"},{"ancestorTitles":["priceCommand"],"duration":0,"failureMessages":[],"fullName":"priceCommand replies with Russian price message for Russian user","status":"passed","title":"replies with Russian price message for Russian user"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168600595,"runtime":26,"slow":false,"start":1745168600569},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/helpers/calculateCostInStars.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["calculateCostInStars"],"duration":1,"failureMessages":[],"fullName":"calculateCostInStars returns 0 when costInDollars is 0","status":"passed","title":"returns 0 when costInDollars is 0"},{"ancestorTitles":["calculateCostInStars"],"duration":0,"failureMessages":[],"fullName":"calculateCostInStars returns 1 when costInDollars equals starCost","status":"passed","title":"returns 1 when costInDollars equals starCost"},{"ancestorTitles":["calculateCostInStars"],"duration":1,"failureMessages":[],"fullName":"calculateCostInStars calculates correctly for arbitrary cost","status":"passed","title":"calculates correctly for arbitrary cost"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168600622,"runtime":25,"slow":false,"start":1745168600597},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/models.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["Image Model Prices"],"duration":1,"failureMessages":[],"fullName":"Image Model Prices should have at least one model entry with the correct structure","status":"passed","title":"should have at least one model entry with the correct structure"},{"ancestorTitles":["Video Model Prices"],"duration":1,"failureMessages":[],"fullName":"Video Model Prices should have correct base prices for known video models","status":"passed","title":"should have correct base prices for known video models"},{"ancestorTitles":["calculateFinalImageCostInStars"],"duration":0,"failureMessages":[],"fullName":"calculateFinalImageCostInStars calculates ceiling of (baseCost * (1 + interestRate) / starCost)","status":"passed","title":"calculates ceiling of (baseCost * (1 + interestRate) / starCost)"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168600654,"runtime":31,"slow":false,"start":1745168600623},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/validateAndCalculateVideoModelPrice.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["validateAndCalculateVideoModelPrice"],"duration":1,"failureMessages":[],"fullName":"validateAndCalculateVideoModelPrice returns null and prompts when videoModel is empty or invalid","status":"passed","title":"returns null and prompts when videoModel is empty or invalid"},{"ancestorTitles":["validateAndCalculateVideoModelPrice"],"duration":1,"failureMessages":[],"fullName":"validateAndCalculateVideoModelPrice returns null and prompts when model not in videoModelPrices","status":"passed","title":"returns null and prompts when model not in videoModelPrices"},{"ancestorTitles":["validateAndCalculateVideoModelPrice"],"duration":0,"failureMessages":[],"fullName":"validateAndCalculateVideoModelPrice returns null and prompts when currentBalance is insufficient","status":"passed","title":"returns null and prompts when currentBalance is insufficient"},{"ancestorTitles":["validateAndCalculateVideoModelPrice"],"duration":1,"failureMessages":[],"fullName":"validateAndCalculateVideoModelPrice returns price when model valid and balance sufficient","status":"passed","title":"returns price when model valid and balance sufficient"}]},{"numFailingTests":0,"numPassingTests":5,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168600731,"runtime":74,"slow":false,"start":1745168600657},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/sceneFactory.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["composeWizardScene"],"duration":1,"failureMessages":[],"fullName":"composeWizardScene returns a function to create WizardScene","status":"passed","title":"returns a function to create WizardScene"},{"ancestorTitles":["composeWizardScene"],"duration":0,"failureMessages":[],"fullName":"composeWizardScene creates WizardScene with sceneType and handlers","status":"passed","title":"creates WizardScene with sceneType and handlers"},{"ancestorTitles":["composeWizardScene"],"duration":1,"failureMessages":[],"fullName":"composeWizardScene handlers skip when no message and no callbackQuery","status":"passed","title":"handlers skip when no message and no callbackQuery"},{"ancestorTitles":["composeWizardScene"],"duration":0,"failureMessages":[],"fullName":"composeWizardScene calls step and enter next scene when message present","status":"passed","title":"calls step and enter next scene when message present"},{"ancestorTitles":["composeWizardScene"],"duration":1,"failureMessages":[],"fullName":"composeWizardScene calls leave when nextScene returns undefined","status":"passed","title":"calls leave when nextScene returns undefined"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168600763,"runtime":30,"slow":false,"start":1745168600733},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/middlewares/getUserPhotoUrl.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getUserPhotoUrl"],"duration":1,"failureMessages":[],"fullName":"getUserPhotoUrl returns null when no photos","status":"passed","title":"returns null when no photos"},{"ancestorTitles":["getUserPhotoUrl"],"duration":0,"failureMessages":[],"fullName":"getUserPhotoUrl returns null when file_path missing","status":"passed","title":"returns null when file_path missing"},{"ancestorTitles":["getUserPhotoUrl"],"duration":1,"failureMessages":[],"fullName":"getUserPhotoUrl returns full URL when file_path present","status":"passed","title":"returns full URL when file_path present"},{"ancestorTitles":["getUserPhotoUrl"],"duration":2,"failureMessages":[],"fullName":"getUserPhotoUrl throws error when getUserProfilePhotos errors","status":"passed","title":"throws error when getUserProfilePhotos errors"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168600799,"runtime":30,"slow":false,"start":1745168600769},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getPrompt.unit.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getPrompt"],"duration":1,"failureMessages":[],"fullName":"getPrompt returns null on error","status":"passed","title":"returns null on error"},{"ancestorTitles":["getPrompt"],"duration":1,"failureMessages":[],"fullName":"getPrompt returns data when present","status":"passed","title":"returns data when present"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168600833,"runtime":32,"slow":false,"start":1745168600801},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getGeneratedImages.unit.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getGeneratedImages"],"duration":1,"failureMessages":[],"fullName":"getGeneratedImages returns default when error","status":"passed","title":"returns default when error"},{"ancestorTitles":["getGeneratedImages"],"duration":1,"failureMessages":[],"fullName":"getGeneratedImages returns parsed numbers when data present","status":"passed","title":"returns parsed numbers when data present"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168600862,"runtime":28,"slow":false,"start":1745168600834},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/services/generateTextToVideo.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["generateTextToVideo"],"duration":5,"failureMessages":[],"fullName":"generateTextToVideo logs info with Russian flag","status":"passed","title":"logs info with Russian flag"},{"ancestorTitles":["generateTextToVideo"],"duration":1,"failureMessages":[],"fullName":"generateTextToVideo logs info with English flag","status":"passed","title":"logs info with English flag"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168600891,"runtime":28,"slow":false,"start":1745168600863},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/helpers/deleteFile.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["deleteFile"],"duration":1,"failureMessages":[],"fullName":"deleteFile should call unlink and log success","status":"passed","title":"should call unlink and log success"},{"ancestorTitles":["deleteFile"],"duration":1,"failureMessages":[],"fullName":"deleteFile should catch and log error when unlink throws","status":"passed","title":"should catch and log error when unlink throws"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168600917,"runtime":24,"slow":false,"start":1745168600893},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/helpers/ensureDirectoryExistence.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["ensureDirectoryExistence"],"duration":1,"failureMessages":[],"fullName":"ensureDirectoryExistence should create directory and log messages","status":"passed","title":"should create directory and log messages"},{"ancestorTitles":["ensureDirectoryExistence"],"duration":0,"failureMessages":[],"fullName":"ensureDirectoryExistence should log error and rethrow when mkdir fails","status":"passed","title":"should log error and rethrow when mkdir fails"}]},{"numFailingTests":0,"numPassingTests":5,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168600948,"runtime":30,"slow":false,"start":1745168600918},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/utils/removeWebhooks.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["removeWebhooks util"],"duration":1,"failureMessages":[],"fullName":"removeWebhooks util resolves true and logs info when no webhook set","status":"passed","title":"resolves true and logs info when no webhook set"},{"ancestorTitles":["removeWebhooks util"],"duration":0,"failureMessages":[],"fullName":"removeWebhooks util deletes webhook and logs info when webhook exists","status":"passed","title":"deletes webhook and logs info when webhook exists"},{"ancestorTitles":["removeWebhooks util"],"duration":0,"failureMessages":[],"fullName":"removeWebhooks util returns false on unauthorized error without retry","status":"passed","title":"returns false on unauthorized error without retry"},{"ancestorTitles":["removeWebhooks util"],"duration":0,"failureMessages":[],"fullName":"removeWebhooks util retries deleteWebhook on other errors and succeeds","status":"passed","title":"retries deleteWebhook on other errors and succeeds"},{"ancestorTitles":["removeWebhooks util"],"duration":1,"failureMessages":[],"fullName":"removeWebhooks util returns false when retry deletion fails","status":"passed","title":"returns false when retry deletion fails"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168600975,"runtime":26,"slow":false,"start":1745168600949},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/utils/getConfig.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getConfig"],"duration":1,"failureMessages":[],"fullName":"getConfig returns default values when no env vars are set","status":"passed","title":"returns default values when no env vars are set"},{"ancestorTitles":["getConfig"],"duration":1,"failureMessages":[],"fullName":"getConfig parses PORT and uses provided env vars","status":"passed","title":"parses PORT and uses provided env vars"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168601004,"runtime":27,"slow":false,"start":1745168600977},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/openai/getCaptionForNews.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getCaptionForNews"],"duration":1,"failureMessages":[],"fullName":"getCaptionForNews should call OpenAI chat completion with correct parameters and return content","status":"passed","title":"should call OpenAI chat completion with correct parameters and return content"},{"ancestorTitles":["getCaptionForNews"],"duration":1,"failureMessages":[],"fullName":"getCaptionForNews should throw if OpenAI returns null content","status":"passed","title":"should throw if OpenAI returns null content"},{"ancestorTitles":["getCaptionForNews"],"duration":1,"failureMessages":[],"fullName":"getCaptionForNews should propagate errors from the OpenAI client","status":"passed","title":"should propagate errors from the OpenAI client"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168601034,"runtime":28,"slow":false,"start":1745168601006},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserVoice.unit.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["updateUserVoice"],"duration":1,"failureMessages":[],"fullName":"updateUserVoice resolves when update succeeds","status":"passed","title":"resolves when update succeeds"},{"ancestorTitles":["updateUserVoice"],"duration":1,"failureMessages":[],"fullName":"updateUserVoice throws error when update returns error","status":"passed","title":"throws error when update returns error"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168601064,"runtime":29,"slow":false,"start":1745168601035},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getModel.unit.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getModel"],"duration":1,"failureMessages":[],"fullName":"getModel throws error on supabase error","status":"passed","title":"throws error on supabase error"},{"ancestorTitles":["getModel"],"duration":1,"failureMessages":[],"fullName":"getModel throws error when data null","status":"passed","title":"throws error when data null"},{"ancestorTitles":["getModel"],"duration":0,"failureMessages":[],"fullName":"getModel returns data.model on success","status":"passed","title":"returns data.model on success"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168601091,"runtime":21,"slow":false,"start":1745168601070},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/helpers/error/errorMessage.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["errorMessage"],"duration":1,"failureMessages":[],"fullName":"errorMessage sends Russian message when isRu true","status":"passed","title":"sends Russian message when isRu true"},{"ancestorTitles":["errorMessage"],"duration":0,"failureMessages":[],"fullName":"errorMessage sends English message when isRu false","status":"passed","title":"sends English message when isRu false"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168601119,"runtime":22,"slow":false,"start":1745168601097},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/handleSuccessfulPayment.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["handlePreCheckoutQuery"],"duration":1,"failureMessages":[],"fullName":"handlePreCheckoutQuery calls answerPreCheckoutQuery with true","status":"passed","title":"calls answerPreCheckoutQuery with true"},{"ancestorTitles":["handlePreCheckoutQuery"],"duration":1,"failureMessages":[],"fullName":"handlePreCheckoutQuery propagates errors from answerPreCheckoutQuery","status":"passed","title":"propagates errors from answerPreCheckoutQuery"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168601146,"runtime":21,"slow":false,"start":1745168601125},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/getPhotoUrl.unit.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getPhotoUrl unit tests"],"duration":0,"failureMessages":[],"fullName":"getPhotoUrl unit tests returns URL for first token","status":"passed","title":"returns URL for first token"},{"ancestorTitles":["getPhotoUrl unit tests"],"duration":1,"failureMessages":[],"fullName":"getPhotoUrl unit tests returns URL for second token","status":"passed","title":"returns URL for second token"},{"ancestorTitles":["getPhotoUrl unit tests"],"duration":0,"failureMessages":[],"fullName":"getPhotoUrl unit tests returns URL for third token","status":"passed","title":"returns URL for third token"},{"ancestorTitles":["getPhotoUrl unit tests"],"duration":0,"failureMessages":[],"fullName":"getPhotoUrl unit tests falls back to default for unknown token","status":"passed","title":"falls back to default for unknown token"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168601176,"runtime":25,"slow":false,"start":1745168601151},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/menu/sendPromptImprovementMessage.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["sendPromptImprovementMessage"],"duration":1,"failureMessages":[],"fullName":"sendPromptImprovementMessage sends Russian start message when isRu true","status":"passed","title":"sends Russian start message when isRu true"},{"ancestorTitles":["sendPromptImprovementMessage"],"duration":0,"failureMessages":[],"fullName":"sendPromptImprovementMessage sends English start message when isRu false","status":"passed","title":"sends English start message when isRu false"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168601212,"runtime":30,"slow":false,"start":1745168601182},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/menu/sendPhotoDescriptionRequest.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["sendPhotoDescriptionRequest"],"duration":1,"failureMessages":[],"fullName":"sendPhotoDescriptionRequest sends Russian prompt for neuro_photo mode","status":"passed","title":"sends Russian prompt for neuro_photo mode"},{"ancestorTitles":["sendPhotoDescriptionRequest"],"duration":1,"failureMessages":[],"fullName":"sendPhotoDescriptionRequest sends Russian prompt for other mode","status":"passed","title":"sends Russian prompt for other mode"},{"ancestorTitles":["sendPhotoDescriptionRequest"],"duration":0,"failureMessages":[],"fullName":"sendPhotoDescriptionRequest sends English prompt for neuro_photo mode","status":"passed","title":"sends English prompt for neuro_photo mode"},{"ancestorTitles":["sendPhotoDescriptionRequest"],"duration":6,"failureMessages":[],"fullName":"sendPhotoDescriptionRequest sends English prompt for other mode","status":"passed","title":"sends English prompt for other mode"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168601242,"runtime":29,"slow":false,"start":1745168601213},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/imageModelPrices.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["imageModelPrices"],"duration":5,"failureMessages":[],"fullName":"imageModelPrices should contain key flux-1.1-pro with correct cost","status":"passed","title":"should contain key flux-1.1-pro with correct cost"},{"ancestorTitles":["imageModelPrices"],"duration":3,"failureMessages":[],"fullName":"imageModelPrices should have valid inputType array","status":"passed","title":"should have valid inputType array"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168601268,"runtime":25,"slow":false,"start":1745168601243},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/utils/deleteFile.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["deleteFile"],"duration":0,"failureMessages":[],"fullName":"deleteFile should call fs.promises.unlink with given path","status":"passed","title":"should call fs.promises.unlink with given path"},{"ancestorTitles":["deleteFile"],"duration":1,"failureMessages":[],"fullName":"deleteFile should not throw when unlink rejects","status":"passed","title":"should not throw when unlink rejects"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168601295,"runtime":26,"slow":false,"start":1745168601269},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/utils/isValidImage.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["isValidImage"],"duration":0,"failureMessages":[],"fullName":"isValidImage returns true for JPEG header","status":"passed","title":"returns true for JPEG header"},{"ancestorTitles":["isValidImage"],"duration":0,"failureMessages":[],"fullName":"isValidImage returns true for PNG header","status":"passed","title":"returns true for PNG header"},{"ancestorTitles":["isValidImage"],"duration":0,"failureMessages":[],"fullName":"isValidImage returns false for other header","status":"passed","title":"returns false for other header"},{"ancestorTitles":["isValidImage"],"duration":0,"failureMessages":[],"fullName":"isValidImage returns false on error","status":"passed","title":"returns false on error"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168601327,"runtime":30,"slow":false,"start":1745168601297},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/bot/index.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["core/bot index"],"duration":1,"failureMessages":[],"fullName":"core/bot index exports core bot utilities correctly","status":"passed","title":"exports core bot utilities correctly"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168601354,"runtime":26,"slow":false,"start":1745168601328},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/helpers/error/errorMessageAdmin.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["errorMessageAdmin"],"duration":1,"failureMessages":[],"fullName":"errorMessageAdmin sends message when not in dev","status":"passed","title":"sends message when not in dev"},{"ancestorTitles":["errorMessageAdmin"],"duration":0,"failureMessages":[],"fullName":"errorMessageAdmin does not send message when in dev","status":"passed","title":"does not send message when in dev"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168601381,"runtime":26,"slow":false,"start":1745168601355},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/helpers/language.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["isRussian"],"duration":0,"failureMessages":[],"fullName":"isRussian returns true when language_code is ru","status":"passed","title":"returns true when language_code is ru"},{"ancestorTitles":["isRussian"],"duration":0,"failureMessages":[],"fullName":"isRussian returns false when language_code is not ru","status":"passed","title":"returns false when language_code is not ru"},{"ancestorTitles":["isRussian"],"duration":1,"failureMessages":[],"fullName":"isRussian returns false when ctx.from is undefined","status":"passed","title":"returns false when ctx.from is undefined"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168601413,"runtime":30,"slow":false,"start":1745168601383},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/handlePreCheckoutQuery.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["handlePreCheckoutQuery"],"duration":1,"failureMessages":[],"fullName":"handlePreCheckoutQuery calls answerPreCheckoutQuery with true","status":"passed","title":"calls answerPreCheckoutQuery with true"},{"ancestorTitles":["handlePreCheckoutQuery"],"duration":0,"failureMessages":[],"fullName":"handlePreCheckoutQuery propagates error when answerPreCheckoutQuery rejects","status":"passed","title":"propagates error when answerPreCheckoutQuery rejects"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168601439,"runtime":25,"slow":false,"start":1745168601414},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/starAmounts.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["starAmounts constant"],"duration":0,"failureMessages":[],"fullName":"starAmounts constant should contain the expected star amounts","status":"passed","title":"should contain the expected star amounts"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168601467,"runtime":26,"slow":false,"start":1745168601441},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/calculateFinalImageCostInStars.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["calculateFinalImageCostInStars"],"duration":0,"failureMessages":[],"fullName":"calculateFinalImageCostInStars calculates correct cost for baseCost = 1","status":"passed","title":"calculates correct cost for baseCost = 1"},{"ancestorTitles":["calculateFinalImageCostInStars"],"duration":0,"failureMessages":[],"fullName":"calculateFinalImageCostInStars returns 0 for baseCost = 0","status":"passed","title":"returns 0 for baseCost = 0"},{"ancestorTitles":["calculateFinalImageCostInStars"],"duration":0,"failureMessages":[],"fullName":"calculateFinalImageCostInStars handles fractional baseCost","status":"passed","title":"handles fractional baseCost"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168601494,"runtime":25,"slow":false,"start":1745168601469},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/voiceConversationCost.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["voiceConversationCost constant"],"duration":1,"failureMessages":[],"fullName":"voiceConversationCost constant should equal calculateCostInStars(0.99)","status":"passed","title":"should equal calculateCostInStars(0.99)"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168601522,"runtime":26,"slow":false,"start":1745168601496},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/utils/ensureDirectoryExistence.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["ensureDirectoryExistence"],"duration":1,"failureMessages":[],"fullName":"ensureDirectoryExistence should call fs.promises.mkdir with recursive true","status":"passed","title":"should call fs.promises.mkdir with recursive true"},{"ancestorTitles":["ensureDirectoryExistence"],"duration":1,"failureMessages":[],"fullName":"ensureDirectoryExistence should throw if fs.promises.mkdir rejects","status":"passed","title":"should throw if fs.promises.mkdir rejects"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168601556,"runtime":32,"slow":false,"start":1745168601524},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/openai/requests.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["answerAi"],"duration":1,"failureMessages":[],"fullName":"answerAi returns content when GPT provides a message","status":"passed","title":"returns content when GPT provides a message"},{"ancestorTitles":["answerAi"],"duration":1,"failureMessages":[],"fullName":"answerAi throws error when content is empty","status":"passed","title":"throws error when content is empty"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168601583,"runtime":25,"slow":false,"start":1745168601558},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/video.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["video"],"duration":0,"failureMessages":[],"fullName":"video TODO: implement tests for video","status":"passed","title":"TODO: implement tests for video"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168601612,"runtime":28,"slow":false,"start":1745168601584},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getPaymentsInfoByTelegramId.unit.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getPaymentsInfoByTelegramId"],"duration":1,"failureMessages":[],"fullName":"getPaymentsInfoByTelegramId returns empty array on error","status":"passed","title":"returns empty array on error"},{"ancestorTitles":["getPaymentsInfoByTelegramId"],"duration":0,"failureMessages":[],"fullName":"getPaymentsInfoByTelegramId returns payments data when present","status":"passed","title":"returns payments data when present"},{"ancestorTitles":["getPaymentsInfoByTelegramId"],"duration":1,"failureMessages":[],"fullName":"getPaymentsInfoByTelegramId returns empty array when no payments found","status":"passed","title":"returns empty array when no payments found"}]},{"numFailingTests":0,"numPassingTests":7,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168601642,"runtime":28,"slow":false,"start":1745168601614},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/checkFullAccess.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["checkFullAccess"],"duration":1,"failureMessages":[],"fullName":"checkFullAccess returns true for subscription 'neurophoto'","status":"passed","title":"returns true for subscription 'neurophoto'"},{"ancestorTitles":["checkFullAccess"],"duration":0,"failureMessages":[],"fullName":"checkFullAccess returns true for subscription 'neurobase'","status":"passed","title":"returns true for subscription 'neurobase'"},{"ancestorTitles":["checkFullAccess"],"duration":0,"failureMessages":[],"fullName":"checkFullAccess returns true for subscription 'neuromeeting'","status":"passed","title":"returns true for subscription 'neuromeeting'"},{"ancestorTitles":["checkFullAccess"],"duration":1,"failureMessages":[],"fullName":"checkFullAccess returns true for subscription 'neuroblogger'","status":"passed","title":"returns true for subscription 'neuroblogger'"},{"ancestorTitles":["checkFullAccess"],"duration":0,"failureMessages":[],"fullName":"checkFullAccess returns true for subscription 'neurotester'","status":"passed","title":"returns true for subscription 'neurotester'"},{"ancestorTitles":["checkFullAccess"],"duration":0,"failureMessages":[],"fullName":"checkFullAccess returns false for unknown subscription","status":"passed","title":"returns false for unknown subscription"},{"ancestorTitles":["checkFullAccess"],"duration":0,"failureMessages":[],"fullName":"checkFullAccess returns false for empty string","status":"passed","title":"returns false for empty string"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168601668,"runtime":25,"slow":false,"start":1745168601643},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/menu/cancelHelpArray.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["cancelHelpArray"],"duration":0,"failureMessages":[],"fullName":"cancelHelpArray returns Russian array when isRu true","status":"passed","title":"returns Russian array when isRu true"},{"ancestorTitles":["cancelHelpArray"],"duration":1,"failureMessages":[],"fullName":"cancelHelpArray returns English array when isRu false","status":"passed","title":"returns English array when isRu false"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168601698,"runtime":28,"slow":false,"start":1745168601670},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/inviteScene.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["inviteScene enter handler logic"],"duration":1,"failureMessages":[],"fullName":"inviteScene enter handler logic sends invitation text and link, then enters MainMenu","status":"passed","title":"sends invitation text and link, then enters MainMenu"},{"ancestorTitles":["inviteScene enter handler logic"],"duration":0,"failureMessages":[],"fullName":"inviteScene enter handler logic handles error by notifying user","status":"passed","title":"handles error by notifying user"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168601726,"runtime":27,"slow":false,"start":1745168601699},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/services/generateImageFromPrompt.unit.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["generateImageFromPrompt"],"duration":1,"failureMessages":[],"fullName":"generateImageFromPrompt logs the input parameters and returns fake URL","status":"passed","title":"logs the input parameters and returns fake URL"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168601753,"runtime":26,"slow":false,"start":1745168601727},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/services/generateImageFromPrompt.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["generateImageFromPrompt"],"duration":1,"failureMessages":[],"fullName":"generateImageFromPrompt returns dummy URL and logs parameters with all args","status":"passed","title":"returns dummy URL and logs parameters with all args"},{"ancestorTitles":["generateImageFromPrompt"],"duration":0,"failureMessages":[],"fullName":"generateImageFromPrompt works without optional args","status":"passed","title":"works without optional args"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168601783,"runtime":29,"slow":false,"start":1745168601754},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/menu/sendPromptImprovementFailureMessage.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["sendPromptImprovementFailureMessage"],"duration":1,"failureMessages":[],"fullName":"sendPromptImprovementFailureMessage sends Russian failure message when isRu true","status":"passed","title":"sends Russian failure message when isRu true"},{"ancestorTitles":["sendPromptImprovementFailureMessage"],"duration":0,"failureMessages":[],"fullName":"sendPromptImprovementFailureMessage sends English failure message when isRu false","status":"passed","title":"sends English failure message when isRu false"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168601810,"runtime":26,"slow":false,"start":1745168601784},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/models/calculateFinalImageCostInStars.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["calculateFinalImageCostInStars"],"duration":0,"failureMessages":[],"fullName":"calculateFinalImageCostInStars returns 0 when baseCost is 0","status":"passed","title":"returns 0 when baseCost is 0"},{"ancestorTitles":["calculateFinalImageCostInStars"],"duration":0,"failureMessages":[],"fullName":"calculateFinalImageCostInStars calculates correct number of stars","status":"passed","title":"calculates correct number of stars"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168601838,"runtime":26,"slow":false,"start":1745168601812},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/utils/delay.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["delay"],"duration":0,"failureMessages":[],"fullName":"delay resolves after given ms","status":"passed","title":"resolves after given ms"},{"ancestorTitles":["delay"],"duration":0,"failureMessages":[],"fullName":"delay resolves on zero ms","status":"passed","title":"resolves on zero ms"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168601866,"runtime":27,"slow":false,"start":1745168601839},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserModel.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getUserModel"],"duration":0,"failureMessages":[],"fullName":"getUserModel TODO: implement tests for getUserModel","status":"passed","title":"TODO: implement tests for getUserModel"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168601895,"runtime":28,"slow":false,"start":1745168601867},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/menu/sendGenerationErrorMessage.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["sendGenerationErrorMessage"],"duration":1,"failureMessages":[],"fullName":"sendGenerationErrorMessage replies with Russian message when isRu true","status":"passed","title":"replies with Russian message when isRu true"},{"ancestorTitles":["sendGenerationErrorMessage"],"duration":1,"failureMessages":[],"fullName":"sendGenerationErrorMessage replies with English message when isRu false","status":"passed","title":"replies with English message when isRu false"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168601924,"runtime":27,"slow":false,"start":1745168601897},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/helpers/calculateStars.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["calculateStars"],"duration":0,"failureMessages":[],"fullName":"calculateStars floors the division of payment by star cost","status":"passed","title":"floors the division of payment by star cost"},{"ancestorTitles":["calculateStars"],"duration":1,"failureMessages":[],"fullName":"calculateStars returns zero when payment less than star cost","status":"passed","title":"returns zero when payment less than star cost"},{"ancestorTitles":["calculateStars"],"duration":0,"failureMessages":[],"fullName":"calculateStars exact division returns exact result","status":"passed","title":"exact division returns exact result"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168601952,"runtime":27,"slow":false,"start":1745168601925},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/index.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["Price Module","calculateDiscountedPrice"],"duration":0,"failureMessages":[],"fullName":"Price Module calculateDiscountedPrice applies discount correctly within range","status":"passed","title":"applies discount correctly within range"},{"ancestorTitles":["Price Module","module constants"],"duration":1,"failureMessages":[],"fullName":"Price Module module constants exports correct interestRate and basePrice","status":"passed","title":"exports correct interestRate and basePrice"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168601980,"runtime":26,"slow":false,"start":1745168601954},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/videoModelPrices.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["videoModelPrices"],"duration":1,"failureMessages":[],"fullName":"videoModelPrices should contain known model names with expected values","status":"passed","title":"should contain known model names with expected values"},{"ancestorTitles":["videoModelPrices"],"duration":0,"failureMessages":[],"fullName":"videoModelPrices should not include unexpected models","status":"passed","title":"should not include unexpected models"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168602009,"runtime":28,"slow":false,"start":1745168601981},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/utils/errorMessage.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["errorMessage"],"duration":1,"failureMessages":[],"fullName":"errorMessage sends Russian error message","status":"passed","title":"sends Russian error message"},{"ancestorTitles":["errorMessage"],"duration":0,"failureMessages":[],"fullName":"errorMessage sends English error message","status":"passed","title":"sends English error message"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168602036,"runtime":26,"slow":false,"start":1745168602010},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/utils/language.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["isRussian"],"duration":1,"failureMessages":[],"fullName":"isRussian should return true for ru language_code","status":"passed","title":"should return true for ru language_code"},{"ancestorTitles":["isRussian"],"duration":0,"failureMessages":[],"fullName":"isRussian should return false for non-ru language_code","status":"passed","title":"should return false for non-ru language_code"},{"ancestorTitles":["isRussian"],"duration":0,"failureMessages":[],"fullName":"isRussian should return false if from is undefined","status":"passed","title":"should return false if from is undefined"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168602064,"runtime":27,"slow":false,"start":1745168602037},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getPaymentsInfoByTelegramId.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getPaymentsInfoByTelegramId"],"duration":0,"failureMessages":[],"fullName":"getPaymentsInfoByTelegramId returns payment data when query succeeds","status":"passed","title":"returns payment data when query succeeds"},{"ancestorTitles":["getPaymentsInfoByTelegramId"],"duration":1,"failureMessages":[],"fullName":"getPaymentsInfoByTelegramId returns empty array and logs error when query fails","status":"passed","title":"returns empty array and logs error when query fails"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168602092,"runtime":26,"slow":false,"start":1745168602066},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserVoice.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["updateUserVoice"],"duration":0,"failureMessages":[],"fullName":"updateUserVoice TODO: implement tests for updateUserVoice","status":"passed","title":"TODO: implement tests for updateUserVoice"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168602118,"runtime":25,"slow":false,"start":1745168602093},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserLevel.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["updateUserLevel"],"duration":0,"failureMessages":[],"fullName":"updateUserLevel TODO: implement tests for updateUserLevel","status":"passed","title":"TODO: implement tests for updateUserLevel"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168602145,"runtime":25,"slow":false,"start":1745168602120},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/models/videoModelPrices.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["videoModelPrices mapping"],"duration":1,"failureMessages":[],"fullName":"videoModelPrices mapping matches expected video model price mappings","status":"passed","title":"matches expected video model price mappings"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168602172,"runtime":25,"slow":false,"start":1745168602147},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/interestRate.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["interestRate constant"],"duration":0,"failureMessages":[],"fullName":"interestRate constant should be a positive number equal to 0.5","status":"passed","title":"should be a positive number equal to 0.5"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168602199,"runtime":25,"slow":false,"start":1745168602174},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/starCost.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["starCost constant"],"duration":1,"failureMessages":[],"fullName":"starCost constant should be a positive number equal to 0.016","status":"passed","title":"should be a positive number equal to 0.016"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168602225,"runtime":25,"slow":false,"start":1745168602200},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserLevel.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getUserLevel"],"duration":0,"failureMessages":[],"fullName":"getUserLevel TODO: implement tests for getUserLevel","status":"passed","title":"TODO: implement tests for getUserLevel"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745168602254,"runtime":28,"slow":false,"start":1745168602226},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/incrementLimit.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["incrementLimit"],"duration":1,"failureMessages":[],"fullName":"incrementLimit TODO: implement tests for incrementLimit","status":"passed","title":"TODO: implement tests for incrementLimit"}]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/services/generateTextToSpeech.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/services/generateTextToSpeech.test.ts\u001b[0m:\u001b[93m2\u001b[0m:\u001b[93m3\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2614: \u001b[0mModule '\"axios\"' has no exported member 'describe'. Did you mean to use 'import describe from \"axios\"' instead?\n\n    \u001b[7m2\u001b[0m   describe,\n    \u001b[7m \u001b[0m \u001b[91m  ~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateTextToSpeech.test.ts\u001b[0m:\u001b[93m3\u001b[0m:\u001b[93m3\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2614: \u001b[0mModule '\"axios\"' has no exported member 'it'. Did you mean to use 'import it from \"axios\"' instead?\n\n    \u001b[7m3\u001b[0m   it,\n    \u001b[7m \u001b[0m \u001b[91m  ~~\u001b[0m\n    \u001b[96m__tests__/services/generateTextToSpeech.test.ts\u001b[0m:\u001b[93m4\u001b[0m:\u001b[93m3\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2614: \u001b[0mModule '\"axios\"' has no exported member 'expect'. Did you mean to use 'import expect from \"axios\"' instead?\n\n    \u001b[7m4\u001b[0m   expect,\n    \u001b[7m \u001b[0m \u001b[91m  ~~~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateTextToSpeech.test.ts\u001b[0m:\u001b[93m5\u001b[0m:\u001b[93m3\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2614: \u001b[0mModule '\"axios\"' has no exported member 'jest'. Did you mean to use 'import jest from \"axios\"' instead?\n\n    \u001b[7m5\u001b[0m   jest,\n    \u001b[7m \u001b[0m \u001b[91m  ~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateTextToSpeech.test.ts\u001b[0m:\u001b[93m6\u001b[0m:\u001b[93m3\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2614: \u001b[0mModule '\"axios\"' has no exported member 'beforeEach'. Did you mean to use 'import beforeEach from \"axios\"' instead?\n\n    \u001b[7m6\u001b[0m   beforeEach,\n    \u001b[7m \u001b[0m \u001b[91m  ~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateTextToSpeech.test.ts\u001b[0m:\u001b[93m7\u001b[0m:\u001b[93m3\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2614: \u001b[0mModule '\"axios\"' has no exported member 'afterEach'. Did you mean to use 'import afterEach from \"axios\"' instead?\n\n    \u001b[7m7\u001b[0m   afterEach,\n    \u001b[7m \u001b[0m \u001b[91m  ~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateTextToSpeech.test.ts\u001b[0m:\u001b[93m8\u001b[0m:\u001b[93m1\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2614: \u001b[0mModule '\"axios\"' has no exported member 'import'. Did you mean to use 'import import from \"axios\"' instead?\n\n    \u001b[7m8\u001b[0m import axios from 'axios'\n    \u001b[7m \u001b[0m \u001b[91m~~~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateTextToSpeech.test.ts\u001b[0m:\u001b[93m8\u001b[0m:\u001b[93m8\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2440: \u001b[0mImport declaration conflicts with local declaration of 'axios'.\n\n    \u001b[7m8\u001b[0m import axios from 'axios'\n    \u001b[7m \u001b[0m \u001b[91m       ~~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateTextToSpeech.test.ts\u001b[0m:\u001b[93m9\u001b[0m:\u001b[93m29\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2307: \u001b[0mCannot find module '../../../__tests__/utils/mockTelegrafContext' or its corresponding type declarations.\n\n    \u001b[7m9\u001b[0m import makeMockContext from '../../../__tests__/utils/mockTelegrafContext'\n    \u001b[7m \u001b[0m \u001b[91m                            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateTextToSpeech.test.ts\u001b[0m:\u001b[93m33\u001b[0m:\u001b[93m7\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2440: \u001b[0mImport declaration conflicts with local declaration of 'axios'.\n\n    \u001b[7m33\u001b[0m const axios = require('axios') // –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ require\n    \u001b[7m  \u001b[0m \u001b[91m      ~~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateTextToSpeech.test.ts\u001b[0m:\u001b[93m8\u001b[0m:\u001b[93m1\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1003: \u001b[0mIdentifier expected.\n\n    \u001b[7m8\u001b[0m import axios from 'axios'\n    \u001b[7m \u001b[0m \u001b[91m~~~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateTextToSpeech.test.ts\u001b[0m:\u001b[93m8\u001b[0m:\u001b[93m8\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1005: \u001b[0m',' expected.\n\n    \u001b[7m8\u001b[0m import axios from 'axios'\n    \u001b[7m \u001b[0m \u001b[91m       ~~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateTextToSpeech.test.ts\u001b[0m:\u001b[93m8\u001b[0m:\u001b[93m14\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1005: \u001b[0m',' expected.\n\n    \u001b[7m8\u001b[0m import axios from 'axios'\n    \u001b[7m \u001b[0m \u001b[91m             ~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/services/downloadFile.unit.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    TypeError: Cannot read properties of undefined (reading 'native')\n\n      1 | import { createWriteStream } from 'fs'\n      2 | import path from 'path'\n    > 3 | import archiver from 'archiver'\n        | ^\n      4 | import * as fs from 'fs/promises'\n      5 | import { BufferType } from '../../interfaces'\n      6 |\n\n      at Object.<anonymous> (node_modules/.pnpm/path-scurry@1.11.1/node_modules/path-scurry/src/index.ts:15:26)\n      at Object.<anonymous> (node_modules/.pnpm/glob@10.4.5/node_modules/glob/src/glob.ts:4:1)\n      at Object.<anonymous> (node_modules/.pnpm/glob@10.4.5/node_modules/glob/src/index.ts:10:1)\n      at Object.<anonymous> (node_modules/.pnpm/archiver-utils@5.0.2/node_modules/archiver-utils/file.js:16:12)\n      at Object.<anonymous> (node_modules/.pnpm/archiver-utils@5.0.2/node_modules/archiver-utils/index.js:19:14)\n      at Object.<anonymous> (node_modules/.pnpm/archiver@7.0.1/node_modules/archiver/lib/core.js:12:12)\n      at Object.<anonymous> (node_modules/.pnpm/archiver@7.0.1/node_modules/archiver/index.js:8:16)\n      at Object.<anonymous> (src/helpers/images/createImagesZip.ts:3:1)\n      at Object.<anonymous> (src/helpers/images/index.ts:1:1)\n      at Object.<anonymous> (src/helpers/index.ts:10:1)\n      at Object.<anonymous> (src/services/generateLipSync.ts:6:1)\n      at Object.<anonymous> (__tests__/services/downloadFile.unit.test.ts:8:1)\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/services/generateTextToImage.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/services/generateTextToImage.test.ts\u001b[0m:\u001b[93m12\u001b[0m:\u001b[93m61\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '() => void' is not assignable to parameter of type '(infoObject: object) => Logger'.\n      Type 'void' is not assignable to type 'Logger'.\n\n    \u001b[7m12\u001b[0m     infoSpy = jest.spyOn(logger, 'info').mockImplementation(() => {})\n    \u001b[7m  \u001b[0m \u001b[91m                                                            ~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/services/generateImageToPrompt.unit.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/services/generateImageToPrompt.unit.test.ts\u001b[0m:\u001b[93m25\u001b[0m:\u001b[93m76\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'boolean' is not assignable to parameter of type 'string'.\n\n    \u001b[7m25\u001b[0m     const result = await generateImageToPrompt(imageUrl, telegram_id, ctx, true, 'bot')\n    \u001b[7m  \u001b[0m \u001b[91m                                                                           ~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateImageToPrompt.unit.test.ts\u001b[0m:\u001b[93m33\u001b[0m:\u001b[93m6\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2352: \u001b[0mConversion of type '<T = any, D = any>(payload: any) => payload is AxiosError<T, D>' to type 'Mock<any, any, any>' may be a mistake because neither type sufficiently overlaps with the other. If this was intentional, convert the expression to 'unknown' first.\n      Type '<T = any, D = any>(payload: any) => payload is AxiosError<T, D>' is missing the following properties from type 'Mock<any, any, any>': getMockName, mock, mockClear, mockReset, and 13 more.\n\n    \u001b[7m33\u001b[0m     (axios.isAxiosError as jest.Mock).mockReturnValue(false)\n    \u001b[7m  \u001b[0m \u001b[91m     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateImageToPrompt.unit.test.ts\u001b[0m:\u001b[93m34\u001b[0m:\u001b[93m76\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'boolean' is not assignable to parameter of type 'string'.\n\n    \u001b[7m34\u001b[0m     const result = await generateImageToPrompt(imageUrl, telegram_id, ctx, false, 'bot')\n    \u001b[7m  \u001b[0m \u001b[91m                                                                           ~~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateImageToPrompt.unit.test.ts\u001b[0m:\u001b[93m58\u001b[0m:\u001b[93m6\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2352: \u001b[0mConversion of type '<T = any, D = any>(payload: any) => payload is AxiosError<T, D>' to type 'Mock<any, any, any>' may be a mistake because neither type sufficiently overlaps with the other. If this was intentional, convert the expression to 'unknown' first.\n      Type '<T = any, D = any>(payload: any) => payload is AxiosError<T, D>' is missing the following properties from type 'Mock<any, any, any>': getMockName, mock, mockClear, mockReset, and 13 more.\n\n    \u001b[7m58\u001b[0m     (axios.isAxiosError as jest.Mock).mockReturnValue(true)\n    \u001b[7m  \u001b[0m \u001b[91m     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateImageToPrompt.unit.test.ts\u001b[0m:\u001b[93m59\u001b[0m:\u001b[93m61\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'boolean' is not assignable to parameter of type 'string'.\n\n    \u001b[7m59\u001b[0m     await generateImageToPrompt(imageUrl, telegram_id, ctx, true, 'bot')\n    \u001b[7m  \u001b[0m \u001b[91m                                                            ~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateImageToPrompt.unit.test.ts\u001b[0m:\u001b[93m67\u001b[0m:\u001b[93m17\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Type 'Error' has no call signatures.\n\n    \u001b[7m67\u001b[0m     const err = new Error('boom')\n    \u001b[7m  \u001b[0m \u001b[91m                ~~~~~~~~~~~~~~~~~\u001b[0m\n\n      \u001b[96m__tests__/services/generateImageToPrompt.unit.test.ts\u001b[0m:\u001b[93m67\u001b[0m:\u001b[93m17\u001b[0m\n        \u001b[7m67\u001b[0m     const err = new Error('boom')\n        \u001b[7m  \u001b[0m \u001b[96m                ~~~~~~~~~~~~~~~~~\u001b[0m\n        Are you missing a semicolon?\n    \u001b[96m__tests__/services/generateImageToPrompt.unit.test.ts\u001b[0m:\u001b[93m68\u001b[0m:\u001b[93m49\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2448: \u001b[0mBlock-scoped variable 'err' used before its declaration.\n\n    \u001b[7m68\u001b[0m     (axios.post as jest.Mock).mockRejectedValue(err)\n    \u001b[7m  \u001b[0m \u001b[91m                                                ~~~\u001b[0m\n\n      \u001b[96m__tests__/services/generateImageToPrompt.unit.test.ts\u001b[0m:\u001b[93m67\u001b[0m:\u001b[93m11\u001b[0m\n        \u001b[7m67\u001b[0m     const err = new Error('boom')\n        \u001b[7m  \u001b[0m \u001b[96m          ~~~\u001b[0m\n        'err' is declared here.\n    \u001b[96m__tests__/services/generateImageToPrompt.unit.test.ts\u001b[0m:\u001b[93m69\u001b[0m:\u001b[93m6\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2352: \u001b[0mConversion of type '<T = any, D = any>(payload: any) => payload is AxiosError<T, D>' to type 'Mock<any, any, any>' may be a mistake because neither type sufficiently overlaps with the other. If this was intentional, convert the expression to 'unknown' first.\n      Type '<T = any, D = any>(payload: any) => payload is AxiosError<T, D>' is missing the following properties from type 'Mock<any, any, any>': getMockName, mock, mockClear, mockReset, and 13 more.\n\n    \u001b[7m69\u001b[0m     (axios.isAxiosError as jest.Mock).mockReturnValue(false)\n    \u001b[7m  \u001b[0m \u001b[91m     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateImageToPrompt.unit.test.ts\u001b[0m:\u001b[93m71\u001b[0m:\u001b[93m57\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'boolean' is not assignable to parameter of type 'string'.\n\n    \u001b[7m71\u001b[0m       generateImageToPrompt(imageUrl, telegram_id, ctx, false, 'bot')\n    \u001b[7m  \u001b[0m \u001b[91m                                                        ~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/services/generateLipSync.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/services/generateLipSync.test.ts\u001b[0m:\u001b[93m61\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Type 'typeof jest' has no call signatures.\n\n    \u001b[7m61\u001b[0m     jest.doMock('@/config', () => ({ isDev: false, ELESTIO_URL: 'https://api', LOCAL_SERVER_URL: 'http://localhost', SECRET_API_KEY: 'secret' }))\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n\n      \u001b[96m__tests__/services/generateLipSync.test.ts\u001b[0m:\u001b[93m61\u001b[0m:\u001b[93m5\u001b[0m\n        \u001b[7m61\u001b[0m     jest.doMock('@/config', () => ({ isDev: false, ELESTIO_URL: 'https://api', LOCAL_SERVER_URL: 'http://localhost', SECRET_API_KEY: 'secret' }))\n        \u001b[7m  \u001b[0m \u001b[96m    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n        Are you missing a semicolon?\n    \u001b[96m__tests__/services/generateLipSync.test.ts\u001b[0m:\u001b[93m83\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Type 'typeof jest' has no call signatures.\n\n    \u001b[7m83\u001b[0m     jest.doMock('axios', () => axios)\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n\n      \u001b[96m__tests__/services/generateLipSync.test.ts\u001b[0m:\u001b[93m83\u001b[0m:\u001b[93m5\u001b[0m\n        \u001b[7m83\u001b[0m     jest.doMock('axios', () => axios)\n        \u001b[7m  \u001b[0m \u001b[96m    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n        Are you missing a semicolon?\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/services/downloadFile.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    TypeError: Cannot read properties of undefined (reading 'native')\n\n      1 | import { createWriteStream } from 'fs'\n      2 | import path from 'path'\n    > 3 | import archiver from 'archiver'\n        | ^\n      4 | import * as fs from 'fs/promises'\n      5 | import { BufferType } from '../../interfaces'\n      6 |\n\n      at Object.<anonymous> (node_modules/.pnpm/path-scurry@1.11.1/node_modules/path-scurry/src/index.ts:15:26)\n      at Object.<anonymous> (node_modules/.pnpm/glob@10.4.5/node_modules/glob/src/glob.ts:4:1)\n      at Object.<anonymous> (node_modules/.pnpm/glob@10.4.5/node_modules/glob/src/index.ts:10:1)\n      at Object.<anonymous> (node_modules/.pnpm/archiver-utils@5.0.2/node_modules/archiver-utils/file.js:16:12)\n      at Object.<anonymous> (node_modules/.pnpm/archiver-utils@5.0.2/node_modules/archiver-utils/index.js:19:14)\n      at Object.<anonymous> (node_modules/.pnpm/archiver@7.0.1/node_modules/archiver/lib/core.js:12:12)\n      at Object.<anonymous> (node_modules/.pnpm/archiver@7.0.1/node_modules/archiver/index.js:8:16)\n      at Object.<anonymous> (src/helpers/images/createImagesZip.ts:3:1)\n      at Object.<anonymous> (src/helpers/images/index.ts:1:1)\n      at Object.<anonymous> (src/helpers/index.ts:10:1)\n      at Object.<anonymous> (src/services/generateLipSync.ts:6:1)\n      at Object.<anonymous> (__tests__/services/downloadFile.test.ts:6:1)\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/services/createModelTraining.unit.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/services/createModelTraining.unit.test.ts\u001b[0m:\u001b[93m72\u001b[0m:\u001b[93m17\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Type 'Error' has no call signatures.\n\n    \u001b[7m72\u001b[0m     const err = new Error('xyz')\n    \u001b[7m  \u001b[0m \u001b[91m                ~~~~~~~~~~~~~~~~\u001b[0m\n\n      \u001b[96m__tests__/services/createModelTraining.unit.test.ts\u001b[0m:\u001b[93m72\u001b[0m:\u001b[93m17\u001b[0m\n        \u001b[7m72\u001b[0m     const err = new Error('xyz')\n        \u001b[7m  \u001b[0m \u001b[96m                ~~~~~~~~~~~~~~~~\u001b[0m\n        Are you missing a semicolon?\n    \u001b[96m__tests__/services/createModelTraining.unit.test.ts\u001b[0m:\u001b[93m73\u001b[0m:\u001b[93m49\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2448: \u001b[0mBlock-scoped variable 'err' used before its declaration.\n\n    \u001b[7m73\u001b[0m     (axios.post as jest.Mock).mockRejectedValue(err)\n    \u001b[7m  \u001b[0m \u001b[91m                                                ~~~\u001b[0m\n\n      \u001b[96m__tests__/services/createModelTraining.unit.test.ts\u001b[0m:\u001b[93m72\u001b[0m:\u001b[93m11\u001b[0m\n        \u001b[7m72\u001b[0m     const err = new Error('xyz')\n        \u001b[7m  \u001b[0m \u001b[96m          ~~~\u001b[0m\n        'err' is declared here.\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/helpers/error/errorHandler.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/helpers/error/errorHandler.test.ts\u001b[0m:\u001b[93m10\u001b[0m:\u001b[93m52\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '() => void' is not assignable to parameter of type '(infoObject: object) => Logger'.\n      Type 'void' is not assignable to type 'Logger'.\n\n    \u001b[7m10\u001b[0m     jest.spyOn(logger, 'error').mockImplementation(() => {});\n    \u001b[7m  \u001b[0m \u001b[91m                                                   ~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/helpers/error/errorHandler.test.ts\u001b[0m:\u001b[93m11\u001b[0m:\u001b[93m51\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '() => void' is not assignable to parameter of type '(infoObject: object) => Logger'.\n      Type 'void' is not assignable to type 'Logger'.\n\n    \u001b[7m11\u001b[0m     jest.spyOn(logger, 'warn').mockImplementation(() => {});\n    \u001b[7m  \u001b[0m \u001b[91m                                                  ~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/helpers/pulse.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/helpers/pulse.test.ts\u001b[0m:\u001b[93m15\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2322: \u001b[0mType 'Mock<Promise<void>, [], any>' is not assignable to type '(chatId: string | number, photo: string | InputFile, extra?: { message_thread_id?: number; parse_mode?: ParseMode; caption_entities?: MessageEntity[]; ... 5 more ...; caption?: string | FmtString<...>; }) => Promise<...>'.\n      Type 'Promise<void>' is not assignable to type 'Promise<PhotoMessage>'.\n        Type 'void' is not assignable to type 'PhotoMessage'.\n\n    \u001b[7m15\u001b[0m     ctx.telegram.sendPhoto = jest.fn(() => Promise.resolve())\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/helpers/pulse.test.ts\u001b[0m:\u001b[93m16\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2322: \u001b[0mType 'Mock<Promise<void>, [], any>' is not assignable to type '(chatId: string | number, text: string | FmtString<string>, extra?: Omit<{ chat_id: string | number; message_thread_id?: number; text: string; parse_mode?: ParseMode; ... 5 more ...; reply_markup?: InlineKeyboardMarkup | ... 2 more ... | ForceReply; }, \"text\" | \"chat_id\">) => Promise<...>'.\n      Type 'Promise<void>' is not assignable to type 'Promise<TextMessage>'.\n        Type 'void' is not assignable to type 'TextMessage'.\n\n    \u001b[7m16\u001b[0m     ctx.telegram.sendMessage = jest.fn(() => Promise.resolve())\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/helpers/pulse.test.ts\u001b[0m:\u001b[93m22\u001b[0m:\u001b[93m17\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'MyContext & DebugExtension' is not assignable to parameter of type 'string | PulseOptions'.\n\n    \u001b[7m22\u001b[0m     await pulse(ctx, base64Image, prompt, command)\n    \u001b[7m  \u001b[0m \u001b[91m                ~~~\u001b[0m\n    \u001b[96m__tests__/helpers/pulse.test.ts\u001b[0m:\u001b[93m29\u001b[0m:\u001b[93m17\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'MyContext & DebugExtension' is not assignable to parameter of type 'string | PulseOptions'.\n\n    \u001b[7m29\u001b[0m     await pulse(ctx, base64Image, prompt, command)\n    \u001b[7m  \u001b[0m \u001b[91m                ~~~\u001b[0m\n    \u001b[96m__tests__/helpers/pulse.test.ts\u001b[0m:\u001b[93m42\u001b[0m:\u001b[93m17\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'MyContext & DebugExtension' is not assignable to parameter of type 'string | PulseOptions'.\n\n    \u001b[7m42\u001b[0m     await pulse(ctx, null, prompt, command)\n    \u001b[7m  \u001b[0m \u001b[91m                ~~~\u001b[0m\n    \u001b[96m__tests__/helpers/pulse.test.ts\u001b[0m:\u001b[93m58\u001b[0m:\u001b[93m17\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'MyContext & DebugExtension' is not assignable to parameter of type 'string | PulseOptions'.\n\n    \u001b[7m58\u001b[0m     await pulse(ctx, base64Image, prompt, command)\n    \u001b[7m  \u001b[0m \u001b[91m                ~~~\u001b[0m\n    \u001b[96m__tests__/helpers/pulse.test.ts\u001b[0m:\u001b[93m66\u001b[0m:\u001b[93m24\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'MyContext & DebugExtension' is not assignable to parameter of type 'string | PulseOptions'.\n\n    \u001b[7m66\u001b[0m     await expect(pulse(ctx, null, prompt, command)).rejects.toThrow(\n    \u001b[7m  \u001b[0m \u001b[91m                       ~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/helpers/index.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/helpers/index.test.ts\u001b[0m:\u001b[93m16\u001b[0m:\u001b[93m27\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'language' does not exist on type 'typeof import(\"/Users/playom/999-multibots-telegraf/src/helpers/index\")'.\n\n    \u001b[7m16\u001b[0m     expect(typeof helpers.language).toBe('function')\n    \u001b[7m  \u001b[0m \u001b[91m                          ~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/handleMenu.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/handlers/handleMenu.test.ts\u001b[0m:\u001b[93m15\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2739: \u001b[0mType '{}' is missing the following properties from type 'MySession': cursor, images, targetUserId, userModel\n\n    \u001b[7m15\u001b[0m     ctx.session = {}\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/handleMenu.test.ts\u001b[0m:\u001b[93m20\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m20\u001b[0m     ctx.from = { language_code: 'ru' } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/handleMenu.test.ts\u001b[0m:\u001b[93m22\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m22\u001b[0m     ctx.message = { text } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/handleMenu.test.ts\u001b[0m:\u001b[93m29\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m29\u001b[0m     ctx.from = { language_code: 'en' } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/handleMenu.test.ts\u001b[0m:\u001b[93m31\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m31\u001b[0m     ctx.message = { text } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/handleMenu.test.ts\u001b[0m:\u001b[93m38\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m38\u001b[0m     ctx.from = { language_code: 'en' } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/handleMenu.test.ts\u001b[0m:\u001b[93m39\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m39\u001b[0m     ctx.message = { text: '/price' } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/handleMenu.test.ts\u001b[0m:\u001b[93m46\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m46\u001b[0m     ctx.from = { language_code: 'ru' } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/handleMenu.test.ts\u001b[0m:\u001b[93m47\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m47\u001b[0m     ctx.message = { text: 'unknown' } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/paymentHandlers.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/handlers/paymentHandlers.test.ts\u001b[0m:\u001b[93m23\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2820: \u001b[0mType '\"neurophoto\"' is not assignable to type 'SubscriptionType'. Did you mean 'SubscriptionType.NEUROPHOTO'?\n\n    \u001b[7m23\u001b[0m     ctx.session.subscription = 'neurophoto'\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/paymentHandlers.test.ts\u001b[0m:\u001b[93m36\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2820: \u001b[0mType '\"neurobase\"' is not assignable to type 'SubscriptionType'. Did you mean 'SubscriptionType.NEUROBASE'?\n\n    \u001b[7m36\u001b[0m     ctx.session.subscription = 'neurobase'\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/hearsHandlers.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/handlers/hearsHandlers.test.ts\u001b[0m:\u001b[93m3\u001b[0m:\u001b[93m27\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2307: \u001b[0mCannot find module '../src/interfaces' or its corresponding type declarations.\n\n    \u001b[7m3\u001b[0m import { MyContext } from '../src/interfaces'\n    \u001b[7m \u001b[0m \u001b[91m                          ~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/hearsHandlers.test.ts\u001b[0m:\u001b[93m25\u001b[0m:\u001b[93m36\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2307: \u001b[0mCannot find module '../src/hearsHandlers' or its corresponding type declarations.\n\n    \u001b[7m25\u001b[0m import { setupHearsHandlers } from '../src/hearsHandlers'\n    \u001b[7m  \u001b[0m \u001b[91m                                   ~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/hearsHandlers.test.ts\u001b[0m:\u001b[93m26\u001b[0m:\u001b[93m24\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2307: \u001b[0mCannot find module '../src/menu' or its corresponding type declarations.\n\n    \u001b[7m26\u001b[0m import { levels } from '../src/menu' // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º levels\n    \u001b[7m  \u001b[0m \u001b[91m                       ~~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/hearsActions.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/handlers/hearsActions.test.ts\u001b[0m:\u001b[93m30\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2739: \u001b[0mType '{}' is missing the following properties from type 'MySession': cursor, images, targetUserId, userModel\n\n    \u001b[7m30\u001b[0m     ctx.session = {}\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/hearsActions.test.ts\u001b[0m:\u001b[93m41\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2739: \u001b[0mType '{}' is missing the following properties from type 'MySession': cursor, images, targetUserId, userModel\n\n    \u001b[7m41\u001b[0m     ctx.session = {}\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/hearsActions.test.ts\u001b[0m:\u001b[93m52\u001b[0m:\u001b[93m21\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2322: \u001b[0mType '\"text_to_video\"' is not assignable to type 'ModeEnum'.\n\n    \u001b[7m52\u001b[0m     ctx.session = { mode: 'text_to_video' }\n    \u001b[7m  \u001b[0m \u001b[91m                    ~~~~\u001b[0m\n\n      \u001b[96msrc/interfaces/telegram-bot.interface.ts\u001b[0m:\u001b[93m154\u001b[0m:\u001b[93m3\u001b[0m\n        \u001b[7m154\u001b[0m   mode?: ModeEnum\n        \u001b[7m   \u001b[0m \u001b[96m  ~~~~\u001b[0m\n        The expected type comes from property 'mode' which is declared here on type 'MySession'\n    \u001b[96m__tests__/handlers/hearsActions.test.ts\u001b[0m:\u001b[93m54\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2322: \u001b[0mType 'Mock<Promise<void>, [], any>' is not assignable to type '(text: string | FmtString<string>, extra?: Omit<{ chat_id: string | number; message_thread_id?: number; text: string; parse_mode?: ParseMode; entities?: MessageEntity[]; ... 4 more ...; reply_markup?: InlineKeyboardMarkup | ... 2 more ... | ForceReply; }, \"chat_id\" | \"text\">) => Promise<...>'.\n      Type 'Promise<void>' is not assignable to type 'Promise<TextMessage>'.\n        Type 'void' is not assignable to type 'TextMessage'.\n\n    \u001b[7m54\u001b[0m     ctx.reply = jest.fn(() => Promise.resolve())\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/hearsActions.test.ts\u001b[0m:\u001b[93m60\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2322: \u001b[0mType '\"image_to_video\"' is not assignable to type 'ModeEnum'.\n\n    \u001b[7m60\u001b[0m     ctx.session.mode = 'image_to_video'\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/hearsActions.test.ts\u001b[0m:\u001b[93m66\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2322: \u001b[0mType '\"other\"' is not assignable to type 'ModeEnum'.\n\n    \u001b[7m66\u001b[0m     ctx.session.mode = 'other'\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/getBotToken.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/handlers/getBotToken.test.ts\u001b[0m:\u001b[93m21\u001b[0m:\u001b[93m19\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'token' because it is a read-only property.\n\n    \u001b[7m21\u001b[0m     ctx.telegram!.token = 'unknown'\n    \u001b[7m  \u001b[0m \u001b[91m                  ~~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/getBotToken.test.ts\u001b[0m:\u001b[93m25\u001b[0m:\u001b[93m19\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'token' because it is a read-only property.\n\n    \u001b[7m25\u001b[0m     ctx.telegram!.token = BOT_TOKENS[0]!\n    \u001b[7m  \u001b[0m \u001b[91m                  ~~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/getBotToken.test.ts\u001b[0m:\u001b[93m29\u001b[0m:\u001b[93m19\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'token' because it is a read-only property.\n\n    \u001b[7m29\u001b[0m     ctx.telegram!.token = BOT_TOKENS[1]!\n    \u001b[7m  \u001b[0m \u001b[91m                  ~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/index.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/handlers/index.test.ts\u001b[0m:\u001b[93m21\u001b[0m:\u001b[93m28\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'registerHearsActions' does not exist on type 'typeof import(\"/Users/playom/999-multibots-telegraf/src/handlers/index\")'.\n\n    \u001b[7m21\u001b[0m     expect(typeof handlers.registerHearsActions).toBe('function')\n    \u001b[7m  \u001b[0m \u001b[91m                           ~~~~~~~~~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/handleHelpCancel.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/handlers/handleHelpCancel.test.ts\u001b[0m:\u001b[93m17\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m17\u001b[0m     ctx.from = { language_code: 'ru' } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/handleHelpCancel.test.ts\u001b[0m:\u001b[93m18\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m18\u001b[0m     ctx.message = { text: '–û—Ç–º–µ–Ω–∞' } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/handleHelpCancel.test.ts\u001b[0m:\u001b[93m27\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m27\u001b[0m     ctx.from = { language_code: 'en' } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/handleHelpCancel.test.ts\u001b[0m:\u001b[93m28\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m28\u001b[0m     ctx.message = { text: 'Cancel' } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/handleHelpCancel.test.ts\u001b[0m:\u001b[93m37\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m37\u001b[0m     ctx.from = { language_code: 'ru' } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/handleHelpCancel.test.ts\u001b[0m:\u001b[93m38\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m38\u001b[0m     ctx.message = { text: '–°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–µ' } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/handleHelpCancel.test.ts\u001b[0m:\u001b[93m47\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m47\u001b[0m     ctx.from = { language_code: 'en' } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/handleHelpCancel.test.ts\u001b[0m:\u001b[93m48\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m48\u001b[0m     ctx.message = { text: 'Help for the command' } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/handleHelpCancel.test.ts\u001b[0m:\u001b[93m57\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m57\u001b[0m     ctx.from = { language_code: 'ru' } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/handleHelpCancel.test.ts\u001b[0m:\u001b[93m58\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m58\u001b[0m     ctx.message = { text: 'something else' } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/handleHelpCancel.test.ts\u001b[0m:\u001b[93m67\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m67\u001b[0m     ctx.from = { language_code: 'en' } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/handleHelpCancel.test.ts\u001b[0m:\u001b[93m68\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m68\u001b[0m     ctx.message = undefined as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/handleTopUp.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/handlers/handleTopUp.test.ts\u001b[0m:\u001b[93m15\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m15\u001b[0m     ctx.from = { language_code: 'ru' } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/getUserInfo.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/handlers/getUserInfo.test.ts\u001b[0m:\u001b[93m12\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m12\u001b[0m     ctx.from = { id: 123, language_code: 'ru' } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/getUserInfo.test.ts\u001b[0m:\u001b[93m23\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m23\u001b[0m     ctx.from = {} as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/getUserInfo.test.ts\u001b[0m:\u001b[93m33\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m33\u001b[0m     ctx.from = { id: 1, language_code: 'en' } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/handleTextMessage.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/handlers/handleTextMessage.test.ts\u001b[0m:\u001b[93m21\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m21\u001b[0m     ctx.from = { id: 42, username: 'user', first_name: 'First', last_name: 'Last', language_code: 'ru' }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/handleTextMessage.test.ts\u001b[0m:\u001b[93m22\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'chat' because it is a read-only property.\n\n    \u001b[7m22\u001b[0m     ctx.chat = { id: 100 }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/handleTextMessage.test.ts\u001b[0m:\u001b[93m28\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m28\u001b[0m     ctx.message = { text: '/start' }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/handleTextMessage.test.ts\u001b[0m:\u001b[93m35\u001b[0m:\u001b[93m12\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2704: \u001b[0mThe operand of a 'delete' operator cannot be a read-only property.\n\n    \u001b[7m35\u001b[0m     delete ctx.message\n    \u001b[7m  \u001b[0m \u001b[91m           ~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/handleTextMessage.test.ts\u001b[0m:\u001b[93m41\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m41\u001b[0m     ctx.message = { text: '' }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/handleTextMessage.test.ts\u001b[0m:\u001b[93m47\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m47\u001b[0m     ctx.message = { text: 'Hello' }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/handleTextMessage.test.ts\u001b[0m:\u001b[93m65\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m65\u001b[0m     ctx.message = { text: 'Test' }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/handleTextMessage.test.ts\u001b[0m:\u001b[93m81\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m81\u001b[0m     ctx.message = { text: 'Hi' }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/handleTextMessage.test.ts\u001b[0m:\u001b[93m90\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m90\u001b[0m     ctx.message = { text: 'Err' }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/handlePaymentPolicyInfo.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/handlers/handlePaymentPolicyInfo.test.ts\u001b[0m:\u001b[93m11\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m11\u001b[0m     ctx.from = { language_code: 'ru', id: 1 } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/paymentActions.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/handlers/paymentActions.test.ts\u001b[0m:\u001b[93m14\u001b[0m:\u001b[93m23\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'handlePaymentPolicyInfo' does not exist on type 'typeof import(\"/Users/playom/999-multibots-telegraf/src/handlers/paymentHandlers/index\")'.\n\n    \u001b[7m14\u001b[0m       paymentHandlers.handlePaymentPolicyInfo\n    \u001b[7m  \u001b[0m \u001b[91m                      ~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/paymentActions.test.ts\u001b[0m:\u001b[93m20\u001b[0m:\u001b[93m23\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'handleTopUp' does not exist on type 'typeof import(\"/Users/playom/999-multibots-telegraf/src/handlers/paymentHandlers/index\")'.\n\n    \u001b[7m20\u001b[0m       paymentHandlers.handleTopUp\n    \u001b[7m  \u001b[0m \u001b[91m                      ~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/paymentActions.test.ts\u001b[0m:\u001b[93m26\u001b[0m:\u001b[93m23\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'handlePreCheckoutQuery' does not exist on type 'typeof import(\"/Users/playom/999-multibots-telegraf/src/handlers/paymentHandlers/index\")'.\n\n    \u001b[7m26\u001b[0m       paymentHandlers.handlePreCheckoutQuery\n    \u001b[7m  \u001b[0m \u001b[91m                      ~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/handleMenu.branches.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/handlers/handleMenu.branches.test.ts\u001b[0m:\u001b[93m50\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m50\u001b[0m       ctx.message = { text: c.text }\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/handleMenu.branches.test.ts\u001b[0m:\u001b[93m59\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m59\u001b[0m     ctx.message = { text: 'unknown' }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/handleSizeSelection.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/handlers/handleSizeSelection.test.ts\u001b[0m:\u001b[93m21\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2739: \u001b[0mType '{}' is missing the following properties from type 'MySession': cursor, images, targetUserId, userModel\n\n    \u001b[7m21\u001b[0m     ctx.session = {}\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/handleSizeSelection.test.ts\u001b[0m:\u001b[93m25\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m25\u001b[0m     ctx.from = { id: 'uid', language_code: 'ru' } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/handleSizeSelection.test.ts\u001b[0m:\u001b[93m30\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2820: \u001b[0mType '\"neuro_photo\"' is not assignable to type 'ModeEnum'. Did you mean 'ModeEnum.NeuroPhotoV2'?\n\n    \u001b[7m30\u001b[0m     ctx.session.mode = 'neuro_photo'\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/handleSizeSelection.test.ts\u001b[0m:\u001b[93m40\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2322: \u001b[0mType '\"text_to_image\"' is not assignable to type 'ModeEnum'.\n\n    \u001b[7m40\u001b[0m     ctx.session.mode = 'text_to_image'\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/handleSizeSelection.test.ts\u001b[0m:\u001b[93m50\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2322: \u001b[0mType '\"unknown\"' is not assignable to type 'ModeEnum'.\n\n    \u001b[7m50\u001b[0m     ctx.session.mode = 'unknown'\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/handleSizeSelection.test.ts\u001b[0m:\u001b[93m72\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2322: \u001b[0mType '\"other\"' is not assignable to type 'ModeEnum'.\n\n    \u001b[7m72\u001b[0m     ctx.session.mode = 'other'\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/menu/sendGenericErrorMessage.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/menu/sendGenericErrorMessage.test.ts\u001b[0m:\u001b[93m13\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m13\u001b[0m     ctx.from = { id: 9, username: 'user9', language_code: 'ru' } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/menu/sendGenericErrorMessage.test.ts\u001b[0m:\u001b[93m14\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'chat' because it is a read-only property.\n\n    \u001b[7m14\u001b[0m     ctx.chat = { id: 99 } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/menu/sendGenerationCancelledMessage.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/menu/sendGenerationCancelledMessage.test.ts\u001b[0m:\u001b[93m16\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m16\u001b[0m     ctx.from = { id: 7, language_code: 'ru' } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/menu/sendGenerationCancelledMessage.test.ts\u001b[0m:\u001b[93m22\u001b[0m:\u001b[93m54\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'boolean' is not assignable to parameter of type 'string'.\n\n    \u001b[7m22\u001b[0m     await sendGenerationCancelledMessage(ctx as any, true)\n    \u001b[7m  \u001b[0m \u001b[91m                                                     ~~~~\u001b[0m\n    \u001b[96m__tests__/menu/sendGenerationCancelledMessage.test.ts\u001b[0m:\u001b[93m32\u001b[0m:\u001b[93m54\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'boolean' is not assignable to parameter of type 'string'.\n\n    \u001b[7m32\u001b[0m     await sendGenerationCancelledMessage(ctx as any, false)\n    \u001b[7m  \u001b[0m \u001b[91m                                                     ~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/menu/createHelpCancelKeyboard.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/menu/createHelpCancelKeyboard.test.ts\u001b[0m:\u001b[93m1\u001b[0m:\u001b[93m10\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2305: \u001b[0mModule '\"@/menu/createHelpCancelKeyboard\"' has no exported member 'createHelpCancelKeyboard'.\n\n    \u001b[7m1\u001b[0m import { createHelpCancelKeyboard } from '@/menu/createHelpCancelKeyboard'\n    \u001b[7m \u001b[0m \u001b[91m         ~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/menu/imageModelMenu.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/menu/imageModelMenu.test.ts\u001b[0m:\u001b[93m24\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m24\u001b[0m     ctx.from = { language_code: 'ru' } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/menu/imageModelMenu.test.ts\u001b[0m:\u001b[93m55\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m55\u001b[0m     ctx.from = { language_code: 'en' } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/menu/mainMenu.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/menu/mainMenu.test.ts\u001b[0m:\u001b[93m14\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m14\u001b[0m     ctx.from = { id: 1, username: 'u', language_code: 'ru' } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/menu/mainMenu.test.ts\u001b[0m:\u001b[93m25\u001b[0m:\u001b[93m7\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2322: \u001b[0mType '\"stars\"' is not assignable to type 'SubscriptionType'.\n\n    \u001b[7m25\u001b[0m       subscription: 'stars',\n    \u001b[7m  \u001b[0m \u001b[91m      ~~~~~~~~~~~~\u001b[0m\n\n      \u001b[96msrc/menu/mainMenu.ts\u001b[0m:\u001b[93m119\u001b[0m:\u001b[93m3\u001b[0m\n        \u001b[7m119\u001b[0m   subscription: SubscriptionType\n        \u001b[7m   \u001b[0m \u001b[96m  ~~~~~~~~~~~~\u001b[0m\n        The expected type comes from property 'subscription' which is declared here on type '{ isRu: boolean; inviteCount: number; subscription: SubscriptionType; level: number; ctx: MyContext; }'\n    \u001b[96m__tests__/menu/mainMenu.test.ts\u001b[0m:\u001b[93m40\u001b[0m:\u001b[93m7\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2820: \u001b[0mType '\"neurotester\"' is not assignable to type 'SubscriptionType'. Did you mean 'SubscriptionType.NEUROTESTER'?\n\n    \u001b[7m40\u001b[0m       subscription: 'neurotester',\n    \u001b[7m  \u001b[0m \u001b[91m      ~~~~~~~~~~~~\u001b[0m\n\n      \u001b[96msrc/menu/mainMenu.ts\u001b[0m:\u001b[93m119\u001b[0m:\u001b[93m3\u001b[0m\n        \u001b[7m119\u001b[0m   subscription: SubscriptionType\n        \u001b[7m   \u001b[0m \u001b[96m  ~~~~~~~~~~~~\u001b[0m\n        The expected type comes from property 'subscription' which is declared here on type '{ isRu: boolean; inviteCount: number; subscription: SubscriptionType; level: number; ctx: MyContext; }'\n    \u001b[96m__tests__/menu/mainMenu.test.ts\u001b[0m:\u001b[93m56\u001b[0m:\u001b[93m7\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2820: \u001b[0mType '\"neurotester\"' is not assignable to type 'SubscriptionType'. Did you mean 'SubscriptionType.NEUROTESTER'?\n\n    \u001b[7m56\u001b[0m       subscription: 'neurotester',\n    \u001b[7m  \u001b[0m \u001b[91m      ~~~~~~~~~~~~\u001b[0m\n\n      \u001b[96msrc/menu/mainMenu.ts\u001b[0m:\u001b[93m119\u001b[0m:\u001b[93m3\u001b[0m\n        \u001b[7m119\u001b[0m   subscription: SubscriptionType\n        \u001b[7m   \u001b[0m \u001b[96m  ~~~~~~~~~~~~\u001b[0m\n        The expected type comes from property 'subscription' which is declared here on type '{ isRu: boolean; inviteCount: number; subscription: SubscriptionType; level: number; ctx: MyContext; }'\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/menu/menu.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/menu/menu.test.ts\u001b[0m:\u001b[93m131\u001b[0m:\u001b[93m36\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'mock' does not exist on type '(text: string | FmtString<string>, extra?: Omit<{ chat_id: string | number; message_thread_id?: number; text: string; parse_mode?: ParseMode; entities?: MessageEntity[]; ... 4 more ...; reply_markup?: ReplyKeyboardMarkup | ... 2 more ... | ForceReply; }, \"chat_id\" | \"text\">) => Promise<...>'.\n\n    \u001b[7m131\u001b[0m     const [msg, extra] = ctx.reply.mock.calls[0]\n    \u001b[7m   \u001b[0m \u001b[91m                                   ~~~~\u001b[0m\n    \u001b[96m__tests__/menu/menu.test.ts\u001b[0m:\u001b[93m141\u001b[0m:\u001b[93m36\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'mock' does not exist on type '(text: string | FmtString<string>, extra?: Omit<{ chat_id: string | number; message_thread_id?: number; text: string; parse_mode?: ParseMode; entities?: MessageEntity[]; ... 4 more ...; reply_markup?: ReplyKeyboardMarkup | ... 2 more ... | ForceReply; }, \"chat_id\" | \"text\">) => Promise<...>'.\n\n    \u001b[7m141\u001b[0m     const [msg, extra] = ctx.reply.mock.calls[0]\n    \u001b[7m   \u001b[0m \u001b[91m                                   ~~~~\u001b[0m\n    \u001b[96m__tests__/menu/menu.test.ts\u001b[0m:\u001b[93m217\u001b[0m:\u001b[93m1\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1128: \u001b[0mDeclaration or statement expected.\n\n    \u001b[7m217\u001b[0m })\n    \u001b[7m   \u001b[0m \u001b[91m~\u001b[0m\n    \u001b[96m__tests__/menu/menu.test.ts\u001b[0m:\u001b[93m217\u001b[0m:\u001b[93m2\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1128: \u001b[0mDeclaration or statement expected.\n\n    \u001b[7m217\u001b[0m })\n    \u001b[7m   \u001b[0m \u001b[91m ~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/helpers/processBalanceOperation.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/price/helpers/processBalanceOperation.test.ts\u001b[0m:\u001b[93m4\u001b[0m:\u001b[93m36\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2743: \u001b[0mNo overload expects 1 type arguments, but overloads do exist that expect either 0 or 2 type arguments.\n\n    \u001b[7m4\u001b[0m const mockGetUserBalance = jest.fn<() => Promise<number>>() // –° —É–∫–∞–∑–∞–Ω–∏–µ–º —Ç–∏–ø–∞\n    \u001b[7m \u001b[0m \u001b[91m                                   ~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/price/helpers/processBalanceOperation.test.ts\u001b[0m:\u001b[93m5\u001b[0m:\u001b[93m39\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2743: \u001b[0mNo overload expects 1 type arguments, but overloads do exist that expect either 0 or 2 type arguments.\n\n    \u001b[7m5\u001b[0m const mockUpdateUserBalance = jest.fn<() => Promise<void>>() // –° —É–∫–∞–∑–∞–Ω–∏–µ–º —Ç–∏–ø–∞\n    \u001b[7m \u001b[0m \u001b[91m                                      ~~~~~~~~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/refundUser.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/price/refundUser.test.ts\u001b[0m:\u001b[93m44\u001b[0m:\u001b[93m30\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Type 'String' has no call signatures.\n\n    \u001b[7m44\u001b[0m     ctx.from.language_code = 'en'\n    \u001b[7m  \u001b[0m \u001b[91m                             ~~~~\u001b[0m\n\n      \u001b[96m__tests__/price/refundUser.test.ts\u001b[0m:\u001b[93m44\u001b[0m:\u001b[93m30\u001b[0m\n        \u001b[7m44\u001b[0m     ctx.from.language_code = 'en'\n        \u001b[7m  \u001b[0m \u001b[96m                             ~~~~\u001b[0m\n        Are you missing a semicolon?\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/priceCalculator.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/price/priceCalculator.test.ts\u001b[0m:\u001b[93m41\u001b[0m:\u001b[93m67\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2304: \u001b[0mCannot find name 'toFixed'.\n\n    \u001b[7m41\u001b[0m       `${sample.steps} steps - ${sample.stars.toFixed(0)}‚≠ê / $${4.toFixed(2)}`\n    \u001b[7m  \u001b[0m \u001b[91m                                                                  ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/price/priceCalculator.test.ts\u001b[0m:\u001b[93m41\u001b[0m:\u001b[93m67\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2554: \u001b[0mExpected 1 arguments, but got 2.\n\n    \u001b[7m41\u001b[0m       `${sample.steps} steps - ${sample.stars.toFixed(0)}‚≠ê / $${4.toFixed(2)}`\n    \u001b[7m  \u001b[0m \u001b[91m                                                                  ~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/price/priceCalculator.test.ts\u001b[0m:\u001b[93m54\u001b[0m:\u001b[93m21\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2581: \u001b[0mCannot find name '$'. Do you need to install type definitions for jQuery? Try `npm i --save-dev @types/jquery`.\n\n    \u001b[7m54\u001b[0m       const line = `${detail.steps} —à–∞–≥–æ–≤ - ${detail.stars.toFixed(0)}‚≠ê / ${\n    \u001b[7m  \u001b[0m \u001b[91m                    ~\u001b[0m\n    \u001b[96m__tests__/price/priceCalculator.test.ts\u001b[0m:\u001b[93m54\u001b[0m:\u001b[93m21\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2554: \u001b[0mExpected 1-3 arguments, but got 9.\n\n    \u001b[7m54\u001b[0m       const line = `${detail.steps} —à–∞–≥–æ–≤ - ${detail.stars.toFixed(0)}‚≠ê / ${\n    \u001b[7m  \u001b[0m \u001b[91m                    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[7m55\u001b[0m         detail.rubles.toFixed(0)\n    \u001b[7m  \u001b[0m \u001b[91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/price/priceCalculator.test.ts\u001b[0m:\u001b[93m54\u001b[0m:\u001b[93m23\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS18004: \u001b[0mNo value exists in scope for the shorthand property 'detail'. Either declare one or provide an initializer.\n\n    \u001b[7m54\u001b[0m       const line = `${detail.steps} —à–∞–≥–æ–≤ - ${detail.stars.toFixed(0)}‚≠ê / ${\n    \u001b[7m  \u001b[0m \u001b[91m                      ~~~~~~\u001b[0m\n    \u001b[96m__tests__/price/priceCalculator.test.ts\u001b[0m:\u001b[93m54\u001b[0m:\u001b[93m37\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2304: \u001b[0mCannot find name '—à–∞–≥–æ–≤'.\n\n    \u001b[7m54\u001b[0m       const line = `${detail.steps} —à–∞–≥–æ–≤ - ${detail.stars.toFixed(0)}‚≠ê / ${\n    \u001b[7m  \u001b[0m \u001b[91m                                    ~~~~~\u001b[0m\n    \u001b[96m__tests__/price/priceCalculator.test.ts\u001b[0m:\u001b[93m54\u001b[0m:\u001b[93m45\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2581: \u001b[0mCannot find name '$'. Do you need to install type definitions for jQuery? Try `npm i --save-dev @types/jquery`.\n\n    \u001b[7m54\u001b[0m       const line = `${detail.steps} —à–∞–≥–æ–≤ - ${detail.stars.toFixed(0)}‚≠ê / ${\n    \u001b[7m  \u001b[0m \u001b[91m                                            ~\u001b[0m\n    \u001b[96m__tests__/price/priceCalculator.test.ts\u001b[0m:\u001b[93m54\u001b[0m:\u001b[93m47\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS18004: \u001b[0mNo value exists in scope for the shorthand property 'detail'. Either declare one or provide an initializer.\n\n    \u001b[7m54\u001b[0m       const line = `${detail.steps} —à–∞–≥–æ–≤ - ${detail.stars.toFixed(0)}‚≠ê / ${\n    \u001b[7m  \u001b[0m \u001b[91m                                              ~~~~~~\u001b[0m\n    \u001b[96m__tests__/price/priceCalculator.test.ts\u001b[0m:\u001b[93m55\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2304: \u001b[0mCannot find name 'detail'.\n\n    \u001b[7m55\u001b[0m         detail.rubles.toFixed(0)\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~\u001b[0m\n    \u001b[96m__tests__/price/priceCalculator.test.ts\u001b[0m:\u001b[93m56\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2554: \u001b[0mExpected 2 arguments, but got 10.\n\n    \u001b[7m 56\u001b[0m       }‚ÇΩ`\n    \u001b[7m   \u001b[0m \u001b[91m        ~\u001b[0m\n    \u001b[7m 57\u001b[0m       expect(msg).toContain(line)\n    \u001b[7m   \u001b[0m \u001b[91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[7m...\u001b[0m \n    \u001b[7m 83\u001b[0m   })\n    \u001b[7m   \u001b[0m \u001b[91m~~~~\u001b[0m\n    \u001b[7m 84\u001b[0m })\n    \u001b[7m   \u001b[0m \u001b[91m~~\u001b[0m\n    \u001b[96m__tests__/price/priceCalculator.test.ts\u001b[0m:\u001b[93m66\u001b[0m:\u001b[93m21\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2581: \u001b[0mCannot find name '$'. Do you need to install type definitions for jQuery? Try `npm i --save-dev @types/jquery`.\n\n    \u001b[7m66\u001b[0m       const line = `${detail.steps} steps - ${detail.stars.toFixed(0)}‚≠ê / $${\n    \u001b[7m  \u001b[0m \u001b[91m                    ~\u001b[0m\n    \u001b[96m__tests__/price/priceCalculator.test.ts\u001b[0m:\u001b[93m66\u001b[0m:\u001b[93m23\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS18004: \u001b[0mNo value exists in scope for the shorthand property 'detail'. Either declare one or provide an initializer.\n\n    \u001b[7m66\u001b[0m       const line = `${detail.steps} steps - ${detail.stars.toFixed(0)}‚≠ê / $${\n    \u001b[7m  \u001b[0m \u001b[91m                      ~~~~~~\u001b[0m\n    \u001b[96m__tests__/price/priceCalculator.test.ts\u001b[0m:\u001b[93m66\u001b[0m:\u001b[93m37\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2304: \u001b[0mCannot find name 'steps'.\n\n    \u001b[7m66\u001b[0m       const line = `${detail.steps} steps - ${detail.stars.toFixed(0)}‚≠ê / $${\n    \u001b[7m  \u001b[0m \u001b[91m                                    ~~~~~\u001b[0m\n    \u001b[96m__tests__/price/priceCalculator.test.ts\u001b[0m:\u001b[93m66\u001b[0m:\u001b[93m45\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2581: \u001b[0mCannot find name '$'. Do you need to install type definitions for jQuery? Try `npm i --save-dev @types/jquery`.\n\n    \u001b[7m66\u001b[0m       const line = `${detail.steps} steps - ${detail.stars.toFixed(0)}‚≠ê / $${\n    \u001b[7m  \u001b[0m \u001b[91m                                            ~\u001b[0m\n    \u001b[96m__tests__/price/priceCalculator.test.ts\u001b[0m:\u001b[93m66\u001b[0m:\u001b[93m47\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS18004: \u001b[0mNo value exists in scope for the shorthand property 'detail'. Either declare one or provide an initializer.\n\n    \u001b[7m66\u001b[0m       const line = `${detail.steps} steps - ${detail.stars.toFixed(0)}‚≠ê / $${\n    \u001b[7m  \u001b[0m \u001b[91m                                              ~~~~~~\u001b[0m\n    \u001b[96m__tests__/price/priceCalculator.test.ts\u001b[0m:\u001b[93m67\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2304: \u001b[0mCannot find name 'detail'.\n\n    \u001b[7m67\u001b[0m         detail.dollars.toFixed(2)\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~\u001b[0m\n    \u001b[96m__tests__/price/priceCalculator.test.ts\u001b[0m:\u001b[93m41\u001b[0m:\u001b[93m67\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1351: \u001b[0mAn identifier or keyword cannot immediately follow a numeric literal.\n\n    \u001b[7m41\u001b[0m       `${sample.steps} steps - ${sample.stars.toFixed(0)}‚≠ê / $${4.toFixed(2)}`\n    \u001b[7m  \u001b[0m \u001b[91m                                                                  ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/price/priceCalculator.test.ts\u001b[0m:\u001b[93m41\u001b[0m:\u001b[93m77\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1005: \u001b[0m',' expected.\n\n    \u001b[7m41\u001b[0m       `${sample.steps} steps - ${sample.stars.toFixed(0)}‚≠ê / $${4.toFixed(2)}`\n    \u001b[7m  \u001b[0m \u001b[91m                                                                            ~\u001b[0m\n    \u001b[96m__tests__/price/priceCalculator.test.ts\u001b[0m:\u001b[93m41\u001b[0m:\u001b[93m78\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1005: \u001b[0m',' expected.\n\n    \u001b[7m 41\u001b[0m       `${sample.steps} steps - ${sample.stars.toFixed(0)}‚≠ê / $${4.toFixed(2)}`\n    \u001b[7m   \u001b[0m \u001b[91m                                                                             ~\u001b[0m\n    \u001b[7m 42\u001b[0m     )\n    \u001b[7m   \u001b[0m \u001b[91m~~~~~\u001b[0m\n    \u001b[7m...\u001b[0m \n    \u001b[7m 53\u001b[0m     subset.forEach(detail => {\n    \u001b[7m   \u001b[0m \u001b[91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[7m 54\u001b[0m       const line = `${detail.steps} —à–∞–≥–æ–≤ - ${detail.stars.toFixed(0)}‚≠ê / ${\n    \u001b[7m   \u001b[0m \u001b[91m~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/price/priceCalculator.test.ts\u001b[0m:\u001b[93m54\u001b[0m:\u001b[93m21\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1005: \u001b[0m',' expected.\n\n    \u001b[7m54\u001b[0m       const line = `${detail.steps} —à–∞–≥–æ–≤ - ${detail.stars.toFixed(0)}‚≠ê / ${\n    \u001b[7m  \u001b[0m \u001b[91m                    ~\u001b[0m\n    \u001b[96m__tests__/price/priceCalculator.test.ts\u001b[0m:\u001b[93m54\u001b[0m:\u001b[93m22\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1005: \u001b[0m',' expected.\n\n    \u001b[7m54\u001b[0m       const line = `${detail.steps} —à–∞–≥–æ–≤ - ${detail.stars.toFixed(0)}‚≠ê / ${\n    \u001b[7m  \u001b[0m \u001b[91m                     ~\u001b[0m\n    \u001b[96m__tests__/price/priceCalculator.test.ts\u001b[0m:\u001b[93m54\u001b[0m:\u001b[93m29\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1005: \u001b[0m',' expected.\n\n    \u001b[7m54\u001b[0m       const line = `${detail.steps} —à–∞–≥–æ–≤ - ${detail.stars.toFixed(0)}‚≠ê / ${\n    \u001b[7m  \u001b[0m \u001b[91m                            ~\u001b[0m\n    \u001b[96m__tests__/price/priceCalculator.test.ts\u001b[0m:\u001b[93m54\u001b[0m:\u001b[93m37\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1005: \u001b[0m',' expected.\n\n    \u001b[7m54\u001b[0m       const line = `${detail.steps} —à–∞–≥–æ–≤ - ${detail.stars.toFixed(0)}‚≠ê / ${\n    \u001b[7m  \u001b[0m \u001b[91m                                    ~~~~~\u001b[0m\n    \u001b[96m__tests__/price/priceCalculator.test.ts\u001b[0m:\u001b[93m54\u001b[0m:\u001b[93m46\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1005: \u001b[0m',' expected.\n\n    \u001b[7m54\u001b[0m       const line = `${detail.steps} —à–∞–≥–æ–≤ - ${detail.stars.toFixed(0)}‚≠ê / ${\n    \u001b[7m  \u001b[0m \u001b[91m                                             ~\u001b[0m\n    \u001b[96m__tests__/price/priceCalculator.test.ts\u001b[0m:\u001b[93m54\u001b[0m:\u001b[93m53\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1005: \u001b[0m',' expected.\n\n    \u001b[7m54\u001b[0m       const line = `${detail.steps} —à–∞–≥–æ–≤ - ${detail.stars.toFixed(0)}‚≠ê / ${\n    \u001b[7m  \u001b[0m \u001b[91m                                                    ~\u001b[0m\n    \u001b[96m__tests__/price/priceCalculator.test.ts\u001b[0m:\u001b[93m54\u001b[0m:\u001b[93m71\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1127: \u001b[0mInvalid character.\n\n    \u001b[7m54\u001b[0m       const line = `${detail.steps} —à–∞–≥–æ–≤ - ${detail.stars.toFixed(0)}‚≠ê / ${\n    \u001b[7m  \u001b[0m \u001b[91m                                                                      ~\u001b[0m\n    \u001b[96m__tests__/price/priceCalculator.test.ts\u001b[0m:\u001b[93m54\u001b[0m:\u001b[93m73\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1161: \u001b[0mUnterminated regular expression literal.\n\n    \u001b[7m54\u001b[0m       const line = `${detail.steps} —à–∞–≥–æ–≤ - ${detail.stars.toFixed(0)}‚≠ê / ${\n    \u001b[7m  \u001b[0m \u001b[91m                                                                        ~~~~\u001b[0m\n    \u001b[96m__tests__/price/priceCalculator.test.ts\u001b[0m:\u001b[93m55\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1005: \u001b[0m',' expected.\n\n    \u001b[7m55\u001b[0m         detail.rubles.toFixed(0)\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~\u001b[0m\n    \u001b[96m__tests__/price/priceCalculator.test.ts\u001b[0m:\u001b[93m56\u001b[0m:\u001b[93m7\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1005: \u001b[0m',' expected.\n\n    \u001b[7m56\u001b[0m       }‚ÇΩ`\n    \u001b[7m  \u001b[0m \u001b[91m      ~\u001b[0m\n    \u001b[96m__tests__/price/priceCalculator.test.ts\u001b[0m:\u001b[93m56\u001b[0m:\u001b[93m8\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1127: \u001b[0mInvalid character.\n\n    \u001b[7m56\u001b[0m       }‚ÇΩ`\n    \u001b[7m  \u001b[0m \u001b[91m       ~\u001b[0m\n    \u001b[96m__tests__/price/priceCalculator.test.ts\u001b[0m:\u001b[93m66\u001b[0m:\u001b[93m21\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1005: \u001b[0m',' expected.\n\n    \u001b[7m66\u001b[0m       const line = `${detail.steps} steps - ${detail.stars.toFixed(0)}‚≠ê / $${\n    \u001b[7m  \u001b[0m \u001b[91m                    ~\u001b[0m\n    \u001b[96m__tests__/price/priceCalculator.test.ts\u001b[0m:\u001b[93m66\u001b[0m:\u001b[93m22\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1005: \u001b[0m',' expected.\n\n    \u001b[7m66\u001b[0m       const line = `${detail.steps} steps - ${detail.stars.toFixed(0)}‚≠ê / $${\n    \u001b[7m  \u001b[0m \u001b[91m                     ~\u001b[0m\n    \u001b[96m__tests__/price/priceCalculator.test.ts\u001b[0m:\u001b[93m66\u001b[0m:\u001b[93m29\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1005: \u001b[0m',' expected.\n\n    \u001b[7m66\u001b[0m       const line = `${detail.steps} steps - ${detail.stars.toFixed(0)}‚≠ê / $${\n    \u001b[7m  \u001b[0m \u001b[91m                            ~\u001b[0m\n    \u001b[96m__tests__/price/priceCalculator.test.ts\u001b[0m:\u001b[93m66\u001b[0m:\u001b[93m37\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1005: \u001b[0m',' expected.\n\n    \u001b[7m66\u001b[0m       const line = `${detail.steps} steps - ${detail.stars.toFixed(0)}‚≠ê / $${\n    \u001b[7m  \u001b[0m \u001b[91m                                    ~~~~~\u001b[0m\n    \u001b[96m__tests__/price/priceCalculator.test.ts\u001b[0m:\u001b[93m66\u001b[0m:\u001b[93m46\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1005: \u001b[0m',' expected.\n\n    \u001b[7m66\u001b[0m       const line = `${detail.steps} steps - ${detail.stars.toFixed(0)}‚≠ê / $${\n    \u001b[7m  \u001b[0m \u001b[91m                                             ~\u001b[0m\n    \u001b[96m__tests__/price/priceCalculator.test.ts\u001b[0m:\u001b[93m66\u001b[0m:\u001b[93m53\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1005: \u001b[0m',' expected.\n\n    \u001b[7m66\u001b[0m       const line = `${detail.steps} steps - ${detail.stars.toFixed(0)}‚≠ê / $${\n    \u001b[7m  \u001b[0m \u001b[91m                                                    ~\u001b[0m\n    \u001b[96m__tests__/price/priceCalculator.test.ts\u001b[0m:\u001b[93m66\u001b[0m:\u001b[93m71\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1127: \u001b[0mInvalid character.\n\n    \u001b[7m66\u001b[0m       const line = `${detail.steps} steps - ${detail.stars.toFixed(0)}‚≠ê / $${\n    \u001b[7m  \u001b[0m \u001b[91m                                                                      ~\u001b[0m\n    \u001b[96m__tests__/price/priceCalculator.test.ts\u001b[0m:\u001b[93m66\u001b[0m:\u001b[93m73\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1161: \u001b[0mUnterminated regular expression literal.\n\n    \u001b[7m66\u001b[0m       const line = `${detail.steps} steps - ${detail.stars.toFixed(0)}‚≠ê / $${\n    \u001b[7m  \u001b[0m \u001b[91m                                                                        ~~~~~\u001b[0m\n    \u001b[96m__tests__/price/priceCalculator.test.ts\u001b[0m:\u001b[93m67\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1005: \u001b[0m',' expected.\n\n    \u001b[7m67\u001b[0m         detail.dollars.toFixed(2)\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~\u001b[0m\n    \u001b[96m__tests__/price/priceCalculator.test.ts\u001b[0m:\u001b[93m68\u001b[0m:\u001b[93m7\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1005: \u001b[0m',' expected.\n\n    \u001b[7m68\u001b[0m       }`\n    \u001b[7m  \u001b[0m \u001b[91m      ~\u001b[0m\n    \u001b[96m__tests__/price/priceCalculator.test.ts\u001b[0m:\u001b[93m84\u001b[0m:\u001b[93m3\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1160: \u001b[0mUnterminated template literal.\n\n    \u001b[7m84\u001b[0m })\n    \u001b[7m  \u001b[0m \u001b[91m  \u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/helpers.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/price/helpers.test.ts\u001b[0m:\u001b[93m92\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2739: \u001b[0mType '{}' is missing the following properties from type 'MySession': cursor, images, targetUserId, userModel\n\n    \u001b[7m92\u001b[0m     ctx.session = {}\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/price/helpers.test.ts\u001b[0m:\u001b[93m124\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2739: \u001b[0mType '{}' is missing the following properties from type 'MySession': cursor, images, targetUserId, userModel\n\n    \u001b[7m124\u001b[0m     ctx.session = {}\n    \u001b[7m   \u001b[0m \u001b[91m    ~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/processBalanceVideoOperation.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/price/processBalanceVideoOperation.test.ts\u001b[0m:\u001b[93m15\u001b[0m:\u001b[93m23\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2554: \u001b[0mExpected 3 arguments, but got 1.\n\n    \u001b[7m15\u001b[0m     const res = await processBalanceVideoOperation({\n    \u001b[7m  \u001b[0m \u001b[91m                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n\n      \u001b[96msrc/price/helpers/processBalanceVideoOperation.ts\u001b[0m:\u001b[93m19\u001b[0m:\u001b[93m3\u001b[0m\n        \u001b[7m19\u001b[0m   videoModelName: VideoModel,\n        \u001b[7m  \u001b[0m \u001b[96m  ~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n        An argument for 'videoModelName' was not provided.\n    \u001b[96m__tests__/price/processBalanceVideoOperation.test.ts\u001b[0m:\u001b[93m30\u001b[0m:\u001b[93m23\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2554: \u001b[0mExpected 3 arguments, but got 1.\n\n    \u001b[7m30\u001b[0m     const res = await processBalanceVideoOperation({\n    \u001b[7m  \u001b[0m \u001b[91m                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n\n      \u001b[96msrc/price/helpers/processBalanceVideoOperation.ts\u001b[0m:\u001b[93m19\u001b[0m:\u001b[93m3\u001b[0m\n        \u001b[7m19\u001b[0m   videoModelName: VideoModel,\n        \u001b[7m  \u001b[0m \u001b[96m  ~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n        An argument for 'videoModelName' was not provided.\n    \u001b[96m__tests__/price/processBalanceVideoOperation.test.ts\u001b[0m:\u001b[93m48\u001b[0m:\u001b[93m23\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2554: \u001b[0mExpected 3 arguments, but got 1.\n\n    \u001b[7m48\u001b[0m     const res = await processBalanceVideoOperation({\n    \u001b[7m  \u001b[0m \u001b[91m                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n\n      \u001b[96msrc/price/helpers/processBalanceVideoOperation.ts\u001b[0m:\u001b[93m19\u001b[0m:\u001b[93m3\u001b[0m\n        \u001b[7m19\u001b[0m   videoModelName: VideoModel,\n        \u001b[7m  \u001b[0m \u001b[96m  ~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n        An argument for 'videoModelName' was not provided.\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/chatWithAvatarWizard.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/scenes/chatWithAvatarWizard.test.ts\u001b[0m:\u001b[93m44\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m44\u001b[0m     await step0(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/chatWithAvatarWizard.test.ts\u001b[0m:\u001b[93m56\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m56\u001b[0m     ctx.message = undefined\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/chatWithAvatarWizard.test.ts\u001b[0m:\u001b[93m59\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m59\u001b[0m     await step1(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/chatWithAvatarWizard.test.ts\u001b[0m:\u001b[93m64\u001b[0m:\u001b[93m39\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2353: \u001b[0mObject literal may only specify known properties, and 'message' does not exist in type 'Partial<MySession>'.\n\n    \u001b[7m64\u001b[0m     const ctx = makeMockContext({}, { message: { text: 'hi' } })\n    \u001b[7m  \u001b[0m \u001b[91m                                      ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/chatWithAvatarWizard.test.ts\u001b[0m:\u001b[93m68\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m68\u001b[0m     await step1(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/chatWithAvatarWizard.test.ts\u001b[0m:\u001b[93m74\u001b[0m:\u001b[93m39\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2353: \u001b[0mObject literal may only specify known properties, and 'message' does not exist in type 'Partial<MySession>'.\n\n    \u001b[7m74\u001b[0m     const ctx = makeMockContext({}, { message: { text: 'hello' } })\n    \u001b[7m  \u001b[0m \u001b[91m                                      ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/chatWithAvatarWizard.test.ts\u001b[0m:\u001b[93m82\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m82\u001b[0m     await step1(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/chatWithAvatarWizard.test.ts\u001b[0m:\u001b[93m89\u001b[0m:\u001b[93m39\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2353: \u001b[0mObject literal may only specify known properties, and 'message' does not exist in type 'Partial<MySession>'.\n\n    \u001b[7m89\u001b[0m     const ctx = makeMockContext({}, { message: { text: 'hello' } })\n    \u001b[7m  \u001b[0m \u001b[91m                                      ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/chatWithAvatarWizard.test.ts\u001b[0m:\u001b[93m97\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m97\u001b[0m     await step1(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/chatWithAvatarWizard.test.ts\u001b[0m:\u001b[93m107\u001b[0m:\u001b[93m39\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2353: \u001b[0mObject literal may only specify known properties, and 'message' does not exist in type 'Partial<MySession>'.\n\n    \u001b[7m107\u001b[0m     const ctx = makeMockContext({}, { message: { text: 'hello' } })\n    \u001b[7m   \u001b[0m \u001b[91m                                      ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/chatWithAvatarWizard.test.ts\u001b[0m:\u001b[93m113\u001b[0m:\u001b[93m18\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m113\u001b[0m     await expect(step1(ctx)).rejects.toThrow(\n    \u001b[7m   \u001b[0m \u001b[91m                 ~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/uploadVideoScene.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/scenes/uploadVideoScene.test.ts\u001b[0m:\u001b[93m6\u001b[0m:\u001b[93m57\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2307: \u001b[0mCannot find module '../utils/mockContext' or its corresponding type declarations.\n\n    \u001b[7m6\u001b[0m import { makeMockContext, MockContextWithSession } from '../utils/mockContext'\n    \u001b[7m \u001b[0m \u001b[91m                                                        ~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/trainFluxModelWizard.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/scenes/trainFluxModelWizard.test.ts\u001b[0m:\u001b[93m6\u001b[0m:\u001b[93m57\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2307: \u001b[0mCannot find module '../utils/mockContext' or its corresponding type declarations.\n\n    \u001b[7m6\u001b[0m import { makeMockContext, MockContextWithSession } from '../utils/mockContext'\n    \u001b[7m \u001b[0m \u001b[91m                                                        ~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/lipSyncWizard.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/scenes/lipSyncWizard.test.ts\u001b[0m:\u001b[93m10\u001b[0m:\u001b[93m10\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2305: \u001b[0mModule '\"@/menu/createHelpCancelKeyboard\"' has no exported member 'createHelpCancelKeyboard'.\n\n    \u001b[7m10\u001b[0m import { createHelpCancelKeyboard } from '@/menu/createHelpCancelKeyboard'\n    \u001b[7m  \u001b[0m \u001b[91m         ~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/balanceScene.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/scenes/balanceScene.test.ts\u001b[0m:\u001b[93m26\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m26\u001b[0m     await step(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/balanceScene.test.ts\u001b[0m:\u001b[93m48\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m48\u001b[0m     await step(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/balanceScene.test.ts\u001b[0m:\u001b[93m67\u001b[0m:\u001b[93m18\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m67\u001b[0m     await expect(step(ctx)).rejects.toThrow('fetch failed')\n    \u001b[7m  \u001b[0m \u001b[91m                 ~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/menuScene.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/scenes/menuScene.test.ts\u001b[0m:\u001b[93m36\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m36\u001b[0m     await step0(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/neuroCoderScene.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/scenes/neuroCoderScene.test.ts\u001b[0m:\u001b[93m22\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m22\u001b[0m     ctx.from = { id: 10, language_code: 'ru' }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroCoderScene.test.ts\u001b[0m:\u001b[93m23\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'chat' because it is a read-only property.\n\n    \u001b[7m23\u001b[0m     ctx.chat = { id: 20 } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroCoderScene.test.ts\u001b[0m:\u001b[93m24\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'botInfo' because it is a read-only property.\n\n    \u001b[7m24\u001b[0m     ctx.botInfo = { username: 'bot' }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroCoderScene.test.ts\u001b[0m:\u001b[93m31\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m31\u001b[0m     await step0(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroCoderScene.test.ts\u001b[0m:\u001b[93m43\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m43\u001b[0m     await step1(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroCoderScene.test.ts\u001b[0m:\u001b[93m48\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m48\u001b[0m     ctx.from = undefined as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroCoderScene.test.ts\u001b[0m:\u001b[93m49\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m49\u001b[0m     ctx.message = undefined as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroCoderScene.test.ts\u001b[0m:\u001b[93m53\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m53\u001b[0m     await step1(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroCoderScene.test.ts\u001b[0m:\u001b[93m62\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m62\u001b[0m     ctx.message = { text: '3' } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroCoderScene.test.ts\u001b[0m:\u001b[93m66\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m66\u001b[0m     await step1(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/checkBalanceScene.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/scenes/checkBalanceScene.test.ts\u001b[0m:\u001b[93m29\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2739: \u001b[0mType '{ mode: any; }' is missing the following properties from type 'MySession': cursor, images, targetUserId, userModel\n\n    \u001b[7m29\u001b[0m     ctx.session = { mode: ModeEnum.NeuroPhoto }\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/checkBalanceScene.test.ts\u001b[0m:\u001b[93m29\u001b[0m:\u001b[93m27\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2304: \u001b[0mCannot find name 'ModeEnum'.\n\n    \u001b[7m29\u001b[0m     ctx.session = { mode: ModeEnum.NeuroPhoto }\n    \u001b[7m  \u001b[0m \u001b[91m                          ~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/checkBalanceScene.test.ts\u001b[0m:\u001b[93m34\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2304: \u001b[0mCannot find name 'checkBalanceSceneEnterHandler'.\n\n    \u001b[7m34\u001b[0m     await checkBalanceSceneEnterHandler(ctx as any)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/checkBalanceScene.test.ts\u001b[0m:\u001b[93m41\u001b[0m:\u001b[93m50\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2304: \u001b[0mCannot find name 'ModeEnum'.\n\n    \u001b[7m41\u001b[0m     expect(ctx.scene.enter).toHaveBeenCalledWith(ModeEnum.NeuroPhoto)\n    \u001b[7m  \u001b[0m \u001b[91m                                                 ~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/checkBalanceScene.test.ts\u001b[0m:\u001b[93m46\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2304: \u001b[0mCannot find name 'checkBalanceSceneEnterHandler'.\n\n    \u001b[7m46\u001b[0m     await checkBalanceSceneEnterHandler(ctx as any)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/checkBalanceScene.test.ts\u001b[0m:\u001b[93m56\u001b[0m:\u001b[93m17\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Type 'Error' has no call signatures.\n\n    \u001b[7m56\u001b[0m     const err = new Error('DB error')(\n    \u001b[7m  \u001b[0m \u001b[91m                ~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/checkBalanceScene.test.ts\u001b[0m:\u001b[93m58\u001b[0m:\u001b[93m25\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2448: \u001b[0mBlock-scoped variable 'err' used before its declaration.\n\n    \u001b[7m58\u001b[0m     ).mockRejectedValue(err)\n    \u001b[7m  \u001b[0m \u001b[91m                        ~~~\u001b[0m\n\n      \u001b[96m__tests__/scenes/checkBalanceScene.test.ts\u001b[0m:\u001b[93m56\u001b[0m:\u001b[93m11\u001b[0m\n        \u001b[7m56\u001b[0m     const err = new Error('DB error')(\n        \u001b[7m  \u001b[0m \u001b[96m          ~~~\u001b[0m\n        'err' is declared here.\n    \u001b[96m__tests__/scenes/checkBalanceScene.test.ts\u001b[0m:\u001b[93m59\u001b[0m:\u001b[93m18\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2304: \u001b[0mCannot find name 'checkBalanceSceneEnterHandler'.\n\n    \u001b[7m59\u001b[0m     await expect(checkBalanceSceneEnterHandler(ctx as any)).rejects.toThrow(\n    \u001b[7m  \u001b[0m \u001b[91m                 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/textToVideoWizard.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/scenes/textToVideoWizard.test.ts\u001b[0m:\u001b[93m5\u001b[0m:\u001b[93m57\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2307: \u001b[0mCannot find module '../utils/mockContext' or its corresponding type declarations.\n\n    \u001b[7m5\u001b[0m import { makeMockContext, MockContextWithSession } from '../utils/mockContext'\n    \u001b[7m \u001b[0m \u001b[91m                                                        ~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/getRuBillWizard.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/scenes/getRuBillWizard.test.ts\u001b[0m:\u001b[93m44\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2322: \u001b[0mType 'number' is not assignable to type 'string'.\n\n    \u001b[7m44\u001b[0m     targetUserId: 0,\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~~\u001b[0m\n\n      \u001b[96msrc/interfaces/telegram-bot.interface.ts\u001b[0m:\u001b[93m161\u001b[0m:\u001b[93m3\u001b[0m\n        \u001b[7m161\u001b[0m   targetUserId: string\n        \u001b[7m   \u001b[0m \u001b[96m  ~~~~~~~~~~~~\u001b[0m\n        The expected type comes from property 'targetUserId' which is declared here on type 'MySession'\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/uploadTrainFluxModelScene.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/scenes/uploadTrainFluxModelScene.test.ts\u001b[0m:\u001b[93m4\u001b[0m:\u001b[93m31\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2307: \u001b[0mCannot find module 'telegraf/typings/manage' or its corresponding type declarations.\n\n    \u001b[7m4\u001b[0m import { UserFromGetMe } from 'telegraf/typings/manage' // –ò–º–ø–æ—Ä—Ç –¥–ª—è —Ç–∏–ø–∞ UserFromGetMe\n    \u001b[7m \u001b[0m \u001b[91m                              ~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/uploadTrainFluxModelScene.test.ts\u001b[0m:\u001b[93m63\u001b[0m:\u001b[93m7\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2322: \u001b[0mType 'number' is not assignable to type 'string'.\n\n    \u001b[7m63\u001b[0m       targetUserId: 5678,\n    \u001b[7m  \u001b[0m \u001b[91m      ~~~~~~~~~~~~\u001b[0m\n\n      \u001b[96msrc/interfaces/telegram-bot.interface.ts\u001b[0m:\u001b[93m161\u001b[0m:\u001b[93m3\u001b[0m\n        \u001b[7m161\u001b[0m   targetUserId: string\n        \u001b[7m   \u001b[0m \u001b[96m  ~~~~~~~~~~~~\u001b[0m\n        The expected type comes from property 'targetUserId' which is declared here on type 'MySession'\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/imageToVideoWizard.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/scenes/imageToVideoWizard.test.ts\u001b[0m:\u001b[93m6\u001b[0m:\u001b[93m40\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2305: \u001b[0mModule '\"@/price/helpers/processBalanceVideoOperation\"' has no exported member 'ProcessBalanceResult'.\n\n    \u001b[7m6\u001b[0m import { processBalanceVideoOperation, ProcessBalanceResult } from '@/price/helpers/processBalanceVideoOperation'\n    \u001b[7m \u001b[0m \u001b[91m                                       ~~~~~~~~~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/helpScene.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m42\u001b[0m:\u001b[93m23\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'steps' does not exist on type 'BaseScene<MyContext>'.\n\n    \u001b[7m42\u001b[0m     step0 = helpScene.steps[0]\n    \u001b[7m  \u001b[0m \u001b[91m                      ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m46\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m46\u001b[0m     ctx.from = { id: 42, language_code: 'ru' }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m47\u001b[0m:\u001b[93m21\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2322: \u001b[0mType '\"\"' is not assignable to type 'ModeEnum'.\n\n    \u001b[7m47\u001b[0m     ctx.session = { mode: '' }\n    \u001b[7m  \u001b[0m \u001b[91m                    ~~~~\u001b[0m\n\n      \u001b[96msrc/interfaces/telegram-bot.interface.ts\u001b[0m:\u001b[93m154\u001b[0m:\u001b[93m3\u001b[0m\n        \u001b[7m154\u001b[0m   mode?: ModeEnum\n        \u001b[7m   \u001b[0m \u001b[96m  ~~~~\u001b[0m\n        The expected type comes from property 'mode' which is declared here on type 'MySession'\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m54\u001b[0m:\u001b[93m16\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'ru' does not exist on type '({ isRu, inviteCount, subscription, level, ctx, }: { isRu: boolean; inviteCount: number; subscription: SubscriptionType; level: number; ctx: MyContext; }) => Promise<Markup<ReplyKeyboardMarkup>>'.\n\n    \u001b[7m54\u001b[0m       mainMenu.ru.text,\n    \u001b[7m  \u001b[0m \u001b[91m               ~~\u001b[0m\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m55\u001b[0m:\u001b[93m16\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'ru' does not exist on type '({ isRu, inviteCount, subscription, level, ctx, }: { isRu: boolean; inviteCount: number; subscription: SubscriptionType; level: number; ctx: MyContext; }) => Promise<Markup<ReplyKeyboardMarkup>>'.\n\n    \u001b[7m55\u001b[0m       mainMenu.ru.keyboard\n    \u001b[7m  \u001b[0m \u001b[91m               ~~\u001b[0m\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m60\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m60\u001b[0m     ctx.from = { id: 43, language_code: 'en' }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m61\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2739: \u001b[0mType '{ mode: ModeEnum.DigitalAvatarBodyV2; }' is missing the following properties from type 'MySession': cursor, images, targetUserId, userModel\n\n    \u001b[7m61\u001b[0m     ctx.session = { mode: ModeEnum.DigitalAvatarBodyV2 } // –ò—Å–ø–æ–ª—å–∑—É–µ–º ModeEnum\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m68\u001b[0m:\u001b[93m16\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'en' does not exist on type '({ isRu, inviteCount, subscription, level, ctx, }: { isRu: boolean; inviteCount: number; subscription: SubscriptionType; level: number; ctx: MyContext; }) => Promise<Markup<ReplyKeyboardMarkup>>'.\n\n    \u001b[7m68\u001b[0m       mainMenu.en.text,\n    \u001b[7m  \u001b[0m \u001b[91m               ~~\u001b[0m\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m69\u001b[0m:\u001b[93m16\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'en' does not exist on type '({ isRu, inviteCount, subscription, level, ctx, }: { isRu: boolean; inviteCount: number; subscription: SubscriptionType; level: number; ctx: MyContext; }) => Promise<Markup<ReplyKeyboardMarkup>>'.\n\n    \u001b[7m69\u001b[0m       mainMenu.en.keyboard\n    \u001b[7m  \u001b[0m \u001b[91m               ~~\u001b[0m\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m74\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m74\u001b[0m     ctx.from = { id: 44, language_code: 'en' }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m75\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2739: \u001b[0mType '{ mode: ModeEnum.Help; }' is missing the following properties from type 'MySession': cursor, images, targetUserId, userModel\n\n    \u001b[7m75\u001b[0m     ctx.session = { mode: ModeEnum.Help } // –ò—Å–ø–æ–ª—å–∑—É–µ–º ModeEnum\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m78\u001b[0m:\u001b[93m53\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'Error' is not assignable to parameter of type 'never'.\n\n    \u001b[7m78\u001b[0m     ;(ctx.reply as jest.Mock).mockRejectedValueOnce(error)\n    \u001b[7m  \u001b[0m \u001b[91m                                                    ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m87\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m87\u001b[0m     ctx.from = { id: 45, language_code: 'ru' }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m88\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2739: \u001b[0mType '{ mode: ModeEnum.DigitalAvatarBodyV2; }' is missing the following properties from type 'MySession': cursor, images, targetUserId, userModel\n\n    \u001b[7m88\u001b[0m     ctx.session = { mode: ModeEnum.DigitalAvatarBodyV2 } // –ò—Å–ø–æ–ª—å–∑—É–µ–º ModeEnum\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m95\u001b[0m:\u001b[93m16\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'ru' does not exist on type '({ isRu, inviteCount, subscription, level, ctx, }: { isRu: boolean; inviteCount: number; subscription: SubscriptionType; level: number; ctx: MyContext; }) => Promise<Markup<ReplyKeyboardMarkup>>'.\n\n    \u001b[7m95\u001b[0m       mainMenu.ru.text,\n    \u001b[7m  \u001b[0m \u001b[91m               ~~\u001b[0m\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m96\u001b[0m:\u001b[93m16\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'ru' does not exist on type '({ isRu, inviteCount, subscription, level, ctx, }: { isRu: boolean; inviteCount: number; subscription: SubscriptionType; level: number; ctx: MyContext; }) => Promise<Markup<ReplyKeyboardMarkup>>'.\n\n    \u001b[7m96\u001b[0m       mainMenu.ru.keyboard\n    \u001b[7m  \u001b[0m \u001b[91m               ~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/neuroPhotoWizard.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/scenes/neuroPhotoWizard.test.ts\u001b[0m:\u001b[93m33\u001b[0m:\u001b[93m24\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2352: \u001b[0mConversion of type '({ isRu, inviteCount, subscription, level, ctx, }: { isRu: boolean; inviteCount: number; subscription: SubscriptionType; level: number; ctx: MyContext; }) => Promise<Markup<ReplyKeyboardMarkup>>' to type 'Mock<() => Promise<{ text: string; keyboard: Markup<any>; }>>' may be a mistake because neither type sufficiently overlaps with the other. If this was intentional, convert the expression to 'unknown' first.\n      Type '({ isRu, inviteCount, subscription, level, ctx, }: { isRu: boolean; inviteCount: number; subscription: SubscriptionType; level: number; ctx: MyContext; }) => Promise<Markup<ReplyKeyboardMarkup>>' is missing the following properties from type 'Mock<() => Promise<{ text: string; keyboard: Markup<any>; }>>': _isMockFunction, _protoImpl, getMockImplementation, getMockName, and 15 more.\n\n    \u001b[7m33\u001b[0m const mockedMainMenu = mainMenu as jest.Mock<() => Promise<{text: string, keyboard: Markup.Markup<any>}>> // –¢–∏–ø–∏–∑–∏—Ä—É–µ–º mainMenu\n    \u001b[7m  \u001b[0m \u001b[91m                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroPhotoWizard.test.ts\u001b[0m:\u001b[93m43\u001b[0m:\u001b[93m54\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2739: \u001b[0mType 'ReplyKeyboardMarkup' is missing the following properties from type 'Markup<any>': reply_markup, placeholder, resize, oneTime, persistent\n\n    \u001b[7m43\u001b[0m     mockedMainMenu.mockResolvedValue({ text: 'Menu', keyboard: Markup.keyboard([['Btn']]).reply_markup })\n    \u001b[7m  \u001b[0m \u001b[91m                                                     ~~~~~~~~\u001b[0m\n\n      \u001b[96m__tests__/scenes/neuroPhotoWizard.test.ts\u001b[0m:\u001b[93m33\u001b[0m:\u001b[93m75\u001b[0m\n        \u001b[7m33\u001b[0m const mockedMainMenu = mainMenu as jest.Mock<() => Promise<{text: string, keyboard: Markup.Markup<any>}>> // –¢–∏–ø–∏–∑–∏—Ä—É–µ–º mainMenu\n        \u001b[7m  \u001b[0m \u001b[96m                                                                          ~~~~~~~~\u001b[0m\n        The expected type comes from property 'keyboard' which is declared here on type '{ text: string; keyboard: Markup<any>; }'\n    \u001b[96m__tests__/scenes/neuroPhotoWizard.test.ts\u001b[0m:\u001b[93m50\u001b[0m:\u001b[93m48\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'null' is not assignable to parameter of type 'never'.\n\n    \u001b[7m50\u001b[0m     mockedGetLatestModel.mockResolvedValueOnce(null)\n    \u001b[7m  \u001b[0m \u001b[91m                                               ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroPhotoWizard.test.ts\u001b[0m:\u001b[93m51\u001b[0m:\u001b[93m45\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '{ count: number; subscription: string; level: number; }' is not assignable to parameter of type 'never'.\n\n    \u001b[7m 51\u001b[0m     mockedGetReferals.mockResolvedValueOnce({\n    \u001b[7m   \u001b[0m \u001b[91m                                            ~\u001b[0m\n    \u001b[7m 52\u001b[0m       count: 0,\n    \u001b[7m   \u001b[0m \u001b[91m~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[7m...\u001b[0m \n    \u001b[7m 54\u001b[0m       level: 1,\n    \u001b[7m   \u001b[0m \u001b[91m~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[7m 55\u001b[0m     })\n    \u001b[7m   \u001b[0m \u001b[91m~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroPhotoWizard.test.ts\u001b[0m:\u001b[93m59\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m59\u001b[0m     await step(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroPhotoWizard.test.ts\u001b[0m:\u001b[93m67\u001b[0m:\u001b[93m48\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '{ model_url: string; trigger_word: string; }' is not assignable to parameter of type 'never'.\n\n    \u001b[7m67\u001b[0m     mockedGetLatestModel.mockResolvedValueOnce({\n    \u001b[7m  \u001b[0m \u001b[91m                                               ~\u001b[0m\n    \u001b[7m68\u001b[0m       model_url: 'url1',\n    \u001b[7m  \u001b[0m \u001b[91m~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[7m69\u001b[0m       trigger_word: 'tw',\n    \u001b[7m  \u001b[0m \u001b[91m~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[7m70\u001b[0m     })\n    \u001b[7m  \u001b[0m \u001b[91m~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroPhotoWizard.test.ts\u001b[0m:\u001b[93m71\u001b[0m:\u001b[93m45\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '{ count: number; subscription: string; level: number; }' is not assignable to parameter of type 'never'.\n\n    \u001b[7m 71\u001b[0m     mockedGetReferals.mockResolvedValueOnce({\n    \u001b[7m   \u001b[0m \u001b[91m                                            ~\u001b[0m\n    \u001b[7m 72\u001b[0m       count: 5,\n    \u001b[7m   \u001b[0m \u001b[91m~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[7m...\u001b[0m \n    \u001b[7m 74\u001b[0m       level: 2,\n    \u001b[7m   \u001b[0m \u001b[91m~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[7m 75\u001b[0m     })\n    \u001b[7m   \u001b[0m \u001b[91m~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroPhotoWizard.test.ts\u001b[0m:\u001b[93m79\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m79\u001b[0m     await step(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroPhotoWizard.test.ts\u001b[0m:\u001b[93m87\u001b[0m:\u001b[93m48\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '{ model_url: string; trigger_word: string; }' is not assignable to parameter of type 'never'.\n\n    \u001b[7m87\u001b[0m     mockedGetLatestModel.mockResolvedValueOnce({\n    \u001b[7m  \u001b[0m \u001b[91m                                               ~\u001b[0m\n    \u001b[7m88\u001b[0m       model_url: 'url2',\n    \u001b[7m  \u001b[0m \u001b[91m~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[7m89\u001b[0m       trigger_word: 'x',\n    \u001b[7m  \u001b[0m \u001b[91m~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[7m90\u001b[0m     })\n    \u001b[7m  \u001b[0m \u001b[91m~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroPhotoWizard.test.ts\u001b[0m:\u001b[93m91\u001b[0m:\u001b[93m45\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '{ count: number; subscription: string; level: number; }' is not assignable to parameter of type 'never'.\n\n    \u001b[7m 91\u001b[0m     mockedGetReferals.mockResolvedValueOnce({\n    \u001b[7m   \u001b[0m \u001b[91m                                            ~\u001b[0m\n    \u001b[7m 92\u001b[0m       count: 1,\n    \u001b[7m   \u001b[0m \u001b[91m~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[7m...\u001b[0m \n    \u001b[7m 94\u001b[0m       level: 1,\n    \u001b[7m   \u001b[0m \u001b[91m~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[7m 95\u001b[0m     })\n    \u001b[7m   \u001b[0m \u001b[91m~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroPhotoWizard.test.ts\u001b[0m:\u001b[93m99\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m99\u001b[0m     await step(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroPhotoWizard.test.ts\u001b[0m:\u001b[93m109\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2353: \u001b[0mObject literal may only specify known properties, and 'session' does not exist in type 'Partial<MySession>'.\n\n    \u001b[7m109\u001b[0m       { session: { userModel }, message: { text: 'hello' } }\n    \u001b[7m   \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroPhotoWizard.test.ts\u001b[0m:\u001b[93m114\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m114\u001b[0m     await step(ctx)\n    \u001b[7m   \u001b[0m \u001b[91m          ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroPhotoWizard.test.ts\u001b[0m:\u001b[93m126\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m126\u001b[0m     await step(ctx)\n    \u001b[7m   \u001b[0m \u001b[91m          ~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/selectModelWizard.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/scenes/selectModelWizard.test.ts\u001b[0m:\u001b[93m59\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2322: \u001b[0mType 'number' is not assignable to type 'string'.\n\n    \u001b[7m59\u001b[0m     targetUserId: 0,\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~~\u001b[0m\n\n      \u001b[96msrc/interfaces/telegram-bot.interface.ts\u001b[0m:\u001b[93m161\u001b[0m:\u001b[93m3\u001b[0m\n        \u001b[7m161\u001b[0m   targetUserId: string\n        \u001b[7m   \u001b[0m \u001b[96m  ~~~~~~~~~~~~\u001b[0m\n        The expected type comes from property 'targetUserId' which is declared here on type 'MySession'\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/emailWizard.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/scenes/emailWizard.test.ts\u001b[0m:\u001b[93m20\u001b[0m:\u001b[93m29\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2352: \u001b[0mConversion of type '(telegram_id: string, email: string) => Promise<void>' to type 'Mock<(userId: string, email: string) => Promise<void>, any, any>' may be a mistake because neither type sufficiently overlaps with the other. If this was intentional, convert the expression to 'unknown' first.\n      Type '(telegram_id: string, email: string) => Promise<void>' is missing the following properties from type 'Mock<(userId: string, email: string) => Promise<void>, any, any>': getMockName, mock, mockClear, mockReset, and 13 more.\n\n    \u001b[7m20\u001b[0m const mockedSaveUserEmail = saveUserEmail as jest.Mock< (userId: string, email: string) => Promise<void> >\n    \u001b[7m  \u001b[0m \u001b[91m                            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/emailWizard.test.ts\u001b[0m:\u001b[93m21\u001b[0m:\u001b[93m25\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2352: \u001b[0mConversion of type '(ctx: Context) => boolean' to type 'Mock<() => boolean, any, any>' may be a mistake because neither type sufficiently overlaps with the other. If this was intentional, convert the expression to 'unknown' first.\n      Type '(ctx: Context<Update>) => boolean' is missing the following properties from type 'Mock<() => boolean, any, any>': getMockName, mock, mockClear, mockReset, and 13 more.\n\n    \u001b[7m21\u001b[0m const mockedIsRussian = isRussian as jest.Mock<() => boolean>\n    \u001b[7m  \u001b[0m \u001b[91m                        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/emailWizard.test.ts\u001b[0m:\u001b[93m22\u001b[0m:\u001b[93m28\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2352: \u001b[0mConversion of type '(ctx: MyContext) => Promise<boolean>' to type 'Mock<(...args: any[]) => Promise<boolean>, any, any>' may be a mistake because neither type sufficiently overlaps with the other. If this was intentional, convert the expression to 'unknown' first.\n      Type '(ctx: MyContext) => Promise<boolean>' is missing the following properties from type 'Mock<(...args: any[]) => Promise<boolean>, any, any>': getMockName, mock, mockClear, mockReset, and 13 more.\n\n    \u001b[7m22\u001b[0m const mockedHandleCancel = handleHelpCancel as jest.Mock<(...args: any[]) => Promise<boolean>>\n    \u001b[7m  \u001b[0m \u001b[91m                           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/emailWizard.test.ts\u001b[0m:\u001b[93m30\u001b[0m:\u001b[93m41\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'boolean' is not assignable to parameter of type '() => boolean'.\n\n    \u001b[7m30\u001b[0m     mockedIsRussian.mockReturnValueOnce(true)\n    \u001b[7m  \u001b[0m \u001b[91m                                        ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/emailWizard.test.ts\u001b[0m:\u001b[93m32\u001b[0m:\u001b[93m23\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2554: \u001b[0mExpected 2 arguments, but got 1.\n\n    \u001b[7m32\u001b[0m     await emailWizard.enterHandler(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m                      ~~~~~~~~~~~~\u001b[0m\n\n      \u001b[96mnode_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/typings/middleware.d.ts\u001b[0m:\u001b[93m3\u001b[0m:\u001b[93m86\u001b[0m\n        \u001b[7m3\u001b[0m export type MiddlewareFn<C extends Context<U>, U extends Update = Update> = (ctx: C, next: () => Promise<void>) => Promise<unknown> | void;\n        \u001b[7m \u001b[0m \u001b[96m                                                                                     ~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n        An argument for 'next' was not provided.\n    \u001b[96m__tests__/scenes/emailWizard.test.ts\u001b[0m:\u001b[93m44\u001b[0m:\u001b[93m41\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'boolean' is not assignable to parameter of type '() => boolean'.\n\n    \u001b[7m44\u001b[0m     mockedIsRussian.mockReturnValueOnce(false)\n    \u001b[7m  \u001b[0m \u001b[91m                                        ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/emailWizard.test.ts\u001b[0m:\u001b[93m46\u001b[0m:\u001b[93m23\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2554: \u001b[0mExpected 2 arguments, but got 1.\n\n    \u001b[7m46\u001b[0m     await emailWizard.enterHandler(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m                      ~~~~~~~~~~~~\u001b[0m\n\n      \u001b[96mnode_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/typings/middleware.d.ts\u001b[0m:\u001b[93m3\u001b[0m:\u001b[93m86\u001b[0m\n        \u001b[7m3\u001b[0m export type MiddlewareFn<C extends Context<U>, U extends Update = Update> = (ctx: C, next: () => Promise<void>) => Promise<unknown> | void;\n        \u001b[7m \u001b[0m \u001b[96m                                                                                     ~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n        An argument for 'next' was not provided.\n    \u001b[96m__tests__/scenes/emailWizard.test.ts\u001b[0m:\u001b[93m64\u001b[0m:\u001b[93m41\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'boolean' is not assignable to parameter of type '() => boolean'.\n\n    \u001b[7m64\u001b[0m     mockedIsRussian.mockReturnValueOnce(true)\n    \u001b[7m  \u001b[0m \u001b[91m                                        ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/emailWizard.test.ts\u001b[0m:\u001b[93m65\u001b[0m:\u001b[93m46\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'false' is not assignable to parameter of type 'never'.\n\n    \u001b[7m65\u001b[0m     mockedHandleCancel.mockResolvedValueOnce(false)\n    \u001b[7m  \u001b[0m \u001b[91m                                             ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/emailWizard.test.ts\u001b[0m:\u001b[93m66\u001b[0m:\u001b[93m47\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'undefined' is not assignable to parameter of type 'never'.\n\n    \u001b[7m66\u001b[0m     mockedSaveUserEmail.mockResolvedValueOnce(undefined)\n    \u001b[7m  \u001b[0m \u001b[91m                                              ~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/emailWizard.test.ts\u001b[0m:\u001b[93m70\u001b[0m:\u001b[93m23\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'emailHandler' does not exist on type 'BaseScene<MyContext>'.\n\n    \u001b[7m70\u001b[0m     await emailWizard.emailHandler(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m                      ~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/emailWizard.test.ts\u001b[0m:\u001b[93m90\u001b[0m:\u001b[93m41\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'boolean' is not assignable to parameter of type '() => boolean'.\n\n    \u001b[7m90\u001b[0m     mockedIsRussian.mockReturnValueOnce(false)\n    \u001b[7m  \u001b[0m \u001b[91m                                        ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/emailWizard.test.ts\u001b[0m:\u001b[93m96\u001b[0m:\u001b[93m23\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'emailHandler' does not exist on type 'BaseScene<MyContext>'.\n\n    \u001b[7m96\u001b[0m     await emailWizard.emailHandler(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m                      ~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/imageToPromptWizard.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/scenes/imageToPromptWizard.test.ts\u001b[0m:\u001b[93m27\u001b[0m:\u001b[93m24\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2352: \u001b[0mConversion of type '(ctx: MyContext) => string' to type 'Mock<() => [string, string]>' may be a mistake because neither type sufficiently overlaps with the other. If this was intentional, convert the expression to 'unknown' first.\n      Type '(ctx: MyContext) => string' is missing the following properties from type 'Mock<() => [string, string]>': _isMockFunction, _protoImpl, getMockImplementation, getMockName, and 15 more.\n\n    \u001b[7m27\u001b[0m const mockedGetToken = getBotToken as jest.Mock<() => [string, string] | null>\n    \u001b[7m  \u001b[0m \u001b[91m                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/imageToPromptWizard.test.ts\u001b[0m:\u001b[93m118\u001b[0m:\u001b[93m42\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2353: \u001b[0mObject literal may only specify known properties, and 'message' does not exist in type 'Partial<MySession>'.\n\n    \u001b[7m118\u001b[0m     const msgCtx = makeMockContext({}, { message: { text: 'foo' } })\n    \u001b[7m   \u001b[0m \u001b[91m                                         ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/imageToPromptWizard.test.ts\u001b[0m:\u001b[93m119\u001b[0m:\u001b[93m60\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'true' is not assignable to parameter of type 'never'.\n\n    \u001b[7m119\u001b[0m     ;(handleHelpCancel as jest.Mock).mockResolvedValueOnce(true)\n    \u001b[7m   \u001b[0m \u001b[91m                                                           ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/imageToPromptWizard.test.ts\u001b[0m:\u001b[93m122\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m122\u001b[0m     await step1(msgCtx)\n    \u001b[7m   \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/imageToPromptWizard.test.ts\u001b[0m:\u001b[93m127\u001b[0m:\u001b[93m56\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'false' is not assignable to parameter of type 'never'.\n\n    \u001b[7m127\u001b[0m     ;(handleHelpCancel as jest.Mock).mockResolvedValue(false)\n    \u001b[7m   \u001b[0m \u001b[91m                                                       ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/imageToPromptWizard.test.ts\u001b[0m:\u001b[93m128\u001b[0m:\u001b[93m55\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'string[]' is not assignable to parameter of type 'never'.\n\n    \u001b[7m128\u001b[0m     ;(getBotToken as jest.Mock).mockResolvedValueOnce(['tok', 'botName'])\n    \u001b[7m   \u001b[0m \u001b[91m                                                      ~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/imageToPromptWizard.test.ts\u001b[0m:\u001b[93m129\u001b[0m:\u001b[93m55\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'string[]' is not assignable to parameter of type 'never'.\n\n    \u001b[7m129\u001b[0m     ;(getBotToken as jest.Mock).mockResolvedValueOnce(['tok', 'botName'])\n    \u001b[7m   \u001b[0m \u001b[91m                                                      ~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/imageToPromptWizard.test.ts\u001b[0m:\u001b[93m131\u001b[0m:\u001b[93m7\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2353: \u001b[0mObject literal may only specify known properties, and 'message' does not exist in type 'Partial<MySession>'.\n\n    \u001b[7m131\u001b[0m       message: { photo: [{ file_id: 'fid1' }, { file_id: 'fid2' }] }\n    \u001b[7m   \u001b[0m \u001b[91m      ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/imageToPromptWizard.test.ts\u001b[0m:\u001b[93m134\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2322: \u001b[0mType 'Mock<UnknownFunction>' is not assignable to type '(fileId: string | File) => Promise<URL>'.\n      Type '{}' is missing the following properties from type 'Promise<URL>': then, catch, finally, [Symbol.toStringTag]\n\n    \u001b[7m134\u001b[0m     ctx.telegram.getFileLink = jest.fn().mockResolvedValue({ href: 'http://file.jpg' })\n    \u001b[7m   \u001b[0m \u001b[91m    ~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/imageToPromptWizard.test.ts\u001b[0m:\u001b[93m134\u001b[0m:\u001b[93m60\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '{ href: string; }' is not assignable to parameter of type 'never'.\n\n    \u001b[7m134\u001b[0m     ctx.telegram.getFileLink = jest.fn().mockResolvedValue({ href: 'http://file.jpg' })\n    \u001b[7m   \u001b[0m \u001b[91m                                                           ~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/imageToPromptWizard.test.ts\u001b[0m:\u001b[93m137\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m137\u001b[0m     await step1(ctx)\n    \u001b[7m   \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/levelQuestWizard.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/scenes/levelQuestWizard.test.ts\u001b[0m:\u001b[93m42\u001b[0m:\u001b[93m15\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'match' does not exist on type 'MyContext & DebugExtension'.\n\n    \u001b[7m42\u001b[0m     await ctx.match('‚û°Ô∏è –î–∞–ª–µ–µ —à–∞–≥ 1')\n    \u001b[7m  \u001b[0m \u001b[91m              ~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/cancelPredictionsWizard.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/scenes/cancelPredictionsWizard.test.ts\u001b[0m:\u001b[93m33\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m33\u001b[0m     await step(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/cancelPredictionsWizard.test.ts\u001b[0m:\u001b[93m45\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m45\u001b[0m     await step(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/middlewares/handleSubscriptionMessage.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/middlewares/handleSubscriptionMessage.test.ts\u001b[0m:\u001b[93m10\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m10\u001b[0m     ctx.from = { id: 10, language_code: 'ru' } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/middlewares/handleSubscriptionMessage.test.ts\u001b[0m:\u001b[93m11\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'telegram' because it is a read-only property.\n\n    \u001b[7m11\u001b[0m     ctx.telegram = { ...ctx.telegram, sendMessage: jest.fn(() => Promise.resolve()) } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/index.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/core/supabase/index.test.ts\u001b[0m:\u001b[93m11\u001b[0m:\u001b[93m47\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '() => void' is not assignable to parameter of type '(infoObject: object) => Logger'.\n      Type 'void' is not assignable to type 'Logger'.\n\n    \u001b[7m11\u001b[0m jest.spyOn(logger, 'warn').mockImplementation(() => {})\n    \u001b[7m  \u001b[0m \u001b[91m                                              ~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/index.test.ts\u001b[0m:\u001b[93m12\u001b[0m:\u001b[93m48\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '() => void' is not assignable to parameter of type '(infoObject: object) => Logger'.\n      Type 'void' is not assignable to type 'Logger'.\n\n    \u001b[7m12\u001b[0m jest.spyOn(logger, 'error').mockImplementation(() => {})\n    \u001b[7m  \u001b[0m \u001b[91m                                               ~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/index.test.ts\u001b[0m:\u001b[93m13\u001b[0m:\u001b[93m47\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '() => void' is not assignable to parameter of type '(infoObject: object) => Logger'.\n      Type 'void' is not assignable to type 'Logger'.\n\n    \u001b[7m13\u001b[0m jest.spyOn(logger, 'info').mockImplementation(() => {})\n    \u001b[7m  \u001b[0m \u001b[91m                                              ~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/index.test.ts\u001b[0m:\u001b[93m19\u001b[0m:\u001b[93m12\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'SUPABASE_URL' because it is a read-only property.\n\n    \u001b[7m19\u001b[0m     config.SUPABASE_URL = 'http://supabase.test'\n    \u001b[7m  \u001b[0m \u001b[91m           ~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/index.test.ts\u001b[0m:\u001b[93m20\u001b[0m:\u001b[93m12\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'SUPABASE_SERVICE_KEY' because it is a read-only property.\n\n    \u001b[7m20\u001b[0m     config.SUPABASE_SERVICE_KEY = 'service-key'\n    \u001b[7m  \u001b[0m \u001b[91m           ~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/index.test.ts\u001b[0m:\u001b[93m21\u001b[0m:\u001b[93m12\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'SUPABASE_SERVICE_ROLE_KEY' because it is a read-only property.\n\n    \u001b[7m21\u001b[0m     config.SUPABASE_SERVICE_ROLE_KEY = 'service-role'\n    \u001b[7m  \u001b[0m \u001b[91m           ~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/index.test.ts\u001b[0m:\u001b[93m22\u001b[0m:\u001b[93m12\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'isSupabaseConfigured' because it is a read-only property.\n\n    \u001b[7m22\u001b[0m     config.isSupabaseConfigured = true\n    \u001b[7m  \u001b[0m \u001b[91m           ~~~~~~~~~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/sendPaymentInfo.unit.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/core/supabase/sendPaymentInfo.unit.test.ts\u001b[0m:\u001b[93m19\u001b[0m:\u001b[93m43\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2554: \u001b[0mExpected 1 arguments, but got 2.\n\n    \u001b[7m19\u001b[0m     await expect(sendPaymentInfo(user_id, level))\n    \u001b[7m  \u001b[0m \u001b[91m                                          ~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/sendPaymentInfo.unit.test.ts\u001b[0m:\u001b[93m27\u001b[0m:\u001b[93m43\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2554: \u001b[0mExpected 1 arguments, but got 2.\n\n    \u001b[7m27\u001b[0m     await expect(sendPaymentInfo(user_id, level))\n    \u001b[7m  \u001b[0m \u001b[91m                                          ~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/sendPaymentInfo.unit.test.ts\u001b[0m:\u001b[93m37\u001b[0m:\u001b[93m51\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2554: \u001b[0mExpected 1 arguments, but got 2.\n\n    \u001b[7m37\u001b[0m     const result = await sendPaymentInfo(user_id, level)\n    \u001b[7m  \u001b[0m \u001b[91m                                                  ~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/setPayments.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/core/supabase/setPayments.test.ts\u001b[0m:\u001b[93m32\u001b[0m:\u001b[93m30\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '{ telegram_id: string; OutSum: string; InvId: string; currency: \"USD\"; stars: number; status: \"COMPLETED\"; payment_method: \"Stripe\"; bot_name: string; language: string; }' is not assignable to parameter of type 'PaymentParams'.\n      Property 'subscription' is missing in type '{ telegram_id: string; OutSum: string; InvId: string; currency: \"USD\"; stars: number; status: \"COMPLETED\"; payment_method: \"Stripe\"; bot_name: string; language: string; }' but required in type 'PaymentParams'.\n\n    \u001b[7m32\u001b[0m     await expect(setPayments(paymentArgs)).resolves.toBeUndefined()\n    \u001b[7m  \u001b[0m \u001b[91m                             ~~~~~~~~~~~\u001b[0m\n\n      \u001b[96msrc/core/supabase/setPayments.ts\u001b[0m:\u001b[93m16\u001b[0m:\u001b[93m3\u001b[0m\n        \u001b[7m16\u001b[0m   subscription: string | null // <-- –°–ù–û–í–ê –î–û–ë–ê–í–õ–Ø–ï–ú –≠–¢–û –ü–û–õ–ï\n        \u001b[7m  \u001b[0m \u001b[96m  ~~~~~~~~~~~~\u001b[0m\n        'subscription' is declared here.\n    \u001b[96m__tests__/core/supabase/setPayments.test.ts\u001b[0m:\u001b[93m54\u001b[0m:\u001b[93m30\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '{ telegram_id: string; OutSum: string; InvId: string; currency: \"USD\"; stars: number; status: \"COMPLETED\"; payment_method: \"Stripe\"; bot_name: string; language: string; }' is not assignable to parameter of type 'PaymentParams'.\n      Property 'subscription' is missing in type '{ telegram_id: string; OutSum: string; InvId: string; currency: \"USD\"; stars: number; status: \"COMPLETED\"; payment_method: \"Stripe\"; bot_name: string; language: string; }' but required in type 'PaymentParams'.\n\n    \u001b[7m54\u001b[0m     await expect(setPayments(paymentArgs)).rejects.toBe(err)\n    \u001b[7m  \u001b[0m \u001b[91m                             ~~~~~~~~~~~\u001b[0m\n\n      \u001b[96msrc/core/supabase/setPayments.ts\u001b[0m:\u001b[93m16\u001b[0m:\u001b[93m3\u001b[0m\n        \u001b[7m16\u001b[0m   subscription: string | null // <-- –°–ù–û–í–ê –î–û–ë–ê–í–õ–Ø–ï–ú –≠–¢–û –ü–û–õ–ï\n        \u001b[7m  \u001b[0m \u001b[96m  ~~~~~~~~~~~~\u001b[0m\n        'subscription' is declared here.\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserByTelegramId.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/core/supabase/getUserByTelegramId.test.ts\u001b[0m:\u001b[93m36\u001b[0m:\u001b[93m28\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Type '{ select: any; }' has no call signatures.\n\n    \u001b[7m36\u001b[0m       .mockReturnValueOnce({ select: mockSelect: () => ({ eq: mockEq }) })\n    \u001b[7m  \u001b[0m \u001b[91m                           ~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/getUserByTelegramId.test.ts\u001b[0m:\u001b[93m36\u001b[0m:\u001b[93m38\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2552: \u001b[0mCannot find name 'mockSelect'. Did you mean 'onselect'?\n\n    \u001b[7m36\u001b[0m       .mockReturnValueOnce({ select: mockSelect: () => ({ eq: mockEq }) })\n    \u001b[7m  \u001b[0m \u001b[91m                                     ~~~~~~~~~~\u001b[0m\n\n      \u001b[96mnode_modules/.pnpm/typescript@5.8.3/node_modules/typescript/lib/lib.dom.d.ts\u001b[0m:\u001b[93m29165\u001b[0m:\u001b[93m13\u001b[0m\n        \u001b[7m29165\u001b[0m declare var onselect: ((this: Window, ev: Event) => any) | null;\n        \u001b[7m     \u001b[0m \u001b[96m            ~~~~~~~~\u001b[0m\n        'onselect' is declared here.\n    \u001b[96m__tests__/core/supabase/getUserByTelegramId.test.ts\u001b[0m:\u001b[93m37\u001b[0m:\u001b[93m8\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'mockReturnValueOnce' does not exist on type 'void'.\n\n    \u001b[7m37\u001b[0m       .mockReturnValueOnce({ update: mockUpdate, eq: mockEq })\n    \u001b[7m  \u001b[0m \u001b[91m       ~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/getUserByTelegramId.test.ts\u001b[0m:\u001b[93m37\u001b[0m:\u001b[93m38\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2304: \u001b[0mCannot find name 'mockUpdate'.\n\n    \u001b[7m37\u001b[0m       .mockReturnValueOnce({ update: mockUpdate, eq: mockEq })\n    \u001b[7m  \u001b[0m \u001b[91m                                     ~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/getUserByTelegramId.test.ts\u001b[0m:\u001b[93m37\u001b[0m:\u001b[93m54\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2304: \u001b[0mCannot find name 'mockEq'.\n\n    \u001b[7m37\u001b[0m       .mockReturnValueOnce({ update: mockUpdate, eq: mockEq })\n    \u001b[7m  \u001b[0m \u001b[91m                                                     ~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/getUserByTelegramId.test.ts\u001b[0m:\u001b[93m39\u001b[0m:\u001b[93m49\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2304: \u001b[0mCannot find name 'mockEq'.\n\n    \u001b[7m39\u001b[0m     const sel = jest.fn().mockReturnValue({ eq: mockEq })\n    \u001b[7m  \u001b[0m \u001b[91m                                                ~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/getUserByTelegramId.test.ts\u001b[0m:\u001b[93m42\u001b[0m:\u001b[93m38\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2304: \u001b[0mCannot find name 'mockUpdate'.\n\n    \u001b[7m42\u001b[0m       .mockReturnValueOnce({ update: mockUpdate })\n    \u001b[7m  \u001b[0m \u001b[91m                                     ~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/getUserByTelegramId.test.ts\u001b[0m:\u001b[93m44\u001b[0m:\u001b[93m12\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2304: \u001b[0mCannot find name 'mockUpdate'.\n\n    \u001b[7m44\u001b[0m     expect(mockUpdate).toHaveBeenCalled()\n    \u001b[7m  \u001b[0m \u001b[91m           ~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/getUserByTelegramId.test.ts\u001b[0m:\u001b[93m45\u001b[0m:\u001b[93m28\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2304: \u001b[0mCannot find name 'userData'.\n\n    \u001b[7m45\u001b[0m     expect(result).toEqual(userData)\n    \u001b[7m  \u001b[0m \u001b[91m                           ~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/getUserByTelegramId.test.ts\u001b[0m:\u001b[93m36\u001b[0m:\u001b[93m48\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1005: \u001b[0m',' expected.\n\n    \u001b[7m36\u001b[0m       .mockReturnValueOnce({ select: mockSelect: () => ({ eq: mockEq }) })\n    \u001b[7m  \u001b[0m \u001b[91m                                               ~\u001b[0m\n    \u001b[96m__tests__/core/supabase/getUserByTelegramId.test.ts\u001b[0m:\u001b[93m36\u001b[0m:\u001b[93m50\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1136: \u001b[0mProperty assignment expected.\n\n    \u001b[7m36\u001b[0m       .mockReturnValueOnce({ select: mockSelect: () => ({ eq: mockEq }) })\n    \u001b[7m  \u001b[0m \u001b[91m                                                 ~\u001b[0m\n    \u001b[96m__tests__/core/supabase/getUserByTelegramId.test.ts\u001b[0m:\u001b[93m36\u001b[0m:\u001b[93m53\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1005: \u001b[0m',' expected.\n\n    \u001b[7m36\u001b[0m       .mockReturnValueOnce({ select: mockSelect: () => ({ eq: mockEq }) })\n    \u001b[7m  \u001b[0m \u001b[91m                                                    ~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/getUserByTelegramId.test.ts\u001b[0m:\u001b[93m47\u001b[0m:\u001b[93m1\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1128: \u001b[0mDeclaration or statement expected.\n\n    \u001b[7m47\u001b[0m })\n    \u001b[7m  \u001b[0m \u001b[91m~\u001b[0m\n    \u001b[96m__tests__/core/supabase/getUserByTelegramId.test.ts\u001b[0m:\u001b[93m47\u001b[0m:\u001b[93m2\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1128: \u001b[0mDeclaration or statement expected.\n\n    \u001b[7m47\u001b[0m })\n    \u001b[7m  \u001b[0m \u001b[91m ~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/ai.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/core/supabase/ai.test.ts\u001b[0m:\u001b[93m4\u001b[0m:\u001b[93m10\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2305: \u001b[0mModule '\"@/core/supabase/ai\"' has no exported member 'ai'.\n\n    \u001b[7m4\u001b[0m import { ai } from '@/core/supabase/ai'\n    \u001b[7m \u001b[0m \u001b[91m         ~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/axios/fetchWithAxios.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/core/axios/fetchWithAxios.test.ts\u001b[0m:\u001b[93m15\u001b[0m:\u001b[93m17\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'mockResolvedValueOnce' does not exist on type 'Mocked<AxiosStatic>'.\n\n    \u001b[7m15\u001b[0m     mockedAxios.mockResolvedValueOnce(fakeResponse as any)\n    \u001b[7m  \u001b[0m \u001b[91m                ~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/axios/fetchWithAxios.test.ts\u001b[0m:\u001b[93m23\u001b[0m:\u001b[93m17\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'mockRejectedValueOnce' does not exist on type 'Mocked<AxiosStatic>'.\n\n    \u001b[7m23\u001b[0m     mockedAxios.mockRejectedValueOnce(error)\n    \u001b[7m  \u001b[0m \u001b[91m                ~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/pinata/index.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/core/pinata/index.test.ts\u001b[0m:\u001b[93m34\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1005: \u001b[0m'}' expected.\n\n    \u001b[7m34\u001b[0m   })\n    \u001b[7m  \u001b[0m \u001b[91m    \u001b[0m\n\n      \u001b[96m__tests__/core/pinata/index.test.ts\u001b[0m:\u001b[93m14\u001b[0m:\u001b[93m37\u001b[0m\n        \u001b[7m14\u001b[0m describe('core/pinata index', () => {\n        \u001b[7m  \u001b[0m \u001b[96m                                    ~\u001b[0m\n        The parser expected to find a '}' to match the '{' token here.\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/bot.test.ts","failureMessage":"  ‚óè Test suite failed to run\n\n    \u001b[96m__tests__/bot.test.ts\u001b[0m:\u001b[93m12\u001b[0m:\u001b[93m10\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2459: \u001b[0mModule '\"@/bot\"' declares 'validateBotToken' locally, but it is not exported.\n\n    \u001b[7m12\u001b[0m import { validateBotToken, isPortInUse } from '@/bot'\n    \u001b[7m  \u001b[0m \u001b[91m         ~~~~~~~~~~~~~~~~\u001b[0m\n\n      \u001b[96msrc/bot.ts\u001b[0m:\u001b[93m29\u001b[0m:\u001b[93m16\u001b[0m\n        \u001b[7m29\u001b[0m async function validateBotToken(token: string): Promise<boolean> {\n        \u001b[7m  \u001b[0m \u001b[96m               ~~~~~~~~~~~~~~~~\u001b[0m\n        'validateBotToken' is declared here.\n    \u001b[96m__tests__/bot.test.ts\u001b[0m:\u001b[93m12\u001b[0m:\u001b[93m28\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2459: \u001b[0mModule '\"@/bot\"' declares 'isPortInUse' locally, but it is not exported.\n\n    \u001b[7m12\u001b[0m import { validateBotToken, isPortInUse } from '@/bot'\n    \u001b[7m  \u001b[0m \u001b[91m                           ~~~~~~~~~~~\u001b[0m\n\n      \u001b[96msrc/bot.ts\u001b[0m:\u001b[93m41\u001b[0m:\u001b[93m16\u001b[0m\n        \u001b[7m41\u001b[0m async function isPortInUse(port: number): Promise<boolean> {\n        \u001b[7m  \u001b[0m \u001b[96m               ~~~~~~~~~~~\u001b[0m\n        'isPortInUse' is declared here.\n    \u001b[96m__tests__/bot.test.ts\u001b[0m:\u001b[93m24\u001b[0m:\u001b[93m6\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2448: \u001b[0mBlock-scoped variable 'Telegraf' used before its declaration.\n\n    \u001b[7m24\u001b[0m     (Telegraf as jest.Mock).mockImplementationOnce(() => ({\n    \u001b[7m  \u001b[0m \u001b[91m     ~~~~~~~~\u001b[0m\n\n      \u001b[96m__tests__/bot.test.ts\u001b[0m:\u001b[93m23\u001b[0m:\u001b[93m13\u001b[0m\n        \u001b[7m23\u001b[0m     const { Telegraf } = require('telegraf')\n        \u001b[7m  \u001b[0m \u001b[96m            ~~~~~~~~\u001b[0m\n        'Telegraf' is declared here.\n","testResults":[]}],"config":{"bail":0,"changedFilesWithAncestor":false,"ci":false,"collectCoverage":false,"collectCoverageFrom":[],"coverageDirectory":"/Users/playom/999-multibots-telegraf/coverage","coverageProvider":"babel","coverageReporters":["json","text","lcov","clover"],"detectLeaks":false,"detectOpenHandles":true,"errorOnDeprecated":false,"expand":false,"findRelatedTests":false,"forceExit":true,"json":false,"lastCommit":false,"listTests":false,"logHeapUsage":false,"maxConcurrency":5,"maxWorkers":1,"noStackTrace":false,"nonFlagArgs":[],"notify":false,"notifyMode":"failure-change","onlyChanged":false,"onlyFailures":false,"openHandlesTimeout":1000,"passWithNoTests":false,"projects":[],"reporters":[["default",{}],["/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-html-reporters@3.1.7/node_modules/jest-html-reporters/index.js",{"publicPath":"./html-report","filename":"report.html","expand":true}]],"rootDir":"/Users/playom/999-multibots-telegraf","runTestsByPath":false,"seed":-772030887,"silent":true,"skipFilter":false,"snapshotFormat":{"escapeString":false,"printBasicPrototype":false},"testFailureExitCode":1,"testPathPattern":"","testSequencer":"/Users/playom/999-multibots-telegraf/node_modules/.pnpm/@jest+test-sequencer@29.7.0/node_modules/@jest/test-sequencer/build/index.js","updateSnapshot":"new","useStderr":false,"watch":false,"watchAll":false,"watchman":true,"workerThreads":false},"endTime":1745168611350,"_reporterOptions":{"publicPath":"./html-report","filename":"report.html","expand":true,"pageTitle":"","hideIcon":false,"testCommand":"","openReport":false,"failureMessageOnly":0,"enableMergeData":false,"dataMergeLevel":1,"inlineSource":false,"urlForTestFiles":"","darkTheme":false,"includeConsoleLog":false,"stripSkippedTest":false},"logInfoMapping":{},"attachInfos":{}})