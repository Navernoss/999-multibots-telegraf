window.jest_html_reporters_callback__({"numFailedTestSuites":143,"numFailedTests":182,"numPassedTestSuites":146,"numPassedTests":535,"numPendingTestSuites":0,"numPendingTests":0,"numRuntimeErrorTestSuites":74,"numTodoTests":0,"numTotalTestSuites":289,"numTotalTests":717,"startTime":1745171884278,"success":false,"testResults":[{"numFailingTests":10,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171892702,"runtime":7465,"slow":true,"start":1745171885237},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mcheckPaymentStatus › returns false if ctx or ctx.from.id is missing\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\n    Expected: \u001b[32mfalse\u001b[39m\n    Received: \u001b[31mnull\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 69 |\u001b[39m   it(\u001b[32m'returns false if ctx or ctx.from.id is missing'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[22m\n\u001b[2m     \u001b[90m 70 |\u001b[39m     \u001b[36mconst\u001b[39m result \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m checkPaymentStatus({}\u001b[33m,\u001b[39m \u001b[32m'basic'\u001b[39m)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 71 |\u001b[39m     expect(result)\u001b[33m.\u001b[39mtoBe(\u001b[36mfalse\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                    \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 72 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 73 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 74 |\u001b[39m   it(\u001b[32m'returns false when payment query errors'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/checkPaymentStatus.test.ts\u001b[39m\u001b[0m\u001b[2m:71:20)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/checkPaymentStatus.test.ts\u001b[39m\u001b[0m\u001b[2m:4:58)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mcheckPaymentStatus › returns false when payment query errors\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32m\"payments\"\u001b[39m\n\n    Number of calls: \u001b[31m0\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 75 |\u001b[39m     mockSinglePayments\u001b[33m.\u001b[39mmockResolvedValueOnce({ data\u001b[33m:\u001b[39m \u001b[36mnull\u001b[39m\u001b[33m,\u001b[39m error\u001b[33m:\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(\u001b[32m'fail'\u001b[39m) })\u001b[22m\n\u001b[2m     \u001b[90m 76 |\u001b[39m     \u001b[36mconst\u001b[39m result \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m checkPaymentStatus(ctx\u001b[33m,\u001b[39m \u001b[32m'basic'\u001b[39m)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 77 |\u001b[39m     expect(mockFromPayments)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[32m'payments'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                              \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 78 |\u001b[39m     expect(result)\u001b[33m.\u001b[39mtoBe(\u001b[36mfalse\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 79 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 80 |\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/checkPaymentStatus.test.ts\u001b[39m\u001b[0m\u001b[2m:77:30)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/checkPaymentStatus.test.ts\u001b[39m\u001b[0m\u001b[2m:4:58)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mcheckPaymentStatus › returns true and updates subscription when last payment older than 30 days\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\n    Expected: \u001b[32mtrue\u001b[39m\n    Received: \u001b[31mnull\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 84 |\u001b[39m     mockSinglePayments\u001b[33m.\u001b[39mmockResolvedValueOnce({ data\u001b[33m:\u001b[39m { payment_date\u001b[33m:\u001b[39m oldDate }\u001b[33m,\u001b[39m error\u001b[33m:\u001b[39m \u001b[36mnull\u001b[39m })\u001b[22m\n\u001b[2m     \u001b[90m 85 |\u001b[39m     \u001b[36mconst\u001b[39m result \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m checkPaymentStatus(ctx\u001b[33m,\u001b[39m \u001b[32m'basic'\u001b[39m)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 86 |\u001b[39m     expect(result)\u001b[33m.\u001b[39mtoBe(\u001b[36mtrue\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                    \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 87 |\u001b[39m     expect(mockFromUsers)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[32m'users'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 88 |\u001b[39m     expect(mockUpdateUsers)\u001b[33m.\u001b[39mtoHaveBeenCalledWith({ subscription\u001b[33m:\u001b[39m \u001b[32m'stars'\u001b[39m })\u001b[22m\n\u001b[2m     \u001b[90m 89 |\u001b[39m     expect(mockEqUsers)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[32m'telegram_id'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'42'\u001b[39m)\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/checkPaymentStatus.test.ts\u001b[39m\u001b[0m\u001b[2m:86:20)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/checkPaymentStatus.test.ts\u001b[39m\u001b[0m\u001b[2m:4:58)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mcheckPaymentStatus › returns false and replies when last payment within 30 days and full access\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\n    Expected: \u001b[32mfalse\u001b[39m\n    Received: \u001b[31mnull\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m  97 |\u001b[39m     process\u001b[33m.\u001b[39menv\u001b[33m.\u001b[39m\u001b[33mNODE_ENV\u001b[39m \u001b[33m=\u001b[39m \u001b[32m'production'\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m  98 |\u001b[39m     \u001b[36mconst\u001b[39m result \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m checkPaymentStatus(ctx\u001b[33m,\u001b[39m \u001b[32m'basic'\u001b[39m)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m  99 |\u001b[39m     expect(result)\u001b[33m.\u001b[39mtoBe(\u001b[36mfalse\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                    \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 100 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mreply)\u001b[33m.\u001b[39mtoHaveBeenCalled()\u001b[22m\n\u001b[2m     \u001b[90m 101 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 102 |\u001b[39m   \u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/checkPaymentStatus.test.ts\u001b[39m\u001b[0m\u001b[2m:99:20)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/checkPaymentStatus.test.ts\u001b[39m\u001b[0m\u001b[2m:4:58)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mcheckPaymentStatus › replies English message when subscription expired and not Russian\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32m\"🤑Your subscription has expired. Please update your subscription to continue using the service.\"\u001b[39m\n\n    Number of calls: \u001b[31m0\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 112 |\u001b[39m     process\u001b[33m.\u001b[39menv\u001b[33m.\u001b[39m\u001b[33mNODE_ENV\u001b[39m \u001b[33m=\u001b[39m \u001b[32m'production'\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 113 |\u001b[39m     \u001b[36mawait\u001b[39m checkPaymentStatus(ctx\u001b[33m,\u001b[39m \u001b[32m'basic'\u001b[39m)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 114 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mreply)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 115 |\u001b[39m       \u001b[32m'🤑Your subscription has expired. Please update your subscription to continue using the service.'\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 116 |\u001b[39m     )\u001b[22m\n\u001b[2m     \u001b[90m 117 |\u001b[39m   })\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/checkPaymentStatus.test.ts\u001b[39m\u001b[0m\u001b[2m:114:23)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/checkPaymentStatus.test.ts\u001b[39m\u001b[0m\u001b[2m:4:58)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mcheckPaymentStatus › returns true and updates when recent payment but no full access\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\n    Expected: \u001b[32mtrue\u001b[39m\n    Received: \u001b[31mnull\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 125 |\u001b[39m     cf\u001b[33m.\u001b[39mmockReturnValue(\u001b[36mfalse\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 126 |\u001b[39m     \u001b[36mconst\u001b[39m result \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m checkPaymentStatus(ctx\u001b[33m,\u001b[39m \u001b[32m'basic'\u001b[39m)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 127 |\u001b[39m     expect(result)\u001b[33m.\u001b[39mtoBe(\u001b[36mtrue\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                    \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 128 |\u001b[39m     expect(mockFromUsers)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[32m'users'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 129 |\u001b[39m     expect(mockUpdateUsers)\u001b[33m.\u001b[39mtoHaveBeenCalledWith({ subscription\u001b[33m:\u001b[39m \u001b[32m'stars'\u001b[39m })\u001b[22m\n\u001b[2m     \u001b[90m 130 |\u001b[39m   })\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/checkPaymentStatus.test.ts\u001b[39m\u001b[0m\u001b[2m:127:20)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/checkPaymentStatus.test.ts\u001b[39m\u001b[0m\u001b[2m:4:58)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mcheckPaymentStatus › returns false without reply when in development environment\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\n    Expected: \u001b[32mfalse\u001b[39m\n    Received: \u001b[31mnull\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 140 |\u001b[39m     process\u001b[33m.\u001b[39menv\u001b[33m.\u001b[39m\u001b[33mNODE_ENV\u001b[39m \u001b[33m=\u001b[39m \u001b[32m'development'\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 141 |\u001b[39m     \u001b[36mconst\u001b[39m result \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m checkPaymentStatus(ctx\u001b[33m,\u001b[39m \u001b[32m'basic'\u001b[39m)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 142 |\u001b[39m     expect(result)\u001b[33m.\u001b[39mtoBe(\u001b[36mfalse\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                    \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 143 |\u001b[39m     \u001b[90m// Reply should NOT be called in dev\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 144 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mreply)\u001b[33m.\u001b[39mnot\u001b[33m.\u001b[39mtoHaveBeenCalled()\u001b[22m\n\u001b[2m     \u001b[90m 145 |\u001b[39m   })\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/checkPaymentStatus.test.ts\u001b[39m\u001b[0m\u001b[2m:142:20)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/checkPaymentStatus.test.ts\u001b[39m\u001b[0m\u001b[2m:4:58)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mcheckPaymentStatus › does not reply when subscription is neurotester\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\n    Expected: \u001b[32mfalse\u001b[39m\n    Received: \u001b[31mnull\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 155 |\u001b[39m     process\u001b[33m.\u001b[39menv\u001b[33m.\u001b[39m\u001b[33mNODE_ENV\u001b[39m \u001b[33m=\u001b[39m \u001b[32m'production'\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 156 |\u001b[39m     \u001b[36mconst\u001b[39m result \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m checkPaymentStatus(ctx\u001b[33m,\u001b[39m \u001b[32m'neurotester'\u001b[39m)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 157 |\u001b[39m     expect(result)\u001b[33m.\u001b[39mtoBe(\u001b[36mfalse\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                    \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 158 |\u001b[39m     \u001b[90m// Should not reply for 'neurotester'\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 159 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mreply)\u001b[33m.\u001b[39mnot\u001b[33m.\u001b[39mtoHaveBeenCalled()\u001b[22m\n\u001b[2m     \u001b[90m 160 |\u001b[39m   })\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/checkPaymentStatus.test.ts\u001b[39m\u001b[0m\u001b[2m:157:20)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/checkPaymentStatus.test.ts\u001b[39m\u001b[0m\u001b[2m:4:58)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mcheckPaymentStatus › logs error and returns true when updateError present\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\n    Expected: \u001b[32mtrue\u001b[39m\n    Received: \u001b[31mnull\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 168 |\u001b[39m     \u001b[36mconst\u001b[39m errorSpy \u001b[33m=\u001b[39m jest\u001b[33m.\u001b[39mspyOn(console\u001b[33m,\u001b[39m \u001b[32m'error'\u001b[39m)\u001b[33m.\u001b[39mmockImplementation(() \u001b[33m=>\u001b[39m {})\u001b[22m\n\u001b[2m     \u001b[90m 169 |\u001b[39m     \u001b[36mconst\u001b[39m result \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m checkPaymentStatus(ctx\u001b[33m,\u001b[39m \u001b[32m'basic'\u001b[39m)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 170 |\u001b[39m     expect(result)\u001b[33m.\u001b[39mtoBe(\u001b[36mtrue\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                    \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 171 |\u001b[39m     expect(errorSpy)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[22m\n\u001b[2m     \u001b[90m 172 |\u001b[39m       \u001b[32m'Ошибка при обновлении уровня подписки:'\u001b[39m\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 173 |\u001b[39m       expect\u001b[33m.\u001b[39many(\u001b[33mError\u001b[39m)\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/checkPaymentStatus.test.ts\u001b[39m\u001b[0m\u001b[2m:170:20)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/checkPaymentStatus.test.ts\u001b[39m\u001b[0m\u001b[2m:4:58)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mcheckPaymentStatus › logs error and returns false when update throws exception\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\n    Expected: \u001b[32mfalse\u001b[39m\n    Received: \u001b[31mnull\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 184 |\u001b[39m     \u001b[36mconst\u001b[39m errorSpy \u001b[33m=\u001b[39m jest\u001b[33m.\u001b[39mspyOn(console\u001b[33m,\u001b[39m \u001b[32m'error'\u001b[39m)\u001b[33m.\u001b[39mmockImplementation(() \u001b[33m=>\u001b[39m {})\u001b[22m\n\u001b[2m     \u001b[90m 185 |\u001b[39m     \u001b[36mconst\u001b[39m result \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m checkPaymentStatus(ctx\u001b[33m,\u001b[39m \u001b[32m'basic'\u001b[39m)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 186 |\u001b[39m     expect(result)\u001b[33m.\u001b[39mtoBe(\u001b[36mfalse\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                    \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 187 |\u001b[39m     expect(errorSpy)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[32m'Ошибка при проверке статуса оплаты:'\u001b[39m\u001b[33m,\u001b[39m expect\u001b[33m.\u001b[39many(\u001b[33mError\u001b[39m))\u001b[22m\n\u001b[2m     \u001b[90m 188 |\u001b[39m     errorSpy\u001b[33m.\u001b[39mmockRestore()\u001b[22m\n\u001b[2m     \u001b[90m 189 |\u001b[39m   })\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/checkPaymentStatus.test.ts\u001b[39m\u001b[0m\u001b[2m:186:20)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/checkPaymentStatus.test.ts\u001b[39m\u001b[0m\u001b[2m:4:58)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["checkPaymentStatus"],"duration":17,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32mfalse\u001b[39m\nReceived: \u001b[31mnull\u001b[39m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:71:20)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"checkPaymentStatus returns false if ctx or ctx.from.id is missing","status":"failed","title":"returns false if ctx or ctx.from.id is missing"},{"ancestorTitles":["checkPaymentStatus"],"duration":2,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m\"payments\"\u001b[39m\n\nNumber of calls: \u001b[31m0\u001b[39m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:77:30)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"checkPaymentStatus returns false when payment query errors","status":"failed","title":"returns false when payment query errors"},{"ancestorTitles":["checkPaymentStatus"],"duration":10,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32mtrue\u001b[39m\nReceived: \u001b[31mnull\u001b[39m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:86:20)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"checkPaymentStatus returns true and updates subscription when last payment older than 30 days","status":"failed","title":"returns true and updates subscription when last payment older than 30 days"},{"ancestorTitles":["checkPaymentStatus"],"duration":3,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32mfalse\u001b[39m\nReceived: \u001b[31mnull\u001b[39m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:99:20)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"checkPaymentStatus returns false and replies when last payment within 30 days and full access","status":"failed","title":"returns false and replies when last payment within 30 days and full access"},{"ancestorTitles":["checkPaymentStatus"],"duration":4,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m\"🤑Your subscription has expired. Please update your subscription to continue using the service.\"\u001b[39m\n\nNumber of calls: \u001b[31m0\u001b[39m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:114:23)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"checkPaymentStatus replies English message when subscription expired and not Russian","status":"failed","title":"replies English message when subscription expired and not Russian"},{"ancestorTitles":["checkPaymentStatus"],"duration":7,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32mtrue\u001b[39m\nReceived: \u001b[31mnull\u001b[39m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:127:20)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"checkPaymentStatus returns true and updates when recent payment but no full access","status":"failed","title":"returns true and updates when recent payment but no full access"},{"ancestorTitles":["checkPaymentStatus"],"duration":2,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32mfalse\u001b[39m\nReceived: \u001b[31mnull\u001b[39m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:142:20)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"checkPaymentStatus returns false without reply when in development environment","status":"failed","title":"returns false without reply when in development environment"},{"ancestorTitles":["checkPaymentStatus"],"duration":4,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32mfalse\u001b[39m\nReceived: \u001b[31mnull\u001b[39m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:157:20)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"checkPaymentStatus does not reply when subscription is neurotester","status":"failed","title":"does not reply when subscription is neurotester"},{"ancestorTitles":["checkPaymentStatus"],"duration":2,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32mtrue\u001b[39m\nReceived: \u001b[31mnull\u001b[39m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:170:20)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"checkPaymentStatus logs error and returns true when updateError present","status":"failed","title":"logs error and returns true when updateError present"},{"ancestorTitles":["checkPaymentStatus"],"duration":1,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32mfalse\u001b[39m\nReceived: \u001b[31mnull\u001b[39m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:186:20)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"checkPaymentStatus logs error and returns false when update throws exception","status":"failed","title":"logs error and returns false when update throws exception"}]},{"numFailingTests":5,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171894940,"runtime":9720,"slow":true,"start":1745171885220},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/scenes/improvePromptWizard.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mimprovePromptWizard › step 0: missing ctx.from leaves scene\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32m\"User identification error\"\u001b[39m\n\n    Number of calls: \u001b[31m0\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 50 |\u001b[39m     \u001b[36mconst\u001b[39m step0 \u001b[33m=\u001b[39m \u001b[33mComposer\u001b[39m\u001b[33m.\u001b[39munwrap(improvePromptWizard\u001b[33m.\u001b[39msteps[\u001b[35m0\u001b[39m])\u001b[22m\n\u001b[2m     \u001b[90m 51 |\u001b[39m     \u001b[36mawait\u001b[39m step0(ctx\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {})\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 52 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mreply)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[32m'User identification error'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 53 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mscene\u001b[33m.\u001b[39mleave)\u001b[33m.\u001b[39mtoHaveBeenCalled()\u001b[22m\n\u001b[2m     \u001b[90m 54 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 55 |\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/scenes/improvePromptWizard.test.ts\u001b[39m\u001b[0m\u001b[2m:52:23\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mimprovePromptWizard › step 1: yes generate for neuro_photo\u001b[39m\u001b[22m\n\n    improvePromptWizard: Неизвестный режим\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 153 |\u001b[39m               \u001b[36mbreak\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 154 |\u001b[39m             \u001b[36mdefault\u001b[39m\u001b[33m:\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 155 |\u001b[39m               \u001b[36mthrow\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                     \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 156 |\u001b[39m                 isRu\u001b[22m\n\u001b[2m     \u001b[90m 157 |\u001b[39m                   \u001b[33m?\u001b[39m \u001b[32m'improvePromptWizard: Неизвестный режим'\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 158 |\u001b[39m                   \u001b[33m:\u001b[39m \u001b[32m'improvePromptWizard: Unknown mode'\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2msrc/scenes/improvePromptWizard/index.ts\u001b[2m:155:21\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.__awaiter (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat __awaiter (\u001b[22m\u001b[2msrc/scenes/improvePromptWizard/index.ts\u001b[2m:65:15)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/scenes/improvePromptWizard.test.ts\u001b[39m\u001b[0m\u001b[2m:121:11\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.__awaiter (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/scenes/improvePromptWizard.test.ts\u001b[39m\u001b[0m\u001b[2m:110:57)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mimprovePromptWizard › should navigate to menuScene if no mode in session\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32m\"An error occurred.\"\u001b[39m\n\n    Number of calls: \u001b[31m0\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 141 |\u001b[39m     \u001b[36mconst\u001b[39m step1 \u001b[33m=\u001b[39m \u001b[33mComposer\u001b[39m\u001b[33m.\u001b[39munwrap(improvePromptWizard\u001b[33m.\u001b[39msteps[\u001b[35m1\u001b[39m])\u001b[22m\n\u001b[2m     \u001b[90m 142 |\u001b[39m     \u001b[36mawait\u001b[39m step1(ctx\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {})\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 143 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mreply)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[32m'An error occurred.'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 144 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mscene\u001b[33m.\u001b[39mleave)\u001b[33m.\u001b[39mtoHaveBeenCalled()\u001b[22m\n\u001b[2m     \u001b[90m 145 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 146 |\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/scenes/improvePromptWizard.test.ts\u001b[39m\u001b[0m\u001b[2m:143:23\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mimprovePromptWizard › should navigate to menuScene if userModel not in session\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32m\"An error occurred.\"\u001b[39m\n\n    Number of calls: \u001b[31m0\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 155 |\u001b[39m     \u001b[36mconst\u001b[39m step1 \u001b[33m=\u001b[39m \u001b[33mComposer\u001b[39m\u001b[33m.\u001b[39munwrap(improvePromptWizard\u001b[33m.\u001b[39msteps[\u001b[35m1\u001b[39m])\u001b[22m\n\u001b[2m     \u001b[90m 156 |\u001b[39m     \u001b[36mawait\u001b[39m step1(ctx\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {})\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 157 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mreply)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[32m'An error occurred.'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 158 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mscene\u001b[33m.\u001b[39mleave)\u001b[33m.\u001b[39mtoHaveBeenCalled()\u001b[22m\n\u001b[2m     \u001b[90m 159 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 160 |\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/scenes/improvePromptWizard.test.ts\u001b[39m\u001b[0m\u001b[2m:157:23\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mimprovePromptWizard › should call generateImageFromPrompt for neuro_photo mode (RU)\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32m{\"answerCbQuery\": [Function mockConstructor], \"answerPreCheckoutQuery\": [Function mockConstructor], \"callback_query\": undefined, \"chat\": {\"first_name\": \"Test\", \"id\": 12345, \"type\": \"private\", \"username\": \"testuser\"}, \"debug\": {\"currentScene\": \"\", \"replies\": [], \"replyMessages\": [Function replyMessages]}, \"from\": {\"first_name\": \"Test\", \"id\": 1, \"is_bot\": false, \"language_code\": \"ru\", \"username\": \"u\"}, \"match\": [Function mockConstructor], \"message\": {\"chat\": {\"first_name\": \"Test\", \"id\": 12345, \"type\": \"private\", \"username\": \"testuser\"}, \"date\": 1745171894.892, \"from\": {\"first_name\": \"Test\", \"id\": 1, \"is_bot\": false, \"language_code\": \"ru\", \"username\": \"u\"}, \"message_id\": 1, \"text\": \"any\"}, \"reply\": [Function mockConstructor], \"replyWithInvoice\": [Function mockConstructor], \"replyWithPhoto\": [Function mockConstructor], \"scene\": {\"enter\": [Function mockConstructor], \"leave\": [Function mockConstructor], \"reenter\": [Function mockConstructor], \"session\": {\"state\": {}}}, \"session\": {\"mode\": \"neuro_photo_v2\", \"prompt\": \"pr\", \"userModel\": {\"model_name\": \"test_model\", \"model_url\": \"a/b:c\", \"trigger_word\": \"test_trigger\"}}, \"telegram\": {\"callApi\": [Function mockConstructor], \"sendChatAction\": [Function mockConstructor], \"sendMessage\": [Function mockConstructor], \"token\": \"mock_token\"}, \"update\": {\"message\": {\"chat\": {\"first_name\": \"Test\", \"id\": 12345, \"type\": \"private\", \"username\": \"testuser\"}, \"date\": 1745171894.892, \"from\": {\"first_name\": \"Test\", \"id\": 1, \"is_bot\": false, \"language_code\": \"ru\", \"username\": \"u\"}, \"message_id\": 1, \"text\": \"any\"}, \"update_id\": 1}, \"wizard\": {\"back\": [Function mockConstructor], \"cursor\": 0, \"next\": [Function mockConstructor], \"state\": {}, \"steps\": []}}\u001b[39m, \u001b[32m\"a/b:c\"\u001b[39m, \u001b[32m\"pr\"\u001b[39m, \u001b[32mtrue\u001b[39m\n\n    Number of calls: \u001b[31m0\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 172 |\u001b[39m     \u001b[36mconst\u001b[39m step1 \u001b[33m=\u001b[39m \u001b[33mComposer\u001b[39m\u001b[33m.\u001b[39munwrap(improvePromptWizard\u001b[33m.\u001b[39msteps[\u001b[35m1\u001b[39m])\u001b[22m\n\u001b[2m     \u001b[90m 173 |\u001b[39m     \u001b[36mawait\u001b[39m step1(ctx\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {})\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 174 |\u001b[39m     expect(generateImageFromPrompt)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                                     \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 175 |\u001b[39m       ctx\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 176 |\u001b[39m       \u001b[32m'a/b:c'\u001b[39m\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 177 |\u001b[39m       \u001b[32m'pr'\u001b[39m\u001b[33m,\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/scenes/improvePromptWizard.test.ts\u001b[39m\u001b[0m\u001b[2m:174:37\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["improvePromptWizard"],"duration":8,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m\"User identification error\"\u001b[39m\n\nNumber of calls: \u001b[31m0\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/scenes/improvePromptWizard.test.ts:52:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"improvePromptWizard step 0: missing ctx.from leaves scene","status":"failed","title":"step 0: missing ctx.from leaves scene"},{"ancestorTitles":["improvePromptWizard"],"duration":4,"failureMessages":[],"fullName":"improvePromptWizard step 0: upgradePrompt fails -> failure message and leave","status":"passed","title":"step 0: upgradePrompt fails -> failure message and leave"},{"ancestorTitles":["improvePromptWizard"],"duration":25,"failureMessages":[],"fullName":"improvePromptWizard step 0: upgradePrompt succeeds -> reply improved and next","status":"passed","title":"step 0: upgradePrompt succeeds -> reply improved and next"},{"ancestorTitles":["improvePromptWizard"],"duration":0,"failureMessages":[],"fullName":"improvePromptWizard step 1: no message leaves scene","status":"passed","title":"step 1: no message leaves scene"},{"ancestorTitles":["improvePromptWizard"],"duration":8,"failureMessages":[],"fullName":"improvePromptWizard step 1: cancel case","status":"passed","title":"step 1: cancel case"},{"ancestorTitles":["improvePromptWizard"],"duration":16,"failureMessages":["Error: improvePromptWizard: Неизвестный режим\n    at /Users/playra/999-multibots-telegraf/src/scenes/improvePromptWizard/index.ts:155:21\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at __awaiter (/Users/playra/999-multibots-telegraf/src/scenes/improvePromptWizard/index.ts:65:15)\n    at /Users/playra/999-multibots-telegraf/__tests__/scenes/improvePromptWizard.test.ts:121:11\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/scenes/improvePromptWizard.test.ts:110:57)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"improvePromptWizard step 1: yes generate for neuro_photo","status":"failed","title":"step 1: yes generate for neuro_photo"},{"ancestorTitles":["improvePromptWizard"],"duration":1,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m\"An error occurred.\"\u001b[39m\n\nNumber of calls: \u001b[31m0\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/scenes/improvePromptWizard.test.ts:143:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"improvePromptWizard should navigate to menuScene if no mode in session","status":"failed","title":"should navigate to menuScene if no mode in session"},{"ancestorTitles":["improvePromptWizard"],"duration":6,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m\"An error occurred.\"\u001b[39m\n\nNumber of calls: \u001b[31m0\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/scenes/improvePromptWizard.test.ts:157:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"improvePromptWizard should navigate to menuScene if userModel not in session","status":"failed","title":"should navigate to menuScene if userModel not in session"},{"ancestorTitles":["improvePromptWizard"],"duration":16,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m{\"answerCbQuery\": [Function mockConstructor], \"answerPreCheckoutQuery\": [Function mockConstructor], \"callback_query\": undefined, \"chat\": {\"first_name\": \"Test\", \"id\": 12345, \"type\": \"private\", \"username\": \"testuser\"}, \"debug\": {\"currentScene\": \"\", \"replies\": [], \"replyMessages\": [Function replyMessages]}, \"from\": {\"first_name\": \"Test\", \"id\": 1, \"is_bot\": false, \"language_code\": \"ru\", \"username\": \"u\"}, \"match\": [Function mockConstructor], \"message\": {\"chat\": {\"first_name\": \"Test\", \"id\": 12345, \"type\": \"private\", \"username\": \"testuser\"}, \"date\": 1745171894.892, \"from\": {\"first_name\": \"Test\", \"id\": 1, \"is_bot\": false, \"language_code\": \"ru\", \"username\": \"u\"}, \"message_id\": 1, \"text\": \"any\"}, \"reply\": [Function mockConstructor], \"replyWithInvoice\": [Function mockConstructor], \"replyWithPhoto\": [Function mockConstructor], \"scene\": {\"enter\": [Function mockConstructor], \"leave\": [Function mockConstructor], \"reenter\": [Function mockConstructor], \"session\": {\"state\": {}}}, \"session\": {\"mode\": \"neuro_photo_v2\", \"prompt\": \"pr\", \"userModel\": {\"model_name\": \"test_model\", \"model_url\": \"a/b:c\", \"trigger_word\": \"test_trigger\"}}, \"telegram\": {\"callApi\": [Function mockConstructor], \"sendChatAction\": [Function mockConstructor], \"sendMessage\": [Function mockConstructor], \"token\": \"mock_token\"}, \"update\": {\"message\": {\"chat\": {\"first_name\": \"Test\", \"id\": 12345, \"type\": \"private\", \"username\": \"testuser\"}, \"date\": 1745171894.892, \"from\": {\"first_name\": \"Test\", \"id\": 1, \"is_bot\": false, \"language_code\": \"ru\", \"username\": \"u\"}, \"message_id\": 1, \"text\": \"any\"}, \"update_id\": 1}, \"wizard\": {\"back\": [Function mockConstructor], \"cursor\": 0, \"next\": [Function mockConstructor], \"state\": {}, \"steps\": []}}\u001b[39m, \u001b[32m\"a/b:c\"\u001b[39m, \u001b[32m\"pr\"\u001b[39m, \u001b[32mtrue\u001b[39m\n\nNumber of calls: \u001b[31m0\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/scenes/improvePromptWizard.test.ts:174:37\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"improvePromptWizard should call generateImageFromPrompt for neuro_photo mode (RU)","status":"failed","title":"should call generateImageFromPrompt for neuro_photo mode (RU)"}]},{"numFailingTests":1,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171895356,"runtime":10261,"slow":true,"start":1745171885095},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/handlers/registerPaymentActions.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mregisterPaymentActions › registers top_up regex action\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32m/top_up_\\d+/\u001b[39m, \u001b[32m[Function handleTopUp]\u001b[39m\n    Received\n           1: \u001b[31m\"payment_policy_info\"\u001b[39m, \u001b[31m[Function handlePaymentPolicyInfo]\u001b[39m\n           2: \u001b[31m\"payment_policy_info\"\u001b[39m, \u001b[31m[Function handlePaymentPolicyInfo]\u001b[39m\n\n    Number of calls: \u001b[31m2\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 18 |\u001b[39m   it(\u001b[32m'registers top_up regex action'\u001b[39m\u001b[33m,\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[22m\n\u001b[2m     \u001b[90m 19 |\u001b[39m     registerPaymentActions(bot)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 20 |\u001b[39m     expect(bot\u001b[33m.\u001b[39maction)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[35m/top_up_\\d+/\u001b[39m\u001b[33m,\u001b[39m handleTopUp)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 21 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 22 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 23 |\u001b[39m   it(\u001b[32m'registers pre_checkout_query and successful_payment handlers'\u001b[39m\u001b[33m,\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/handlers/registerPaymentActions.test.ts\u001b[39m\u001b[0m\u001b[2m:20:24)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["registerPaymentActions"],"duration":4,"failureMessages":[],"fullName":"registerPaymentActions registers payment policy info action","status":"passed","title":"registers payment policy info action"},{"ancestorTitles":["registerPaymentActions"],"duration":2,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m/top_up_\\d+/\u001b[39m, \u001b[32m[Function handleTopUp]\u001b[39m\nReceived\n       1: \u001b[31m\"payment_policy_info\"\u001b[39m, \u001b[31m[Function handlePaymentPolicyInfo]\u001b[39m\n       2: \u001b[31m\"payment_policy_info\"\u001b[39m, \u001b[31m[Function handlePaymentPolicyInfo]\u001b[39m\n\nNumber of calls: \u001b[31m2\u001b[39m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/handlers/registerPaymentActions.test.ts:20:24)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"registerPaymentActions registers top_up regex action","status":"failed","title":"registers top_up regex action"},{"ancestorTitles":["registerPaymentActions"],"duration":1,"failureMessages":[],"fullName":"registerPaymentActions registers pre_checkout_query and successful_payment handlers","status":"passed","title":"registers pre_checkout_query and successful_payment handlers"}]},{"numFailingTests":7,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171895397,"runtime":10279,"slow":true,"start":1745171885118},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/payments/paymentScene.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mPayment Scene › should enter the scene and show payment options for RU user\u001b[39m\u001b[22m\n\n    next(ctx) called with invalid context\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 66 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 67 |\u001b[39m   it(\u001b[32m'should enter the scene and show payment options for RU user'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 68 |\u001b[39m     \u001b[36mawait\u001b[39m paymentScene\u001b[33m.\u001b[39menterMiddleware()(ctx\u001b[33m,\u001b[39m jest\u001b[33m.\u001b[39mfn())\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                         \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 69 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 70 |\u001b[39m     expect(replyMock)\u001b[33m.\u001b[39mtoHaveBeenCalledTimes(\u001b[35m1\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 71 |\u001b[39m     expect(replyMock)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat execute (\u001b[22m\u001b[2mnode_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js\u001b[2m:511:27)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js\u001b[2m:507:20\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/payments/paymentScene.test.ts\u001b[39m\u001b[0m\u001b[2m:68:41\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.__awaiter (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/payments/paymentScene.test.ts\u001b[39m\u001b[0m\u001b[2m:67:80)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mPayment Scene › should enter the scene and show payment options for EN user\u001b[39m\u001b[22m\n\n    next(ctx) called with invalid context\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m  98 |\u001b[39m   it(\u001b[32m'should enter the scene and show payment options for EN user'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[22m\n\u001b[2m     \u001b[90m  99 |\u001b[39m     mockedIsRussian\u001b[33m.\u001b[39mmockReturnValue(\u001b[36mfalse\u001b[39m)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 100 |\u001b[39m     \u001b[36mawait\u001b[39m paymentScene\u001b[33m.\u001b[39menterMiddleware()(ctx\u001b[33m,\u001b[39m jest\u001b[33m.\u001b[39mfn())\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                                         \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 101 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 102 |\u001b[39m     expect(replyMock)\u001b[33m.\u001b[39mtoHaveBeenCalledTimes(\u001b[35m1\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 103 |\u001b[39m     expect(replyMock)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat execute (\u001b[22m\u001b[2mnode_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js\u001b[2m:511:27)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js\u001b[2m:507:20\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/payments/paymentScene.test.ts\u001b[39m\u001b[0m\u001b[2m:100:41\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.__awaiter (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/payments/paymentScene.test.ts\u001b[39m\u001b[0m\u001b[2m:98:80)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mPayment Scene › should handle \"⭐️ Звездами\" and enter StarPaymentScene\u001b[39m\u001b[22m\n\n    next(ctx) called with invalid context\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 145 |\u001b[39m     \u001b[90m// We rely on makeMockContext to provide ctx.scene\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 146 |\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 147 |\u001b[39m     \u001b[36mawait\u001b[39m paymentScene\u001b[33m.\u001b[39mmiddleware()(ctx\u001b[33m,\u001b[39m jest\u001b[33m.\u001b[39mfn())\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                                    \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 148 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mscene\u001b[33m.\u001b[39menter)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[33mModeEnum\u001b[39m\u001b[33m.\u001b[39m\u001b[33mStarPaymentScene\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 149 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 150 |\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat execute (\u001b[22m\u001b[2mnode_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js\u001b[2m:511:27)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js\u001b[2m:507:20\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/payments/paymentScene.test.ts\u001b[39m\u001b[0m\u001b[2m:147:36\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.__awaiter (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/payments/paymentScene.test.ts\u001b[39m\u001b[0m\u001b[2m:126:75)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mPayment Scene › should handle \"💳 Рублями\" and enter RublePaymentScene\u001b[39m\u001b[22m\n\n    next(ctx) called with invalid context\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 170 |\u001b[39m     \u001b[90m// We rely on makeMockContext to provide ctx.scene\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 171 |\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 172 |\u001b[39m     \u001b[36mawait\u001b[39m paymentScene\u001b[33m.\u001b[39mmiddleware()(ctx\u001b[33m,\u001b[39m jest\u001b[33m.\u001b[39mfn())\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                                    \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 173 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mscene\u001b[33m.\u001b[39menter)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[33mModeEnum\u001b[39m\u001b[33m.\u001b[39m\u001b[33mRublePaymentScene\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 174 |\u001b[39m     expect(mockedLogger\u001b[33m.\u001b[39minfo)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[22m\n\u001b[2m     \u001b[90m 175 |\u001b[39m       expect\u001b[33m.\u001b[39mstringContaining(\u001b[32m'User chose Rubles. Entering'\u001b[39m)\u001b[33m,\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat execute (\u001b[22m\u001b[2mnode_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js\u001b[2m:511:27)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js\u001b[2m:507:20\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/payments/paymentScene.test.ts\u001b[39m\u001b[0m\u001b[2m:172:36\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.__awaiter (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/payments/paymentScene.test.ts\u001b[39m\u001b[0m\u001b[2m:151:75)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mPayment Scene › should handle \"🏠 Главное меню\" and enter MenuScene\u001b[39m\u001b[22m\n\n    next(ctx) called with invalid context\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 199 |\u001b[39m     \u001b[90m// We rely on makeMockContext to provide ctx.scene\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 200 |\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 201 |\u001b[39m     \u001b[36mawait\u001b[39m paymentScene\u001b[33m.\u001b[39mmiddleware()(ctx\u001b[33m,\u001b[39m jest\u001b[33m.\u001b[39mfn())\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                                    \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 202 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mscene\u001b[33m.\u001b[39menter)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[33mModeEnum\u001b[39m\u001b[33m.\u001b[39m\u001b[33mMenuScene\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 203 |\u001b[39m     expect(mockedLogger\u001b[33m.\u001b[39minfo)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[22m\n\u001b[2m     \u001b[90m 204 |\u001b[39m       expect\u001b[33m.\u001b[39mstringContaining(\u001b[32m'Leaving scene via Main Menu button'\u001b[39m)\u001b[33m,\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat execute (\u001b[22m\u001b[2mnode_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js\u001b[2m:511:27)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js\u001b[2m:507:20\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/payments/paymentScene.test.ts\u001b[39m\u001b[0m\u001b[2m:201:36\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.__awaiter (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/payments/paymentScene.test.ts\u001b[39m\u001b[0m\u001b[2m:180:72)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mPayment Scene › should handle unexpected message\u001b[39m\u001b[22m\n\n    next(ctx) called with invalid context\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 231 |\u001b[39m     \u001b[90m// We rely on makeMockContext to provide ctx.scene\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 232 |\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 233 |\u001b[39m     \u001b[36mawait\u001b[39m paymentScene\u001b[33m.\u001b[39mmiddleware()(ctx\u001b[33m,\u001b[39m jest\u001b[33m.\u001b[39mfn())\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                                    \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 234 |\u001b[39m     expect(replyMock)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[22m\n\u001b[2m     \u001b[90m 235 |\u001b[39m       \u001b[32m'Пожалуйста, выберите способ оплаты (⭐️ или 💳) или вернитесь в главное меню.'\u001b[39m\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 236 |\u001b[39m       expect\u001b[33m.\u001b[39many(\u001b[33mObject\u001b[39m)\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat execute (\u001b[22m\u001b[2mnode_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js\u001b[2m:511:27)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js\u001b[2m:507:20\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/payments/paymentScene.test.ts\u001b[39m\u001b[0m\u001b[2m:233:36\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.__awaiter (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/payments/paymentScene.test.ts\u001b[39m\u001b[0m\u001b[2m:210:53)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mPayment Scene › should handle error during enterMiddleware and leave scene\u001b[39m\u001b[22m\n\n    next(ctx) called with invalid context\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 258 |\u001b[39m     })\u001b[22m\n\u001b[2m     \u001b[90m 259 |\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 260 |\u001b[39m     \u001b[36mawait\u001b[39m paymentScene\u001b[33m.\u001b[39menterMiddleware()(ctx\u001b[33m,\u001b[39m jest\u001b[33m.\u001b[39mfn())\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                                         \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 261 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 262 |\u001b[39m     expect(replyMock)\u001b[33m.\u001b[39mtoHaveBeenCalledTimes(\u001b[35m2\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 263 |\u001b[39m     expect(replyMock)\u001b[33m.\u001b[39mtoHaveBeenNthCalledWith(\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat execute (\u001b[22m\u001b[2mnode_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js\u001b[2m:511:27)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js\u001b[2m:507:20\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/payments/paymentScene.test.ts\u001b[39m\u001b[0m\u001b[2m:260:41\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.__awaiter (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/payments/paymentScene.test.ts\u001b[39m\u001b[0m\u001b[2m:246:79)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["Payment Scene"],"duration":5,"failureMessages":["Error: next(ctx) called with invalid context\n    at execute (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:511:27)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:507:20\n    at /Users/playra/999-multibots-telegraf/__tests__/payments/paymentScene.test.ts:68:41\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/payments/paymentScene.test.ts:67:80)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"Payment Scene should enter the scene and show payment options for RU user","status":"failed","title":"should enter the scene and show payment options for RU user"},{"ancestorTitles":["Payment Scene"],"duration":0,"failureMessages":["Error: next(ctx) called with invalid context\n    at execute (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:511:27)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:507:20\n    at /Users/playra/999-multibots-telegraf/__tests__/payments/paymentScene.test.ts:100:41\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/payments/paymentScene.test.ts:98:80)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"Payment Scene should enter the scene and show payment options for EN user","status":"failed","title":"should enter the scene and show payment options for EN user"},{"ancestorTitles":["Payment Scene"],"duration":1,"failureMessages":["Error: next(ctx) called with invalid context\n    at execute (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:511:27)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:507:20\n    at /Users/playra/999-multibots-telegraf/__tests__/payments/paymentScene.test.ts:147:36\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/payments/paymentScene.test.ts:126:75)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"Payment Scene should handle \"⭐️ Звездами\" and enter StarPaymentScene","status":"failed","title":"should handle \"⭐️ Звездами\" and enter StarPaymentScene"},{"ancestorTitles":["Payment Scene"],"duration":1,"failureMessages":["Error: next(ctx) called with invalid context\n    at execute (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:511:27)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:507:20\n    at /Users/playra/999-multibots-telegraf/__tests__/payments/paymentScene.test.ts:172:36\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/payments/paymentScene.test.ts:151:75)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"Payment Scene should handle \"💳 Рублями\" and enter RublePaymentScene","status":"failed","title":"should handle \"💳 Рублями\" and enter RublePaymentScene"},{"ancestorTitles":["Payment Scene"],"duration":1,"failureMessages":["Error: next(ctx) called with invalid context\n    at execute (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:511:27)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:507:20\n    at /Users/playra/999-multibots-telegraf/__tests__/payments/paymentScene.test.ts:201:36\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/payments/paymentScene.test.ts:180:72)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"Payment Scene should handle \"🏠 Главное меню\" and enter MenuScene","status":"failed","title":"should handle \"🏠 Главное меню\" and enter MenuScene"},{"ancestorTitles":["Payment Scene"],"duration":1,"failureMessages":["Error: next(ctx) called with invalid context\n    at execute (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:511:27)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:507:20\n    at /Users/playra/999-multibots-telegraf/__tests__/payments/paymentScene.test.ts:233:36\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/payments/paymentScene.test.ts:210:53)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"Payment Scene should handle unexpected message","status":"failed","title":"should handle unexpected message"},{"ancestorTitles":["Payment Scene"],"duration":1,"failureMessages":["Error: next(ctx) called with invalid context\n    at execute (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:511:27)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:507:20\n    at /Users/playra/999-multibots-telegraf/__tests__/payments/paymentScene.test.ts:260:41\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/payments/paymentScene.test.ts:246:79)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"Payment Scene should handle error during enterMiddleware and leave scene","status":"failed","title":"should handle error during enterMiddleware and leave scene"}]},{"numFailingTests":1,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171895592,"runtime":43,"slow":false,"start":1745171895549},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/middlewares/subscriptionMiddleware.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1msubscriptionMiddleware › calls sendChatAction, enters scene, and calls next\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32m\"subscriptionCheckScene\"\u001b[39m\n    Received: \u001b[31m\"subscription_scene\"\u001b[39m\n\n    Number of calls: \u001b[31m1\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 18 |\u001b[39m     \u001b[36mawait\u001b[39m subscriptionMiddleware(ctx \u001b[36mas\u001b[39m any\u001b[33m,\u001b[39m next)\u001b[22m\n\u001b[2m     \u001b[90m 19 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mtelegram\u001b[33m.\u001b[39msendChatAction)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[35m88\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'typing'\u001b[39m)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 20 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mscene\u001b[33m.\u001b[39menter)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[32m'subscriptionCheckScene'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                             \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 21 |\u001b[39m     expect(next)\u001b[33m.\u001b[39mtoHaveBeenCalled()\u001b[22m\n\u001b[2m     \u001b[90m 22 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 23 |\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/middlewares/subscriptionMiddleware.test.ts\u001b[39m\u001b[0m\u001b[2m:20:29\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["subscriptionMiddleware"],"duration":8,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m\"subscriptionCheckScene\"\u001b[39m\nReceived: \u001b[31m\"subscription_scene\"\u001b[39m\n\nNumber of calls: \u001b[31m1\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/middlewares/subscriptionMiddleware.test.ts:20:29\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"subscriptionMiddleware calls sendChatAction, enters scene, and calls next","status":"failed","title":"calls sendChatAction, enters scene, and calls next"},{"ancestorTitles":["subscriptionMiddleware"],"duration":7,"failureMessages":[],"fullName":"subscriptionMiddleware throws error when next throws","status":"passed","title":"throws error when next throws"}]},{"numFailingTests":2,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171895592,"runtime":76,"slow":false,"start":1745171895516},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/handlers/hearsActions.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mregisterHearsActions › handler for main_menu sets session.mode and enters scene\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32m\"menuScene\"\u001b[39m\n    Received: \u001b[31m\"main_menu\"\u001b[39m\n\n    Number of calls: \u001b[31m1\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 49 |\u001b[39m     \u001b[36mawait\u001b[39m handler(ctx)\u001b[22m\n\u001b[2m     \u001b[90m 50 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39msession\u001b[33m.\u001b[39mmode)\u001b[33m.\u001b[39mtoBe(\u001b[33mModeEnum\u001b[39m\u001b[33m.\u001b[39m\u001b[33mMainMenu\u001b[39m)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 51 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mscene\u001b[33m.\u001b[39menter)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[33mModeEnum\u001b[39m\u001b[33m.\u001b[39m\u001b[33mMenuScene\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                             \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 52 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 53 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 54 |\u001b[39m   it(\u001b[32m'handler for generate new video enters correct scene based on mode'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/handlers/hearsActions.test.ts\u001b[39m\u001b[0m\u001b[2m:51:29\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mregisterHearsActions › handler for generate new video enters correct scene based on mode\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32mStringContaining \"You cannot generate a new video in this mode\"\u001b[39m\n    Received: \u001b[31m\"Вы не можете сгенерировать новое видео в этом режиме\"\u001b[39m\n\n    Number of calls: \u001b[31m1\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 72 |\u001b[39m     jest\u001b[33m.\u001b[39mclearAllMocks()\u001b[22m\n\u001b[2m     \u001b[90m 73 |\u001b[39m     \u001b[36mawait\u001b[39m handler(ctx)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 74 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mreply)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 75 |\u001b[39m       expect\u001b[33m.\u001b[39mstringContaining(\u001b[32m'You cannot generate a new video in this mode'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 76 |\u001b[39m     )\u001b[22m\n\u001b[2m     \u001b[90m 77 |\u001b[39m   })\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/handlers/hearsActions.test.ts\u001b[39m\u001b[0m\u001b[2m:74:23\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["registerHearsActions"],"duration":2,"failureMessages":[],"fullName":"registerHearsActions registers three hears actions","status":"passed","title":"registers three hears actions"},{"ancestorTitles":["registerHearsActions"],"duration":2,"failureMessages":[],"fullName":"registerHearsActions handler for text_to_speech sets session.mode and enters scene","status":"passed","title":"handler for text_to_speech sets session.mode and enters scene"},{"ancestorTitles":["registerHearsActions"],"duration":0,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m\"menuScene\"\u001b[39m\nReceived: \u001b[31m\"main_menu\"\u001b[39m\n\nNumber of calls: \u001b[31m1\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/handlers/hearsActions.test.ts:51:29\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"registerHearsActions handler for main_menu sets session.mode and enters scene","status":"failed","title":"handler for main_menu sets session.mode and enters scene"},{"ancestorTitles":["registerHearsActions"],"duration":10,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32mStringContaining \"You cannot generate a new video in this mode\"\u001b[39m\nReceived: \u001b[31m\"Вы не можете сгенерировать новое видео в этом режиме\"\u001b[39m\n\nNumber of calls: \u001b[31m1\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/handlers/hearsActions.test.ts:74:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"registerHearsActions handler for generate new video enters correct scene based on mode","status":"failed","title":"handler for generate new video enters correct scene based on mode"}]},{"numFailingTests":1,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171895624,"runtime":25,"slow":false,"start":1745171895599},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/handlers/getBotToken.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mgetBotToken › returns first BOT_TOKENS[0] by default\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\n    Expected: \u001b[32m\"\u001b[7mfirstToke\u001b[27mn\"\u001b[39m\n    Received: \u001b[31m\"\u001b[7munknow\u001b[27mn\"\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 17 |\u001b[39m       telegram\u001b[33m:\u001b[39m { token\u001b[33m:\u001b[39m \u001b[32m'unknown'\u001b[39m } \u001b[36mas\u001b[39m any\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 18 |\u001b[39m     }\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 19 |\u001b[39m     expect(getBotToken(ctx \u001b[36mas\u001b[39m \u001b[33mMyContext\u001b[39m))\u001b[33m.\u001b[39mtoBe(\u001b[33mBOT_TOKENS\u001b[39m[\u001b[35m0\u001b[39m])\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                           \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 20 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 21 |\u001b[39m   it(\u001b[32m'returns BOT_TOKENS[0] when token matches'\u001b[39m\u001b[33m,\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[22m\n\u001b[2m     \u001b[90m 22 |\u001b[39m     \u001b[36mconst\u001b[39m ctx\u001b[33m:\u001b[39m \u001b[33mPartial\u001b[39m\u001b[33m<\u001b[39m\u001b[33mMyContext\u001b[39m\u001b[33m>\u001b[39m \u001b[33m=\u001b[39m {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/handlers/getBotToken.test.ts\u001b[39m\u001b[0m\u001b[2m:19:43)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["getBotToken"],"duration":2,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32m\"\u001b[7mfirstToke\u001b[27mn\"\u001b[39m\nReceived: \u001b[31m\"\u001b[7munknow\u001b[27mn\"\u001b[39m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/handlers/getBotToken.test.ts:19:43)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"getBotToken returns first BOT_TOKENS[0] by default","status":"failed","title":"returns first BOT_TOKENS[0] by default"},{"ancestorTitles":["getBotToken"],"duration":0,"failureMessages":[],"fullName":"getBotToken returns BOT_TOKENS[0] when token matches","status":"passed","title":"returns BOT_TOKENS[0] when token matches"},{"ancestorTitles":["getBotToken"],"duration":0,"failureMessages":[],"fullName":"getBotToken returns BOT_TOKENS[1] when token matches second","status":"passed","title":"returns BOT_TOKENS[1] when token matches second"}]},{"numFailingTests":2,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171895653,"runtime":50,"slow":false,"start":1745171895603},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/handlers/paymentHandlers.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mhandleSelectStars › sends inline keyboard with star packages (RU)\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\n    Expected: \u001b[32m2\u001b[39m\n    Received: \u001b[31m4\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 57 |\u001b[39m     \u001b[36mconst\u001b[39m reply \u001b[33m=\u001b[39m ctx\u001b[33m.\u001b[39mdebug\u001b[33m.\u001b[39mreplies[\u001b[35m0\u001b[39m]\u001b[22m\n\u001b[2m     \u001b[90m 58 |\u001b[39m     \u001b[36mconst\u001b[39m markup \u001b[33m=\u001b[39m reply\u001b[33m.\u001b[39mextra\u001b[33m.\u001b[39mreply_markup\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 59 |\u001b[39m     expect(markup\u001b[33m.\u001b[39minline_keyboard\u001b[33m.\u001b[39mlength)\u001b[33m.\u001b[39mtoBe(\u001b[35m2\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                           \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 60 |\u001b[39m     expect(markup\u001b[33m.\u001b[39minline_keyboard[\u001b[35m0\u001b[39m]\u001b[33m.\u001b[39mmap((b\u001b[33m:\u001b[39m any) \u001b[33m=>\u001b[39m b\u001b[33m.\u001b[39mcallback_data))\u001b[33m.\u001b[39mtoEqual([\u001b[22m\n\u001b[2m     \u001b[90m 61 |\u001b[39m       \u001b[32m'top_up_5'\u001b[39m\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 62 |\u001b[39m       \u001b[32m'top_up_10'\u001b[39m\u001b[33m,\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/handlers/paymentHandlers.test.ts\u001b[39m\u001b[0m\u001b[2m:59:43\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mhandleSelectStars › sends inline keyboard with star packages (EN)\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\n    Expected: \u001b[32m1\u001b[39m\n    Received: \u001b[31m3\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 73 |\u001b[39m     \u001b[36mconst\u001b[39m reply \u001b[33m=\u001b[39m ctx\u001b[33m.\u001b[39mdebug\u001b[33m.\u001b[39mreplies[\u001b[35m0\u001b[39m]\u001b[22m\n\u001b[2m     \u001b[90m 74 |\u001b[39m     \u001b[36mconst\u001b[39m markup \u001b[33m=\u001b[39m reply\u001b[33m.\u001b[39mextra\u001b[33m.\u001b[39mreply_markup\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 75 |\u001b[39m     expect(markup\u001b[33m.\u001b[39minline_keyboard\u001b[33m.\u001b[39mlength)\u001b[33m.\u001b[39mtoBe(\u001b[35m1\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                           \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 76 |\u001b[39m     expect(markup\u001b[33m.\u001b[39minline_keyboard[\u001b[35m0\u001b[39m]\u001b[33m.\u001b[39mmap((b\u001b[33m:\u001b[39m any) \u001b[33m=>\u001b[39m b\u001b[33m.\u001b[39mtext))\u001b[33m.\u001b[39mtoEqual([\u001b[22m\n\u001b[2m     \u001b[90m 77 |\u001b[39m       \u001b[32m'1⭐️'\u001b[39m\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 78 |\u001b[39m       \u001b[32m'2⭐️'\u001b[39m\u001b[33m,\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/handlers/paymentHandlers.test.ts\u001b[39m\u001b[0m\u001b[2m:75:43\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["handleBuySubscription"],"duration":1,"failureMessages":[],"fullName":"handleBuySubscription sends invoice and leaves scene for neurophoto subscription (RU)","status":"passed","title":"sends invoice and leaves scene for neurophoto subscription (RU)"},{"ancestorTitles":["handleBuySubscription"],"duration":0,"failureMessages":[],"fullName":"handleBuySubscription sends invoice and leaves scene for neurobase subscription (EN)","status":"passed","title":"sends invoice and leaves scene for neurobase subscription (EN)"},{"ancestorTitles":["handleSelectStars"],"duration":5,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32m2\u001b[39m\nReceived: \u001b[31m4\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/handlers/paymentHandlers.test.ts:59:43\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"handleSelectStars sends inline keyboard with star packages (RU)","status":"failed","title":"sends inline keyboard with star packages (RU)"},{"ancestorTitles":["handleSelectStars"],"duration":2,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32m1\u001b[39m\nReceived: \u001b[31m3\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/handlers/paymentHandlers.test.ts:75:43\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"handleSelectStars sends inline keyboard with star packages (EN)","status":"failed","title":"sends inline keyboard with star packages (EN)"}]},{"numFailingTests":2,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171895759,"runtime":130,"slow":false,"start":1745171895629},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/handlers/handleSuccessfulPaymentFlow.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mhandleSuccessfulPayment › processes known subscription type\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32m{\"amount\": 1110, \"telegram_id\": \"5\"}\u001b[39m\n\n    Number of calls: \u001b[31m0\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 28 |\u001b[39m     \u001b[36mawait\u001b[39m handleSuccessfulPayment(ctx)\u001b[22m\n\u001b[2m     \u001b[90m 29 |\u001b[39m     \u001b[90m// For neurophoto: amount=1110, stars=50\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 30 |\u001b[39m     expect(incrementBalance)\u001b[33m.\u001b[39mtoHaveBeenCalledWith({ telegram_id\u001b[33m:\u001b[39m \u001b[32m'5'\u001b[39m\u001b[33m,\u001b[39m amount\u001b[33m:\u001b[39m \u001b[35m1110\u001b[39m })\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                              \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 31 |\u001b[39m     \u001b[90m// Two notifications\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 32 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mtelegram\u001b[33m.\u001b[39msendMessage)\u001b[33m.\u001b[39mtoHaveBeenCalledTimes(\u001b[35m2\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 33 |\u001b[39m     expect(setPayments)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(expect\u001b[33m.\u001b[39mobjectContaining({ \u001b[33mInvId\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'inv123'\u001b[39m\u001b[33m,\u001b[39m stars\u001b[33m:\u001b[39m \u001b[35m50\u001b[39m }))\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/handlers/handleSuccessfulPaymentFlow.test.ts\u001b[39m\u001b[0m\u001b[2m:30:30\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mhandleSuccessfulPayment › processes fallback for unknown subscription\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32m{\"amount\": 50, \"telegram_id\": \"5\"}\u001b[39m\n\n    Number of calls: \u001b[31m0\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 38 |\u001b[39m     \u001b[36mawait\u001b[39m handleSuccessfulPayment(ctx)\u001b[22m\n\u001b[2m     \u001b[90m 39 |\u001b[39m     \u001b[90m// Fallback: incrementBalance with stars\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 40 |\u001b[39m     expect(incrementBalance)\u001b[33m.\u001b[39mtoHaveBeenCalledWith({ telegram_id\u001b[33m:\u001b[39m \u001b[32m'5'\u001b[39m\u001b[33m,\u001b[39m amount\u001b[33m:\u001b[39m \u001b[35m50\u001b[39m })\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                              \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 41 |\u001b[39m     \u001b[90m// Reply to user\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 42 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mreply)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[22m\n\u001b[2m     \u001b[90m 43 |\u001b[39m       \u001b[32m'💫 Ваш баланс пополнен на 50⭐️ звезд!'\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/handlers/handleSuccessfulPaymentFlow.test.ts\u001b[39m\u001b[0m\u001b[2m:40:30\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["handleSuccessfulPayment"],"duration":7,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m{\"amount\": 1110, \"telegram_id\": \"5\"}\u001b[39m\n\nNumber of calls: \u001b[31m0\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/handlers/handleSuccessfulPaymentFlow.test.ts:30:30\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"handleSuccessfulPayment processes known subscription type","status":"failed","title":"processes known subscription type"},{"ancestorTitles":["handleSuccessfulPayment"],"duration":4,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m{\"amount\": 50, \"telegram_id\": \"5\"}\u001b[39m\n\nNumber of calls: \u001b[31m0\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/handlers/handleSuccessfulPaymentFlow.test.ts:40:30\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"handleSuccessfulPayment processes fallback for unknown subscription","status":"failed","title":"processes fallback for unknown subscription"},{"ancestorTitles":["handleSuccessfulPayment"],"duration":2,"failureMessages":[],"fullName":"handleSuccessfulPayment handles missing chat gracefully","status":"passed","title":"handles missing chat gracefully"}]},{"numFailingTests":2,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171895834,"runtime":54,"slow":false,"start":1745171895780},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/handlers/handleSizeSelection.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mhandleSizeSelection › handles neuro_photo mode in Russian\u001b[39m\u001b[22m\n\n    TypeError: Cannot destructure property 'count' of '((cov_1z40prnb6d(...).s[20]++) , (intermediate value))' as it is undefined.\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 21 |\u001b[39m     console\u001b[33m.\u001b[39mlog(\u001b[32m'CASE: Неизвестный режим'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 22 |\u001b[39m     \u001b[36mconst\u001b[39m telegram_id \u001b[33m=\u001b[39m ctx\u001b[33m.\u001b[39m\u001b[36mfrom\u001b[39m\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mid\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mtoString() \u001b[33m||\u001b[39m \u001b[32m''\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 23 |\u001b[39m     \u001b[36mconst\u001b[39m { count\u001b[33m,\u001b[39m subscriptionType\u001b[33m,\u001b[39m level\u001b[33m,\u001b[39m isExist } \u001b[33m=\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m             \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 24 |\u001b[39m       \u001b[36mawait\u001b[39m getReferalsCountAndUserData(telegram_id)\u001b[22m\n\u001b[2m     \u001b[90m 25 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 26 |\u001b[39m     \u001b[36mif\u001b[39m (isExist) {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat count (\u001b[22m\u001b[2msrc/handlers/handleSizeSelection/index.ts\u001b[2m:23:13)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mhandleSizeSelection › calls mainMenu when mode unknown and user exists\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32m3\u001b[39m\n    Received: \u001b[31m\"3\"\u001b[39m\n\n    Number of calls: \u001b[31m1\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 100 |\u001b[39m     \u001b[36mawait\u001b[39m handleSizeSelection(testCtx \u001b[36mas\u001b[39m any\u001b[33m,\u001b[39m \u001b[32m'4:3'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 101 |\u001b[39m     expect(setAspectRatio)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[35m3\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'4:3'\u001b[39m)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 102 |\u001b[39m     expect(getReferalsCountAndUserData)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[35m3\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                                         \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 103 |\u001b[39m     expect(mainMenu)\u001b[33m.\u001b[39mtoHaveBeenCalledWith({\u001b[22m\n\u001b[2m     \u001b[90m 104 |\u001b[39m       isRu\u001b[33m:\u001b[39m \u001b[36mfalse\u001b[39m\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 105 |\u001b[39m       inviteCount\u001b[33m:\u001b[39m \u001b[35m5\u001b[39m\u001b[33m,\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/handlers/handleSizeSelection.test.ts\u001b[39m\u001b[0m\u001b[2m:102:41\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["handleSizeSelection"],"duration":2,"failureMessages":["TypeError: Cannot destructure property 'count' of '((cov_1z40prnb6d(...).s[20]++) , (intermediate value))' as it is undefined.\n    at count (/Users/playra/999-multibots-telegraf/src/handlers/handleSizeSelection/index.ts:23:13)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"handleSizeSelection handles neuro_photo mode in Russian","status":"failed","title":"handles neuro_photo mode in Russian"},{"ancestorTitles":["handleSizeSelection"],"duration":2,"failureMessages":[],"fullName":"handleSizeSelection handles text_to_image mode in English","status":"passed","title":"handles text_to_image mode in English"},{"ancestorTitles":["handleSizeSelection"],"duration":1,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m3\u001b[39m\nReceived: \u001b[31m\"3\"\u001b[39m\n\nNumber of calls: \u001b[31m1\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/handlers/handleSizeSelection.test.ts:102:41\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"handleSizeSelection calls mainMenu when mode unknown and user exists","status":"failed","title":"calls mainMenu when mode unknown and user exists"},{"ancestorTitles":["handleSizeSelection"],"duration":1,"failureMessages":[],"fullName":"handleSizeSelection enters helpScene when mode unknown and user does not exist","status":"passed","title":"enters helpScene when mode unknown and user does not exist"}]},{"numFailingTests":10,"numPassingTests":6,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171895805,"runtime":139,"slow":false,"start":1745171895666},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/utils/menuHelpers.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mvideoModelKeyboard › creates correct keyboard for Russian\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n    \u001b[32m- Expected  -  6\u001b[39m\n    \u001b[31m+ Received  + 24\u001b[39m\n\n    \u001b[2m  Array [\u001b[22m\n    \u001b[2m    Array [\u001b[22m\n    \u001b[32m-     \"Minimax\",\u001b[39m\n    \u001b[32m-     \"Haiper\",\u001b[39m\n    \u001b[31m+     Object {\u001b[39m\n    \u001b[31m+       \"hide\": false,\u001b[39m\n    \u001b[31m+       \"text\": \"Minimax\",\u001b[39m\n    \u001b[31m+     },\u001b[39m\n    \u001b[31m+     Object {\u001b[39m\n    \u001b[31m+       \"hide\": false,\u001b[39m\n    \u001b[31m+       \"text\": \"Haiper\",\u001b[39m\n    \u001b[31m+     },\u001b[39m\n    \u001b[2m    ],\u001b[22m\n    \u001b[2m    Array [\u001b[22m\n    \u001b[32m-     \"Ray\",\u001b[39m\n    \u001b[32m-     \"I2VGen-XL\",\u001b[39m\n    \u001b[31m+     Object {\u001b[39m\n    \u001b[31m+       \"hide\": false,\u001b[39m\n    \u001b[31m+       \"text\": \"Ray\",\u001b[39m\n    \u001b[31m+     },\u001b[39m\n    \u001b[31m+     Object {\u001b[39m\n    \u001b[31m+       \"hide\": false,\u001b[39m\n    \u001b[31m+       \"text\": \"I2VGen-XL\",\u001b[39m\n    \u001b[31m+     },\u001b[39m\n    \u001b[2m    ],\u001b[22m\n    \u001b[2m    Array [\u001b[22m\n    \u001b[32m-     \"Справка по команде\",\u001b[39m\n    \u001b[32m-     \"Отмена\",\u001b[39m\n    \u001b[31m+     Object {\u001b[39m\n    \u001b[31m+       \"hide\": false,\u001b[39m\n    \u001b[31m+       \"text\": \"Справка по команде\",\u001b[39m\n    \u001b[31m+     },\u001b[39m\n    \u001b[31m+     Object {\u001b[39m\n    \u001b[31m+       \"hide\": false,\u001b[39m\n    \u001b[31m+       \"text\": \"Отмена\",\u001b[39m\n    \u001b[31m+     },\u001b[39m\n    \u001b[2m    ],\u001b[22m\n    \u001b[2m  ]\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 22 |\u001b[39m     \u001b[36mconst\u001b[39m kb \u001b[33m=\u001b[39m videoModelKeyboard(\u001b[36mtrue\u001b[39m) \u001b[36mas\u001b[39m any\u001b[22m\n\u001b[2m     \u001b[90m 23 |\u001b[39m     \u001b[36mconst\u001b[39m rows \u001b[33m=\u001b[39m kb\u001b[33m.\u001b[39mreply_markup\u001b[33m.\u001b[39mkeyboard\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 24 |\u001b[39m     expect(rows)\u001b[33m.\u001b[39mtoEqual([\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                  \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 25 |\u001b[39m       [\u001b[32m'Minimax'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'Haiper'\u001b[39m]\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 26 |\u001b[39m       [\u001b[32m'Ray'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'I2VGen-XL'\u001b[39m]\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 27 |\u001b[39m       [\u001b[32m'Справка по команде'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'Отмена'\u001b[39m]\u001b[33m,\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/utils/menuHelpers.test.ts\u001b[39m\u001b[0m\u001b[2m:24:18)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mvideoModelKeyboard › creates correct keyboard for English\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n    \u001b[32m- Expected  -  6\u001b[39m\n    \u001b[31m+ Received  + 24\u001b[39m\n\n    \u001b[2m  Array [\u001b[22m\n    \u001b[2m    Array [\u001b[22m\n    \u001b[32m-     \"Minimax\",\u001b[39m\n    \u001b[32m-     \"Haiper\",\u001b[39m\n    \u001b[31m+     Object {\u001b[39m\n    \u001b[31m+       \"hide\": false,\u001b[39m\n    \u001b[31m+       \"text\": \"Minimax\",\u001b[39m\n    \u001b[31m+     },\u001b[39m\n    \u001b[31m+     Object {\u001b[39m\n    \u001b[31m+       \"hide\": false,\u001b[39m\n    \u001b[31m+       \"text\": \"Haiper\",\u001b[39m\n    \u001b[31m+     },\u001b[39m\n    \u001b[2m    ],\u001b[22m\n    \u001b[2m    Array [\u001b[22m\n    \u001b[32m-     \"Ray\",\u001b[39m\n    \u001b[32m-     \"I2VGen-XL\",\u001b[39m\n    \u001b[31m+     Object {\u001b[39m\n    \u001b[31m+       \"hide\": false,\u001b[39m\n    \u001b[31m+       \"text\": \"Ray\",\u001b[39m\n    \u001b[31m+     },\u001b[39m\n    \u001b[31m+     Object {\u001b[39m\n    \u001b[31m+       \"hide\": false,\u001b[39m\n    \u001b[31m+       \"text\": \"I2VGen-XL\",\u001b[39m\n    \u001b[31m+     },\u001b[39m\n    \u001b[2m    ],\u001b[22m\n    \u001b[2m    Array [\u001b[22m\n    \u001b[32m-     \"Help for the command\",\u001b[39m\n    \u001b[32m-     \"Cancel\",\u001b[39m\n    \u001b[31m+     Object {\u001b[39m\n    \u001b[31m+       \"hide\": false,\u001b[39m\n    \u001b[31m+       \"text\": \"Help for the command\",\u001b[39m\n    \u001b[31m+     },\u001b[39m\n    \u001b[31m+     Object {\u001b[39m\n    \u001b[31m+       \"hide\": false,\u001b[39m\n    \u001b[31m+       \"text\": \"Cancel\",\u001b[39m\n    \u001b[31m+     },\u001b[39m\n    \u001b[2m    ],\u001b[22m\n    \u001b[2m  ]\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 32 |\u001b[39m     \u001b[36mconst\u001b[39m kb \u001b[33m=\u001b[39m videoModelKeyboard(\u001b[36mfalse\u001b[39m) \u001b[36mas\u001b[39m any\u001b[22m\n\u001b[2m     \u001b[90m 33 |\u001b[39m     \u001b[36mconst\u001b[39m rows \u001b[33m=\u001b[39m kb\u001b[33m.\u001b[39mreply_markup\u001b[33m.\u001b[39mkeyboard\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 34 |\u001b[39m     expect(rows)\u001b[33m.\u001b[39mtoEqual([\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                  \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 35 |\u001b[39m       [\u001b[32m'Minimax'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'Haiper'\u001b[39m]\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 36 |\u001b[39m       [\u001b[32m'Ray'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'I2VGen-XL'\u001b[39m]\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 37 |\u001b[39m       [\u001b[32m'Help for the command'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'Cancel'\u001b[39m]\u001b[33m,\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/utils/menuHelpers.test.ts\u001b[39m\u001b[0m\u001b[2m:34:18)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mcancelMenu › creates keyboard with single Cancel button in Russian\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n    \u001b[32m- Expected  - 1\u001b[39m\n    \u001b[31m+ Received  + 4\u001b[39m\n\n    \u001b[2m  Array [\u001b[22m\n    \u001b[2m    Array [\u001b[22m\n    \u001b[32m-     \"Отмена\",\u001b[39m\n    \u001b[31m+     Object {\u001b[39m\n    \u001b[31m+       \"hide\": false,\u001b[39m\n    \u001b[31m+       \"text\": \"Отмена\",\u001b[39m\n    \u001b[31m+     },\u001b[39m\n    \u001b[2m    ],\u001b[22m\n    \u001b[2m  ]\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 49 |\u001b[39m   it(\u001b[32m'creates keyboard with single Cancel button in Russian'\u001b[39m\u001b[33m,\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[22m\n\u001b[2m     \u001b[90m 50 |\u001b[39m     \u001b[36mconst\u001b[39m kb \u001b[33m=\u001b[39m cancelMenu(\u001b[36mtrue\u001b[39m) \u001b[36mas\u001b[39m any\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 51 |\u001b[39m     expect(kb\u001b[33m.\u001b[39mreply_markup\u001b[33m.\u001b[39mkeyboard)\u001b[33m.\u001b[39mtoEqual([[\u001b[32m'Отмена'\u001b[39m]])\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                      \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 52 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 53 |\u001b[39m   it(\u001b[32m'creates keyboard with single Cancel button in English'\u001b[39m\u001b[33m,\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[22m\n\u001b[2m     \u001b[90m 54 |\u001b[39m     \u001b[36mconst\u001b[39m kb \u001b[33m=\u001b[39m cancelMenu(\u001b[36mfalse\u001b[39m) \u001b[36mas\u001b[39m any\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/utils/menuHelpers.test.ts\u001b[39m\u001b[0m\u001b[2m:51:38)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mcancelMenu › creates keyboard with single Cancel button in English\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n    \u001b[32m- Expected  - 1\u001b[39m\n    \u001b[31m+ Received  + 4\u001b[39m\n\n    \u001b[2m  Array [\u001b[22m\n    \u001b[2m    Array [\u001b[22m\n    \u001b[32m-     \"Cancel\",\u001b[39m\n    \u001b[31m+     Object {\u001b[39m\n    \u001b[31m+       \"hide\": false,\u001b[39m\n    \u001b[31m+       \"text\": \"Cancel\",\u001b[39m\n    \u001b[31m+     },\u001b[39m\n    \u001b[2m    ],\u001b[22m\n    \u001b[2m  ]\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 53 |\u001b[39m   it(\u001b[32m'creates keyboard with single Cancel button in English'\u001b[39m\u001b[33m,\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[22m\n\u001b[2m     \u001b[90m 54 |\u001b[39m     \u001b[36mconst\u001b[39m kb \u001b[33m=\u001b[39m cancelMenu(\u001b[36mfalse\u001b[39m) \u001b[36mas\u001b[39m any\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 55 |\u001b[39m     expect(kb\u001b[33m.\u001b[39mreply_markup\u001b[33m.\u001b[39mkeyboard)\u001b[33m.\u001b[39mtoEqual([[\u001b[32m'Cancel'\u001b[39m]])\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                      \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 56 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 57 |\u001b[39m })\u001b[22m\n\u001b[2m     \u001b[90m 58 |\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/utils/menuHelpers.test.ts\u001b[39m\u001b[0m\u001b[2m:55:38)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mgetStepSelectionMenu › builds first-level step menu in Russian\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n    \u001b[32m- Expected  -  3\u001b[39m\n    \u001b[31m+ Received  + 12\u001b[39m\n\n    \u001b[2m  Array [\u001b[22m\n    \u001b[32m-   \"1000 шагов\",\u001b[39m\n    \u001b[32m-   \"1500 шагов\",\u001b[39m\n    \u001b[32m-   \"2000 шагов\",\u001b[39m\n    \u001b[31m+   Object {\u001b[39m\n    \u001b[31m+     \"hide\": false,\u001b[39m\n    \u001b[31m+     \"text\": \"1000 шагов\",\u001b[39m\n    \u001b[31m+   },\u001b[39m\n    \u001b[31m+   Object {\u001b[39m\n    \u001b[31m+     \"hide\": false,\u001b[39m\n    \u001b[31m+     \"text\": \"1500 шагов\",\u001b[39m\n    \u001b[31m+   },\u001b[39m\n    \u001b[31m+   Object {\u001b[39m\n    \u001b[31m+     \"hide\": false,\u001b[39m\n    \u001b[31m+     \"text\": \"2000 шагов\",\u001b[39m\n    \u001b[31m+   },\u001b[39m\n    \u001b[2m  ]\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 61 |\u001b[39m     \u001b[36mconst\u001b[39m kb \u001b[33m=\u001b[39m getStepSelectionMenu(\u001b[36mtrue\u001b[39m) \u001b[36mas\u001b[39m any\u001b[22m\n\u001b[2m     \u001b[90m 62 |\u001b[39m     \u001b[36mconst\u001b[39m rows \u001b[33m=\u001b[39m kb\u001b[33m.\u001b[39mreply_markup\u001b[33m.\u001b[39mkeyboard\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 63 |\u001b[39m     expect(rows[\u001b[35m0\u001b[39m])\u001b[33m.\u001b[39mtoEqual([\u001b[32m'1000 шагов'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'1500 шагов'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'2000 шагов'\u001b[39m])\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                     \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 64 |\u001b[39m     expect(rows[\u001b[35m3\u001b[39m])\u001b[33m.\u001b[39mtoEqual([\u001b[32m'Справка по команде'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'Отмена'\u001b[39m])\u001b[22m\n\u001b[2m     \u001b[90m 65 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 66 |\u001b[39m   it(\u001b[32m'builds first-level step menu in English'\u001b[39m\u001b[33m,\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/utils/menuHelpers.test.ts\u001b[39m\u001b[0m\u001b[2m:63:21)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mgetStepSelectionMenu › builds first-level step menu in English\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n    \u001b[32m- Expected  -  3\u001b[39m\n    \u001b[31m+ Received  + 12\u001b[39m\n\n    \u001b[2m  Array [\u001b[22m\n    \u001b[32m-   \"1000 steps\",\u001b[39m\n    \u001b[32m-   \"1500 steps\",\u001b[39m\n    \u001b[32m-   \"2000 steps\",\u001b[39m\n    \u001b[31m+   Object {\u001b[39m\n    \u001b[31m+     \"hide\": false,\u001b[39m\n    \u001b[31m+     \"text\": \"1000 steps\",\u001b[39m\n    \u001b[31m+   },\u001b[39m\n    \u001b[31m+   Object {\u001b[39m\n    \u001b[31m+     \"hide\": false,\u001b[39m\n    \u001b[31m+     \"text\": \"1500 steps\",\u001b[39m\n    \u001b[31m+   },\u001b[39m\n    \u001b[31m+   Object {\u001b[39m\n    \u001b[31m+     \"hide\": false,\u001b[39m\n    \u001b[31m+     \"text\": \"2000 steps\",\u001b[39m\n    \u001b[31m+   },\u001b[39m\n    \u001b[2m  ]\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 67 |\u001b[39m     \u001b[36mconst\u001b[39m kb \u001b[33m=\u001b[39m getStepSelectionMenu(\u001b[36mfalse\u001b[39m) \u001b[36mas\u001b[39m any\u001b[22m\n\u001b[2m     \u001b[90m 68 |\u001b[39m     \u001b[36mconst\u001b[39m rows \u001b[33m=\u001b[39m kb\u001b[33m.\u001b[39mreply_markup\u001b[33m.\u001b[39mkeyboard\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 69 |\u001b[39m     expect(rows[\u001b[35m0\u001b[39m])\u001b[33m.\u001b[39mtoEqual([\u001b[32m'1000 steps'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'1500 steps'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'2000 steps'\u001b[39m])\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                     \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 70 |\u001b[39m     expect(rows[\u001b[35m3\u001b[39m])\u001b[33m.\u001b[39mtoEqual([\u001b[32m'Help for the command'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'Cancel'\u001b[39m])\u001b[22m\n\u001b[2m     \u001b[90m 71 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 72 |\u001b[39m })\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/utils/menuHelpers.test.ts\u001b[39m\u001b[0m\u001b[2m:69:21)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mgetStepSelectionMenuV2 › builds second-level step menu in Russian\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n    \u001b[32m- Expected  -  3\u001b[39m\n    \u001b[31m+ Received  + 12\u001b[39m\n\n    \u001b[2m  Array [\u001b[22m\n    \u001b[32m-   \"100 шагов\",\u001b[39m\n    \u001b[32m-   \"200 шагов\",\u001b[39m\n    \u001b[32m-   \"300 шагов\",\u001b[39m\n    \u001b[31m+   Object {\u001b[39m\n    \u001b[31m+     \"hide\": false,\u001b[39m\n    \u001b[31m+     \"text\": \"100 шагов\",\u001b[39m\n    \u001b[31m+   },\u001b[39m\n    \u001b[31m+   Object {\u001b[39m\n    \u001b[31m+     \"hide\": false,\u001b[39m\n    \u001b[31m+     \"text\": \"200 шагов\",\u001b[39m\n    \u001b[31m+   },\u001b[39m\n    \u001b[31m+   Object {\u001b[39m\n    \u001b[31m+     \"hide\": false,\u001b[39m\n    \u001b[31m+     \"text\": \"300 шагов\",\u001b[39m\n    \u001b[31m+   },\u001b[39m\n    \u001b[2m  ]\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 76 |\u001b[39m     \u001b[36mconst\u001b[39m kb \u001b[33m=\u001b[39m getStepSelectionMenuV2(\u001b[36mtrue\u001b[39m) \u001b[36mas\u001b[39m any\u001b[22m\n\u001b[2m     \u001b[90m 77 |\u001b[39m     \u001b[36mconst\u001b[39m rows \u001b[33m=\u001b[39m kb\u001b[33m.\u001b[39mreply_markup\u001b[33m.\u001b[39mkeyboard\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 78 |\u001b[39m     expect(rows[\u001b[35m0\u001b[39m])\u001b[33m.\u001b[39mtoEqual([\u001b[32m'100 шагов'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'200 шагов'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'300 шагов'\u001b[39m])\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                     \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 79 |\u001b[39m     expect(rows[\u001b[35m3\u001b[39m])\u001b[33m.\u001b[39mtoEqual([\u001b[32m'Справка по команде'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'Отмена'\u001b[39m])\u001b[22m\n\u001b[2m     \u001b[90m 80 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 81 |\u001b[39m   it(\u001b[32m'builds second-level step menu in English'\u001b[39m\u001b[33m,\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/utils/menuHelpers.test.ts\u001b[39m\u001b[0m\u001b[2m:78:21)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mgetStepSelectionMenuV2 › builds second-level step menu in English\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n    \u001b[32m- Expected  -  3\u001b[39m\n    \u001b[31m+ Received  + 12\u001b[39m\n\n    \u001b[2m  Array [\u001b[22m\n    \u001b[32m-   \"100 steps\",\u001b[39m\n    \u001b[32m-   \"200 steps\",\u001b[39m\n    \u001b[32m-   \"300 steps\",\u001b[39m\n    \u001b[31m+   Object {\u001b[39m\n    \u001b[31m+     \"hide\": false,\u001b[39m\n    \u001b[31m+     \"text\": \"100 steps\",\u001b[39m\n    \u001b[31m+   },\u001b[39m\n    \u001b[31m+   Object {\u001b[39m\n    \u001b[31m+     \"hide\": false,\u001b[39m\n    \u001b[31m+     \"text\": \"200 steps\",\u001b[39m\n    \u001b[31m+   },\u001b[39m\n    \u001b[31m+   Object {\u001b[39m\n    \u001b[31m+     \"hide\": false,\u001b[39m\n    \u001b[31m+     \"text\": \"300 steps\",\u001b[39m\n    \u001b[31m+   },\u001b[39m\n    \u001b[2m  ]\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 82 |\u001b[39m     \u001b[36mconst\u001b[39m kb \u001b[33m=\u001b[39m getStepSelectionMenuV2(\u001b[36mfalse\u001b[39m) \u001b[36mas\u001b[39m any\u001b[22m\n\u001b[2m     \u001b[90m 83 |\u001b[39m     \u001b[36mconst\u001b[39m rows \u001b[33m=\u001b[39m kb\u001b[33m.\u001b[39mreply_markup\u001b[33m.\u001b[39mkeyboard\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 84 |\u001b[39m     expect(rows[\u001b[35m0\u001b[39m])\u001b[33m.\u001b[39mtoEqual([\u001b[32m'100 steps'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'200 steps'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'300 steps'\u001b[39m])\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                     \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 85 |\u001b[39m     expect(rows[\u001b[35m3\u001b[39m])\u001b[33m.\u001b[39mtoEqual([\u001b[32m'Help for the command'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'Cancel'\u001b[39m])\u001b[22m\n\u001b[2m     \u001b[90m 86 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 87 |\u001b[39m })\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/utils/menuHelpers.test.ts\u001b[39m\u001b[0m\u001b[2m:84:21)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mimageModelMenu › builds keyboard for Russian\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32m\"🎨 Выберите модель для генерации:\"\u001b[39m, \u001b[32mObjectContaining {\"reply_markup\": ObjectContaining {\"keyboard\": [[\"A\", \"B\"], [\"Отмена\", \"Справка по команде\"], [\"🏠 Главное меню\"]]}}\u001b[39m\n    Received: \u001b[2m\"🎨 Выберите модель для генерации:\"\u001b[22m, \u001b[31m{\"reply_markup\": {\"keyboard\": [[{\"hide\": false, \"text\": \"FLUX1.1 [pro]\"}, {\"hide\": false, \"text\": \"FLUX1.1 [pro] Ultra\"}], [{\"hide\": false, \"text\": \"FLUX1.1 [dev]\"}, {\"hide\": false, \"text\": \"FLUX1.1 [dev] Lora\"}], [{\"hide\": false, \"text\": \"FLUX1.1 [pro]\"}, {\"hide\": false, \"text\": \"FLUX1.1 [dev] Schnell\"}], [{\"hide\": false, \"text\": \"FLUX1.1 [dev] Schnell lora\"}, {\"hide\": false, \"text\": \"Ideogram\"}], [{\"hide\": false, \"text\": \"Ideogram Turbo\"}, {\"hide\": false, \"text\": \"Luma Photon\"}], [{\"hide\": false, \"text\": \"Luma Photon Flash\"}, {\"hide\": false, \"text\": \"Recraft 20b\"}], [{\"hide\": false, \"text\": \"Recraft V3\"}, {\"hide\": false, \"text\": \"Stable Diffusion 3\"}], [{\"hide\": false, \"text\": \"Stable Diffusion 3.5 Large\"}, {\"hide\": false, \"text\": \"Stable Diffusion 3.5 Large Turbo\"}], [{\"hide\": false, \"text\": \"Stable Diffusion 3.5 Medium\"}], [{\"hide\": false, \"text\": \"Отмена\"}, {\"hide\": false, \"text\": \"Справка по команде\"}], …], \"one_time_keyboard\": true, \"resize_keyboard\": true}}\u001b[39m\n\n    Number of calls: \u001b[31m1\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 115 |\u001b[39m     ctx\u001b[33m.\u001b[39m\u001b[36mfrom\u001b[39m\u001b[33m.\u001b[39mlanguage_code \u001b[33m=\u001b[39m \u001b[32m'ru'\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 116 |\u001b[39m     \u001b[36mawait\u001b[39m imageModelMenu(ctx \u001b[36mas\u001b[39m any)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 117 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mreply)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 118 |\u001b[39m       \u001b[32m'🎨 Выберите модель для генерации:'\u001b[39m\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 119 |\u001b[39m       expect\u001b[33m.\u001b[39mobjectContaining({\u001b[22m\n\u001b[2m     \u001b[90m 120 |\u001b[39m         reply_markup\u001b[33m:\u001b[39m expect\u001b[33m.\u001b[39mobjectContaining({\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/utils/menuHelpers.test.ts\u001b[39m\u001b[0m\u001b[2m:117:23\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mimageModelMenu › builds keyboard for English\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32m\"🎨 Choose a model for generation:\"\u001b[39m, \u001b[32mObjectContaining {\"reply_markup\": ObjectContaining {\"keyboard\": [[\"A\", \"B\"], [\"Cancel\", \"Help for the command\"], [\"🏠 Main menu\"]]}}\u001b[39m\n    Received: \u001b[2m\"🎨 Choose a model for generation:\"\u001b[22m, \u001b[31m{\"reply_markup\": {\"keyboard\": [[{\"hide\": false, \"text\": \"FLUX1.1 [pro]\"}, {\"hide\": false, \"text\": \"FLUX1.1 [pro] Ultra\"}], [{\"hide\": false, \"text\": \"FLUX1.1 [dev]\"}, {\"hide\": false, \"text\": \"FLUX1.1 [dev] Lora\"}], [{\"hide\": false, \"text\": \"FLUX1.1 [pro]\"}, {\"hide\": false, \"text\": \"FLUX1.1 [dev] Schnell\"}], [{\"hide\": false, \"text\": \"FLUX1.1 [dev] Schnell lora\"}, {\"hide\": false, \"text\": \"Ideogram\"}], [{\"hide\": false, \"text\": \"Ideogram Turbo\"}, {\"hide\": false, \"text\": \"Luma Photon\"}], [{\"hide\": false, \"text\": \"Luma Photon Flash\"}, {\"hide\": false, \"text\": \"Recraft 20b\"}], [{\"hide\": false, \"text\": \"Recraft V3\"}, {\"hide\": false, \"text\": \"Stable Diffusion 3\"}], [{\"hide\": false, \"text\": \"Stable Diffusion 3.5 Large\"}, {\"hide\": false, \"text\": \"Stable Diffusion 3.5 Large Turbo\"}], [{\"hide\": false, \"text\": \"Stable Diffusion 3.5 Medium\"}], [{\"hide\": false, \"text\": \"Cancel\"}, {\"hide\": false, \"text\": \"Help for the command\"}], …], \"one_time_keyboard\": true, \"resize_keyboard\": true}}\u001b[39m\n\n    Number of calls: \u001b[31m1\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 133 |\u001b[39m     ctx\u001b[33m.\u001b[39m\u001b[36mfrom\u001b[39m\u001b[33m.\u001b[39mlanguage_code \u001b[33m=\u001b[39m \u001b[32m'en'\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 134 |\u001b[39m     \u001b[36mawait\u001b[39m imageModelMenu(ctx \u001b[36mas\u001b[39m any)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 135 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mreply)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 136 |\u001b[39m       \u001b[32m'🎨 Choose a model for generation:'\u001b[39m\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 137 |\u001b[39m       expect\u001b[33m.\u001b[39mobjectContaining({\u001b[22m\n\u001b[2m     \u001b[90m 138 |\u001b[39m         reply_markup\u001b[33m:\u001b[39m expect\u001b[33m.\u001b[39mobjectContaining({\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/utils/menuHelpers.test.ts\u001b[39m\u001b[0m\u001b[2m:135:23\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["cancelHelpArray"],"duration":0,"failureMessages":[],"fullName":"cancelHelpArray returns Russian array when isRu true","status":"passed","title":"returns Russian array when isRu true"},{"ancestorTitles":["cancelHelpArray"],"duration":1,"failureMessages":[],"fullName":"cancelHelpArray returns English array when isRu false","status":"passed","title":"returns English array when isRu false"},{"ancestorTitles":["videoModelKeyboard"],"duration":2,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n\u001b[32m- Expected  -  6\u001b[39m\n\u001b[31m+ Received  + 24\u001b[39m\n\n\u001b[2m  Array [\u001b[22m\n\u001b[2m    Array [\u001b[22m\n\u001b[32m-     \"Minimax\",\u001b[39m\n\u001b[32m-     \"Haiper\",\u001b[39m\n\u001b[31m+     Object {\u001b[39m\n\u001b[31m+       \"hide\": false,\u001b[39m\n\u001b[31m+       \"text\": \"Minimax\",\u001b[39m\n\u001b[31m+     },\u001b[39m\n\u001b[31m+     Object {\u001b[39m\n\u001b[31m+       \"hide\": false,\u001b[39m\n\u001b[31m+       \"text\": \"Haiper\",\u001b[39m\n\u001b[31m+     },\u001b[39m\n\u001b[2m    ],\u001b[22m\n\u001b[2m    Array [\u001b[22m\n\u001b[32m-     \"Ray\",\u001b[39m\n\u001b[32m-     \"I2VGen-XL\",\u001b[39m\n\u001b[31m+     Object {\u001b[39m\n\u001b[31m+       \"hide\": false,\u001b[39m\n\u001b[31m+       \"text\": \"Ray\",\u001b[39m\n\u001b[31m+     },\u001b[39m\n\u001b[31m+     Object {\u001b[39m\n\u001b[31m+       \"hide\": false,\u001b[39m\n\u001b[31m+       \"text\": \"I2VGen-XL\",\u001b[39m\n\u001b[31m+     },\u001b[39m\n\u001b[2m    ],\u001b[22m\n\u001b[2m    Array [\u001b[22m\n\u001b[32m-     \"Справка по команде\",\u001b[39m\n\u001b[32m-     \"Отмена\",\u001b[39m\n\u001b[31m+     Object {\u001b[39m\n\u001b[31m+       \"hide\": false,\u001b[39m\n\u001b[31m+       \"text\": \"Справка по команде\",\u001b[39m\n\u001b[31m+     },\u001b[39m\n\u001b[31m+     Object {\u001b[39m\n\u001b[31m+       \"hide\": false,\u001b[39m\n\u001b[31m+       \"text\": \"Отмена\",\u001b[39m\n\u001b[31m+     },\u001b[39m\n\u001b[2m    ],\u001b[22m\n\u001b[2m  ]\u001b[22m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/utils/menuHelpers.test.ts:24:18)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"videoModelKeyboard creates correct keyboard for Russian","status":"failed","title":"creates correct keyboard for Russian"},{"ancestorTitles":["videoModelKeyboard"],"duration":1,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n\u001b[32m- Expected  -  6\u001b[39m\n\u001b[31m+ Received  + 24\u001b[39m\n\n\u001b[2m  Array [\u001b[22m\n\u001b[2m    Array [\u001b[22m\n\u001b[32m-     \"Minimax\",\u001b[39m\n\u001b[32m-     \"Haiper\",\u001b[39m\n\u001b[31m+     Object {\u001b[39m\n\u001b[31m+       \"hide\": false,\u001b[39m\n\u001b[31m+       \"text\": \"Minimax\",\u001b[39m\n\u001b[31m+     },\u001b[39m\n\u001b[31m+     Object {\u001b[39m\n\u001b[31m+       \"hide\": false,\u001b[39m\n\u001b[31m+       \"text\": \"Haiper\",\u001b[39m\n\u001b[31m+     },\u001b[39m\n\u001b[2m    ],\u001b[22m\n\u001b[2m    Array [\u001b[22m\n\u001b[32m-     \"Ray\",\u001b[39m\n\u001b[32m-     \"I2VGen-XL\",\u001b[39m\n\u001b[31m+     Object {\u001b[39m\n\u001b[31m+       \"hide\": false,\u001b[39m\n\u001b[31m+       \"text\": \"Ray\",\u001b[39m\n\u001b[31m+     },\u001b[39m\n\u001b[31m+     Object {\u001b[39m\n\u001b[31m+       \"hide\": false,\u001b[39m\n\u001b[31m+       \"text\": \"I2VGen-XL\",\u001b[39m\n\u001b[31m+     },\u001b[39m\n\u001b[2m    ],\u001b[22m\n\u001b[2m    Array [\u001b[22m\n\u001b[32m-     \"Help for the command\",\u001b[39m\n\u001b[32m-     \"Cancel\",\u001b[39m\n\u001b[31m+     Object {\u001b[39m\n\u001b[31m+       \"hide\": false,\u001b[39m\n\u001b[31m+       \"text\": \"Help for the command\",\u001b[39m\n\u001b[31m+     },\u001b[39m\n\u001b[31m+     Object {\u001b[39m\n\u001b[31m+       \"hide\": false,\u001b[39m\n\u001b[31m+       \"text\": \"Cancel\",\u001b[39m\n\u001b[31m+     },\u001b[39m\n\u001b[2m    ],\u001b[22m\n\u001b[2m  ]\u001b[22m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/utils/menuHelpers.test.ts:34:18)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"videoModelKeyboard creates correct keyboard for English","status":"failed","title":"creates correct keyboard for English"},{"ancestorTitles":["cancelMenu"],"duration":0,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n\u001b[32m- Expected  - 1\u001b[39m\n\u001b[31m+ Received  + 4\u001b[39m\n\n\u001b[2m  Array [\u001b[22m\n\u001b[2m    Array [\u001b[22m\n\u001b[32m-     \"Отмена\",\u001b[39m\n\u001b[31m+     Object {\u001b[39m\n\u001b[31m+       \"hide\": false,\u001b[39m\n\u001b[31m+       \"text\": \"Отмена\",\u001b[39m\n\u001b[31m+     },\u001b[39m\n\u001b[2m    ],\u001b[22m\n\u001b[2m  ]\u001b[22m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/utils/menuHelpers.test.ts:51:38)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"cancelMenu creates keyboard with single Cancel button in Russian","status":"failed","title":"creates keyboard with single Cancel button in Russian"},{"ancestorTitles":["cancelMenu"],"duration":1,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n\u001b[32m- Expected  - 1\u001b[39m\n\u001b[31m+ Received  + 4\u001b[39m\n\n\u001b[2m  Array [\u001b[22m\n\u001b[2m    Array [\u001b[22m\n\u001b[32m-     \"Cancel\",\u001b[39m\n\u001b[31m+     Object {\u001b[39m\n\u001b[31m+       \"hide\": false,\u001b[39m\n\u001b[31m+       \"text\": \"Cancel\",\u001b[39m\n\u001b[31m+     },\u001b[39m\n\u001b[2m    ],\u001b[22m\n\u001b[2m  ]\u001b[22m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/utils/menuHelpers.test.ts:55:38)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"cancelMenu creates keyboard with single Cancel button in English","status":"failed","title":"creates keyboard with single Cancel button in English"},{"ancestorTitles":["getStepSelectionMenu"],"duration":0,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n\u001b[32m- Expected  -  3\u001b[39m\n\u001b[31m+ Received  + 12\u001b[39m\n\n\u001b[2m  Array [\u001b[22m\n\u001b[32m-   \"1000 шагов\",\u001b[39m\n\u001b[32m-   \"1500 шагов\",\u001b[39m\n\u001b[32m-   \"2000 шагов\",\u001b[39m\n\u001b[31m+   Object {\u001b[39m\n\u001b[31m+     \"hide\": false,\u001b[39m\n\u001b[31m+     \"text\": \"1000 шагов\",\u001b[39m\n\u001b[31m+   },\u001b[39m\n\u001b[31m+   Object {\u001b[39m\n\u001b[31m+     \"hide\": false,\u001b[39m\n\u001b[31m+     \"text\": \"1500 шагов\",\u001b[39m\n\u001b[31m+   },\u001b[39m\n\u001b[31m+   Object {\u001b[39m\n\u001b[31m+     \"hide\": false,\u001b[39m\n\u001b[31m+     \"text\": \"2000 шагов\",\u001b[39m\n\u001b[31m+   },\u001b[39m\n\u001b[2m  ]\u001b[22m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/utils/menuHelpers.test.ts:63:21)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"getStepSelectionMenu builds first-level step menu in Russian","status":"failed","title":"builds first-level step menu in Russian"},{"ancestorTitles":["getStepSelectionMenu"],"duration":1,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n\u001b[32m- Expected  -  3\u001b[39m\n\u001b[31m+ Received  + 12\u001b[39m\n\n\u001b[2m  Array [\u001b[22m\n\u001b[32m-   \"1000 steps\",\u001b[39m\n\u001b[32m-   \"1500 steps\",\u001b[39m\n\u001b[32m-   \"2000 steps\",\u001b[39m\n\u001b[31m+   Object {\u001b[39m\n\u001b[31m+     \"hide\": false,\u001b[39m\n\u001b[31m+     \"text\": \"1000 steps\",\u001b[39m\n\u001b[31m+   },\u001b[39m\n\u001b[31m+   Object {\u001b[39m\n\u001b[31m+     \"hide\": false,\u001b[39m\n\u001b[31m+     \"text\": \"1500 steps\",\u001b[39m\n\u001b[31m+   },\u001b[39m\n\u001b[31m+   Object {\u001b[39m\n\u001b[31m+     \"hide\": false,\u001b[39m\n\u001b[31m+     \"text\": \"2000 steps\",\u001b[39m\n\u001b[31m+   },\u001b[39m\n\u001b[2m  ]\u001b[22m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/utils/menuHelpers.test.ts:69:21)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"getStepSelectionMenu builds first-level step menu in English","status":"failed","title":"builds first-level step menu in English"},{"ancestorTitles":["getStepSelectionMenuV2"],"duration":0,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n\u001b[32m- Expected  -  3\u001b[39m\n\u001b[31m+ Received  + 12\u001b[39m\n\n\u001b[2m  Array [\u001b[22m\n\u001b[32m-   \"100 шагов\",\u001b[39m\n\u001b[32m-   \"200 шагов\",\u001b[39m\n\u001b[32m-   \"300 шагов\",\u001b[39m\n\u001b[31m+   Object {\u001b[39m\n\u001b[31m+     \"hide\": false,\u001b[39m\n\u001b[31m+     \"text\": \"100 шагов\",\u001b[39m\n\u001b[31m+   },\u001b[39m\n\u001b[31m+   Object {\u001b[39m\n\u001b[31m+     \"hide\": false,\u001b[39m\n\u001b[31m+     \"text\": \"200 шагов\",\u001b[39m\n\u001b[31m+   },\u001b[39m\n\u001b[31m+   Object {\u001b[39m\n\u001b[31m+     \"hide\": false,\u001b[39m\n\u001b[31m+     \"text\": \"300 шагов\",\u001b[39m\n\u001b[31m+   },\u001b[39m\n\u001b[2m  ]\u001b[22m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/utils/menuHelpers.test.ts:78:21)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"getStepSelectionMenuV2 builds second-level step menu in Russian","status":"failed","title":"builds second-level step menu in Russian"},{"ancestorTitles":["getStepSelectionMenuV2"],"duration":0,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n\u001b[32m- Expected  -  3\u001b[39m\n\u001b[31m+ Received  + 12\u001b[39m\n\n\u001b[2m  Array [\u001b[22m\n\u001b[32m-   \"100 steps\",\u001b[39m\n\u001b[32m-   \"200 steps\",\u001b[39m\n\u001b[32m-   \"300 steps\",\u001b[39m\n\u001b[31m+   Object {\u001b[39m\n\u001b[31m+     \"hide\": false,\u001b[39m\n\u001b[31m+     \"text\": \"100 steps\",\u001b[39m\n\u001b[31m+   },\u001b[39m\n\u001b[31m+   Object {\u001b[39m\n\u001b[31m+     \"hide\": false,\u001b[39m\n\u001b[31m+     \"text\": \"200 steps\",\u001b[39m\n\u001b[31m+   },\u001b[39m\n\u001b[31m+   Object {\u001b[39m\n\u001b[31m+     \"hide\": false,\u001b[39m\n\u001b[31m+     \"text\": \"300 steps\",\u001b[39m\n\u001b[31m+   },\u001b[39m\n\u001b[2m  ]\u001b[22m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/utils/menuHelpers.test.ts:84:21)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"getStepSelectionMenuV2 builds second-level step menu in English","status":"failed","title":"builds second-level step menu in English"},{"ancestorTitles":["startMenu"],"duration":0,"failureMessages":[],"fullName":"startMenu sends start menu in Russian","status":"passed","title":"sends start menu in Russian"},{"ancestorTitles":["startMenu"],"duration":6,"failureMessages":[],"fullName":"startMenu sends start menu in English","status":"passed","title":"sends start menu in English"},{"ancestorTitles":["imageModelMenu"],"duration":1,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m\"🎨 Выберите модель для генерации:\"\u001b[39m, \u001b[32mObjectContaining {\"reply_markup\": ObjectContaining {\"keyboard\": [[\"A\", \"B\"], [\"Отмена\", \"Справка по команде\"], [\"🏠 Главное меню\"]]}}\u001b[39m\nReceived: \u001b[2m\"🎨 Выберите модель для генерации:\"\u001b[22m, \u001b[31m{\"reply_markup\": {\"keyboard\": [[{\"hide\": false, \"text\": \"FLUX1.1 [pro]\"}, {\"hide\": false, \"text\": \"FLUX1.1 [pro] Ultra\"}], [{\"hide\": false, \"text\": \"FLUX1.1 [dev]\"}, {\"hide\": false, \"text\": \"FLUX1.1 [dev] Lora\"}], [{\"hide\": false, \"text\": \"FLUX1.1 [pro]\"}, {\"hide\": false, \"text\": \"FLUX1.1 [dev] Schnell\"}], [{\"hide\": false, \"text\": \"FLUX1.1 [dev] Schnell lora\"}, {\"hide\": false, \"text\": \"Ideogram\"}], [{\"hide\": false, \"text\": \"Ideogram Turbo\"}, {\"hide\": false, \"text\": \"Luma Photon\"}], [{\"hide\": false, \"text\": \"Luma Photon Flash\"}, {\"hide\": false, \"text\": \"Recraft 20b\"}], [{\"hide\": false, \"text\": \"Recraft V3\"}, {\"hide\": false, \"text\": \"Stable Diffusion 3\"}], [{\"hide\": false, \"text\": \"Stable Diffusion 3.5 Large\"}, {\"hide\": false, \"text\": \"Stable Diffusion 3.5 Large Turbo\"}], [{\"hide\": false, \"text\": \"Stable Diffusion 3.5 Medium\"}], [{\"hide\": false, \"text\": \"Отмена\"}, {\"hide\": false, \"text\": \"Справка по команде\"}], …], \"one_time_keyboard\": true, \"resize_keyboard\": true}}\u001b[39m\n\nNumber of calls: \u001b[31m1\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/utils/menuHelpers.test.ts:117:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"imageModelMenu builds keyboard for Russian","status":"failed","title":"builds keyboard for Russian"},{"ancestorTitles":["imageModelMenu"],"duration":1,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m\"🎨 Choose a model for generation:\"\u001b[39m, \u001b[32mObjectContaining {\"reply_markup\": ObjectContaining {\"keyboard\": [[\"A\", \"B\"], [\"Cancel\", \"Help for the command\"], [\"🏠 Main menu\"]]}}\u001b[39m\nReceived: \u001b[2m\"🎨 Choose a model for generation:\"\u001b[22m, \u001b[31m{\"reply_markup\": {\"keyboard\": [[{\"hide\": false, \"text\": \"FLUX1.1 [pro]\"}, {\"hide\": false, \"text\": \"FLUX1.1 [pro] Ultra\"}], [{\"hide\": false, \"text\": \"FLUX1.1 [dev]\"}, {\"hide\": false, \"text\": \"FLUX1.1 [dev] Lora\"}], [{\"hide\": false, \"text\": \"FLUX1.1 [pro]\"}, {\"hide\": false, \"text\": \"FLUX1.1 [dev] Schnell\"}], [{\"hide\": false, \"text\": \"FLUX1.1 [dev] Schnell lora\"}, {\"hide\": false, \"text\": \"Ideogram\"}], [{\"hide\": false, \"text\": \"Ideogram Turbo\"}, {\"hide\": false, \"text\": \"Luma Photon\"}], [{\"hide\": false, \"text\": \"Luma Photon Flash\"}, {\"hide\": false, \"text\": \"Recraft 20b\"}], [{\"hide\": false, \"text\": \"Recraft V3\"}, {\"hide\": false, \"text\": \"Stable Diffusion 3\"}], [{\"hide\": false, \"text\": \"Stable Diffusion 3.5 Large\"}, {\"hide\": false, \"text\": \"Stable Diffusion 3.5 Large Turbo\"}], [{\"hide\": false, \"text\": \"Stable Diffusion 3.5 Medium\"}], [{\"hide\": false, \"text\": \"Cancel\"}, {\"hide\": false, \"text\": \"Help for the command\"}], …], \"one_time_keyboard\": true, \"resize_keyboard\": true}}\u001b[39m\n\nNumber of calls: \u001b[31m1\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/utils/menuHelpers.test.ts:135:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"imageModelMenu builds keyboard for English","status":"failed","title":"builds keyboard for English"},{"ancestorTitles":["createHelpCancelKeyboard"],"duration":0,"failureMessages":[],"fullName":"createHelpCancelKeyboard creates a keyboard with correct buttons for Russian","status":"passed","title":"creates a keyboard with correct buttons for Russian"},{"ancestorTitles":["createHelpCancelKeyboard"],"duration":0,"failureMessages":[],"fullName":"createHelpCancelKeyboard creates a keyboard with correct buttons for English","status":"passed","title":"creates a keyboard with correct buttons for English"}]},{"numFailingTests":12,"numPassingTests":6,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171895830,"runtime":10693,"slow":true,"start":1745171885137},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/registerCommands.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mregisterCommands › should register hears handlers for menu items\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32m[\"level_103_ru\", \"level_103_en\"]\u001b[39m, \u001b[32mAny<Function>\u001b[39m\n    Received\n           1\n            \u001b[2m  Array [\u001b[22m\n            \u001b[32m-   \"level_103_ru\",\u001b[39m\n            \u001b[32m-   \"level_103_en\",\u001b[39m\n            \u001b[31m+   \"💬 Техподдержка\",\u001b[39m\n            \u001b[31m+   \"💬 Support\",\u001b[39m\n            \u001b[2m  ]\u001b[22m,\n              \u001b[2m[Function anonymous]\u001b[22m,\n           2\n            \u001b[2m  Array [\u001b[22m\n            \u001b[32m-   \"level_103_ru\",\u001b[39m\n            \u001b[32m-   \"level_103_en\",\u001b[39m\n            \u001b[31m+   \"💫 Оформить подписку\",\u001b[39m\n            \u001b[31m+   \"💫 Subscribe\",\u001b[39m\n            \u001b[2m  ]\u001b[22m,\n              \u001b[2m[Function anonymous]\u001b[22m,\n           3\n            \u001b[2m  Array [\u001b[22m\n            \u001b[32m-   \"level_103_ru\",\u001b[39m\n            \u001b[32m-   \"level_103_en\",\u001b[39m\n            \u001b[31m+   \"💎 Пополнить баланс\",\u001b[39m\n            \u001b[31m+   \"💎 Top up balance\",\u001b[39m\n            \u001b[2m  ]\u001b[22m,\n              \u001b[2m[Function anonymous]\u001b[22m,\n\n    Number of calls: \u001b[31m4\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m  99 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 100 |\u001b[39m   it(\u001b[32m'should register hears handlers for menu items'\u001b[39m\u001b[33m,\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 101 |\u001b[39m     expect(bot\u001b[33m.\u001b[39mhears)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 102 |\u001b[39m       [levels[\u001b[35m103\u001b[39m]\u001b[33m.\u001b[39mtitle_ru\u001b[33m,\u001b[39m levels[\u001b[35m103\u001b[39m]\u001b[33m.\u001b[39mtitle_en]\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 103 |\u001b[39m       expect\u001b[33m.\u001b[39many(\u001b[33mFunction\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 104 |\u001b[39m     )\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/registerCommands.test.ts\u001b[39m\u001b[0m\u001b[2m:101:23)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mregisterCommands › command callbacks › /start should reset session and enter startScene\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n    \u001b[32m- Expected  -  1\u001b[39m\n    \u001b[31m+ Received  + 38\u001b[39m\n\n    \u001b[32m- Object {}\u001b[39m\n    \u001b[31m+ Object {\u001b[39m\n    \u001b[31m+   \"amount\": 0,\u001b[39m\n    \u001b[31m+   \"attempts\": 0,\u001b[39m\n    \u001b[31m+   \"audioUrl\": \"\",\u001b[39m\n    \u001b[31m+   \"buttons\": Array [],\u001b[39m\n    \u001b[31m+   \"cursor\": 0,\u001b[39m\n    \u001b[31m+   \"email\": \"\",\u001b[39m\n    \u001b[31m+   \"imageUrl\": \"\",\u001b[39m\n    \u001b[31m+   \"images\": Array [],\u001b[39m\n    \u001b[31m+   \"memory\": Object {\u001b[39m\n    \u001b[31m+     \"messages\": Array [],\u001b[39m\n    \u001b[31m+   },\u001b[39m\n    \u001b[31m+   \"mode\": \"start_scene\",\u001b[39m\n    \u001b[31m+   \"modelName\": \"\",\u001b[39m\n    \u001b[31m+   \"neuroPhotoInitialized\": false,\u001b[39m\n    \u001b[31m+   \"prompt\": \"\",\u001b[39m\n    \u001b[31m+   \"selectedModel\": \"\",\u001b[39m\n    \u001b[31m+   \"selectedPayment\": Object {\u001b[39m\n    \u001b[31m+     \"amount\": 0,\u001b[39m\n    \u001b[31m+     \"stars\": 0,\u001b[39m\n    \u001b[31m+     \"subscription\": \"stars\",\u001b[39m\n    \u001b[31m+     \"type\": \"system\",\u001b[39m\n    \u001b[31m+   },\u001b[39m\n    \u001b[31m+   \"selectedSize\": \"\",\u001b[39m\n    \u001b[31m+   \"steps\": 0,\u001b[39m\n    \u001b[31m+   \"subscription\": \"stars\",\u001b[39m\n    \u001b[31m+   \"targetUserId\": \"0\",\u001b[39m\n    \u001b[31m+   \"translations\": Array [],\u001b[39m\n    \u001b[31m+   \"triggerWord\": \"\",\u001b[39m\n    \u001b[31m+   \"userModel\": Object {\u001b[39m\n    \u001b[31m+     \"finetune_id\": \"\",\u001b[39m\n    \u001b[31m+     \"model_name\": \"\",\u001b[39m\n    \u001b[31m+     \"model_url\": \"placeholder/placeholder:placeholder\",\u001b[39m\n    \u001b[31m+     \"trigger_word\": \"\",\u001b[39m\n    \u001b[31m+   },\u001b[39m\n    \u001b[31m+   \"videoModel\": \"\",\u001b[39m\n    \u001b[31m+   \"videoUrl\": \"\",\u001b[39m\n    \u001b[31m+ }\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 122 |\u001b[39m       \u001b[36mconst\u001b[39m mockCtx \u001b[33m=\u001b[39m { session\u001b[33m:\u001b[39m { someData\u001b[33m:\u001b[39m \u001b[32m'test'\u001b[39m }\u001b[33m,\u001b[39m scene\u001b[33m:\u001b[39m { enter\u001b[33m:\u001b[39m jest\u001b[33m.\u001b[39mfn() } }\u001b[22m\n\u001b[2m     \u001b[90m 123 |\u001b[39m       \u001b[36mawait\u001b[39m startCallback(mockCtx)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 124 |\u001b[39m       expect(mockCtx\u001b[33m.\u001b[39msession)\u001b[33m.\u001b[39mtoEqual({}) \u001b[90m// Session should be reset\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                               \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 125 |\u001b[39m       expect(mockCtx\u001b[33m.\u001b[39mscene\u001b[33m.\u001b[39menter)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[33mModeEnum\u001b[39m\u001b[33m.\u001b[39m\u001b[33mStartScene\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 126 |\u001b[39m     })\u001b[22m\n\u001b[2m     \u001b[90m 127 |\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/registerCommands.test.ts\u001b[39m\u001b[0m\u001b[2m:124:31\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mregisterCommands › command callbacks › /menu should check subscription and enter correct scene (active)\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32m456\u001b[39m\n    Received: \u001b[31m\"456\"\u001b[39m\n\n    Number of calls: \u001b[31m1\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 146 |\u001b[39m       }\u001b[22m\n\u001b[2m     \u001b[90m 147 |\u001b[39m       \u001b[36mawait\u001b[39m menuCallback(mockCtx)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 148 |\u001b[39m       expect(getUserDetails)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[35m456\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                              \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 149 |\u001b[39m       expect(mockCtx\u001b[33m.\u001b[39mscene\u001b[33m.\u001b[39menter)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[33mModeEnum\u001b[39m\u001b[33m.\u001b[39m\u001b[33mMainMenu\u001b[39m) \u001b[90m// Должен войти в главное меню\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 150 |\u001b[39m     })\u001b[22m\n\u001b[2m     \u001b[90m 151 |\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/registerCommands.test.ts\u001b[39m\u001b[0m\u001b[2m:148:30\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mregisterCommands › command callbacks › /menu should check subscription and enter correct scene (inactive)\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32m789\u001b[39m\n    Received: \u001b[31m\"789\"\u001b[39m\n\n    Number of calls: \u001b[31m1\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 161 |\u001b[39m       }\u001b[22m\n\u001b[2m     \u001b[90m 162 |\u001b[39m       \u001b[36mawait\u001b[39m menuCallback(mockCtx)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 163 |\u001b[39m       expect(getUserDetails)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[35m789\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                              \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 164 |\u001b[39m       expect(mockCtx\u001b[33m.\u001b[39mscene\u001b[33m.\u001b[39menter)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[33mModeEnum\u001b[39m\u001b[33m.\u001b[39m\u001b[33mSubscriptionScene\u001b[39m) \u001b[90m// Должен войти в сцену подписки\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 165 |\u001b[39m     })\u001b[22m\n\u001b[2m     \u001b[90m 166 |\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/registerCommands.test.ts\u001b[39m\u001b[0m\u001b[2m:163:30\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mregisterCommands › command callbacks › /invite should reply with invite message\u001b[39m\u001b[22m\n\n    TypeError: Cannot read properties of undefined (reading 'enter')\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 215 |\u001b[39m   bot\u001b[33m.\u001b[39mcommand(\u001b[32m'invite'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m ctx \u001b[33m=>\u001b[39m {\u001b[22m\n\u001b[2m     \u001b[90m 216 |\u001b[39m     console\u001b[33m.\u001b[39mlog(\u001b[32m'CASE: invite'\u001b[39m)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 217 |\u001b[39m     \u001b[36mawait\u001b[39m ctx\u001b[33m.\u001b[39mscene\u001b[33m.\u001b[39menter(\u001b[32m'inviteScene'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                     \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 218 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 219 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 220 |\u001b[39m   bot\u001b[33m.\u001b[39mcommand(\u001b[32m'balance'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m ctx \u001b[33m=>\u001b[39m {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat enter (\u001b[22m\u001b[2msrc/registerCommands.ts\u001b[2m:217:21)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.__awaiter (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat __awaiter (\u001b[22m\u001b[2msrc/registerCommands.ts\u001b[2m:215:37)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/registerCommands.test.ts\u001b[39m\u001b[0m\u001b[2m:184:13\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.__awaiter (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/registerCommands.test.ts\u001b[39m\u001b[0m\u001b[2m:179:63)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mregisterCommands › command callbacks › /balance should reply with balance info\u001b[39m\u001b[22m\n\n    TypeError: Cannot read properties of undefined (reading 'enter')\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 220 |\u001b[39m   bot\u001b[33m.\u001b[39mcommand(\u001b[32m'balance'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m ctx \u001b[33m=>\u001b[39m {\u001b[22m\n\u001b[2m     \u001b[90m 221 |\u001b[39m     console\u001b[33m.\u001b[39mlog(\u001b[32m'CASE: balance'\u001b[39m)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 222 |\u001b[39m     \u001b[36mawait\u001b[39m ctx\u001b[33m.\u001b[39mscene\u001b[33m.\u001b[39menter(\u001b[32m'balanceScene'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                     \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 223 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 224 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 225 |\u001b[39m   bot\u001b[33m.\u001b[39mcommand(\u001b[32m'help'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m ctx \u001b[33m=>\u001b[39m {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat enter (\u001b[22m\u001b[2msrc/registerCommands.ts\u001b[2m:222:21)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.__awaiter (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat __awaiter (\u001b[22m\u001b[2msrc/registerCommands.ts\u001b[2m:220:38)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/registerCommands.test.ts\u001b[39m\u001b[0m\u001b[2m:193:13\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.__awaiter (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/registerCommands.test.ts\u001b[39m\u001b[0m\u001b[2m:188:62)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mregisterCommands › command callbacks › /help should reply with help message\u001b[39m\u001b[22m\n\n    TypeError: Cannot read properties of undefined (reading 'enter')\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 224 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 225 |\u001b[39m   bot\u001b[33m.\u001b[39mcommand(\u001b[32m'help'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m ctx \u001b[33m=>\u001b[39m {\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 226 |\u001b[39m     \u001b[36mawait\u001b[39m ctx\u001b[33m.\u001b[39mscene\u001b[33m.\u001b[39menter(\u001b[32m'step0'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                     \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 227 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 228 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 229 |\u001b[39m   bot\u001b[33m.\u001b[39mcommand(\u001b[32m'neuro_coder'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m ctx \u001b[33m=>\u001b[39m {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat enter (\u001b[22m\u001b[2msrc/registerCommands.ts\u001b[2m:226:21)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.__awaiter (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat __awaiter (\u001b[22m\u001b[2msrc/registerCommands.ts\u001b[2m:225:35)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/registerCommands.test.ts\u001b[39m\u001b[0m\u001b[2m:202:13\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.__awaiter (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/registerCommands.test.ts\u001b[39m\u001b[0m\u001b[2m:197:59)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mregisterCommands › command callbacks › /neuro_coder should reply with neuro_coder info\u001b[39m\u001b[22m\n\n    TypeError: Cannot read properties of undefined (reading 'enter')\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 228 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 229 |\u001b[39m   bot\u001b[33m.\u001b[39mcommand(\u001b[32m'neuro_coder'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m ctx \u001b[33m=>\u001b[39m {\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 230 |\u001b[39m     \u001b[36mawait\u001b[39m ctx\u001b[33m.\u001b[39mscene\u001b[33m.\u001b[39menter(\u001b[32m'neuroCoderScene'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                     \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 231 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 232 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 233 |\u001b[39m   \u001b[90m// --- РЕГИСТРАЦИЯ ГЛОБАЛЬНОГО ОБРАБОТЧИКА ДЛЯ ПОКУПКИ ЗВЕЗД ---\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat enter (\u001b[22m\u001b[2msrc/registerCommands.ts\u001b[2m:230:21)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.__awaiter (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat __awaiter (\u001b[22m\u001b[2msrc/registerCommands.ts\u001b[2m:229:42)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/registerCommands.test.ts\u001b[39m\u001b[0m\u001b[2m:211:13\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.__awaiter (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/registerCommands.test.ts\u001b[39m\u001b[0m\u001b[2m:206:70)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mregisterCommands › hears callbacks › support hears should call handleTechSupport\u001b[39m\u001b[22m\n\n    TypeError: Cannot read properties of undefined (reading '1')\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 218 |\u001b[39m       \u001b[36mconst\u001b[39m supportHearsCallback \u001b[33m=\u001b[39m bot\u001b[33m.\u001b[39mhears\u001b[33m.\u001b[39mmock\u001b[33m.\u001b[39mcalls\u001b[33m.\u001b[39mfind(\u001b[22m\n\u001b[2m     \u001b[90m 219 |\u001b[39m         (call\u001b[33m:\u001b[39m any) \u001b[33m=>\u001b[39m call[\u001b[35m0\u001b[39m][\u001b[35m0\u001b[39m] \u001b[33m===\u001b[39m levels[\u001b[35m103\u001b[39m]\u001b[33m.\u001b[39mtitle_ru\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 220 |\u001b[39m       )[\u001b[35m1\u001b[39m]\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m        \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 221 |\u001b[39m       \u001b[36mconst\u001b[39m mockCtx \u001b[33m=\u001b[39m {}\u001b[22m\n\u001b[2m     \u001b[90m 222 |\u001b[39m       \u001b[36mawait\u001b[39m supportHearsCallback(mockCtx)\u001b[22m\n\u001b[2m     \u001b[90m 223 |\u001b[39m       expect(handleTechSupport)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(mockCtx)\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/registerCommands.test.ts\u001b[39m\u001b[0m\u001b[2m:220:8\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.__awaiter (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/registerCommands.test.ts\u001b[39m\u001b[0m\u001b[2m:217:66)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mregisterCommands › hears callbacks › subscribe hears should enter SubscriptionScene\u001b[39m\u001b[22m\n\n    TypeError: Cannot read properties of undefined (reading '1')\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 227 |\u001b[39m       \u001b[36mconst\u001b[39m subscribeHearsCallback \u001b[33m=\u001b[39m bot\u001b[33m.\u001b[39mhears\u001b[33m.\u001b[39mmock\u001b[33m.\u001b[39mcalls\u001b[33m.\u001b[39mfind(\u001b[22m\n\u001b[2m     \u001b[90m 228 |\u001b[39m         (call\u001b[33m:\u001b[39m any) \u001b[33m=>\u001b[39m call[\u001b[35m0\u001b[39m][\u001b[35m0\u001b[39m] \u001b[33m===\u001b[39m levels[\u001b[35m105\u001b[39m]\u001b[33m.\u001b[39mtitle_ru\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 229 |\u001b[39m       )[\u001b[35m1\u001b[39m]\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m        \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 230 |\u001b[39m       \u001b[36mconst\u001b[39m mockCtx \u001b[33m=\u001b[39m { scene\u001b[33m:\u001b[39m { enter\u001b[33m:\u001b[39m jest\u001b[33m.\u001b[39mfn() } }\u001b[22m\n\u001b[2m     \u001b[90m 231 |\u001b[39m       \u001b[36mawait\u001b[39m subscribeHearsCallback(mockCtx)\u001b[22m\n\u001b[2m     \u001b[90m 232 |\u001b[39m       expect(mockCtx\u001b[33m.\u001b[39mscene\u001b[33m.\u001b[39menter)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[33mModeEnum\u001b[39m\u001b[33m.\u001b[39m\u001b[33mSubscriptionScene\u001b[39m)\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/registerCommands.test.ts\u001b[39m\u001b[0m\u001b[2m:229:8\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.__awaiter (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/registerCommands.test.ts\u001b[39m\u001b[0m\u001b[2m:226:69)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mregisterCommands › action callbacks › top_up action should enter PaymentScene with correct subscription type\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32m\"payment_scene\"\u001b[39m, \u001b[32m{\"subscriptionType\": \"stars\"}\u001b[39m\n\n    Number of calls: \u001b[31m0\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 248 |\u001b[39m       \u001b[36mawait\u001b[39m topUpActionCallback(mockCtx)\u001b[22m\n\u001b[2m     \u001b[90m 249 |\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 250 |\u001b[39m       expect(mockCtx\u001b[33m.\u001b[39mscene\u001b[33m.\u001b[39menter)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[33mModeEnum\u001b[39m\u001b[33m.\u001b[39m\u001b[33mPaymentScene\u001b[39m\u001b[33m,\u001b[39m {\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                                   \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 251 |\u001b[39m         subscriptionType\u001b[33m:\u001b[39m \u001b[32m'stars'\u001b[39m\u001b[33m,\u001b[39m \u001b[90m// Проверяем, что передается правильный тип подписки\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 252 |\u001b[39m       })\u001b[22m\n\u001b[2m     \u001b[90m 253 |\u001b[39m       expect(mockCtx\u001b[33m.\u001b[39manswerCbQuery)\u001b[33m.\u001b[39mtoHaveBeenCalled() \u001b[90m// Проверяем, что answerCbQuery был вызван\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/registerCommands.test.ts\u001b[39m\u001b[0m\u001b[2m:250:35\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mregisterCommands › command callbacks for /get100 › /get100 command should send \"get100\"\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32m\"get100\"\u001b[39m\n\n    Number of calls: \u001b[31m0\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 262 |\u001b[39m       \u001b[36mconst\u001b[39m mockCtx \u001b[33m=\u001b[39m { reply\u001b[33m:\u001b[39m jest\u001b[33m.\u001b[39mfn() }\u001b[22m\n\u001b[2m     \u001b[90m 263 |\u001b[39m       \u001b[36mawait\u001b[39m get100CommandCallback(mockCtx)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 264 |\u001b[39m       expect(mockCtx\u001b[33m.\u001b[39mreply)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[32m'get100'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                             \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 265 |\u001b[39m     })\u001b[22m\n\u001b[2m     \u001b[90m 266 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 267 |\u001b[39m })\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/registerCommands.test.ts\u001b[39m\u001b[0m\u001b[2m:264:29\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["registerCommands"],"duration":6,"failureMessages":[],"fullName":"registerCommands should register session middleware","status":"passed","title":"should register session middleware"},{"ancestorTitles":["registerCommands"],"duration":0,"failureMessages":[],"fullName":"registerCommands should register stage middleware","status":"passed","title":"should register stage middleware"},{"ancestorTitles":["registerCommands"],"duration":1,"failureMessages":[],"fullName":"registerCommands should register basic commands","status":"passed","title":"should register basic commands"},{"ancestorTitles":["registerCommands"],"duration":4,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m[\"level_103_ru\", \"level_103_en\"]\u001b[39m, \u001b[32mAny<Function>\u001b[39m\nReceived\n       1\n        \u001b[2m  Array [\u001b[22m\n        \u001b[32m-   \"level_103_ru\",\u001b[39m\n        \u001b[32m-   \"level_103_en\",\u001b[39m\n        \u001b[31m+   \"💬 Техподдержка\",\u001b[39m\n        \u001b[31m+   \"💬 Support\",\u001b[39m\n        \u001b[2m  ]\u001b[22m,\n          \u001b[2m[Function anonymous]\u001b[22m,\n       2\n        \u001b[2m  Array [\u001b[22m\n        \u001b[32m-   \"level_103_ru\",\u001b[39m\n        \u001b[32m-   \"level_103_en\",\u001b[39m\n        \u001b[31m+   \"💫 Оформить подписку\",\u001b[39m\n        \u001b[31m+   \"💫 Subscribe\",\u001b[39m\n        \u001b[2m  ]\u001b[22m,\n          \u001b[2m[Function anonymous]\u001b[22m,\n       3\n        \u001b[2m  Array [\u001b[22m\n        \u001b[32m-   \"level_103_ru\",\u001b[39m\n        \u001b[32m-   \"level_103_en\",\u001b[39m\n        \u001b[31m+   \"💎 Пополнить баланс\",\u001b[39m\n        \u001b[31m+   \"💎 Top up balance\",\u001b[39m\n        \u001b[2m  ]\u001b[22m,\n          \u001b[2m[Function anonymous]\u001b[22m,\n\nNumber of calls: \u001b[31m4\u001b[39m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/registerCommands.test.ts:101:23)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"registerCommands should register hears handlers for menu items","status":"failed","title":"should register hears handlers for menu items"},{"ancestorTitles":["registerCommands"],"duration":1,"failureMessages":[],"fullName":"registerCommands should register action handler for top_up","status":"passed","title":"should register action handler for top_up"},{"ancestorTitles":["registerCommands","command callbacks"],"duration":2,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n\u001b[32m- Expected  -  1\u001b[39m\n\u001b[31m+ Received  + 38\u001b[39m\n\n\u001b[32m- Object {}\u001b[39m\n\u001b[31m+ Object {\u001b[39m\n\u001b[31m+   \"amount\": 0,\u001b[39m\n\u001b[31m+   \"attempts\": 0,\u001b[39m\n\u001b[31m+   \"audioUrl\": \"\",\u001b[39m\n\u001b[31m+   \"buttons\": Array [],\u001b[39m\n\u001b[31m+   \"cursor\": 0,\u001b[39m\n\u001b[31m+   \"email\": \"\",\u001b[39m\n\u001b[31m+   \"imageUrl\": \"\",\u001b[39m\n\u001b[31m+   \"images\": Array [],\u001b[39m\n\u001b[31m+   \"memory\": Object {\u001b[39m\n\u001b[31m+     \"messages\": Array [],\u001b[39m\n\u001b[31m+   },\u001b[39m\n\u001b[31m+   \"mode\": \"start_scene\",\u001b[39m\n\u001b[31m+   \"modelName\": \"\",\u001b[39m\n\u001b[31m+   \"neuroPhotoInitialized\": false,\u001b[39m\n\u001b[31m+   \"prompt\": \"\",\u001b[39m\n\u001b[31m+   \"selectedModel\": \"\",\u001b[39m\n\u001b[31m+   \"selectedPayment\": Object {\u001b[39m\n\u001b[31m+     \"amount\": 0,\u001b[39m\n\u001b[31m+     \"stars\": 0,\u001b[39m\n\u001b[31m+     \"subscription\": \"stars\",\u001b[39m\n\u001b[31m+     \"type\": \"system\",\u001b[39m\n\u001b[31m+   },\u001b[39m\n\u001b[31m+   \"selectedSize\": \"\",\u001b[39m\n\u001b[31m+   \"steps\": 0,\u001b[39m\n\u001b[31m+   \"subscription\": \"stars\",\u001b[39m\n\u001b[31m+   \"targetUserId\": \"0\",\u001b[39m\n\u001b[31m+   \"translations\": Array [],\u001b[39m\n\u001b[31m+   \"triggerWord\": \"\",\u001b[39m\n\u001b[31m+   \"userModel\": Object {\u001b[39m\n\u001b[31m+     \"finetune_id\": \"\",\u001b[39m\n\u001b[31m+     \"model_name\": \"\",\u001b[39m\n\u001b[31m+     \"model_url\": \"placeholder/placeholder:placeholder\",\u001b[39m\n\u001b[31m+     \"trigger_word\": \"\",\u001b[39m\n\u001b[31m+   },\u001b[39m\n\u001b[31m+   \"videoModel\": \"\",\u001b[39m\n\u001b[31m+   \"videoUrl\": \"\",\u001b[39m\n\u001b[31m+ }\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/registerCommands.test.ts:124:31\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"registerCommands command callbacks /start should reset session and enter startScene","status":"failed","title":"/start should reset session and enter startScene"},{"ancestorTitles":["registerCommands","command callbacks"],"duration":1,"failureMessages":[],"fullName":"registerCommands command callbacks /support should call handleTechSupport","status":"passed","title":"/support should call handleTechSupport"},{"ancestorTitles":["registerCommands","command callbacks"],"duration":1,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m456\u001b[39m\nReceived: \u001b[31m\"456\"\u001b[39m\n\nNumber of calls: \u001b[31m1\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/registerCommands.test.ts:148:30\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"registerCommands command callbacks /menu should check subscription and enter correct scene (active)","status":"failed","title":"/menu should check subscription and enter correct scene (active)"},{"ancestorTitles":["registerCommands","command callbacks"],"duration":1,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m789\u001b[39m\nReceived: \u001b[31m\"789\"\u001b[39m\n\nNumber of calls: \u001b[31m1\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/registerCommands.test.ts:163:30\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"registerCommands command callbacks /menu should check subscription and enter correct scene (inactive)","status":"failed","title":"/menu should check subscription and enter correct scene (inactive)"},{"ancestorTitles":["registerCommands","command callbacks"],"duration":2,"failureMessages":[],"fullName":"registerCommands command callbacks /buy should set session and enter payment scene","status":"passed","title":"/buy should set session and enter payment scene"},{"ancestorTitles":["registerCommands","command callbacks"],"duration":1,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'enter')\n    at enter (/Users/playra/999-multibots-telegraf/src/registerCommands.ts:217:21)\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at __awaiter (/Users/playra/999-multibots-telegraf/src/registerCommands.ts:215:37)\n    at /Users/playra/999-multibots-telegraf/__tests__/registerCommands.test.ts:184:13\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/registerCommands.test.ts:179:63)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"registerCommands command callbacks /invite should reply with invite message","status":"failed","title":"/invite should reply with invite message"},{"ancestorTitles":["registerCommands","command callbacks"],"duration":1,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'enter')\n    at enter (/Users/playra/999-multibots-telegraf/src/registerCommands.ts:222:21)\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at __awaiter (/Users/playra/999-multibots-telegraf/src/registerCommands.ts:220:38)\n    at /Users/playra/999-multibots-telegraf/__tests__/registerCommands.test.ts:193:13\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/registerCommands.test.ts:188:62)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"registerCommands command callbacks /balance should reply with balance info","status":"failed","title":"/balance should reply with balance info"},{"ancestorTitles":["registerCommands","command callbacks"],"duration":0,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'enter')\n    at enter (/Users/playra/999-multibots-telegraf/src/registerCommands.ts:226:21)\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at __awaiter (/Users/playra/999-multibots-telegraf/src/registerCommands.ts:225:35)\n    at /Users/playra/999-multibots-telegraf/__tests__/registerCommands.test.ts:202:13\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/registerCommands.test.ts:197:59)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"registerCommands command callbacks /help should reply with help message","status":"failed","title":"/help should reply with help message"},{"ancestorTitles":["registerCommands","command callbacks"],"duration":1,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'enter')\n    at enter (/Users/playra/999-multibots-telegraf/src/registerCommands.ts:230:21)\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at __awaiter (/Users/playra/999-multibots-telegraf/src/registerCommands.ts:229:42)\n    at /Users/playra/999-multibots-telegraf/__tests__/registerCommands.test.ts:211:13\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/registerCommands.test.ts:206:70)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"registerCommands command callbacks /neuro_coder should reply with neuro_coder info","status":"failed","title":"/neuro_coder should reply with neuro_coder info"},{"ancestorTitles":["registerCommands","hears callbacks"],"duration":0,"failureMessages":["TypeError: Cannot read properties of undefined (reading '1')\n    at /Users/playra/999-multibots-telegraf/__tests__/registerCommands.test.ts:220:8\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/registerCommands.test.ts:217:66)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"registerCommands hears callbacks support hears should call handleTechSupport","status":"failed","title":"support hears should call handleTechSupport"},{"ancestorTitles":["registerCommands","hears callbacks"],"duration":1,"failureMessages":["TypeError: Cannot read properties of undefined (reading '1')\n    at /Users/playra/999-multibots-telegraf/__tests__/registerCommands.test.ts:229:8\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/registerCommands.test.ts:226:69)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"registerCommands hears callbacks subscribe hears should enter SubscriptionScene","status":"failed","title":"subscribe hears should enter SubscriptionScene"},{"ancestorTitles":["registerCommands","action callbacks"],"duration":11,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m\"payment_scene\"\u001b[39m, \u001b[32m{\"subscriptionType\": \"stars\"}\u001b[39m\n\nNumber of calls: \u001b[31m0\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/registerCommands.test.ts:250:35\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"registerCommands action callbacks top_up action should enter PaymentScene with correct subscription type","status":"failed","title":"top_up action should enter PaymentScene with correct subscription type"},{"ancestorTitles":["registerCommands","command callbacks for /get100"],"duration":7,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m\"get100\"\u001b[39m\n\nNumber of calls: \u001b[31m0\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/registerCommands.test.ts:264:29\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"registerCommands command callbacks for /get100 /get100 command should send \"get100\"","status":"failed","title":"/get100 command should send \"get100\""}]},{"numFailingTests":1,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171896048,"runtime":191,"slow":false,"start":1745171895857},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/services/generateNeuroImage.prod.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mgenerateNeuroImage production branch › uses ELESTIO_URL when isDev is false\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n    Expected: \u001b[32m{\"data\": \"prodOK\"}\u001b[39m\n    Received: \u001b[31mnull\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 20 |\u001b[39m     \u001b[36mconst\u001b[39m ctx \u001b[33m=\u001b[39m { session\u001b[33m:\u001b[39m { prompt\u001b[33m:\u001b[39m \u001b[32m'p'\u001b[39m\u001b[33m,\u001b[39m userModel\u001b[33m:\u001b[39m \u001b[32m'm'\u001b[39m }\u001b[33m,\u001b[39m \u001b[36mfrom\u001b[39m\u001b[33m:\u001b[39m { username\u001b[33m:\u001b[39m \u001b[32m'u'\u001b[39m }\u001b[33m,\u001b[39m reply\u001b[33m:\u001b[39m jest\u001b[33m.\u001b[39mfn() }\u001b[22m\n\u001b[2m     \u001b[90m 21 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m generateNeuroImage(\u001b[32m'prompt'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'modelUrl'\u001b[39m\u001b[33m,\u001b[39m \u001b[35m1\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'tid'\u001b[39m\u001b[33m,\u001b[39m ctx\u001b[33m,\u001b[39m \u001b[32m'bot'\u001b[39m)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 22 |\u001b[39m     expect(res)\u001b[33m.\u001b[39mtoEqual({ data\u001b[33m:\u001b[39m \u001b[32m'prodOK'\u001b[39m })\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                 \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 23 |\u001b[39m     expect(axios\u001b[33m.\u001b[39mpost)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[22m\n\u001b[2m     \u001b[90m 24 |\u001b[39m       \u001b[32m'https://api.example.com/generate/neuro-photo'\u001b[39m\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 25 |\u001b[39m       expect\u001b[33m.\u001b[39many(\u001b[33mObject\u001b[39m)\u001b[33m,\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/services/generateNeuroImage.prod.test.ts\u001b[39m\u001b[0m\u001b[2m:22:17)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/services/generateNeuroImage.prod.test.ts\u001b[39m\u001b[0m\u001b[2m:4:58)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["generateNeuroImage production branch"],"duration":32,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\nExpected: \u001b[32m{\"data\": \"prodOK\"}\u001b[39m\nReceived: \u001b[31mnull\u001b[39m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/services/generateNeuroImage.prod.test.ts:22:17)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/__tests__/services/generateNeuroImage.prod.test.ts:4:58)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"generateNeuroImage production branch uses ELESTIO_URL when isDev is false","status":"failed","title":"uses ELESTIO_URL when isDev is false"}]},{"numFailingTests":5,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171896077,"runtime":199,"slow":false,"start":1745171895878},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/services/generateNeuroImage.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mgenerateNeuroImage › throws error when ctx.session.prompt missing\u001b[39m\u001b[22m\n\n    supabaseUrl is required.\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m  9 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 10 |\u001b[39m \u001b[90m// Создаем клиент с service role key\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 11 |\u001b[39m \u001b[36mexport\u001b[39m \u001b[36mconst\u001b[39m supabase \u001b[33m=\u001b[39m createClient(\u001b[33mSUPABASE_URL\u001b[39m\u001b[33m,\u001b[39m \u001b[33mSUPABASE_SERVICE_KEY\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                     \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 12 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 13 |\u001b[39m \u001b[36mexport\u001b[39m \u001b[36mconst\u001b[39m supabaseAdmin \u001b[33m=\u001b[39m createClient(\u001b[22m\n\u001b[2m     \u001b[90m 14 |\u001b[39m   \u001b[33mSUPABASE_URL\u001b[39m\u001b[33m,\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat new SupabaseClient (\u001b[22m\u001b[2mnode_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/SupabaseClient.ts\u001b[2m:75:29)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat createClient (\u001b[22m\u001b[2mnode_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/index.ts\u001b[2m:40:10)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2msrc/core/supabase/client.ts\u001b[2m:11:37)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/core/supabase/index.ts\u001b[2m:1:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/core/bot/index.ts\u001b[2m:10:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/services/generateNeuroPhotoDirect.ts\u001b[2m:5:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/services/generateNeuroImage.ts\u001b[2m:1:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/services/generateNeuroImage.test.ts\u001b[39m\u001b[0m\u001b[2m:34:26)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mgenerateNeuroImage › throws error when ctx.session.userModel missing\u001b[39m\u001b[22m\n\n    supabaseUrl is required.\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m  9 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 10 |\u001b[39m \u001b[90m// Создаем клиент с service role key\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 11 |\u001b[39m \u001b[36mexport\u001b[39m \u001b[36mconst\u001b[39m supabase \u001b[33m=\u001b[39m createClient(\u001b[33mSUPABASE_URL\u001b[39m\u001b[33m,\u001b[39m \u001b[33mSUPABASE_SERVICE_KEY\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                     \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 12 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 13 |\u001b[39m \u001b[36mexport\u001b[39m \u001b[36mconst\u001b[39m supabaseAdmin \u001b[33m=\u001b[39m createClient(\u001b[22m\n\u001b[2m     \u001b[90m 14 |\u001b[39m   \u001b[33mSUPABASE_URL\u001b[39m\u001b[33m,\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat new SupabaseClient (\u001b[22m\u001b[2mnode_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/SupabaseClient.ts\u001b[2m:75:29)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat createClient (\u001b[22m\u001b[2mnode_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/index.ts\u001b[2m:40:10)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2msrc/core/supabase/client.ts\u001b[2m:11:37)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/core/supabase/index.ts\u001b[2m:1:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/core/bot/index.ts\u001b[2m:10:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/services/generateNeuroPhotoDirect.ts\u001b[2m:5:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/services/generateNeuroImage.ts\u001b[2m:1:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/services/generateNeuroImage.test.ts\u001b[39m\u001b[0m\u001b[2m:34:26)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mgenerateNeuroImage › throws error when numImages is zero\u001b[39m\u001b[22m\n\n    supabaseUrl is required.\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m  9 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 10 |\u001b[39m \u001b[90m// Создаем клиент с service role key\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 11 |\u001b[39m \u001b[36mexport\u001b[39m \u001b[36mconst\u001b[39m supabase \u001b[33m=\u001b[39m createClient(\u001b[33mSUPABASE_URL\u001b[39m\u001b[33m,\u001b[39m \u001b[33mSUPABASE_SERVICE_KEY\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                     \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 12 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 13 |\u001b[39m \u001b[36mexport\u001b[39m \u001b[36mconst\u001b[39m supabaseAdmin \u001b[33m=\u001b[39m createClient(\u001b[22m\n\u001b[2m     \u001b[90m 14 |\u001b[39m   \u001b[33mSUPABASE_URL\u001b[39m\u001b[33m,\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat new SupabaseClient (\u001b[22m\u001b[2mnode_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/SupabaseClient.ts\u001b[2m:75:29)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat createClient (\u001b[22m\u001b[2mnode_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/index.ts\u001b[2m:40:10)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2msrc/core/supabase/client.ts\u001b[2m:11:37)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/core/supabase/index.ts\u001b[2m:1:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/core/bot/index.ts\u001b[2m:10:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/services/generateNeuroPhotoDirect.ts\u001b[2m:5:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/services/generateNeuroImage.ts\u001b[2m:1:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/services/generateNeuroImage.test.ts\u001b[39m\u001b[0m\u001b[2m:34:26)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mgenerateNeuroImage › calls axios.post and returns data on success\u001b[39m\u001b[22m\n\n    supabaseUrl is required.\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m  9 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 10 |\u001b[39m \u001b[90m// Создаем клиент с service role key\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 11 |\u001b[39m \u001b[36mexport\u001b[39m \u001b[36mconst\u001b[39m supabase \u001b[33m=\u001b[39m createClient(\u001b[33mSUPABASE_URL\u001b[39m\u001b[33m,\u001b[39m \u001b[33mSUPABASE_SERVICE_KEY\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                     \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 12 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 13 |\u001b[39m \u001b[36mexport\u001b[39m \u001b[36mconst\u001b[39m supabaseAdmin \u001b[33m=\u001b[39m createClient(\u001b[22m\n\u001b[2m     \u001b[90m 14 |\u001b[39m   \u001b[33mSUPABASE_URL\u001b[39m\u001b[33m,\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat new SupabaseClient (\u001b[22m\u001b[2mnode_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/SupabaseClient.ts\u001b[2m:75:29)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat createClient (\u001b[22m\u001b[2mnode_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/index.ts\u001b[2m:40:10)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2msrc/core/supabase/client.ts\u001b[2m:11:37)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/core/supabase/index.ts\u001b[2m:1:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/core/bot/index.ts\u001b[2m:10:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/services/generateNeuroPhotoDirect.ts\u001b[2m:5:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/services/generateNeuroImage.ts\u001b[2m:1:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/services/generateNeuroImage.test.ts\u001b[39m\u001b[0m\u001b[2m:34:26)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mgenerateNeuroImage › handles axios error, logs and replies\u001b[39m\u001b[22m\n\n    supabaseUrl is required.\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m  9 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 10 |\u001b[39m \u001b[90m// Создаем клиент с service role key\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 11 |\u001b[39m \u001b[36mexport\u001b[39m \u001b[36mconst\u001b[39m supabase \u001b[33m=\u001b[39m createClient(\u001b[33mSUPABASE_URL\u001b[39m\u001b[33m,\u001b[39m \u001b[33mSUPABASE_SERVICE_KEY\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                     \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 12 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 13 |\u001b[39m \u001b[36mexport\u001b[39m \u001b[36mconst\u001b[39m supabaseAdmin \u001b[33m=\u001b[39m createClient(\u001b[22m\n\u001b[2m     \u001b[90m 14 |\u001b[39m   \u001b[33mSUPABASE_URL\u001b[39m\u001b[33m,\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat new SupabaseClient (\u001b[22m\u001b[2mnode_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/SupabaseClient.ts\u001b[2m:75:29)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat createClient (\u001b[22m\u001b[2mnode_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/index.ts\u001b[2m:40:10)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2msrc/core/supabase/client.ts\u001b[2m:11:37)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/core/supabase/index.ts\u001b[2m:1:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/core/bot/index.ts\u001b[2m:10:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/services/generateNeuroPhotoDirect.ts\u001b[2m:5:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/services/generateNeuroImage.ts\u001b[2m:1:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/services/generateNeuroImage.test.ts\u001b[39m\u001b[0m\u001b[2m:34:26)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["generateNeuroImage"],"duration":34,"failureMessages":["Error: supabaseUrl is required.\n    at new SupabaseClient (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/SupabaseClient.ts:75:29)\n    at createClient (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/index.ts:40:10)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/src/core/supabase/client.ts:11:37)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/core/supabase/index.ts:1:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/core/bot/index.ts:10:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/services/generateNeuroPhotoDirect.ts:5:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/services/generateNeuroImage.ts:1:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/services/generateNeuroImage.test.ts:34:26)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusHook (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:281:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:246:5)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"generateNeuroImage throws error when ctx.session.prompt missing","status":"failed","title":"throws error when ctx.session.prompt missing"},{"ancestorTitles":["generateNeuroImage"],"duration":35,"failureMessages":["Error: supabaseUrl is required.\n    at new SupabaseClient (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/SupabaseClient.ts:75:29)\n    at createClient (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/index.ts:40:10)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/src/core/supabase/client.ts:11:37)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/core/supabase/index.ts:1:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/core/bot/index.ts:10:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/services/generateNeuroPhotoDirect.ts:5:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/services/generateNeuroImage.ts:1:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/services/generateNeuroImage.test.ts:34:26)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusHook (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:281:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:246:5)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"generateNeuroImage throws error when ctx.session.userModel missing","status":"failed","title":"throws error when ctx.session.userModel missing"},{"ancestorTitles":["generateNeuroImage"],"duration":27,"failureMessages":["Error: supabaseUrl is required.\n    at new SupabaseClient (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/SupabaseClient.ts:75:29)\n    at createClient (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/index.ts:40:10)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/src/core/supabase/client.ts:11:37)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/core/supabase/index.ts:1:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/core/bot/index.ts:10:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/services/generateNeuroPhotoDirect.ts:5:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/services/generateNeuroImage.ts:1:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/services/generateNeuroImage.test.ts:34:26)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusHook (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:281:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:246:5)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"generateNeuroImage throws error when numImages is zero","status":"failed","title":"throws error when numImages is zero"},{"ancestorTitles":["generateNeuroImage"],"duration":24,"failureMessages":["Error: supabaseUrl is required.\n    at new SupabaseClient (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/SupabaseClient.ts:75:29)\n    at createClient (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/index.ts:40:10)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/src/core/supabase/client.ts:11:37)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/core/supabase/index.ts:1:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/core/bot/index.ts:10:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/services/generateNeuroPhotoDirect.ts:5:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/services/generateNeuroImage.ts:1:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/services/generateNeuroImage.test.ts:34:26)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusHook (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:281:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:246:5)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"generateNeuroImage calls axios.post and returns data on success","status":"failed","title":"calls axios.post and returns data on success"},{"ancestorTitles":["generateNeuroImage"],"duration":21,"failureMessages":["Error: supabaseUrl is required.\n    at new SupabaseClient (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/SupabaseClient.ts:75:29)\n    at createClient (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/index.ts:40:10)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/src/core/supabase/client.ts:11:37)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/core/supabase/index.ts:1:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/core/bot/index.ts:10:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/services/generateNeuroPhotoDirect.ts:5:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/services/generateNeuroImage.ts:1:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/services/generateNeuroImage.test.ts:34:26)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusHook (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:281:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:246:5)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"generateNeuroImage handles axios error, logs and replies","status":"failed","title":"handles axios error, logs and replies"}]},{"numFailingTests":1,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171896249,"runtime":137,"slow":false,"start":1745171896112},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/bot/createBotByName.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mcreateBotByName › returns undefined and logs error when bot instance not found\u001b[39m\u001b[22m\n\n    Property `error` does not exist in the provided object\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 51 |\u001b[39m     \u001b[90m// Spy on logger.error\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 52 |\u001b[39m     \u001b[36mconst\u001b[39m logger \u001b[33m=\u001b[39m require(\u001b[32m'@/utils/logger'\u001b[39m)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 53 |\u001b[39m     \u001b[36mconst\u001b[39m spyErr \u001b[33m=\u001b[39m jest\u001b[33m.\u001b[39mspyOn(logger\u001b[33m,\u001b[39m \u001b[32m'error'\u001b[39m)\u001b[33m.\u001b[39mmockImplementation(() \u001b[33m=>\u001b[39m {})\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                         \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 54 |\u001b[39m     \u001b[36mconst\u001b[39m result \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m createBotByName(botName)\u001b[22m\n\u001b[2m     \u001b[90m 55 |\u001b[39m     expect(result)\u001b[33m.\u001b[39mtoBeUndefined()\u001b[22m\n\u001b[2m     \u001b[90m 56 |\u001b[39m     expect(spyErr)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat ModuleMocker.spyOn (\u001b[22m\u001b[2mnode_modules/.pnpm/jest-mock@29.7.0/node_modules/jest-mock/build/index.js\u001b[2m:731:13)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/bot/createBotByName.test.ts\u001b[39m\u001b[0m\u001b[2m:53:25)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/bot/createBotByName.test.ts\u001b[39m\u001b[0m\u001b[2m:7:71\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous>.__awaiter (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/bot/createBotByName.test.ts\u001b[39m\u001b[0m\u001b[2m:3:12)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/bot/createBotByName.test.ts\u001b[39m\u001b[0m\u001b[2m:43:81)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["createBotByName"],"duration":43,"failureMessages":[],"fullName":"createBotByName returns token, groupId and bot for valid bot name","status":"passed","title":"returns token, groupId and bot for valid bot name"},{"ancestorTitles":["createBotByName"],"duration":34,"failureMessages":[],"fullName":"createBotByName returns undefined for invalid bot name","status":"passed","title":"returns undefined for invalid bot name"},{"ancestorTitles":["createBotByName"],"duration":39,"failureMessages":["Error: Property `error` does not exist in the provided object\n    at ModuleMocker.spyOn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-mock@29.7.0/node_modules/jest-mock/build/index.js:731:13)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/bot/createBotByName.test.ts:53:25)\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/__tests__/core/bot/createBotByName.test.ts:7:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/playra/999-multibots-telegraf/__tests__/core/bot/createBotByName.test.ts:3:12)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/bot/createBotByName.test.ts:43:81)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"createBotByName returns undefined and logs error when bot instance not found","status":"failed","title":"returns undefined and logs error when bot instance not found"}]},{"numFailingTests":1,"numPassingTests":10,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171896232,"runtime":117,"slow":false,"start":1745171896115},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/price/helpers.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mPrice Helpers › calculateFinalPrice: computes final stars price for video models\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\n    Expected: \u001b[32m34\u001b[39m\n    Received: \u001b[31m46\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 36 |\u001b[39m   it(\u001b[32m'calculateFinalPrice: computes final stars price for video models'\u001b[39m\u001b[33m,\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[22m\n\u001b[2m     \u001b[90m 37 |\u001b[39m     \u001b[90m// For 'minimax': basePrice=0.5, interestRate=0.1 => 0.55 USD, /starCost=0.55/0.016=34.375 => floor=34\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 38 |\u001b[39m     expect(calculateFinalPrice(\u001b[32m'minimax'\u001b[39m))\u001b[33m.\u001b[39mtoBe(\u001b[35m34\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                            \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 39 |\u001b[39m     \u001b[90m// For 'haiper': basePrice=0.05, interestRate=0.1 => 0.055 USD, /0.016=3.4375 => floor=3\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 40 |\u001b[39m     expect(calculateFinalPrice(\u001b[32m'haiper'\u001b[39m))\u001b[33m.\u001b[39mtoBe(\u001b[35m3\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 41 |\u001b[39m   })\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/price/helpers.test.ts\u001b[39m\u001b[0m\u001b[2m:38:44)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["Price Helpers"],"duration":1,"failureMessages":[],"fullName":"Price Helpers calcStarsFromDollars: should convert dollars to stars using starCost","status":"passed","title":"calcStarsFromDollars: should convert dollars to stars using starCost"},{"ancestorTitles":["Price Helpers"],"duration":0,"failureMessages":[],"fullName":"Price Helpers calculateStars: floors the division of amount by star cost","status":"passed","title":"calculateStars: floors the division of amount by star cost"},{"ancestorTitles":["Price Helpers"],"duration":0,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32m34\u001b[39m\nReceived: \u001b[31m46\u001b[39m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/price/helpers.test.ts:38:44)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"Price Helpers calculateFinalPrice: computes final stars price for video models","status":"failed","title":"calculateFinalPrice: computes final stars price for video models"},{"ancestorTitles":["Price Helpers"],"duration":1,"failureMessages":[],"fullName":"Price Helpers training cost helpers: cost in stars, dollars, rubles","status":"passed","title":"training cost helpers: cost in stars, dollars, rubles"},{"ancestorTitles":["validateAndCalculateImageModelPrice"],"duration":0,"failureMessages":[],"fullName":"validateAndCalculateImageModelPrice returns null and prompts when model is invalid","status":"passed","title":"returns null and prompts when model is invalid"},{"ancestorTitles":["validateAndCalculateImageModelPrice"],"duration":2,"failureMessages":[],"fullName":"validateAndCalculateImageModelPrice returns null and prompts when costPerImage missing","status":"passed","title":"returns null and prompts when costPerImage missing"},{"ancestorTitles":["validateAndCalculateImageModelPrice"],"duration":1,"failureMessages":[],"fullName":"validateAndCalculateImageModelPrice returns null when balance is insufficient","status":"passed","title":"returns null when balance is insufficient"},{"ancestorTitles":["validateAndCalculateImageModelPrice"],"duration":1,"failureMessages":[],"fullName":"validateAndCalculateImageModelPrice returns price and sets session when sufficient balance","status":"passed","title":"returns price and sets session when sufficient balance"},{"ancestorTitles":["validateAndCalculateVideoModelPrice"],"duration":1,"failureMessages":[],"fullName":"validateAndCalculateVideoModelPrice returns null and prompts when model is invalid","status":"passed","title":"returns null and prompts when model is invalid"},{"ancestorTitles":["validateAndCalculateVideoModelPrice"],"duration":0,"failureMessages":[],"fullName":"validateAndCalculateVideoModelPrice returns null when balance is insufficient","status":"passed","title":"returns null when balance is insufficient"},{"ancestorTitles":["validateAndCalculateVideoModelPrice"],"duration":1,"failureMessages":[],"fullName":"validateAndCalculateVideoModelPrice returns price and sets session when sufficient balance","status":"passed","title":"returns price and sets session when sufficient balance"}]},{"numFailingTests":3,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171896261,"runtime":288,"slow":false,"start":1745171895973},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mupdateUserSubscription › updates subscription and returns data on success\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n    Expected: \u001b[32m[{\"subscription\": \"vip\"}]\u001b[39m\n    Received: \u001b[31mundefined\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 24 |\u001b[39m     builder\u001b[33m.\u001b[39meq\u001b[33m.\u001b[39mmockResolvedValue({ data\u001b[33m:\u001b[39m resultData\u001b[33m,\u001b[39m error\u001b[33m:\u001b[39m \u001b[36mnull\u001b[39m })\u001b[22m\n\u001b[2m     \u001b[90m 25 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m updateUserSubscription(userId\u001b[33m,\u001b[39m subscription)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 26 |\u001b[39m     expect(res)\u001b[33m.\u001b[39mtoEqual(resultData)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                 \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 27 |\u001b[39m     \u001b[36mconst\u001b[39m { supabase } \u001b[33m=\u001b[39m require(\u001b[32m'@/core/supabase'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 28 |\u001b[39m     expect(supabase\u001b[33m.\u001b[39m\u001b[36mfrom\u001b[39m)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[32m'users'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 29 |\u001b[39m     expect(builder\u001b[33m.\u001b[39mupdate)\u001b[33m.\u001b[39mtoHaveBeenCalledWith({ subscription })\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/updateUserSubscription.test.ts\u001b[39m\u001b[0m\u001b[2m:26:17)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/updateUserSubscription.test.ts\u001b[39m\u001b[0m\u001b[2m:4:58)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mupdateUserSubscription › throws and logs error when update error occurs\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n    \u001b[32m- Expected  - 3\u001b[39m\n    \u001b[31m+ Received  + 1\u001b[39m\n\n    \u001b[32m- Object {\u001b[39m\n    \u001b[32m-   \"message\": \"fail\",\u001b[39m\n    \u001b[32m- }\u001b[39m\n    \u001b[31m+ [Error: Не удалось обновить подписку пользователя]\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 34 |\u001b[39m     \u001b[36mconst\u001b[39m err \u001b[33m=\u001b[39m { message\u001b[33m:\u001b[39m \u001b[32m'fail'\u001b[39m }\u001b[22m\n\u001b[2m     \u001b[90m 35 |\u001b[39m     builder\u001b[33m.\u001b[39meq\u001b[33m.\u001b[39mmockResolvedValue({ data\u001b[33m:\u001b[39m \u001b[36mnull\u001b[39m\u001b[33m,\u001b[39m error\u001b[33m:\u001b[39m err })\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 36 |\u001b[39m     \u001b[36mawait\u001b[39m expect(updateUserSubscription(userId\u001b[33m,\u001b[39m subscription))\u001b[33m.\u001b[39mrejects\u001b[33m.\u001b[39mtoEqual(err)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                                                        \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 37 |\u001b[39m     expect(console\u001b[33m.\u001b[39merror)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[32m'Error updating subscription:'\u001b[39m\u001b[33m,\u001b[39m err)\u001b[22m\n\u001b[2m     \u001b[90m 38 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 39 |\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.toEqual (\u001b[22m\u001b[2mnode_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js\u001b[2m:218:22)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/updateUserSubscription.test.ts\u001b[39m\u001b[0m\u001b[2m:36:72)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/updateUserSubscription.test.ts\u001b[39m\u001b[0m\u001b[2m:7:71\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous>.__awaiter (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/updateUserSubscription.test.ts\u001b[39m\u001b[0m\u001b[2m:3:12)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/updateUserSubscription.test.ts\u001b[39m\u001b[0m\u001b[2m:33:67)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mupdateUserSubscription › throws and logs error when exception occurs\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected substring: \u001b[32m\"oops\"\u001b[39m\n    Received message:   \u001b[31m\"Не удалось обновить подписку пользователя\"\u001b[39m\n\n        \u001b[0m \u001b[90m 17 |\u001b[39m   } \u001b[36mcatch\u001b[39m (error) {\n         \u001b[90m 18 |\u001b[39m     console\u001b[33m.\u001b[39merror(\u001b[32m'Ошибка при обновлении подписки пользователя:'\u001b[39m\u001b[33m,\u001b[39m error)\n        \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 19 |\u001b[39m     \u001b[36mthrow\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(\u001b[32m'Не удалось обновить подписку пользователя'\u001b[39m)\n         \u001b[90m    |\u001b[39m           \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n         \u001b[90m 20 |\u001b[39m   }\n         \u001b[90m 21 |\u001b[39m }\n         \u001b[90m 22 |\u001b[39m\u001b[0m\n\n          \u001b[2mat \u001b[22msrc/core/supabase/updateUserSubscription.ts\u001b[2m:19:11\u001b[22m\n          \u001b[2mat \u001b[22mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\n          \u001b[2mat Object.__awaiter (\u001b[22mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\n          \u001b[2mat __awaiter (\u001b[22msrc/core/supabase/updateUserSubscription.ts\u001b[2m:6:20)\u001b[22m\n          \u001b[2mat Object.<anonymous> (\u001b[22m__tests__/core/supabase/updateUserSubscription.test.ts\u001b[2m:42:18)\u001b[22m\n          \u001b[2mat \u001b[22m__tests__/core/supabase/updateUserSubscription.test.ts\u001b[2m:7:71\u001b[22m\n          \u001b[2mat Object.<anonymous>.__awaiter (\u001b[22m__tests__/core/supabase/updateUserSubscription.test.ts\u001b[2m:3:12)\u001b[22m\n          \u001b[2mat Object.<anonymous> (\u001b[22m__tests__/core/supabase/updateUserSubscription.test.ts\u001b[2m:40:64)\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 40 |\u001b[39m   it(\u001b[32m'throws and logs error when exception occurs'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[22m\n\u001b[2m     \u001b[90m 41 |\u001b[39m     builder\u001b[33m.\u001b[39mupdate\u001b[33m.\u001b[39mmockImplementation(() \u001b[33m=>\u001b[39m { \u001b[36mthrow\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(\u001b[32m'oops'\u001b[39m) })\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 42 |\u001b[39m     \u001b[36mawait\u001b[39m expect(updateUserSubscription(userId\u001b[33m,\u001b[39m subscription))\u001b[33m.\u001b[39mrejects\u001b[33m.\u001b[39mtoThrow(\u001b[32m'oops'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                                                        \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 43 |\u001b[39m     expect(console\u001b[33m.\u001b[39merror)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[32m'Error updating subscription:'\u001b[39m\u001b[33m,\u001b[39m expect\u001b[33m.\u001b[39many(\u001b[33mError\u001b[39m))\u001b[22m\n\u001b[2m     \u001b[90m 44 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 45 |\u001b[39m })\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.toThrow (\u001b[22m\u001b[2mnode_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js\u001b[2m:218:22)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/updateUserSubscription.test.ts\u001b[39m\u001b[0m\u001b[2m:42:72)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/updateUserSubscription.test.ts\u001b[39m\u001b[0m\u001b[2m:7:71\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous>.__awaiter (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/updateUserSubscription.test.ts\u001b[39m\u001b[0m\u001b[2m:3:12)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/updateUserSubscription.test.ts\u001b[39m\u001b[0m\u001b[2m:40:64)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["updateUserSubscription"],"duration":141,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\nExpected: \u001b[32m[{\"subscription\": \"vip\"}]\u001b[39m\nReceived: \u001b[31mundefined\u001b[39m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.test.ts:26:17)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.test.ts:4:58)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"updateUserSubscription updates subscription and returns data on success","status":"failed","title":"updates subscription and returns data on success"},{"ancestorTitles":["updateUserSubscription"],"duration":60,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n\u001b[32m- Expected  - 3\u001b[39m\n\u001b[31m+ Received  + 1\u001b[39m\n\n\u001b[32m- Object {\u001b[39m\n\u001b[32m-   \"message\": \"fail\",\u001b[39m\n\u001b[32m- }\u001b[39m\n\u001b[31m+ [Error: Не удалось обновить подписку пользователя]\u001b[39m\n    at Object.toEqual (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.test.ts:36:72)\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.test.ts:7:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.test.ts:3:12)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.test.ts:33:67)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"updateUserSubscription throws and logs error when update error occurs","status":"failed","title":"throws and logs error when update error occurs"},{"ancestorTitles":["updateUserSubscription"],"duration":56,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected substring: \u001b[32m\"oops\"\u001b[39m\nReceived message:   \u001b[31m\"Не удалось обновить подписку пользователя\"\u001b[39m\n\n    \u001b[0m \u001b[90m 17 |\u001b[39m   } \u001b[36mcatch\u001b[39m (error) {\n     \u001b[90m 18 |\u001b[39m     console\u001b[33m.\u001b[39merror(\u001b[32m'Ошибка при обновлении подписки пользователя:'\u001b[39m\u001b[33m,\u001b[39m error)\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 19 |\u001b[39m     \u001b[36mthrow\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(\u001b[32m'Не удалось обновить подписку пользователя'\u001b[39m)\n     \u001b[90m    |\u001b[39m           \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 20 |\u001b[39m   }\n     \u001b[90m 21 |\u001b[39m }\n     \u001b[90m 22 |\u001b[39m\u001b[0m\n\n      \u001b[2mat \u001b[22msrc/core/supabase/updateUserSubscription.ts\u001b[2m:19:11\u001b[22m\n      \u001b[2mat \u001b[22mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\n      \u001b[2mat Object.__awaiter (\u001b[22mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\n      \u001b[2mat __awaiter (\u001b[22msrc/core/supabase/updateUserSubscription.ts\u001b[2m:6:20)\u001b[22m\n      \u001b[2mat Object.<anonymous> (\u001b[22m__tests__/core/supabase/updateUserSubscription.test.ts\u001b[2m:42:18)\u001b[22m\n      \u001b[2mat \u001b[22m__tests__/core/supabase/updateUserSubscription.test.ts\u001b[2m:7:71\u001b[22m\n      \u001b[2mat Object.<anonymous>.__awaiter (\u001b[22m__tests__/core/supabase/updateUserSubscription.test.ts\u001b[2m:3:12)\u001b[22m\n      \u001b[2mat Object.<anonymous> (\u001b[22m__tests__/core/supabase/updateUserSubscription.test.ts\u001b[2m:40:64)\u001b[22m\n    at Object.toThrow (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.test.ts:42:72)\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.test.ts:7:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.test.ts:3:12)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.test.ts:40:64)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"updateUserSubscription throws and logs error when exception occurs","status":"failed","title":"throws and logs error when exception occurs"}]},{"numFailingTests":5,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171896422,"runtime":121,"slow":false,"start":1745171896301},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getBotsFromSupabase.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mcore/supabase getBotsFromSupabase › returns empty array and warns if not configured\u001b[39m\u001b[22m\n\n    TypeError: Cannot read properties of undefined (reading 'error')\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 14 |\u001b[39m \u001b[36mconst\u001b[39m loadResult \u001b[33m=\u001b[39m config({ path\u001b[33m:\u001b[39m envPath })\u001b[22m\n\u001b[2m     \u001b[90m 15 |\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 16 |\u001b[39m \u001b[36mif\u001b[39m (loadResult\u001b[33m.\u001b[39merror) {\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 17 |\u001b[39m   console\u001b[33m.\u001b[39merror(\u001b[22m\n\u001b[2m     \u001b[90m 18 |\u001b[39m     \u001b[32m`[CONFIG] CRITICAL ERROR: Failed to load primary .env file from ${envPath}. Error: ${loadResult.error.message}`\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 19 |\u001b[39m   )\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.error (\u001b[22m\u001b[2msrc/config/index.ts\u001b[2m:16:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/core/supabase/client.ts\u001b[2m:2:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/core/supabase/index.ts\u001b[2m:1:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/getBotsFromSupabase.test.ts\u001b[39m\u001b[0m\u001b[2m:12:22)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mcore/supabase getBotsFromSupabase › returns empty array and logs error on query error\u001b[39m\u001b[22m\n\n    TypeError: Cannot read properties of undefined (reading 'error')\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 14 |\u001b[39m \u001b[36mconst\u001b[39m loadResult \u001b[33m=\u001b[39m config({ path\u001b[33m:\u001b[39m envPath })\u001b[22m\n\u001b[2m     \u001b[90m 15 |\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 16 |\u001b[39m \u001b[36mif\u001b[39m (loadResult\u001b[33m.\u001b[39merror) {\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 17 |\u001b[39m   console\u001b[33m.\u001b[39merror(\u001b[22m\n\u001b[2m     \u001b[90m 18 |\u001b[39m     \u001b[32m`[CONFIG] CRITICAL ERROR: Failed to load primary .env file from ${envPath}. Error: ${loadResult.error.message}`\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 19 |\u001b[39m   )\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.error (\u001b[22m\u001b[2msrc/config/index.ts\u001b[2m:16:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/core/supabase/client.ts\u001b[2m:2:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/core/supabase/index.ts\u001b[2m:1:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/getBotsFromSupabase.test.ts\u001b[39m\u001b[0m\u001b[2m:12:22)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mcore/supabase getBotsFromSupabase › returns empty array and logs info when no data\u001b[39m\u001b[22m\n\n    TypeError: Cannot read properties of undefined (reading 'error')\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 14 |\u001b[39m \u001b[36mconst\u001b[39m loadResult \u001b[33m=\u001b[39m config({ path\u001b[33m:\u001b[39m envPath })\u001b[22m\n\u001b[2m     \u001b[90m 15 |\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 16 |\u001b[39m \u001b[36mif\u001b[39m (loadResult\u001b[33m.\u001b[39merror) {\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 17 |\u001b[39m   console\u001b[33m.\u001b[39merror(\u001b[22m\n\u001b[2m     \u001b[90m 18 |\u001b[39m     \u001b[32m`[CONFIG] CRITICAL ERROR: Failed to load primary .env file from ${envPath}. Error: ${loadResult.error.message}`\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 19 |\u001b[39m   )\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.error (\u001b[22m\u001b[2msrc/config/index.ts\u001b[2m:16:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/core/supabase/client.ts\u001b[2m:2:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/core/supabase/index.ts\u001b[2m:1:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/getBotsFromSupabase.test.ts\u001b[39m\u001b[0m\u001b[2m:12:22)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mcore/supabase getBotsFromSupabase › returns data array and logs info on success\u001b[39m\u001b[22m\n\n    TypeError: Cannot read properties of undefined (reading 'error')\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 14 |\u001b[39m \u001b[36mconst\u001b[39m loadResult \u001b[33m=\u001b[39m config({ path\u001b[33m:\u001b[39m envPath })\u001b[22m\n\u001b[2m     \u001b[90m 15 |\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 16 |\u001b[39m \u001b[36mif\u001b[39m (loadResult\u001b[33m.\u001b[39merror) {\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 17 |\u001b[39m   console\u001b[33m.\u001b[39merror(\u001b[22m\n\u001b[2m     \u001b[90m 18 |\u001b[39m     \u001b[32m`[CONFIG] CRITICAL ERROR: Failed to load primary .env file from ${envPath}. Error: ${loadResult.error.message}`\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 19 |\u001b[39m   )\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.error (\u001b[22m\u001b[2msrc/config/index.ts\u001b[2m:16:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/core/supabase/client.ts\u001b[2m:2:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/core/supabase/index.ts\u001b[2m:1:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/getBotsFromSupabase.test.ts\u001b[39m\u001b[0m\u001b[2m:12:22)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mcore/supabase getBotsFromSupabase › logs error and returns empty array when supabaseAdmin throws exception\u001b[39m\u001b[22m\n\n    TypeError: Cannot read properties of undefined (reading 'error')\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 14 |\u001b[39m \u001b[36mconst\u001b[39m loadResult \u001b[33m=\u001b[39m config({ path\u001b[33m:\u001b[39m envPath })\u001b[22m\n\u001b[2m     \u001b[90m 15 |\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 16 |\u001b[39m \u001b[36mif\u001b[39m (loadResult\u001b[33m.\u001b[39merror) {\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 17 |\u001b[39m   console\u001b[33m.\u001b[39merror(\u001b[22m\n\u001b[2m     \u001b[90m 18 |\u001b[39m     \u001b[32m`[CONFIG] CRITICAL ERROR: Failed to load primary .env file from ${envPath}. Error: ${loadResult.error.message}`\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 19 |\u001b[39m   )\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.error (\u001b[22m\u001b[2msrc/config/index.ts\u001b[2m:16:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/core/supabase/client.ts\u001b[2m:2:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/core/supabase/index.ts\u001b[2m:1:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/getBotsFromSupabase.test.ts\u001b[39m\u001b[0m\u001b[2m:12:22)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["core/supabase getBotsFromSupabase"],"duration":12,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'error')\n    at Object.error (/Users/playra/999-multibots-telegraf/src/config/index.ts:16:16)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/core/supabase/client.ts:2:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/core/supabase/index.ts:1:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getBotsFromSupabase.test.ts:12:22)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusHook (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:281:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:246:5)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"core/supabase getBotsFromSupabase returns empty array and warns if not configured","status":"failed","title":"returns empty array and warns if not configured"},{"ancestorTitles":["core/supabase getBotsFromSupabase"],"duration":30,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'error')\n    at Object.error (/Users/playra/999-multibots-telegraf/src/config/index.ts:16:16)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/core/supabase/client.ts:2:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/core/supabase/index.ts:1:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getBotsFromSupabase.test.ts:12:22)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusHook (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:281:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:246:5)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"core/supabase getBotsFromSupabase returns empty array and logs error on query error","status":"failed","title":"returns empty array and logs error on query error"},{"ancestorTitles":["core/supabase getBotsFromSupabase"],"duration":10,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'error')\n    at Object.error (/Users/playra/999-multibots-telegraf/src/config/index.ts:16:16)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/core/supabase/client.ts:2:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/core/supabase/index.ts:1:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getBotsFromSupabase.test.ts:12:22)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusHook (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:281:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:246:5)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"core/supabase getBotsFromSupabase returns empty array and logs info when no data","status":"failed","title":"returns empty array and logs info when no data"},{"ancestorTitles":["core/supabase getBotsFromSupabase"],"duration":16,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'error')\n    at Object.error (/Users/playra/999-multibots-telegraf/src/config/index.ts:16:16)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/core/supabase/client.ts:2:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/core/supabase/index.ts:1:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getBotsFromSupabase.test.ts:12:22)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusHook (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:281:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:246:5)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"core/supabase getBotsFromSupabase returns data array and logs info on success","status":"failed","title":"returns data array and logs info on success"},{"ancestorTitles":["core/supabase getBotsFromSupabase"],"duration":10,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'error')\n    at Object.error (/Users/playra/999-multibots-telegraf/src/config/index.ts:16:16)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/core/supabase/client.ts:2:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/core/supabase/index.ts:1:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getBotsFromSupabase.test.ts:12:22)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusHook (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:281:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:246:5)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"core/supabase getBotsFromSupabase logs error and returns empty array when supabaseAdmin throws exception","status":"failed","title":"logs error and returns empty array when supabaseAdmin throws exception"}]},{"numFailingTests":4,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171896442,"runtime":130,"slow":false,"start":1745171896312},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/services/createModelTraining.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mcreateModelTraining › posts form data to create-model-training endpoint and unlinks file\u001b[39m\u001b[22m\n\n    TypeError: Cannot read properties of undefined (reading 'data')\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 69 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 70 |\u001b[39m     \u001b[36mawait\u001b[39m fs\u001b[33m.\u001b[39mpromises\u001b[33m.\u001b[39munlink(requestData\u001b[33m.\u001b[39mfilePath)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 71 |\u001b[39m     console\u001b[33m.\u001b[39mlog(\u001b[32m'Model training response:'\u001b[39m\u001b[33m,\u001b[39m response\u001b[33m.\u001b[39mdata)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                                      \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 72 |\u001b[39m     \u001b[36mreturn\u001b[39m response\u001b[33m.\u001b[39mdata\u001b[22m\n\u001b[2m     \u001b[90m 73 |\u001b[39m   } \u001b[36mcatch\u001b[39m (error) {\u001b[22m\n\u001b[2m     \u001b[90m 74 |\u001b[39m     \u001b[90m// if (axios.isAxiosError(error)) {\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat data (\u001b[22m\u001b[2msrc/services/createModelTraining.ts\u001b[2m:71:54)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mcreateModelTraining › uses create-model-training-v2 for other mode\u001b[39m\u001b[22m\n\n    TypeError: Cannot read properties of undefined (reading 'data')\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 69 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 70 |\u001b[39m     \u001b[36mawait\u001b[39m fs\u001b[33m.\u001b[39mpromises\u001b[33m.\u001b[39munlink(requestData\u001b[33m.\u001b[39mfilePath)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 71 |\u001b[39m     console\u001b[33m.\u001b[39mlog(\u001b[32m'Model training response:'\u001b[39m\u001b[33m,\u001b[39m response\u001b[33m.\u001b[39mdata)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                                      \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 72 |\u001b[39m     \u001b[36mreturn\u001b[39m response\u001b[33m.\u001b[39mdata\u001b[22m\n\u001b[2m     \u001b[90m 73 |\u001b[39m   } \u001b[36mcatch\u001b[39m (error) {\u001b[22m\n\u001b[2m     \u001b[90m 74 |\u001b[39m     \u001b[90m// if (axios.isAxiosError(error)) {\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat data (\u001b[22m\u001b[2msrc/services/createModelTraining.ts\u001b[2m:71:54)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mcreateModelTraining › propagates axios errors and does not unlink file\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected substring: \u001b[32m\"net fail\"\u001b[39m\n    Received message:   \u001b[31m\"Cannot read properties of undefined (reading 'data')\"\u001b[39m\n\n        \u001b[0m \u001b[90m 69 |\u001b[39m\n         \u001b[90m 70 |\u001b[39m     \u001b[36mawait\u001b[39m fs\u001b[33m.\u001b[39mpromises\u001b[33m.\u001b[39munlink(requestData\u001b[33m.\u001b[39mfilePath)\n        \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 71 |\u001b[39m     console\u001b[33m.\u001b[39mlog(\u001b[32m'Model training response:'\u001b[39m\u001b[33m,\u001b[39m response\u001b[33m.\u001b[39mdata)\n         \u001b[90m    |\u001b[39m                                                      \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n         \u001b[90m 72 |\u001b[39m     \u001b[36mreturn\u001b[39m response\u001b[33m.\u001b[39mdata\n         \u001b[90m 73 |\u001b[39m   } \u001b[36mcatch\u001b[39m (error) {\n         \u001b[90m 74 |\u001b[39m     \u001b[90m// if (axios.isAxiosError(error)) {\u001b[39m\u001b[0m\n\n          \u001b[2mat data (\u001b[22msrc/services/createModelTraining.ts\u001b[2m:71:54)\u001b[22m\n          \u001b[2mat fulfilled (\u001b[22mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 73 |\u001b[39m     \u001b[36mawait\u001b[39m expect(\u001b[22m\n\u001b[2m     \u001b[90m 74 |\u001b[39m       createModelTraining({ filePath\u001b[33m:\u001b[39m dummyFile\u001b[33m,\u001b[39m triggerWord\u001b[33m:\u001b[39m \u001b[32m't'\u001b[39m\u001b[33m,\u001b[39m modelName\u001b[33m:\u001b[39m \u001b[32m'n'\u001b[39m\u001b[33m,\u001b[39m telegram_id\u001b[33m:\u001b[39m \u001b[32m'u'\u001b[39m\u001b[33m,\u001b[39m is_ru\u001b[33m:\u001b[39m \u001b[36mtrue\u001b[39m\u001b[33m,\u001b[39m steps\u001b[33m:\u001b[39m \u001b[35m1\u001b[39m\u001b[33m,\u001b[39m botName\u001b[33m:\u001b[39m \u001b[32m'b'\u001b[39m }\u001b[33m,\u001b[39m ctx)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 75 |\u001b[39m     )\u001b[33m.\u001b[39mrejects\u001b[33m.\u001b[39mtoThrow(\u001b[32m'net fail'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m               \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 76 |\u001b[39m     expect(fs\u001b[33m.\u001b[39mpromises\u001b[33m.\u001b[39munlink)\u001b[33m.\u001b[39mnot\u001b[33m.\u001b[39mtoHaveBeenCalled()\u001b[22m\n\u001b[2m     \u001b[90m 77 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 78 |\u001b[39m   \u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.toThrow (\u001b[22m\u001b[2mnode_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js\u001b[2m:218:22)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/services/createModelTraining.test.ts\u001b[39m\u001b[0m\u001b[2m:75:15\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.__awaiter (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/services/createModelTraining.test.ts\u001b[39m\u001b[0m\u001b[2m:71:69)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mcreateModelTraining › uses ELESTIO_URL when in production mode\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32m\"https://ele.stio/generate/create-model-training\"\u001b[39m, \u001b[32mAny<FormData>\u001b[39m, \u001b[32mObjectContaining {\"headers\": ObjectContaining {\"x-secret-key\": \"secret-key\"}}\u001b[39m\n    Received: \u001b[2m\"https://ele.stio/generate/create-model-training\"\u001b[22m, \u001b[31m{\"_boundary\": \"--------------------------234144389545098220926161\", \"_currentStream\": null, \"_insideLoop\": false, \"_overheadLength\": 851, \"_pendingNext\": false, \"_released\": false, \"_streams\": [\"----------------------------234144389545098220926161·\u001b[39m\n    \u001b[31mContent-Disposition: form-data; name=\\\"type\\\"···\u001b[39m\n    \u001b[31m\", \"model\", [Function bound ], \"----------------------------234144389545098220926161·\u001b[39m\n    \u001b[31mContent-Disposition: form-data; name=\\\"telegram_id\\\"···\u001b[39m\n    \u001b[31m\", \"u\", [Function bound ], \"----------------------------234144389545098220926161·\u001b[39m\n    \u001b[31mContent-Disposition: form-data; name=\\\"zipUrl\\\"···\u001b[39m\n    \u001b[31m\", \"<stream>\", [Function bound ], \"----------------------------234144389545098220926161·\u001b[39m\n    \u001b[31mContent-Disposition: form-data; name=\\\"triggerWord\\\"···\u001b[39m\n    \u001b[31m\", …], \"_valueLength\": 22, \"_valuesToMeasure\": [], \"dataSize\": 0, \"maxDataSize\": 2097152, \"pauseStreams\": true, \"readable\": true, \"writable\": false}\u001b[39m, \u001b[2m{\"headers\": {\"Content-Type\": \"multipart/form-data\", \"content-type\": \"multipart/form-data; boundary=--------------------------234144389545098220926161\", \"x-secret-key\": \"secret-key\"}}\u001b[22m\n\n    Number of calls: \u001b[31m1\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 103 |\u001b[39m     \u001b[36mawait\u001b[39m expect(createModelTraining(req\u001b[33m,\u001b[39m ctxProd))\u001b[33m.\u001b[39mresolves\u001b[33m.\u001b[39mtoEqual({ m\u001b[33m:\u001b[39m \u001b[32m'ok'\u001b[39m })\u001b[22m\n\u001b[2m     \u001b[90m 104 |\u001b[39m     \u001b[90m// Assert URL called correctly\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 105 |\u001b[39m     expect(axiosMock\u001b[33m.\u001b[39mpost)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                            \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 106 |\u001b[39m       \u001b[32m'https://ele.stio/generate/create-model-training'\u001b[39m\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 107 |\u001b[39m       expect\u001b[33m.\u001b[39many(\u001b[33mFormData\u001b[39m)\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 108 |\u001b[39m       expect\u001b[33m.\u001b[39mobjectContaining({ headers\u001b[33m:\u001b[39m expect\u001b[33m.\u001b[39mobjectContaining({ \u001b[32m'x-secret-key'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'secret-key'\u001b[39m }) })\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/services/createModelTraining.test.ts\u001b[39m\u001b[0m\u001b[2m:105:28\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["createModelTraining"],"duration":33,"failureMessages":[],"fullName":"createModelTraining throws error if file does not exist","status":"passed","title":"throws error if file does not exist"},{"ancestorTitles":["createModelTraining"],"duration":10,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'data')\n    at data (/Users/playra/999-multibots-telegraf/src/services/createModelTraining.ts:71:54)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"createModelTraining posts form data to create-model-training endpoint and unlinks file","status":"failed","title":"posts form data to create-model-training endpoint and unlinks file"},{"ancestorTitles":["createModelTraining"],"duration":12,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'data')\n    at data (/Users/playra/999-multibots-telegraf/src/services/createModelTraining.ts:71:54)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"createModelTraining uses create-model-training-v2 for other mode","status":"failed","title":"uses create-model-training-v2 for other mode"},{"ancestorTitles":["createModelTraining"],"duration":14,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected substring: \u001b[32m\"net fail\"\u001b[39m\nReceived message:   \u001b[31m\"Cannot read properties of undefined (reading 'data')\"\u001b[39m\n\n    \u001b[0m \u001b[90m 69 |\u001b[39m\n     \u001b[90m 70 |\u001b[39m     \u001b[36mawait\u001b[39m fs\u001b[33m.\u001b[39mpromises\u001b[33m.\u001b[39munlink(requestData\u001b[33m.\u001b[39mfilePath)\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 71 |\u001b[39m     console\u001b[33m.\u001b[39mlog(\u001b[32m'Model training response:'\u001b[39m\u001b[33m,\u001b[39m response\u001b[33m.\u001b[39mdata)\n     \u001b[90m    |\u001b[39m                                                      \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 72 |\u001b[39m     \u001b[36mreturn\u001b[39m response\u001b[33m.\u001b[39mdata\n     \u001b[90m 73 |\u001b[39m   } \u001b[36mcatch\u001b[39m (error) {\n     \u001b[90m 74 |\u001b[39m     \u001b[90m// if (axios.isAxiosError(error)) {\u001b[39m\u001b[0m\n\n      \u001b[2mat data (\u001b[22msrc/services/createModelTraining.ts\u001b[2m:71:54)\u001b[22m\n      \u001b[2mat fulfilled (\u001b[22mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\n    at Object.toThrow (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n    at /Users/playra/999-multibots-telegraf/__tests__/services/createModelTraining.test.ts:75:15\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/services/createModelTraining.test.ts:71:69)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"createModelTraining propagates axios errors and does not unlink file","status":"failed","title":"propagates axios errors and does not unlink file"},{"ancestorTitles":["createModelTraining"],"duration":16,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m\"https://ele.stio/generate/create-model-training\"\u001b[39m, \u001b[32mAny<FormData>\u001b[39m, \u001b[32mObjectContaining {\"headers\": ObjectContaining {\"x-secret-key\": \"secret-key\"}}\u001b[39m\nReceived: \u001b[2m\"https://ele.stio/generate/create-model-training\"\u001b[22m, \u001b[31m{\"_boundary\": \"--------------------------234144389545098220926161\", \"_currentStream\": null, \"_insideLoop\": false, \"_overheadLength\": 851, \"_pendingNext\": false, \"_released\": false, \"_streams\": [\"----------------------------234144389545098220926161·\u001b[39m\n\u001b[31mContent-Disposition: form-data; name=\\\"type\\\"···\u001b[39m\n\u001b[31m\", \"model\", [Function bound ], \"----------------------------234144389545098220926161·\u001b[39m\n\u001b[31mContent-Disposition: form-data; name=\\\"telegram_id\\\"···\u001b[39m\n\u001b[31m\", \"u\", [Function bound ], \"----------------------------234144389545098220926161·\u001b[39m\n\u001b[31mContent-Disposition: form-data; name=\\\"zipUrl\\\"···\u001b[39m\n\u001b[31m\", \"<stream>\", [Function bound ], \"----------------------------234144389545098220926161·\u001b[39m\n\u001b[31mContent-Disposition: form-data; name=\\\"triggerWord\\\"···\u001b[39m\n\u001b[31m\", …], \"_valueLength\": 22, \"_valuesToMeasure\": [], \"dataSize\": 0, \"maxDataSize\": 2097152, \"pauseStreams\": true, \"readable\": true, \"writable\": false}\u001b[39m, \u001b[2m{\"headers\": {\"Content-Type\": \"multipart/form-data\", \"content-type\": \"multipart/form-data; boundary=--------------------------234144389545098220926161\", \"x-secret-key\": \"secret-key\"}}\u001b[22m\n\nNumber of calls: \u001b[31m1\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/services/createModelTraining.test.ts:105:28\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"createModelTraining uses ELESTIO_URL when in production mode","status":"failed","title":"uses ELESTIO_URL when in production mode"}]},{"numFailingTests":1,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171896425,"runtime":158,"slow":false,"start":1745171896267},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/handlers/setupLevelHandlers.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1msetupLevelHandlers › registers 12 actions for levels and completion\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledTimes\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected number of calls: \u001b[32m12\u001b[39m\n    Received number of calls: \u001b[31m14\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 25 |\u001b[39m       \u001b[32m'level_complete'\u001b[39m\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 26 |\u001b[39m     ]\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 27 |\u001b[39m     expect(bot\u001b[33m.\u001b[39maction)\u001b[33m.\u001b[39mtoHaveBeenCalledTimes(expectedActions\u001b[33m.\u001b[39mlength)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 28 |\u001b[39m     expectedActions\u001b[33m.\u001b[39mforEach((action\u001b[33m,\u001b[39m idx) \u001b[33m=>\u001b[39m {\u001b[22m\n\u001b[2m     \u001b[90m 29 |\u001b[39m       expect(bot\u001b[33m.\u001b[39maction)\u001b[33m.\u001b[39mtoHaveBeenNthCalledWith(\u001b[22m\n\u001b[2m     \u001b[90m 30 |\u001b[39m         idx \u001b[33m+\u001b[39m \u001b[35m1\u001b[39m\u001b[33m,\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/handlers/setupLevelHandlers.test.ts\u001b[39m\u001b[0m\u001b[2m:27:24)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["setupLevelHandlers"],"duration":2,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledTimes\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected number of calls: \u001b[32m12\u001b[39m\nReceived number of calls: \u001b[31m14\u001b[39m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/handlers/setupLevelHandlers.test.ts:27:24)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"setupLevelHandlers registers 12 actions for levels and completion","status":"failed","title":"registers 12 actions for levels and completion"}]},{"numFailingTests":3,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171896575,"runtime":125,"slow":false,"start":1745171896450},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getReferalsCountAndUserData.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mgetReferalsCountAndUserData › returns default when user lookup fails\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n    \u001b[32m- Expected  - 1\u001b[39m\n    \u001b[31m+ Received  + 1\u001b[39m\n\n    \u001b[2m  Object {\u001b[22m\n    \u001b[2m    \"count\": 0,\u001b[22m\n    \u001b[2m    \"isExist\": false,\u001b[22m\n    \u001b[2m    \"level\": 0,\u001b[22m\n    \u001b[32m-   \"subscription\": \"stars\",\u001b[39m\n    \u001b[31m+   \"subscriptionType\": \"stars\",\u001b[39m\n    \u001b[2m    \"userData\": null,\u001b[22m\n    \u001b[2m  }\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 30 |\u001b[39m     mockBuilderUser\u001b[33m.\u001b[39msingle\u001b[33m.\u001b[39mmockResolvedValue({ data\u001b[33m:\u001b[39m \u001b[36mnull\u001b[39m\u001b[33m,\u001b[39m error\u001b[33m:\u001b[39m { message\u001b[33m:\u001b[39m \u001b[32m'fail'\u001b[39m } })\u001b[22m\n\u001b[2m     \u001b[90m 31 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m getReferalsCountAndUserData(telegram_id)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 32 |\u001b[39m     expect(res)\u001b[33m.\u001b[39mtoEqual({ count\u001b[33m:\u001b[39m \u001b[35m0\u001b[39m\u001b[33m,\u001b[39m subscription\u001b[33m:\u001b[39m \u001b[32m'stars'\u001b[39m\u001b[33m,\u001b[39m level\u001b[33m:\u001b[39m \u001b[35m0\u001b[39m\u001b[33m,\u001b[39m userData\u001b[33m:\u001b[39m \u001b[36mnull\u001b[39m\u001b[33m,\u001b[39m isExist\u001b[33m:\u001b[39m \u001b[36mfalse\u001b[39m })\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                 \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 33 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 34 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 35 |\u001b[39m   it(\u001b[32m'returns default when referral query errors'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/getReferalsCountAndUserData.test.ts\u001b[39m\u001b[0m\u001b[2m:32:17)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/getReferalsCountAndUserData.test.ts\u001b[39m\u001b[0m\u001b[2m:4:58)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mgetReferalsCountAndUserData › returns default when referral query errors\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n    \u001b[32m- Expected  - 4\u001b[39m\n    \u001b[31m+ Received  + 8\u001b[39m\n\n    \u001b[2m  Object {\u001b[22m\n    \u001b[2m    \"count\": 0,\u001b[22m\n    \u001b[32m-   \"isExist\": false,\u001b[39m\n    \u001b[32m-   \"level\": 0,\u001b[39m\n    \u001b[32m-   \"subscription\": \"stars\",\u001b[39m\n    \u001b[32m-   \"userData\": null,\u001b[39m\n    \u001b[31m+   \"isExist\": true,\u001b[39m\n    \u001b[31m+   \"level\": 5,\u001b[39m\n    \u001b[31m+   \"subscriptionType\": \"stars\",\u001b[39m\n    \u001b[31m+   \"userData\": Object {\u001b[39m\n    \u001b[31m+     \"level\": 5,\u001b[39m\n    \u001b[31m+     \"subscription\": \"premium\",\u001b[39m\n    \u001b[31m+     \"user_id\": \"u1\",\u001b[39m\n    \u001b[31m+   },\u001b[39m\n    \u001b[2m  }\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 39 |\u001b[39m     mockBuilderRef\u001b[33m.\u001b[39meq\u001b[33m.\u001b[39mmockReturnValue(\u001b[33mPromise\u001b[39m\u001b[33m.\u001b[39mresolve({ data\u001b[33m:\u001b[39m \u001b[36mnull\u001b[39m\u001b[33m,\u001b[39m error\u001b[33m:\u001b[39m { message\u001b[33m:\u001b[39m \u001b[32m'fail'\u001b[39m } }))\u001b[22m\n\u001b[2m     \u001b[90m 40 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m getReferalsCountAndUserData(telegram_id)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 41 |\u001b[39m     expect(res)\u001b[33m.\u001b[39mtoEqual({ count\u001b[33m:\u001b[39m \u001b[35m0\u001b[39m\u001b[33m,\u001b[39m subscription\u001b[33m:\u001b[39m \u001b[32m'stars'\u001b[39m\u001b[33m,\u001b[39m level\u001b[33m:\u001b[39m \u001b[35m0\u001b[39m\u001b[33m,\u001b[39m userData\u001b[33m:\u001b[39m \u001b[36mnull\u001b[39m\u001b[33m,\u001b[39m isExist\u001b[33m:\u001b[39m \u001b[36mfalse\u001b[39m })\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                 \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 42 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 43 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 44 |\u001b[39m   it(\u001b[32m'returns correct count and user data on success'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/getReferalsCountAndUserData.test.ts\u001b[39m\u001b[0m\u001b[2m:41:17)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/getReferalsCountAndUserData.test.ts\u001b[39m\u001b[0m\u001b[2m:4:58)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mgetReferalsCountAndUserData › returns correct count and user data on success\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n    \u001b[32m- Expected  - 1\u001b[39m\n    \u001b[31m+ Received  + 1\u001b[39m\n\n    \u001b[33m@@ -1,10 +1,10 @@\u001b[39m\n    \u001b[2m  Object {\u001b[22m\n    \u001b[2m    \"count\": 2,\u001b[22m\n    \u001b[2m    \"isExist\": true,\u001b[22m\n    \u001b[2m    \"level\": 5,\u001b[22m\n    \u001b[32m-   \"subscription\": \"premium\",\u001b[39m\n    \u001b[31m+   \"subscriptionType\": \"stars\",\u001b[39m\n    \u001b[2m    \"userData\": Object {\u001b[22m\n    \u001b[2m      \"level\": 5,\u001b[22m\n    \u001b[2m      \"subscription\": \"premium\",\u001b[22m\n    \u001b[2m      \"user_id\": \"u1\",\u001b[22m\n    \u001b[2m    },\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 46 |\u001b[39m     mockBuilderRef\u001b[33m.\u001b[39meq\u001b[33m.\u001b[39mmockReturnValue(\u001b[33mPromise\u001b[39m\u001b[33m.\u001b[39mresolve({ data\u001b[33m:\u001b[39m refs\u001b[33m,\u001b[39m error\u001b[33m:\u001b[39m \u001b[36mnull\u001b[39m }))\u001b[22m\n\u001b[2m     \u001b[90m 47 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m getReferalsCountAndUserData(telegram_id)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 48 |\u001b[39m     expect(res)\u001b[33m.\u001b[39mtoEqual({\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                 \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 49 |\u001b[39m       count\u001b[33m:\u001b[39m refs\u001b[33m.\u001b[39mlength\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 50 |\u001b[39m       level\u001b[33m:\u001b[39m userData\u001b[33m.\u001b[39mlevel\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 51 |\u001b[39m       subscription\u001b[33m:\u001b[39m userData\u001b[33m.\u001b[39msubscription\u001b[33m,\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/getReferalsCountAndUserData.test.ts\u001b[39m\u001b[0m\u001b[2m:48:17)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/getReferalsCountAndUserData.test.ts\u001b[39m\u001b[0m\u001b[2m:4:58)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["getReferalsCountAndUserData"],"duration":14,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n\u001b[32m- Expected  - 1\u001b[39m\n\u001b[31m+ Received  + 1\u001b[39m\n\n\u001b[2m  Object {\u001b[22m\n\u001b[2m    \"count\": 0,\u001b[22m\n\u001b[2m    \"isExist\": false,\u001b[22m\n\u001b[2m    \"level\": 0,\u001b[22m\n\u001b[32m-   \"subscription\": \"stars\",\u001b[39m\n\u001b[31m+   \"subscriptionType\": \"stars\",\u001b[39m\n\u001b[2m    \"userData\": null,\u001b[22m\n\u001b[2m  }\u001b[22m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getReferalsCountAndUserData.test.ts:32:17)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getReferalsCountAndUserData.test.ts:4:58)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"getReferalsCountAndUserData returns default when user lookup fails","status":"failed","title":"returns default when user lookup fails"},{"ancestorTitles":["getReferalsCountAndUserData"],"duration":16,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n\u001b[32m- Expected  - 4\u001b[39m\n\u001b[31m+ Received  + 8\u001b[39m\n\n\u001b[2m  Object {\u001b[22m\n\u001b[2m    \"count\": 0,\u001b[22m\n\u001b[32m-   \"isExist\": false,\u001b[39m\n\u001b[32m-   \"level\": 0,\u001b[39m\n\u001b[32m-   \"subscription\": \"stars\",\u001b[39m\n\u001b[32m-   \"userData\": null,\u001b[39m\n\u001b[31m+   \"isExist\": true,\u001b[39m\n\u001b[31m+   \"level\": 5,\u001b[39m\n\u001b[31m+   \"subscriptionType\": \"stars\",\u001b[39m\n\u001b[31m+   \"userData\": Object {\u001b[39m\n\u001b[31m+     \"level\": 5,\u001b[39m\n\u001b[31m+     \"subscription\": \"premium\",\u001b[39m\n\u001b[31m+     \"user_id\": \"u1\",\u001b[39m\n\u001b[31m+   },\u001b[39m\n\u001b[2m  }\u001b[22m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getReferalsCountAndUserData.test.ts:41:17)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getReferalsCountAndUserData.test.ts:4:58)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"getReferalsCountAndUserData returns default when referral query errors","status":"failed","title":"returns default when referral query errors"},{"ancestorTitles":["getReferalsCountAndUserData"],"duration":10,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n\u001b[32m- Expected  - 1\u001b[39m\n\u001b[31m+ Received  + 1\u001b[39m\n\n\u001b[33m@@ -1,10 +1,10 @@\u001b[39m\n\u001b[2m  Object {\u001b[22m\n\u001b[2m    \"count\": 2,\u001b[22m\n\u001b[2m    \"isExist\": true,\u001b[22m\n\u001b[2m    \"level\": 5,\u001b[22m\n\u001b[32m-   \"subscription\": \"premium\",\u001b[39m\n\u001b[31m+   \"subscriptionType\": \"stars\",\u001b[39m\n\u001b[2m    \"userData\": Object {\u001b[22m\n\u001b[2m      \"level\": 5,\u001b[22m\n\u001b[2m      \"subscription\": \"premium\",\u001b[22m\n\u001b[2m      \"user_id\": \"u1\",\u001b[22m\n\u001b[2m    },\u001b[22m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getReferalsCountAndUserData.test.ts:48:17)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getReferalsCountAndUserData.test.ts:4:58)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"getReferalsCountAndUserData returns correct count and user data on success","status":"failed","title":"returns correct count and user data on success"}]},{"numFailingTests":3,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171896595,"runtime":94,"slow":false,"start":1745171896501},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/bot/getBotByName.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mgetBotByName › returns error when bot name not in configuration\u001b[39m\u001b[22m\n\n    TypeError: Cannot read properties of undefined (reading 'error')\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 14 |\u001b[39m \u001b[36mconst\u001b[39m loadResult \u001b[33m=\u001b[39m config({ path\u001b[33m:\u001b[39m envPath })\u001b[22m\n\u001b[2m     \u001b[90m 15 |\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 16 |\u001b[39m \u001b[36mif\u001b[39m (loadResult\u001b[33m.\u001b[39merror) {\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 17 |\u001b[39m   console\u001b[33m.\u001b[39merror(\u001b[22m\n\u001b[2m     \u001b[90m 18 |\u001b[39m     \u001b[32m`[CONFIG] CRITICAL ERROR: Failed to load primary .env file from ${envPath}. Error: ${loadResult.error.message}`\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 19 |\u001b[39m   )\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.error (\u001b[22m\u001b[2msrc/config/index.ts\u001b[2m:16:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/core/bot/index.ts\u001b[2m:5:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/bot/getBotByName.test.ts\u001b[39m\u001b[0m\u001b[2m:24:30)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mgetBotByName › returns bot instance when bot name exists\u001b[39m\u001b[22m\n\n    TypeError: Cannot read properties of undefined (reading 'error')\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 14 |\u001b[39m \u001b[36mconst\u001b[39m loadResult \u001b[33m=\u001b[39m config({ path\u001b[33m:\u001b[39m envPath })\u001b[22m\n\u001b[2m     \u001b[90m 15 |\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 16 |\u001b[39m \u001b[36mif\u001b[39m (loadResult\u001b[33m.\u001b[39merror) {\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 17 |\u001b[39m   console\u001b[33m.\u001b[39merror(\u001b[22m\n\u001b[2m     \u001b[90m 18 |\u001b[39m     \u001b[32m`[CONFIG] CRITICAL ERROR: Failed to load primary .env file from ${envPath}. Error: ${loadResult.error.message}`\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 19 |\u001b[39m   )\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.error (\u001b[22m\u001b[2msrc/config/index.ts\u001b[2m:16:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/core/bot/index.ts\u001b[2m:5:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/bot/getBotByName.test.ts\u001b[39m\u001b[0m\u001b[2m:32:48)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mgetBotByName › recreates bot instance when existing one lacks telegram.sendMessage\u001b[39m\u001b[22m\n\n    TypeError: Cannot read properties of undefined (reading 'error')\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 14 |\u001b[39m \u001b[36mconst\u001b[39m loadResult \u001b[33m=\u001b[39m config({ path\u001b[33m:\u001b[39m envPath })\u001b[22m\n\u001b[2m     \u001b[90m 15 |\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 16 |\u001b[39m \u001b[36mif\u001b[39m (loadResult\u001b[33m.\u001b[39merror) {\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 17 |\u001b[39m   console\u001b[33m.\u001b[39merror(\u001b[22m\n\u001b[2m     \u001b[90m 18 |\u001b[39m     \u001b[32m`[CONFIG] CRITICAL ERROR: Failed to load primary .env file from ${envPath}. Error: ${loadResult.error.message}`\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 19 |\u001b[39m   )\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.error (\u001b[22m\u001b[2msrc/config/index.ts\u001b[2m:16:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/core/bot/index.ts\u001b[2m:5:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/bot/getBotByName.test.ts\u001b[39m\u001b[0m\u001b[2m:42:17)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["getBotByName"],"duration":5,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'error')\n    at Object.error (/Users/playra/999-multibots-telegraf/src/config/index.ts:16:16)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/core/bot/index.ts:5:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/bot/getBotByName.test.ts:24:30)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"getBotByName returns error when bot name not in configuration","status":"failed","title":"returns error when bot name not in configuration"},{"ancestorTitles":["getBotByName"],"duration":3,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'error')\n    at Object.error (/Users/playra/999-multibots-telegraf/src/config/index.ts:16:16)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/core/bot/index.ts:5:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/bot/getBotByName.test.ts:32:48)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"getBotByName returns bot instance when bot name exists","status":"failed","title":"returns bot instance when bot name exists"},{"ancestorTitles":["getBotByName"],"duration":5,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'error')\n    at Object.error (/Users/playra/999-multibots-telegraf/src/config/index.ts:16:16)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/core/bot/index.ts:5:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/bot/getBotByName.test.ts:42:17)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"getBotByName recreates bot instance when existing one lacks telegram.sendMessage","status":"failed","title":"recreates bot instance when existing one lacks telegram.sendMessage"}]},{"numFailingTests":5,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171896575,"runtime":144,"slow":false,"start":1745171896431},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/utils/pulse.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mpulse helper › sends photo when image is provided\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32m\"-4166575919\"\u001b[39m, \u001b[32m{\"source\": Any<Buffer>}\u001b[39m, \u001b[32m{\"caption\": StringContaining \"test prompt\"}\u001b[39m\n\n    Number of calls: \u001b[31m0\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 29 |\u001b[39m   it(\u001b[32m'sends photo when image is provided'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[22m\n\u001b[2m     \u001b[90m 30 |\u001b[39m     \u001b[36mawait\u001b[39m pulse(ctx\u001b[33m,\u001b[39m image\u001b[33m,\u001b[39m prompt\u001b[33m,\u001b[39m command)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 31 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mtelegram\u001b[33m.\u001b[39msendPhoto)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                    \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 32 |\u001b[39m       \u001b[32m'-4166575919'\u001b[39m\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 33 |\u001b[39m       { source\u001b[33m:\u001b[39m expect\u001b[33m.\u001b[39many(\u001b[33mBuffer\u001b[39m) }\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 34 |\u001b[39m       { caption\u001b[33m:\u001b[39m expect\u001b[33m.\u001b[39mstringContaining(prompt) }\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/utils/pulse.test.ts\u001b[39m\u001b[0m\u001b[2m:31:36\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mpulse helper › sends message when image is null\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32m\"-4166575919\"\u001b[39m, \u001b[32mStringContaining \"использовал команду\"\u001b[39m\n\n    Number of calls: \u001b[31m0\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 38 |\u001b[39m   it(\u001b[32m'sends message when image is null'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[22m\n\u001b[2m     \u001b[90m 39 |\u001b[39m     \u001b[36mawait\u001b[39m pulse(ctx\u001b[33m,\u001b[39m \u001b[36mnull\u001b[39m\u001b[33m,\u001b[39m prompt\u001b[33m,\u001b[39m command)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 40 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mtelegram\u001b[33m.\u001b[39msendMessage)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                      \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 41 |\u001b[39m       \u001b[32m'-4166575919'\u001b[39m\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 42 |\u001b[39m       expect\u001b[33m.\u001b[39mstringContaining(\u001b[32m'использовал команду'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 43 |\u001b[39m     )\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/utils/pulse.test.ts\u001b[39m\u001b[0m\u001b[2m:40:38\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mpulse helper › retries sendPhoto on migrate_to_chat_id error\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledTimes\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected number of calls: \u001b[32m2\u001b[39m\n    Received number of calls: \u001b[31m0\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 51 |\u001b[39m       \u001b[33m.\u001b[39mmockResolvedValue(undefined)\u001b[22m\n\u001b[2m     \u001b[90m 52 |\u001b[39m     \u001b[36mawait\u001b[39m pulse(ctx\u001b[33m,\u001b[39m image\u001b[33m,\u001b[39m prompt\u001b[33m,\u001b[39m command)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 53 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mtelegram\u001b[33m.\u001b[39msendPhoto)\u001b[33m.\u001b[39mtoHaveBeenCalledTimes(\u001b[35m2\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                    \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 54 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mtelegram\u001b[33m.\u001b[39msendPhoto)\u001b[33m.\u001b[39mtoHaveBeenLastCalledWith(\u001b[22m\n\u001b[2m     \u001b[90m 55 |\u001b[39m       \u001b[32m'new_chat'\u001b[39m\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 56 |\u001b[39m       { source\u001b[33m:\u001b[39m expect\u001b[33m.\u001b[39many(\u001b[33mBuffer\u001b[39m) }\u001b[33m,\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/utils/pulse.test.ts\u001b[39m\u001b[0m\u001b[2m:53:36\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mpulse helper › retries sendMessage on migrate_to_chat_id error\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledTimes\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected number of calls: \u001b[32m2\u001b[39m\n    Received number of calls: \u001b[31m0\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 66 |\u001b[39m       \u001b[33m.\u001b[39mmockResolvedValue(undefined)\u001b[22m\n\u001b[2m     \u001b[90m 67 |\u001b[39m     \u001b[36mawait\u001b[39m pulse(ctx\u001b[33m,\u001b[39m \u001b[36mnull\u001b[39m\u001b[33m,\u001b[39m prompt\u001b[33m,\u001b[39m command)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 68 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mtelegram\u001b[33m.\u001b[39msendMessage)\u001b[33m.\u001b[39mtoHaveBeenCalledTimes(\u001b[35m2\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                      \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 69 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mtelegram\u001b[33m.\u001b[39msendMessage)\u001b[33m.\u001b[39mtoHaveBeenLastCalledWith(\u001b[22m\n\u001b[2m     \u001b[90m 70 |\u001b[39m       \u001b[32m'new_chat'\u001b[39m\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 71 |\u001b[39m       expect\u001b[33m.\u001b[39mstringContaining(\u001b[32m'использовал команду'\u001b[39m)\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/utils/pulse.test.ts\u001b[39m\u001b[0m\u001b[2m:68:38\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mpulse helper › throws on non-migration error\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m()\u001b[22m\n\n    Received promise resolved instead of rejected\n    Resolved to value: \u001b[31mundefined\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 77 |\u001b[39m     randomError\u001b[33m.\u001b[39mresponse \u001b[33m=\u001b[39m { parameters\u001b[33m:\u001b[39m {} }\u001b[22m\n\u001b[2m     \u001b[90m 78 |\u001b[39m     ctx\u001b[33m.\u001b[39mtelegram\u001b[33m.\u001b[39msendMessage \u001b[33m=\u001b[39m jest\u001b[33m.\u001b[39mfn()\u001b[33m.\u001b[39mmockRejectedValue(randomError)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 79 |\u001b[39m     \u001b[36mawait\u001b[39m expect(pulse(ctx\u001b[33m,\u001b[39m \u001b[36mnull\u001b[39m\u001b[33m,\u001b[39m prompt\u001b[33m,\u001b[39m command))\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m           \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 80 |\u001b[39m       \u001b[33m.\u001b[39mrejects\u001b[33m.\u001b[39mtoThrow(\u001b[32m'Ошибка при отправке пульса'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 81 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 82 |\u001b[39m })\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat expect (\u001b[22m\u001b[2mnode_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js\u001b[2m:113:15)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/utils/pulse.test.ts\u001b[39m\u001b[0m\u001b[2m:79:11\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.__awaiter (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/utils/pulse.test.ts\u001b[39m\u001b[0m\u001b[2m:75:50)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["pulse helper"],"duration":2,"failureMessages":[],"fullName":"pulse helper does nothing in development environment","status":"passed","title":"does nothing in development environment"},{"ancestorTitles":["pulse helper"],"duration":0,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m\"-4166575919\"\u001b[39m, \u001b[32m{\"source\": Any<Buffer>}\u001b[39m, \u001b[32m{\"caption\": StringContaining \"test prompt\"}\u001b[39m\n\nNumber of calls: \u001b[31m0\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/utils/pulse.test.ts:31:36\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"pulse helper sends photo when image is provided","status":"failed","title":"sends photo when image is provided"},{"ancestorTitles":["pulse helper"],"duration":0,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m\"-4166575919\"\u001b[39m, \u001b[32mStringContaining \"использовал команду\"\u001b[39m\n\nNumber of calls: \u001b[31m0\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/utils/pulse.test.ts:40:38\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"pulse helper sends message when image is null","status":"failed","title":"sends message when image is null"},{"ancestorTitles":["pulse helper"],"duration":0,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledTimes\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected number of calls: \u001b[32m2\u001b[39m\nReceived number of calls: \u001b[31m0\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/utils/pulse.test.ts:53:36\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"pulse helper retries sendPhoto on migrate_to_chat_id error","status":"failed","title":"retries sendPhoto on migrate_to_chat_id error"},{"ancestorTitles":["pulse helper"],"duration":1,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledTimes\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected number of calls: \u001b[32m2\u001b[39m\nReceived number of calls: \u001b[31m0\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/utils/pulse.test.ts:68:38\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"pulse helper retries sendMessage on migrate_to_chat_id error","status":"failed","title":"retries sendMessage on migrate_to_chat_id error"},{"ancestorTitles":["pulse helper"],"duration":0,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m()\u001b[22m\n\nReceived promise resolved instead of rejected\nResolved to value: \u001b[31mundefined\u001b[39m\n    at expect (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:113:15)\n    at /Users/playra/999-multibots-telegraf/__tests__/utils/pulse.test.ts:79:11\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/utils/pulse.test.ts:75:50)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"pulse helper throws on non-migration error","status":"failed","title":"throws on non-migration error"}]},{"numFailingTests":2,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171896672,"runtime":59,"slow":false,"start":1745171896613},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/config/indexExports.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mconfig index exports › defaults CREDENTIALS to false and NODE_ENV undefined\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\n    Expected: \u001b[32mfalse\u001b[39m\n    Received: \u001b[31mtrue\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 16 |\u001b[39m   it(\u001b[32m'defaults CREDENTIALS to false and NODE_ENV undefined'\u001b[39m\u001b[33m,\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[22m\n\u001b[2m     \u001b[90m 17 |\u001b[39m     \u001b[36mconst\u001b[39m config \u001b[33m=\u001b[39m require(\u001b[32m'../../src/config'\u001b[39m)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 18 |\u001b[39m     expect(config\u001b[33m.\u001b[39m\u001b[33mCREDENTIALS\u001b[39m)\u001b[33m.\u001b[39mtoBe(\u001b[36mfalse\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 19 |\u001b[39m     expect(config\u001b[33m.\u001b[39m\u001b[33mNODE_ENV\u001b[39m)\u001b[33m.\u001b[39mtoBeUndefined()\u001b[22m\n\u001b[2m     \u001b[90m 20 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 21 |\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/config/indexExports.test.ts\u001b[39m\u001b[0m\u001b[2m:18:32)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mconfig index exports › sets isSupabaseConfigured to false when supabase vars missing\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\n    Expected: \u001b[32mfalse\u001b[39m\n    Received: \u001b[31mtrue\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 47 |\u001b[39m     process\u001b[33m.\u001b[39menv\u001b[33m.\u001b[39m\u001b[33mSUPABASE_SERVICE_ROLE_KEY\u001b[39m \u001b[33m=\u001b[39m \u001b[32m'role'\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 48 |\u001b[39m     \u001b[36mconst\u001b[39m config \u001b[33m=\u001b[39m require(\u001b[32m'../../src/config'\u001b[39m)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 49 |\u001b[39m     expect(config\u001b[33m.\u001b[39misSupabaseConfigured)\u001b[33m.\u001b[39mtoBe(\u001b[36mfalse\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                         \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 50 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 51 |\u001b[39m })\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/config/indexExports.test.ts\u001b[39m\u001b[0m\u001b[2m:49:41)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["config index exports"],"duration":8,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32mfalse\u001b[39m\nReceived: \u001b[31mtrue\u001b[39m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/config/indexExports.test.ts:18:32)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"config index exports defaults CREDENTIALS to false and NODE_ENV undefined","status":"failed","title":"defaults CREDENTIALS to false and NODE_ENV undefined"},{"ancestorTitles":["config index exports"],"duration":6,"failureMessages":[],"fullName":"config index exports parses CREDENTIALS from env","status":"passed","title":"parses CREDENTIALS from env"},{"ancestorTitles":["config index exports"],"duration":5,"failureMessages":[],"fullName":"config index exports exports PORT and WEBHOOK_URL when set","status":"passed","title":"exports PORT and WEBHOOK_URL when set"},{"ancestorTitles":["config index exports"],"duration":10,"failureMessages":[],"fullName":"config index exports sets isSupabaseConfigured to true when all supabase vars are present","status":"passed","title":"sets isSupabaseConfigured to true when all supabase vars are present"},{"ancestorTitles":["config index exports"],"duration":5,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32mfalse\u001b[39m\nReceived: \u001b[31mtrue\u001b[39m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/config/indexExports.test.ts:49:41)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"config index exports sets isSupabaseConfigured to false when supabase vars missing","status":"failed","title":"sets isSupabaseConfigured to false when supabase vars missing"}]},{"numFailingTests":3,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171896668,"runtime":68,"slow":false,"start":1745171896600},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/services/generateImageToPrompt.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mgenerateImageToPrompt › skips API call and replies when ELESTIO_URL not set\u001b[39m\u001b[22m\n\n    supabaseUrl is required.\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m  9 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 10 |\u001b[39m \u001b[90m// Создаем клиент с service role key\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 11 |\u001b[39m \u001b[36mexport\u001b[39m \u001b[36mconst\u001b[39m supabase \u001b[33m=\u001b[39m createClient(\u001b[33mSUPABASE_URL\u001b[39m\u001b[33m,\u001b[39m \u001b[33mSUPABASE_SERVICE_KEY\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                     \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 12 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 13 |\u001b[39m \u001b[36mexport\u001b[39m \u001b[36mconst\u001b[39m supabaseAdmin \u001b[33m=\u001b[39m createClient(\u001b[22m\n\u001b[2m     \u001b[90m 14 |\u001b[39m   \u001b[33mSUPABASE_URL\u001b[39m\u001b[33m,\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat new SupabaseClient (\u001b[22m\u001b[2mnode_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/SupabaseClient.ts\u001b[2m:75:29)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat createClient (\u001b[22m\u001b[2mnode_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/index.ts\u001b[2m:40:10)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2msrc/core/supabase/client.ts\u001b[2m:11:37)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/core/supabase/index.ts\u001b[2m:1:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/services/plan_b/generateImageToPrompt.ts\u001b[2m:2:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/services/generateImageToPrompt.ts\u001b[2m:1:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/services/generateImageToPrompt.test.ts\u001b[39m\u001b[0m\u001b[2m:26:17)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/services/generateImageToPrompt.test.ts\u001b[39m\u001b[0m\u001b[2m:7:71\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous>.__awaiter (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/services/generateImageToPrompt.test.ts\u001b[39m\u001b[0m\u001b[2m:3:12)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/services/generateImageToPrompt.test.ts\u001b[39m\u001b[0m\u001b[2m:22:72)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mgenerateImageToPrompt › makes API call when ELESTIO_URL is set\u001b[39m\u001b[22m\n\n    supabaseUrl is required.\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m  9 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 10 |\u001b[39m \u001b[90m// Создаем клиент с service role key\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 11 |\u001b[39m \u001b[36mexport\u001b[39m \u001b[36mconst\u001b[39m supabase \u001b[33m=\u001b[39m createClient(\u001b[33mSUPABASE_URL\u001b[39m\u001b[33m,\u001b[39m \u001b[33mSUPABASE_SERVICE_KEY\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                     \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 12 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 13 |\u001b[39m \u001b[36mexport\u001b[39m \u001b[36mconst\u001b[39m supabaseAdmin \u001b[33m=\u001b[39m createClient(\u001b[22m\n\u001b[2m     \u001b[90m 14 |\u001b[39m   \u001b[33mSUPABASE_URL\u001b[39m\u001b[33m,\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat new SupabaseClient (\u001b[22m\u001b[2mnode_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/SupabaseClient.ts\u001b[2m:75:29)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat createClient (\u001b[22m\u001b[2mnode_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/index.ts\u001b[2m:40:10)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2msrc/core/supabase/client.ts\u001b[2m:11:37)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/core/supabase/index.ts\u001b[2m:1:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/services/plan_b/generateImageToPrompt.ts\u001b[2m:2:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/services/generateImageToPrompt.ts\u001b[2m:1:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/services/generateImageToPrompt.test.ts\u001b[39m\u001b[0m\u001b[2m:39:17)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/services/generateImageToPrompt.test.ts\u001b[39m\u001b[0m\u001b[2m:7:71\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous>.__awaiter (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/services/generateImageToPrompt.test.ts\u001b[39m\u001b[0m\u001b[2m:3:12)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/services/generateImageToPrompt.test.ts\u001b[39m\u001b[0m\u001b[2m:34:59)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mgenerateImageToPrompt › replies with error message on axios error\u001b[39m\u001b[22m\n\n    supabaseUrl is required.\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m  9 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 10 |\u001b[39m \u001b[90m// Создаем клиент с service role key\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 11 |\u001b[39m \u001b[36mexport\u001b[39m \u001b[36mconst\u001b[39m supabase \u001b[33m=\u001b[39m createClient(\u001b[33mSUPABASE_URL\u001b[39m\u001b[33m,\u001b[39m \u001b[33mSUPABASE_SERVICE_KEY\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                     \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 12 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 13 |\u001b[39m \u001b[36mexport\u001b[39m \u001b[36mconst\u001b[39m supabaseAdmin \u001b[33m=\u001b[39m createClient(\u001b[22m\n\u001b[2m     \u001b[90m 14 |\u001b[39m   \u001b[33mSUPABASE_URL\u001b[39m\u001b[33m,\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat new SupabaseClient (\u001b[22m\u001b[2mnode_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/SupabaseClient.ts\u001b[2m:75:29)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat createClient (\u001b[22m\u001b[2mnode_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/index.ts\u001b[2m:40:10)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2msrc/core/supabase/client.ts\u001b[2m:11:37)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/core/supabase/index.ts\u001b[2m:1:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/services/plan_b/generateImageToPrompt.ts\u001b[2m:2:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/services/generateImageToPrompt.ts\u001b[2m:1:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/services/generateImageToPrompt.test.ts\u001b[39m\u001b[0m\u001b[2m:57:17)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/services/generateImageToPrompt.test.ts\u001b[39m\u001b[0m\u001b[2m:7:71\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous>.__awaiter (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/services/generateImageToPrompt.test.ts\u001b[39m\u001b[0m\u001b[2m:3:12)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/services/generateImageToPrompt.test.ts\u001b[39m\u001b[0m\u001b[2m:51:62)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["generateImageToPrompt"],"duration":17,"failureMessages":["Error: supabaseUrl is required.\n    at new SupabaseClient (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/SupabaseClient.ts:75:29)\n    at createClient (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/index.ts:40:10)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/src/core/supabase/client.ts:11:37)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/core/supabase/index.ts:1:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/services/plan_b/generateImageToPrompt.ts:2:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/services/generateImageToPrompt.ts:1:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/services/generateImageToPrompt.test.ts:26:17)\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/__tests__/services/generateImageToPrompt.test.ts:7:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/playra/999-multibots-telegraf/__tests__/services/generateImageToPrompt.test.ts:3:12)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/services/generateImageToPrompt.test.ts:22:72)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"generateImageToPrompt skips API call and replies when ELESTIO_URL not set","status":"failed","title":"skips API call and replies when ELESTIO_URL not set"},{"ancestorTitles":["generateImageToPrompt"],"duration":8,"failureMessages":["Error: supabaseUrl is required.\n    at new SupabaseClient (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/SupabaseClient.ts:75:29)\n    at createClient (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/index.ts:40:10)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/src/core/supabase/client.ts:11:37)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/core/supabase/index.ts:1:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/services/plan_b/generateImageToPrompt.ts:2:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/services/generateImageToPrompt.ts:1:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/services/generateImageToPrompt.test.ts:39:17)\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/__tests__/services/generateImageToPrompt.test.ts:7:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/playra/999-multibots-telegraf/__tests__/services/generateImageToPrompt.test.ts:3:12)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/services/generateImageToPrompt.test.ts:34:59)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"generateImageToPrompt makes API call when ELESTIO_URL is set","status":"failed","title":"makes API call when ELESTIO_URL is set"},{"ancestorTitles":["generateImageToPrompt"],"duration":9,"failureMessages":["Error: supabaseUrl is required.\n    at new SupabaseClient (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/SupabaseClient.ts:75:29)\n    at createClient (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/index.ts:40:10)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/src/core/supabase/client.ts:11:37)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/core/supabase/index.ts:1:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/services/plan_b/generateImageToPrompt.ts:2:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/services/generateImageToPrompt.ts:1:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/services/generateImageToPrompt.test.ts:57:17)\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/__tests__/services/generateImageToPrompt.test.ts:7:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/playra/999-multibots-telegraf/__tests__/services/generateImageToPrompt.test.ts:3:12)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/services/generateImageToPrompt.test.ts:51:62)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"generateImageToPrompt replies with error message on axios error","status":"failed","title":"replies with error message on axios error"}]},{"numFailingTests":3,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171896680,"runtime":97,"slow":false,"start":1745171896583},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/sendPaymentInfo.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1msendPaymentInfo › returns data when insert succeeds\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32m\"payments\"\u001b[39m\n    Received: \u001b[31m\"payments_v2\"\u001b[39m\n\n    Number of calls: \u001b[31m1\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 32 |\u001b[39m     builder\u001b[33m.\u001b[39msingle\u001b[33m.\u001b[39mmockResolvedValueOnce({ data\u001b[33m:\u001b[39m dataObj\u001b[33m,\u001b[39m error\u001b[33m:\u001b[39m \u001b[36mnull\u001b[39m })\u001b[22m\n\u001b[2m     \u001b[90m 33 |\u001b[39m     \u001b[36mconst\u001b[39m result \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m sendPaymentInfo(\u001b[32m'u1'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'gold'\u001b[39m)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 34 |\u001b[39m     expect(mockFrom)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[32m'payments'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                      \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 35 |\u001b[39m     expect(builder\u001b[33m.\u001b[39minsert)\u001b[33m.\u001b[39mtoHaveBeenCalledWith([{ user_id\u001b[33m:\u001b[39m \u001b[32m'u1'\u001b[39m\u001b[33m,\u001b[39m level\u001b[33m:\u001b[39m \u001b[32m'gold'\u001b[39m }])\u001b[22m\n\u001b[2m     \u001b[90m 36 |\u001b[39m     expect(builder\u001b[33m.\u001b[39msingle)\u001b[33m.\u001b[39mtoHaveBeenCalled()\u001b[22m\n\u001b[2m     \u001b[90m 37 |\u001b[39m     expect(consoleLog)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[32m'Payment info sent successfully:'\u001b[39m\u001b[33m,\u001b[39m dataObj)\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/sendPaymentInfo.test.ts\u001b[39m\u001b[0m\u001b[2m:34:22)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/sendPaymentInfo.test.ts\u001b[39m\u001b[0m\u001b[2m:4:58)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1msendPaymentInfo › throws error when insert returns error\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m()\u001b[22m\n\n    Received promise resolved instead of rejected\n    Resolved to value: \u001b[31mfalse\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 42 |\u001b[39m     \u001b[36mconst\u001b[39m err \u001b[33m=\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(\u001b[32m'insert fail'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 43 |\u001b[39m     builder\u001b[33m.\u001b[39msingle\u001b[33m.\u001b[39mmockResolvedValueOnce({ data\u001b[33m:\u001b[39m \u001b[36mnull\u001b[39m\u001b[33m,\u001b[39m error\u001b[33m:\u001b[39m err })\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 44 |\u001b[39m     \u001b[36mawait\u001b[39m expect(sendPaymentInfo(\u001b[32m'u2'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'silver'\u001b[39m))\u001b[33m.\u001b[39mrejects\u001b[33m.\u001b[39mtoThrow(\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m           \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 45 |\u001b[39m       \u001b[32m`Failed to send payment info: ${err.message}`\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 46 |\u001b[39m     )\u001b[22m\n\u001b[2m     \u001b[90m 47 |\u001b[39m     expect(consoleError)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[32m'Error sending payment info:'\u001b[39m\u001b[33m,\u001b[39m err)\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat expect (\u001b[22m\u001b[2mnode_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js\u001b[2m:113:15)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/sendPaymentInfo.test.ts\u001b[39m\u001b[0m\u001b[2m:44:11)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/sendPaymentInfo.test.ts\u001b[39m\u001b[0m\u001b[2m:7:71\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous>.__awaiter (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/sendPaymentInfo.test.ts\u001b[39m\u001b[0m\u001b[2m:3:12)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/sendPaymentInfo.test.ts\u001b[39m\u001b[0m\u001b[2m:41:59)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1msendPaymentInfo › throws error when no data returned\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m()\u001b[22m\n\n    Received promise resolved instead of rejected\n    Resolved to value: \u001b[31mfalse\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 50 |\u001b[39m   it(\u001b[32m'throws error when no data returned'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[22m\n\u001b[2m     \u001b[90m 51 |\u001b[39m     builder\u001b[33m.\u001b[39msingle\u001b[33m.\u001b[39mmockResolvedValueOnce({ data\u001b[33m:\u001b[39m \u001b[36mnull\u001b[39m\u001b[33m,\u001b[39m error\u001b[33m:\u001b[39m \u001b[36mnull\u001b[39m })\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 52 |\u001b[39m     \u001b[36mawait\u001b[39m expect(sendPaymentInfo(\u001b[32m'u3'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'bronze'\u001b[39m))\u001b[33m.\u001b[39mrejects\u001b[33m.\u001b[39mtoThrow(\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m           \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 53 |\u001b[39m       \u001b[32m'No data returned after inserting payment info.'\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 54 |\u001b[39m     )\u001b[22m\n\u001b[2m     \u001b[90m 55 |\u001b[39m   })\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat expect (\u001b[22m\u001b[2mnode_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js\u001b[2m:113:15)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/sendPaymentInfo.test.ts\u001b[39m\u001b[0m\u001b[2m:52:11)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/sendPaymentInfo.test.ts\u001b[39m\u001b[0m\u001b[2m:7:71\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous>.__awaiter (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/sendPaymentInfo.test.ts\u001b[39m\u001b[0m\u001b[2m:3:12)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/sendPaymentInfo.test.ts\u001b[39m\u001b[0m\u001b[2m:50:55)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["sendPaymentInfo"],"duration":22,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m\"payments\"\u001b[39m\nReceived: \u001b[31m\"payments_v2\"\u001b[39m\n\nNumber of calls: \u001b[31m1\u001b[39m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/sendPaymentInfo.test.ts:34:22)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/sendPaymentInfo.test.ts:4:58)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"sendPaymentInfo returns data when insert succeeds","status":"failed","title":"returns data when insert succeeds"},{"ancestorTitles":["sendPaymentInfo"],"duration":24,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m()\u001b[22m\n\nReceived promise resolved instead of rejected\nResolved to value: \u001b[31mfalse\u001b[39m\n    at expect (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:113:15)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/sendPaymentInfo.test.ts:44:11)\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/__tests__/core/supabase/sendPaymentInfo.test.ts:7:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/sendPaymentInfo.test.ts:3:12)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/sendPaymentInfo.test.ts:41:59)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"sendPaymentInfo throws error when insert returns error","status":"failed","title":"throws error when insert returns error"},{"ancestorTitles":["sendPaymentInfo"],"duration":22,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m()\u001b[22m\n\nReceived promise resolved instead of rejected\nResolved to value: \u001b[31mfalse\u001b[39m\n    at expect (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:113:15)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/sendPaymentInfo.test.ts:52:11)\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/__tests__/core/supabase/sendPaymentInfo.test.ts:7:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/sendPaymentInfo.test.ts:3:12)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/sendPaymentInfo.test.ts:50:55)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"sendPaymentInfo throws error when no data returned","status":"failed","title":"throws error when no data returned"}]},{"numFailingTests":5,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171896760,"runtime":78,"slow":false,"start":1745171896682},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/bot/initEnv.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mcore/bot module initialization › throws error if BOT_TOKEN_2 is not set\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected substring: \u001b[32m\"BOT_TOKEN_2 is not set\"\u001b[39m\n    Received message:   \u001b[31m\"Cannot read properties of undefined (reading 'error')\"\u001b[39m\n\n        \u001b[0m \u001b[90m 14 |\u001b[39m \u001b[36mconst\u001b[39m loadResult \u001b[33m=\u001b[39m config({ path\u001b[33m:\u001b[39m envPath })\n         \u001b[90m 15 |\u001b[39m\n        \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 16 |\u001b[39m \u001b[36mif\u001b[39m (loadResult\u001b[33m.\u001b[39merror) {\n         \u001b[90m    |\u001b[39m                \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n         \u001b[90m 17 |\u001b[39m   console\u001b[33m.\u001b[39merror(\n         \u001b[90m 18 |\u001b[39m     \u001b[32m`[CONFIG] CRITICAL ERROR: Failed to load primary .env file from ${envPath}. Error: ${loadResult.error.message}`\u001b[39m\n         \u001b[90m 19 |\u001b[39m   )\u001b[0m\n\n          \u001b[2mat Object.error (\u001b[22msrc/config/index.ts\u001b[2m:16:16)\u001b[22m\n          \u001b[2mat Object.require (\u001b[22msrc/core/bot/index.ts\u001b[2m:5:1)\u001b[22m\n          \u001b[2mat \u001b[22m__tests__/core/bot/initEnv.test.ts\u001b[2m:10:18\u001b[22m\n          \u001b[2mat Object.<anonymous> (\u001b[22mnode_modules/.pnpm/expect@29.7.0/node_modules/expect/build/toThrowMatchers.js\u001b[2m:74:11)\u001b[22m\n          \u001b[2mat Object.throwingMatcher [as toThrow] (\u001b[22mnode_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js\u001b[2m:320:21)\u001b[22m\n          \u001b[2mat Object.<anonymous> (\u001b[22m__tests__/core/bot/initEnv.test.ts\u001b[2m:10:41)\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m  8 |\u001b[39m     process\u001b[33m.\u001b[39menv\u001b[33m.\u001b[39m\u001b[33mBOT_TOKEN_1\u001b[39m \u001b[33m=\u001b[39m \u001b[32m'x1'\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m  9 |\u001b[39m     \u001b[36mdelete\u001b[39m process\u001b[33m.\u001b[39menv\u001b[33m.\u001b[39m\u001b[33mBOT_TOKEN_2\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 10 |\u001b[39m     expect(() \u001b[33m=>\u001b[39m require(\u001b[32m'@/core/bot'\u001b[39m))\u001b[33m.\u001b[39mtoThrow(\u001b[32m'BOT_TOKEN_2 is not set'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                         \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 11 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 12 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 13 |\u001b[39m   it(\u001b[32m'throws error if BOT_TOKEN_3 is not set'\u001b[39m\u001b[33m,\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/bot/initEnv.test.ts\u001b[39m\u001b[0m\u001b[2m:10:41)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mcore/bot module initialization › throws error if BOT_TOKEN_3 is not set\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected substring: \u001b[32m\"BOT_TOKEN_3 is not set\"\u001b[39m\n    Received message:   \u001b[31m\"Cannot read properties of undefined (reading 'error')\"\u001b[39m\n\n        \u001b[0m \u001b[90m 14 |\u001b[39m \u001b[36mconst\u001b[39m loadResult \u001b[33m=\u001b[39m config({ path\u001b[33m:\u001b[39m envPath })\n         \u001b[90m 15 |\u001b[39m\n        \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 16 |\u001b[39m \u001b[36mif\u001b[39m (loadResult\u001b[33m.\u001b[39merror) {\n         \u001b[90m    |\u001b[39m                \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n         \u001b[90m 17 |\u001b[39m   console\u001b[33m.\u001b[39merror(\n         \u001b[90m 18 |\u001b[39m     \u001b[32m`[CONFIG] CRITICAL ERROR: Failed to load primary .env file from ${envPath}. Error: ${loadResult.error.message}`\u001b[39m\n         \u001b[90m 19 |\u001b[39m   )\u001b[0m\n\n          \u001b[2mat Object.error (\u001b[22msrc/config/index.ts\u001b[2m:16:16)\u001b[22m\n          \u001b[2mat Object.require (\u001b[22msrc/core/bot/index.ts\u001b[2m:5:1)\u001b[22m\n          \u001b[2mat \u001b[22m__tests__/core/bot/initEnv.test.ts\u001b[2m:19:18\u001b[22m\n          \u001b[2mat Object.<anonymous> (\u001b[22mnode_modules/.pnpm/expect@29.7.0/node_modules/expect/build/toThrowMatchers.js\u001b[2m:74:11)\u001b[22m\n          \u001b[2mat Object.throwingMatcher [as toThrow] (\u001b[22mnode_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js\u001b[2m:320:21)\u001b[22m\n          \u001b[2mat Object.<anonymous> (\u001b[22m__tests__/core/bot/initEnv.test.ts\u001b[2m:19:41)\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 17 |\u001b[39m     process\u001b[33m.\u001b[39menv\u001b[33m.\u001b[39m\u001b[33mBOT_TOKEN_2\u001b[39m \u001b[33m=\u001b[39m \u001b[32m'x2'\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 18 |\u001b[39m     \u001b[36mdelete\u001b[39m process\u001b[33m.\u001b[39menv\u001b[33m.\u001b[39m\u001b[33mBOT_TOKEN_3\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 19 |\u001b[39m     expect(() \u001b[33m=>\u001b[39m require(\u001b[32m'@/core/bot'\u001b[39m))\u001b[33m.\u001b[39mtoThrow(\u001b[32m'BOT_TOKEN_3 is not set'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                         \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 20 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 21 |\u001b[39m   beforeEach(() \u001b[33m=>\u001b[39m {\u001b[22m\n\u001b[2m     \u001b[90m 22 |\u001b[39m     jest\u001b[33m.\u001b[39mresetModules()\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/bot/initEnv.test.ts\u001b[39m\u001b[0m\u001b[2m:19:41)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mcore/bot module initialization › throws error if BOT_TOKEN_1 is not set\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected substring: \u001b[32m\"BOT_TOKEN_1 is not set\"\u001b[39m\n    Received message:   \u001b[31m\"Cannot read properties of undefined (reading 'error')\"\u001b[39m\n\n        \u001b[0m \u001b[90m 14 |\u001b[39m \u001b[36mconst\u001b[39m loadResult \u001b[33m=\u001b[39m config({ path\u001b[33m:\u001b[39m envPath })\n         \u001b[90m 15 |\u001b[39m\n        \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 16 |\u001b[39m \u001b[36mif\u001b[39m (loadResult\u001b[33m.\u001b[39merror) {\n         \u001b[90m    |\u001b[39m                \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n         \u001b[90m 17 |\u001b[39m   console\u001b[33m.\u001b[39merror(\n         \u001b[90m 18 |\u001b[39m     \u001b[32m`[CONFIG] CRITICAL ERROR: Failed to load primary .env file from ${envPath}. Error: ${loadResult.error.message}`\u001b[39m\n         \u001b[90m 19 |\u001b[39m   )\u001b[0m\n\n          \u001b[2mat Object.error (\u001b[22msrc/config/index.ts\u001b[2m:16:16)\u001b[22m\n          \u001b[2mat Object.require (\u001b[22msrc/core/bot/index.ts\u001b[2m:5:1)\u001b[22m\n          \u001b[2mat \u001b[22m__tests__/core/bot/initEnv.test.ts\u001b[2m:30:18\u001b[22m\n          \u001b[2mat Object.<anonymous> (\u001b[22mnode_modules/.pnpm/expect@29.7.0/node_modules/expect/build/toThrowMatchers.js\u001b[2m:74:11)\u001b[22m\n          \u001b[2mat Object.throwingMatcher [as toThrow] (\u001b[22mnode_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js\u001b[2m:320:21)\u001b[22m\n          \u001b[2mat Object.<anonymous> (\u001b[22m__tests__/core/bot/initEnv.test.ts\u001b[2m:30:41)\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 28 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 29 |\u001b[39m   it(\u001b[32m'throws error if BOT_TOKEN_1 is not set'\u001b[39m\u001b[33m,\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 30 |\u001b[39m     expect(() \u001b[33m=>\u001b[39m require(\u001b[32m'@/core/bot'\u001b[39m))\u001b[33m.\u001b[39mtoThrow(\u001b[32m'BOT_TOKEN_1 is not set'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                         \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 31 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 32 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 33 |\u001b[39m   it(\u001b[32m'throws error if BOT_TOKEN_TEST_1 is not set (for tests)'\u001b[39m\u001b[33m,\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/bot/initEnv.test.ts\u001b[39m\u001b[0m\u001b[2m:30:41)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mcore/bot module initialization › throws error if BOT_TOKEN_TEST_1 is not set (for tests)\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected substring: \u001b[32m\"BOT_TOKEN_TEST_1 is not set\"\u001b[39m\n    Received message:   \u001b[31m\"Cannot read properties of undefined (reading 'error')\"\u001b[39m\n\n        \u001b[0m \u001b[90m 14 |\u001b[39m \u001b[36mconst\u001b[39m loadResult \u001b[33m=\u001b[39m config({ path\u001b[33m:\u001b[39m envPath })\n         \u001b[90m 15 |\u001b[39m\n        \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 16 |\u001b[39m \u001b[36mif\u001b[39m (loadResult\u001b[33m.\u001b[39merror) {\n         \u001b[90m    |\u001b[39m                \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n         \u001b[90m 17 |\u001b[39m   console\u001b[33m.\u001b[39merror(\n         \u001b[90m 18 |\u001b[39m     \u001b[32m`[CONFIG] CRITICAL ERROR: Failed to load primary .env file from ${envPath}. Error: ${loadResult.error.message}`\u001b[39m\n         \u001b[90m 19 |\u001b[39m   )\u001b[0m\n\n          \u001b[2mat Object.error (\u001b[22msrc/config/index.ts\u001b[2m:16:16)\u001b[22m\n          \u001b[2mat Object.require (\u001b[22msrc/core/bot/index.ts\u001b[2m:5:1)\u001b[22m\n          \u001b[2mat \u001b[22m__tests__/core/bot/initEnv.test.ts\u001b[2m:43:18\u001b[22m\n          \u001b[2mat Object.<anonymous> (\u001b[22mnode_modules/.pnpm/expect@29.7.0/node_modules/expect/build/toThrowMatchers.js\u001b[2m:74:11)\u001b[22m\n          \u001b[2mat Object.throwingMatcher [as toThrow] (\u001b[22mnode_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js\u001b[2m:320:21)\u001b[22m\n          \u001b[2mat Object.<anonymous> (\u001b[22m__tests__/core/bot/initEnv.test.ts\u001b[2m:43:41)\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 41 |\u001b[39m     process\u001b[33m.\u001b[39menv\u001b[33m.\u001b[39m\u001b[33mBOT_TOKEN_6\u001b[39m \u001b[33m=\u001b[39m \u001b[32m'c'\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 42 |\u001b[39m     process\u001b[33m.\u001b[39menv\u001b[33m.\u001b[39m\u001b[33mBOT_TOKEN_7\u001b[39m \u001b[33m=\u001b[39m \u001b[32m'd'\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 43 |\u001b[39m     expect(() \u001b[33m=>\u001b[39m require(\u001b[32m'@/core/bot'\u001b[39m))\u001b[33m.\u001b[39mtoThrow(\u001b[32m'BOT_TOKEN_TEST_1 is not set'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                         \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 44 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 45 |\u001b[39m   \u001b[22m\n\u001b[2m     \u001b[90m 46 |\u001b[39m   it(\u001b[32m'throws error if BOT_TOKEN_TEST_2 is not set'\u001b[39m\u001b[33m,\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/bot/initEnv.test.ts\u001b[39m\u001b[0m\u001b[2m:43:41)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mcore/bot module initialization › throws error if BOT_TOKEN_TEST_2 is not set\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected substring: \u001b[32m\"BOT_TOKEN_TEST_2 is not set\"\u001b[39m\n    Received message:   \u001b[31m\"Cannot read properties of undefined (reading 'error')\"\u001b[39m\n\n        \u001b[0m \u001b[90m 14 |\u001b[39m \u001b[36mconst\u001b[39m loadResult \u001b[33m=\u001b[39m config({ path\u001b[33m:\u001b[39m envPath })\n         \u001b[90m 15 |\u001b[39m\n        \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 16 |\u001b[39m \u001b[36mif\u001b[39m (loadResult\u001b[33m.\u001b[39merror) {\n         \u001b[90m    |\u001b[39m                \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n         \u001b[90m 17 |\u001b[39m   console\u001b[33m.\u001b[39merror(\n         \u001b[90m 18 |\u001b[39m     \u001b[32m`[CONFIG] CRITICAL ERROR: Failed to load primary .env file from ${envPath}. Error: ${loadResult.error.message}`\u001b[39m\n         \u001b[90m 19 |\u001b[39m   )\u001b[0m\n\n          \u001b[2mat Object.error (\u001b[22msrc/config/index.ts\u001b[2m:16:16)\u001b[22m\n          \u001b[2mat Object.require (\u001b[22msrc/core/bot/index.ts\u001b[2m:5:1)\u001b[22m\n          \u001b[2mat \u001b[22m__tests__/core/bot/initEnv.test.ts\u001b[2m:57:18\u001b[22m\n          \u001b[2mat Object.<anonymous> (\u001b[22mnode_modules/.pnpm/expect@29.7.0/node_modules/expect/build/toThrowMatchers.js\u001b[2m:74:11)\u001b[22m\n          \u001b[2mat Object.throwingMatcher [as toThrow] (\u001b[22mnode_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js\u001b[2m:320:21)\u001b[22m\n          \u001b[2mat Object.<anonymous> (\u001b[22m__tests__/core/bot/initEnv.test.ts\u001b[2m:57:41)\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 55 |\u001b[39m     process\u001b[33m.\u001b[39menv\u001b[33m.\u001b[39m\u001b[33mBOT_TOKEN_TEST_1\u001b[39m \u001b[33m=\u001b[39m \u001b[32m't1'\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 56 |\u001b[39m     \u001b[36mdelete\u001b[39m process\u001b[33m.\u001b[39menv\u001b[33m.\u001b[39m\u001b[33mBOT_TOKEN_TEST_2\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 57 |\u001b[39m     expect(() \u001b[33m=>\u001b[39m require(\u001b[32m'@/core/bot'\u001b[39m))\u001b[33m.\u001b[39mtoThrow(\u001b[32m'BOT_TOKEN_TEST_2 is not set'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                         \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 58 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 59 |\u001b[39m })\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/bot/initEnv.test.ts\u001b[39m\u001b[0m\u001b[2m:57:41)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["core/bot module initialization"],"duration":23,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected substring: \u001b[32m\"BOT_TOKEN_2 is not set\"\u001b[39m\nReceived message:   \u001b[31m\"Cannot read properties of undefined (reading 'error')\"\u001b[39m\n\n    \u001b[0m \u001b[90m 14 |\u001b[39m \u001b[36mconst\u001b[39m loadResult \u001b[33m=\u001b[39m config({ path\u001b[33m:\u001b[39m envPath })\n     \u001b[90m 15 |\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 16 |\u001b[39m \u001b[36mif\u001b[39m (loadResult\u001b[33m.\u001b[39merror) {\n     \u001b[90m    |\u001b[39m                \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 17 |\u001b[39m   console\u001b[33m.\u001b[39merror(\n     \u001b[90m 18 |\u001b[39m     \u001b[32m`[CONFIG] CRITICAL ERROR: Failed to load primary .env file from ${envPath}. Error: ${loadResult.error.message}`\u001b[39m\n     \u001b[90m 19 |\u001b[39m   )\u001b[0m\n\n      \u001b[2mat Object.error (\u001b[22msrc/config/index.ts\u001b[2m:16:16)\u001b[22m\n      \u001b[2mat Object.require (\u001b[22msrc/core/bot/index.ts\u001b[2m:5:1)\u001b[22m\n      \u001b[2mat \u001b[22m__tests__/core/bot/initEnv.test.ts\u001b[2m:10:18\u001b[22m\n      \u001b[2mat Object.<anonymous> (\u001b[22mnode_modules/.pnpm/expect@29.7.0/node_modules/expect/build/toThrowMatchers.js\u001b[2m:74:11)\u001b[22m\n      \u001b[2mat Object.throwingMatcher [as toThrow] (\u001b[22mnode_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js\u001b[2m:320:21)\u001b[22m\n      \u001b[2mat Object.<anonymous> (\u001b[22m__tests__/core/bot/initEnv.test.ts\u001b[2m:10:41)\u001b[22m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/bot/initEnv.test.ts:10:41)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"core/bot module initialization throws error if BOT_TOKEN_2 is not set","status":"failed","title":"throws error if BOT_TOKEN_2 is not set"},{"ancestorTitles":["core/bot module initialization"],"duration":6,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected substring: \u001b[32m\"BOT_TOKEN_3 is not set\"\u001b[39m\nReceived message:   \u001b[31m\"Cannot read properties of undefined (reading 'error')\"\u001b[39m\n\n    \u001b[0m \u001b[90m 14 |\u001b[39m \u001b[36mconst\u001b[39m loadResult \u001b[33m=\u001b[39m config({ path\u001b[33m:\u001b[39m envPath })\n     \u001b[90m 15 |\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 16 |\u001b[39m \u001b[36mif\u001b[39m (loadResult\u001b[33m.\u001b[39merror) {\n     \u001b[90m    |\u001b[39m                \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 17 |\u001b[39m   console\u001b[33m.\u001b[39merror(\n     \u001b[90m 18 |\u001b[39m     \u001b[32m`[CONFIG] CRITICAL ERROR: Failed to load primary .env file from ${envPath}. Error: ${loadResult.error.message}`\u001b[39m\n     \u001b[90m 19 |\u001b[39m   )\u001b[0m\n\n      \u001b[2mat Object.error (\u001b[22msrc/config/index.ts\u001b[2m:16:16)\u001b[22m\n      \u001b[2mat Object.require (\u001b[22msrc/core/bot/index.ts\u001b[2m:5:1)\u001b[22m\n      \u001b[2mat \u001b[22m__tests__/core/bot/initEnv.test.ts\u001b[2m:19:18\u001b[22m\n      \u001b[2mat Object.<anonymous> (\u001b[22mnode_modules/.pnpm/expect@29.7.0/node_modules/expect/build/toThrowMatchers.js\u001b[2m:74:11)\u001b[22m\n      \u001b[2mat Object.throwingMatcher [as toThrow] (\u001b[22mnode_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js\u001b[2m:320:21)\u001b[22m\n      \u001b[2mat Object.<anonymous> (\u001b[22m__tests__/core/bot/initEnv.test.ts\u001b[2m:19:41)\u001b[22m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/bot/initEnv.test.ts:19:41)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"core/bot module initialization throws error if BOT_TOKEN_3 is not set","status":"failed","title":"throws error if BOT_TOKEN_3 is not set"},{"ancestorTitles":["core/bot module initialization"],"duration":4,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected substring: \u001b[32m\"BOT_TOKEN_1 is not set\"\u001b[39m\nReceived message:   \u001b[31m\"Cannot read properties of undefined (reading 'error')\"\u001b[39m\n\n    \u001b[0m \u001b[90m 14 |\u001b[39m \u001b[36mconst\u001b[39m loadResult \u001b[33m=\u001b[39m config({ path\u001b[33m:\u001b[39m envPath })\n     \u001b[90m 15 |\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 16 |\u001b[39m \u001b[36mif\u001b[39m (loadResult\u001b[33m.\u001b[39merror) {\n     \u001b[90m    |\u001b[39m                \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 17 |\u001b[39m   console\u001b[33m.\u001b[39merror(\n     \u001b[90m 18 |\u001b[39m     \u001b[32m`[CONFIG] CRITICAL ERROR: Failed to load primary .env file from ${envPath}. Error: ${loadResult.error.message}`\u001b[39m\n     \u001b[90m 19 |\u001b[39m   )\u001b[0m\n\n      \u001b[2mat Object.error (\u001b[22msrc/config/index.ts\u001b[2m:16:16)\u001b[22m\n      \u001b[2mat Object.require (\u001b[22msrc/core/bot/index.ts\u001b[2m:5:1)\u001b[22m\n      \u001b[2mat \u001b[22m__tests__/core/bot/initEnv.test.ts\u001b[2m:30:18\u001b[22m\n      \u001b[2mat Object.<anonymous> (\u001b[22mnode_modules/.pnpm/expect@29.7.0/node_modules/expect/build/toThrowMatchers.js\u001b[2m:74:11)\u001b[22m\n      \u001b[2mat Object.throwingMatcher [as toThrow] (\u001b[22mnode_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js\u001b[2m:320:21)\u001b[22m\n      \u001b[2mat Object.<anonymous> (\u001b[22m__tests__/core/bot/initEnv.test.ts\u001b[2m:30:41)\u001b[22m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/bot/initEnv.test.ts:30:41)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"core/bot module initialization throws error if BOT_TOKEN_1 is not set","status":"failed","title":"throws error if BOT_TOKEN_1 is not set"},{"ancestorTitles":["core/bot module initialization"],"duration":6,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected substring: \u001b[32m\"BOT_TOKEN_TEST_1 is not set\"\u001b[39m\nReceived message:   \u001b[31m\"Cannot read properties of undefined (reading 'error')\"\u001b[39m\n\n    \u001b[0m \u001b[90m 14 |\u001b[39m \u001b[36mconst\u001b[39m loadResult \u001b[33m=\u001b[39m config({ path\u001b[33m:\u001b[39m envPath })\n     \u001b[90m 15 |\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 16 |\u001b[39m \u001b[36mif\u001b[39m (loadResult\u001b[33m.\u001b[39merror) {\n     \u001b[90m    |\u001b[39m                \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 17 |\u001b[39m   console\u001b[33m.\u001b[39merror(\n     \u001b[90m 18 |\u001b[39m     \u001b[32m`[CONFIG] CRITICAL ERROR: Failed to load primary .env file from ${envPath}. Error: ${loadResult.error.message}`\u001b[39m\n     \u001b[90m 19 |\u001b[39m   )\u001b[0m\n\n      \u001b[2mat Object.error (\u001b[22msrc/config/index.ts\u001b[2m:16:16)\u001b[22m\n      \u001b[2mat Object.require (\u001b[22msrc/core/bot/index.ts\u001b[2m:5:1)\u001b[22m\n      \u001b[2mat \u001b[22m__tests__/core/bot/initEnv.test.ts\u001b[2m:43:18\u001b[22m\n      \u001b[2mat Object.<anonymous> (\u001b[22mnode_modules/.pnpm/expect@29.7.0/node_modules/expect/build/toThrowMatchers.js\u001b[2m:74:11)\u001b[22m\n      \u001b[2mat Object.throwingMatcher [as toThrow] (\u001b[22mnode_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js\u001b[2m:320:21)\u001b[22m\n      \u001b[2mat Object.<anonymous> (\u001b[22m__tests__/core/bot/initEnv.test.ts\u001b[2m:43:41)\u001b[22m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/bot/initEnv.test.ts:43:41)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"core/bot module initialization throws error if BOT_TOKEN_TEST_1 is not set (for tests)","status":"failed","title":"throws error if BOT_TOKEN_TEST_1 is not set (for tests)"},{"ancestorTitles":["core/bot module initialization"],"duration":16,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected substring: \u001b[32m\"BOT_TOKEN_TEST_2 is not set\"\u001b[39m\nReceived message:   \u001b[31m\"Cannot read properties of undefined (reading 'error')\"\u001b[39m\n\n    \u001b[0m \u001b[90m 14 |\u001b[39m \u001b[36mconst\u001b[39m loadResult \u001b[33m=\u001b[39m config({ path\u001b[33m:\u001b[39m envPath })\n     \u001b[90m 15 |\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 16 |\u001b[39m \u001b[36mif\u001b[39m (loadResult\u001b[33m.\u001b[39merror) {\n     \u001b[90m    |\u001b[39m                \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 17 |\u001b[39m   console\u001b[33m.\u001b[39merror(\n     \u001b[90m 18 |\u001b[39m     \u001b[32m`[CONFIG] CRITICAL ERROR: Failed to load primary .env file from ${envPath}. Error: ${loadResult.error.message}`\u001b[39m\n     \u001b[90m 19 |\u001b[39m   )\u001b[0m\n\n      \u001b[2mat Object.error (\u001b[22msrc/config/index.ts\u001b[2m:16:16)\u001b[22m\n      \u001b[2mat Object.require (\u001b[22msrc/core/bot/index.ts\u001b[2m:5:1)\u001b[22m\n      \u001b[2mat \u001b[22m__tests__/core/bot/initEnv.test.ts\u001b[2m:57:18\u001b[22m\n      \u001b[2mat Object.<anonymous> (\u001b[22mnode_modules/.pnpm/expect@29.7.0/node_modules/expect/build/toThrowMatchers.js\u001b[2m:74:11)\u001b[22m\n      \u001b[2mat Object.throwingMatcher [as toThrow] (\u001b[22mnode_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js\u001b[2m:320:21)\u001b[22m\n      \u001b[2mat Object.<anonymous> (\u001b[22m__tests__/core/bot/initEnv.test.ts\u001b[2m:57:41)\u001b[22m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/bot/initEnv.test.ts:57:41)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"core/bot module initialization throws error if BOT_TOKEN_TEST_2 is not set","status":"failed","title":"throws error if BOT_TOKEN_TEST_2 is not set"}]},{"numFailingTests":2,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171896779,"runtime":91,"slow":false,"start":1745171896688},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/elevenlabs/index.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mcore/elevenlabs client creation › uses real client when API key is set and module exists\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBeInstanceOf\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected constructor: \u001b[32mRealClient\u001b[39m\n    Received constructor: \u001b[31mElevenLabsClient\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 23 |\u001b[39m     jest\u001b[33m.\u001b[39mmock(\u001b[32m'elevenlabs'\u001b[39m\u001b[33m,\u001b[39m () \u001b[33m=>\u001b[39m ({ \u001b[33mElevenLabsClient\u001b[39m\u001b[33m:\u001b[39m \u001b[33mRealClient\u001b[39m })\u001b[33m,\u001b[39m { virtual\u001b[33m:\u001b[39m \u001b[36mtrue\u001b[39m })\u001b[22m\n\u001b[2m     \u001b[90m 24 |\u001b[39m     \u001b[36mconst\u001b[39m { elevenlabs } \u001b[33m=\u001b[39m require(\u001b[32m'@/core/elevenlabs'\u001b[39m)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 25 |\u001b[39m     expect(elevenlabs)\u001b[33m.\u001b[39mtoBeInstanceOf(\u001b[33mRealClient\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 26 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 27 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 28 |\u001b[39m   it(\u001b[32m'falls back to mock client when real client creation throws'\u001b[39m\u001b[33m,\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/elevenlabs/index.test.ts\u001b[39m\u001b[0m\u001b[2m:25:24)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mcore/elevenlabs client creation › falls back to mock client when real client creation throws\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\n    Expected: \u001b[32m\"\u001b[7mf\u001b[27mun\u001b[7mction\u001b[27m\"\u001b[39m\n    Received: \u001b[31m\"un\u001b[7mdefined\u001b[27m\"\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 33 |\u001b[39m     \u001b[36mconst\u001b[39m { elevenlabs } \u001b[33m=\u001b[39m require(\u001b[32m'@/core/elevenlabs'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 34 |\u001b[39m     expect(elevenlabs)\u001b[33m.\u001b[39mtoBeDefined()\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 35 |\u001b[39m     expect(\u001b[36mtypeof\u001b[39m elevenlabs\u001b[33m.\u001b[39mgetVoices)\u001b[33m.\u001b[39mtoBe(\u001b[32m'function'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                         \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 36 |\u001b[39m     expect(errorSpy)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[22m\n\u001b[2m     \u001b[90m 37 |\u001b[39m       \u001b[32m'Error creating ElevenLabs client, falling back to mock:'\u001b[39m\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 38 |\u001b[39m       expect\u001b[33m.\u001b[39many(\u001b[33mError\u001b[39m)\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/elevenlabs/index.test.ts\u001b[39m\u001b[0m\u001b[2m:35:41)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["core/elevenlabs client creation"],"duration":4,"failureMessages":[],"fullName":"core/elevenlabs client creation uses mock client when API key is not set","status":"passed","title":"uses mock client when API key is not set"},{"ancestorTitles":["core/elevenlabs client creation"],"duration":19,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBeInstanceOf\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected constructor: \u001b[32mRealClient\u001b[39m\nReceived constructor: \u001b[31mElevenLabsClient\u001b[39m\n\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/elevenlabs/index.test.ts:25:24)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"core/elevenlabs client creation uses real client when API key is set and module exists","status":"failed","title":"uses real client when API key is set and module exists"},{"ancestorTitles":["core/elevenlabs client creation"],"duration":42,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32m\"\u001b[7mf\u001b[27mun\u001b[7mction\u001b[27m\"\u001b[39m\nReceived: \u001b[31m\"un\u001b[7mdefined\u001b[27m\"\u001b[39m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/elevenlabs/index.test.ts:35:41)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"core/elevenlabs client creation falls back to mock client when real client creation throws","status":"failed","title":"falls back to mock client when real client creation throws"}]},{"numFailingTests":5,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171896797,"runtime":119,"slow":false,"start":1745171896678},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/utils/configHelpers.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mconfig utilities › getWebhookConfig reads env vars correctly\u001b[39m\u001b[22m\n\n    TypeError: path_1.default.join is not a function\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m  5 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m  6 |\u001b[39m \u001b[90m// Создаем директорию для логов, если её нет\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m  7 |\u001b[39m \u001b[36mconst\u001b[39m logDir \u001b[33m=\u001b[39m path\u001b[33m.\u001b[39mjoin(process\u001b[33m.\u001b[39mcwd()\u001b[33m,\u001b[39m \u001b[32m'logs'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                     \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m  8 |\u001b[39m \u001b[36mif\u001b[39m (\u001b[33m!\u001b[39mfs\u001b[33m.\u001b[39mexistsSync(logDir)) {\u001b[22m\n\u001b[2m     \u001b[90m  9 |\u001b[39m   fs\u001b[33m.\u001b[39mmkdirSync(logDir\u001b[33m,\u001b[39m { recursive\u001b[33m:\u001b[39m \u001b[36mtrue\u001b[39m })\u001b[22m\n\u001b[2m     \u001b[90m 10 |\u001b[39m }\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.join (\u001b[22m\u001b[2msrc/utils/logger.ts\u001b[2m:7:21)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/utils/config.ts\u001b[2m:4:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/utils/configHelpers.test.ts\u001b[39m\u001b[0m\u001b[2m:28:34)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mconfig utilities › getBotTokens returns empty and logs error when no tokens found\u001b[39m\u001b[22m\n\n    TypeError: path_1.default.join is not a function\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m  5 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m  6 |\u001b[39m \u001b[90m// Создаем директорию для логов, если её нет\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m  7 |\u001b[39m \u001b[36mconst\u001b[39m logDir \u001b[33m=\u001b[39m path\u001b[33m.\u001b[39mjoin(process\u001b[33m.\u001b[39mcwd()\u001b[33m,\u001b[39m \u001b[32m'logs'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                     \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m  8 |\u001b[39m \u001b[36mif\u001b[39m (\u001b[33m!\u001b[39mfs\u001b[33m.\u001b[39mexistsSync(logDir)) {\u001b[22m\n\u001b[2m     \u001b[90m  9 |\u001b[39m   fs\u001b[33m.\u001b[39mmkdirSync(logDir\u001b[33m,\u001b[39m { recursive\u001b[33m:\u001b[39m \u001b[36mtrue\u001b[39m })\u001b[22m\n\u001b[2m     \u001b[90m 10 |\u001b[39m }\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.join (\u001b[22m\u001b[2msrc/utils/logger.ts\u001b[2m:7:21)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/utils/configHelpers.test.ts\u001b[39m\u001b[0m\u001b[2m:39:20)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mconfig utilities › getBotTokens collects valid BOT_TOKEN env var\u001b[39m\u001b[22m\n\n    TypeError: path_1.default.join is not a function\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m  5 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m  6 |\u001b[39m \u001b[90m// Создаем директорию для логов, если её нет\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m  7 |\u001b[39m \u001b[36mconst\u001b[39m logDir \u001b[33m=\u001b[39m path\u001b[33m.\u001b[39mjoin(process\u001b[33m.\u001b[39mcwd()\u001b[33m,\u001b[39m \u001b[32m'logs'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                     \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m  8 |\u001b[39m \u001b[36mif\u001b[39m (\u001b[33m!\u001b[39mfs\u001b[33m.\u001b[39mexistsSync(logDir)) {\u001b[22m\n\u001b[2m     \u001b[90m  9 |\u001b[39m   fs\u001b[33m.\u001b[39mmkdirSync(logDir\u001b[33m,\u001b[39m { recursive\u001b[33m:\u001b[39m \u001b[36mtrue\u001b[39m })\u001b[22m\n\u001b[2m     \u001b[90m 10 |\u001b[39m }\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.join (\u001b[22m\u001b[2msrc/utils/logger.ts\u001b[2m:7:21)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/utils/config.ts\u001b[2m:4:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/utils/configHelpers.test.ts\u001b[39m\u001b[0m\u001b[2m:51:30)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mconfig utilities › getBotTokens collects tokens from BOT_TOKENS env var\u001b[39m\u001b[22m\n\n    TypeError: path_1.default.join is not a function\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m  5 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m  6 |\u001b[39m \u001b[90m// Создаем директорию для логов, если её нет\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m  7 |\u001b[39m \u001b[36mconst\u001b[39m logDir \u001b[33m=\u001b[39m path\u001b[33m.\u001b[39mjoin(process\u001b[33m.\u001b[39mcwd()\u001b[33m,\u001b[39m \u001b[32m'logs'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                     \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m  8 |\u001b[39m \u001b[36mif\u001b[39m (\u001b[33m!\u001b[39mfs\u001b[33m.\u001b[39mexistsSync(logDir)) {\u001b[22m\n\u001b[2m     \u001b[90m  9 |\u001b[39m   fs\u001b[33m.\u001b[39mmkdirSync(logDir\u001b[33m,\u001b[39m { recursive\u001b[33m:\u001b[39m \u001b[36mtrue\u001b[39m })\u001b[22m\n\u001b[2m     \u001b[90m 10 |\u001b[39m }\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.join (\u001b[22m\u001b[2msrc/utils/logger.ts\u001b[2m:7:21)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/utils/config.ts\u001b[2m:4:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/utils/configHelpers.test.ts\u001b[39m\u001b[0m\u001b[2m:58:30)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mconfig utilities › loadConfig uses getBotTokens and returns bots array\u001b[39m\u001b[22m\n\n    TypeError: path_1.default.join is not a function\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m  5 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m  6 |\u001b[39m \u001b[90m// Создаем директорию для логов, если её нет\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m  7 |\u001b[39m \u001b[36mconst\u001b[39m logDir \u001b[33m=\u001b[39m path\u001b[33m.\u001b[39mjoin(process\u001b[33m.\u001b[39mcwd()\u001b[33m,\u001b[39m \u001b[32m'logs'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                     \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m  8 |\u001b[39m \u001b[36mif\u001b[39m (\u001b[33m!\u001b[39mfs\u001b[33m.\u001b[39mexistsSync(logDir)) {\u001b[22m\n\u001b[2m     \u001b[90m  9 |\u001b[39m   fs\u001b[33m.\u001b[39mmkdirSync(logDir\u001b[33m,\u001b[39m { recursive\u001b[33m:\u001b[39m \u001b[36mtrue\u001b[39m })\u001b[22m\n\u001b[2m     \u001b[90m 10 |\u001b[39m }\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.join (\u001b[22m\u001b[2msrc/utils/logger.ts\u001b[2m:7:21)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/utils/config.ts\u001b[2m:4:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/utils/configHelpers.test.ts\u001b[39m\u001b[0m\u001b[2m:69:26)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["config utilities"],"duration":17,"failureMessages":["TypeError: path_1.default.join is not a function\n    at Object.join (/Users/playra/999-multibots-telegraf/src/utils/logger.ts:7:21)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/utils/config.ts:4:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/utils/configHelpers.test.ts:28:34)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"config utilities getWebhookConfig reads env vars correctly","status":"failed","title":"getWebhookConfig reads env vars correctly"},{"ancestorTitles":["config utilities"],"duration":21,"failureMessages":["TypeError: path_1.default.join is not a function\n    at Object.join (/Users/playra/999-multibots-telegraf/src/utils/logger.ts:7:21)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/utils/configHelpers.test.ts:39:20)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"config utilities getBotTokens returns empty and logs error when no tokens found","status":"failed","title":"getBotTokens returns empty and logs error when no tokens found"},{"ancestorTitles":["config utilities"],"duration":18,"failureMessages":["TypeError: path_1.default.join is not a function\n    at Object.join (/Users/playra/999-multibots-telegraf/src/utils/logger.ts:7:21)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/utils/config.ts:4:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/utils/configHelpers.test.ts:51:30)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"config utilities getBotTokens collects valid BOT_TOKEN env var","status":"failed","title":"getBotTokens collects valid BOT_TOKEN env var"},{"ancestorTitles":["config utilities"],"duration":10,"failureMessages":["TypeError: path_1.default.join is not a function\n    at Object.join (/Users/playra/999-multibots-telegraf/src/utils/logger.ts:7:21)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/utils/config.ts:4:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/utils/configHelpers.test.ts:58:30)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"config utilities getBotTokens collects tokens from BOT_TOKENS env var","status":"failed","title":"getBotTokens collects tokens from BOT_TOKENS env var"},{"ancestorTitles":["config utilities"],"duration":9,"failureMessages":["TypeError: path_1.default.join is not a function\n    at Object.join (/Users/playra/999-multibots-telegraf/src/utils/logger.ts:7:21)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/utils/config.ts:4:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/utils/configHelpers.test.ts:69:26)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"config utilities loadConfig uses getBotTokens and returns bots array","status":"failed","title":"loadConfig uses getBotTokens and returns bots array"}]},{"numFailingTests":1,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171896819,"runtime":46,"slow":false,"start":1745171896773},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/services/uploadVideoToServer.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1muploadVideoToServer › posts to LOCAL_SERVER_URL when in dev\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mresolves\u001b[2m.\u001b[22mtoBeUndefined\u001b[2m()\u001b[22m\n\n    Received promise rejected instead of resolved\n    Rejected to value: \u001b[31m[TypeError: Cannot read properties of undefined (reading 'data')]\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 38 |\u001b[39m     mockedAxios\u001b[33m.\u001b[39mpost\u001b[33m.\u001b[39mmockResolvedValue({ data\u001b[33m:\u001b[39m {} })\u001b[22m\n\u001b[2m     \u001b[90m 39 |\u001b[39m     \u001b[36mconst\u001b[39m req \u001b[33m=\u001b[39m { videoUrl\u001b[33m:\u001b[39m \u001b[32m'v'\u001b[39m\u001b[33m,\u001b[39m telegram_id\u001b[33m:\u001b[39m \u001b[32m'1'\u001b[39m\u001b[33m,\u001b[39m fileName\u001b[33m:\u001b[39m \u001b[32m'f'\u001b[39m }\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 40 |\u001b[39m     \u001b[36mawait\u001b[39m expect(uploadDev(req))\u001b[33m.\u001b[39mresolves\u001b[33m.\u001b[39mtoBeUndefined()\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m           \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 41 |\u001b[39m     expect(mockedAxios\u001b[33m.\u001b[39mpost)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[22m\n\u001b[2m     \u001b[90m 42 |\u001b[39m       \u001b[32m'http://localhost/video/upload'\u001b[39m\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 43 |\u001b[39m       req\u001b[33m,\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat expect (\u001b[22m\u001b[2mnode_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js\u001b[2m:113:15)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/services/uploadVideoToServer.test.ts\u001b[39m\u001b[0m\u001b[2m:40:11\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.__awaiter (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/services/uploadVideoToServer.test.ts\u001b[39m\u001b[0m\u001b[2m:34:58)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["uploadVideoToServer"],"duration":3,"failureMessages":[],"fullName":"uploadVideoToServer posts video upload request to server URL in production","status":"passed","title":"posts video upload request to server URL in production"},{"ancestorTitles":["uploadVideoToServer"],"duration":3,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mresolves\u001b[2m.\u001b[22mtoBeUndefined\u001b[2m()\u001b[22m\n\nReceived promise rejected instead of resolved\nRejected to value: \u001b[31m[TypeError: Cannot read properties of undefined (reading 'data')]\u001b[39m\n    at expect (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:113:15)\n    at /Users/playra/999-multibots-telegraf/__tests__/services/uploadVideoToServer.test.ts:40:11\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/services/uploadVideoToServer.test.ts:34:58)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"uploadVideoToServer posts to LOCAL_SERVER_URL when in dev","status":"failed","title":"posts to LOCAL_SERVER_URL when in dev"},{"ancestorTitles":["uploadVideoToServer"],"duration":4,"failureMessages":[],"fullName":"uploadVideoToServer throws and logs error when axios.post fails","status":"passed","title":"throws and logs error when axios.post fails"}]},{"numFailingTests":2,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171896838,"runtime":55,"slow":false,"start":1745171896783},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/price/handleTrainingCost.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mhandleTrainingCost › should prompt and set leaveScene=true when balance is insufficient (RU)\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32m4\u001b[39m, \u001b[32mAny<Object>\u001b[39m\n\n    Number of calls: \u001b[31m0\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 34 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 35 |\u001b[39m     \u001b[36mconst\u001b[39m result \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m handleTrainingCost(ctx\u001b[33m,\u001b[39m steps\u001b[33m,\u001b[39m isRu)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 36 |\u001b[39m     expect(calculateCostInStars)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(steps\u001b[33m,\u001b[39m expect\u001b[33m.\u001b[39many(\u001b[33mObject\u001b[39m))\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                  \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 37 |\u001b[39m     expect(getUserBalance)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[35m123\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 38 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mreply)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[22m\n\u001b[2m     \u001b[90m 39 |\u001b[39m       expect\u001b[33m.\u001b[39mstringContaining(\u001b[32m'❌ Недостаточно звезд для обучения модели!'\u001b[39m)\u001b[33m,\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/price/handleTrainingCost.test.ts\u001b[39m\u001b[0m\u001b[2m:36:34\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mhandleTrainingCost › should return leaveScene=false when balance is sufficient\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\n    Expected: \u001b[32m1\u001b[39m\n    Received: \u001b[31m0.88\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 52 |\u001b[39m     \u001b[36mconst\u001b[39m result \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m handleTrainingCost(ctx\u001b[33m,\u001b[39m steps\u001b[33m,\u001b[39m \u001b[36mfalse\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 53 |\u001b[39m     expect(result\u001b[33m.\u001b[39mleaveScene)\u001b[33m.\u001b[39mtoBe(\u001b[36mfalse\u001b[39m)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 54 |\u001b[39m     expect(result\u001b[33m.\u001b[39mtrainingCostInStars)\u001b[33m.\u001b[39mtoBe(steps \u001b[33m*\u001b[39m \u001b[35m0.25\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                        \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 55 |\u001b[39m     expect(result\u001b[33m.\u001b[39mcurrentBalance)\u001b[33m.\u001b[39mtoBe(steps \u001b[33m*\u001b[39m \u001b[35m0.25\u001b[39m \u001b[33m+\u001b[39m \u001b[35m10\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 56 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mreply)\u001b[33m.\u001b[39mnot\u001b[33m.\u001b[39mtoHaveBeenCalled()\u001b[22m\n\u001b[2m     \u001b[90m 57 |\u001b[39m   })\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/price/handleTrainingCost.test.ts\u001b[39m\u001b[0m\u001b[2m:54:40\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["handleTrainingCost"],"duration":3,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m4\u001b[39m, \u001b[32mAny<Object>\u001b[39m\n\nNumber of calls: \u001b[31m0\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/price/handleTrainingCost.test.ts:36:34\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"handleTrainingCost should prompt and set leaveScene=true when balance is insufficient (RU)","status":"failed","title":"should prompt and set leaveScene=true when balance is insufficient (RU)"},{"ancestorTitles":["handleTrainingCost"],"duration":1,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32m1\u001b[39m\nReceived: \u001b[31m0.88\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/price/handleTrainingCost.test.ts:54:40\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"handleTrainingCost should return leaveScene=false when balance is sufficient","status":"failed","title":"should return leaveScene=false when balance is sufficient"}]},{"numFailingTests":3,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171896872,"runtime":67,"slow":false,"start":1745171896805},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/handlers/handleMenu.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mhandleMenu › handles subscription button in Russian\u001b[39m\u001b[22m\n\n    TypeError: Cannot read properties of undefined (reading 'title_ru')\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 19 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 20 |\u001b[39m   it(\u001b[32m'handles subscription button in Russian'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 21 |\u001b[39m     \u001b[36mconst\u001b[39m text \u001b[33m=\u001b[39m levels[\u001b[35m0\u001b[39m]\u001b[33m.\u001b[39mtitle_ru\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                            \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 22 |\u001b[39m     \u001b[36mconst\u001b[39m testCtx \u001b[33m=\u001b[39m makeMockContext({\u001b[22m\n\u001b[2m     \u001b[90m 23 |\u001b[39m       message\u001b[33m:\u001b[39m {\u001b[22m\n\u001b[2m     \u001b[90m 24 |\u001b[39m         text\u001b[33m,\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/handlers/handleMenu.test.ts\u001b[39m\u001b[0m\u001b[2m:21:28\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.__awaiter (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/handlers/handleMenu.test.ts\u001b[39m\u001b[0m\u001b[2m:20:59)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mhandleMenu › handles subscription button in English\u001b[39m\u001b[22m\n\n    TypeError: Cannot read properties of undefined (reading 'title_en')\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 40 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 41 |\u001b[39m   it(\u001b[32m'handles subscription button in English'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 42 |\u001b[39m     \u001b[36mconst\u001b[39m text \u001b[33m=\u001b[39m levels[\u001b[35m0\u001b[39m]\u001b[33m.\u001b[39mtitle_en\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                            \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 43 |\u001b[39m     \u001b[36mconst\u001b[39m testCtx \u001b[33m=\u001b[39m makeMockContext({\u001b[22m\n\u001b[2m     \u001b[90m 44 |\u001b[39m       message\u001b[33m:\u001b[39m {\u001b[22m\n\u001b[2m     \u001b[90m 45 |\u001b[39m         text\u001b[33m,\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/handlers/handleMenu.test.ts\u001b[39m\u001b[0m\u001b[2m:42:28\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.__awaiter (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/handlers/handleMenu.test.ts\u001b[39m\u001b[0m\u001b[2m:41:59)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mhandleMenu › does nothing for unknown text\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBeUndefined\u001b[2m()\u001b[22m\n\n    Received: \u001b[31m\"text_to_image\"\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m  98 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m  99 |\u001b[39m     \u001b[36mawait\u001b[39m handleMenu(testCtx \u001b[36mas\u001b[39m any)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 100 |\u001b[39m     expect(testCtx\u001b[33m.\u001b[39msession\u001b[33m.\u001b[39mmode)\u001b[33m.\u001b[39mtoBeUndefined()\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                                  \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 101 |\u001b[39m     expect(testCtx\u001b[33m.\u001b[39mscene\u001b[33m.\u001b[39menter)\u001b[33m.\u001b[39mnot\u001b[33m.\u001b[39mtoHaveBeenCalled()\u001b[22m\n\u001b[2m     \u001b[90m 102 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 103 |\u001b[39m })\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/handlers/handleMenu.test.ts\u001b[39m\u001b[0m\u001b[2m:100:34\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["handleMenu"],"duration":1,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'title_ru')\n    at /Users/playra/999-multibots-telegraf/__tests__/handlers/handleMenu.test.ts:21:28\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/handlers/handleMenu.test.ts:20:59)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"handleMenu handles subscription button in Russian","status":"failed","title":"handles subscription button in Russian"},{"ancestorTitles":["handleMenu"],"duration":1,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'title_en')\n    at /Users/playra/999-multibots-telegraf/__tests__/handlers/handleMenu.test.ts:42:28\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/handlers/handleMenu.test.ts:41:59)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"handleMenu handles subscription button in English","status":"failed","title":"handles subscription button in English"},{"ancestorTitles":["handleMenu"],"duration":10,"failureMessages":[],"fullName":"handleMenu handles slash price command","status":"passed","title":"handles slash price command"},{"ancestorTitles":["handleMenu"],"duration":2,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBeUndefined\u001b[2m()\u001b[22m\n\nReceived: \u001b[31m\"text_to_image\"\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/handlers/handleMenu.test.ts:100:34\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"handleMenu does nothing for unknown text","status":"failed","title":"does nothing for unknown text"}]},{"numFailingTests":3,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171896890,"runtime":67,"slow":false,"start":1745171896823},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/scenes/startScene.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mstartScene › должна отправить приветственное сообщение с фото и клавиатурой\u001b[39m\u001b[22m\n\n    TypeError: Cannot read properties of undefined (reading 'username')\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 21 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 22 |\u001b[39m     \u001b[36mconst\u001b[39m isRu \u001b[33m=\u001b[39m ctx\u001b[33m.\u001b[39m\u001b[36mfrom\u001b[39m\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mlanguage_code \u001b[33m===\u001b[39m \u001b[32m'ru'\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 23 |\u001b[39m     \u001b[36mconst\u001b[39m botName \u001b[33m=\u001b[39m ctx\u001b[33m.\u001b[39mbotInfo\u001b[33m.\u001b[39musername\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                 \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 24 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 25 |\u001b[39m     logger\u001b[33m.\u001b[39minfo({\u001b[22m\n\u001b[2m     \u001b[90m 26 |\u001b[39m       message\u001b[33m:\u001b[39m \u001b[32m'📡 [StartScene] Получение перевода для стартового сообщения'\u001b[39m\u001b[33m,\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat username (\u001b[22m\u001b[2msrc/scenes/startScene/index.ts\u001b[2m:23:33)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.__awaiter (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat __awaiter (\u001b[22m\u001b[2msrc/scenes/startScene/index.ts\u001b[2m:11:15)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/scenes/startScene.test.ts\u001b[39m\u001b[0m\u001b[2m:59:11\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.__awaiter (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/scenes/startScene.test.ts\u001b[39m\u001b[0m\u001b[2m:51:83)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mstartScene › должна перейти на menuScene при наличии подписки\u001b[39m\u001b[22m\n\n    TypeError: secondHandler is not a function\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 87 |\u001b[39m     \u001b[36mconst\u001b[39m secondHandler \u001b[33m=\u001b[39m startScene\u001b[33m.\u001b[39msteps[\u001b[35m1\u001b[39m]\u001b[22m\n\u001b[2m     \u001b[90m 88 |\u001b[39m     \u001b[90m// @ts-ignore - игнорируем ошибку типов для тестов\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 89 |\u001b[39m     \u001b[36mawait\u001b[39m secondHandler(ctx)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m           \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 90 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 91 |\u001b[39m     \u001b[90m// Проверяем, что был осуществлен переход на menuScene\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 92 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mscene\u001b[33m.\u001b[39menter)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[32m'menuScene'\u001b[39m)\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/scenes/startScene.test.ts\u001b[39m\u001b[0m\u001b[2m:89:11\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.__awaiter (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/scenes/startScene.test.ts\u001b[39m\u001b[0m\u001b[2m:75:69)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mstartScene › должна перейти на subscriptionScene при отсутствии подписки\u001b[39m\u001b[22m\n\n    TypeError: secondHandler is not a function\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 107 |\u001b[39m     \u001b[36mconst\u001b[39m secondHandler \u001b[33m=\u001b[39m startScene\u001b[33m.\u001b[39msteps[\u001b[35m1\u001b[39m]\u001b[22m\n\u001b[2m     \u001b[90m 108 |\u001b[39m     \u001b[90m// @ts-ignore - игнорируем ошибку типов для тестов\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 109 |\u001b[39m     \u001b[36mawait\u001b[39m secondHandler(ctx)\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m           \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 110 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 111 |\u001b[39m     \u001b[90m// Проверяем, что был осуществлен переход на subscriptionScene\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 112 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mscene\u001b[33m.\u001b[39menter)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[32m'subscriptionScene'\u001b[39m)\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/scenes/startScene.test.ts\u001b[39m\u001b[0m\u001b[2m:109:11\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.__awaiter (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/scenes/startScene.test.ts\u001b[39m\u001b[0m\u001b[2m:95:80)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["startScene"],"duration":3,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'username')\n    at username (/Users/playra/999-multibots-telegraf/src/scenes/startScene/index.ts:23:33)\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at __awaiter (/Users/playra/999-multibots-telegraf/src/scenes/startScene/index.ts:11:15)\n    at /Users/playra/999-multibots-telegraf/__tests__/scenes/startScene.test.ts:59:11\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/scenes/startScene.test.ts:51:83)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"startScene должна отправить приветственное сообщение с фото и клавиатурой","status":"failed","title":"должна отправить приветственное сообщение с фото и клавиатурой"},{"ancestorTitles":["startScene"],"duration":0,"failureMessages":["TypeError: secondHandler is not a function\n    at /Users/playra/999-multibots-telegraf/__tests__/scenes/startScene.test.ts:89:11\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/scenes/startScene.test.ts:75:69)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"startScene должна перейти на menuScene при наличии подписки","status":"failed","title":"должна перейти на menuScene при наличии подписки"},{"ancestorTitles":["startScene"],"duration":0,"failureMessages":["TypeError: secondHandler is not a function\n    at /Users/playra/999-multibots-telegraf/__tests__/scenes/startScene.test.ts:109:11\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/scenes/startScene.test.ts:95:80)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"startScene должна перейти на subscriptionScene при отсутствии подписки","status":"failed","title":"должна перейти на subscriptionScene при отсутствии подписки"}]},{"numFailingTests":1,"numPassingTests":6,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171896916,"runtime":70,"slow":false,"start":1745171896846},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/handlers/registerHearsActions.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mregisterHearsActions › main menu handler sets mode and enters menuScene\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32m\"menuScene\"\u001b[39m\n    Received: \u001b[31m\"main_menu\"\u001b[39m\n\n    Number of calls: \u001b[31m1\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 52 |\u001b[39m     \u001b[36mawait\u001b[39m handler(ctx)\u001b[22m\n\u001b[2m     \u001b[90m 53 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39msession\u001b[33m.\u001b[39mmode)\u001b[33m.\u001b[39mtoBe(\u001b[32m'main_menu'\u001b[39m)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 54 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mscene\u001b[33m.\u001b[39menter)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[32m'menuScene'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                             \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 55 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 56 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 57 |\u001b[39m   describe(\u001b[32m'generate new video handler'\u001b[39m\u001b[33m,\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/handlers/registerHearsActions.test.ts\u001b[39m\u001b[0m\u001b[2m:54:29\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["registerHearsActions"],"duration":3,"failureMessages":[],"fullName":"registerHearsActions registers hears for text_to_speech and main menu","status":"passed","title":"registers hears for text_to_speech and main menu"},{"ancestorTitles":["registerHearsActions"],"duration":1,"failureMessages":[],"fullName":"registerHearsActions text_to_speech handler sets mode and enters scene","status":"passed","title":"text_to_speech handler sets mode and enters scene"},{"ancestorTitles":["registerHearsActions"],"duration":0,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m\"menuScene\"\u001b[39m\nReceived: \u001b[31m\"main_menu\"\u001b[39m\n\nNumber of calls: \u001b[31m1\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/handlers/registerHearsActions.test.ts:54:29\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"registerHearsActions main menu handler sets mode and enters menuScene","status":"failed","title":"main menu handler sets mode and enters menuScene"},{"ancestorTitles":["registerHearsActions","generate new video handler"],"duration":4,"failureMessages":[],"fullName":"registerHearsActions generate new video handler enters text_to_video when mode is text_to_video","status":"passed","title":"enters text_to_video when mode is text_to_video"},{"ancestorTitles":["registerHearsActions","generate new video handler"],"duration":3,"failureMessages":[],"fullName":"registerHearsActions generate new video handler enters image_to_video when mode is image_to_video","status":"passed","title":"enters image_to_video when mode is image_to_video"},{"ancestorTitles":["registerHearsActions","generate new video handler"],"duration":7,"failureMessages":[],"fullName":"registerHearsActions generate new video handler replies error when mode unsupported (English)","status":"passed","title":"replies error when mode unsupported (English)"},{"ancestorTitles":["registerHearsActions","generate new video handler"],"duration":7,"failureMessages":[],"fullName":"registerHearsActions generate new video handler replies error when mode unsupported (Russian)","status":"passed","title":"replies error when mode unsupported (Russian)"}]},{"numFailingTests":2,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171896965,"runtime":33,"slow":false,"start":1745171896932},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/menu/cancelMenu.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mcancelMenu › creates keyboard with Cancel in English\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n    \u001b[32m- Expected  - 0\u001b[39m\n    \u001b[31m+ Received  + 1\u001b[39m\n\n    \u001b[2m  Array [\u001b[22m\n    \u001b[2m    Array [\u001b[22m\n    \u001b[2m      Object {\u001b[22m\n    \u001b[31m+       \"hide\": false,\u001b[39m\n    \u001b[2m        \"text\": \"Cancel\",\u001b[22m\n    \u001b[2m      },\u001b[22m\n    \u001b[2m    ],\u001b[22m\n    \u001b[2m  ]\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m  5 |\u001b[39m     \u001b[36mconst\u001b[39m markup \u001b[33m=\u001b[39m cancelMenu(\u001b[36mfalse\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m  6 |\u001b[39m     \u001b[90m// @ts-ignore\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m  7 |\u001b[39m     expect(markup\u001b[33m.\u001b[39mreply_markup\u001b[33m.\u001b[39mkeyboard)\u001b[33m.\u001b[39mtoEqual([[{ text\u001b[33m:\u001b[39m \u001b[32m'Cancel'\u001b[39m }]])\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                          \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m  8 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m  9 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 10 |\u001b[39m   it(\u001b[32m'creates keyboard with Отмена in Russian'\u001b[39m\u001b[33m,\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/menu/cancelMenu.test.ts\u001b[39m\u001b[0m\u001b[2m:7:42)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mcancelMenu › creates keyboard with Отмена in Russian\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n    \u001b[32m- Expected  - 0\u001b[39m\n    \u001b[31m+ Received  + 1\u001b[39m\n\n    \u001b[2m  Array [\u001b[22m\n    \u001b[2m    Array [\u001b[22m\n    \u001b[2m      Object {\u001b[22m\n    \u001b[31m+       \"hide\": false,\u001b[39m\n    \u001b[2m        \"text\": \"Отмена\",\u001b[22m\n    \u001b[2m      },\u001b[22m\n    \u001b[2m    ],\u001b[22m\n    \u001b[2m  ]\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 11 |\u001b[39m     \u001b[36mconst\u001b[39m markup \u001b[33m=\u001b[39m cancelMenu(\u001b[36mtrue\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 12 |\u001b[39m     \u001b[90m// @ts-ignore\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 13 |\u001b[39m     expect(markup\u001b[33m.\u001b[39mreply_markup\u001b[33m.\u001b[39mkeyboard)\u001b[33m.\u001b[39mtoEqual([[{ text\u001b[33m:\u001b[39m \u001b[32m'Отмена'\u001b[39m }]])\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                          \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 14 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 15 |\u001b[39m })\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/menu/cancelMenu.test.ts\u001b[39m\u001b[0m\u001b[2m:13:42)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["cancelMenu"],"duration":1,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n\u001b[32m- Expected  - 0\u001b[39m\n\u001b[31m+ Received  + 1\u001b[39m\n\n\u001b[2m  Array [\u001b[22m\n\u001b[2m    Array [\u001b[22m\n\u001b[2m      Object {\u001b[22m\n\u001b[31m+       \"hide\": false,\u001b[39m\n\u001b[2m        \"text\": \"Cancel\",\u001b[22m\n\u001b[2m      },\u001b[22m\n\u001b[2m    ],\u001b[22m\n\u001b[2m  ]\u001b[22m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/menu/cancelMenu.test.ts:7:42)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"cancelMenu creates keyboard with Cancel in English","status":"failed","title":"creates keyboard with Cancel in English"},{"ancestorTitles":["cancelMenu"],"duration":1,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n\u001b[32m- Expected  - 0\u001b[39m\n\u001b[31m+ Received  + 1\u001b[39m\n\n\u001b[2m  Array [\u001b[22m\n\u001b[2m    Array [\u001b[22m\n\u001b[2m      Object {\u001b[22m\n\u001b[31m+       \"hide\": false,\u001b[39m\n\u001b[2m        \"text\": \"Отмена\",\u001b[22m\n\u001b[2m      },\u001b[22m\n\u001b[2m    ],\u001b[22m\n\u001b[2m  ]\u001b[22m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/menu/cancelMenu.test.ts:13:42)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"cancelMenu creates keyboard with Отмена in Russian","status":"failed","title":"creates keyboard with Отмена in Russian"}]},{"numFailingTests":2,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171896972,"runtime":47,"slow":false,"start":1745171896925},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/services/generateVoiceAvatar.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mgenerateVoiceAvatar › fallback branch when ELESTIO_URL not set\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32m\"Функция создания голосового аватара временно недоступна.\"\u001b[39m\n\n    Number of calls: \u001b[31m0\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 34 |\u001b[39m   test(\u001b[32m'fallback branch when ELESTIO_URL not set'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[22m\n\u001b[2m     \u001b[90m 35 |\u001b[39m     \u001b[36mconst\u001b[39m response \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m generateVoiceAvatar(\u001b[32m'img'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'prompt'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'42'\u001b[39m\u001b[33m,\u001b[39m ctx\u001b[33m,\u001b[39m \u001b[36mtrue\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'bot'\u001b[39m)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 36 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mreply)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[32m'Функция создания голосового аватара временно недоступна.'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 37 |\u001b[39m     expect(response)\u001b[33m.\u001b[39mtoEqual({ success\u001b[33m:\u001b[39m \u001b[36mfalse\u001b[39m\u001b[33m,\u001b[39m message\u001b[33m:\u001b[39m \u001b[32m'Функция временно недоступна'\u001b[39m })\u001b[22m\n\u001b[2m     \u001b[90m 38 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 39 |\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/services/generateVoiceAvatar.test.ts\u001b[39m\u001b[0m\u001b[2m:36:23\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mgenerateVoiceAvatar › production branch calls axios.post and returns data\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    \u001b[32m- Expected\u001b[39m\n    \u001b[31m+ Received\u001b[39m\n\n    \u001b[32m- \"https://api.prod/generate/voice-avatar\"\u001b[39m,\n    \u001b[31m+ \"http://localhost:3000/generate/voice-avatar\"\u001b[39m,\n      \u001b[2m{\"bot_name\": \"botName\", \"imageUrl\": \"imgUrl\", \"is_ru\": false, \"prompt\": \"desc\", \"telegram_id\": \"99\", \"username\": \"user\"}\u001b[22m,\n      \u001b[2m{\"headers\": {\"Content-Type\": \"application/json\", \"x-secret-key\": \"secret\"}}\u001b[22m,\n\n    Number of calls: \u001b[31m1\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 52 |\u001b[39m     \u001b[36mconst\u001b[39m result \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m generateVoiceAvatar(\u001b[32m'imgUrl'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'desc'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'99'\u001b[39m\u001b[33m,\u001b[39m ctx2\u001b[33m,\u001b[39m \u001b[36mfalse\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'botName'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 53 |\u001b[39m     expect(result)\u001b[33m.\u001b[39mtoEqual({ success\u001b[33m:\u001b[39m \u001b[36mtrue\u001b[39m\u001b[33m,\u001b[39m message\u001b[33m:\u001b[39m \u001b[32m'ok'\u001b[39m })\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 54 |\u001b[39m     expect(axios\u001b[33m.\u001b[39mpost)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 55 |\u001b[39m       \u001b[32m'https://api.prod/generate/voice-avatar'\u001b[39m\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 56 |\u001b[39m       {\u001b[22m\n\u001b[2m     \u001b[90m 57 |\u001b[39m         imageUrl\u001b[33m:\u001b[39m \u001b[32m'imgUrl'\u001b[39m\u001b[33m,\u001b[39m prompt\u001b[33m:\u001b[39m \u001b[32m'desc'\u001b[39m\u001b[33m,\u001b[39m telegram_id\u001b[33m:\u001b[39m \u001b[32m'99'\u001b[39m\u001b[33m,\u001b[39m username\u001b[33m:\u001b[39m \u001b[32m'user'\u001b[39m\u001b[33m,\u001b[39m is_ru\u001b[33m:\u001b[39m \u001b[36mfalse\u001b[39m\u001b[33m,\u001b[39m bot_name\u001b[33m:\u001b[39m \u001b[32m'botName'\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/services/generateVoiceAvatar.test.ts\u001b[39m\u001b[0m\u001b[2m:54:24\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["generateVoiceAvatar"],"duration":9,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m\"Функция создания голосового аватара временно недоступна.\"\u001b[39m\n\nNumber of calls: \u001b[31m0\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/services/generateVoiceAvatar.test.ts:36:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"generateVoiceAvatar fallback branch when ELESTIO_URL not set","status":"failed","title":"fallback branch when ELESTIO_URL not set"},{"ancestorTitles":["generateVoiceAvatar"],"duration":1,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n\u001b[32m- Expected\u001b[39m\n\u001b[31m+ Received\u001b[39m\n\n\u001b[32m- \"https://api.prod/generate/voice-avatar\"\u001b[39m,\n\u001b[31m+ \"http://localhost:3000/generate/voice-avatar\"\u001b[39m,\n  \u001b[2m{\"bot_name\": \"botName\", \"imageUrl\": \"imgUrl\", \"is_ru\": false, \"prompt\": \"desc\", \"telegram_id\": \"99\", \"username\": \"user\"}\u001b[22m,\n  \u001b[2m{\"headers\": {\"Content-Type\": \"application/json\", \"x-secret-key\": \"secret\"}}\u001b[22m,\n\nNumber of calls: \u001b[31m1\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/services/generateVoiceAvatar.test.ts:54:24\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"generateVoiceAvatar production branch calls axios.post and returns data","status":"failed","title":"production branch calls axios.post and returns data"},{"ancestorTitles":["generateVoiceAvatar"],"duration":2,"failureMessages":[],"fullName":"generateVoiceAvatar error branch calls sendGenericErrorMessage and returns null","status":"passed","title":"error branch calls sendGenericErrorMessage and returns null"}]},{"numFailingTests":3,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171896974,"runtime":79,"slow":false,"start":1745171896895},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/handlers/handleSelectStars.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mhandleSelectStars › renders a single row of three stars in English\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    \u001b[32m- Expected\u001b[39m\n    \u001b[31m+ Received\u001b[39m\n\n      \u001b[2m\"Choose the number of stars to buy:\"\u001b[22m,\n    \u001b[32m- Object {\u001b[39m\n    \u001b[31m+ Markup {\u001b[39m\n    \u001b[2m    \"reply_markup\": Object {\u001b[22m\n    \u001b[2m      \"inline_keyboard\": Array [\u001b[22m\n    \u001b[2m        Array [\u001b[22m\n    \u001b[2m          Object {\u001b[22m\n    \u001b[2m            \"callback_data\": \"top_up_10\",\u001b[22m\n    \u001b[32m-           \"text\": \"10⭐️\",\u001b[39m\n    \u001b[31m+           \"hide\": false,\u001b[39m\n    \u001b[31m+           \"text\": \"⭐️ 10\",\u001b[39m\n    \u001b[2m          },\u001b[22m\n    \u001b[31m+       ],\u001b[39m\n    \u001b[31m+       Array [\u001b[39m\n    \u001b[2m          Object {\u001b[22m\n    \u001b[2m            \"callback_data\": \"top_up_20\",\u001b[22m\n    \u001b[32m-           \"text\": \"20⭐️\",\u001b[39m\n    \u001b[31m+           \"hide\": false,\u001b[39m\n    \u001b[31m+           \"text\": \"⭐️ 20\",\u001b[39m\n    \u001b[2m          },\u001b[22m\n    \u001b[31m+       ],\u001b[39m\n    \u001b[31m+       Array [\u001b[39m\n    \u001b[2m          Object {\u001b[22m\n    \u001b[2m            \"callback_data\": \"top_up_30\",\u001b[22m\n    \u001b[32m-           \"text\": \"30⭐️\",\u001b[39m\n    \u001b[31m+           \"hide\": false,\u001b[39m\n    \u001b[31m+           \"text\": \"⭐️ 30\",\u001b[39m\n    \u001b[2m          },\u001b[22m\n    \u001b[2m        ],\u001b[22m\n    \u001b[2m      ],\u001b[22m\n    \u001b[2m    },\u001b[22m\n    \u001b[2m  }\u001b[22m,\n\n    Number of calls: \u001b[31m1\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 12 |\u001b[39m   it(\u001b[32m'renders a single row of three stars in English'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[22m\n\u001b[2m     \u001b[90m 13 |\u001b[39m     \u001b[36mawait\u001b[39m handleSelectStars({ ctx\u001b[33m:\u001b[39m ctx \u001b[36mas\u001b[39m any\u001b[33m,\u001b[39m starAmounts\u001b[33m:\u001b[39m [\u001b[35m10\u001b[39m\u001b[33m,\u001b[39m \u001b[35m20\u001b[39m\u001b[33m,\u001b[39m \u001b[35m30\u001b[39m]\u001b[33m,\u001b[39m isRu\u001b[33m:\u001b[39m \u001b[36mfalse\u001b[39m })\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 14 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mreply)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 15 |\u001b[39m       \u001b[32m'Choose the number of stars to buy:'\u001b[39m\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 16 |\u001b[39m       {\u001b[22m\n\u001b[2m     \u001b[90m 17 |\u001b[39m         reply_markup\u001b[33m:\u001b[39m {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/handlers/handleSelectStars.test.ts\u001b[39m\u001b[0m\u001b[2m:14:23\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mhandleSelectStars › renders a single row of two stars in Russian\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    \u001b[32m- Expected\u001b[39m\n    \u001b[31m+ Received\u001b[39m\n\n      \u001b[2m\"Выберите количество звезд для покупки:\"\u001b[22m,\n    \u001b[32m- Object {\u001b[39m\n    \u001b[31m+ Markup {\u001b[39m\n    \u001b[2m    \"reply_markup\": Object {\u001b[22m\n    \u001b[2m      \"inline_keyboard\": Array [\u001b[22m\n    \u001b[2m        Array [\u001b[22m\n    \u001b[2m          Object {\u001b[22m\n    \u001b[2m            \"callback_data\": \"top_up_5\",\u001b[22m\n    \u001b[32m-           \"text\": \"5⭐️\",\u001b[39m\n    \u001b[31m+           \"hide\": false,\u001b[39m\n    \u001b[31m+           \"text\": \"⭐️ 5\",\u001b[39m\n    \u001b[2m          },\u001b[22m\n    \u001b[31m+       ],\u001b[39m\n    \u001b[31m+       Array [\u001b[39m\n    \u001b[2m          Object {\u001b[22m\n    \u001b[2m            \"callback_data\": \"top_up_15\",\u001b[22m\n    \u001b[32m-           \"text\": \"15⭐️\",\u001b[39m\n    \u001b[31m+           \"hide\": false,\u001b[39m\n    \u001b[31m+           \"text\": \"⭐️ 15\",\u001b[39m\n    \u001b[2m          },\u001b[22m\n    \u001b[2m        ],\u001b[22m\n    \u001b[2m      ],\u001b[22m\n    \u001b[2m    },\u001b[22m\n    \u001b[2m  }\u001b[22m,\n\n    Number of calls: \u001b[31m1\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 30 |\u001b[39m   it(\u001b[32m'renders a single row of two stars in Russian'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[22m\n\u001b[2m     \u001b[90m 31 |\u001b[39m     \u001b[36mawait\u001b[39m handleSelectStars({ ctx\u001b[33m:\u001b[39m ctx \u001b[36mas\u001b[39m any\u001b[33m,\u001b[39m starAmounts\u001b[33m:\u001b[39m [\u001b[35m5\u001b[39m\u001b[33m,\u001b[39m \u001b[35m15\u001b[39m]\u001b[33m,\u001b[39m isRu\u001b[33m:\u001b[39m \u001b[36mtrue\u001b[39m })\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 32 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mreply)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 33 |\u001b[39m       \u001b[32m'Выберите количество звезд для покупки:'\u001b[39m\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 34 |\u001b[39m       {\u001b[22m\n\u001b[2m     \u001b[90m 35 |\u001b[39m         reply_markup\u001b[33m:\u001b[39m {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/handlers/handleSelectStars.test.ts\u001b[39m\u001b[0m\u001b[2m:32:23\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mhandleSelectStars › renders multiple rows with leftover items\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    \u001b[32m- Expected\u001b[39m\n    \u001b[31m+ Received\u001b[39m\n\n      \u001b[2m\"Choose the number of stars to buy:\"\u001b[22m,\n    \u001b[32m- Object {\u001b[39m\n    \u001b[31m+ Markup {\u001b[39m\n    \u001b[2m    \"reply_markup\": Object {\u001b[22m\n    \u001b[2m      \"inline_keyboard\": Array [\u001b[22m\n    \u001b[2m        Array [\u001b[22m\n    \u001b[2m          Object {\u001b[22m\n    \u001b[2m            \"callback_data\": \"top_up_1\",\u001b[22m\n    \u001b[32m-           \"text\": \"1⭐️\",\u001b[39m\n    \u001b[31m+           \"hide\": false,\u001b[39m\n    \u001b[31m+           \"text\": \"⭐️ 1\",\u001b[39m\n    \u001b[2m          },\u001b[22m\n    \u001b[31m+       ],\u001b[39m\n    \u001b[31m+       Array [\u001b[39m\n    \u001b[2m          Object {\u001b[22m\n    \u001b[2m            \"callback_data\": \"top_up_2\",\u001b[22m\n    \u001b[32m-           \"text\": \"2⭐️\",\u001b[39m\n    \u001b[31m+           \"hide\": false,\u001b[39m\n    \u001b[31m+           \"text\": \"⭐️ 2\",\u001b[39m\n    \u001b[2m          },\u001b[22m\n    \u001b[31m+       ],\u001b[39m\n    \u001b[31m+       Array [\u001b[39m\n    \u001b[2m          Object {\u001b[22m\n    \u001b[2m            \"callback_data\": \"top_up_3\",\u001b[22m\n    \u001b[32m-           \"text\": \"3⭐️\",\u001b[39m\n    \u001b[31m+           \"hide\": false,\u001b[39m\n    \u001b[31m+           \"text\": \"⭐️ 3\",\u001b[39m\n    \u001b[2m          },\u001b[22m\n    \u001b[2m        ],\u001b[22m\n    \u001b[2m        Array [\u001b[22m\n    \u001b[2m          Object {\u001b[22m\n    \u001b[2m            \"callback_data\": \"top_up_4\",\u001b[22m\n    \u001b[32m-           \"text\": \"4⭐️\",\u001b[39m\n    \u001b[31m+           \"hide\": false,\u001b[39m\n    \u001b[31m+           \"text\": \"⭐️ 4\",\u001b[39m\n    \u001b[2m          },\u001b[22m\n    \u001b[2m        ],\u001b[22m\n    \u001b[2m      ],\u001b[22m\n    \u001b[2m    },\u001b[22m\n    \u001b[2m  }\u001b[22m,\n\n    Number of calls: \u001b[31m1\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 47 |\u001b[39m   it(\u001b[32m'renders multiple rows with leftover items'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[22m\n\u001b[2m     \u001b[90m 48 |\u001b[39m     \u001b[36mawait\u001b[39m handleSelectStars({ ctx\u001b[33m:\u001b[39m ctx \u001b[36mas\u001b[39m any\u001b[33m,\u001b[39m starAmounts\u001b[33m:\u001b[39m [\u001b[35m1\u001b[39m\u001b[33m,\u001b[39m \u001b[35m2\u001b[39m\u001b[33m,\u001b[39m \u001b[35m3\u001b[39m\u001b[33m,\u001b[39m \u001b[35m4\u001b[39m]\u001b[33m,\u001b[39m isRu\u001b[33m:\u001b[39m \u001b[36mfalse\u001b[39m })\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 49 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mreply)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 50 |\u001b[39m       \u001b[32m'Choose the number of stars to buy:'\u001b[39m\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 51 |\u001b[39m       {\u001b[22m\n\u001b[2m     \u001b[90m 52 |\u001b[39m         reply_markup\u001b[33m:\u001b[39m {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/handlers/handleSelectStars.test.ts\u001b[39m\u001b[0m\u001b[2m:49:23\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["handleSelectStars"],"duration":4,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n\u001b[32m- Expected\u001b[39m\n\u001b[31m+ Received\u001b[39m\n\n  \u001b[2m\"Choose the number of stars to buy:\"\u001b[22m,\n\u001b[32m- Object {\u001b[39m\n\u001b[31m+ Markup {\u001b[39m\n\u001b[2m    \"reply_markup\": Object {\u001b[22m\n\u001b[2m      \"inline_keyboard\": Array [\u001b[22m\n\u001b[2m        Array [\u001b[22m\n\u001b[2m          Object {\u001b[22m\n\u001b[2m            \"callback_data\": \"top_up_10\",\u001b[22m\n\u001b[32m-           \"text\": \"10⭐️\",\u001b[39m\n\u001b[31m+           \"hide\": false,\u001b[39m\n\u001b[31m+           \"text\": \"⭐️ 10\",\u001b[39m\n\u001b[2m          },\u001b[22m\n\u001b[31m+       ],\u001b[39m\n\u001b[31m+       Array [\u001b[39m\n\u001b[2m          Object {\u001b[22m\n\u001b[2m            \"callback_data\": \"top_up_20\",\u001b[22m\n\u001b[32m-           \"text\": \"20⭐️\",\u001b[39m\n\u001b[31m+           \"hide\": false,\u001b[39m\n\u001b[31m+           \"text\": \"⭐️ 20\",\u001b[39m\n\u001b[2m          },\u001b[22m\n\u001b[31m+       ],\u001b[39m\n\u001b[31m+       Array [\u001b[39m\n\u001b[2m          Object {\u001b[22m\n\u001b[2m            \"callback_data\": \"top_up_30\",\u001b[22m\n\u001b[32m-           \"text\": \"30⭐️\",\u001b[39m\n\u001b[31m+           \"hide\": false,\u001b[39m\n\u001b[31m+           \"text\": \"⭐️ 30\",\u001b[39m\n\u001b[2m          },\u001b[22m\n\u001b[2m        ],\u001b[22m\n\u001b[2m      ],\u001b[22m\n\u001b[2m    },\u001b[22m\n\u001b[2m  }\u001b[22m,\n\nNumber of calls: \u001b[31m1\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/handlers/handleSelectStars.test.ts:14:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"handleSelectStars renders a single row of three stars in English","status":"failed","title":"renders a single row of three stars in English"},{"ancestorTitles":["handleSelectStars"],"duration":3,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n\u001b[32m- Expected\u001b[39m\n\u001b[31m+ Received\u001b[39m\n\n  \u001b[2m\"Выберите количество звезд для покупки:\"\u001b[22m,\n\u001b[32m- Object {\u001b[39m\n\u001b[31m+ Markup {\u001b[39m\n\u001b[2m    \"reply_markup\": Object {\u001b[22m\n\u001b[2m      \"inline_keyboard\": Array [\u001b[22m\n\u001b[2m        Array [\u001b[22m\n\u001b[2m          Object {\u001b[22m\n\u001b[2m            \"callback_data\": \"top_up_5\",\u001b[22m\n\u001b[32m-           \"text\": \"5⭐️\",\u001b[39m\n\u001b[31m+           \"hide\": false,\u001b[39m\n\u001b[31m+           \"text\": \"⭐️ 5\",\u001b[39m\n\u001b[2m          },\u001b[22m\n\u001b[31m+       ],\u001b[39m\n\u001b[31m+       Array [\u001b[39m\n\u001b[2m          Object {\u001b[22m\n\u001b[2m            \"callback_data\": \"top_up_15\",\u001b[22m\n\u001b[32m-           \"text\": \"15⭐️\",\u001b[39m\n\u001b[31m+           \"hide\": false,\u001b[39m\n\u001b[31m+           \"text\": \"⭐️ 15\",\u001b[39m\n\u001b[2m          },\u001b[22m\n\u001b[2m        ],\u001b[22m\n\u001b[2m      ],\u001b[22m\n\u001b[2m    },\u001b[22m\n\u001b[2m  }\u001b[22m,\n\nNumber of calls: \u001b[31m1\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/handlers/handleSelectStars.test.ts:32:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"handleSelectStars renders a single row of two stars in Russian","status":"failed","title":"renders a single row of two stars in Russian"},{"ancestorTitles":["handleSelectStars"],"duration":1,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n\u001b[32m- Expected\u001b[39m\n\u001b[31m+ Received\u001b[39m\n\n  \u001b[2m\"Choose the number of stars to buy:\"\u001b[22m,\n\u001b[32m- Object {\u001b[39m\n\u001b[31m+ Markup {\u001b[39m\n\u001b[2m    \"reply_markup\": Object {\u001b[22m\n\u001b[2m      \"inline_keyboard\": Array [\u001b[22m\n\u001b[2m        Array [\u001b[22m\n\u001b[2m          Object {\u001b[22m\n\u001b[2m            \"callback_data\": \"top_up_1\",\u001b[22m\n\u001b[32m-           \"text\": \"1⭐️\",\u001b[39m\n\u001b[31m+           \"hide\": false,\u001b[39m\n\u001b[31m+           \"text\": \"⭐️ 1\",\u001b[39m\n\u001b[2m          },\u001b[22m\n\u001b[31m+       ],\u001b[39m\n\u001b[31m+       Array [\u001b[39m\n\u001b[2m          Object {\u001b[22m\n\u001b[2m            \"callback_data\": \"top_up_2\",\u001b[22m\n\u001b[32m-           \"text\": \"2⭐️\",\u001b[39m\n\u001b[31m+           \"hide\": false,\u001b[39m\n\u001b[31m+           \"text\": \"⭐️ 2\",\u001b[39m\n\u001b[2m          },\u001b[22m\n\u001b[31m+       ],\u001b[39m\n\u001b[31m+       Array [\u001b[39m\n\u001b[2m          Object {\u001b[22m\n\u001b[2m            \"callback_data\": \"top_up_3\",\u001b[22m\n\u001b[32m-           \"text\": \"3⭐️\",\u001b[39m\n\u001b[31m+           \"hide\": false,\u001b[39m\n\u001b[31m+           \"text\": \"⭐️ 3\",\u001b[39m\n\u001b[2m          },\u001b[22m\n\u001b[2m        ],\u001b[22m\n\u001b[2m        Array [\u001b[22m\n\u001b[2m          Object {\u001b[22m\n\u001b[2m            \"callback_data\": \"top_up_4\",\u001b[22m\n\u001b[32m-           \"text\": \"4⭐️\",\u001b[39m\n\u001b[31m+           \"hide\": false,\u001b[39m\n\u001b[31m+           \"text\": \"⭐️ 4\",\u001b[39m\n\u001b[2m          },\u001b[22m\n\u001b[2m        ],\u001b[22m\n\u001b[2m      ],\u001b[22m\n\u001b[2m    },\u001b[22m\n\u001b[2m  }\u001b[22m,\n\nNumber of calls: \u001b[31m1\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/handlers/handleSelectStars.test.ts:49:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"handleSelectStars renders multiple rows with leftover items","status":"failed","title":"renders multiple rows with leftover items"},{"ancestorTitles":["handleSelectStars"],"duration":6,"failureMessages":[],"fullName":"handleSelectStars throws error when ctx.reply fails","status":"passed","title":"throws error when ctx.reply fails"}]},{"numFailingTests":1,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171897032,"runtime":58,"slow":false,"start":1745171896974},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/scenes/digitalAvatarBodyWizard.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mdigitalAvatarBodyWizard › step 0: sends cost message and next\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32m[10, 20, 30]\u001b[39m, \u001b[32mtrue\u001b[39m\n    Received: \u001b[31mundefined\u001b[39m, \u001b[2mtrue\u001b[22m, \u001b[31m\"v1\"\u001b[39m\n\n    Number of calls: \u001b[31m1\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 28 |\u001b[39m     getStepSelectionMenu\u001b[33m.\u001b[39mmockReturnValue({ keyboard\u001b[33m:\u001b[39m [] })\u001b[22m\n\u001b[2m     \u001b[90m 29 |\u001b[39m     \u001b[36mawait\u001b[39m steps[\u001b[35m0\u001b[39m](ctx)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 30 |\u001b[39m     expect(generateCostMessage)\u001b[33m.\u001b[39mtoHaveBeenCalledWith([\u001b[35m10\u001b[39m\u001b[33m,\u001b[39m\u001b[35m20\u001b[39m\u001b[33m,\u001b[39m\u001b[35m30\u001b[39m]\u001b[33m,\u001b[39m \u001b[36mtrue\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                 \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 31 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mreply)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[32m'cost msg'\u001b[39m\u001b[33m,\u001b[39m {keyboard\u001b[33m:\u001b[39m []})\u001b[22m\n\u001b[2m     \u001b[90m 32 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mwizard\u001b[33m.\u001b[39mnext)\u001b[33m.\u001b[39mtoHaveBeenCalled()\u001b[22m\n\u001b[2m     \u001b[90m 33 |\u001b[39m   })\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/scenes/digitalAvatarBodyWizard.test.ts\u001b[39m\u001b[0m\u001b[2m:30:33\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["digitalAvatarBodyWizard"],"duration":1,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m[10, 20, 30]\u001b[39m, \u001b[32mtrue\u001b[39m\nReceived: \u001b[31mundefined\u001b[39m, \u001b[2mtrue\u001b[22m, \u001b[31m\"v1\"\u001b[39m\n\nNumber of calls: \u001b[31m1\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/scenes/digitalAvatarBodyWizard.test.ts:30:33\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"digitalAvatarBodyWizard step 0: sends cost message and next","status":"failed","title":"step 0: sends cost message and next"},{"ancestorTitles":["digitalAvatarBodyWizard"],"duration":4,"failureMessages":[],"fullName":"digitalAvatarBodyWizard step 1: numeric input, leaveScene=false","status":"passed","title":"step 1: numeric input, leaveScene=false"},{"ancestorTitles":["digitalAvatarBodyWizard"],"duration":3,"failureMessages":[],"fullName":"digitalAvatarBodyWizard step 1: numeric input, leaveScene=true","status":"passed","title":"step 1: numeric input, leaveScene=true"},{"ancestorTitles":["digitalAvatarBodyWizard"],"duration":7,"failureMessages":[],"fullName":"digitalAvatarBodyWizard step 1: non-numeric input and cancel","status":"passed","title":"step 1: non-numeric input and cancel"},{"ancestorTitles":["digitalAvatarBodyWizard"],"duration":2,"failureMessages":[],"fullName":"digitalAvatarBodyWizard step 1: non-numeric input and not cancel","status":"passed","title":"step 1: non-numeric input and not cancel"}]},{"numFailingTests":1,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171897034,"runtime":52,"slow":false,"start":1745171896982},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/replicate/index.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mcore/replicate index › modelPricing has entries for all defined models\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoHaveProperty\u001b[2m(\u001b[22m\u001b[32mpath\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected path: \u001b[32m\"black-forest-labs/flux-1.1-pro-ultra\"\u001b[39m\n    Received path: \u001b[31m[]\u001b[39m\n\n    Received value: \u001b[31m{\"black-forest-labs/flux-1.1-pro\": \"$0.040 / image\", \"black-forest-labs/flux-1.1-pro-ultra\": \"$0.060 / image\", \"black-forest-labs/flux-canny-dev\": \"$0.025 / image\", \"black-forest-labs/flux-canny-pro\": \"$0.050 / image\", \"black-forest-labs/flux-depth-dev\": \"$0.025 / image\", \"black-forest-labs/flux-depth-pro\": \"$0.050 / image\", \"black-forest-labs/flux-dev\": \"$0.025 / image\", \"black-forest-labs/flux-dev-lora\": \"$0.032 / image\", \"black-forest-labs/flux-fill-dev\": \"$0.040 / image\", \"black-forest-labs/flux-fill-pro\": \"$0.050 / image\", \"black-forest-labs/flux-pro\": \"$0.055 / image\", \"black-forest-labs/flux-redux-dev\": \"$0.025 / image\", \"black-forest-labs/flux-redux-schnell\": \"$0.003 / image\", \"black-forest-labs/flux-schnell\": \"$0.003 / image\", \"black-forest-labs/flux-schnell-lora\": \"$0.020 / image\", \"ideogram-ai/ideogram-v2\": \"$0.080 / image\", \"ideogram-ai/ideogram-v2-turbo\": \"$0.050 / image\", \"luma/photon\": \"$0.030 / image\", \"luma/photon-flash\": \"$0.010 / image\", \"recraft-ai/recraft-20b\": \"$0.022 / image\", \"recraft-ai/recraft-20b-svg\": \"$0.044 / image\", \"recraft-ai/recraft-v3\": \"$0.040 / image\", \"recraft-ai/recraft-v3-svg\": \"$0.080 / image\", \"stability-ai/stable-diffusion-3\": \"$0.035 / image\", \"stability-ai/stable-diffusion-3.5-large\": \"$0.065 / image\", \"stability-ai/stable-diffusion-3.5-large-turbo\": \"$0.040 / image\", \"stability-ai/stable-diffusion-3.5-medium\": \"$0.035 / image\"}\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 57 |\u001b[39m     \u001b[90m// For each model config, ensure its key exists in pricing map\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 58 |\u001b[39m     \u001b[33mObject\u001b[39m\u001b[33m.\u001b[39mvalues(models)\u001b[33m.\u001b[39mforEach((mc) \u001b[33m=>\u001b[39m {\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 59 |\u001b[39m       expect(modelPricing)\u001b[33m.\u001b[39mtoHaveProperty(mc\u001b[33m.\u001b[39mkey)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                            \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 60 |\u001b[39m     })\u001b[22m\n\u001b[2m     \u001b[90m 61 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 62 |\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/replicate/index.test.ts\u001b[39m\u001b[0m\u001b[2m:59:28\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m          at Array.forEach (<anonymous>)\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/replicate/index.test.ts\u001b[39m\u001b[0m\u001b[2m:58:27)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["core/replicate index"],"duration":0,"failureMessages":[],"fullName":"core/replicate index initializes Replicate with auth from env","status":"passed","title":"initializes Replicate with auth from env"},{"ancestorTitles":["core/replicate index"],"duration":0,"failureMessages":[],"fullName":"core/replicate index exports modelPricing mapping","status":"passed","title":"exports modelPricing mapping"},{"ancestorTitles":["core/replicate index"],"duration":6,"failureMessages":[],"fullName":"core/replicate index models.getInput returns correct dimensions for various aspect ratios","status":"passed","title":"models.getInput returns correct dimensions for various aspect ratios"},{"ancestorTitles":["core/replicate index"],"duration":0,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoHaveProperty\u001b[2m(\u001b[22m\u001b[32mpath\u001b[39m\u001b[2m)\u001b[22m\n\nExpected path: \u001b[32m\"black-forest-labs/flux-1.1-pro-ultra\"\u001b[39m\nReceived path: \u001b[31m[]\u001b[39m\n\nReceived value: \u001b[31m{\"black-forest-labs/flux-1.1-pro\": \"$0.040 / image\", \"black-forest-labs/flux-1.1-pro-ultra\": \"$0.060 / image\", \"black-forest-labs/flux-canny-dev\": \"$0.025 / image\", \"black-forest-labs/flux-canny-pro\": \"$0.050 / image\", \"black-forest-labs/flux-depth-dev\": \"$0.025 / image\", \"black-forest-labs/flux-depth-pro\": \"$0.050 / image\", \"black-forest-labs/flux-dev\": \"$0.025 / image\", \"black-forest-labs/flux-dev-lora\": \"$0.032 / image\", \"black-forest-labs/flux-fill-dev\": \"$0.040 / image\", \"black-forest-labs/flux-fill-pro\": \"$0.050 / image\", \"black-forest-labs/flux-pro\": \"$0.055 / image\", \"black-forest-labs/flux-redux-dev\": \"$0.025 / image\", \"black-forest-labs/flux-redux-schnell\": \"$0.003 / image\", \"black-forest-labs/flux-schnell\": \"$0.003 / image\", \"black-forest-labs/flux-schnell-lora\": \"$0.020 / image\", \"ideogram-ai/ideogram-v2\": \"$0.080 / image\", \"ideogram-ai/ideogram-v2-turbo\": \"$0.050 / image\", \"luma/photon\": \"$0.030 / image\", \"luma/photon-flash\": \"$0.010 / image\", \"recraft-ai/recraft-20b\": \"$0.022 / image\", \"recraft-ai/recraft-20b-svg\": \"$0.044 / image\", \"recraft-ai/recraft-v3\": \"$0.040 / image\", \"recraft-ai/recraft-v3-svg\": \"$0.080 / image\", \"stability-ai/stable-diffusion-3\": \"$0.035 / image\", \"stability-ai/stable-diffusion-3.5-large\": \"$0.065 / image\", \"stability-ai/stable-diffusion-3.5-large-turbo\": \"$0.040 / image\", \"stability-ai/stable-diffusion-3.5-medium\": \"$0.035 / image\"}\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/core/replicate/index.test.ts:59:28\n    at Array.forEach (<anonymous>)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/replicate/index.test.ts:58:27)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"core/replicate index modelPricing has entries for all defined models","status":"failed","title":"modelPricing has entries for all defined models"},{"ancestorTitles":["core/replicate index"],"duration":10,"failureMessages":[],"fullName":"core/replicate index getInput works for all models","status":"passed","title":"getInput works for all models"}]},{"numFailingTests":4,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171897040,"runtime":63,"slow":false,"start":1745171896977},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getReferalsCountAndUserData.unit.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mgetReferalsCountAndUserData › returns defaults when user fetch errors\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n    \u001b[32m- Expected  - 1\u001b[39m\n    \u001b[31m+ Received  + 1\u001b[39m\n\n    \u001b[2m  Object {\u001b[22m\n    \u001b[2m    \"count\": 0,\u001b[22m\n    \u001b[2m    \"isExist\": false,\u001b[22m\n    \u001b[2m    \"level\": 0,\u001b[22m\n    \u001b[32m-   \"subscription\": \"stars\",\u001b[39m\n    \u001b[31m+   \"subscriptionType\": \"stars\",\u001b[39m\n    \u001b[2m    \"userData\": null,\u001b[22m\n    \u001b[2m  }\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 18 |\u001b[39m     \u001b[33m;\u001b[39m(supabase\u001b[33m.\u001b[39m\u001b[36mfrom\u001b[39m \u001b[36mas\u001b[39m jest\u001b[33m.\u001b[39m\u001b[33mMock\u001b[39m)\u001b[33m.\u001b[39mmockReturnValue({ select\u001b[33m:\u001b[39m selectMock })\u001b[22m\n\u001b[2m     \u001b[90m 19 |\u001b[39m     \u001b[36mconst\u001b[39m result \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m getReferalsCountAndUserData(telegram_id)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 20 |\u001b[39m     expect(result)\u001b[33m.\u001b[39mtoEqual({ count\u001b[33m:\u001b[39m \u001b[35m0\u001b[39m\u001b[33m,\u001b[39m subscription\u001b[33m:\u001b[39m \u001b[32m'stars'\u001b[39m\u001b[33m,\u001b[39m level\u001b[33m:\u001b[39m \u001b[35m0\u001b[39m\u001b[33m,\u001b[39m userData\u001b[33m:\u001b[39m \u001b[36mnull\u001b[39m\u001b[33m,\u001b[39m isExist\u001b[33m:\u001b[39m \u001b[36mfalse\u001b[39m })\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                    \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 21 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 22 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 23 |\u001b[39m   it(\u001b[32m'returns defaults when referals fetch errors'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/getReferalsCountAndUserData.unit.test.ts\u001b[39m\u001b[0m\u001b[2m:20:20\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mgetReferalsCountAndUserData › returns defaults when referals fetch errors\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n    \u001b[32m- Expected  - 4\u001b[39m\n    \u001b[31m+ Received  + 8\u001b[39m\n\n    \u001b[2m  Object {\u001b[22m\n    \u001b[2m    \"count\": 0,\u001b[22m\n    \u001b[32m-   \"isExist\": false,\u001b[39m\n    \u001b[32m-   \"level\": 0,\u001b[39m\n    \u001b[32m-   \"subscription\": \"stars\",\u001b[39m\n    \u001b[32m-   \"userData\": null,\u001b[39m\n    \u001b[31m+   \"isExist\": true,\u001b[39m\n    \u001b[31m+   \"level\": 2,\u001b[39m\n    \u001b[31m+   \"subscriptionType\": \"stars\",\u001b[39m\n    \u001b[31m+   \"userData\": Object {\u001b[39m\n    \u001b[31m+     \"level\": 2,\u001b[39m\n    \u001b[31m+     \"subscription\": \"gold\",\u001b[39m\n    \u001b[31m+     \"user_id\": 5,\u001b[39m\n    \u001b[31m+   },\u001b[39m\n    \u001b[2m  }\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 33 |\u001b[39m     fromMock\u001b[33m.\u001b[39mmockReturnValueOnce({ select\u001b[33m:\u001b[39m selectRefs })\u001b[22m\n\u001b[2m     \u001b[90m 34 |\u001b[39m     \u001b[36mconst\u001b[39m result \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m getReferalsCountAndUserData(telegram_id)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 35 |\u001b[39m     expect(result)\u001b[33m.\u001b[39mtoEqual({ count\u001b[33m:\u001b[39m \u001b[35m0\u001b[39m\u001b[33m,\u001b[39m subscription\u001b[33m:\u001b[39m \u001b[32m'stars'\u001b[39m\u001b[33m,\u001b[39m level\u001b[33m:\u001b[39m \u001b[35m0\u001b[39m\u001b[33m,\u001b[39m userData\u001b[33m:\u001b[39m \u001b[36mnull\u001b[39m\u001b[33m,\u001b[39m isExist\u001b[33m:\u001b[39m \u001b[36mfalse\u001b[39m })\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                    \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 36 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 37 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 38 |\u001b[39m   it(\u001b[32m'returns correct data on success'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/getReferalsCountAndUserData.unit.test.ts\u001b[39m\u001b[0m\u001b[2m:35:20\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mgetReferalsCountAndUserData › returns correct data on success\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n    \u001b[32m- Expected  - 1\u001b[39m\n    \u001b[31m+ Received  + 1\u001b[39m\n\n    \u001b[33m@@ -1,10 +1,10 @@\u001b[39m\n    \u001b[2m  Object {\u001b[22m\n    \u001b[2m    \"count\": 2,\u001b[22m\n    \u001b[2m    \"isExist\": true,\u001b[22m\n    \u001b[2m    \"level\": 3,\u001b[22m\n    \u001b[32m-   \"subscription\": \"silver\",\u001b[39m\n    \u001b[31m+   \"subscriptionType\": \"stars\",\u001b[39m\n    \u001b[2m    \"userData\": Object {\u001b[22m\n    \u001b[2m      \"level\": 3,\u001b[22m\n    \u001b[2m      \"subscription\": \"silver\",\u001b[22m\n    \u001b[2m      \"user_id\": 10,\u001b[22m\n    \u001b[2m    },\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 47 |\u001b[39m     fromMock\u001b[33m.\u001b[39mmockReturnValueOnce({ select\u001b[33m:\u001b[39m selectRefs })\u001b[22m\n\u001b[2m     \u001b[90m 48 |\u001b[39m     \u001b[36mconst\u001b[39m result \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m getReferalsCountAndUserData(telegram_id)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 49 |\u001b[39m     expect(result)\u001b[33m.\u001b[39mtoEqual({ count\u001b[33m:\u001b[39m \u001b[35m2\u001b[39m\u001b[33m,\u001b[39m level\u001b[33m:\u001b[39m \u001b[35m3\u001b[39m\u001b[33m,\u001b[39m subscription\u001b[33m:\u001b[39m \u001b[32m'silver'\u001b[39m\u001b[33m,\u001b[39m userData\u001b[33m,\u001b[39m isExist\u001b[33m:\u001b[39m \u001b[36mtrue\u001b[39m })\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                    \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 50 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 51 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 52 |\u001b[39m   it(\u001b[32m'returns defaults on exception'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/getReferalsCountAndUserData.unit.test.ts\u001b[39m\u001b[0m\u001b[2m:49:20\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mgetReferalsCountAndUserData › returns defaults on exception\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n    \u001b[32m- Expected  - 1\u001b[39m\n    \u001b[31m+ Received  + 1\u001b[39m\n\n    \u001b[2m  Object {\u001b[22m\n    \u001b[2m    \"count\": 0,\u001b[22m\n    \u001b[2m    \"isExist\": false,\u001b[22m\n    \u001b[2m    \"level\": 0,\u001b[22m\n    \u001b[32m-   \"subscription\": \"stars\",\u001b[39m\n    \u001b[31m+   \"subscriptionType\": \"stars\",\u001b[39m\n    \u001b[2m    \"userData\": null,\u001b[22m\n    \u001b[2m  }\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 53 |\u001b[39m     \u001b[33m;\u001b[39m(supabase\u001b[33m.\u001b[39m\u001b[36mfrom\u001b[39m \u001b[36mas\u001b[39m jest\u001b[33m.\u001b[39m\u001b[33mMock\u001b[39m)\u001b[33m.\u001b[39mmockImplementation(() \u001b[33m=>\u001b[39m { \u001b[36mthrow\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(\u001b[32m'boom'\u001b[39m) })\u001b[22m\n\u001b[2m     \u001b[90m 54 |\u001b[39m     \u001b[36mconst\u001b[39m result \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m getReferalsCountAndUserData(telegram_id)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 55 |\u001b[39m     expect(result)\u001b[33m.\u001b[39mtoEqual({ count\u001b[33m:\u001b[39m \u001b[35m0\u001b[39m\u001b[33m,\u001b[39m subscription\u001b[33m:\u001b[39m \u001b[32m'stars'\u001b[39m\u001b[33m,\u001b[39m level\u001b[33m:\u001b[39m \u001b[35m0\u001b[39m\u001b[33m,\u001b[39m userData\u001b[33m:\u001b[39m \u001b[36mnull\u001b[39m\u001b[33m,\u001b[39m isExist\u001b[33m:\u001b[39m \u001b[36mfalse\u001b[39m })\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                    \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 56 |\u001b[39m     expect(logger\u001b[33m.\u001b[39merror)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[32m'Ошибка в getReferalsCountAndUserData:'\u001b[39m\u001b[33m,\u001b[39m expect\u001b[33m.\u001b[39many(\u001b[33mError\u001b[39m))\u001b[22m\n\u001b[2m     \u001b[90m 57 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 58 |\u001b[39m })\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/getReferalsCountAndUserData.unit.test.ts\u001b[39m\u001b[0m\u001b[2m:55:20\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["getReferalsCountAndUserData"],"duration":3,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n\u001b[32m- Expected  - 1\u001b[39m\n\u001b[31m+ Received  + 1\u001b[39m\n\n\u001b[2m  Object {\u001b[22m\n\u001b[2m    \"count\": 0,\u001b[22m\n\u001b[2m    \"isExist\": false,\u001b[22m\n\u001b[2m    \"level\": 0,\u001b[22m\n\u001b[32m-   \"subscription\": \"stars\",\u001b[39m\n\u001b[31m+   \"subscriptionType\": \"stars\",\u001b[39m\n\u001b[2m    \"userData\": null,\u001b[22m\n\u001b[2m  }\u001b[22m\n    at /Users/playra/999-multibots-telegraf/__tests__/core/supabase/getReferalsCountAndUserData.unit.test.ts:20:20\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"getReferalsCountAndUserData returns defaults when user fetch errors","status":"failed","title":"returns defaults when user fetch errors"},{"ancestorTitles":["getReferalsCountAndUserData"],"duration":16,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n\u001b[32m- Expected  - 4\u001b[39m\n\u001b[31m+ Received  + 8\u001b[39m\n\n\u001b[2m  Object {\u001b[22m\n\u001b[2m    \"count\": 0,\u001b[22m\n\u001b[32m-   \"isExist\": false,\u001b[39m\n\u001b[32m-   \"level\": 0,\u001b[39m\n\u001b[32m-   \"subscription\": \"stars\",\u001b[39m\n\u001b[32m-   \"userData\": null,\u001b[39m\n\u001b[31m+   \"isExist\": true,\u001b[39m\n\u001b[31m+   \"level\": 2,\u001b[39m\n\u001b[31m+   \"subscriptionType\": \"stars\",\u001b[39m\n\u001b[31m+   \"userData\": Object {\u001b[39m\n\u001b[31m+     \"level\": 2,\u001b[39m\n\u001b[31m+     \"subscription\": \"gold\",\u001b[39m\n\u001b[31m+     \"user_id\": 5,\u001b[39m\n\u001b[31m+   },\u001b[39m\n\u001b[2m  }\u001b[22m\n    at /Users/playra/999-multibots-telegraf/__tests__/core/supabase/getReferalsCountAndUserData.unit.test.ts:35:20\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"getReferalsCountAndUserData returns defaults when referals fetch errors","status":"failed","title":"returns defaults when referals fetch errors"},{"ancestorTitles":["getReferalsCountAndUserData"],"duration":2,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n\u001b[32m- Expected  - 1\u001b[39m\n\u001b[31m+ Received  + 1\u001b[39m\n\n\u001b[33m@@ -1,10 +1,10 @@\u001b[39m\n\u001b[2m  Object {\u001b[22m\n\u001b[2m    \"count\": 2,\u001b[22m\n\u001b[2m    \"isExist\": true,\u001b[22m\n\u001b[2m    \"level\": 3,\u001b[22m\n\u001b[32m-   \"subscription\": \"silver\",\u001b[39m\n\u001b[31m+   \"subscriptionType\": \"stars\",\u001b[39m\n\u001b[2m    \"userData\": Object {\u001b[22m\n\u001b[2m      \"level\": 3,\u001b[22m\n\u001b[2m      \"subscription\": \"silver\",\u001b[22m\n\u001b[2m      \"user_id\": 10,\u001b[22m\n\u001b[2m    },\u001b[22m\n    at /Users/playra/999-multibots-telegraf/__tests__/core/supabase/getReferalsCountAndUserData.unit.test.ts:49:20\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"getReferalsCountAndUserData returns correct data on success","status":"failed","title":"returns correct data on success"},{"ancestorTitles":["getReferalsCountAndUserData"],"duration":2,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n\u001b[32m- Expected  - 1\u001b[39m\n\u001b[31m+ Received  + 1\u001b[39m\n\n\u001b[2m  Object {\u001b[22m\n\u001b[2m    \"count\": 0,\u001b[22m\n\u001b[2m    \"isExist\": false,\u001b[22m\n\u001b[2m    \"level\": 0,\u001b[22m\n\u001b[32m-   \"subscription\": \"stars\",\u001b[39m\n\u001b[31m+   \"subscriptionType\": \"stars\",\u001b[39m\n\u001b[2m    \"userData\": null,\u001b[22m\n\u001b[2m  }\u001b[22m\n    at /Users/playra/999-multibots-telegraf/__tests__/core/supabase/getReferalsCountAndUserData.unit.test.ts:55:20\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"getReferalsCountAndUserData returns defaults on exception","status":"failed","title":"returns defaults on exception"}]},{"numFailingTests":3,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171897084,"runtime":44,"slow":false,"start":1745171897040},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.unit.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mupdateUserSubscription › resolves data on successful update\u001b[39m\u001b[22m\n\n    Не удалось обновить подписку пользователя\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 17 |\u001b[39m   } \u001b[36mcatch\u001b[39m (error) {\u001b[22m\n\u001b[2m     \u001b[90m 18 |\u001b[39m     console\u001b[33m.\u001b[39merror(\u001b[32m'Ошибка при обновлении подписки пользователя:'\u001b[39m\u001b[33m,\u001b[39m error)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 19 |\u001b[39m     \u001b[36mthrow\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(\u001b[32m'Не удалось обновить подписку пользователя'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m           \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 20 |\u001b[39m   }\u001b[22m\n\u001b[2m     \u001b[90m 21 |\u001b[39m }\u001b[22m\n\u001b[2m     \u001b[90m 22 |\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2msrc/core/supabase/updateUserSubscription.ts\u001b[2m:19:11\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.__awaiter (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat __awaiter (\u001b[22m\u001b[2msrc/core/supabase/updateUserSubscription.ts\u001b[2m:6:20)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/updateUserSubscription.unit.test.ts\u001b[39m\u001b[0m\u001b[2m:21:48\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.__awaiter (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/updateUserSubscription.unit.test.ts\u001b[39m\u001b[0m\u001b[2m:15:55)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mupdateUserSubscription › throws error when update returns error\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\n    \u001b[32m- Expected  - 3\u001b[39m\n    \u001b[31m+ Received  + 1\u001b[39m\n\n    \u001b[32m- Object {\u001b[39m\n    \u001b[32m-   \"message\": \"errSub\",\u001b[39m\n    \u001b[32m- }\u001b[39m\n    \u001b[31m+ [Error: Не удалось обновить подписку пользователя]\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 30 |\u001b[39m     \u001b[36mconst\u001b[39m updateMock \u001b[33m=\u001b[39m jest\u001b[33m.\u001b[39mfn()\u001b[33m.\u001b[39mmockResolvedValue({ data\u001b[33m:\u001b[39m \u001b[36mnull\u001b[39m\u001b[33m,\u001b[39m error\u001b[33m:\u001b[39m err })\u001b[22m\n\u001b[2m     \u001b[90m 31 |\u001b[39m     \u001b[33m;\u001b[39m(supabase\u001b[33m.\u001b[39m\u001b[36mfrom\u001b[39m \u001b[36mas\u001b[39m jest\u001b[33m.\u001b[39m\u001b[33mMock\u001b[39m)\u001b[33m.\u001b[39mmockReturnValue({ update\u001b[33m:\u001b[39m updateMock\u001b[33m,\u001b[39m eq\u001b[33m:\u001b[39m eqMock })\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 32 |\u001b[39m     \u001b[36mawait\u001b[39m expect(updateUserSubscription(userId\u001b[33m,\u001b[39m subscription))\u001b[33m.\u001b[39mrejects\u001b[33m.\u001b[39mtoBe(err)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                                                        \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 33 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 34 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 35 |\u001b[39m   it(\u001b[32m'throws error on unexpected exception'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.toBe (\u001b[22m\u001b[2mnode_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js\u001b[2m:218:22)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/updateUserSubscription.unit.test.ts\u001b[39m\u001b[0m\u001b[2m:32:72\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.__awaiter (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/updateUserSubscription.unit.test.ts\u001b[39m\u001b[0m\u001b[2m:27:59)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mupdateUserSubscription › throws error on unexpected exception\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected substring: \u001b[32m\"boom\"\u001b[39m\n    Received message:   \u001b[31m\"Не удалось обновить подписку пользователя\"\u001b[39m\n\n        \u001b[0m \u001b[90m 17 |\u001b[39m   } \u001b[36mcatch\u001b[39m (error) {\n         \u001b[90m 18 |\u001b[39m     console\u001b[33m.\u001b[39merror(\u001b[32m'Ошибка при обновлении подписки пользователя:'\u001b[39m\u001b[33m,\u001b[39m error)\n        \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 19 |\u001b[39m     \u001b[36mthrow\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(\u001b[32m'Не удалось обновить подписку пользователя'\u001b[39m)\n         \u001b[90m    |\u001b[39m           \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n         \u001b[90m 20 |\u001b[39m   }\n         \u001b[90m 21 |\u001b[39m }\n         \u001b[90m 22 |\u001b[39m\u001b[0m\n\n          \u001b[2mat \u001b[22msrc/core/supabase/updateUserSubscription.ts\u001b[2m:19:11\u001b[22m\n          \u001b[2mat \u001b[22mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\n          \u001b[2mat Object.__awaiter (\u001b[22mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\n          \u001b[2mat __awaiter (\u001b[22msrc/core/supabase/updateUserSubscription.ts\u001b[2m:6:20)\u001b[22m\n          \u001b[2mat \u001b[22m__tests__/core/supabase/updateUserSubscription.unit.test.ts\u001b[2m:37:40\u001b[22m\n          \u001b[2mat \u001b[22mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\n          \u001b[2mat Object.__awaiter (\u001b[22mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\n          \u001b[2mat Object.<anonymous> (\u001b[22m__tests__/core/supabase/updateUserSubscription.unit.test.ts\u001b[2m:35:57)\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 35 |\u001b[39m   it(\u001b[32m'throws error on unexpected exception'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[22m\n\u001b[2m     \u001b[90m 36 |\u001b[39m     \u001b[33m;\u001b[39m(supabase\u001b[33m.\u001b[39m\u001b[36mfrom\u001b[39m \u001b[36mas\u001b[39m jest\u001b[33m.\u001b[39m\u001b[33mMock\u001b[39m)\u001b[33m.\u001b[39mmockImplementation(() \u001b[33m=>\u001b[39m { \u001b[36mthrow\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(\u001b[32m'boom'\u001b[39m) })\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 37 |\u001b[39m     \u001b[36mawait\u001b[39m expect(updateUserSubscription(userId\u001b[33m,\u001b[39m subscription))\u001b[33m.\u001b[39mrejects\u001b[33m.\u001b[39mtoThrow(\u001b[32m'boom'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                                                        \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 38 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 39 |\u001b[39m })\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.toThrow (\u001b[22m\u001b[2mnode_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js\u001b[2m:218:22)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/updateUserSubscription.unit.test.ts\u001b[39m\u001b[0m\u001b[2m:37:72\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.__awaiter (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/updateUserSubscription.unit.test.ts\u001b[39m\u001b[0m\u001b[2m:35:57)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["updateUserSubscription"],"duration":5,"failureMessages":["Error: Не удалось обновить подписку пользователя\n    at /Users/playra/999-multibots-telegraf/src/core/supabase/updateUserSubscription.ts:19:11\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at __awaiter (/Users/playra/999-multibots-telegraf/src/core/supabase/updateUserSubscription.ts:6:20)\n    at /Users/playra/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.unit.test.ts:21:48\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.unit.test.ts:15:55)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"updateUserSubscription resolves data on successful update","status":"failed","title":"resolves data on successful update"},{"ancestorTitles":["updateUserSubscription"],"duration":3,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\n\u001b[32m- Expected  - 3\u001b[39m\n\u001b[31m+ Received  + 1\u001b[39m\n\n\u001b[32m- Object {\u001b[39m\n\u001b[32m-   \"message\": \"errSub\",\u001b[39m\n\u001b[32m- }\u001b[39m\n\u001b[31m+ [Error: Не удалось обновить подписку пользователя]\u001b[39m\n    at Object.toBe (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n    at /Users/playra/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.unit.test.ts:32:72\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.unit.test.ts:27:59)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"updateUserSubscription throws error when update returns error","status":"failed","title":"throws error when update returns error"},{"ancestorTitles":["updateUserSubscription"],"duration":3,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected substring: \u001b[32m\"boom\"\u001b[39m\nReceived message:   \u001b[31m\"Не удалось обновить подписку пользователя\"\u001b[39m\n\n    \u001b[0m \u001b[90m 17 |\u001b[39m   } \u001b[36mcatch\u001b[39m (error) {\n     \u001b[90m 18 |\u001b[39m     console\u001b[33m.\u001b[39merror(\u001b[32m'Ошибка при обновлении подписки пользователя:'\u001b[39m\u001b[33m,\u001b[39m error)\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 19 |\u001b[39m     \u001b[36mthrow\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(\u001b[32m'Не удалось обновить подписку пользователя'\u001b[39m)\n     \u001b[90m    |\u001b[39m           \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 20 |\u001b[39m   }\n     \u001b[90m 21 |\u001b[39m }\n     \u001b[90m 22 |\u001b[39m\u001b[0m\n\n      \u001b[2mat \u001b[22msrc/core/supabase/updateUserSubscription.ts\u001b[2m:19:11\u001b[22m\n      \u001b[2mat \u001b[22mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\n      \u001b[2mat Object.__awaiter (\u001b[22mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\n      \u001b[2mat __awaiter (\u001b[22msrc/core/supabase/updateUserSubscription.ts\u001b[2m:6:20)\u001b[22m\n      \u001b[2mat \u001b[22m__tests__/core/supabase/updateUserSubscription.unit.test.ts\u001b[2m:37:40\u001b[22m\n      \u001b[2mat \u001b[22mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\n      \u001b[2mat Object.__awaiter (\u001b[22mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\n      \u001b[2mat Object.<anonymous> (\u001b[22m__tests__/core/supabase/updateUserSubscription.unit.test.ts\u001b[2m:35:57)\u001b[22m\n    at Object.toThrow (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n    at /Users/playra/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.unit.test.ts:37:72\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.unit.test.ts:35:57)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"updateUserSubscription throws error on unexpected exception","status":"failed","title":"throws error on unexpected exception"}]},{"numFailingTests":4,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171897080,"runtime":39,"slow":false,"start":1745171897041},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getTranslation.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mgetTranslation › returns translation when first fetch succeeds\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n    \u001b[32m- Expected  - 0\u001b[39m\n    \u001b[31m+ Received  + 1\u001b[39m\n\n    \u001b[2m  Object {\u001b[22m\n    \u001b[31m+   \"buttons\": Array [],\u001b[39m\n    \u001b[2m    \"translation\": \"t1\",\u001b[22m\n    \u001b[2m    \"url\": \"u1\",\u001b[22m\n    \u001b[2m  }\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 37 |\u001b[39m     mockSingle\u001b[33m.\u001b[39mmockResolvedValue({ data\u001b[33m:\u001b[39m { translation\u001b[33m:\u001b[39m \u001b[32m't1'\u001b[39m\u001b[33m,\u001b[39m url\u001b[33m:\u001b[39m \u001b[32m'u1'\u001b[39m }\u001b[33m,\u001b[39m error\u001b[33m:\u001b[39m \u001b[36mnull\u001b[39m })\u001b[22m\n\u001b[2m     \u001b[90m 38 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m getTranslation({ key\u001b[33m,\u001b[39m ctx\u001b[33m,\u001b[39m bot_name\u001b[33m:\u001b[39m \u001b[32m'bot1'\u001b[39m })\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 39 |\u001b[39m     expect(res)\u001b[33m.\u001b[39mtoEqual({ translation\u001b[33m:\u001b[39m \u001b[32m't1'\u001b[39m\u001b[33m,\u001b[39m url\u001b[33m:\u001b[39m \u001b[32m'u1'\u001b[39m })\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                 \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 40 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 41 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 42 |\u001b[39m   it(\u001b[32m'falls back to default bot when first fetch errors and default succeeds'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/getTranslation.test.ts\u001b[39m\u001b[0m\u001b[2m:39:17)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/getTranslation.test.ts\u001b[39m\u001b[0m\u001b[2m:4:58)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mgetTranslation › falls back to default bot when first fetch errors and default succeeds\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n    \u001b[32m- Expected  - 0\u001b[39m\n    \u001b[31m+ Received  + 1\u001b[39m\n\n    \u001b[2m  Object {\u001b[22m\n    \u001b[31m+   \"buttons\": Array [],\u001b[39m\n    \u001b[2m    \"translation\": \"t2\",\u001b[22m\n    \u001b[2m    \"url\": \"u2\",\u001b[22m\n    \u001b[2m  }\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 47 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m getTranslation({ key\u001b[33m,\u001b[39m ctx\u001b[33m,\u001b[39m bot_name\u001b[33m:\u001b[39m undefined })\u001b[22m\n\u001b[2m     \u001b[90m 48 |\u001b[39m     expect(gtbt)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[32m'tok1'\u001b[39m)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 49 |\u001b[39m     expect(res)\u001b[33m.\u001b[39mtoEqual({ translation\u001b[33m:\u001b[39m \u001b[32m't2'\u001b[39m\u001b[33m,\u001b[39m url\u001b[33m:\u001b[39m \u001b[32m'u2'\u001b[39m })\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                 \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 50 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 51 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 52 |\u001b[39m   it(\u001b[32m'returns fallback when both fetches error'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/getTranslation.test.ts\u001b[39m\u001b[0m\u001b[2m:49:17)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/getTranslation.test.ts\u001b[39m\u001b[0m\u001b[2m:4:58)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mgetTranslation › returns fallback when both fetches error\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n    \u001b[32m- Expected  - 1\u001b[39m\n    \u001b[31m+ Received  + 2\u001b[39m\n\n    \u001b[2m  Object {\u001b[22m\n    \u001b[32m-   \"translation\": \"Добро пожаловать в NeuroBot! Бот готов помочь вам с нейросетями.\",\u001b[39m\n    \u001b[31m+   \"buttons\": Array [],\u001b[39m\n    \u001b[31m+   \"translation\": \"Добро пожаловать! Бот готов помочь.\",\u001b[39m\n    \u001b[2m    \"url\": \"\",\u001b[22m\n    \u001b[2m  }\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 53 |\u001b[39m     mockSingle\u001b[33m.\u001b[39mmockResolvedValue({ data\u001b[33m:\u001b[39m \u001b[36mnull\u001b[39m\u001b[33m,\u001b[39m error\u001b[33m:\u001b[39m { message\u001b[33m:\u001b[39m \u001b[32m'e'\u001b[39m } })\u001b[22m\n\u001b[2m     \u001b[90m 54 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m getTranslation({ key\u001b[33m,\u001b[39m ctx\u001b[33m,\u001b[39m bot_name\u001b[33m:\u001b[39m undefined })\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 55 |\u001b[39m     expect(res)\u001b[33m.\u001b[39mtoEqual(expectedFallback)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                 \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 56 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 57 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 58 |\u001b[39m   it(\u001b[32m'returns fallback on exception'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/getTranslation.test.ts\u001b[39m\u001b[0m\u001b[2m:55:17)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/getTranslation.test.ts\u001b[39m\u001b[0m\u001b[2m:4:58)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mgetTranslation › returns fallback on exception\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n    \u001b[32m- Expected  - 1\u001b[39m\n    \u001b[31m+ Received  + 2\u001b[39m\n\n    \u001b[2m  Object {\u001b[22m\n    \u001b[32m-   \"translation\": \"Добро пожаловать в NeuroBot! Бот готов помочь вам с нейросетями.\",\u001b[39m\n    \u001b[31m+   \"buttons\": Array [],\u001b[39m\n    \u001b[31m+   \"translation\": \"Добро пожаловать! Бот готов помочь.\",\u001b[39m\n    \u001b[2m    \"url\": \"\",\u001b[22m\n    \u001b[2m  }\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 59 |\u001b[39m     mockSelect\u001b[33m.\u001b[39mmockImplementation(() \u001b[33m=>\u001b[39m { \u001b[36mthrow\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(\u001b[32m'oops'\u001b[39m) })\u001b[22m\n\u001b[2m     \u001b[90m 60 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m getTranslation({ key\u001b[33m,\u001b[39m ctx\u001b[33m,\u001b[39m bot_name\u001b[33m:\u001b[39m \u001b[32m'bot1'\u001b[39m })\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 61 |\u001b[39m     expect(res)\u001b[33m.\u001b[39mtoEqual(expectedFallback)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                 \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 62 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 63 |\u001b[39m })\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/getTranslation.test.ts\u001b[39m\u001b[0m\u001b[2m:61:17)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/getTranslation.test.ts\u001b[39m\u001b[0m\u001b[2m:4:58)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["getTranslation"],"duration":4,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n\u001b[32m- Expected  - 0\u001b[39m\n\u001b[31m+ Received  + 1\u001b[39m\n\n\u001b[2m  Object {\u001b[22m\n\u001b[31m+   \"buttons\": Array [],\u001b[39m\n\u001b[2m    \"translation\": \"t1\",\u001b[22m\n\u001b[2m    \"url\": \"u1\",\u001b[22m\n\u001b[2m  }\u001b[22m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getTranslation.test.ts:39:17)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getTranslation.test.ts:4:58)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"getTranslation returns translation when first fetch succeeds","status":"failed","title":"returns translation when first fetch succeeds"},{"ancestorTitles":["getTranslation"],"duration":2,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n\u001b[32m- Expected  - 0\u001b[39m\n\u001b[31m+ Received  + 1\u001b[39m\n\n\u001b[2m  Object {\u001b[22m\n\u001b[31m+   \"buttons\": Array [],\u001b[39m\n\u001b[2m    \"translation\": \"t2\",\u001b[22m\n\u001b[2m    \"url\": \"u2\",\u001b[22m\n\u001b[2m  }\u001b[22m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getTranslation.test.ts:49:17)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getTranslation.test.ts:4:58)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"getTranslation falls back to default bot when first fetch errors and default succeeds","status":"failed","title":"falls back to default bot when first fetch errors and default succeeds"},{"ancestorTitles":["getTranslation"],"duration":2,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n\u001b[32m- Expected  - 1\u001b[39m\n\u001b[31m+ Received  + 2\u001b[39m\n\n\u001b[2m  Object {\u001b[22m\n\u001b[32m-   \"translation\": \"Добро пожаловать в NeuroBot! Бот готов помочь вам с нейросетями.\",\u001b[39m\n\u001b[31m+   \"buttons\": Array [],\u001b[39m\n\u001b[31m+   \"translation\": \"Добро пожаловать! Бот готов помочь.\",\u001b[39m\n\u001b[2m    \"url\": \"\",\u001b[22m\n\u001b[2m  }\u001b[22m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getTranslation.test.ts:55:17)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getTranslation.test.ts:4:58)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"getTranslation returns fallback when both fetches error","status":"failed","title":"returns fallback when both fetches error"},{"ancestorTitles":["getTranslation"],"duration":2,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n\u001b[32m- Expected  - 1\u001b[39m\n\u001b[31m+ Received  + 2\u001b[39m\n\n\u001b[2m  Object {\u001b[22m\n\u001b[32m-   \"translation\": \"Добро пожаловать в NeuroBot! Бот готов помочь вам с нейросетями.\",\u001b[39m\n\u001b[31m+   \"buttons\": Array [],\u001b[39m\n\u001b[31m+   \"translation\": \"Добро пожаловать! Бот готов помочь.\",\u001b[39m\n\u001b[2m    \"url\": \"\",\u001b[22m\n\u001b[2m  }\u001b[22m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getTranslation.test.ts:61:17)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getTranslation.test.ts:4:58)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"getTranslation returns fallback on exception","status":"failed","title":"returns fallback on exception"}]},{"numFailingTests":2,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171897096,"runtime":50,"slow":false,"start":1745171897046},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/menu/startMenu.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mstartMenu › replies with Russian text and keyboard\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32m\"Выберите действие в меню:\"\u001b[39m, \u001b[32mObjectContaining {\"reply_markup\": ObjectContaining {\"keyboard\": [[{\"text\": \"🏠 Главное меню\"}]]}}\u001b[39m\n    Received: \u001b[2m\"Выберите действие в меню:\"\u001b[22m, \u001b[31m{\"reply_markup\": {\"keyboard\": [[{\"hide\": false, \"text\": \"🏠 Главное меню\"}]], \"resize_keyboard\": true}}\u001b[39m\n\n    Number of calls: \u001b[31m1\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 12 |\u001b[39m   it(\u001b[32m'replies with Russian text and keyboard'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[22m\n\u001b[2m     \u001b[90m 13 |\u001b[39m     \u001b[36mawait\u001b[39m startMenu(ctx \u001b[36mas\u001b[39m any\u001b[33m,\u001b[39m \u001b[36mtrue\u001b[39m)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 14 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mreply)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 15 |\u001b[39m       \u001b[32m'Выберите действие в меню:'\u001b[39m\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 16 |\u001b[39m       expect\u001b[33m.\u001b[39mobjectContaining({\u001b[22m\n\u001b[2m     \u001b[90m 17 |\u001b[39m         reply_markup\u001b[33m:\u001b[39m expect\u001b[33m.\u001b[39mobjectContaining({\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/menu/startMenu.test.ts\u001b[39m\u001b[0m\u001b[2m:14:23\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mstartMenu › replies with English text and keyboard\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32m\"Choose an action in the menu:\"\u001b[39m, \u001b[32mObjectContaining {\"reply_markup\": ObjectContaining {\"keyboard\": [[{\"text\": \"🏠 Main menu\"}]]}}\u001b[39m\n    Received: \u001b[2m\"Choose an action in the menu:\"\u001b[22m, \u001b[31m{\"reply_markup\": {\"keyboard\": [[{\"hide\": false, \"text\": \"🏠 Main menu\"}]], \"resize_keyboard\": true}}\u001b[39m\n\n    Number of calls: \u001b[31m1\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 24 |\u001b[39m   it(\u001b[32m'replies with English text and keyboard'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[22m\n\u001b[2m     \u001b[90m 25 |\u001b[39m     \u001b[36mawait\u001b[39m startMenu(ctx \u001b[36mas\u001b[39m any\u001b[33m,\u001b[39m \u001b[36mfalse\u001b[39m)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 26 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mreply)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 27 |\u001b[39m       \u001b[32m'Choose an action in the menu:'\u001b[39m\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 28 |\u001b[39m       expect\u001b[33m.\u001b[39mobjectContaining({\u001b[22m\n\u001b[2m     \u001b[90m 29 |\u001b[39m         reply_markup\u001b[33m:\u001b[39m expect\u001b[33m.\u001b[39mobjectContaining({\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/menu/startMenu.test.ts\u001b[39m\u001b[0m\u001b[2m:26:23\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["startMenu"],"duration":2,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m\"Выберите действие в меню:\"\u001b[39m, \u001b[32mObjectContaining {\"reply_markup\": ObjectContaining {\"keyboard\": [[{\"text\": \"🏠 Главное меню\"}]]}}\u001b[39m\nReceived: \u001b[2m\"Выберите действие в меню:\"\u001b[22m, \u001b[31m{\"reply_markup\": {\"keyboard\": [[{\"hide\": false, \"text\": \"🏠 Главное меню\"}]], \"resize_keyboard\": true}}\u001b[39m\n\nNumber of calls: \u001b[31m1\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/menu/startMenu.test.ts:14:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"startMenu replies with Russian text and keyboard","status":"failed","title":"replies with Russian text and keyboard"},{"ancestorTitles":["startMenu"],"duration":1,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m\"Choose an action in the menu:\"\u001b[39m, \u001b[32mObjectContaining {\"reply_markup\": ObjectContaining {\"keyboard\": [[{\"text\": \"🏠 Main menu\"}]]}}\u001b[39m\nReceived: \u001b[2m\"Choose an action in the menu:\"\u001b[22m, \u001b[31m{\"reply_markup\": {\"keyboard\": [[{\"hide\": false, \"text\": \"🏠 Main menu\"}]], \"resize_keyboard\": true}}\u001b[39m\n\nNumber of calls: \u001b[31m1\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/menu/startMenu.test.ts:26:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"startMenu replies with English text and keyboard","status":"failed","title":"replies with English text and keyboard"}]},{"numFailingTests":1,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171897125,"runtime":32,"slow":false,"start":1745171897093},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/bot/getBotByName.error.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mgetBotByName error handling › returns error when recreated bot instance lacks telegram.sendMessage\u001b[39m\u001b[22m\n\n    TypeError: Cannot read properties of undefined (reading 'error')\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 14 |\u001b[39m \u001b[36mconst\u001b[39m loadResult \u001b[33m=\u001b[39m config({ path\u001b[33m:\u001b[39m envPath })\u001b[22m\n\u001b[2m     \u001b[90m 15 |\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 16 |\u001b[39m \u001b[36mif\u001b[39m (loadResult\u001b[33m.\u001b[39merror) {\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 17 |\u001b[39m   console\u001b[33m.\u001b[39merror(\u001b[22m\n\u001b[2m     \u001b[90m 18 |\u001b[39m     \u001b[32m`[CONFIG] CRITICAL ERROR: Failed to load primary .env file from ${envPath}. Error: ${loadResult.error.message}`\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 19 |\u001b[39m   )\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.error (\u001b[22m\u001b[2msrc/config/index.ts\u001b[2m:16:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/core/bot/index.ts\u001b[2m:5:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/bot/getBotByName.error.test.ts\u001b[39m\u001b[0m\u001b[2m:33:11\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/bot/getBotByName.error.test.ts\u001b[39m\u001b[0m\u001b[2m:12:10)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["getBotByName error handling"],"duration":5,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'error')\n    at Object.error (/Users/playra/999-multibots-telegraf/src/config/index.ts:16:16)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime._generateMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1690:34)\n    at Runtime.requireMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:996:39)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1046:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/core/bot/index.ts:5:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at /Users/playra/999-multibots-telegraf/__tests__/core/bot/getBotByName.error.test.ts:33:11\n    at Runtime.isolateModules (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1082:7)\n    at Object.isolateModules (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1992:12)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/bot/getBotByName.error.test.ts:12:10)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"getBotByName error handling returns error when recreated bot instance lacks telegram.sendMessage","status":"failed","title":"returns error when recreated bot instance lacks telegram.sendMessage"}]},{"numFailingTests":2,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171897133,"runtime":29,"slow":false,"start":1745171897104},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getUserLevel.unit.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mgetUserLevel › returns null on supabase error\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    \u001b[32m- Expected\u001b[39m\n    \u001b[31m+ Received\u001b[39m\n\n    \u001b[32m- \"Ошибка при получении уровня пользователя:\"\u001b[39m,\n    \u001b[31m+ \"Ошибка в функции getUserLevel:\"\u001b[39m,\n    \u001b[32m- Object {\u001b[39m\n    \u001b[32m-   \"message\": \"err\",\u001b[39m\n    \u001b[32m- }\u001b[39m\n    \u001b[31m+ [TypeError: supabase_1.supabase.from(...).select(...).eq is not a function]\u001b[39m,\n\n    Number of calls: \u001b[31m1\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 18 |\u001b[39m     \u001b[36mconst\u001b[39m result \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m getUserLevel(telegram_id)\u001b[22m\n\u001b[2m     \u001b[90m 19 |\u001b[39m     expect(result)\u001b[33m.\u001b[39mtoBeNull()\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 20 |\u001b[39m     expect(consoleErrorSpy)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[32m'Ошибка при получении уровня пользователя:'\u001b[39m\u001b[33m,\u001b[39m { message\u001b[33m:\u001b[39m \u001b[32m'err'\u001b[39m })\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                             \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 21 |\u001b[39m     consoleErrorSpy\u001b[33m.\u001b[39mmockRestore()\u001b[22m\n\u001b[2m     \u001b[90m 22 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 23 |\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/getUserLevel.unit.test.ts\u001b[39m\u001b[0m\u001b[2m:20:29\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mgetUserLevel › returns level when data present\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\n    Expected: \u001b[32m7\u001b[39m\n    Received: \u001b[31mnull\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 28 |\u001b[39m     \u001b[33m;\u001b[39m(supabase\u001b[33m.\u001b[39m\u001b[36mfrom\u001b[39m \u001b[36mas\u001b[39m jest\u001b[33m.\u001b[39m\u001b[33mMock\u001b[39m)\u001b[33m.\u001b[39mmockReturnValue({ select\u001b[33m:\u001b[39m selectMock })\u001b[22m\n\u001b[2m     \u001b[90m 29 |\u001b[39m     \u001b[36mconst\u001b[39m result \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m getUserLevel(telegram_id)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 30 |\u001b[39m     expect(result)\u001b[33m.\u001b[39mtoBe(\u001b[35m7\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                    \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 31 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 32 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 33 |\u001b[39m   it(\u001b[32m'returns null when data is null'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/getUserLevel.unit.test.ts\u001b[39m\u001b[0m\u001b[2m:30:20\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["getUserLevel"],"duration":1,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n\u001b[32m- Expected\u001b[39m\n\u001b[31m+ Received\u001b[39m\n\n\u001b[32m- \"Ошибка при получении уровня пользователя:\"\u001b[39m,\n\u001b[31m+ \"Ошибка в функции getUserLevel:\"\u001b[39m,\n\u001b[32m- Object {\u001b[39m\n\u001b[32m-   \"message\": \"err\",\u001b[39m\n\u001b[32m- }\u001b[39m\n\u001b[31m+ [TypeError: supabase_1.supabase.from(...).select(...).eq is not a function]\u001b[39m,\n\nNumber of calls: \u001b[31m1\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/core/supabase/getUserLevel.unit.test.ts:20:29\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"getUserLevel returns null on supabase error","status":"failed","title":"returns null on supabase error"},{"ancestorTitles":["getUserLevel"],"duration":0,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32m7\u001b[39m\nReceived: \u001b[31mnull\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/core/supabase/getUserLevel.unit.test.ts:30:20\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"getUserLevel returns level when data present","status":"failed","title":"returns level when data present"},{"ancestorTitles":["getUserLevel"],"duration":1,"failureMessages":[],"fullName":"getUserLevel returns null when data is null","status":"passed","title":"returns null when data is null"},{"ancestorTitles":["getUserLevel"],"duration":0,"failureMessages":[],"fullName":"getUserLevel returns null on exception","status":"passed","title":"returns null on exception"}]},{"numFailingTests":6,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171897137,"runtime":45,"slow":false,"start":1745171897092},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mcreateUser › throws if inviter check fails\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected substring: \u001b[32m\"Ошибка при проверке инвайтера: invite error\"\u001b[39m\n    Received message:   \u001b[31m\"Cannot read properties of undefined (reading 'select')\"\u001b[39m\n\n        \u001b[0m \u001b[90m 38 |\u001b[39m         bot_name\u001b[33m,\u001b[39m\n         \u001b[90m 39 |\u001b[39m       }\u001b[33m,\u001b[39m\n        \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 40 |\u001b[39m     ])\n         \u001b[90m    |\u001b[39m       \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n         \u001b[90m 41 |\u001b[39m     \u001b[33m.\u001b[39mselect()\n         \u001b[90m 42 |\u001b[39m\n         \u001b[90m 43 |\u001b[39m   \u001b[36mif\u001b[39m (error) {\u001b[0m\n\n          \u001b[2mat \u001b[22msrc/core/supabase/createUser.ts\u001b[2m:40:7\u001b[22m\n          \u001b[2mat \u001b[22mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\n          \u001b[2mat Object.__awaiter (\u001b[22mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\n          \u001b[2mat __awaiter (\u001b[22msrc/core/supabase/createUser.ts\u001b[2m:19:22)\u001b[22m\n          \u001b[2mat Object.<anonymous> (\u001b[22m__tests__/core/supabase/createUser.test.ts\u001b[2m:68:18)\u001b[22m\n          \u001b[2mat \u001b[22m__tests__/core/supabase/createUser.test.ts\u001b[2m:7:71\u001b[22m\n          \u001b[2mat Object.<anonymous>.__awaiter (\u001b[22m__tests__/core/supabase/createUser.test.ts\u001b[2m:3:12)\u001b[22m\n          \u001b[2mat Object.<anonymous> (\u001b[22m__tests__/core/supabase/createUser.test.ts\u001b[2m:63:50)\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 66 |\u001b[39m     mockMaybeSingle\u001b[33m.\u001b[39mmockResolvedValueOnce({ data\u001b[33m:\u001b[39m \u001b[36mnull\u001b[39m\u001b[33m,\u001b[39m error\u001b[33m:\u001b[39m err })\u001b[22m\n\u001b[2m     \u001b[90m 67 |\u001b[39m     \u001b[36mconst\u001b[39m data \u001b[33m=\u001b[39m { \u001b[33m...\u001b[39mbaseData\u001b[33m,\u001b[39m inviter\u001b[33m:\u001b[39m \u001b[35m999\u001b[39m }\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 68 |\u001b[39m     \u001b[36mawait\u001b[39m expect(createUser(data))\u001b[33m.\u001b[39mrejects\u001b[33m.\u001b[39mtoThrow(\u001b[32m`Ошибка при проверке инвайтера: ${err.message}`\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                            \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 69 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 70 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 71 |\u001b[39m   it(\u001b[32m'throws if existing user select fails'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.toThrow (\u001b[22m\u001b[2mnode_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js\u001b[2m:218:22)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/createUser.test.ts\u001b[39m\u001b[0m\u001b[2m:68:44)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/createUser.test.ts\u001b[39m\u001b[0m\u001b[2m:7:71\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous>.__awaiter (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/createUser.test.ts\u001b[39m\u001b[0m\u001b[2m:3:12)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/createUser.test.ts\u001b[39m\u001b[0m\u001b[2m:63:50)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mcreateUser › throws if existing user select fails\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected substring: \u001b[32m\"Ошибка при проверке существующего пользователя: select error\"\u001b[39m\n    Received message:   \u001b[31m\"Cannot read properties of undefined (reading 'select')\"\u001b[39m\n\n        \u001b[0m \u001b[90m 38 |\u001b[39m         bot_name\u001b[33m,\u001b[39m\n         \u001b[90m 39 |\u001b[39m       }\u001b[33m,\u001b[39m\n        \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 40 |\u001b[39m     ])\n         \u001b[90m    |\u001b[39m       \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n         \u001b[90m 41 |\u001b[39m     \u001b[33m.\u001b[39mselect()\n         \u001b[90m 42 |\u001b[39m\n         \u001b[90m 43 |\u001b[39m   \u001b[36mif\u001b[39m (error) {\u001b[0m\n\n          \u001b[2mat \u001b[22msrc/core/supabase/createUser.ts\u001b[2m:40:7\u001b[22m\n          \u001b[2mat \u001b[22mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\n          \u001b[2mat Object.__awaiter (\u001b[22mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\n          \u001b[2mat __awaiter (\u001b[22msrc/core/supabase/createUser.ts\u001b[2m:19:22)\u001b[22m\n          \u001b[2mat Object.<anonymous> (\u001b[22m__tests__/core/supabase/createUser.test.ts\u001b[2m:75:18)\u001b[22m\n          \u001b[2mat \u001b[22m__tests__/core/supabase/createUser.test.ts\u001b[2m:7:71\u001b[22m\n          \u001b[2mat Object.<anonymous>.__awaiter (\u001b[22m__tests__/core/supabase/createUser.test.ts\u001b[2m:3:12)\u001b[22m\n          \u001b[2mat Object.<anonymous> (\u001b[22m__tests__/core/supabase/createUser.test.ts\u001b[2m:71:57)\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 73 |\u001b[39m     \u001b[36mconst\u001b[39m err \u001b[33m=\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(\u001b[32m'select error'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 74 |\u001b[39m     mockMaybeSingle\u001b[33m.\u001b[39mmockResolvedValueOnce({ data\u001b[33m:\u001b[39m \u001b[36mnull\u001b[39m\u001b[33m,\u001b[39m error\u001b[33m:\u001b[39m err })\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 75 |\u001b[39m     \u001b[36mawait\u001b[39m expect(createUser(baseData))\u001b[33m.\u001b[39mrejects\u001b[33m.\u001b[39mtoThrow(\u001b[32m`Ошибка при проверке существующего пользователя: ${err.message}`\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                                \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 76 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 77 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 78 |\u001b[39m   it(\u001b[32m'updates existing user when found without inviter'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.toThrow (\u001b[22m\u001b[2mnode_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js\u001b[2m:218:22)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/createUser.test.ts\u001b[39m\u001b[0m\u001b[2m:75:48)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/createUser.test.ts\u001b[39m\u001b[0m\u001b[2m:7:71\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous>.__awaiter (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/createUser.test.ts\u001b[39m\u001b[0m\u001b[2m:3:12)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/createUser.test.ts\u001b[39m\u001b[0m\u001b[2m:71:57)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mcreateUser › updates existing user when found without inviter\u001b[39m\u001b[22m\n\n    TypeError: Cannot read properties of undefined (reading 'select')\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 38 |\u001b[39m         bot_name\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 39 |\u001b[39m       }\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 40 |\u001b[39m     ])\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m       \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 41 |\u001b[39m     \u001b[33m.\u001b[39mselect()\u001b[22m\n\u001b[2m     \u001b[90m 42 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 43 |\u001b[39m   \u001b[36mif\u001b[39m (error) {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2msrc/core/supabase/createUser.ts\u001b[2m:40:7\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.__awaiter (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat __awaiter (\u001b[22m\u001b[2msrc/core/supabase/createUser.ts\u001b[2m:19:22)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/createUser.test.ts\u001b[39m\u001b[0m\u001b[2m:84:26)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/createUser.test.ts\u001b[39m\u001b[0m\u001b[2m:7:71\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous>.__awaiter (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/createUser.test.ts\u001b[39m\u001b[0m\u001b[2m:3:12)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/createUser.test.ts\u001b[39m\u001b[0m\u001b[2m:78:69)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mcreateUser › inserts new user when not exists\u001b[39m\u001b[22m\n\n    TypeError: supabase_1.supabase.from(...).insert(...).select is not a function\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 39 |\u001b[39m       }\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 40 |\u001b[39m     ])\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 41 |\u001b[39m     \u001b[33m.\u001b[39mselect()\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m      \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 42 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 43 |\u001b[39m   \u001b[36mif\u001b[39m (error) {\u001b[22m\n\u001b[2m     \u001b[90m 44 |\u001b[39m     console\u001b[33m.\u001b[39merror(\u001b[32m'Error creating user:'\u001b[39m\u001b[33m,\u001b[39m error)\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat select (\u001b[22m\u001b[2msrc/core/supabase/createUser.ts\u001b[2m:41:6)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.__awaiter (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat __awaiter (\u001b[22m\u001b[2msrc/core/supabase/createUser.ts\u001b[2m:19:22)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/createUser.test.ts\u001b[39m\u001b[0m\u001b[2m:93:26)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/createUser.test.ts\u001b[39m\u001b[0m\u001b[2m:7:71\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous>.__awaiter (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/createUser.test.ts\u001b[39m\u001b[0m\u001b[2m:3:12)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/createUser.test.ts\u001b[39m\u001b[0m\u001b[2m:90:53)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mcreateUser › throws on update error\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected substring: \u001b[32m\"Ошибка при обновлении пользователя: upd error\"\u001b[39m\n    Received message:   \u001b[31m\"Cannot read properties of undefined (reading 'select')\"\u001b[39m\n\n        \u001b[0m \u001b[90m 38 |\u001b[39m         bot_name\u001b[33m,\u001b[39m\n         \u001b[90m 39 |\u001b[39m       }\u001b[33m,\u001b[39m\n        \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 40 |\u001b[39m     ])\n         \u001b[90m    |\u001b[39m       \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n         \u001b[90m 41 |\u001b[39m     \u001b[33m.\u001b[39mselect()\n         \u001b[90m 42 |\u001b[39m\n         \u001b[90m 43 |\u001b[39m   \u001b[36mif\u001b[39m (error) {\u001b[0m\n\n          \u001b[2mat \u001b[22msrc/core/supabase/createUser.ts\u001b[2m:40:7\u001b[22m\n          \u001b[2mat \u001b[22mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\n          \u001b[2mat Object.__awaiter (\u001b[22mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\n          \u001b[2mat __awaiter (\u001b[22msrc/core/supabase/createUser.ts\u001b[2m:19:22)\u001b[22m\n          \u001b[2mat Object.<anonymous> (\u001b[22m__tests__/core/supabase/createUser.test.ts\u001b[2m:103:18)\u001b[22m\n          \u001b[2mat \u001b[22m__tests__/core/supabase/createUser.test.ts\u001b[2m:7:71\u001b[22m\n          \u001b[2mat Object.<anonymous>.__awaiter (\u001b[22m__tests__/core/supabase/createUser.test.ts\u001b[2m:3:12)\u001b[22m\n          \u001b[2mat Object.<anonymous> (\u001b[22m__tests__/core/supabase/createUser.test.ts\u001b[2m:98:43)\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 101 |\u001b[39m     \u001b[36mconst\u001b[39m upErr \u001b[33m=\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(\u001b[32m'upd error'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 102 |\u001b[39m     mockEqUpdate\u001b[33m.\u001b[39mmockResolvedValueOnce({ error\u001b[33m:\u001b[39m upErr })\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 103 |\u001b[39m     \u001b[36mawait\u001b[39m expect(createUser(baseData))\u001b[33m.\u001b[39mrejects\u001b[33m.\u001b[39mtoThrow(\u001b[32m`Ошибка при обновлении пользователя: ${upErr.message}`\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                                                \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 104 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 105 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 106 |\u001b[39m   it(\u001b[32m'throws on insert error'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.toThrow (\u001b[22m\u001b[2mnode_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js\u001b[2m:218:22)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/createUser.test.ts\u001b[39m\u001b[0m\u001b[2m:103:48)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/createUser.test.ts\u001b[39m\u001b[0m\u001b[2m:7:71\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous>.__awaiter (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/createUser.test.ts\u001b[39m\u001b[0m\u001b[2m:3:12)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/createUser.test.ts\u001b[39m\u001b[0m\u001b[2m:98:43)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mcreateUser › throws on insert error\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected substring: \u001b[32m\"Ошибка при добавлении пользователя: ins error\"\u001b[39m\n    Received message:   \u001b[31m\"supabase_1.supabase.from(...).insert(...).select is not a function\"\u001b[39m\n\n        \u001b[0m \u001b[90m 39 |\u001b[39m       }\u001b[33m,\u001b[39m\n         \u001b[90m 40 |\u001b[39m     ])\n        \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 41 |\u001b[39m     \u001b[33m.\u001b[39mselect()\n         \u001b[90m    |\u001b[39m      \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n         \u001b[90m 42 |\u001b[39m\n         \u001b[90m 43 |\u001b[39m   \u001b[36mif\u001b[39m (error) {\n         \u001b[90m 44 |\u001b[39m     console\u001b[33m.\u001b[39merror(\u001b[32m'Error creating user:'\u001b[39m\u001b[33m,\u001b[39m error)\u001b[0m\n\n          \u001b[2mat select (\u001b[22msrc/core/supabase/createUser.ts\u001b[2m:41:6)\u001b[22m\n          \u001b[2mat \u001b[22mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\n          \u001b[2mat Object.__awaiter (\u001b[22mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\n          \u001b[2mat __awaiter (\u001b[22msrc/core/supabase/createUser.ts\u001b[2m:19:22)\u001b[22m\n          \u001b[2mat Object.<anonymous> (\u001b[22m__tests__/core/supabase/createUser.test.ts\u001b[2m:110:18)\u001b[22m\n          \u001b[2mat \u001b[22m__tests__/core/supabase/createUser.test.ts\u001b[2m:7:71\u001b[22m\n          \u001b[2mat Object.<anonymous>.__awaiter (\u001b[22m__tests__/core/supabase/createUser.test.ts\u001b[2m:3:12)\u001b[22m\n          \u001b[2mat Object.<anonymous> (\u001b[22m__tests__/core/supabase/createUser.test.ts\u001b[2m:106:43)\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 108 |\u001b[39m     \u001b[36mconst\u001b[39m insErr \u001b[33m=\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(\u001b[32m'ins error'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 109 |\u001b[39m     mockInsert\u001b[33m.\u001b[39mmockResolvedValueOnce({ error\u001b[33m:\u001b[39m insErr })\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 110 |\u001b[39m     \u001b[36mawait\u001b[39m expect(createUser(baseData))\u001b[33m.\u001b[39mrejects\u001b[33m.\u001b[39mtoThrow(\u001b[32m`Ошибка при добавлении пользователя: ${insErr.message}`\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                                                \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 111 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 112 |\u001b[39m })\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.toThrow (\u001b[22m\u001b[2mnode_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js\u001b[2m:218:22)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/createUser.test.ts\u001b[39m\u001b[0m\u001b[2m:110:48)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/createUser.test.ts\u001b[39m\u001b[0m\u001b[2m:7:71\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous>.__awaiter (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/createUser.test.ts\u001b[39m\u001b[0m\u001b[2m:3:12)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/createUser.test.ts\u001b[39m\u001b[0m\u001b[2m:106:43)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["createUser"],"duration":9,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected substring: \u001b[32m\"Ошибка при проверке инвайтера: invite error\"\u001b[39m\nReceived message:   \u001b[31m\"Cannot read properties of undefined (reading 'select')\"\u001b[39m\n\n    \u001b[0m \u001b[90m 38 |\u001b[39m         bot_name\u001b[33m,\u001b[39m\n     \u001b[90m 39 |\u001b[39m       }\u001b[33m,\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 40 |\u001b[39m     ])\n     \u001b[90m    |\u001b[39m       \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 41 |\u001b[39m     \u001b[33m.\u001b[39mselect()\n     \u001b[90m 42 |\u001b[39m\n     \u001b[90m 43 |\u001b[39m   \u001b[36mif\u001b[39m (error) {\u001b[0m\n\n      \u001b[2mat \u001b[22msrc/core/supabase/createUser.ts\u001b[2m:40:7\u001b[22m\n      \u001b[2mat \u001b[22mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\n      \u001b[2mat Object.__awaiter (\u001b[22mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\n      \u001b[2mat __awaiter (\u001b[22msrc/core/supabase/createUser.ts\u001b[2m:19:22)\u001b[22m\n      \u001b[2mat Object.<anonymous> (\u001b[22m__tests__/core/supabase/createUser.test.ts\u001b[2m:68:18)\u001b[22m\n      \u001b[2mat \u001b[22m__tests__/core/supabase/createUser.test.ts\u001b[2m:7:71\u001b[22m\n      \u001b[2mat Object.<anonymous>.__awaiter (\u001b[22m__tests__/core/supabase/createUser.test.ts\u001b[2m:3:12)\u001b[22m\n      \u001b[2mat Object.<anonymous> (\u001b[22m__tests__/core/supabase/createUser.test.ts\u001b[2m:63:50)\u001b[22m\n    at Object.toThrow (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:68:44)\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:7:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:3:12)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:63:50)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"createUser throws if inviter check fails","status":"failed","title":"throws if inviter check fails"},{"ancestorTitles":["createUser"],"duration":3,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected substring: \u001b[32m\"Ошибка при проверке существующего пользователя: select error\"\u001b[39m\nReceived message:   \u001b[31m\"Cannot read properties of undefined (reading 'select')\"\u001b[39m\n\n    \u001b[0m \u001b[90m 38 |\u001b[39m         bot_name\u001b[33m,\u001b[39m\n     \u001b[90m 39 |\u001b[39m       }\u001b[33m,\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 40 |\u001b[39m     ])\n     \u001b[90m    |\u001b[39m       \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 41 |\u001b[39m     \u001b[33m.\u001b[39mselect()\n     \u001b[90m 42 |\u001b[39m\n     \u001b[90m 43 |\u001b[39m   \u001b[36mif\u001b[39m (error) {\u001b[0m\n\n      \u001b[2mat \u001b[22msrc/core/supabase/createUser.ts\u001b[2m:40:7\u001b[22m\n      \u001b[2mat \u001b[22mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\n      \u001b[2mat Object.__awaiter (\u001b[22mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\n      \u001b[2mat __awaiter (\u001b[22msrc/core/supabase/createUser.ts\u001b[2m:19:22)\u001b[22m\n      \u001b[2mat Object.<anonymous> (\u001b[22m__tests__/core/supabase/createUser.test.ts\u001b[2m:75:18)\u001b[22m\n      \u001b[2mat \u001b[22m__tests__/core/supabase/createUser.test.ts\u001b[2m:7:71\u001b[22m\n      \u001b[2mat Object.<anonymous>.__awaiter (\u001b[22m__tests__/core/supabase/createUser.test.ts\u001b[2m:3:12)\u001b[22m\n      \u001b[2mat Object.<anonymous> (\u001b[22m__tests__/core/supabase/createUser.test.ts\u001b[2m:71:57)\u001b[22m\n    at Object.toThrow (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:75:48)\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:7:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:3:12)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:71:57)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"createUser throws if existing user select fails","status":"failed","title":"throws if existing user select fails"},{"ancestorTitles":["createUser"],"duration":1,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'select')\n    at /Users/playra/999-multibots-telegraf/src/core/supabase/createUser.ts:40:7\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at __awaiter (/Users/playra/999-multibots-telegraf/src/core/supabase/createUser.ts:19:22)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:84:26)\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:7:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:3:12)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:78:69)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"createUser updates existing user when found without inviter","status":"failed","title":"updates existing user when found without inviter"},{"ancestorTitles":["createUser"],"duration":2,"failureMessages":["TypeError: supabase_1.supabase.from(...).insert(...).select is not a function\n    at select (/Users/playra/999-multibots-telegraf/src/core/supabase/createUser.ts:41:6)\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at __awaiter (/Users/playra/999-multibots-telegraf/src/core/supabase/createUser.ts:19:22)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:93:26)\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:7:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:3:12)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:90:53)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"createUser inserts new user when not exists","status":"failed","title":"inserts new user when not exists"},{"ancestorTitles":["createUser"],"duration":5,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected substring: \u001b[32m\"Ошибка при обновлении пользователя: upd error\"\u001b[39m\nReceived message:   \u001b[31m\"Cannot read properties of undefined (reading 'select')\"\u001b[39m\n\n    \u001b[0m \u001b[90m 38 |\u001b[39m         bot_name\u001b[33m,\u001b[39m\n     \u001b[90m 39 |\u001b[39m       }\u001b[33m,\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 40 |\u001b[39m     ])\n     \u001b[90m    |\u001b[39m       \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 41 |\u001b[39m     \u001b[33m.\u001b[39mselect()\n     \u001b[90m 42 |\u001b[39m\n     \u001b[90m 43 |\u001b[39m   \u001b[36mif\u001b[39m (error) {\u001b[0m\n\n      \u001b[2mat \u001b[22msrc/core/supabase/createUser.ts\u001b[2m:40:7\u001b[22m\n      \u001b[2mat \u001b[22mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\n      \u001b[2mat Object.__awaiter (\u001b[22mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\n      \u001b[2mat __awaiter (\u001b[22msrc/core/supabase/createUser.ts\u001b[2m:19:22)\u001b[22m\n      \u001b[2mat Object.<anonymous> (\u001b[22m__tests__/core/supabase/createUser.test.ts\u001b[2m:103:18)\u001b[22m\n      \u001b[2mat \u001b[22m__tests__/core/supabase/createUser.test.ts\u001b[2m:7:71\u001b[22m\n      \u001b[2mat Object.<anonymous>.__awaiter (\u001b[22m__tests__/core/supabase/createUser.test.ts\u001b[2m:3:12)\u001b[22m\n      \u001b[2mat Object.<anonymous> (\u001b[22m__tests__/core/supabase/createUser.test.ts\u001b[2m:98:43)\u001b[22m\n    at Object.toThrow (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:103:48)\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:7:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:3:12)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:98:43)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"createUser throws on update error","status":"failed","title":"throws on update error"},{"ancestorTitles":["createUser"],"duration":2,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected substring: \u001b[32m\"Ошибка при добавлении пользователя: ins error\"\u001b[39m\nReceived message:   \u001b[31m\"supabase_1.supabase.from(...).insert(...).select is not a function\"\u001b[39m\n\n    \u001b[0m \u001b[90m 39 |\u001b[39m       }\u001b[33m,\u001b[39m\n     \u001b[90m 40 |\u001b[39m     ])\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 41 |\u001b[39m     \u001b[33m.\u001b[39mselect()\n     \u001b[90m    |\u001b[39m      \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 42 |\u001b[39m\n     \u001b[90m 43 |\u001b[39m   \u001b[36mif\u001b[39m (error) {\n     \u001b[90m 44 |\u001b[39m     console\u001b[33m.\u001b[39merror(\u001b[32m'Error creating user:'\u001b[39m\u001b[33m,\u001b[39m error)\u001b[0m\n\n      \u001b[2mat select (\u001b[22msrc/core/supabase/createUser.ts\u001b[2m:41:6)\u001b[22m\n      \u001b[2mat \u001b[22mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\n      \u001b[2mat Object.__awaiter (\u001b[22mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\n      \u001b[2mat __awaiter (\u001b[22msrc/core/supabase/createUser.ts\u001b[2m:19:22)\u001b[22m\n      \u001b[2mat Object.<anonymous> (\u001b[22m__tests__/core/supabase/createUser.test.ts\u001b[2m:110:18)\u001b[22m\n      \u001b[2mat \u001b[22m__tests__/core/supabase/createUser.test.ts\u001b[2m:7:71\u001b[22m\n      \u001b[2mat Object.<anonymous>.__awaiter (\u001b[22m__tests__/core/supabase/createUser.test.ts\u001b[2m:3:12)\u001b[22m\n      \u001b[2mat Object.<anonymous> (\u001b[22m__tests__/core/supabase/createUser.test.ts\u001b[2m:106:43)\u001b[22m\n    at Object.toThrow (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:110:48)\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:7:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:3:12)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:106:43)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"createUser throws on insert error","status":"failed","title":"throws on insert error"}]},{"numFailingTests":1,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171897156,"runtime":24,"slow":false,"start":1745171897132},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/config/debugEnvLoading.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mconfig/index debug .env loading › logs found .env files and load attempts\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32m\"[CONFIG] Found .env files: .env, .env.local, file.txt\"\u001b[39m\n    Received\n           1: \u001b[31m\"--- Debugging .env loading --- \"\u001b[39m\n           2: \u001b[31m\"[CONFIG] Current Working Directory: /Users/playra/999-multibots-telegraf\"\u001b[39m\n           3: \u001b[31m\"[CONFIG] Attempting to load primary env file from: /Users/playra/999-multibots-telegraf/.env\"\u001b[39m\n\n    Number of calls: \u001b[31m16\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 37 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 38 |\u001b[39m   it(\u001b[32m'logs found .env files and load attempts'\u001b[39m\u001b[33m,\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 39 |\u001b[39m     expect(logSpy)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                    \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 40 |\u001b[39m       \u001b[32m`[CONFIG] Found .env files: .env, .env.local, file.txt`\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 41 |\u001b[39m     )\u001b[22m\n\u001b[2m     \u001b[90m 42 |\u001b[39m     expect(logSpy)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/config/debugEnvLoading.test.ts\u001b[39m\u001b[0m\u001b[2m:39:20)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["config/index debug .env loading"],"duration":3,"failureMessages":[],"fullName":"config/index debug .env loading logs debug header and working directory","status":"passed","title":"logs debug header and working directory"},{"ancestorTitles":["config/index debug .env loading"],"duration":0,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m\"[CONFIG] Found .env files: .env, .env.local, file.txt\"\u001b[39m\nReceived\n       1: \u001b[31m\"--- Debugging .env loading --- \"\u001b[39m\n       2: \u001b[31m\"[CONFIG] Current Working Directory: /Users/playra/999-multibots-telegraf\"\u001b[39m\n       3: \u001b[31m\"[CONFIG] Attempting to load primary env file from: /Users/playra/999-multibots-telegraf/.env\"\u001b[39m\n\nNumber of calls: \u001b[31m16\u001b[39m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/config/debugEnvLoading.test.ts:39:20)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"config/index debug .env loading logs found .env files and load attempts","status":"failed","title":"logs found .env files and load attempts"},{"ancestorTitles":["config/index debug .env loading"],"duration":1,"failureMessages":[],"fullName":"config/index debug .env loading does not log errors when .env parsed","status":"passed","title":"does not log errors when .env parsed"}]},{"numFailingTests":1,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171897160,"runtime":22,"slow":false,"start":1745171897138},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getAspectRatio.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mgetAspectRatio › returns null when single throws\u001b[39m\u001b[22m\n\n    exception\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 30 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 31 |\u001b[39m   it(\u001b[32m'returns null when single throws'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 32 |\u001b[39m     mockSingle\u001b[33m.\u001b[39mmockRejectedValue(\u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(\u001b[32m'exception'\u001b[39m))\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                  \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 33 |\u001b[39m     \u001b[36mconst\u001b[39m result \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m getAspectRatio(\u001b[35m0\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 34 |\u001b[39m     expect(result)\u001b[33m.\u001b[39mtoBeNull()\u001b[22m\n\u001b[2m     \u001b[90m 35 |\u001b[39m   })\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/getAspectRatio.test.ts\u001b[39m\u001b[0m\u001b[2m:32:34\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.__awaiter (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/getAspectRatio.test.ts\u001b[39m\u001b[0m\u001b[2m:31:52)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["getAspectRatio"],"duration":0,"failureMessages":[],"fullName":"getAspectRatio returns aspect_ratio when data exists and no error","status":"passed","title":"returns aspect_ratio when data exists and no error"},{"ancestorTitles":["getAspectRatio"],"duration":1,"failureMessages":[],"fullName":"getAspectRatio returns null when supabase returns error","status":"passed","title":"returns null when supabase returns error"},{"ancestorTitles":["getAspectRatio"],"duration":1,"failureMessages":["Error: exception\n    at /Users/playra/999-multibots-telegraf/__tests__/core/supabase/getAspectRatio.test.ts:32:34\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getAspectRatio.test.ts:31:52)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"getAspectRatio returns null when single throws","status":"failed","title":"returns null when single throws"}]},{"numFailingTests":1,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171897260,"runtime":92,"slow":false,"start":1745171897168},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/config/index.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1msrc/config/index.ts › exports correct default flags and constants\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\n    Expected: \u001b[32mfalse\u001b[39m\n    Received: \u001b[31mtrue\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m  9 |\u001b[39m     expect(config\u001b[33m.\u001b[39misDev)\u001b[33m.\u001b[39mtoBe(\u001b[36mfalse\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 10 |\u001b[39m     \u001b[90m// Credentials flag false when not set\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 11 |\u001b[39m     expect(config\u001b[33m.\u001b[39m\u001b[33mCREDENTIALS\u001b[39m)\u001b[33m.\u001b[39mtoBe(\u001b[36mfalse\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 12 |\u001b[39m     \u001b[90m// Supabase configured flag false without env vars\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 13 |\u001b[39m     expect(config\u001b[33m.\u001b[39misSupabaseConfigured)\u001b[33m.\u001b[39mtoBe(\u001b[36mfalse\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 14 |\u001b[39m     \u001b[90m// NODE_ENV should reflect process.env.NODE_ENV (undefined => undefined)\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/config/index.test.ts\u001b[39m\u001b[0m\u001b[2m:11:32)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["src/config/index.ts"],"duration":49,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32mfalse\u001b[39m\nReceived: \u001b[31mtrue\u001b[39m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/config/index.test.ts:11:32)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"src/config/index.ts exports correct default flags and constants","status":"failed","title":"exports correct default flags and constants"}]},{"numFailingTests":2,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171897254,"runtime":112,"slow":false,"start":1745171897142},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/bot/moduleLoad.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mcore/bot module load › initializes correctly in production environment\u001b[39m\u001b[22m\n\n    TypeError: Cannot read properties of undefined (reading 'error')\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 14 |\u001b[39m \u001b[36mconst\u001b[39m loadResult \u001b[33m=\u001b[39m config({ path\u001b[33m:\u001b[39m envPath })\u001b[22m\n\u001b[2m     \u001b[90m 15 |\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 16 |\u001b[39m \u001b[36mif\u001b[39m (loadResult\u001b[33m.\u001b[39merror) {\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 17 |\u001b[39m   console\u001b[33m.\u001b[39merror(\u001b[22m\n\u001b[2m     \u001b[90m 18 |\u001b[39m     \u001b[32m`[CONFIG] CRITICAL ERROR: Failed to load primary .env file from ${envPath}. Error: ${loadResult.error.message}`\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 19 |\u001b[39m   )\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.error (\u001b[22m\u001b[2msrc/config/index.ts\u001b[2m:16:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/core/bot/index.ts\u001b[2m:5:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/bot/moduleLoad.test.ts\u001b[39m\u001b[0m\u001b[2m:44:9)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mcore/bot module load › initializes correctly in non-production environment\u001b[39m\u001b[22m\n\n    TypeError: Cannot read properties of undefined (reading 'error')\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 14 |\u001b[39m \u001b[36mconst\u001b[39m loadResult \u001b[33m=\u001b[39m config({ path\u001b[33m:\u001b[39m envPath })\u001b[22m\n\u001b[2m     \u001b[90m 15 |\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 16 |\u001b[39m \u001b[36mif\u001b[39m (loadResult\u001b[33m.\u001b[39merror) {\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 17 |\u001b[39m   console\u001b[33m.\u001b[39merror(\u001b[22m\n\u001b[2m     \u001b[90m 18 |\u001b[39m     \u001b[32m`[CONFIG] CRITICAL ERROR: Failed to load primary .env file from ${envPath}. Error: ${loadResult.error.message}`\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 19 |\u001b[39m   )\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.error (\u001b[22m\u001b[2msrc/config/index.ts\u001b[2m:16:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.require (\u001b[22m\u001b[2msrc/core/bot/index.ts\u001b[2m:5:1)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/bot/moduleLoad.test.ts\u001b[39m\u001b[0m\u001b[2m:73:34)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["core/bot module load"],"duration":10,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'error')\n    at Object.error (/Users/playra/999-multibots-telegraf/src/config/index.ts:16:16)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/core/bot/index.ts:5:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/bot/moduleLoad.test.ts:44:9)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"core/bot module load initializes correctly in production environment","status":"failed","title":"initializes correctly in production environment"},{"ancestorTitles":["core/bot module load"],"duration":3,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'error')\n    at Object.error (/Users/playra/999-multibots-telegraf/src/config/index.ts:16:16)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playra/999-multibots-telegraf/src/core/bot/index.ts:5:1)\n    at Runtime._execModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/bot/moduleLoad.test.ts:73:34)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"core/bot module load initializes correctly in non-production environment","status":"failed","title":"initializes correctly in non-production environment"}]},{"numFailingTests":1,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171897741,"runtime":470,"slow":false,"start":1745171897271},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/price/models/imageModelPrices.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mimageModelPrices mapping › contains pro model with correct costPerImage\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoHaveProperty\u001b[2m(\u001b[22m\u001b[32mpath\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected path: \u001b[32m\"black-forest-labs/flux-1.1-pro\"\u001b[39m\n    Received path: \u001b[31m[]\u001b[39m\n\n    Received value: \u001b[31m{\"black-forest-labs/flux-1.1-pro\": [Object], \"black-forest-labs/flux-1.1-pro-ultra\": [Object], \"black-forest-labs/flux-canny-dev\": [Object], \"black-forest-labs/flux-canny-pro\": [Object], \"black-forest-labs/flux-depth-dev\": [Object], \"black-forest-labs/flux-depth-pro\": [Object], \"black-forest-labs/flux-dev\": [Object], \"black-forest-labs/flux-dev-lora\": [Object], \"black-forest-labs/flux-fill-dev\": [Object], \"black-forest-labs/flux-fill-pro\": [Object], \"black-forest-labs/flux-pro\": [Object], \"black-forest-labs/flux-redux-dev\": [Object], \"black-forest-labs/flux-redux-schnell\": [Object], \"black-forest-labs/flux-schnell\": [Object], \"black-forest-labs/flux-schnell-lora\": [Object], \"ideogram-ai/ideogram-v2\": [Object], \"ideogram-ai/ideogram-v2-turbo\": [Object], \"luma/photon\": [Object], \"luma/photon-flash\": [Object], \"recraft-ai/recraft-20b\": [Object], \"recraft-ai/recraft-20b-svg\": [Object], \"recraft-ai/recraft-v3\": [Object], \"recraft-ai/recraft-v3-svg\": [Object], \"stability-ai/stable-diffusion-3\": [Object], \"stability-ai/stable-diffusion-3.5-large\": [Object], \"stability-ai/stable-diffusion-3.5-large-turbo\": [Object], \"stability-ai/stable-diffusion-3.5-medium\": [Object]}\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m  5 |\u001b[39m   it(\u001b[32m'contains pro model with correct costPerImage'\u001b[39m\u001b[33m,\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[22m\n\u001b[2m     \u001b[90m  6 |\u001b[39m     \u001b[36mconst\u001b[39m key \u001b[33m=\u001b[39m \u001b[32m'black-forest-labs/flux-1.1-pro'\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m  7 |\u001b[39m     expect(imageModelPrices)\u001b[33m.\u001b[39mtoHaveProperty(key)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                              \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m  8 |\u001b[39m     \u001b[36mconst\u001b[39m info \u001b[33m=\u001b[39m imageModelPrices[key]\u001b[22m\n\u001b[2m     \u001b[90m  9 |\u001b[39m     expect(info\u001b[33m.\u001b[39mcostPerImage)\u001b[33m.\u001b[39mtoBe(\u001b[22m\n\u001b[2m     \u001b[90m 10 |\u001b[39m       calculateFinalImageCostInStars(\u001b[35m0.04\u001b[39m)\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/price/models/imageModelPrices.test.ts\u001b[39m\u001b[0m\u001b[2m:7:30)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["imageModelPrices mapping"],"duration":121,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoHaveProperty\u001b[2m(\u001b[22m\u001b[32mpath\u001b[39m\u001b[2m)\u001b[22m\n\nExpected path: \u001b[32m\"black-forest-labs/flux-1.1-pro\"\u001b[39m\nReceived path: \u001b[31m[]\u001b[39m\n\nReceived value: \u001b[31m{\"black-forest-labs/flux-1.1-pro\": [Object], \"black-forest-labs/flux-1.1-pro-ultra\": [Object], \"black-forest-labs/flux-canny-dev\": [Object], \"black-forest-labs/flux-canny-pro\": [Object], \"black-forest-labs/flux-depth-dev\": [Object], \"black-forest-labs/flux-depth-pro\": [Object], \"black-forest-labs/flux-dev\": [Object], \"black-forest-labs/flux-dev-lora\": [Object], \"black-forest-labs/flux-fill-dev\": [Object], \"black-forest-labs/flux-fill-pro\": [Object], \"black-forest-labs/flux-pro\": [Object], \"black-forest-labs/flux-redux-dev\": [Object], \"black-forest-labs/flux-redux-schnell\": [Object], \"black-forest-labs/flux-schnell\": [Object], \"black-forest-labs/flux-schnell-lora\": [Object], \"ideogram-ai/ideogram-v2\": [Object], \"ideogram-ai/ideogram-v2-turbo\": [Object], \"luma/photon\": [Object], \"luma/photon-flash\": [Object], \"recraft-ai/recraft-20b\": [Object], \"recraft-ai/recraft-20b-svg\": [Object], \"recraft-ai/recraft-v3\": [Object], \"recraft-ai/recraft-v3-svg\": [Object], \"stability-ai/stable-diffusion-3\": [Object], \"stability-ai/stable-diffusion-3.5-large\": [Object], \"stability-ai/stable-diffusion-3.5-large-turbo\": [Object], \"stability-ai/stable-diffusion-3.5-medium\": [Object]}\u001b[39m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/price/models/imageModelPrices.test.ts:7:30)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"imageModelPrices mapping contains pro model with correct costPerImage","status":"failed","title":"contains pro model with correct costPerImage"},{"ancestorTitles":["imageModelPrices mapping"],"duration":32,"failureMessages":[],"fullName":"imageModelPrices mapping contains ultra pro model with correct cost","status":"passed","title":"contains ultra pro model with correct cost"}]},{"numFailingTests":1,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171897855,"runtime":687,"slow":false,"start":1745171897168},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/bot/index.error.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mcore/bot index environment validation › throws error if BOT_TOKEN_TEST_2 is not set\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected substring: \u001b[32m\"BOT_TOKEN_TEST_2 is not set\"\u001b[39m\n    Received message:   \u001b[31m\"Cannot read properties of undefined (reading 'error')\"\u001b[39m\n\n        \u001b[0m \u001b[90m 14 |\u001b[39m \u001b[36mconst\u001b[39m loadResult \u001b[33m=\u001b[39m config({ path\u001b[33m:\u001b[39m envPath })\n         \u001b[90m 15 |\u001b[39m\n        \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 16 |\u001b[39m \u001b[36mif\u001b[39m (loadResult\u001b[33m.\u001b[39merror) {\n         \u001b[90m    |\u001b[39m                \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n         \u001b[90m 17 |\u001b[39m   console\u001b[33m.\u001b[39merror(\n         \u001b[90m 18 |\u001b[39m     \u001b[32m`[CONFIG] CRITICAL ERROR: Failed to load primary .env file from ${envPath}. Error: ${loadResult.error.message}`\u001b[39m\n         \u001b[90m 19 |\u001b[39m   )\u001b[0m\n\n          \u001b[2mat Object.error (\u001b[22msrc/config/index.ts\u001b[2m:16:16)\u001b[22m\n          \u001b[2mat Object.require (\u001b[22msrc/core/bot/index.ts\u001b[2m:5:1)\u001b[22m\n          \u001b[2mat \u001b[22m__tests__/core/bot/index.error.test.ts\u001b[2m:26:9\u001b[22m\n          \u001b[2mat \u001b[22m__tests__/core/bot/index.error.test.ts\u001b[2m:25:12\u001b[22m\n          \u001b[2mat Object.<anonymous> (\u001b[22mnode_modules/.pnpm/expect@29.7.0/node_modules/expect/build/toThrowMatchers.js\u001b[2m:74:11)\u001b[22m\n          \u001b[2mat Object.throwingMatcher [as toThrow] (\u001b[22mnode_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js\u001b[2m:320:21)\u001b[22m\n          \u001b[2mat Object.<anonymous> (\u001b[22m__tests__/core/bot/index.error.test.ts\u001b[2m:28:8)\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 26 |\u001b[39m         require(\u001b[32m'@/core/bot'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 27 |\u001b[39m       })\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 28 |\u001b[39m     })\u001b[33m.\u001b[39mtoThrow(\u001b[32m'BOT_TOKEN_TEST_2 is not set'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m        \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 29 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 30 |\u001b[39m })\u001b[22m\n\u001b[2m     \u001b[90m 31 |\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/bot/index.error.test.ts\u001b[39m\u001b[0m\u001b[2m:28:8)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["core/bot index environment validation"],"duration":536,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected substring: \u001b[32m\"BOT_TOKEN_TEST_2 is not set\"\u001b[39m\nReceived message:   \u001b[31m\"Cannot read properties of undefined (reading 'error')\"\u001b[39m\n\n    \u001b[0m \u001b[90m 14 |\u001b[39m \u001b[36mconst\u001b[39m loadResult \u001b[33m=\u001b[39m config({ path\u001b[33m:\u001b[39m envPath })\n     \u001b[90m 15 |\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 16 |\u001b[39m \u001b[36mif\u001b[39m (loadResult\u001b[33m.\u001b[39merror) {\n     \u001b[90m    |\u001b[39m                \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 17 |\u001b[39m   console\u001b[33m.\u001b[39merror(\n     \u001b[90m 18 |\u001b[39m     \u001b[32m`[CONFIG] CRITICAL ERROR: Failed to load primary .env file from ${envPath}. Error: ${loadResult.error.message}`\u001b[39m\n     \u001b[90m 19 |\u001b[39m   )\u001b[0m\n\n      \u001b[2mat Object.error (\u001b[22msrc/config/index.ts\u001b[2m:16:16)\u001b[22m\n      \u001b[2mat Object.require (\u001b[22msrc/core/bot/index.ts\u001b[2m:5:1)\u001b[22m\n      \u001b[2mat \u001b[22m__tests__/core/bot/index.error.test.ts\u001b[2m:26:9\u001b[22m\n      \u001b[2mat \u001b[22m__tests__/core/bot/index.error.test.ts\u001b[2m:25:12\u001b[22m\n      \u001b[2mat Object.<anonymous> (\u001b[22mnode_modules/.pnpm/expect@29.7.0/node_modules/expect/build/toThrowMatchers.js\u001b[2m:74:11)\u001b[22m\n      \u001b[2mat Object.throwingMatcher [as toThrow] (\u001b[22mnode_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js\u001b[2m:320:21)\u001b[22m\n      \u001b[2mat Object.<anonymous> (\u001b[22m__tests__/core/bot/index.error.test.ts\u001b[2m:28:8)\u001b[22m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/bot/index.error.test.ts:28:8)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"core/bot index environment validation throws error if BOT_TOKEN_TEST_2 is not set","status":"failed","title":"throws error if BOT_TOKEN_TEST_2 is not set"}]},{"numFailingTests":1,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171897944,"runtime":589,"slow":false,"start":1745171897355},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/middlewares/checkSubscription.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mcheckSubscription › returns true for member statuses\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32m\"@mychannel\"\u001b[39m, \u001b[32m123\u001b[39m\n    Received: \u001b[31m\"mychannel\"\u001b[39m, \u001b[2m123\u001b[22m\n\n    Number of calls: \u001b[31m1\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 15 |\u001b[39m     \u001b[33m;\u001b[39m(ctx\u001b[33m.\u001b[39mtelegram\u001b[33m.\u001b[39mgetChatMember \u001b[36mas\u001b[39m jest\u001b[33m.\u001b[39m\u001b[33mMock\u001b[39m)\u001b[33m.\u001b[39mmockResolvedValue({ status\u001b[33m:\u001b[39m \u001b[32m'member'\u001b[39m })\u001b[22m\n\u001b[2m     \u001b[90m 16 |\u001b[39m     \u001b[36mawait\u001b[39m expect(checkSubscription(ctx\u001b[33m,\u001b[39m channel))\u001b[33m.\u001b[39mresolves\u001b[33m.\u001b[39mtoBe(\u001b[36mtrue\u001b[39m)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 17 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mtelegram\u001b[33m.\u001b[39mgetChatMember)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[32m'@mychannel'\u001b[39m\u001b[33m,\u001b[39m \u001b[35m123\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                        \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 18 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 19 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 20 |\u001b[39m   it(\u001b[32m'returns false for non-member statuses'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/middlewares/checkSubscription.test.ts\u001b[39m\u001b[0m\u001b[2m:17:40\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["checkSubscription"],"duration":129,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m\"@mychannel\"\u001b[39m, \u001b[32m123\u001b[39m\nReceived: \u001b[31m\"mychannel\"\u001b[39m, \u001b[2m123\u001b[22m\n\nNumber of calls: \u001b[31m1\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/middlewares/checkSubscription.test.ts:17:40\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"checkSubscription returns true for member statuses","status":"failed","title":"returns true for member statuses"},{"ancestorTitles":["checkSubscription"],"duration":4,"failureMessages":[],"fullName":"checkSubscription returns false for non-member statuses","status":"passed","title":"returns false for non-member statuses"},{"ancestorTitles":["checkSubscription"],"duration":5,"failureMessages":[],"fullName":"checkSubscription throws error when from.id undefined","status":"passed","title":"throws error when from.id undefined"},{"ancestorTitles":["checkSubscription"],"duration":8,"failureMessages":[],"fullName":"checkSubscription propagates error from getChatMember","status":"passed","title":"propagates error from getChatMember"}]},{"numFailingTests":1,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171897942,"runtime":58,"slow":false,"start":1745171897884},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/config/prod.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mconfig production logging block › logs token existence and supabase warning in production\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32m\"BOT_TOKEN_1 exists:\"\u001b[39m, \u001b[32mfalse\u001b[39m\n    Received\n           1: \u001b[31m\"--- Debugging .env loading --- \"\u001b[39m\n           2: \u001b[31m\"[CONFIG] Current Working Directory: /Users/playra/999-multibots-telegraf\"\u001b[39m\n           3: \u001b[31m\"[CONFIG] Attempting to load primary env file from: /Users/playra/999-multibots-telegraf/.env\"\u001b[39m\n\n    Number of calls: \u001b[31m19\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 29 |\u001b[39m     expect(logSpy)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[32m'Bot tokens check in ENV:'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 30 |\u001b[39m     \u001b[90m// Should log existence of BOT_TOKEN_1 (undefined => false)\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 31 |\u001b[39m     expect(logSpy)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[32m'BOT_TOKEN_1 exists:'\u001b[39m\u001b[33m,\u001b[39m \u001b[36mfalse\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                    \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 32 |\u001b[39m     \u001b[90m// Should warn about missing Supabase config\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 33 |\u001b[39m     expect(warnSpy)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[22m\n\u001b[2m     \u001b[90m 34 |\u001b[39m       \u001b[32m'⚠️ ВНИМАНИЕ: Не настроены параметры Supabase. Боты будут загружены из переменных окружения.'\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/config/prod.test.ts\u001b[39m\u001b[0m\u001b[2m:31:20)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["config production logging block"],"duration":7,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m\"BOT_TOKEN_1 exists:\"\u001b[39m, \u001b[32mfalse\u001b[39m\nReceived\n       1: \u001b[31m\"--- Debugging .env loading --- \"\u001b[39m\n       2: \u001b[31m\"[CONFIG] Current Working Directory: /Users/playra/999-multibots-telegraf\"\u001b[39m\n       3: \u001b[31m\"[CONFIG] Attempting to load primary env file from: /Users/playra/999-multibots-telegraf/.env\"\u001b[39m\n\nNumber of calls: \u001b[31m19\u001b[39m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/config/prod.test.ts:31:20)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"config production logging block logs token existence and supabase warning in production","status":"failed","title":"logs token existence and supabase warning in production"}]},{"numFailingTests":1,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171897942,"runtime":91,"slow":false,"start":1745171897851},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/utils/url.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1murlJoin › skips empty or falsy segments\u001b[39m\u001b[22m\n\n    TypeError: Cannot read properties of null (reading 'startsWith')\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 20 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 21 |\u001b[39m       \u001b[90m// Удаляем начальный слеш, если он есть\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 22 |\u001b[39m       \u001b[36mif\u001b[39m (normalizedPath\u001b[33m.\u001b[39mstartsWith(\u001b[32m'/'\u001b[39m)) {\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                          \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 23 |\u001b[39m         normalizedPath \u001b[33m=\u001b[39m normalizedPath\u001b[33m.\u001b[39mslice(\u001b[35m1\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 24 |\u001b[39m       }\u001b[22m\n\u001b[2m     \u001b[90m 25 |\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat startsWith (\u001b[22m\u001b[2msrc/utils/url.ts\u001b[2m:22:26)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m          at Array.map (<anonymous>)\u001b[22m\n\u001b[2m      \u001b[2mat map (\u001b[22m\u001b[2msrc/utils/url.ts\u001b[2m:17:6)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/utils/url.test.ts\u001b[39m\u001b[0m\u001b[2m:15:19)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["urlJoin"],"duration":1,"failureMessages":[],"fullName":"urlJoin joins base URL and paths without extra slashes","status":"passed","title":"joins base URL and paths without extra slashes"},{"ancestorTitles":["urlJoin"],"duration":0,"failureMessages":[],"fullName":"urlJoin returns base URL when no paths provided","status":"passed","title":"returns base URL when no paths provided"},{"ancestorTitles":["urlJoin"],"duration":0,"failureMessages":["TypeError: Cannot read properties of null (reading 'startsWith')\n    at startsWith (/Users/playra/999-multibots-telegraf/src/utils/url.ts:22:26)\n    at Array.map (<anonymous>)\n    at map (/Users/playra/999-multibots-telegraf/src/utils/url.ts:17:6)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/utils/url.test.ts:15:19)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"urlJoin skips empty or falsy segments","status":"failed","title":"skips empty or falsy segments"}]},{"numFailingTests":2,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171898186,"runtime":203,"slow":false,"start":1745171897983},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getLatestUserModel.unit.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mgetLatestUserModel › returns null on error\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    \u001b[32m- Expected\u001b[39m\n    \u001b[31m+ Received\u001b[39m\n\n      \u001b[2m\"Error getting user model:\"\u001b[22m,\n    \u001b[32m- Object {\u001b[39m\n    \u001b[32m-   \"message\": \"err\",\u001b[39m\n    \u001b[32m- }\u001b[39m\n    \u001b[31m+ [TypeError: supabase_1.supabase.from(...).select(...).eq is not a function]\u001b[39m,\n\n    Number of calls: \u001b[31m1\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 19 |\u001b[39m     \u001b[36mconst\u001b[39m result \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m getLatestUserModel(telegram_id\u001b[33m,\u001b[39m api)\u001b[22m\n\u001b[2m     \u001b[90m 20 |\u001b[39m     expect(result)\u001b[33m.\u001b[39mtoBeNull()\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 21 |\u001b[39m     expect(consoleErrorSpy)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[32m'Error getting user model:'\u001b[39m\u001b[33m,\u001b[39m { message\u001b[33m:\u001b[39m \u001b[32m'err'\u001b[39m })\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                             \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 22 |\u001b[39m     consoleErrorSpy\u001b[33m.\u001b[39mmockRestore()\u001b[22m\n\u001b[2m     \u001b[90m 23 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 24 |\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/getLatestUserModel.unit.test.ts\u001b[39m\u001b[0m\u001b[2m:21:29\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mgetLatestUserModel › returns data on success\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n    Expected: \u001b[32m{\"api\": \"apiX\", \"id\": \"x\", \"status\": \"SUCCESS\", \"telegram_id\": 10}\u001b[39m\n    Received: \u001b[31mnull\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 30 |\u001b[39m     \u001b[36mconst\u001b[39m consoleLogSpy \u001b[33m=\u001b[39m jest\u001b[33m.\u001b[39mspyOn(console\u001b[33m,\u001b[39m \u001b[32m'log'\u001b[39m)\u001b[33m.\u001b[39mmockImplementation(() \u001b[33m=>\u001b[39m {})\u001b[22m\n\u001b[2m     \u001b[90m 31 |\u001b[39m     \u001b[36mconst\u001b[39m result \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m getLatestUserModel(telegram_id\u001b[33m,\u001b[39m api)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 32 |\u001b[39m     expect(result)\u001b[33m.\u001b[39mtoEqual(modelTraining)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                    \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 33 |\u001b[39m     expect(consoleLogSpy)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(modelTraining\u001b[33m,\u001b[39m \u001b[32m'getLatestUserModel'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 34 |\u001b[39m     consoleLogSpy\u001b[33m.\u001b[39mmockRestore()\u001b[22m\n\u001b[2m     \u001b[90m 35 |\u001b[39m   })\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/getLatestUserModel.unit.test.ts\u001b[39m\u001b[0m\u001b[2m:32:20\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["getLatestUserModel"],"duration":3,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n\u001b[32m- Expected\u001b[39m\n\u001b[31m+ Received\u001b[39m\n\n  \u001b[2m\"Error getting user model:\"\u001b[22m,\n\u001b[32m- Object {\u001b[39m\n\u001b[32m-   \"message\": \"err\",\u001b[39m\n\u001b[32m- }\u001b[39m\n\u001b[31m+ [TypeError: supabase_1.supabase.from(...).select(...).eq is not a function]\u001b[39m,\n\nNumber of calls: \u001b[31m1\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/core/supabase/getLatestUserModel.unit.test.ts:21:29\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"getLatestUserModel returns null on error","status":"failed","title":"returns null on error"},{"ancestorTitles":["getLatestUserModel"],"duration":1,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\nExpected: \u001b[32m{\"api\": \"apiX\", \"id\": \"x\", \"status\": \"SUCCESS\", \"telegram_id\": 10}\u001b[39m\nReceived: \u001b[31mnull\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/core/supabase/getLatestUserModel.unit.test.ts:32:20\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"getLatestUserModel returns data on success","status":"failed","title":"returns data on success"},{"ancestorTitles":["getLatestUserModel"],"duration":0,"failureMessages":[],"fullName":"getLatestUserModel returns null on exception","status":"passed","title":"returns null on exception"}]},{"numFailingTests":1,"numPassingTests":5,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171898249,"runtime":147,"slow":false,"start":1745171898102},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/price/discount.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mcalculateDiscountedPrice and constants › applies 50% discount correctly\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\n    Expected: \u001b[32m50\u001b[39m\n    Received: \u001b[31m51\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 13 |\u001b[39m   it(\u001b[32m'applies 50% discount correctly'\u001b[39m\u001b[33m,\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[22m\n\u001b[2m     \u001b[90m 14 |\u001b[39m     expect(calculateDiscountedPrice(\u001b[35m200\u001b[39m\u001b[33m,\u001b[39m \u001b[35m50\u001b[39m))\u001b[33m.\u001b[39mtoBe(\u001b[35m100\u001b[39m)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 15 |\u001b[39m     expect(calculateDiscountedPrice(\u001b[35m101\u001b[39m\u001b[33m,\u001b[39m \u001b[35m50\u001b[39m))\u001b[33m.\u001b[39mtoBe(\u001b[35m50\u001b[39m) \u001b[90m// 101 * 0.5 = 50.5 -> rounded\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                               \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 16 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 17 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 18 |\u001b[39m   it(\u001b[32m'returns 0 when discount is 100%'\u001b[39m\u001b[33m,\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/price/discount.test.ts\u001b[39m\u001b[0m\u001b[2m:15:47)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["calculateDiscountedPrice and constants"],"duration":1,"failureMessages":[],"fullName":"calculateDiscountedPrice and constants interestRate should be 0.1 and basePrice 100","status":"passed","title":"interestRate should be 0.1 and basePrice 100"},{"ancestorTitles":["calculateDiscountedPrice and constants"],"duration":0,"failureMessages":[],"fullName":"calculateDiscountedPrice and constants applies no discount when discount is 0%","status":"passed","title":"applies no discount when discount is 0%"},{"ancestorTitles":["calculateDiscountedPrice and constants"],"duration":0,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32m50\u001b[39m\nReceived: \u001b[31m51\u001b[39m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/price/discount.test.ts:15:47)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"calculateDiscountedPrice and constants applies 50% discount correctly","status":"failed","title":"applies 50% discount correctly"},{"ancestorTitles":["calculateDiscountedPrice and constants"],"duration":0,"failureMessages":[],"fullName":"calculateDiscountedPrice and constants returns 0 when discount is 100%","status":"passed","title":"returns 0 when discount is 100%"},{"ancestorTitles":["calculateDiscountedPrice and constants"],"duration":0,"failureMessages":[],"fullName":"calculateDiscountedPrice and constants clamps discount below 0 to 0%","status":"passed","title":"clamps discount below 0 to 0%"},{"ancestorTitles":["calculateDiscountedPrice and constants"],"duration":0,"failureMessages":[],"fullName":"calculateDiscountedPrice and constants clamps discount above 100 to 100%","status":"passed","title":"clamps discount above 100 to 100%"}]},{"numFailingTests":1,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171898268,"runtime":289,"slow":false,"start":1745171897979},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getUserData.unit.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mgetUserData › throws error on supabase error\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected substring: \u001b[32m\"Ошибка при получении данных пользователя: [object Object]\"\u001b[39m\n    Received message:   \u001b[31m\"Ошибка при получении данных пользователя: err\"\u001b[39m\n\n        \u001b[0m \u001b[90m 11 |\u001b[39m\n         \u001b[90m 12 |\u001b[39m   \u001b[36mif\u001b[39m (error) {\n        \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 13 |\u001b[39m     \u001b[36mthrow\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(\n         \u001b[90m    |\u001b[39m           \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n         \u001b[90m 14 |\u001b[39m       \u001b[32m`Ошибка при получении данных пользователя: ${error.message}`\u001b[39m\n         \u001b[90m 15 |\u001b[39m     )\n         \u001b[90m 16 |\u001b[39m   }\u001b[0m\n\n          \u001b[2mat \u001b[22msrc/core/supabase/getUserData.ts\u001b[2m:13:11\u001b[22m\n          \u001b[2mat fulfilled (\u001b[22mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 26 |\u001b[39m     \u001b[90m// Мокаем ошибку\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 27 |\u001b[39m     mockMaybeSingle\u001b[33m.\u001b[39mmockResolvedValue({ data\u001b[33m:\u001b[39m \u001b[36mnull\u001b[39m\u001b[33m,\u001b[39m error\u001b[33m:\u001b[39m { message\u001b[33m:\u001b[39m \u001b[32m'err'\u001b[39m } })\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 28 |\u001b[39m     \u001b[36mawait\u001b[39m expect(getUserData(telegram_id))\u001b[33m.\u001b[39mrejects\u001b[33m.\u001b[39mtoThrow(\u001b[32m'Ошибка при получении данных пользователя: [object Object]'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                                    \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 29 |\u001b[39m     \u001b[90m// Проверяем вызовы\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 30 |\u001b[39m     expect(supabase\u001b[33m.\u001b[39m\u001b[36mfrom\u001b[39m)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[32m'users'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 31 |\u001b[39m     expect(mockSelect)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.toThrow (\u001b[22m\u001b[2mnode_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js\u001b[2m:218:22)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/getUserData.unit.test.ts\u001b[39m\u001b[0m\u001b[2m:28:52\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.__awaiter (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/getUserData.unit.test.ts\u001b[39m\u001b[0m\u001b[2m:25:51)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["getUserData"],"duration":21,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mrejects\u001b[2m.\u001b[22mtoThrow\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected substring: \u001b[32m\"Ошибка при получении данных пользователя: [object Object]\"\u001b[39m\nReceived message:   \u001b[31m\"Ошибка при получении данных пользователя: err\"\u001b[39m\n\n    \u001b[0m \u001b[90m 11 |\u001b[39m\n     \u001b[90m 12 |\u001b[39m   \u001b[36mif\u001b[39m (error) {\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 13 |\u001b[39m     \u001b[36mthrow\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(\n     \u001b[90m    |\u001b[39m           \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 14 |\u001b[39m       \u001b[32m`Ошибка при получении данных пользователя: ${error.message}`\u001b[39m\n     \u001b[90m 15 |\u001b[39m     )\n     \u001b[90m 16 |\u001b[39m   }\u001b[0m\n\n      \u001b[2mat \u001b[22msrc/core/supabase/getUserData.ts\u001b[2m:13:11\u001b[22m\n      \u001b[2mat fulfilled (\u001b[22mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\n    at Object.toThrow (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n    at /Users/playra/999-multibots-telegraf/__tests__/core/supabase/getUserData.unit.test.ts:28:52\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getUserData.unit.test.ts:25:51)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"getUserData throws error on supabase error","status":"failed","title":"throws error on supabase error"},{"ancestorTitles":["getUserData"],"duration":1,"failureMessages":[],"fullName":"getUserData returns data when successful","status":"passed","title":"returns data when successful"},{"ancestorTitles":["getUserData"],"duration":0,"failureMessages":[],"fullName":"getUserData returns null when user not found","status":"passed","title":"returns null when user not found"}]},{"numFailingTests":1,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171898343,"runtime":85,"slow":false,"start":1745171898258},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/utils/setBotCommands.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1msetBotCommands › returns true and logs info on successful command setup\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    \u001b[32m- Expected\u001b[39m\n    \u001b[31m+ Received\u001b[39m\n\n    \u001b[33m@@ -5,6 +5,10 @@\u001b[39m\n    \u001b[2m    },\u001b[22m\n    \u001b[2m    Object {\u001b[22m\n    \u001b[2m      \"command\": \"menu\",\u001b[22m\n    \u001b[2m      \"description\": \"👤 Menu / Главное меню\",\u001b[22m\n    \u001b[2m    },\u001b[22m\n    \u001b[31m+   Object {\u001b[39m\n    \u001b[31m+     \"command\": \"support\",\u001b[39m\n    \u001b[31m+     \"description\": \"👤 Support / Техподдержка\",\u001b[39m\n    \u001b[31m+   },\u001b[39m\n    \u001b[2m  ]\u001b[22m,\n\n    Number of calls: \u001b[31m1\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 38 |\u001b[39m     expect(botLogger\u001b[33m.\u001b[39merror)\u001b[33m.\u001b[39mnot\u001b[33m.\u001b[39mtoHaveBeenCalled()\u001b[22m\n\u001b[2m     \u001b[90m 39 |\u001b[39m     \u001b[90m// Verify commands set\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 40 |\u001b[39m     expect(bot\u001b[33m.\u001b[39mtelegram\u001b[33m.\u001b[39msetMyCommands)\u001b[33m.\u001b[39mtoHaveBeenCalledWith([\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                        \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 41 |\u001b[39m       { command\u001b[33m:\u001b[39m \u001b[32m'start'\u001b[39m\u001b[33m,\u001b[39m description\u001b[33m:\u001b[39m \u001b[32m'👤 Start / Начать'\u001b[39m }\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 42 |\u001b[39m       { command\u001b[33m:\u001b[39m \u001b[32m'menu'\u001b[39m\u001b[33m,\u001b[39m description\u001b[33m:\u001b[39m \u001b[32m'👤 Menu / Главное меню'\u001b[39m }\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 43 |\u001b[39m     ])\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/utils/setBotCommands.test.ts\u001b[39m\u001b[0m\u001b[2m:40:40\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["setBotCommands"],"duration":4,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n\u001b[32m- Expected\u001b[39m\n\u001b[31m+ Received\u001b[39m\n\n\u001b[33m@@ -5,6 +5,10 @@\u001b[39m\n\u001b[2m    },\u001b[22m\n\u001b[2m    Object {\u001b[22m\n\u001b[2m      \"command\": \"menu\",\u001b[22m\n\u001b[2m      \"description\": \"👤 Menu / Главное меню\",\u001b[22m\n\u001b[2m    },\u001b[22m\n\u001b[31m+   Object {\u001b[39m\n\u001b[31m+     \"command\": \"support\",\u001b[39m\n\u001b[31m+     \"description\": \"👤 Support / Техподдержка\",\u001b[39m\n\u001b[31m+   },\u001b[39m\n\u001b[2m  ]\u001b[22m,\n\nNumber of calls: \u001b[31m1\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/utils/setBotCommands.test.ts:40:40\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"setBotCommands returns true and logs info on successful command setup","status":"failed","title":"returns true and logs info on successful command setup"},{"ancestorTitles":["setBotCommands"],"duration":0,"failureMessages":[],"fullName":"setBotCommands returns false and logs error when setMyCommands throws","status":"passed","title":"returns false and logs error when setMyCommands throws"},{"ancestorTitles":["setBotCommands"],"duration":4,"failureMessages":[],"fullName":"setBotCommands uses \"unknown\" when botInfo is undefined","status":"passed","title":"uses \"unknown\" when botInfo is undefined"}]},{"numFailingTests":1,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171898383,"runtime":192,"slow":false,"start":1745171898191},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/commands/setCommands.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1msetBotCommands › should set commands and return true on success\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    \u001b[32m- Expected\u001b[39m\n    \u001b[31m+ Received\u001b[39m\n\n    \u001b[33m@@ -5,6 +5,10 @@\u001b[39m\n    \u001b[2m    },\u001b[22m\n    \u001b[2m    Object {\u001b[22m\n    \u001b[2m      \"command\": \"menu\",\u001b[22m\n    \u001b[2m      \"description\": \"👤 Menu / Главное меню\",\u001b[22m\n    \u001b[2m    },\u001b[22m\n    \u001b[31m+   Object {\u001b[39m\n    \u001b[31m+     \"command\": \"support\",\u001b[39m\n    \u001b[31m+     \"description\": \"👤 Support / Техподдержка\",\u001b[39m\n    \u001b[31m+   },\u001b[39m\n    \u001b[2m  ]\u001b[22m,\n\n    Number of calls: \u001b[31m1\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 20 |\u001b[39m   it(\u001b[32m'should set commands and return true on success'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[22m\n\u001b[2m     \u001b[90m 21 |\u001b[39m     \u001b[36mconst\u001b[39m result \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m setBotCommands(mockBot \u001b[36mas\u001b[39m \u001b[33mTelegraf\u001b[39m\u001b[33m<\u001b[39m\u001b[33mMyContext\u001b[39m\u001b[33m>\u001b[39m)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 22 |\u001b[39m     expect(mockBot\u001b[33m.\u001b[39mtelegram\u001b[33m.\u001b[39msetMyCommands)\u001b[33m.\u001b[39mtoHaveBeenCalledWith([\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                            \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 23 |\u001b[39m       { command\u001b[33m:\u001b[39m \u001b[32m'start'\u001b[39m\u001b[33m,\u001b[39m description\u001b[33m:\u001b[39m \u001b[32m'👤 Start / Начать'\u001b[39m }\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 24 |\u001b[39m       { command\u001b[33m:\u001b[39m \u001b[32m'menu'\u001b[39m\u001b[33m,\u001b[39m description\u001b[33m:\u001b[39m \u001b[32m'👤 Menu / Главное меню'\u001b[39m }\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 25 |\u001b[39m     ])\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/commands/setCommands.test.ts\u001b[39m\u001b[0m\u001b[2m:22:44\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["setBotCommands"],"duration":3,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n\u001b[32m- Expected\u001b[39m\n\u001b[31m+ Received\u001b[39m\n\n\u001b[33m@@ -5,6 +5,10 @@\u001b[39m\n\u001b[2m    },\u001b[22m\n\u001b[2m    Object {\u001b[22m\n\u001b[2m      \"command\": \"menu\",\u001b[22m\n\u001b[2m      \"description\": \"👤 Menu / Главное меню\",\u001b[22m\n\u001b[2m    },\u001b[22m\n\u001b[31m+   Object {\u001b[39m\n\u001b[31m+     \"command\": \"support\",\u001b[39m\n\u001b[31m+     \"description\": \"👤 Support / Техподдержка\",\u001b[39m\n\u001b[31m+   },\u001b[39m\n\u001b[2m  ]\u001b[22m,\n\nNumber of calls: \u001b[31m1\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/commands/setCommands.test.ts:22:44\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"setBotCommands should set commands and return true on success","status":"failed","title":"should set commands and return true on success"},{"ancestorTitles":["setBotCommands"],"duration":1,"failureMessages":[],"fullName":"setBotCommands should return false and log error on failure","status":"passed","title":"should return false and log error on failure"}]},{"numFailingTests":2,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171898394,"runtime":105,"slow":false,"start":1745171898289},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getHistory.unit.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mgetHistory › returns empty array on error\u001b[39m\u001b[22m\n\n    TypeError: supabase_1.supabase.from(...).select(...).order(...).limit(...).eq(...).eq is not a function\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 12 |\u001b[39m     \u001b[33m.\u001b[39mlimit(\u001b[35m10\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 13 |\u001b[39m     \u001b[33m.\u001b[39meq(\u001b[32m'brand'\u001b[39m\u001b[33m,\u001b[39m brand)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 14 |\u001b[39m     \u001b[33m.\u001b[39meq(\u001b[32m'command'\u001b[39m\u001b[33m,\u001b[39m command)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m      \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 15 |\u001b[39m     \u001b[33m.\u001b[39meq(\u001b[32m'type'\u001b[39m\u001b[33m,\u001b[39m type)\u001b[22m\n\u001b[2m     \u001b[90m 16 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 17 |\u001b[39m   \u001b[36mif\u001b[39m (error) {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat eq (\u001b[22m\u001b[2msrc/core/supabase/getHistory.ts\u001b[2m:14:6)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.__awaiter (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat __awaiter (\u001b[22m\u001b[2msrc/core/supabase/getHistory.ts\u001b[2m:7:5)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/getHistory.unit.test.ts\u001b[39m\u001b[0m\u001b[2m:26:36\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.__awaiter (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/getHistory.unit.test.ts\u001b[39m\u001b[0m\u001b[2m:16:49)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mgetHistory › returns data on success\u001b[39m\u001b[22m\n\n    TypeError: supabase_1.supabase.from(...).select(...).order(...).limit(...).eq(...).eq is not a function\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 12 |\u001b[39m     \u001b[33m.\u001b[39mlimit(\u001b[35m10\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 13 |\u001b[39m     \u001b[33m.\u001b[39meq(\u001b[32m'brand'\u001b[39m\u001b[33m,\u001b[39m brand)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 14 |\u001b[39m     \u001b[33m.\u001b[39meq(\u001b[32m'command'\u001b[39m\u001b[33m,\u001b[39m command)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m      \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 15 |\u001b[39m     \u001b[33m.\u001b[39meq(\u001b[32m'type'\u001b[39m\u001b[33m,\u001b[39m type)\u001b[22m\n\u001b[2m     \u001b[90m 16 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 17 |\u001b[39m   \u001b[36mif\u001b[39m (error) {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat eq (\u001b[22m\u001b[2msrc/core/supabase/getHistory.ts\u001b[2m:14:6)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.__awaiter (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat __awaiter (\u001b[22m\u001b[2msrc/core/supabase/getHistory.ts\u001b[2m:7:5)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/getHistory.unit.test.ts\u001b[39m\u001b[0m\u001b[2m:42:36\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.__awaiter (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/getHistory.unit.test.ts\u001b[39m\u001b[0m\u001b[2m:32:44)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["getHistory"],"duration":1,"failureMessages":["TypeError: supabase_1.supabase.from(...).select(...).order(...).limit(...).eq(...).eq is not a function\n    at eq (/Users/playra/999-multibots-telegraf/src/core/supabase/getHistory.ts:14:6)\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at __awaiter (/Users/playra/999-multibots-telegraf/src/core/supabase/getHistory.ts:7:5)\n    at /Users/playra/999-multibots-telegraf/__tests__/core/supabase/getHistory.unit.test.ts:26:36\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getHistory.unit.test.ts:16:49)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"getHistory returns empty array on error","status":"failed","title":"returns empty array on error"},{"ancestorTitles":["getHistory"],"duration":15,"failureMessages":["TypeError: supabase_1.supabase.from(...).select(...).order(...).limit(...).eq(...).eq is not a function\n    at eq (/Users/playra/999-multibots-telegraf/src/core/supabase/getHistory.ts:14:6)\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at __awaiter (/Users/playra/999-multibots-telegraf/src/core/supabase/getHistory.ts:7:5)\n    at /Users/playra/999-multibots-telegraf/__tests__/core/supabase/getHistory.unit.test.ts:42:36\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getHistory.unit.test.ts:32:44)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"getHistory returns data on success","status":"failed","title":"returns data on success"}]},{"numFailingTests":1,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171898471,"runtime":113,"slow":false,"start":1745171898358},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/checkSubscriptionByTelegramId.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mcheckSubscriptionByTelegramId › returns unsubscribed and logs error if query error\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32m\"payments\"\u001b[39m\n    Received: \u001b[31m\"payments_v2\"\u001b[39m\n\n    Number of calls: \u001b[31m1\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 34 |\u001b[39m     mockSingle\u001b[33m.\u001b[39mmockResolvedValueOnce({ data\u001b[33m:\u001b[39m \u001b[36mnull\u001b[39m\u001b[33m,\u001b[39m error\u001b[33m:\u001b[39m err })\u001b[22m\n\u001b[2m     \u001b[90m 35 |\u001b[39m     \u001b[36mconst\u001b[39m result \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m checkSubscriptionByTelegramId(\u001b[32m'42'\u001b[39m)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 36 |\u001b[39m     expect(mockFrom)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[32m'payments'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                      \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 37 |\u001b[39m     expect(mockSelect)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[32m'*'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 38 |\u001b[39m     expect(mockEq)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[32m'telegram_id'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'42'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 39 |\u001b[39m     expect(console\u001b[33m.\u001b[39merror)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[32m'Ошибка при получении информации о подписке:'\u001b[39m\u001b[33m,\u001b[39m err)\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/checkSubscriptionByTelegramId.test.ts\u001b[39m\u001b[0m\u001b[2m:36:22)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/checkSubscriptionByTelegramId.test.ts\u001b[39m\u001b[0m\u001b[2m:4:58)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["checkSubscriptionByTelegramId"],"duration":10,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m\"payments\"\u001b[39m\nReceived: \u001b[31m\"payments_v2\"\u001b[39m\n\nNumber of calls: \u001b[31m1\u001b[39m\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/checkSubscriptionByTelegramId.test.ts:36:22)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/__tests__/core/supabase/checkSubscriptionByTelegramId.test.ts:4:58)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"checkSubscriptionByTelegramId returns unsubscribed and logs error if query error","status":"failed","title":"returns unsubscribed and logs error if query error"},{"ancestorTitles":["checkSubscriptionByTelegramId"],"duration":1,"failureMessages":[],"fullName":"checkSubscriptionByTelegramId returns unsubscribed when no data","status":"passed","title":"returns unsubscribed when no data"},{"ancestorTitles":["checkSubscriptionByTelegramId"],"duration":0,"failureMessages":[],"fullName":"checkSubscriptionByTelegramId returns unsubscribed when last payment older than 30 days","status":"passed","title":"returns unsubscribed when last payment older than 30 days"},{"ancestorTitles":["checkSubscriptionByTelegramId"],"duration":1,"failureMessages":[],"fullName":"checkSubscriptionByTelegramId returns level when last payment within 30 days","status":"passed","title":"returns level when last payment within 30 days"}]},{"numFailingTests":1,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171898483,"runtime":76,"slow":false,"start":1745171898407},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/helpers/delay.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mdelay › resolves after the specified time\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalled\u001b[2m()\u001b[22m\n\n    Expected number of calls: >= \u001b[32m1\u001b[39m\n    Received number of calls:    \u001b[31m0\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m  9 |\u001b[39m     promise\u001b[33m.\u001b[39mthen(callback)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 10 |\u001b[39m     jest\u001b[33m.\u001b[39madvanceTimersByTime(\u001b[35m100\u001b[39m)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 11 |\u001b[39m     expect(callback)\u001b[33m.\u001b[39mtoHaveBeenCalled()\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                      \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 12 |\u001b[39m   })\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 13 |\u001b[39m })\u001b[33m;\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/helpers/delay.test.ts\u001b[39m\u001b[0m\u001b[2m:11:22\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:170:75\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.__awaiter (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:166:16)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/helpers/delay.test.ts\u001b[39m\u001b[0m\u001b[2m:6:56)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["delay"],"duration":1,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalled\u001b[2m()\u001b[22m\n\nExpected number of calls: >= \u001b[32m1\u001b[39m\nReceived number of calls:    \u001b[31m0\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/helpers/delay.test.ts:11:22\n    at Generator.next (<anonymous>)\n    at /Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playra/999-multibots-telegraf/__tests__/helpers/delay.test.ts:6:56)\n    at Promise.then.completed (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"delay resolves after the specified time","status":"failed","title":"resolves after the specified time"}]},{"numFailingTests":1,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171898495,"runtime":91,"slow":false,"start":1745171898404},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/commands/getAvailableModels.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mgetAvailableModels › filters only GPT models and sorts them\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n    \u001b[32m- Expected  - 2\u001b[39m\n    \u001b[31m+ Received  + 1\u001b[39m\n\n    \u001b[2m  Array [\u001b[22m\n    \u001b[32m-   \"gpt-3.5\",\u001b[39m\n    \u001b[32m-   \"gpt-3.5-turbo\",\u001b[39m\n    \u001b[2m    \"gpt-4\",\u001b[22m\n    \u001b[2m    \"gpt-4-turbo\",\u001b[22m\n    \u001b[31m+   \"gpt-3.5-turbo\",\u001b[39m\n    \u001b[2m  ]\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 31 |\u001b[39m     \u001b[36mconst\u001b[39m result \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m getAvailableModels()\u001b[22m\n\u001b[2m     \u001b[90m 32 |\u001b[39m     \u001b[90m// Expect only ids including 'gpt', excluding 'instruct', '0613'\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 33 |\u001b[39m     expect(result)\u001b[33m.\u001b[39mtoEqual([\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                    \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 34 |\u001b[39m       \u001b[32m'gpt-3.5'\u001b[39m\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 35 |\u001b[39m       \u001b[32m'gpt-3.5-turbo'\u001b[39m\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 36 |\u001b[39m       \u001b[32m'gpt-4'\u001b[39m\u001b[33m,\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/commands/getAvailableModels.test.ts\u001b[39m\u001b[0m\u001b[2m:33:20\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["getAvailableModels"],"duration":18,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoEqual\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // deep equality\u001b[22m\n\n\u001b[32m- Expected  - 2\u001b[39m\n\u001b[31m+ Received  + 1\u001b[39m\n\n\u001b[2m  Array [\u001b[22m\n\u001b[32m-   \"gpt-3.5\",\u001b[39m\n\u001b[32m-   \"gpt-3.5-turbo\",\u001b[39m\n\u001b[2m    \"gpt-4\",\u001b[22m\n\u001b[2m    \"gpt-4-turbo\",\u001b[22m\n\u001b[31m+   \"gpt-3.5-turbo\",\u001b[39m\n\u001b[2m  ]\u001b[22m\n    at /Users/playra/999-multibots-telegraf/__tests__/commands/getAvailableModels.test.ts:33:20\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"getAvailableModels filters only GPT models and sorts them","status":"failed","title":"filters only GPT models and sorts them"},{"ancestorTitles":["getAvailableModels"],"duration":4,"failureMessages":[],"fullName":"getAvailableModels returns fallback on error","status":"passed","title":"returns fallback on error"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171898778,"runtime":267,"slow":false,"start":1745171898511},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/updateUserSoul.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["updateUserSoul"],"duration":74,"failureMessages":[],"fullName":"updateUserSoul calls update and eq and resolves on success","status":"passed","title":"calls update and eq and resolves on success"},{"ancestorTitles":["updateUserSoul"],"duration":69,"failureMessages":[],"fullName":"updateUserSoul logs and resolves on update error","status":"passed","title":"logs and resolves on update error"},{"ancestorTitles":["updateUserSoul"],"duration":67,"failureMessages":[],"fullName":"updateUserSoul logs and resolves on exception","status":"passed","title":"logs and resolves on exception"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171898943,"runtime":124,"slow":false,"start":1745171898819},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/index.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["core index"],"duration":1,"failureMessages":[],"fullName":"core index exports key core modules","status":"passed","title":"exports key core modules"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171899001,"runtime":505,"slow":false,"start":1745171898496},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/utils/helpersIndex.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["helpers index exports"],"duration":353,"failureMessages":[],"fullName":"helpers index exports exports isDev based on NODE_ENV","status":"passed","title":"exports isDev based on NODE_ENV"},{"ancestorTitles":["helpers index exports"],"duration":95,"failureMessages":[],"fullName":"helpers index exports re-exports helper functions correctly","status":"passed","title":"re-exports helper functions correctly"}]},{"numFailingTests":0,"numPassingTests":7,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171899041,"runtime":60,"slow":false,"start":1745171898981},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/handlers/handleTextMessage.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["handleTextMessage"],"duration":6,"failureMessages":[],"fullName":"handleTextMessage skips commands starting with slash","status":"passed","title":"skips commands starting with slash"},{"ancestorTitles":["handleTextMessage"],"duration":3,"failureMessages":[],"fullName":"handleTextMessage replies error when message missing","status":"passed","title":"replies error when message missing"},{"ancestorTitles":["handleTextMessage"],"duration":3,"failureMessages":[],"fullName":"handleTextMessage replies error when text empty","status":"passed","title":"replies error when text empty"},{"ancestorTitles":["handleTextMessage"],"duration":3,"failureMessages":[],"fullName":"handleTextMessage processes message with existing user","status":"passed","title":"processes message with existing user"},{"ancestorTitles":["handleTextMessage"],"duration":3,"failureMessages":[],"fullName":"handleTextMessage uses fallback when user not found","status":"passed","title":"uses fallback when user not found"},{"ancestorTitles":["handleTextMessage"],"duration":2,"failureMessages":[],"fullName":"handleTextMessage replies GPT error when answerAi returns falsy","status":"passed","title":"replies GPT error when answerAi returns falsy"},{"ancestorTitles":["handleTextMessage"],"duration":9,"failureMessages":[],"fullName":"handleTextMessage replies and throws on exception","status":"passed","title":"replies and throws on exception"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171898955,"runtime":466,"slow":false,"start":1745171898489},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/scenes/index.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["scenes index"],"duration":1,"failureMessages":[],"fullName":"scenes index exports scene modules","status":"passed","title":"exports scene modules"}]},{"numFailingTests":1,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171899225,"runtime":4160,"slow":false,"start":1745171895065},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/price/processBalanceOperation.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mprocessBalanceOperation › returns success and updates balance\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\n    Expected: \u001b[32mtrue\u001b[39m\n    Received: \u001b[31mfalse\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 32 |\u001b[39m       is_ru\u001b[33m:\u001b[39m \u001b[36mtrue\u001b[39m\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 33 |\u001b[39m     })\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 34 |\u001b[39m     expect(res\u001b[33m.\u001b[39msuccess)\u001b[33m.\u001b[39mtoBe(\u001b[36mtrue\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                         \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 35 |\u001b[39m     expect(res\u001b[33m.\u001b[39mnewBalance)\u001b[33m.\u001b[39mtoBe(\u001b[35m15\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 36 |\u001b[39m     expect(spyUpdate)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(telegram_id\u001b[33m,\u001b[39m \u001b[35m15\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 37 |\u001b[39m   })\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/price/processBalanceOperation.test.ts\u001b[39m\u001b[0m\u001b[2m:34:25\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["processBalanceOperation"],"duration":3977,"failureMessages":[],"fullName":"processBalanceOperation returns error when balance insufficient","status":"passed","title":"returns error when balance insufficient"},{"ancestorTitles":["processBalanceOperation"],"duration":5,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32mtrue\u001b[39m\nReceived: \u001b[31mfalse\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/price/processBalanceOperation.test.ts:34:25\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"processBalanceOperation returns success and updates balance","status":"failed","title":"returns success and updates balance"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171899341,"runtime":267,"slow":false,"start":1745171899074},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/updateModelTraining.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["updateModelTraining"],"duration":129,"failureMessages":[],"fullName":"updateModelTraining resolves when update has no error","status":"passed","title":"resolves when update has no error"},{"ancestorTitles":["updateModelTraining"],"duration":118,"failureMessages":[],"fullName":"updateModelTraining throws when update returns error","status":"passed","title":"throws when update returns error"}]},{"numFailingTests":2,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171899284,"runtime":6555,"slow":true,"start":1745171892729},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/updateUserBalance.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mupdateUserBalance › should update user balance and return no error on success\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32m\"users\"\u001b[39m\n\n    Number of calls: \u001b[31m0\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 33 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 34 |\u001b[39m     \u001b[36mconst\u001b[39m result \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m updateUserBalance(telegram_id\u001b[33m,\u001b[39m new_balance\u001b[33m,\u001b[39m \u001b[32m'money_income'\u001b[39m)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 35 |\u001b[39m     expect(mockFrom)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[32m'users'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                      \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 36 |\u001b[39m     expect(mockUpdate)\u001b[33m.\u001b[39mtoHaveBeenCalledWith({ balance\u001b[33m:\u001b[39m \u001b[35m100\u001b[39m })\u001b[22m\n\u001b[2m     \u001b[90m 37 |\u001b[39m     expect(mockEq)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[32m'telegram_id'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'42'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 38 |\u001b[39m   })\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/updateUserBalance.test.ts\u001b[39m\u001b[0m\u001b[2m:35:22\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mupdateUserBalance › should return an error if Supabase update fails\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32m\"Ошибка обновления баланса:\"\u001b[39m, \u001b[32mAny<Object>\u001b[39m\n\n    Number of calls: \u001b[31m0\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 47 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 48 |\u001b[39m     \u001b[36mconst\u001b[39m result \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m updateUserBalance(telegram_id\u001b[33m,\u001b[39m new_balance\u001b[33m,\u001b[39m \u001b[32m'money_income'\u001b[39m)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 49 |\u001b[39m     expect(console\u001b[33m.\u001b[39merror)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                           \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 50 |\u001b[39m       \u001b[32m'Ошибка обновления баланса:'\u001b[39m\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 51 |\u001b[39m       expect\u001b[33m.\u001b[39many(\u001b[33mObject\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 52 |\u001b[39m     )\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/core/supabase/updateUserBalance.test.ts\u001b[39m\u001b[0m\u001b[2m:49:27\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["updateUserBalance"],"duration":4439,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m\"users\"\u001b[39m\n\nNumber of calls: \u001b[31m0\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/core/supabase/updateUserBalance.test.ts:35:22\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"updateUserBalance should update user balance and return no error on success","status":"failed","title":"should update user balance and return no error on success"},{"ancestorTitles":["updateUserBalance"],"duration":241,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m\"Ошибка обновления баланса:\"\u001b[39m, \u001b[32mAny<Object>\u001b[39m\n\nNumber of calls: \u001b[31m0\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/core/supabase/updateUserBalance.test.ts:49:27\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"updateUserBalance should return an error if Supabase update fails","status":"failed","title":"should return an error if Supabase update fails"}]},{"numFailingTests":2,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171899149,"runtime":14013,"slow":true,"start":1745171885136},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/scenes/textToSpeechWizard.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mtextToSpeechWizard › step 0: prompts and calls next()\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32m\"🎙️ Отправьте текст, для преобразования его в голос\"\u001b[39m\n    Received: \u001b[2m\"🎙️ Отправьте текст, для преобразования его в голос\"\u001b[22m, \u001b[31m{\"reply_markup\": {\"keyboard\": [[\"Справка по команде\"], [\"Отмена\"]], \"resize_keyboard\": true}}\u001b[39m\n\n    Number of calls: \u001b[31m1\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 31 |\u001b[39m     \u001b[36mawait\u001b[39m step0(ctx\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {})\u001b[22m\n\u001b[2m     \u001b[90m 32 |\u001b[39m     expect(isRussianSpy)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(ctx)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 33 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mreply)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 34 |\u001b[39m       \u001b[32m'🎙️ Отправьте текст, для преобразования его в голос'\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 35 |\u001b[39m     )\u001b[22m\n\u001b[2m     \u001b[90m 36 |\u001b[39m   })\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/scenes/textToSpeechWizard.test.ts\u001b[39m\u001b[0m\u001b[2m:33:23\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mtextToSpeechWizard › step 1: no text message prompts ask\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32m\"✍️ Please send text\"\u001b[39m\n    Received: \u001b[31m\"🎯 For correct operation, train the avatar using 🎤 Voice for avatar in the main menu\"\u001b[39m\n\n    Number of calls: \u001b[31m1\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 43 |\u001b[39m     \u001b[36mawait\u001b[39m step1(ctx\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {})\u001b[22m\n\u001b[2m     \u001b[90m 44 |\u001b[39m     expect(isRussianSpy)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(ctx)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 45 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mreply)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[32m'✍️ Please send text'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 46 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 47 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 48 |\u001b[39m   it(\u001b[32m'step 1: cancel leaves scene'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/scenes/textToSpeechWizard.test.ts\u001b[39m\u001b[0m\u001b[2m:45:23\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["textToSpeechWizard"],"duration":8,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m\"🎙️ Отправьте текст, для преобразования его в голос\"\u001b[39m\nReceived: \u001b[2m\"🎙️ Отправьте текст, для преобразования его в голос\"\u001b[22m, \u001b[31m{\"reply_markup\": {\"keyboard\": [[\"Справка по команде\"], [\"Отмена\"]], \"resize_keyboard\": true}}\u001b[39m\n\nNumber of calls: \u001b[31m1\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/scenes/textToSpeechWizard.test.ts:33:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"textToSpeechWizard step 0: prompts and calls next()","status":"failed","title":"step 0: prompts and calls next()"},{"ancestorTitles":["textToSpeechWizard"],"duration":3781,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m\"✍️ Please send text\"\u001b[39m\nReceived: \u001b[31m\"🎯 For correct operation, train the avatar using 🎤 Voice for avatar in the main menu\"\u001b[39m\n\nNumber of calls: \u001b[31m1\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/scenes/textToSpeechWizard.test.ts:45:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"textToSpeechWizard step 1: no text message prompts ask","status":"failed","title":"step 1: no text message prompts ask"},{"ancestorTitles":["textToSpeechWizard"],"duration":5,"failureMessages":[],"fullName":"textToSpeechWizard step 1: cancel leaves scene","status":"passed","title":"step 1: cancel leaves scene"},{"ancestorTitles":["textToSpeechWizard"],"duration":20,"failureMessages":[],"fullName":"textToSpeechWizard step 1: no voice_id prompts training message and leaves","status":"passed","title":"step 1: no voice_id prompts training message and leaves"},{"ancestorTitles":["textToSpeechWizard"],"duration":2,"failureMessages":[],"fullName":"textToSpeechWizard step 1: generates text to speech and leaves","status":"passed","title":"step 1: generates text to speech and leaves"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171899463,"runtime":44,"slow":false,"start":1745171899419},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/middlewares/handleSubscriptionMessage.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["handleSubscriptionMessage"],"duration":3,"failureMessages":[],"fullName":"handleSubscriptionMessage sends Russian subscription message with inline keyboard","status":"passed","title":"sends Russian subscription message with inline keyboard"},{"ancestorTitles":["handleSubscriptionMessage"],"duration":1,"failureMessages":[],"fullName":"handleSubscriptionMessage sends English subscription message with inline keyboard","status":"passed","title":"sends English subscription message with inline keyboard"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171899397,"runtime":279,"slow":false,"start":1745171899118},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/bot/supportRequest.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["supportRequest"],"duration":138,"failureMessages":[],"fullName":"supportRequest sends a message with formatted title and data","status":"passed","title":"sends a message with formatted title and data"},{"ancestorTitles":["supportRequest"],"duration":111,"failureMessages":[],"fullName":"supportRequest throws an error if sendMessage rejects","status":"passed","title":"throws an error if sendMessage rejects"}]},{"numFailingTests":0,"numPassingTests":6,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171899715,"runtime":268,"slow":false,"start":1745171899447},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/openai/additionalOpenai.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["Additional OpenAI modules"],"duration":61,"failureMessages":[],"fullName":"Additional OpenAI modules getAinews returns content string","status":"passed","title":"getAinews returns content string"},{"ancestorTitles":["Additional OpenAI modules"],"duration":21,"failureMessages":[],"fullName":"Additional OpenAI modules getMeditationSteps parses JSON content","status":"passed","title":"getMeditationSteps parses JSON content"},{"ancestorTitles":["Additional OpenAI modules"],"duration":43,"failureMessages":[],"fullName":"Additional OpenAI modules getSubtitles parses JSON content","status":"passed","title":"getSubtitles parses JSON content"},{"ancestorTitles":["Additional OpenAI modules"],"duration":23,"failureMessages":[],"fullName":"Additional OpenAI modules getTriggerReel returns string content","status":"passed","title":"getTriggerReel returns string content"},{"ancestorTitles":["Additional OpenAI modules"],"duration":53,"failureMessages":[],"fullName":"Additional OpenAI modules getSlides parses JSON content","status":"passed","title":"getSlides parses JSON content"},{"ancestorTitles":["Additional OpenAI modules"],"duration":18,"failureMessages":[],"fullName":"Additional OpenAI modules upgradePrompt returns content string","status":"passed","title":"upgradePrompt returns content string"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171899753,"runtime":159,"slow":false,"start":1745171899594},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/utils/createImagesZip.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["createImagesZip helper"],"duration":76,"failureMessages":[],"fullName":"createImagesZip helper creates a zip file containing provided images","status":"passed","title":"creates a zip file containing provided images"}]},{"numFailingTests":6,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171899511,"runtime":14423,"slow":true,"start":1745171885088},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/scenes/subscriptionScene.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1msubscriptionScene › step 0: displays subscription info and options\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\n    Expected: \u001b[32m\"HTML\"\u001b[39m\n    Received: \u001b[31m\"Markdown\"\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 32 |\u001b[39m       \u001b[33m:\u001b[39m [ctx\u001b[33m.\u001b[39mdebug\u001b[33m.\u001b[39mreplies[\u001b[35m0\u001b[39m]\u001b[33m.\u001b[39mmessage\u001b[33m,\u001b[39m {}]\u001b[22m\n\u001b[2m     \u001b[90m 33 |\u001b[39m     expect(\u001b[36mtypeof\u001b[39m text)\u001b[33m.\u001b[39mtoBe(\u001b[32m'string'\u001b[39m)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 34 |\u001b[39m     expect(opts\u001b[33m.\u001b[39mparse_mode)\u001b[33m.\u001b[39mtoBe(\u001b[32m'HTML'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                             \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 35 |\u001b[39m     expect(opts\u001b[33m.\u001b[39mreply_markup)\u001b[33m.\u001b[39mtoBeDefined()\u001b[22m\n\u001b[2m     \u001b[90m 36 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mwizard\u001b[33m.\u001b[39mnext)\u001b[33m.\u001b[39mtoHaveBeenCalled()\u001b[22m\n\u001b[2m     \u001b[90m 37 |\u001b[39m   })\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/scenes/subscriptionScene.test.ts\u001b[39m\u001b[0m\u001b[2m:34:29\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1msubscriptionScene › step 0: handles error during data fetch\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32m\"Error displaying tariffs.\"\u001b[39m\n    Received: \u001b[31m\"💫 Для получения полного доступа ко всем нейрокомандам, выберите одну из предложенных месячных подписок:·\u001b[39m\n    \u001b[31m📸 НейроФото - Цена: 1110 ₽\u001b[39m\n    \u001b[31m- Самостоятельное обучение по нейросетям с ИИ аватаром\u001b[39m\n    \u001b[31m- Учитесь в удобное время\u001b[39m\n    \u001b[31m- Включает видеоуроки, текстовые материалы\u001b[39m\n    \u001b[31m- Поддержка и актуальные технологии\u001b[39m\n    \u001b[31m- Доступ к чату с ментором\u001b[39m\n    \u001b[31m- 476 звезды на баланс бота·\u001b[39m\n    \u001b[31m📚 НейроБаза - Цена: 2999 ₽\u001b[39m\n    \u001b[31m- 📖 Уроки по нейросетям·\u001b[39m\n    \u001b[31m- 📸 Нейрофото·\u001b[39m\n    \u001b[31m- 🎥 Генерация видео·\u001b[39m\n    \u001b[31m- 🗣️ Озвучка Аватара·\u001b[39m\n    \u001b[31m- 🔧 Поддержка куратора·\u001b[39m\n    \u001b[31m- 💬 Доступ к чату с ментором\u001b[39m\n    \u001b[31m- 1303 звезд на баланс бота\u001b[39m\n    \u001b[31m\"\u001b[39m, \u001b[31m{\"parse_mode\": \"Markdown\", \"reply_markup\": {\"inline_keyboard\": [[{\"callback_data\": \"neurophoto\", \"remove_keyboard\": true, \"text\": \"🎨 НейроФото - 10 $\"}], [{\"callback_data\": \"neurobase\", \"remove_keyboard\": true, \"text\": \"📚 НейроБаза - 33 $\"}]]}}\u001b[39m\n\n    Number of calls: \u001b[31m1\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 51 |\u001b[39m     \u001b[36mawait\u001b[39m step0(ctx\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {})\u001b[22m\n\u001b[2m     \u001b[90m 52 |\u001b[39m     \u001b[90m// После ошибки должен быть отправлен текст об ошибке и exit\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 53 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mreply)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[32m'Error displaying tariffs.'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 54 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mscene\u001b[33m.\u001b[39mleave)\u001b[33m.\u001b[39mtoHaveBeenCalled()\u001b[22m\n\u001b[2m     \u001b[90m 55 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 56 |\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/scenes/subscriptionScene.test.ts\u001b[39m\u001b[0m\u001b[2m:53:23\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1msubscriptionScene › step 1: processes valid callback data\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\n    Expected: \u001b[32m\"neurobase\"\u001b[39m\n    Received: \u001b[31m\"NEUROBASE\"\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 63 |\u001b[39m     \u001b[36mconst\u001b[39m step1 \u001b[33m=\u001b[39m \u001b[33mComposer\u001b[39m\u001b[33m.\u001b[39munwrap(subscriptionScene\u001b[33m.\u001b[39msteps[\u001b[35m1\u001b[39m])\u001b[22m\n\u001b[2m     \u001b[90m 64 |\u001b[39m     \u001b[36mawait\u001b[39m step1(ctx\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {})\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 65 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39msession\u001b[33m.\u001b[39msubscription)\u001b[33m.\u001b[39mtoBe(\u001b[32m'neurobase'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                      \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 66 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mscene\u001b[33m.\u001b[39menter)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[32m'paymentScene'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 67 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 68 |\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/scenes/subscriptionScene.test.ts\u001b[39m\u001b[0m\u001b[2m:65:38\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1msubscriptionScene › step 1: leaves scene on mainmenu callback\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32m\"menuScene\"\u001b[39m\n    Received: \u001b[31m\"main_menu\"\u001b[39m\n\n    Number of calls: \u001b[31m1\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 75 |\u001b[39m     \u001b[36mconst\u001b[39m step1 \u001b[33m=\u001b[39m \u001b[33mComposer\u001b[39m\u001b[33m.\u001b[39munwrap(subscriptionScene\u001b[33m.\u001b[39msteps[\u001b[35m1\u001b[39m])\u001b[22m\n\u001b[2m     \u001b[90m 76 |\u001b[39m     \u001b[36mawait\u001b[39m step1(ctx\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {})\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 77 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mscene\u001b[33m.\u001b[39menter)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[32m'menuScene'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                             \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 78 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 79 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 80 |\u001b[39m   it(\u001b[32m'step 1: replies on unknown callback data'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/scenes/subscriptionScene.test.ts\u001b[39m\u001b[0m\u001b[2m:77:29\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1msubscriptionScene › step 1: replies on unknown callback data\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalled\u001b[2m()\u001b[22m\n\n    Expected number of calls: >= \u001b[32m1\u001b[39m\n    Received number of calls:    \u001b[31m0\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 86 |\u001b[39m     \u001b[36mconst\u001b[39m step1 \u001b[33m=\u001b[39m \u001b[33mComposer\u001b[39m\u001b[33m.\u001b[39munwrap(subscriptionScene\u001b[33m.\u001b[39msteps[\u001b[35m1\u001b[39m])\u001b[22m\n\u001b[2m     \u001b[90m 87 |\u001b[39m     \u001b[36mawait\u001b[39m step1(ctx\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {})\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 88 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39manswerCbQuery)\u001b[33m.\u001b[39mtoHaveBeenCalled()\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                               \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 89 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mreply)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[22m\n\u001b[2m     \u001b[90m 90 |\u001b[39m       \u001b[32m'Неизвестный выбор. Пожалуйста, используйте кнопки.'\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 91 |\u001b[39m     )\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/scenes/subscriptionScene.test.ts\u001b[39m\u001b[0m\u001b[2m:88:31\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1msubscriptionScene › step 1: handles message instead of callback\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32m\"Please select a tariff using the buttons.\"\u001b[39m\n\n    Number of calls: \u001b[31m0\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 101 |\u001b[39m     \u001b[36mconst\u001b[39m step1 \u001b[33m=\u001b[39m \u001b[33mComposer\u001b[39m\u001b[33m.\u001b[39munwrap(subscriptionScene\u001b[33m.\u001b[39msteps[\u001b[35m1\u001b[39m])\u001b[22m\n\u001b[2m     \u001b[90m 102 |\u001b[39m     \u001b[36mawait\u001b[39m step1(ctx\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {})\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 103 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mreply)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 104 |\u001b[39m       \u001b[32m'Please select a tariff using the buttons.'\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 105 |\u001b[39m     )\u001b[22m\n\u001b[2m     \u001b[90m 106 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mscene\u001b[33m.\u001b[39mleave)\u001b[33m.\u001b[39mtoHaveBeenCalled()\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/scenes/subscriptionScene.test.ts\u001b[39m\u001b[0m\u001b[2m:103:23\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["subscriptionScene"],"duration":4448,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32m\"HTML\"\u001b[39m\nReceived: \u001b[31m\"Markdown\"\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/scenes/subscriptionScene.test.ts:34:29\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"subscriptionScene step 0: displays subscription info and options","status":"failed","title":"step 0: displays subscription info and options"},{"ancestorTitles":["subscriptionScene"],"duration":256,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m\"Error displaying tariffs.\"\u001b[39m\nReceived: \u001b[31m\"💫 Для получения полного доступа ко всем нейрокомандам, выберите одну из предложенных месячных подписок:·\u001b[39m\n\u001b[31m📸 НейроФото - Цена: 1110 ₽\u001b[39m\n\u001b[31m- Самостоятельное обучение по нейросетям с ИИ аватаром\u001b[39m\n\u001b[31m- Учитесь в удобное время\u001b[39m\n\u001b[31m- Включает видеоуроки, текстовые материалы\u001b[39m\n\u001b[31m- Поддержка и актуальные технологии\u001b[39m\n\u001b[31m- Доступ к чату с ментором\u001b[39m\n\u001b[31m- 476 звезды на баланс бота·\u001b[39m\n\u001b[31m📚 НейроБаза - Цена: 2999 ₽\u001b[39m\n\u001b[31m- 📖 Уроки по нейросетям·\u001b[39m\n\u001b[31m- 📸 Нейрофото·\u001b[39m\n\u001b[31m- 🎥 Генерация видео·\u001b[39m\n\u001b[31m- 🗣️ Озвучка Аватара·\u001b[39m\n\u001b[31m- 🔧 Поддержка куратора·\u001b[39m\n\u001b[31m- 💬 Доступ к чату с ментором\u001b[39m\n\u001b[31m- 1303 звезд на баланс бота\u001b[39m\n\u001b[31m\"\u001b[39m, \u001b[31m{\"parse_mode\": \"Markdown\", \"reply_markup\": {\"inline_keyboard\": [[{\"callback_data\": \"neurophoto\", \"remove_keyboard\": true, \"text\": \"🎨 НейроФото - 10 $\"}], [{\"callback_data\": \"neurobase\", \"remove_keyboard\": true, \"text\": \"📚 НейроБаза - 33 $\"}]]}}\u001b[39m\n\nNumber of calls: \u001b[31m1\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/scenes/subscriptionScene.test.ts:53:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"subscriptionScene step 0: handles error during data fetch","status":"failed","title":"step 0: handles error during data fetch"},{"ancestorTitles":["subscriptionScene"],"duration":4,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32m\"neurobase\"\u001b[39m\nReceived: \u001b[31m\"NEUROBASE\"\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/scenes/subscriptionScene.test.ts:65:38\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"subscriptionScene step 1: processes valid callback data","status":"failed","title":"step 1: processes valid callback data"},{"ancestorTitles":["subscriptionScene"],"duration":7,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m\"menuScene\"\u001b[39m\nReceived: \u001b[31m\"main_menu\"\u001b[39m\n\nNumber of calls: \u001b[31m1\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/scenes/subscriptionScene.test.ts:77:29\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"subscriptionScene step 1: leaves scene on mainmenu callback","status":"failed","title":"step 1: leaves scene on mainmenu callback"},{"ancestorTitles":["subscriptionScene"],"duration":9,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalled\u001b[2m()\u001b[22m\n\nExpected number of calls: >= \u001b[32m1\u001b[39m\nReceived number of calls:    \u001b[31m0\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/scenes/subscriptionScene.test.ts:88:31\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"subscriptionScene step 1: replies on unknown callback data","status":"failed","title":"step 1: replies on unknown callback data"},{"ancestorTitles":["subscriptionScene"],"duration":9,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m\"Please select a tariff using the buttons.\"\u001b[39m\n\nNumber of calls: \u001b[31m0\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/scenes/subscriptionScene.test.ts:103:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"subscriptionScene step 1: handles message instead of callback","status":"failed","title":"step 1: handles message instead of callback"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171899768,"runtime":354,"slow":false,"start":1745171899414},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/setModel.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["setModel"],"duration":165,"failureMessages":[],"fullName":"setModel calls update, eq, and select, and resolves","status":"passed","title":"calls update, eq, and select, and resolves"},{"ancestorTitles":["setModel"],"duration":156,"failureMessages":[],"fullName":"setModel throws when supabase.select rejects","status":"passed","title":"throws when supabase.select rejects"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171900645,"runtime":105,"slow":false,"start":1745171900540},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/handlers/handlePaymentPolicyInfo.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["handlePaymentPolicyInfo"],"duration":1,"failureMessages":[],"fullName":"handlePaymentPolicyInfo answers callback query and replies with policy in Russian","status":"passed","title":"answers callback query and replies with policy in Russian"},{"ancestorTitles":["handlePaymentPolicyInfo"],"duration":52,"failureMessages":[],"fullName":"handlePaymentPolicyInfo replies with policy in English when language_code is not ru","status":"passed","title":"replies with policy in English when language_code is not ru"}]},{"numFailingTests":0,"numPassingTests":9,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171900707,"runtime":938,"slow":false,"start":1745171899769},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/utils/config.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["config utils"],"duration":19,"failureMessages":[],"fullName":"config utils validateToken should reject invalid formats","status":"passed","title":"validateToken should reject invalid formats"},{"ancestorTitles":["config utils"],"duration":39,"failureMessages":[],"fullName":"config utils validateToken should accept valid token","status":"passed","title":"validateToken should accept valid token"},{"ancestorTitles":["config utils"],"duration":27,"failureMessages":[],"fullName":"config utils generateSecretKey should return hex string of length 64","status":"passed","title":"generateSecretKey should return hex string of length 64"},{"ancestorTitles":["config utils"],"duration":121,"failureMessages":[],"fullName":"config utils getWebhookConfig should read env variables","status":"passed","title":"getWebhookConfig should read env variables"},{"ancestorTitles":["config utils","loadConfig"],"duration":434,"failureMessages":[],"fullName":"config utils loadConfig should return no bots if no tokens","status":"passed","title":"should return no bots if no tokens"},{"ancestorTitles":["config utils","loadConfig"],"duration":94,"failureMessages":[],"fullName":"config utils loadConfig should include BOT_TOKEN env var","status":"passed","title":"should include BOT_TOKEN env var"},{"ancestorTitles":["config utils","loadBotsConfig"],"duration":32,"failureMessages":[],"fullName":"config utils loadBotsConfig should return empty array when file missing","status":"passed","title":"should return empty array when file missing"},{"ancestorTitles":["config utils","loadBotsConfig"],"duration":25,"failureMessages":[],"fullName":"config utils loadBotsConfig should disable invalid tokens and duplicates","status":"passed","title":"should disable invalid tokens and duplicates"},{"ancestorTitles":["config utils"],"duration":116,"failureMessages":[],"fullName":"config utils loadSecurityConfig should return defaults when no file","status":"passed","title":"loadSecurityConfig should return defaults when no file"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171900585,"runtime":1199,"slow":false,"start":1745171899386},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/isLimitAi.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["isLimitAi"],"duration":100,"failureMessages":[],"fullName":"isLimitAi returns false when user lookup error","status":"passed","title":"returns false when user lookup error"},{"ancestorTitles":["isLimitAi"],"duration":117,"failureMessages":[],"fullName":"isLimitAi inserts new record when no limitData or stale date and returns false","status":"passed","title":"inserts new record when no limitData or stale date and returns false"},{"ancestorTitles":["isLimitAi"],"duration":144,"failureMessages":[],"fullName":"isLimitAi updates count when under daily limit and returns false","status":"passed","title":"updates count when under daily limit and returns false"},{"ancestorTitles":["isLimitAi"],"duration":805,"failureMessages":[],"fullName":"isLimitAi returns true when daily limit reached","status":"passed","title":"returns true when daily limit reached"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171899869,"runtime":372,"slow":false,"start":1745171899497},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/incrementBalance.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["incrementBalance"],"duration":147,"failureMessages":[],"fullName":"incrementBalance throws when select errors or no data","status":"passed","title":"throws when select errors or no data"},{"ancestorTitles":["incrementBalance"],"duration":182,"failureMessages":[],"fullName":"incrementBalance resolves when update succeeds","status":"passed","title":"resolves when update succeeds"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171900797,"runtime":72,"slow":false,"start":1745171900725},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/price/validateAndCalculateVideoModelPrice.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["validateAndCalculateVideoModelPrice"],"duration":2,"failureMessages":[],"fullName":"validateAndCalculateVideoModelPrice returns null and prompts when videoModel is empty or invalid","status":"passed","title":"returns null and prompts when videoModel is empty or invalid"},{"ancestorTitles":["validateAndCalculateVideoModelPrice"],"duration":0,"failureMessages":[],"fullName":"validateAndCalculateVideoModelPrice returns null and prompts when model not in videoModelPrices","status":"passed","title":"returns null and prompts when model not in videoModelPrices"},{"ancestorTitles":["validateAndCalculateVideoModelPrice"],"duration":0,"failureMessages":[],"fullName":"validateAndCalculateVideoModelPrice returns null and prompts when currentBalance is insufficient","status":"passed","title":"returns null and prompts when currentBalance is insufficient"},{"ancestorTitles":["validateAndCalculateVideoModelPrice"],"duration":0,"failureMessages":[],"fullName":"validateAndCalculateVideoModelPrice returns price when model valid and balance sufficient","status":"passed","title":"returns price when model valid and balance sufficient"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171901361,"runtime":572,"slow":false,"start":1745171900789},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/handlers/handleTopUp.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["handleTopUp"],"duration":7,"failureMessages":[],"fullName":"handleTopUp calls handleBuy with correct parameters for Russian","status":"passed","title":"calls handleBuy with correct parameters for Russian"},{"ancestorTitles":["handleTopUp"],"duration":8,"failureMessages":[],"fullName":"handleTopUp calls handleBuy with correct parameters for English","status":"passed","title":"calls handleBuy with correct parameters for English"}]},{"numFailingTests":0,"numPassingTests":10,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171899820,"runtime":313,"slow":false,"start":1745171899507},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/handlers/allHandlers.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["handlers loadable modules"],"duration":2,"failureMessages":[],"fullName":"handlers loadable modules can require handler module checkFullAccess","status":"passed","title":"can require handler module checkFullAccess"},{"ancestorTitles":["handlers loadable modules"],"duration":1,"failureMessages":[],"fullName":"handlers loadable modules can require handler module getBotToken","status":"passed","title":"can require handler module getBotToken"},{"ancestorTitles":["handlers loadable modules"],"duration":123,"failureMessages":[],"fullName":"handlers loadable modules can require handler module getPhotoUrl","status":"passed","title":"can require handler module getPhotoUrl"},{"ancestorTitles":["handlers loadable modules"],"duration":1,"failureMessages":[],"fullName":"handlers loadable modules can require handler module getSubScribeChannel","status":"passed","title":"can require handler module getSubScribeChannel"},{"ancestorTitles":["handlers loadable modules"],"duration":0,"failureMessages":[],"fullName":"handlers loadable modules can require handler module getUserInfo","status":"passed","title":"can require handler module getUserInfo"},{"ancestorTitles":["handlers loadable modules"],"duration":15,"failureMessages":[],"fullName":"handlers loadable modules can require handler module handleMenu","status":"passed","title":"can require handler module handleMenu"},{"ancestorTitles":["handlers loadable modules"],"duration":5,"failureMessages":[],"fullName":"handlers loadable modules can require handler module hearsActions","status":"passed","title":"can require handler module hearsActions"},{"ancestorTitles":["handlers loadable modules"],"duration":21,"failureMessages":[],"fullName":"handlers loadable modules can require handler module index","status":"passed","title":"can require handler module index"},{"ancestorTitles":["handlers loadable modules"],"duration":87,"failureMessages":[],"fullName":"handlers loadable modules can require handler module paymentActions","status":"passed","title":"can require handler module paymentActions"},{"ancestorTitles":["handlers loadable modules"],"duration":3,"failureMessages":[],"fullName":"handlers loadable modules can require handler module сallbackActions","status":"passed","title":"can require handler module сallbackActions"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171901421,"runtime":650,"slow":false,"start":1745171900771},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/menu/sendGenericErrorMessage.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["sendGenericErrorMessage"],"duration":2,"failureMessages":[],"fullName":"sendGenericErrorMessage sends generic Russian message without error details","status":"passed","title":"sends generic Russian message without error details"},{"ancestorTitles":["sendGenericErrorMessage"],"duration":55,"failureMessages":[],"fullName":"sendGenericErrorMessage logs error and sends generic message when error provided","status":"passed","title":"logs error and sends generic message when error provided"},{"ancestorTitles":["sendGenericErrorMessage"],"duration":4,"failureMessages":[],"fullName":"sendGenericErrorMessage includes error details in development mode","status":"passed","title":"includes error details in development mode"},{"ancestorTitles":["sendGenericErrorMessage"],"duration":1,"failureMessages":[],"fullName":"sendGenericErrorMessage logs sendError when reply throws","status":"passed","title":"logs sendError when reply throws"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171901410,"runtime":600,"slow":false,"start":1745171900810},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/menu/imageModelMenu.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["imageModelMenu"],"duration":18,"failureMessages":[],"fullName":"imageModelMenu replies with Russian text and correct keyboard","status":"passed","title":"replies with Russian text and correct keyboard"},{"ancestorTitles":["imageModelMenu"],"duration":1,"failureMessages":[],"fullName":"imageModelMenu replies with English text and correct keyboard","status":"passed","title":"replies with English text and correct keyboard"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171901385,"runtime":555,"slow":false,"start":1745171900830},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/handlers/getUserInfo.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getUserInfo"],"duration":4,"failureMessages":[],"fullName":"getUserInfo returns userId and telegramId when ctx.from.id exists","status":"passed","title":"returns userId and telegramId when ctx.from.id exists"},{"ancestorTitles":["getUserInfo"],"duration":2,"failureMessages":[],"fullName":"getUserInfo replies error and leaves scene when ctx.from.id is missing","status":"passed","title":"replies error and leaves scene when ctx.from.id is missing"},{"ancestorTitles":["getUserInfo"],"duration":1,"failureMessages":[],"fullName":"getUserInfo uses English message when language_code is not ru","status":"passed","title":"uses English message when language_code is not ru"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171901386,"runtime":1619,"slow":false,"start":1745171899767},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/updateUserLevelPlusOne.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["updateUserLevelPlusOne"],"duration":703,"failureMessages":[],"fullName":"updateUserLevelPlusOne increments level and logs success when no error","status":"passed","title":"increments level and logs success when no error"},{"ancestorTitles":["updateUserLevelPlusOne"],"duration":207,"failureMessages":[],"fullName":"updateUserLevelPlusOne logs error when update returns error","status":"passed","title":"logs error when update returns error"},{"ancestorTitles":["updateUserLevelPlusOne"],"duration":666,"failureMessages":[],"fullName":"updateUserLevelPlusOne catches exception and logs it","status":"passed","title":"catches exception and logs it"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171901671,"runtime":205,"slow":false,"start":1745171901466},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/elevenlabs.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["core/elevenlabs client"],"duration":22,"failureMessages":[],"fullName":"core/elevenlabs client getVoices returns an object with voices array","status":"passed","title":"getVoices returns an object with voices array"},{"ancestorTitles":["core/elevenlabs client"],"duration":22,"failureMessages":[],"fullName":"core/elevenlabs client generateVoiceSpeech returns a buffer of length 1","status":"passed","title":"generateVoiceSpeech returns a buffer of length 1"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171902012,"runtime":125,"slow":false,"start":1745171901887},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getAspectRatio.unit.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getAspectRatio"],"duration":9,"failureMessages":[],"fullName":"getAspectRatio returns null on error","status":"passed","title":"returns null on error"},{"ancestorTitles":["getAspectRatio"],"duration":17,"failureMessages":[],"fullName":"getAspectRatio returns null when data is null","status":"passed","title":"returns null when data is null"},{"ancestorTitles":["getAspectRatio"],"duration":0,"failureMessages":[],"fullName":"getAspectRatio returns aspect_ratio when data present","status":"passed","title":"returns aspect_ratio when data present"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171902183,"runtime":738,"slow":false,"start":1745171901445},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/helpers/images/createImagesZip.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["createImagesZip"],"duration":475,"failureMessages":[],"fullName":"createImagesZip creates zip with images","status":"passed","title":"creates zip with images"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171902381,"runtime":326,"slow":false,"start":1745171902055},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/services/generateTextToVideo.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["generateTextToVideo"],"duration":0,"failureMessages":[],"fullName":"generateTextToVideo logs info with Russian flag","status":"passed","title":"logs info with Russian flag"},{"ancestorTitles":["generateTextToVideo"],"duration":1,"failureMessages":[],"fullName":"generateTextToVideo logs info with English flag","status":"passed","title":"logs info with English flag"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171902396,"runtime":191,"slow":false,"start":1745171902205},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/ensureSupabaseAuth.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["ensureSupabaseAuth"],"duration":10,"failureMessages":[],"fullName":"ensureSupabaseAuth resolves when no error from supabase","status":"passed","title":"resolves when no error from supabase"},{"ancestorTitles":["ensureSupabaseAuth"],"duration":5,"failureMessages":[],"fullName":"ensureSupabaseAuth throws new Error when supabase returns error","status":"passed","title":"throws new Error when supabase returns error"},{"ancestorTitles":["ensureSupabaseAuth"],"duration":6,"failureMessages":[],"fullName":"ensureSupabaseAuth throws new Error on exception","status":"passed","title":"throws new Error on exception"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171902105,"runtime":1826,"slow":false,"start":1745171900279},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getVoiceId.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getVoiceId"],"duration":357,"failureMessages":[],"fullName":"getVoiceId returns voice_id when present","status":"passed","title":"returns voice_id when present"},{"ancestorTitles":["getVoiceId"],"duration":779,"failureMessages":[],"fullName":"getVoiceId returns undefined when no data","status":"passed","title":"returns undefined when no data"},{"ancestorTitles":["getVoiceId"],"duration":513,"failureMessages":[],"fullName":"getVoiceId throws when error","status":"passed","title":"throws when error"}]},{"numFailingTests":0,"numPassingTests":5,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171902253,"runtime":866,"slow":false,"start":1745171901387},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/handlers/handleModelCallback.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["handleModelCallback"],"duration":1,"failureMessages":[],"fullName":"handleModelCallback должен вызывать updateUserModel с правильными аргументами","status":"passed","title":"должен вызывать updateUserModel с правильными аргументами"},{"ancestorTitles":["handleModelCallback"],"duration":190,"failureMessages":[],"fullName":"handleModelCallback должен вызывать reply с сообщением об ошибке, если updateUserModel падает","status":"passed","title":"должен вызывать reply с сообщением об ошибке, если updateUserModel падает"},{"ancestorTitles":["handleModelCallback"],"duration":1,"failureMessages":[],"fullName":"handleModelCallback должен использовать английский текст, если язык не ru","status":"passed","title":"должен использовать английский текст, если язык не ru"},{"ancestorTitles":["handleModelCallback"],"duration":2,"failureMessages":[],"fullName":"handleModelCallback должен использовать английский текст ошибки, если язык не ru","status":"passed","title":"должен использовать английский текст ошибки, если язык не ru"},{"ancestorTitles":["handleModelCallback"],"duration":2,"failureMessages":[],"fullName":"handleModelCallback не должен падать, если ctx.from не определен (хотя TS не позволяет)","status":"passed","title":"не должен падать, если ctx.from не определен (хотя TS не позволяет)"}]},{"numFailingTests":0,"numPassingTests":9,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171902633,"runtime":933,"slow":false,"start":1745171901700},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/payments/robokassaWebhook.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["handleRobokassaWebhook"],"duration":3,"failureMessages":[],"fullName":"handleRobokassaWebhook should process a valid webhook successfully","status":"passed","title":"should process a valid webhook successfully"},{"ancestorTitles":["handleRobokassaWebhook"],"duration":1,"failureMessages":[],"fullName":"handleRobokassaWebhook should return 400 if signature is invalid","status":"passed","title":"should return 400 if signature is invalid"},{"ancestorTitles":["handleRobokassaWebhook"],"duration":2,"failureMessages":[],"fullName":"handleRobokassaWebhook should return 200 if payment is not found (PENDING) but COMPLETED exists","status":"passed","title":"should return 200 if payment is not found (PENDING) but COMPLETED exists"},{"ancestorTitles":["handleRobokassaWebhook"],"duration":2,"failureMessages":[],"fullName":"handleRobokassaWebhook should return 200 if payment is not found (PENDING and COMPLETED)","status":"passed","title":"should return 200 if payment is not found (PENDING and COMPLETED)"},{"ancestorTitles":["handleRobokassaWebhook"],"duration":1,"failureMessages":[],"fullName":"handleRobokassaWebhook should return 500 if database error occurs during PENDING payment fetch","status":"passed","title":"should return 500 if database error occurs during PENDING payment fetch"},{"ancestorTitles":["handleRobokassaWebhook"],"duration":52,"failureMessages":[],"fullName":"handleRobokassaWebhook should return 400 if amount mismatches","status":"passed","title":"should return 400 if amount mismatches"},{"ancestorTitles":["handleRobokassaWebhook"],"duration":6,"failureMessages":[],"fullName":"handleRobokassaWebhook should return 500 if database error occurs during payment status update","status":"passed","title":"should return 500 if database error occurs during payment status update"},{"ancestorTitles":["handleRobokassaWebhook"],"duration":28,"failureMessages":[],"fullName":"handleRobokassaWebhook should return 200 (but log CRITICAL) if database error occurs during user balance update","status":"passed","title":"should return 200 (but log CRITICAL) if database error occurs during user balance update"},{"ancestorTitles":["handleRobokassaWebhook"],"duration":38,"failureMessages":[],"fullName":"handleRobokassaWebhook should handle missing shp_ parameters in query","status":"passed","title":"should handle missing shp_ parameters in query"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171902743,"runtime":356,"slow":false,"start":1745171902387},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/lint/noTsNocheck.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["TS-NOCHECK ban in tests"],"duration":267,"failureMessages":[],"fullName":"TS-NOCHECK ban in tests should not contain @ts-nocheck in any test file","status":"passed","title":"should not contain @ts-nocheck in any test file"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171902828,"runtime":355,"slow":false,"start":1745171902473},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/axios/fetchImage.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["fetchImage"],"duration":76,"failureMessages":[],"fullName":"fetchImage should return buffer from response data","status":"passed","title":"should return buffer from response data"},{"ancestorTitles":["fetchImage"],"duration":3,"failureMessages":[],"fullName":"fetchImage should throw error when axios.get rejects","status":"passed","title":"should throw error when axios.get rejects"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171902860,"runtime":157,"slow":false,"start":1745171902703},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/commands/get100Command.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["get100Command"],"duration":23,"failureMessages":[],"fullName":"get100Command should throw error when from.id missing","status":"passed","title":"should throw error when from.id missing"},{"ancestorTitles":["get100Command"],"duration":1,"failureMessages":[],"fullName":"get100Command should reply error and return when chat.id is missing","status":"passed","title":"should reply error and return when chat.id is missing"},{"ancestorTitles":["get100Command"],"duration":1,"failureMessages":[],"fullName":"get100Command should call generateNeuroImage and deleteMessage on success","status":"passed","title":"should call generateNeuroImage and deleteMessage on success"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171902421,"runtime":974,"slow":false,"start":1745171901447},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/price/validateAndCalculateImageModelPrice.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["validateAndCalculateImageModelPrice"],"duration":13,"failureMessages":[],"fullName":"validateAndCalculateImageModelPrice returns null and prompts when imageModel is empty or invalid","status":"passed","title":"returns null and prompts when imageModel is empty or invalid"},{"ancestorTitles":["validateAndCalculateImageModelPrice"],"duration":42,"failureMessages":[],"fullName":"validateAndCalculateImageModelPrice returns null and prompts when modelInfo not found","status":"passed","title":"returns null and prompts when modelInfo not found"},{"ancestorTitles":["validateAndCalculateImageModelPrice"],"duration":1,"failureMessages":[],"fullName":"validateAndCalculateImageModelPrice returns null and prompts when currentBalance is insufficient","status":"passed","title":"returns null and prompts when currentBalance is insufficient"},{"ancestorTitles":["validateAndCalculateImageModelPrice"],"duration":0,"failureMessages":[],"fullName":"validateAndCalculateImageModelPrice returns price when model is valid and balance is sufficient","status":"passed","title":"returns price when model is valid and balance is sufficient"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171903080,"runtime":152,"slow":false,"start":1745171902928},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/saveUserEmail.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["saveUserEmail"],"duration":4,"failureMessages":[],"fullName":"saveUserEmail resolves when update succeeds","status":"passed","title":"resolves when update succeeds"},{"ancestorTitles":["saveUserEmail"],"duration":82,"failureMessages":[],"fullName":"saveUserEmail throws and logs error when update fails","status":"passed","title":"throws and logs error when update fails"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171903130,"runtime":295,"slow":false,"start":1745171902835},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/menu/getStepSelectionMenu.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getStepSelectionMenu"],"duration":1,"failureMessages":[],"fullName":"getStepSelectionMenu builds Russian keyboard correctly","status":"passed","title":"builds Russian keyboard correctly"},{"ancestorTitles":["getStepSelectionMenu"],"duration":0,"failureMessages":[],"fullName":"getStepSelectionMenu builds English keyboard correctly","status":"passed","title":"builds English keyboard correctly"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171903129,"runtime":183,"slow":false,"start":1745171902946},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/handlers/handleBuy.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["handlers/handleBuy"],"duration":126,"failureMessages":[],"fullName":"handlers/handleBuy sends invoice for matching amount in English","status":"passed","title":"sends invoice for matching amount in English"},{"ancestorTitles":["handlers/handleBuy"],"duration":11,"failureMessages":[],"fullName":"handlers/handleBuy sends invoice for matching amount in Russian","status":"passed","title":"sends invoice for matching amount in Russian"},{"ancestorTitles":["handlers/handleBuy"],"duration":11,"failureMessages":[],"fullName":"handlers/handleBuy does not send invoice when data does not match any amount","status":"passed","title":"does not send invoice when data does not match any amount"},{"ancestorTitles":["handlers/handleBuy"],"duration":7,"failureMessages":[],"fullName":"handlers/handleBuy propagates error when replyWithInvoice throws","status":"passed","title":"propagates error when replyWithInvoice throws"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171903264,"runtime":304,"slow":false,"start":1745171902960},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/commands/selectModelCommand.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["selectModelCommand"],"duration":31,"failureMessages":[],"fullName":"selectModelCommand replies with model selection keyboard in Russian","status":"passed","title":"replies with model selection keyboard in Russian"},{"ancestorTitles":["selectModelCommand"],"duration":1,"failureMessages":[],"fullName":"selectModelCommand replies with model selection keyboard in English","status":"passed","title":"replies with model selection keyboard in English"},{"ancestorTitles":["selectModelCommand"],"duration":94,"failureMessages":[],"fullName":"selectModelCommand calls sendGenericErrorMessage on failure","status":"passed","title":"calls sendGenericErrorMessage on failure"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171903121,"runtime":701,"slow":false,"start":1745171902420},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/menu/index.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["menu index exports"],"duration":5,"failureMessages":[],"fullName":"menu index exports should export all menu builder and send functions","status":"passed","title":"should export all menu builder and send functions"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171903361,"runtime":193,"slow":false,"start":1745171903168},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/commands/priceCommand.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["priceCommand"],"duration":2,"failureMessages":[],"fullName":"priceCommand replies with English price message for non-Russian user","status":"passed","title":"replies with English price message for non-Russian user"},{"ancestorTitles":["priceCommand"],"duration":1,"failureMessages":[],"fullName":"priceCommand replies with Russian price message for Russian user","status":"passed","title":"replies with Russian price message for Russian user"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171903504,"runtime":204,"slow":false,"start":1745171903300},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/handlers/handleSuccessfulPayment.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["handlePreCheckoutQuery"],"duration":1,"failureMessages":[],"fullName":"handlePreCheckoutQuery calls answerPreCheckoutQuery with true","status":"passed","title":"calls answerPreCheckoutQuery with true"},{"ancestorTitles":["handlePreCheckoutQuery"],"duration":3,"failureMessages":[],"fullName":"handlePreCheckoutQuery propagates errors from answerPreCheckoutQuery","status":"passed","title":"propagates errors from answerPreCheckoutQuery"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171903520,"runtime":225,"slow":false,"start":1745171903295},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/services/generateImageToVideo.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["generateImageToVideo"],"duration":140,"failureMessages":[],"fullName":"generateImageToVideo throws if required parameters missing","status":"passed","title":"throws if required parameters missing"},{"ancestorTitles":["generateImageToVideo"],"duration":23,"failureMessages":[],"fullName":"generateImageToVideo calls axios.post and returns data on success","status":"passed","title":"calls axios.post and returns data on success"},{"ancestorTitles":["generateImageToVideo"],"duration":8,"failureMessages":[],"fullName":"generateImageToVideo throws localized error on axios error","status":"passed","title":"throws localized error on axios error"},{"ancestorTitles":["generateImageToVideo"],"duration":2,"failureMessages":[],"fullName":"generateImageToVideo throws original error on non-axios error","status":"passed","title":"throws original error on non-axios error"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171903758,"runtime":227,"slow":false,"start":1745171903531},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getPaymentsInfoByTelegramId.unit.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getPaymentsInfoByTelegramId"],"duration":4,"failureMessages":[],"fullName":"getPaymentsInfoByTelegramId returns empty array on error","status":"passed","title":"returns empty array on error"},{"ancestorTitles":["getPaymentsInfoByTelegramId"],"duration":2,"failureMessages":[],"fullName":"getPaymentsInfoByTelegramId returns payments data when present","status":"passed","title":"returns payments data when present"},{"ancestorTitles":["getPaymentsInfoByTelegramId"],"duration":1,"failureMessages":[],"fullName":"getPaymentsInfoByTelegramId returns empty array when no payments found","status":"passed","title":"returns empty array when no payments found"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171903707,"runtime":389,"slow":false,"start":1745171903318},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getBotGroupFromAvatars.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getBotGroupFromAvatars"],"duration":66,"failureMessages":[],"fullName":"getBotGroupFromAvatars returns group when data found","status":"passed","title":"returns group when data found"},{"ancestorTitles":["getBotGroupFromAvatars"],"duration":232,"failureMessages":[],"fullName":"getBotGroupFromAvatars returns null when error in response","status":"passed","title":"returns null when error in response"},{"ancestorTitles":["getBotGroupFromAvatars"],"duration":28,"failureMessages":[],"fullName":"getBotGroupFromAvatars returns null when exception thrown","status":"passed","title":"returns null when exception thrown"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171903763,"runtime":270,"slow":false,"start":1745171903493},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/openai/getMeditationSteps.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getMeditationSteps"],"duration":4,"failureMessages":[],"fullName":"getMeditationSteps returns parsed JSON when response has valid JSON content","status":"passed","title":"returns parsed JSON when response has valid JSON content"},{"ancestorTitles":["getMeditationSteps"],"duration":45,"failureMessages":[],"fullName":"getMeditationSteps throws error when content is null","status":"passed","title":"throws error when content is null"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171903795,"runtime":295,"slow":false,"start":1745171903500},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/openai/getAinews.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getAinews"],"duration":3,"failureMessages":[],"fullName":"getAinews returns content when response has valid content","status":"passed","title":"returns content when response has valid content"},{"ancestorTitles":["getAinews"],"duration":7,"failureMessages":[],"fullName":"getAinews throws error when content is null","status":"passed","title":"throws error when content is null"},{"ancestorTitles":["getAinews"],"duration":5,"failureMessages":[],"fullName":"getAinews throws when OpenAI request fails","status":"passed","title":"throws when OpenAI request fails"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171903826,"runtime":306,"slow":false,"start":1745171903520},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/handlers/handleCallback.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["handleCallback"],"duration":2,"failureMessages":[],"fullName":"handleCallback should answer callback query and return on valid data","status":"passed","title":"should answer callback query and return on valid data"},{"ancestorTitles":["handleCallback"],"duration":16,"failureMessages":[],"fullName":"handleCallback should swallow answerCbQuery error but still return on data present","status":"passed","title":"should swallow answerCbQuery error but still return on data present"},{"ancestorTitles":["handleCallback"],"duration":6,"failureMessages":[],"fullName":"handleCallback should throw and answerCbQuery on missing callbackQuery","status":"passed","title":"should throw and answerCbQuery on missing callbackQuery"},{"ancestorTitles":["handleCallback"],"duration":3,"failureMessages":[],"fullName":"handleCallback should throw and call sendGenericErrorMessage on answerCbQuery failure in catch","status":"passed","title":"should throw and call sendGenericErrorMessage on answerCbQuery failure in catch"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171903846,"runtime":39,"slow":false,"start":1745171903807},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/price/helpers/calculateStars.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["calculateStars"],"duration":1,"failureMessages":[],"fullName":"calculateStars floors the division of payment by star cost","status":"passed","title":"floors the division of payment by star cost"},{"ancestorTitles":["calculateStars"],"duration":1,"failureMessages":[],"fullName":"calculateStars returns zero when payment less than star cost","status":"passed","title":"returns zero when payment less than star cost"},{"ancestorTitles":["calculateStars"],"duration":0,"failureMessages":[],"fullName":"calculateStars exact division returns exact result","status":"passed","title":"exact division returns exact result"}]},{"numFailingTests":0,"numPassingTests":5,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171903872,"runtime":52,"slow":false,"start":1745171903820},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getUid.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getUid"],"duration":2,"failureMessages":[],"fullName":"getUid returns null and warns when no telegram_id provided","status":"passed","title":"returns null and warns when no telegram_id provided"},{"ancestorTitles":["getUid"],"duration":15,"failureMessages":[],"fullName":"getUid returns null and logs error when supabase returns error","status":"passed","title":"returns null and logs error when supabase returns error"},{"ancestorTitles":["getUid"],"duration":2,"failureMessages":[],"fullName":"getUid returns null and logs error on exception","status":"passed","title":"returns null and logs error on exception"},{"ancestorTitles":["getUid"],"duration":0,"failureMessages":[],"fullName":"getUid returns user_id and username when data returned","status":"passed","title":"returns user_id and username when data returned"},{"ancestorTitles":["getUid"],"duration":1,"failureMessages":[],"fullName":"getUid returns null user_id and username when data empty","status":"passed","title":"returns null user_id and username when data empty"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171903865,"runtime":68,"slow":false,"start":1745171903797},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/handlers/handleBuySubscription.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["handleBuySubscription"],"duration":2,"failureMessages":[],"fullName":"handleBuySubscription should send invoice for neurophoto subscription and leave scene","status":"passed","title":"should send invoice for neurophoto subscription and leave scene"},{"ancestorTitles":["handleBuySubscription"],"duration":1,"failureMessages":[],"fullName":"handleBuySubscription should default title and description when subscription type unknown","status":"passed","title":"should default title and description when subscription type unknown"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171903115,"runtime":1554,"slow":false,"start":1745171901561},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/commands/index.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["commands index re-exports"],"duration":1,"failureMessages":[],"fullName":"commands index re-exports should export get100Command","status":"passed","title":"should export get100Command"},{"ancestorTitles":["commands index re-exports"],"duration":0,"failureMessages":[],"fullName":"commands index re-exports should export selectModelCommand","status":"passed","title":"should export selectModelCommand"},{"ancestorTitles":["commands index re-exports"],"duration":0,"failureMessages":[],"fullName":"commands index re-exports should export priceCommand","status":"passed","title":"should export priceCommand"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171903979,"runtime":102,"slow":false,"start":1745171903877},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/price/starAmounts.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["starAmounts constant"],"duration":1,"failureMessages":[],"fullName":"starAmounts constant should contain the expected star amounts","status":"passed","title":"should contain the expected star amounts"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171904010,"runtime":124,"slow":false,"start":1745171903886},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getModel.unit.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getModel"],"duration":2,"failureMessages":[],"fullName":"getModel throws error on supabase error","status":"passed","title":"throws error on supabase error"},{"ancestorTitles":["getModel"],"duration":0,"failureMessages":[],"fullName":"getModel throws error when data null","status":"passed","title":"throws error when data null"},{"ancestorTitles":["getModel"],"duration":0,"failureMessages":[],"fullName":"getModel returns data.model on success","status":"passed","title":"returns data.model on success"}]},{"numFailingTests":0,"numPassingTests":5,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171903908,"runtime":67,"slow":false,"start":1745171903841},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/utils/webhooks.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["configureWebhooks util"],"duration":3,"failureMessages":[],"fullName":"configureWebhooks util returns false when disabled","status":"passed","title":"returns false when disabled"},{"ancestorTitles":["configureWebhooks util"],"duration":0,"failureMessages":[],"fullName":"configureWebhooks util returns false when domain missing","status":"passed","title":"returns false when domain missing"},{"ancestorTitles":["configureWebhooks util"],"duration":1,"failureMessages":[],"fullName":"configureWebhooks util sets webhook when enabled and domain present","status":"passed","title":"sets webhook when enabled and domain present"},{"ancestorTitles":["removeWebhook util"],"duration":0,"failureMessages":[],"fullName":"removeWebhook util deletes webhook and logs info","status":"passed","title":"deletes webhook and logs info"},{"ancestorTitles":["removeWebhook util"],"duration":3,"failureMessages":[],"fullName":"removeWebhook util logs error on delete failure","status":"passed","title":"logs error on delete failure"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171904150,"runtime":292,"slow":false,"start":1745171903858},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/utils/tokenStorage.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["tokenStorage utils"],"duration":99,"failureMessages":[],"fullName":"tokenStorage utils stores and retrieves a valid token","status":"passed","title":"stores and retrieves a valid token"},{"ancestorTitles":["tokenStorage utils"],"duration":5,"failureMessages":[],"fullName":"tokenStorage utils getToken returns undefined for nonexistent bot","status":"passed","title":"getToken returns undefined for nonexistent bot"},{"ancestorTitles":["tokenStorage utils"],"duration":15,"failureMessages":[],"fullName":"tokenStorage utils removes a stored token","status":"passed","title":"removes a stored token"}]},{"numFailingTests":0,"numPassingTests":6,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171904180,"runtime":201,"slow":false,"start":1745171903979},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/openaiHelpers.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["core/openai index and helpers"],"duration":12,"failureMessages":[],"fullName":"core/openai index and helpers throws if OPENAI_API_KEY not set","status":"passed","title":"throws if OPENAI_API_KEY not set"},{"ancestorTitles":["core/openai index and helpers"],"duration":5,"failureMessages":[],"fullName":"core/openai index and helpers constructs OpenAI with apiKey","status":"passed","title":"constructs OpenAI with apiKey"},{"ancestorTitles":["core/openai index and helpers","getAinews"],"duration":5,"failureMessages":[],"fullName":"core/openai index and helpers getAinews returns content when provided","status":"passed","title":"returns content when provided"},{"ancestorTitles":["core/openai index and helpers","getAinews"],"duration":114,"failureMessages":[],"fullName":"core/openai index and helpers getAinews throws if content is null","status":"passed","title":"throws if content is null"},{"ancestorTitles":["core/openai index and helpers","getMeditationSteps"],"duration":11,"failureMessages":[],"fullName":"core/openai index and helpers getMeditationSteps parses JSON content","status":"passed","title":"parses JSON content"},{"ancestorTitles":["core/openai index and helpers","getMeditationSteps"],"duration":14,"failureMessages":[],"fullName":"core/openai index and helpers getMeditationSteps throws if content is null","status":"passed","title":"throws if content is null"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171904234,"runtime":197,"slow":false,"start":1745171904037},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/openai/getSlides.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getSlides"],"duration":5,"failureMessages":[],"fullName":"getSlides returns parsed JSON when response has valid JSON content","status":"passed","title":"returns parsed JSON when response has valid JSON content"},{"ancestorTitles":["getSlides"],"duration":33,"failureMessages":[],"fullName":"getSlides throws error when content is null","status":"passed","title":"throws error when content is null"}]},{"numFailingTests":0,"numPassingTests":5,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171904297,"runtime":121,"slow":false,"start":1745171904176},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/scenes/sceneFactory.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["composeWizardScene"],"duration":0,"failureMessages":[],"fullName":"composeWizardScene returns a function to create WizardScene","status":"passed","title":"returns a function to create WizardScene"},{"ancestorTitles":["composeWizardScene"],"duration":12,"failureMessages":[],"fullName":"composeWizardScene creates WizardScene with sceneType and handlers","status":"passed","title":"creates WizardScene with sceneType and handlers"},{"ancestorTitles":["composeWizardScene"],"duration":0,"failureMessages":[],"fullName":"composeWizardScene handlers skip when no message and no callbackQuery","status":"passed","title":"handlers skip when no message and no callbackQuery"},{"ancestorTitles":["composeWizardScene"],"duration":7,"failureMessages":[],"fullName":"composeWizardScene calls step and enter next scene when message present","status":"passed","title":"calls step and enter next scene when message present"},{"ancestorTitles":["composeWizardScene"],"duration":5,"failureMessages":[],"fullName":"composeWizardScene calls leave when nextScene returns undefined","status":"passed","title":"calls leave when nextScene returns undefined"}]},{"numFailingTests":0,"numPassingTests":7,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171904388,"runtime":150,"slow":false,"start":1745171904238},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/handlers/checkFullAccess.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["checkFullAccess"],"duration":1,"failureMessages":[],"fullName":"checkFullAccess returns true for subscription 'neurophoto'","status":"passed","title":"returns true for subscription 'neurophoto'"},{"ancestorTitles":["checkFullAccess"],"duration":0,"failureMessages":[],"fullName":"checkFullAccess returns true for subscription 'neurobase'","status":"passed","title":"returns true for subscription 'neurobase'"},{"ancestorTitles":["checkFullAccess"],"duration":1,"failureMessages":[],"fullName":"checkFullAccess returns true for subscription 'neuromeeting'","status":"passed","title":"returns true for subscription 'neuromeeting'"},{"ancestorTitles":["checkFullAccess"],"duration":0,"failureMessages":[],"fullName":"checkFullAccess returns true for subscription 'neuroblogger'","status":"passed","title":"returns true for subscription 'neuroblogger'"},{"ancestorTitles":["checkFullAccess"],"duration":0,"failureMessages":[],"fullName":"checkFullAccess returns true for subscription 'neurotester'","status":"passed","title":"returns true for subscription 'neurotester'"},{"ancestorTitles":["checkFullAccess"],"duration":0,"failureMessages":[],"fullName":"checkFullAccess returns false for unknown subscription","status":"passed","title":"returns false for unknown subscription"},{"ancestorTitles":["checkFullAccess"],"duration":0,"failureMessages":[],"fullName":"checkFullAccess returns false for empty string","status":"passed","title":"returns false for empty string"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171903695,"runtime":954,"slow":false,"start":1745171902741},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/menu/createGenerateImageKeyboard.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["createGenerateImageKeyboard"],"duration":6,"failureMessages":[],"fullName":"createGenerateImageKeyboard returns correct inline keyboard with generate and cancel buttons","status":"passed","title":"returns correct inline keyboard with generate and cancel buttons"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171904455,"runtime":403,"slow":false,"start":1745171904052},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/utils/imagesIndex.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["helpers/images index exports"],"duration":1,"failureMessages":[],"fullName":"helpers/images index exports exports createImagesZip and isValidImage","status":"passed","title":"exports createImagesZip and isValidImage"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171904488,"runtime":423,"slow":false,"start":1745171904065},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/openai/getTriggerReel.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getTriggerReel"],"duration":22,"failureMessages":[],"fullName":"getTriggerReel returns content when response has valid content","status":"passed","title":"returns content when response has valid content"},{"ancestorTitles":["getTriggerReel"],"duration":4,"failureMessages":[],"fullName":"getTriggerReel throws error when content is null","status":"passed","title":"throws error when content is null"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171904590,"runtime":107,"slow":false,"start":1745171904483},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/savePrompt.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["savePrompt"],"duration":1,"failureMessages":[],"fullName":"savePrompt returns null when select throws error","status":"passed","title":"returns null when select throws error"},{"ancestorTitles":["savePrompt"],"duration":0,"failureMessages":[],"fullName":"savePrompt returns existing prompt_id when found","status":"passed","title":"returns existing prompt_id when found"},{"ancestorTitles":["savePrompt"],"duration":1,"failureMessages":[],"fullName":"savePrompt inserts and returns new prompt_id when not found","status":"passed","title":"inserts and returns new prompt_id when not found"},{"ancestorTitles":["savePrompt"],"duration":2,"failureMessages":[],"fullName":"savePrompt returns null when insert fails","status":"passed","title":"returns null when insert fails"}]},{"numFailingTests":0,"numPassingTests":13,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171904602,"runtime":360,"slow":false,"start":1745171904242},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/utils/pureFunctions.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["Pure utility functions","urlJoin"],"duration":1,"failureMessages":[],"fullName":"Pure utility functions urlJoin joins paths correctly without duplicate slashes","status":"passed","title":"joins paths correctly without duplicate slashes"},{"ancestorTitles":["Pure utility functions","urlJoin"],"duration":0,"failureMessages":[],"fullName":"Pure utility functions urlJoin returns base when no paths","status":"passed","title":"returns base when no paths"},{"ancestorTitles":["Pure utility functions","isRussian"],"duration":0,"failureMessages":[],"fullName":"Pure utility functions isRussian returns true when language_code is ru","status":"passed","title":"returns true when language_code is ru"},{"ancestorTitles":["Pure utility functions","isRussian"],"duration":0,"failureMessages":[],"fullName":"Pure utility functions isRussian returns false otherwise","status":"passed","title":"returns false otherwise"},{"ancestorTitles":["Pure utility functions","price calculations"],"duration":0,"failureMessages":[],"fullName":"Pure utility functions price calculations calculateCostInStars divides by starCost","status":"passed","title":"calculateCostInStars divides by starCost"},{"ancestorTitles":["Pure utility functions","price calculations"],"duration":0,"failureMessages":[],"fullName":"Pure utility functions price calculations calculateStars floors paymentAmount / starCost","status":"passed","title":"calculateStars floors paymentAmount / starCost"},{"ancestorTitles":["Pure utility functions","price calculations"],"duration":0,"failureMessages":[],"fullName":"Pure utility functions price calculations calculateFinalPrice returns floor of finalPrice/starCost","status":"passed","title":"calculateFinalPrice returns floor of finalPrice/starCost"},{"ancestorTitles":["Pure utility functions","calculateTrainingCost functions"],"duration":0,"failureMessages":[],"fullName":"Pure utility functions calculateTrainingCost functions calculates training stars cost correctly","status":"passed","title":"calculates training stars cost correctly"},{"ancestorTitles":["Pure utility functions","calculateTrainingCost functions"],"duration":0,"failureMessages":[],"fullName":"Pure utility functions calculateTrainingCost functions calculates training dollars cost correctly","status":"passed","title":"calculates training dollars cost correctly"},{"ancestorTitles":["Pure utility functions","calculateTrainingCost functions"],"duration":0,"failureMessages":[],"fullName":"Pure utility functions calculateTrainingCost functions calculates training rubles cost correctly","status":"passed","title":"calculates training rubles cost correctly"},{"ancestorTitles":["Pure utility functions","starAmounts"],"duration":0,"failureMessages":[],"fullName":"Pure utility functions starAmounts contains expected star amounts","status":"passed","title":"contains expected star amounts"},{"ancestorTitles":["Pure utility functions","getConfig"],"duration":1,"failureMessages":[],"fullName":"Pure utility functions getConfig returns config with default and env values","status":"passed","title":"returns config with default and env values"},{"ancestorTitles":["Pure utility functions","getConfig"],"duration":0,"failureMessages":[],"fullName":"Pure utility functions getConfig returns default port when PORT not set","status":"passed","title":"returns default port when PORT not set"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171904667,"runtime":170,"slow":false,"start":1745171904497},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getLatestUserModel.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getLatestUserModel"],"duration":36,"failureMessages":[],"fullName":"getLatestUserModel returns model data on success","status":"passed","title":"returns model data on success"},{"ancestorTitles":["getLatestUserModel"],"duration":4,"failureMessages":[],"fullName":"getLatestUserModel returns null on error","status":"passed","title":"returns null on error"},{"ancestorTitles":["getLatestUserModel"],"duration":9,"failureMessages":[],"fullName":"getLatestUserModel returns null on exception","status":"passed","title":"returns null on exception"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171904692,"runtime":108,"slow":false,"start":1745171904584},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/openai/getCaptionForNews.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getCaptionForNews"],"duration":6,"failureMessages":[],"fullName":"getCaptionForNews should call OpenAI chat completion with correct parameters and return content","status":"passed","title":"should call OpenAI chat completion with correct parameters and return content"},{"ancestorTitles":["getCaptionForNews"],"duration":28,"failureMessages":[],"fullName":"getCaptionForNews should throw if OpenAI returns null content","status":"passed","title":"should throw if OpenAI returns null content"},{"ancestorTitles":["getCaptionForNews"],"duration":5,"failureMessages":[],"fullName":"getCaptionForNews should propagate errors from the OpenAI client","status":"passed","title":"should propagate errors from the OpenAI client"}]},{"numFailingTests":0,"numPassingTests":7,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171904931,"runtime":378,"slow":false,"start":1745171904553},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/replicate.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["core/replicate client and utilities"],"duration":107,"failureMessages":[],"fullName":"core/replicate client and utilities constructs Replicate with auth token","status":"passed","title":"constructs Replicate with auth token"},{"ancestorTitles":["core/replicate client and utilities"],"duration":1,"failureMessages":[],"fullName":"core/replicate client and utilities modelPricing contains expected entries","status":"passed","title":"modelPricing contains expected entries"},{"ancestorTitles":["core/replicate client and utilities","models.flux.getInput"],"duration":9,"failureMessages":[],"fullName":"core/replicate client and utilities models.flux.getInput defaults to 16:9","status":"passed","title":"defaults to 16:9"},{"ancestorTitles":["core/replicate client and utilities","models.flux.getInput"],"duration":10,"failureMessages":[],"fullName":"core/replicate client and utilities models.flux.getInput handles 1:1","status":"passed","title":"handles 1:1"},{"ancestorTitles":["core/replicate client and utilities","models.flux.getInput"],"duration":6,"failureMessages":[],"fullName":"core/replicate client and utilities models.flux.getInput handles 9:16","status":"passed","title":"handles 9:16"},{"ancestorTitles":["core/replicate client and utilities","models.flux.getInput"],"duration":0,"failureMessages":[],"fullName":"core/replicate client and utilities models.flux.getInput defaults dims for unknown ratio","status":"passed","title":"defaults dims for unknown ratio"},{"ancestorTitles":["core/replicate client and utilities"],"duration":13,"failureMessages":[],"fullName":"core/replicate client and utilities invokes getInput wrapper for all models","status":"passed","title":"invokes getInput wrapper for all models"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171905034,"runtime":349,"slow":false,"start":1745171904685},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getTelegramIdByUserId.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getTelegramIdByUserId"],"duration":2,"failureMessages":[],"fullName":"getTelegramIdByUserId returns telegram_id when found","status":"passed","title":"returns telegram_id when found"},{"ancestorTitles":["getTelegramIdByUserId"],"duration":8,"failureMessages":[],"fullName":"getTelegramIdByUserId returns null on error","status":"passed","title":"returns null on error"},{"ancestorTitles":["getTelegramIdByUserId"],"duration":4,"failureMessages":[],"fullName":"getTelegramIdByUserId returns null when no data","status":"passed","title":"returns null when no data"},{"ancestorTitles":["getTelegramIdByUserId"],"duration":100,"failureMessages":[],"fullName":"getTelegramIdByUserId throws on exception","status":"passed","title":"throws on exception"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171904930,"runtime":663,"slow":false,"start":1745171904267},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/openai/getSubtitles.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getSubtitles"],"duration":56,"failureMessages":[],"fullName":"getSubtitles returns parsed JSON when response has valid JSON content","status":"passed","title":"returns parsed JSON when response has valid JSON content"},{"ancestorTitles":["getSubtitles"],"duration":180,"failureMessages":[],"fullName":"getSubtitles throws error when content is null","status":"passed","title":"throws error when content is null"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171905094,"runtime":459,"slow":false,"start":1745171904635},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/helpers/error/processApiResponse.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["processApiResponse"],"duration":1,"failureMessages":[],"fullName":"processApiResponse returns string if output is string","status":"passed","title":"returns string if output is string"},{"ancestorTitles":["processApiResponse"],"duration":0,"failureMessages":[],"fullName":"processApiResponse returns first element if output is array","status":"passed","title":"returns first element if output is array"},{"ancestorTitles":["processApiResponse"],"duration":0,"failureMessages":[],"fullName":"processApiResponse returns output property if output is object with output","status":"passed","title":"returns output property if output is object with output"},{"ancestorTitles":["processApiResponse"],"duration":23,"failureMessages":[],"fullName":"processApiResponse throws error for invalid api response","status":"passed","title":"throws error for invalid api response"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171905118,"runtime":232,"slow":false,"start":1745171904886},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getUserByTelegramId.unit.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getUserByTelegramId"],"duration":3,"failureMessages":[],"fullName":"getUserByTelegramId returns null if select returns error","status":"passed","title":"returns null if select returns error"},{"ancestorTitles":["getUserByTelegramId"],"duration":1,"failureMessages":[],"fullName":"getUserByTelegramId returns data and does not update if bot_name matches","status":"passed","title":"returns data and does not update if bot_name matches"},{"ancestorTitles":["getUserByTelegramId"],"duration":1,"failureMessages":[],"fullName":"getUserByTelegramId updates bot_name when differs and returns data","status":"passed","title":"updates bot_name when differs and returns data"},{"ancestorTitles":["getUserByTelegramId"],"duration":55,"failureMessages":[],"fullName":"getUserByTelegramId returns null on unexpected exception","status":"passed","title":"returns null on unexpected exception"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171905035,"runtime":606,"slow":false,"start":1745171904429},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/openai/upgradePrompt.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["upgradePrompt"],"duration":5,"failureMessages":[],"fullName":"upgradePrompt returns upgraded prompt from OpenAI","status":"passed","title":"returns upgraded prompt from OpenAI"},{"ancestorTitles":["upgradePrompt"],"duration":106,"failureMessages":[],"fullName":"upgradePrompt throws error when OpenAI request fails","status":"passed","title":"throws error when OpenAI request fails"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171905129,"runtime":430,"slow":false,"start":1745171904699},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/setAspectRatio.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["setAspectRatio"],"duration":17,"failureMessages":[],"fullName":"setAspectRatio returns true on successful update","status":"passed","title":"returns true on successful update"},{"ancestorTitles":["setAspectRatio"],"duration":91,"failureMessages":[],"fullName":"setAspectRatio returns false on error","status":"passed","title":"returns false on error"}]},{"numFailingTests":0,"numPassingTests":7,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171905118,"runtime":83,"slow":false,"start":1745171905035},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/price/priceCalculator.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["calculateCost"],"duration":3,"failureMessages":[],"fullName":"calculateCost calculates correct cost details","status":"passed","title":"calculates correct cost details"},{"ancestorTitles":["formatCost"],"duration":0,"failureMessages":[],"fullName":"formatCost formats cost for Russian locale","status":"passed","title":"formats cost for Russian locale"},{"ancestorTitles":["formatCost"],"duration":1,"failureMessages":[],"fullName":"formatCost formats cost for English locale","status":"passed","title":"formats cost for English locale"},{"ancestorTitles":["generateCostMessage"],"duration":3,"failureMessages":[],"fullName":"generateCostMessage generates message with list of costs for Russian locale","status":"passed","title":"generates message with list of costs for Russian locale"},{"ancestorTitles":["generateCostMessage"],"duration":3,"failureMessages":[],"fullName":"generateCostMessage generates message with list of costs for English locale","status":"passed","title":"generates message with list of costs for English locale"},{"ancestorTitles":["stepOptions and costDetails arrays"],"duration":0,"failureMessages":[],"fullName":"stepOptions and costDetails arrays stepOptions and costDetails have same length","status":"passed","title":"stepOptions and costDetails have same length"},{"ancestorTitles":["stepOptions and costDetails arrays"],"duration":7,"failureMessages":[],"fullName":"stepOptions and costDetails arrays costDetails elements match calculateCost for corresponding steps","status":"passed","title":"costDetails elements match calculateCost for corresponding steps"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171905650,"runtime":551,"slow":false,"start":1745171905099},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getPrompt.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getPrompt"],"duration":5,"failureMessages":[],"fullName":"getPrompt returns data when found and no error","status":"passed","title":"returns data when found and no error"},{"ancestorTitles":["getPrompt"],"duration":1,"failureMessages":[],"fullName":"getPrompt returns null and logs error when error in response","status":"passed","title":"returns null and logs error when error in response"},{"ancestorTitles":["getPrompt"],"duration":18,"failureMessages":[],"fullName":"getPrompt returns null and logs error when no data","status":"passed","title":"returns null and logs error when no data"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171905702,"runtime":569,"slow":false,"start":1745171905133},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getUserModel.unit.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getUserModel"],"duration":9,"failureMessages":[],"fullName":"getUserModel returns default model when supabase returns error","status":"passed","title":"returns default model when supabase returns error"},{"ancestorTitles":["getUserModel"],"duration":0,"failureMessages":[],"fullName":"getUserModel returns user model when data is present","status":"passed","title":"returns user model when data is present"},{"ancestorTitles":["getUserModel"],"duration":0,"failureMessages":[],"fullName":"getUserModel returns default model when data.model is undefined","status":"passed","title":"returns default model when data.model is undefined"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171905766,"runtime":240,"slow":false,"start":1745171905526},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/price/models.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["Image Model Prices"],"duration":39,"failureMessages":[],"fullName":"Image Model Prices should have at least one model entry with the correct structure","status":"passed","title":"should have at least one model entry with the correct structure"},{"ancestorTitles":["Video Model Prices"],"duration":0,"failureMessages":[],"fullName":"Video Model Prices should have correct base prices for known video models","status":"passed","title":"should have correct base prices for known video models"},{"ancestorTitles":["calculateFinalImageCostInStars"],"duration":3,"failureMessages":[],"fullName":"calculateFinalImageCostInStars calculates ceiling of (baseCost * (1 + interestRate) / starCost)","status":"passed","title":"calculates ceiling of (baseCost * (1 + interestRate) / starCost)"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171905768,"runtime":144,"slow":false,"start":1745171905624},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/price/index.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["Price Module","calculateDiscountedPrice"],"duration":0,"failureMessages":[],"fullName":"Price Module calculateDiscountedPrice applies discount correctly within range","status":"passed","title":"applies discount correctly within range"},{"ancestorTitles":["Price Module","module constants"],"duration":0,"failureMessages":[],"fullName":"Price Module module constants exports correct interestRate and basePrice","status":"passed","title":"exports correct interestRate and basePrice"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171905824,"runtime":148,"slow":false,"start":1745171905676},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/menu/sendPromptImprovementFailureMessage.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["sendPromptImprovementFailureMessage"],"duration":2,"failureMessages":[],"fullName":"sendPromptImprovementFailureMessage sends Russian failure message when isRu true","status":"passed","title":"sends Russian failure message when isRu true"},{"ancestorTitles":["sendPromptImprovementFailureMessage"],"duration":0,"failureMessages":[],"fullName":"sendPromptImprovementFailureMessage sends English failure message when isRu false","status":"passed","title":"sends English failure message when isRu false"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171905827,"runtime":461,"slow":false,"start":1745171905366},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getModel.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getModel"],"duration":18,"failureMessages":[],"fullName":"getModel returns model when data exists","status":"passed","title":"returns model when data exists"},{"ancestorTitles":["getModel"],"duration":13,"failureMessages":[],"fullName":"getModel throws error when response has error","status":"passed","title":"throws error when response has error"},{"ancestorTitles":["getModel"],"duration":1,"failureMessages":[],"fullName":"getModel throws error when response has no data","status":"passed","title":"throws error when response has no data"},{"ancestorTitles":["getModel"],"duration":1,"failureMessages":[],"fullName":"getModel throws error when supabase chain rejects","status":"passed","title":"throws error when supabase chain rejects"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171905837,"runtime":369,"slow":false,"start":1745171905468},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/openai/requests.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["answerAi"],"duration":1,"failureMessages":[],"fullName":"answerAi returns content when GPT provides a message","status":"passed","title":"returns content when GPT provides a message"},{"ancestorTitles":["answerAi"],"duration":4,"failureMessages":[],"fullName":"answerAi throws error when content is empty","status":"passed","title":"throws error when content is empty"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171905851,"runtime":35,"slow":false,"start":1745171905816},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/middlewares/getUserPhotoUrl.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getUserPhotoUrl"],"duration":1,"failureMessages":[],"fullName":"getUserPhotoUrl returns null when no photos","status":"passed","title":"returns null when no photos"},{"ancestorTitles":["getUserPhotoUrl"],"duration":1,"failureMessages":[],"fullName":"getUserPhotoUrl returns null when file_path missing","status":"passed","title":"returns null when file_path missing"},{"ancestorTitles":["getUserPhotoUrl"],"duration":0,"failureMessages":[],"fullName":"getUserPhotoUrl returns full URL when file_path present","status":"passed","title":"returns full URL when file_path present"},{"ancestorTitles":["getUserPhotoUrl"],"duration":6,"failureMessages":[],"fullName":"getUserPhotoUrl throws error when getUserProfilePhotos errors","status":"passed","title":"throws error when getUserProfilePhotos errors"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171905861,"runtime":32,"slow":false,"start":1745171905829},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/price/voiceConversationCost.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["voiceConversationCost constant"],"duration":1,"failureMessages":[],"fullName":"voiceConversationCost constant should equal calculateCostInStars(0.99)","status":"passed","title":"should equal calculateCostInStars(0.99)"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171905916,"runtime":71,"slow":false,"start":1745171905845},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/utils/errorMessage.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["errorMessage"],"duration":1,"failureMessages":[],"fullName":"errorMessage sends Russian error message","status":"passed","title":"sends Russian error message"},{"ancestorTitles":["errorMessage"],"duration":0,"failureMessages":[],"fullName":"errorMessage sends English error message","status":"passed","title":"sends English error message"}]},{"numFailingTests":0,"numPassingTests":6,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171905919,"runtime":89,"slow":false,"start":1745171905830},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/isLimitAi.unit.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["isLimitAi"],"duration":2,"failureMessages":[],"fullName":"isLimitAi returns false when user query error","status":"passed","title":"returns false when user query error"},{"ancestorTitles":["isLimitAi"],"duration":1,"failureMessages":[],"fullName":"isLimitAi returns false when limit query error not PGRST116","status":"passed","title":"returns false when limit query error not PGRST116"},{"ancestorTitles":["isLimitAi"],"duration":4,"failureMessages":[],"fullName":"isLimitAi inserts new record when no limitData or date mismatch, return false on success","status":"passed","title":"inserts new record when no limitData or date mismatch, return false on success"},{"ancestorTitles":["isLimitAi"],"duration":1,"failureMessages":[],"fullName":"isLimitAi returns false when insert new record fails","status":"passed","title":"returns false when insert new record fails"},{"ancestorTitles":["isLimitAi"],"duration":0,"failureMessages":[],"fullName":"isLimitAi updates existing record when count < limit and returns false","status":"passed","title":"updates existing record when count < limit and returns false"},{"ancestorTitles":["isLimitAi"],"duration":0,"failureMessages":[],"fullName":"isLimitAi returns true when limit reached","status":"passed","title":"returns true when limit reached"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171905932,"runtime":53,"slow":false,"start":1745171905879},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/createModelTraining.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["createModelTraining"],"duration":1,"failureMessages":[],"fullName":"createModelTraining resolves when insert succeeds","status":"passed","title":"resolves when insert succeeds"},{"ancestorTitles":["createModelTraining"],"duration":5,"failureMessages":[],"fullName":"createModelTraining throws error when insert fails","status":"passed","title":"throws error when insert fails"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171905929,"runtime":101,"slow":false,"start":1745171905828},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/cleanupOldArchives.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["cleanupOldArchives"],"duration":76,"failureMessages":[],"fullName":"cleanupOldArchives does nothing when list errors","status":"passed","title":"does nothing when list errors"},{"ancestorTitles":["cleanupOldArchives"],"duration":1,"failureMessages":[],"fullName":"cleanupOldArchives does nothing when only one file exists","status":"passed","title":"does nothing when only one file exists"},{"ancestorTitles":["cleanupOldArchives"],"duration":1,"failureMessages":[],"fullName":"cleanupOldArchives removes all but latest file","status":"passed","title":"removes all but latest file"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171905937,"runtime":92,"slow":false,"start":1745171905845},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/incrementLimit.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["incrementLimit"],"duration":0,"failureMessages":[],"fullName":"incrementLimit TODO: implement tests for incrementLimit","status":"passed","title":"TODO: implement tests for incrementLimit"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171905943,"runtime":49,"slow":false,"start":1745171905894},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/services/generateImageFromPrompt.unit.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["generateImageFromPrompt"],"duration":1,"failureMessages":[],"fullName":"generateImageFromPrompt logs the input parameters and returns fake URL","status":"passed","title":"logs the input parameters and returns fake URL"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171905961,"runtime":21,"slow":false,"start":1745171905940},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getGeneratedImages.unit.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getGeneratedImages"],"duration":1,"failureMessages":[],"fullName":"getGeneratedImages returns default when error","status":"passed","title":"returns default when error"},{"ancestorTitles":["getGeneratedImages"],"duration":0,"failureMessages":[],"fullName":"getGeneratedImages returns parsed numbers when data present","status":"passed","title":"returns parsed numbers when data present"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171905973,"runtime":43,"slow":false,"start":1745171905930},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/utils/ensureDirectoryExistence.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["ensureDirectoryExistence"],"duration":5,"failureMessages":[],"fullName":"ensureDirectoryExistence should call fs.promises.mkdir with recursive true","status":"passed","title":"should call fs.promises.mkdir with recursive true"},{"ancestorTitles":["ensureDirectoryExistence"],"duration":6,"failureMessages":[],"fullName":"ensureDirectoryExistence should throw if fs.promises.mkdir rejects","status":"passed","title":"should throw if fs.promises.mkdir rejects"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171906016,"runtime":40,"slow":false,"start":1745171905976},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/utils/getConfig.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getConfig"],"duration":0,"failureMessages":[],"fullName":"getConfig returns default values when no env vars are set","status":"passed","title":"returns default values when no env vars are set"},{"ancestorTitles":["getConfig"],"duration":1,"failureMessages":[],"fullName":"getConfig parses PORT and uses provided env vars","status":"passed","title":"parses PORT and uses provided env vars"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171906015,"runtime":63,"slow":false,"start":1745171905952},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/menu/getStepSelectionMenuV2.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getStepSelectionMenuV2"],"duration":2,"failureMessages":[],"fullName":"getStepSelectionMenuV2 builds Russian keyboard correctly","status":"passed","title":"builds Russian keyboard correctly"},{"ancestorTitles":["getStepSelectionMenuV2"],"duration":5,"failureMessages":[],"fullName":"getStepSelectionMenuV2 builds English keyboard correctly","status":"passed","title":"builds English keyboard correctly"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171906022,"runtime":63,"slow":false,"start":1745171905959},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/utils/isValidImage.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["isValidImage"],"duration":7,"failureMessages":[],"fullName":"isValidImage returns true for JPEG header","status":"passed","title":"returns true for JPEG header"},{"ancestorTitles":["isValidImage"],"duration":1,"failureMessages":[],"fullName":"isValidImage returns true for PNG header","status":"passed","title":"returns true for PNG header"},{"ancestorTitles":["isValidImage"],"duration":1,"failureMessages":[],"fullName":"isValidImage returns false for other header","status":"passed","title":"returns false for other header"},{"ancestorTitles":["isValidImage"],"duration":8,"failureMessages":[],"fullName":"isValidImage returns false on error","status":"passed","title":"returns false on error"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171906021,"runtime":76,"slow":false,"start":1745171905945},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/utils/launch.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["Launch Utilities"],"duration":6,"failureMessages":[],"fullName":"Launch Utilities development: deletes webhook and launches bot, logs info","status":"passed","title":"development: deletes webhook and launches bot, logs info"},{"ancestorTitles":["Launch Utilities"],"duration":15,"failureMessages":[],"fullName":"Launch Utilities development: logs error and rethrows on failure","status":"passed","title":"development: logs error and rethrows on failure"},{"ancestorTitles":["Launch Utilities"],"duration":3,"failureMessages":[],"fullName":"Launch Utilities production: sets up webhook and starts express server","status":"passed","title":"production: sets up webhook and starts express server"}]},{"numFailingTests":0,"numPassingTests":7,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171906032,"runtime":347,"slow":false,"start":1745171905685},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/services/generateNeuroImageV2.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["generateNeuroImageV2"],"duration":98,"failureMessages":[],"fullName":"generateNeuroImageV2 throws if ctx.session.prompt missing","status":"passed","title":"throws if ctx.session.prompt missing"},{"ancestorTitles":["generateNeuroImageV2"],"duration":66,"failureMessages":[],"fullName":"generateNeuroImageV2 throws if ctx.session.userModel missing","status":"passed","title":"throws if ctx.session.userModel missing"},{"ancestorTitles":["generateNeuroImageV2"],"duration":1,"failureMessages":[],"fullName":"generateNeuroImageV2 throws if numImages is zero","status":"passed","title":"throws if numImages is zero"},{"ancestorTitles":["generateNeuroImageV2"],"duration":1,"failureMessages":[],"fullName":"generateNeuroImageV2 calls API and returns data on success","status":"passed","title":"calls API and returns data on success"},{"ancestorTitles":["generateNeuroImageV2"],"duration":1,"failureMessages":[],"fullName":"generateNeuroImageV2 replies specific message on NSFW axios error","status":"passed","title":"replies specific message on NSFW axios error"},{"ancestorTitles":["generateNeuroImageV2"],"duration":1,"failureMessages":[],"fullName":"generateNeuroImageV2 replies generic message on other axios error","status":"passed","title":"replies generic message on other axios error"},{"ancestorTitles":["generateNeuroImageV2"],"duration":1,"failureMessages":[],"fullName":"generateNeuroImageV2 throws original error on non-axios error","status":"passed","title":"throws original error on non-axios error"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171906050,"runtime":34,"slow":false,"start":1745171906016},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/handlers/handlePreCheckoutQuery.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["handlePreCheckoutQuery"],"duration":1,"failureMessages":[],"fullName":"handlePreCheckoutQuery calls answerPreCheckoutQuery with true","status":"passed","title":"calls answerPreCheckoutQuery with true"},{"ancestorTitles":["handlePreCheckoutQuery"],"duration":0,"failureMessages":[],"fullName":"handlePreCheckoutQuery propagates error when answerPreCheckoutQuery rejects","status":"passed","title":"propagates error when answerPreCheckoutQuery rejects"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171906061,"runtime":27,"slow":false,"start":1745171906034},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/price/calculateFinalImageCostInStars.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["calculateFinalImageCostInStars"],"duration":0,"failureMessages":[],"fullName":"calculateFinalImageCostInStars calculates correct cost for baseCost = 1","status":"passed","title":"calculates correct cost for baseCost = 1"},{"ancestorTitles":["calculateFinalImageCostInStars"],"duration":0,"failureMessages":[],"fullName":"calculateFinalImageCostInStars returns 0 for baseCost = 0","status":"passed","title":"returns 0 for baseCost = 0"},{"ancestorTitles":["calculateFinalImageCostInStars"],"duration":1,"failureMessages":[],"fullName":"calculateFinalImageCostInStars handles fractional baseCost","status":"passed","title":"handles fractional baseCost"}]},{"numFailingTests":0,"numPassingTests":13,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171906063,"runtime":50,"slow":false,"start":1745171906013},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/utils/env.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["env utils","isWebhookEnv"],"duration":0,"failureMessages":[],"fullName":"env utils isWebhookEnv returns true in production","status":"passed","title":"returns true in production"},{"ancestorTitles":["env utils","isWebhookEnv"],"duration":0,"failureMessages":[],"fullName":"env utils isWebhookEnv returns true when WEBHOOK_DOMAIN is set","status":"passed","title":"returns true when WEBHOOK_DOMAIN is set"},{"ancestorTitles":["env utils","isWebhookEnv"],"duration":0,"failureMessages":[],"fullName":"env utils isWebhookEnv returns false otherwise","status":"passed","title":"returns false otherwise"},{"ancestorTitles":["env utils","getEnvNumber"],"duration":0,"failureMessages":[],"fullName":"env utils getEnvNumber returns default when not defined","status":"passed","title":"returns default when not defined"},{"ancestorTitles":["env utils","getEnvNumber"],"duration":0,"failureMessages":[],"fullName":"env utils getEnvNumber parses integer values","status":"passed","title":"parses integer values"},{"ancestorTitles":["env utils","getEnvNumber"],"duration":0,"failureMessages":[],"fullName":"env utils getEnvNumber returns default on NaN","status":"passed","title":"returns default on NaN"},{"ancestorTitles":["env utils","getEnvBoolean"],"duration":0,"failureMessages":[],"fullName":"env utils getEnvBoolean returns default when not defined","status":"passed","title":"returns default when not defined"},{"ancestorTitles":["env utils","getEnvBoolean"],"duration":1,"failureMessages":[],"fullName":"env utils getEnvBoolean parses truthy strings (case-insensitive)","status":"passed","title":"parses truthy strings (case-insensitive)"},{"ancestorTitles":["env utils","getEnvBoolean"],"duration":0,"failureMessages":[],"fullName":"env utils getEnvBoolean returns false for non-truthy values","status":"passed","title":"returns false for non-truthy values"},{"ancestorTitles":["env utils","getEnvString"],"duration":0,"failureMessages":[],"fullName":"env utils getEnvString returns default when not defined","status":"passed","title":"returns default when not defined"},{"ancestorTitles":["env utils","getEnvString"],"duration":0,"failureMessages":[],"fullName":"env utils getEnvString returns value when defined","status":"passed","title":"returns value when defined"},{"ancestorTitles":["env utils","isDevelopment & isProduction"],"duration":0,"failureMessages":[],"fullName":"env utils isDevelopment & isProduction isDevelopment true when not production","status":"passed","title":"isDevelopment true when not production"},{"ancestorTitles":["env utils","isDevelopment & isProduction"],"duration":0,"failureMessages":[],"fullName":"env utils isDevelopment & isProduction isProduction true when production","status":"passed","title":"isProduction true when production"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171906076,"runtime":49,"slow":false,"start":1745171906027},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/price/models/calculateFinalImageCostInStars.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["calculateFinalImageCostInStars"],"duration":1,"failureMessages":[],"fullName":"calculateFinalImageCostInStars returns 0 when baseCost is 0","status":"passed","title":"returns 0 when baseCost is 0"},{"ancestorTitles":["calculateFinalImageCostInStars"],"duration":0,"failureMessages":[],"fullName":"calculateFinalImageCostInStars calculates correct number of stars","status":"passed","title":"calculates correct number of stars"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171906059,"runtime":33,"slow":false,"start":1745171906026},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/bot/index.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["core/bot index"],"duration":9,"failureMessages":[],"fullName":"core/bot index exports core bot utilities correctly","status":"passed","title":"exports core bot utilities correctly"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171906107,"runtime":68,"slow":false,"start":1745171906039},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/menu/videoModelMenu.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["videoModelKeyboard"],"duration":9,"failureMessages":[],"fullName":"videoModelKeyboard builds keyboard with model names and control buttons in Russian","status":"passed","title":"builds keyboard with model names and control buttons in Russian"},{"ancestorTitles":["videoModelKeyboard"],"duration":1,"failureMessages":[],"fullName":"videoModelKeyboard builds keyboard with model names and control buttons in English","status":"passed","title":"builds keyboard with model names and control buttons in English"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171906120,"runtime":84,"slow":false,"start":1745171906036},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/helpers/error/errorMessage.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["errorMessage"],"duration":2,"failureMessages":[],"fullName":"errorMessage sends Russian message when isRu true","status":"passed","title":"sends Russian message when isRu true"},{"ancestorTitles":["errorMessage"],"duration":0,"failureMessages":[],"fullName":"errorMessage sends English message when isRu false","status":"passed","title":"sends English message when isRu false"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171906121,"runtime":45,"slow":false,"start":1745171906076},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/price/starCost.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["starCost constant"],"duration":1,"failureMessages":[],"fullName":"starCost constant should be a positive number equal to 0.016","status":"passed","title":"should be a positive number equal to 0.016"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171906122,"runtime":54,"slow":false,"start":1745171906068},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getGeneratedImages.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getGeneratedImages"],"duration":2,"failureMessages":[],"fullName":"getGeneratedImages returns count and limit when data exists","status":"passed","title":"returns count and limit when data exists"},{"ancestorTitles":["getGeneratedImages"],"duration":0,"failureMessages":[],"fullName":"getGeneratedImages returns default when error occurs","status":"passed","title":"returns default when error occurs"},{"ancestorTitles":["getGeneratedImages"],"duration":1,"failureMessages":[],"fullName":"getGeneratedImages returns default when no data and no error","status":"passed","title":"returns default when no data and no error"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171906132,"runtime":74,"slow":false,"start":1745171906058},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getPrompt.unit.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getPrompt"],"duration":3,"failureMessages":[],"fullName":"getPrompt returns null on error","status":"passed","title":"returns null on error"},{"ancestorTitles":["getPrompt"],"duration":0,"failureMessages":[],"fullName":"getPrompt returns data when present","status":"passed","title":"returns data when present"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171906132,"runtime":52,"slow":false,"start":1745171906080},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/helpers/error/errorMessageAdmin.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["errorMessageAdmin"],"duration":3,"failureMessages":[],"fullName":"errorMessageAdmin sends message when not in dev","status":"passed","title":"sends message when not in dev"},{"ancestorTitles":["errorMessageAdmin"],"duration":0,"failureMessages":[],"fullName":"errorMessageAdmin does not send message when in dev","status":"passed","title":"does not send message when in dev"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171906151,"runtime":36,"slow":false,"start":1745171906115},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getHistory.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getHistory"],"duration":6,"failureMessages":[],"fullName":"getHistory returns data when query successful","status":"passed","title":"returns data when query successful"},{"ancestorTitles":["getHistory"],"duration":1,"failureMessages":[],"fullName":"getHistory returns empty array when error","status":"passed","title":"returns empty array when error"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171906347,"runtime":210,"slow":false,"start":1745171906137},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/utils/getConfigEnv.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getConfig"],"duration":1,"failureMessages":[],"fullName":"getConfig returns default configuration when env vars are not set","status":"passed","title":"returns default configuration when env vars are not set"},{"ancestorTitles":["getConfig"],"duration":1,"failureMessages":[],"fullName":"getConfig parses environment variables correctly","status":"passed","title":"parses environment variables correctly"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171906359,"runtime":235,"slow":false,"start":1745171906124},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/menu/sendPhotoDescriptionRequest.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["sendPhotoDescriptionRequest"],"duration":192,"failureMessages":[],"fullName":"sendPhotoDescriptionRequest sends Russian prompt for neuro_photo mode","status":"passed","title":"sends Russian prompt for neuro_photo mode"},{"ancestorTitles":["sendPhotoDescriptionRequest"],"duration":3,"failureMessages":[],"fullName":"sendPhotoDescriptionRequest sends Russian prompt for other mode","status":"passed","title":"sends Russian prompt for other mode"},{"ancestorTitles":["sendPhotoDescriptionRequest"],"duration":1,"failureMessages":[],"fullName":"sendPhotoDescriptionRequest sends English prompt for neuro_photo mode","status":"passed","title":"sends English prompt for neuro_photo mode"},{"ancestorTitles":["sendPhotoDescriptionRequest"],"duration":8,"failureMessages":[],"fullName":"sendPhotoDescriptionRequest sends English prompt for other mode","status":"passed","title":"sends English prompt for other mode"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171906462,"runtime":324,"slow":false,"start":1745171906138},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/price/helpers/calculateCostInStars.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["calculateCostInStars"],"duration":1,"failureMessages":[],"fullName":"calculateCostInStars returns 0 when costInDollars is 0","status":"passed","title":"returns 0 when costInDollars is 0"},{"ancestorTitles":["calculateCostInStars"],"duration":1,"failureMessages":[],"fullName":"calculateCostInStars returns 1 when costInDollars equals starCost","status":"passed","title":"returns 1 when costInDollars equals starCost"},{"ancestorTitles":["calculateCostInStars"],"duration":1,"failureMessages":[],"fullName":"calculateCostInStars calculates correctly for arbitrary cost","status":"passed","title":"calculates correctly for arbitrary cost"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171906475,"runtime":349,"slow":false,"start":1745171906126},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/utils/deleteFile.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["deleteFile"],"duration":6,"failureMessages":[],"fullName":"deleteFile should call fs.promises.unlink with given path","status":"passed","title":"should call fs.promises.unlink with given path"},{"ancestorTitles":["deleteFile"],"duration":90,"failureMessages":[],"fullName":"deleteFile should not throw when unlink rejects","status":"passed","title":"should not throw when unlink rejects"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171906491,"runtime":336,"slow":false,"start":1745171906155},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/payments/rublePaymentScene.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["rublePaymentScene"],"duration":2,"failureMessages":[],"fullName":"rublePaymentScene should run a basic test","status":"passed","title":"should run a basic test"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171906620,"runtime":238,"slow":false,"start":1745171906382},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getTelegramIdByUserId.unit.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getTelegramIdByUserId"],"duration":16,"failureMessages":[],"fullName":"getTelegramIdByUserId returns null on error","status":"passed","title":"returns null on error"},{"ancestorTitles":["getTelegramIdByUserId"],"duration":0,"failureMessages":[],"fullName":"getTelegramIdByUserId returns telegram_id when data present","status":"passed","title":"returns telegram_id when data present"},{"ancestorTitles":["getTelegramIdByUserId"],"duration":86,"failureMessages":[],"fullName":"getTelegramIdByUserId throws on exception","status":"passed","title":"throws on exception"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171906624,"runtime":145,"slow":false,"start":1745171906479},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/menu/cancelHelpArray.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["cancelHelpArray"],"duration":0,"failureMessages":[],"fullName":"cancelHelpArray returns Russian array when isRu true","status":"passed","title":"returns Russian array when isRu true"},{"ancestorTitles":["cancelHelpArray"],"duration":0,"failureMessages":[],"fullName":"cancelHelpArray returns English array when isRu false","status":"passed","title":"returns English array when isRu false"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171906366,"runtime":242,"slow":false,"start":1745171906124},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/middlewares/verifySubscription.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["verifySubscription"],"duration":18,"failureMessages":[],"fullName":"verifySubscription returns true and does not call handleSubscriptionMessage when subscribed","status":"passed","title":"returns true and does not call handleSubscriptionMessage when subscribed"},{"ancestorTitles":["verifySubscription"],"duration":6,"failureMessages":[],"fullName":"verifySubscription calls handleSubscriptionMessage and returns false when not subscribed","status":"passed","title":"calls handleSubscriptionMessage and returns false when not subscribed"},{"ancestorTitles":["verifySubscription"],"duration":191,"failureMessages":[],"fullName":"verifySubscription propagates error from checkSubscription","status":"passed","title":"propagates error from checkSubscription"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171906638,"runtime":137,"slow":false,"start":1745171906501},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/updateUserVoice.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["updateUserVoice"],"duration":0,"failureMessages":[],"fullName":"updateUserVoice TODO: implement tests for updateUserVoice","status":"passed","title":"TODO: implement tests for updateUserVoice"}]},{"numFailingTests":0,"numPassingTests":6,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171906493,"runtime":354,"slow":false,"start":1745171906139},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/utils/configFile.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["loadBotsConfig"],"duration":2,"failureMessages":[],"fullName":"loadBotsConfig returns empty array and logs error when config file does not exist","status":"passed","title":"returns empty array and logs error when config file does not exist"},{"ancestorTitles":["loadBotsConfig"],"duration":1,"failureMessages":[],"fullName":"loadBotsConfig parses valid config and disables invalid tokens","status":"passed","title":"parses valid config and disables invalid tokens"},{"ancestorTitles":["loadBotsConfig"],"duration":3,"failureMessages":[],"fullName":"loadBotsConfig disables duplicate bot names","status":"passed","title":"disables duplicate bot names"},{"ancestorTitles":["loadSecurityConfig"],"duration":3,"failureMessages":[],"fullName":"loadSecurityConfig returns default security config when no file","status":"passed","title":"returns default security config when no file"},{"ancestorTitles":["loadSecurityConfig"],"duration":0,"failureMessages":[],"fullName":"loadSecurityConfig loads security config from file","status":"passed","title":"loads security config from file"},{"ancestorTitles":["loadSecurityConfig"],"duration":0,"failureMessages":[],"fullName":"loadSecurityConfig logs error and returns default on JSON parse error","status":"passed","title":"logs error and returns default on JSON parse error"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171906720,"runtime":79,"slow":false,"start":1745171906641},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/price/models/videoModelPrices.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["videoModelPrices mapping"],"duration":2,"failureMessages":[],"fullName":"videoModelPrices mapping matches expected video model price mappings","status":"passed","title":"matches expected video model price mappings"}]},{"numFailingTests":0,"numPassingTests":5,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171906745,"runtime":378,"slow":false,"start":1745171906367},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/incrementGeneratedImages.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["incrementGeneratedImages"],"duration":3,"failureMessages":[],"fullName":"incrementGeneratedImages inserts new user when error code PGRST116 and insert succeeds","status":"passed","title":"inserts new user when error code PGRST116 and insert succeeds"},{"ancestorTitles":["incrementGeneratedImages"],"duration":3,"failureMessages":[],"fullName":"incrementGeneratedImages returns false when insert fails","status":"passed","title":"returns false when insert fails"},{"ancestorTitles":["incrementGeneratedImages"],"duration":1,"failureMessages":[],"fullName":"incrementGeneratedImages updates existing user when data present and update succeeds","status":"passed","title":"updates existing user when data present and update succeeds"},{"ancestorTitles":["incrementGeneratedImages"],"duration":0,"failureMessages":[],"fullName":"incrementGeneratedImages returns false when update fails","status":"passed","title":"returns false when update fails"},{"ancestorTitles":["incrementGeneratedImages"],"duration":4,"failureMessages":[],"fullName":"incrementGeneratedImages returns false when error not PGRST116 and no data","status":"passed","title":"returns false when error not PGRST116 and no data"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171906739,"runtime":63,"slow":false,"start":1745171906676},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/price/imageModelPrices.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["imageModelPrices"],"duration":1,"failureMessages":[],"fullName":"imageModelPrices should contain key flux-1.1-pro with correct cost","status":"passed","title":"should contain key flux-1.1-pro with correct cost"},{"ancestorTitles":["imageModelPrices"],"duration":2,"failureMessages":[],"fullName":"imageModelPrices should have valid inputType array","status":"passed","title":"should have valid inputType array"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171906778,"runtime":50,"slow":false,"start":1745171906728},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getPaymentsInfoByTelegramId.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getPaymentsInfoByTelegramId"],"duration":2,"failureMessages":[],"fullName":"getPaymentsInfoByTelegramId returns payment data when query succeeds","status":"passed","title":"returns payment data when query succeeds"},{"ancestorTitles":["getPaymentsInfoByTelegramId"],"duration":3,"failureMessages":[],"fullName":"getPaymentsInfoByTelegramId returns empty array and logs error when query fails","status":"passed","title":"returns empty array and logs error when query fails"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171906781,"runtime":143,"slow":false,"start":1745171906638},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/pinata.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["core/pinata client"],"duration":10,"failureMessages":[],"fullName":"core/pinata client constructs PinataSDK with correct options","status":"passed","title":"constructs PinataSDK with correct options"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171906787,"runtime":21,"slow":false,"start":1745171906766},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getBotGroupFromAvatars.unit.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getBotGroupFromAvatars"],"duration":0,"failureMessages":[],"fullName":"getBotGroupFromAvatars returns group when data present","status":"passed","title":"returns group when data present"},{"ancestorTitles":["getBotGroupFromAvatars"],"duration":1,"failureMessages":[],"fullName":"getBotGroupFromAvatars returns null on error and logs","status":"passed","title":"returns null on error and logs"},{"ancestorTitles":["getBotGroupFromAvatars"],"duration":0,"failureMessages":[],"fullName":"getBotGroupFromAvatars returns null on exception and logs","status":"passed","title":"returns null on exception and logs"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171906793,"runtime":59,"slow":false,"start":1745171906734},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/utils/delay.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["delay"],"duration":0,"failureMessages":[],"fullName":"delay resolves after given ms","status":"passed","title":"resolves after given ms"},{"ancestorTitles":["delay"],"duration":0,"failureMessages":[],"fullName":"delay resolves on zero ms","status":"passed","title":"resolves on zero ms"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171906801,"runtime":59,"slow":false,"start":1745171906742},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getUserData.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getUserData"],"duration":2,"failureMessages":[],"fullName":"getUserData returns user data when found","status":"passed","title":"returns user data when found"},{"ancestorTitles":["getUserData"],"duration":5,"failureMessages":[],"fullName":"getUserData throws error when supabase returns error","status":"passed","title":"throws error when supabase returns error"},{"ancestorTitles":["getUserData"],"duration":15,"failureMessages":[],"fullName":"getUserData returns undefined when no data and no error","status":"passed","title":"returns undefined when no data and no error"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171906812,"runtime":182,"slow":false,"start":1745171906630},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/deleteFileFromSupabase.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["deleteFileFromSupabase"],"duration":5,"failureMessages":[],"fullName":"deleteFileFromSupabase calls remove with correct bucket and filename","status":"passed","title":"calls remove with correct bucket and filename"},{"ancestorTitles":["deleteFileFromSupabase"],"duration":3,"failureMessages":[],"fullName":"deleteFileFromSupabase handles Supabase error without throwing","status":"passed","title":"handles Supabase error without throwing"},{"ancestorTitles":["deleteFileFromSupabase"],"duration":8,"failureMessages":[],"fullName":"deleteFileFromSupabase catches exception and does not throw","status":"passed","title":"catches exception and does not throw"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171906917,"runtime":124,"slow":false,"start":1745171906793},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/handlers/getPhotoUrl.unit.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getPhotoUrl unit tests"],"duration":9,"failureMessages":[],"fullName":"getPhotoUrl unit tests returns URL for first token","status":"passed","title":"returns URL for first token"},{"ancestorTitles":["getPhotoUrl unit tests"],"duration":0,"failureMessages":[],"fullName":"getPhotoUrl unit tests returns URL for second token","status":"passed","title":"returns URL for second token"},{"ancestorTitles":["getPhotoUrl unit tests"],"duration":0,"failureMessages":[],"fullName":"getPhotoUrl unit tests returns URL for third token","status":"passed","title":"returns URL for third token"},{"ancestorTitles":["getPhotoUrl unit tests"],"duration":0,"failureMessages":[],"fullName":"getPhotoUrl unit tests falls back to default for unknown token","status":"passed","title":"falls back to default for unknown token"}]},{"numFailingTests":0,"numPassingTests":5,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171906812,"runtime":62,"slow":false,"start":1745171906750},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getUidInviter.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getUidInviter"],"duration":2,"failureMessages":[],"fullName":"getUidInviter returns null and warns when no telegram_id provided","status":"passed","title":"returns null and warns when no telegram_id provided"},{"ancestorTitles":["getUidInviter"],"duration":1,"failureMessages":[],"fullName":"getUidInviter returns null and logs error when supabase returns error","status":"passed","title":"returns null and logs error when supabase returns error"},{"ancestorTitles":["getUidInviter"],"duration":5,"failureMessages":[],"fullName":"getUidInviter returns inviter info when data returned","status":"passed","title":"returns inviter info when data returned"},{"ancestorTitles":["getUidInviter"],"duration":0,"failureMessages":[],"fullName":"getUidInviter returns null fields when data empty","status":"passed","title":"returns null fields when data empty"},{"ancestorTitles":["getUidInviter"],"duration":3,"failureMessages":[],"fullName":"getUidInviter returns null and logs error on exception","status":"passed","title":"returns null and logs error on exception"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171906918,"runtime":124,"slow":false,"start":1745171906794},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/helpers/deleteFile.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["deleteFile"],"duration":3,"failureMessages":[],"fullName":"deleteFile should call unlink and log success","status":"passed","title":"should call unlink and log success"},{"ancestorTitles":["deleteFile"],"duration":0,"failureMessages":[],"fullName":"deleteFile should catch and log error when unlink throws","status":"passed","title":"should catch and log error when unlink throws"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171906946,"runtime":164,"slow":false,"start":1745171906782},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/updateUserVoice.unit.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["updateUserVoice"],"duration":13,"failureMessages":[],"fullName":"updateUserVoice resolves when update succeeds","status":"passed","title":"resolves when update succeeds"},{"ancestorTitles":["updateUserVoice"],"duration":8,"failureMessages":[],"fullName":"updateUserVoice throws error when update returns error","status":"passed","title":"throws error when update returns error"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171907024,"runtime":97,"slow":false,"start":1745171906927},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/utils/language.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["isRussian"],"duration":1,"failureMessages":[],"fullName":"isRussian should return true for ru language_code","status":"passed","title":"should return true for ru language_code"},{"ancestorTitles":["isRussian"],"duration":0,"failureMessages":[],"fullName":"isRussian should return false for non-ru language_code","status":"passed","title":"should return false for non-ru language_code"},{"ancestorTitles":["isRussian"],"duration":0,"failureMessages":[],"fullName":"isRussian should return false if from is undefined","status":"passed","title":"should return false if from is undefined"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171907036,"runtime":218,"slow":false,"start":1745171906818},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/updateUserSoul.unit.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["updateUserSoul"],"duration":7,"failureMessages":[],"fullName":"updateUserSoul calls supabase.update with correct data and handles success","status":"passed","title":"calls supabase.update with correct data and handles success"},{"ancestorTitles":["updateUserSoul"],"duration":0,"failureMessages":[],"fullName":"updateUserSoul logs error when supabase update returns error and does not throw","status":"passed","title":"logs error when supabase update returns error and does not throw"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171907036,"runtime":117,"slow":false,"start":1745171906919},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/helpers/language.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["isRussian"],"duration":2,"failureMessages":[],"fullName":"isRussian returns true when language_code is ru","status":"passed","title":"returns true when language_code is ru"},{"ancestorTitles":["isRussian"],"duration":0,"failureMessages":[],"fullName":"isRussian returns false when language_code is not ru","status":"passed","title":"returns false when language_code is not ru"},{"ancestorTitles":["isRussian"],"duration":0,"failureMessages":[],"fullName":"isRussian returns false when ctx.from is undefined","status":"passed","title":"returns false when ctx.from is undefined"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171906922,"runtime":121,"slow":false,"start":1745171906801},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/menu/sendGenerationErrorMessage.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["sendGenerationErrorMessage"],"duration":1,"failureMessages":[],"fullName":"sendGenerationErrorMessage replies with Russian message when isRu true","status":"passed","title":"replies with Russian message when isRu true"},{"ancestorTitles":["sendGenerationErrorMessage"],"duration":1,"failureMessages":[],"fullName":"sendGenerationErrorMessage replies with English message when isRu false","status":"passed","title":"replies with English message when isRu false"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171907085,"runtime":150,"slow":false,"start":1745171906935},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/services/generateImageFromPrompt.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["generateImageFromPrompt"],"duration":32,"failureMessages":[],"fullName":"generateImageFromPrompt returns dummy URL and logs parameters with all args","status":"passed","title":"returns dummy URL and logs parameters with all args"},{"ancestorTitles":["generateImageFromPrompt"],"duration":2,"failureMessages":[],"fullName":"generateImageFromPrompt works without optional args","status":"passed","title":"works without optional args"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171907034,"runtime":109,"slow":false,"start":1745171906925},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/utils/errorMessageAdmin.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["errorMessageAdmin"],"duration":0,"failureMessages":[],"fullName":"errorMessageAdmin should send admin notification when not development","status":"passed","title":"should send admin notification when not development"},{"ancestorTitles":["errorMessageAdmin"],"duration":1,"failureMessages":[],"fullName":"errorMessageAdmin should not send when development mode","status":"passed","title":"should not send when development mode"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171907107,"runtime":74,"slow":false,"start":1745171907033},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/price/interestRate.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["interestRate constant"],"duration":1,"failureMessages":[],"fullName":"interestRate constant should be a positive number equal to 0.5","status":"passed","title":"should be a positive number equal to 0.5"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171907119,"runtime":42,"slow":false,"start":1745171907077},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/video.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["video"],"duration":0,"failureMessages":[],"fullName":"video TODO: implement tests for video","status":"passed","title":"TODO: implement tests for video"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171907138,"runtime":89,"slow":false,"start":1745171907049},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/helpers/ensureDirectoryExistence.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["ensureDirectoryExistence"],"duration":1,"failureMessages":[],"fullName":"ensureDirectoryExistence should create directory and log messages","status":"passed","title":"should create directory and log messages"},{"ancestorTitles":["ensureDirectoryExistence"],"duration":1,"failureMessages":[],"fullName":"ensureDirectoryExistence should log error and rethrow when mkdir fails","status":"passed","title":"should log error and rethrow when mkdir fails"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171907155,"runtime":73,"slow":false,"start":1745171907082},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/price/videoModelPrices.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["videoModelPrices"],"duration":30,"failureMessages":[],"fullName":"videoModelPrices should contain known model names with expected values","status":"passed","title":"should contain known model names with expected values"},{"ancestorTitles":["videoModelPrices"],"duration":5,"failureMessages":[],"fullName":"videoModelPrices should not include unexpected models","status":"passed","title":"should not include unexpected models"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171907162,"runtime":53,"slow":false,"start":1745171907109},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/menu/sendPromptImprovementMessage.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["sendPromptImprovementMessage"],"duration":1,"failureMessages":[],"fullName":"sendPromptImprovementMessage sends Russian start message when isRu true","status":"passed","title":"sends Russian start message when isRu true"},{"ancestorTitles":["sendPromptImprovementMessage"],"duration":0,"failureMessages":[],"fullName":"sendPromptImprovementMessage sends English start message when isRu false","status":"passed","title":"sends English start message when isRu false"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171907175,"runtime":45,"slow":false,"start":1745171907130},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getUserLevel.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getUserLevel"],"duration":0,"failureMessages":[],"fullName":"getUserLevel TODO: implement tests for getUserLevel","status":"passed","title":"TODO: implement tests for getUserLevel"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171907176,"runtime":55,"slow":false,"start":1745171907121},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getUserModel.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getUserModel"],"duration":1,"failureMessages":[],"fullName":"getUserModel TODO: implement tests for getUserModel","status":"passed","title":"TODO: implement tests for getUserModel"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171907180,"runtime":54,"slow":false,"start":1745171907126},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/updateUserLevel.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["updateUserLevel"],"duration":1,"failureMessages":[],"fullName":"updateUserLevel TODO: implement tests for updateUserLevel","status":"passed","title":"TODO: implement tests for updateUserLevel"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171907185,"runtime":93,"slow":false,"start":1745171907092},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/handlers/sample.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":[],"duration":0,"failureMessages":[],"fullName":"dummy","status":"passed","title":"dummy"}]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/setPayments.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/core/supabase/setPayments.test.ts\u001b[0m:\u001b[93m32\u001b[0m:\u001b[93m30\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '{ telegram_id: string; OutSum: string; InvId: string; currency: \"USD\"; stars: number; status: \"COMPLETED\"; payment_method: \"Stripe\"; bot_name: string; language: string; }' is not assignable to parameter of type 'PaymentParams'.\n      Property 'subscription' is missing in type '{ telegram_id: string; OutSum: string; InvId: string; currency: \"USD\"; stars: number; status: \"COMPLETED\"; payment_method: \"Stripe\"; bot_name: string; language: string; }' but required in type 'PaymentParams'.\n\n    \u001b[7m32\u001b[0m     await expect(setPayments(paymentArgs)).resolves.toBeUndefined()\n    \u001b[7m  \u001b[0m \u001b[91m                             ~~~~~~~~~~~\u001b[0m\n\n      \u001b[96msrc/core/supabase/setPayments.ts\u001b[0m:\u001b[93m16\u001b[0m:\u001b[93m3\u001b[0m\n        \u001b[7m16\u001b[0m   subscription: string | null // <-- СНОВА ДОБАВЛЯЕМ ЭТО ПОЛЕ\n        \u001b[7m  \u001b[0m \u001b[96m  ~~~~~~~~~~~~\u001b[0m\n        'subscription' is declared here.\n    \u001b[96m__tests__/core/supabase/setPayments.test.ts\u001b[0m:\u001b[93m54\u001b[0m:\u001b[93m30\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '{ telegram_id: string; OutSum: string; InvId: string; currency: \"USD\"; stars: number; status: \"COMPLETED\"; payment_method: \"Stripe\"; bot_name: string; language: string; }' is not assignable to parameter of type 'PaymentParams'.\n      Property 'subscription' is missing in type '{ telegram_id: string; OutSum: string; InvId: string; currency: \"USD\"; stars: number; status: \"COMPLETED\"; payment_method: \"Stripe\"; bot_name: string; language: string; }' but required in type 'PaymentParams'.\n\n    \u001b[7m54\u001b[0m     await expect(setPayments(paymentArgs)).rejects.toBe(err)\n    \u001b[7m  \u001b[0m \u001b[91m                             ~~~~~~~~~~~\u001b[0m\n\n      \u001b[96msrc/core/supabase/setPayments.ts\u001b[0m:\u001b[93m16\u001b[0m:\u001b[93m3\u001b[0m\n        \u001b[7m16\u001b[0m   subscription: string | null // <-- СНОВА ДОБАВЛЯЕМ ЭТО ПОЛЕ\n        \u001b[7m  \u001b[0m \u001b[96m  ~~~~~~~~~~~~\u001b[0m\n        'subscription' is declared here.\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/sendPaymentInfo.unit.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/core/supabase/sendPaymentInfo.unit.test.ts\u001b[0m:\u001b[93m19\u001b[0m:\u001b[93m43\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2554: \u001b[0mExpected 1 arguments, but got 2.\n\n    \u001b[7m19\u001b[0m     await expect(sendPaymentInfo(user_id, level))\n    \u001b[7m  \u001b[0m \u001b[91m                                          ~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/sendPaymentInfo.unit.test.ts\u001b[0m:\u001b[93m27\u001b[0m:\u001b[93m43\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2554: \u001b[0mExpected 1 arguments, but got 2.\n\n    \u001b[7m27\u001b[0m     await expect(sendPaymentInfo(user_id, level))\n    \u001b[7m  \u001b[0m \u001b[91m                                          ~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/sendPaymentInfo.unit.test.ts\u001b[0m:\u001b[93m37\u001b[0m:\u001b[93m51\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2554: \u001b[0mExpected 1 arguments, but got 2.\n\n    \u001b[7m37\u001b[0m     const result = await sendPaymentInfo(user_id, level)\n    \u001b[7m  \u001b[0m \u001b[91m                                                  ~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getUserBalance.unit.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/core/supabase/getUserBalance.unit.test.ts\u001b[0m:\u001b[93m18\u001b[0m:\u001b[93m33\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'number' is not assignable to parameter of type 'string'.\n\n    \u001b[7m18\u001b[0m     await expect(getUserBalance(telegram_id)).rejects.toThrow('Пользователь не найден')\n    \u001b[7m  \u001b[0m \u001b[91m                                ~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/getUserBalance.unit.test.ts\u001b[0m:\u001b[93m26\u001b[0m:\u001b[93m33\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'number' is not assignable to parameter of type 'string'.\n\n    \u001b[7m26\u001b[0m     await expect(getUserBalance(telegram_id)).rejects.toThrow('Не удалось получить баланс пользователя')\n    \u001b[7m  \u001b[0m \u001b[91m                                ~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/getUserBalance.unit.test.ts\u001b[0m:\u001b[93m34\u001b[0m:\u001b[93m41\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'number' is not assignable to parameter of type 'string'.\n\n    \u001b[7m34\u001b[0m     const result = await getUserBalance(telegram_id)\n    \u001b[7m  \u001b[0m \u001b[91m                                        ~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/getUserBalance.unit.test.ts\u001b[0m:\u001b[93m43\u001b[0m:\u001b[93m41\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'number' is not assignable to parameter of type 'string'.\n\n    \u001b[7m43\u001b[0m     const result = await getUserBalance(telegram_id)\n    \u001b[7m  \u001b[0m \u001b[91m                                        ~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/index.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/core/supabase/index.test.ts\u001b[0m:\u001b[93m11\u001b[0m:\u001b[93m47\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '() => void' is not assignable to parameter of type '(infoObject: object) => Logger'.\n      Type 'void' is not assignable to type 'Logger'.\n\n    \u001b[7m11\u001b[0m jest.spyOn(logger, 'warn').mockImplementation(() => {})\n    \u001b[7m  \u001b[0m \u001b[91m                                              ~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/index.test.ts\u001b[0m:\u001b[93m12\u001b[0m:\u001b[93m48\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '() => void' is not assignable to parameter of type '(infoObject: object) => Logger'.\n      Type 'void' is not assignable to type 'Logger'.\n\n    \u001b[7m12\u001b[0m jest.spyOn(logger, 'error').mockImplementation(() => {})\n    \u001b[7m  \u001b[0m \u001b[91m                                               ~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/index.test.ts\u001b[0m:\u001b[93m13\u001b[0m:\u001b[93m47\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '() => void' is not assignable to parameter of type '(infoObject: object) => Logger'.\n      Type 'void' is not assignable to type 'Logger'.\n\n    \u001b[7m13\u001b[0m jest.spyOn(logger, 'info').mockImplementation(() => {})\n    \u001b[7m  \u001b[0m \u001b[91m                                              ~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/index.test.ts\u001b[0m:\u001b[93m19\u001b[0m:\u001b[93m12\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'SUPABASE_URL' because it is a read-only property.\n\n    \u001b[7m19\u001b[0m     config.SUPABASE_URL = 'http://supabase.test'\n    \u001b[7m  \u001b[0m \u001b[91m           ~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/index.test.ts\u001b[0m:\u001b[93m20\u001b[0m:\u001b[93m12\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'SUPABASE_SERVICE_KEY' because it is a read-only property.\n\n    \u001b[7m20\u001b[0m     config.SUPABASE_SERVICE_KEY = 'service-key'\n    \u001b[7m  \u001b[0m \u001b[91m           ~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/index.test.ts\u001b[0m:\u001b[93m21\u001b[0m:\u001b[93m12\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'SUPABASE_SERVICE_ROLE_KEY' because it is a read-only property.\n\n    \u001b[7m21\u001b[0m     config.SUPABASE_SERVICE_ROLE_KEY = 'service-role'\n    \u001b[7m  \u001b[0m \u001b[91m           ~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/index.test.ts\u001b[0m:\u001b[93m22\u001b[0m:\u001b[93m12\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'isSupabaseConfigured' because it is a read-only property.\n\n    \u001b[7m22\u001b[0m     config.isSupabaseConfigured = true\n    \u001b[7m  \u001b[0m \u001b[91m           ~~~~~~~~~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getUserByTelegramId.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/core/supabase/getUserByTelegramId.test.ts\u001b[0m:\u001b[93m36\u001b[0m:\u001b[93m28\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Type '{ select: any; }' has no call signatures.\n\n    \u001b[7m36\u001b[0m       .mockReturnValueOnce({ select: mockSelect: () => ({ eq: mockEq }) })\n    \u001b[7m  \u001b[0m \u001b[91m                           ~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/getUserByTelegramId.test.ts\u001b[0m:\u001b[93m36\u001b[0m:\u001b[93m38\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2552: \u001b[0mCannot find name 'mockSelect'. Did you mean 'onselect'?\n\n    \u001b[7m36\u001b[0m       .mockReturnValueOnce({ select: mockSelect: () => ({ eq: mockEq }) })\n    \u001b[7m  \u001b[0m \u001b[91m                                     ~~~~~~~~~~\u001b[0m\n\n      \u001b[96mnode_modules/.pnpm/typescript@5.8.3/node_modules/typescript/lib/lib.dom.d.ts\u001b[0m:\u001b[93m29165\u001b[0m:\u001b[93m13\u001b[0m\n        \u001b[7m29165\u001b[0m declare var onselect: ((this: Window, ev: Event) => any) | null;\n        \u001b[7m     \u001b[0m \u001b[96m            ~~~~~~~~\u001b[0m\n        'onselect' is declared here.\n    \u001b[96m__tests__/core/supabase/getUserByTelegramId.test.ts\u001b[0m:\u001b[93m37\u001b[0m:\u001b[93m8\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'mockReturnValueOnce' does not exist on type 'void'.\n\n    \u001b[7m37\u001b[0m       .mockReturnValueOnce({ update: mockUpdate, eq: mockEq })\n    \u001b[7m  \u001b[0m \u001b[91m       ~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/getUserByTelegramId.test.ts\u001b[0m:\u001b[93m37\u001b[0m:\u001b[93m38\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2304: \u001b[0mCannot find name 'mockUpdate'.\n\n    \u001b[7m37\u001b[0m       .mockReturnValueOnce({ update: mockUpdate, eq: mockEq })\n    \u001b[7m  \u001b[0m \u001b[91m                                     ~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/getUserByTelegramId.test.ts\u001b[0m:\u001b[93m37\u001b[0m:\u001b[93m54\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2304: \u001b[0mCannot find name 'mockEq'.\n\n    \u001b[7m37\u001b[0m       .mockReturnValueOnce({ update: mockUpdate, eq: mockEq })\n    \u001b[7m  \u001b[0m \u001b[91m                                                     ~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/getUserByTelegramId.test.ts\u001b[0m:\u001b[93m39\u001b[0m:\u001b[93m49\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2304: \u001b[0mCannot find name 'mockEq'.\n\n    \u001b[7m39\u001b[0m     const sel = jest.fn().mockReturnValue({ eq: mockEq })\n    \u001b[7m  \u001b[0m \u001b[91m                                                ~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/getUserByTelegramId.test.ts\u001b[0m:\u001b[93m42\u001b[0m:\u001b[93m38\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2304: \u001b[0mCannot find name 'mockUpdate'.\n\n    \u001b[7m42\u001b[0m       .mockReturnValueOnce({ update: mockUpdate })\n    \u001b[7m  \u001b[0m \u001b[91m                                     ~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/getUserByTelegramId.test.ts\u001b[0m:\u001b[93m44\u001b[0m:\u001b[93m12\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2304: \u001b[0mCannot find name 'mockUpdate'.\n\n    \u001b[7m44\u001b[0m     expect(mockUpdate).toHaveBeenCalled()\n    \u001b[7m  \u001b[0m \u001b[91m           ~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/getUserByTelegramId.test.ts\u001b[0m:\u001b[93m45\u001b[0m:\u001b[93m28\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2304: \u001b[0mCannot find name 'userData'.\n\n    \u001b[7m45\u001b[0m     expect(result).toEqual(userData)\n    \u001b[7m  \u001b[0m \u001b[91m                           ~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/getUserByTelegramId.test.ts\u001b[0m:\u001b[93m36\u001b[0m:\u001b[93m48\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1005: \u001b[0m',' expected.\n\n    \u001b[7m36\u001b[0m       .mockReturnValueOnce({ select: mockSelect: () => ({ eq: mockEq }) })\n    \u001b[7m  \u001b[0m \u001b[91m                                               ~\u001b[0m\n    \u001b[96m__tests__/core/supabase/getUserByTelegramId.test.ts\u001b[0m:\u001b[93m36\u001b[0m:\u001b[93m50\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1136: \u001b[0mProperty assignment expected.\n\n    \u001b[7m36\u001b[0m       .mockReturnValueOnce({ select: mockSelect: () => ({ eq: mockEq }) })\n    \u001b[7m  \u001b[0m \u001b[91m                                                 ~\u001b[0m\n    \u001b[96m__tests__/core/supabase/getUserByTelegramId.test.ts\u001b[0m:\u001b[93m36\u001b[0m:\u001b[93m53\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1005: \u001b[0m',' expected.\n\n    \u001b[7m36\u001b[0m       .mockReturnValueOnce({ select: mockSelect: () => ({ eq: mockEq }) })\n    \u001b[7m  \u001b[0m \u001b[91m                                                    ~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/getUserByTelegramId.test.ts\u001b[0m:\u001b[93m47\u001b[0m:\u001b[93m1\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1128: \u001b[0mDeclaration or statement expected.\n\n    \u001b[7m47\u001b[0m })\n    \u001b[7m  \u001b[0m \u001b[91m~\u001b[0m\n    \u001b[96m__tests__/core/supabase/getUserByTelegramId.test.ts\u001b[0m:\u001b[93m47\u001b[0m:\u001b[93m2\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1128: \u001b[0mDeclaration or statement expected.\n\n    \u001b[7m47\u001b[0m })\n    \u001b[7m  \u001b[0m \u001b[91m ~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/getUserBalance.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/core/supabase/getUserBalance.test.ts\u001b[0m:\u001b[93m18\u001b[0m:\u001b[93m42\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'number' is not assignable to parameter of type 'string'.\n\n    \u001b[7m18\u001b[0m     const balance = await getUserBalance(99)\n    \u001b[7m  \u001b[0m \u001b[91m                                         ~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/getUserBalance.test.ts\u001b[0m:\u001b[93m25\u001b[0m:\u001b[93m42\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'number' is not assignable to parameter of type 'string'.\n\n    \u001b[7m25\u001b[0m     const balance = await getUserBalance(55)\n    \u001b[7m  \u001b[0m \u001b[91m                                         ~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/getUserBalance.test.ts\u001b[0m:\u001b[93m32\u001b[0m:\u001b[93m33\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'number' is not assignable to parameter of type 'string'.\n\n    \u001b[7m32\u001b[0m     await expect(getUserBalance(1)).rejects.toThrow('Пользователь не найден')\n    \u001b[7m  \u001b[0m \u001b[91m                                ~\u001b[0m\n    \u001b[96m__tests__/core/supabase/getUserBalance.test.ts\u001b[0m:\u001b[93m38\u001b[0m:\u001b[93m33\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'number' is not assignable to parameter of type 'string'.\n\n    \u001b[7m38\u001b[0m     await expect(getUserBalance(2)).rejects.toThrow('Не удалось получить баланс пользователя')\n    \u001b[7m  \u001b[0m \u001b[91m                                ~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/supabase/ai.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/core/supabase/ai.test.ts\u001b[0m:\u001b[93m4\u001b[0m:\u001b[93m10\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2305: \u001b[0mModule '\"@/core/supabase/ai\"' has no exported member 'ai'.\n\n    \u001b[7m4\u001b[0m import { ai } from '@/core/supabase/ai'\n    \u001b[7m \u001b[0m \u001b[91m         ~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/webhooks.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/webhooks.test.ts\u001b[0m:\u001b[93m14\u001b[0m:\u001b[93m44\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '{ username: string; }' is not assignable to parameter of type 'never'.\n\n    \u001b[7m14\u001b[0m         getMe: jest.fn().mockResolvedValue({ username: 'test_bot' })\n    \u001b[7m  \u001b[0m \u001b[91m                                           ~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/pinata/index.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/core/pinata/index.test.ts\u001b[0m:\u001b[93m34\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1005: \u001b[0m'}' expected.\n\n    \u001b[7m34\u001b[0m   })\n    \u001b[7m  \u001b[0m \u001b[91m    \u001b[0m\n\n      \u001b[96m__tests__/core/pinata/index.test.ts\u001b[0m:\u001b[93m14\u001b[0m:\u001b[93m37\u001b[0m\n        \u001b[7m14\u001b[0m describe('core/pinata index', () => {\n        \u001b[7m  \u001b[0m \u001b[96m                                    ~\u001b[0m\n        The parser expected to find a '}' to match the '{' token here.\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/axios/fetchWithAxios.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/core/axios/fetchWithAxios.test.ts\u001b[0m:\u001b[93m15\u001b[0m:\u001b[93m17\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'mockResolvedValueOnce' does not exist on type 'Mocked<AxiosStatic>'.\n\n    \u001b[7m15\u001b[0m     mockedAxios.mockResolvedValueOnce(fakeResponse as any)\n    \u001b[7m  \u001b[0m \u001b[91m                ~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/axios/fetchWithAxios.test.ts\u001b[0m:\u001b[93m23\u001b[0m:\u001b[93m17\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'mockRejectedValueOnce' does not exist on type 'Mocked<AxiosStatic>'.\n\n    \u001b[7m23\u001b[0m     mockedAxios.mockRejectedValueOnce(error)\n    \u001b[7m  \u001b[0m \u001b[91m                ~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/core/bot/initialize.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/core/bot/initialize.test.ts\u001b[0m:\u001b[93m6\u001b[0m:\u001b[93m63\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '() => void' is not assignable to parameter of type '(infoObject: object) => Logger'.\n      Type 'void' is not assignable to type 'Logger'.\n\n    \u001b[7m6\u001b[0m const infoSpy = jest.spyOn(logger, 'info').mockImplementation(() => {})\n    \u001b[7m \u001b[0m \u001b[91m                                                              ~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/scenes/cancelPredictionsWizard.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/scenes/cancelPredictionsWizard.test.ts\u001b[0m:\u001b[93m33\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m33\u001b[0m     await step(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/cancelPredictionsWizard.test.ts\u001b[0m:\u001b[93m45\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m45\u001b[0m     await step(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/scenes/createUserScene.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/scenes/createUserScene.test.ts\u001b[0m:\u001b[93m13\u001b[0m:\u001b[93m10\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2724: \u001b[0m'\"@/scenes/createUserScene\"' has no exported member named 'createUserStep'. Did you mean 'createUserScene'?\n\n    \u001b[7m13\u001b[0m import { createUserStep } from '@/scenes/createUserScene'\n    \u001b[7m  \u001b[0m \u001b[91m         ~~~~~~~~~~~~~~\u001b[0m\n\n      \u001b[96msrc/scenes/createUserScene.ts\u001b[0m:\u001b[93m113\u001b[0m:\u001b[93m14\u001b[0m\n        \u001b[7m113\u001b[0m export const createUserScene = new WizardScene<MyContext>(\n        \u001b[7m   \u001b[0m \u001b[96m             ~~~~~~~~~~~~~~~\u001b[0m\n        'createUserScene' is declared here.\n    \u001b[96m__tests__/scenes/createUserScene.test.ts\u001b[0m:\u001b[93m22\u001b[0m:\u001b[93m29\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2353: \u001b[0mObject literal may only specify known properties, and 'text' does not exist in type 'Partial<Update> & { message?: Partial<TextMessage>; callback_query?: Partial<CallbackQuery>; inline_query?: Partial<InlineQuery>; pre_checkout_query?: Partial<...>; }'.\n\n    \u001b[7m22\u001b[0m     ctx = makeMockContext({ text: '/start 123' }, {})\n    \u001b[7m  \u001b[0m \u001b[91m                            ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/createUserScene.test.ts\u001b[0m:\u001b[93m41\u001b[0m:\u001b[93m29\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2353: \u001b[0mObject literal may only specify known properties, and 'text' does not exist in type 'Partial<Update> & { message?: Partial<TextMessage>; callback_query?: Partial<CallbackQuery>; inline_query?: Partial<InlineQuery>; pre_checkout_query?: Partial<...>; }'.\n\n    \u001b[7m41\u001b[0m     ctx = makeMockContext({ text: '/start' }, {})\n    \u001b[7m  \u001b[0m \u001b[91m                            ~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/scenes/getRuBillWizard.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/scenes/getRuBillWizard.test.ts\u001b[0m:\u001b[93m35\u001b[0m:\u001b[93m39\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2353: \u001b[0mObject literal may only specify known properties, and 'session' does not exist in type 'Partial<MySession>'.\n\n    \u001b[7m35\u001b[0m     const ctx = makeMockContext({}, { session: { selectedPayment: { subscription: 'neurophoto' }, email: 'e@e' } })\n    \u001b[7m  \u001b[0m \u001b[91m                                      ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/getRuBillWizard.test.ts\u001b[0m:\u001b[93m63\u001b[0m:\u001b[93m39\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2353: \u001b[0mObject literal may only specify known properties, and 'session' does not exist in type 'Partial<MySession>'.\n\n    \u001b[7m63\u001b[0m     const ctx = makeMockContext({}, { session: { selectedPayment: null } })\n    \u001b[7m  \u001b[0m \u001b[91m                                      ~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/scenes/checkBalanceScene.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/scenes/checkBalanceScene.test.ts\u001b[0m:\u001b[93m29\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2739: \u001b[0mType '{ mode: any; }' is missing the following properties from type 'MySession': cursor, images, targetUserId, userModel\n\n    \u001b[7m29\u001b[0m     ctx.session = { mode: ModeEnum.NeuroPhoto }\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/checkBalanceScene.test.ts\u001b[0m:\u001b[93m29\u001b[0m:\u001b[93m27\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2304: \u001b[0mCannot find name 'ModeEnum'.\n\n    \u001b[7m29\u001b[0m     ctx.session = { mode: ModeEnum.NeuroPhoto }\n    \u001b[7m  \u001b[0m \u001b[91m                          ~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/checkBalanceScene.test.ts\u001b[0m:\u001b[93m34\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2304: \u001b[0mCannot find name 'checkBalanceSceneEnterHandler'.\n\n    \u001b[7m34\u001b[0m     await checkBalanceSceneEnterHandler(ctx as any)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/checkBalanceScene.test.ts\u001b[0m:\u001b[93m41\u001b[0m:\u001b[93m50\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2304: \u001b[0mCannot find name 'ModeEnum'.\n\n    \u001b[7m41\u001b[0m     expect(ctx.scene.enter).toHaveBeenCalledWith(ModeEnum.NeuroPhoto)\n    \u001b[7m  \u001b[0m \u001b[91m                                                 ~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/checkBalanceScene.test.ts\u001b[0m:\u001b[93m46\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2304: \u001b[0mCannot find name 'checkBalanceSceneEnterHandler'.\n\n    \u001b[7m46\u001b[0m     await checkBalanceSceneEnterHandler(ctx as any)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/checkBalanceScene.test.ts\u001b[0m:\u001b[93m56\u001b[0m:\u001b[93m17\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Type 'Error' has no call signatures.\n\n    \u001b[7m56\u001b[0m     const err = new Error('DB error')(\n    \u001b[7m  \u001b[0m \u001b[91m                ~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/checkBalanceScene.test.ts\u001b[0m:\u001b[93m58\u001b[0m:\u001b[93m25\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2448: \u001b[0mBlock-scoped variable 'err' used before its declaration.\n\n    \u001b[7m58\u001b[0m     ).mockRejectedValue(err)\n    \u001b[7m  \u001b[0m \u001b[91m                        ~~~\u001b[0m\n\n      \u001b[96m__tests__/scenes/checkBalanceScene.test.ts\u001b[0m:\u001b[93m56\u001b[0m:\u001b[93m11\u001b[0m\n        \u001b[7m56\u001b[0m     const err = new Error('DB error')(\n        \u001b[7m  \u001b[0m \u001b[96m          ~~~\u001b[0m\n        'err' is declared here.\n    \u001b[96m__tests__/scenes/checkBalanceScene.test.ts\u001b[0m:\u001b[93m59\u001b[0m:\u001b[93m18\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2304: \u001b[0mCannot find name 'checkBalanceSceneEnterHandler'.\n\n    \u001b[7m59\u001b[0m     await expect(checkBalanceSceneEnterHandler(ctx as any)).rejects.toThrow(\n    \u001b[7m  \u001b[0m \u001b[91m                 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/scenes/balanceScene.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/scenes/balanceScene.test.ts\u001b[0m:\u001b[93m26\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m26\u001b[0m     await step(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/balanceScene.test.ts\u001b[0m:\u001b[93m48\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m48\u001b[0m     await step(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/balanceScene.test.ts\u001b[0m:\u001b[93m67\u001b[0m:\u001b[93m18\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m67\u001b[0m     await expect(step(ctx)).rejects.toThrow('fetch failed')\n    \u001b[7m  \u001b[0m \u001b[91m                 ~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/scenes/avatarBrainWizard.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/scenes/avatarBrainWizard.test.ts\u001b[0m:\u001b[93m44\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m44\u001b[0m     await step0(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/avatarBrainWizard.test.ts\u001b[0m:\u001b[93m54\u001b[0m:\u001b[93m39\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2353: \u001b[0mObject literal may only specify known properties, and 'message' does not exist in type 'Partial<MySession>'.\n\n    \u001b[7m54\u001b[0m     const ctx = makeMockContext({}, { message: { text: 'AcmeCorp' } })\n    \u001b[7m  \u001b[0m \u001b[91m                                      ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/avatarBrainWizard.test.ts\u001b[0m:\u001b[93m69\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m69\u001b[0m     await step1(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/avatarBrainWizard.test.ts\u001b[0m:\u001b[93m80\u001b[0m:\u001b[93m39\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2353: \u001b[0mObject literal may only specify known properties, and 'message' does not exist in type 'Partial<MySession>'.\n\n    \u001b[7m80\u001b[0m     const ctx = makeMockContext({}, { message: { text: 'AcmeCorp' } })\n    \u001b[7m  \u001b[0m \u001b[91m                                      ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/avatarBrainWizard.test.ts\u001b[0m:\u001b[93m86\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m86\u001b[0m     await step1(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/avatarBrainWizard.test.ts\u001b[0m:\u001b[93m91\u001b[0m:\u001b[93m39\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2353: \u001b[0mObject literal may only specify known properties, and 'message' does not exist in type 'Partial<MySession>'.\n\n    \u001b[7m91\u001b[0m     const ctx = makeMockContext({}, { message: { text: 'Developer' } })\n    \u001b[7m  \u001b[0m \u001b[91m                                      ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/avatarBrainWizard.test.ts\u001b[0m:\u001b[93m106\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m106\u001b[0m     await step2(ctx)\n    \u001b[7m   \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/avatarBrainWizard.test.ts\u001b[0m:\u001b[93m117\u001b[0m:\u001b[93m39\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2353: \u001b[0mObject literal may only specify known properties, and 'message' does not exist in type 'Partial<MySession>'.\n\n    \u001b[7m117\u001b[0m     const ctx = makeMockContext({}, { message: { text: 'JS, TS' } })\n    \u001b[7m   \u001b[0m \u001b[91m                                      ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/avatarBrainWizard.test.ts\u001b[0m:\u001b[93m139\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m139\u001b[0m     await step3(ctx)\n    \u001b[7m   \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/avatarBrainWizard.test.ts\u001b[0m:\u001b[93m151\u001b[0m:\u001b[93m39\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2353: \u001b[0mObject literal may only specify known properties, and 'message' does not exist in type 'Partial<MySession>'.\n\n    \u001b[7m151\u001b[0m     const ctx = makeMockContext({}, { message: { text: 'SkillX' } })\n    \u001b[7m   \u001b[0m \u001b[91m                                      ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/avatarBrainWizard.test.ts\u001b[0m:\u001b[93m166\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m166\u001b[0m     await step3(ctx)\n    \u001b[7m   \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/avatarBrainWizard.test.ts\u001b[0m:\u001b[93m172\u001b[0m:\u001b[93m39\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2353: \u001b[0mObject literal may only specify known properties, and 'message' does not exist in type 'Partial<MySession>'.\n\n    \u001b[7m172\u001b[0m     const ctx = makeMockContext({}, { message: { text: 'X' } })\n    \u001b[7m   \u001b[0m \u001b[91m                                      ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/avatarBrainWizard.test.ts\u001b[0m:\u001b[93m182\u001b[0m:\u001b[93m18\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m182\u001b[0m     await expect(step3(ctx)).rejects.toThrow('User with ID 555 does not exist.')\n    \u001b[7m   \u001b[0m \u001b[91m                 ~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/scenes/digitalAvatarBodyWizardV2.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/scenes/digitalAvatarBodyWizardV2.test.ts\u001b[0m:\u001b[93m58\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m58\u001b[0m     await step0(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/digitalAvatarBodyWizardV2.test.ts\u001b[0m:\u001b[93m83\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m83\u001b[0m     await step1(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/digitalAvatarBodyWizardV2.test.ts\u001b[0m:\u001b[93m104\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m104\u001b[0m     await step1(ctx)\n    \u001b[7m   \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/digitalAvatarBodyWizardV2.test.ts\u001b[0m:\u001b[93m119\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m119\u001b[0m     await step1(ctx)\n    \u001b[7m   \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/digitalAvatarBodyWizardV2.test.ts\u001b[0m:\u001b[93m134\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m134\u001b[0m     await step1(ctx)\n    \u001b[7m   \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/scenes/emailWizard.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/scenes/emailWizard.test.ts\u001b[0m:\u001b[93m23\u001b[0m:\u001b[93m23\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2554: \u001b[0mExpected 2 arguments, but got 1.\n\n    \u001b[7m23\u001b[0m     await emailWizard.enterHandler(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m                      ~~~~~~~~~~~~\u001b[0m\n\n      \u001b[96mnode_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/typings/middleware.d.ts\u001b[0m:\u001b[93m3\u001b[0m:\u001b[93m86\u001b[0m\n        \u001b[7m3\u001b[0m export type MiddlewareFn<C extends Context<U>, U extends Update = Update> = (ctx: C, next: () => Promise<void>) => Promise<unknown> | void;\n        \u001b[7m \u001b[0m \u001b[96m                                                                                     ~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n        An argument for 'next' was not provided.\n    \u001b[96m__tests__/scenes/emailWizard.test.ts\u001b[0m:\u001b[93m37\u001b[0m:\u001b[93m23\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2554: \u001b[0mExpected 2 arguments, but got 1.\n\n    \u001b[7m37\u001b[0m     await emailWizard.enterHandler(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m                      ~~~~~~~~~~~~\u001b[0m\n\n      \u001b[96mnode_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/typings/middleware.d.ts\u001b[0m:\u001b[93m3\u001b[0m:\u001b[93m86\u001b[0m\n        \u001b[7m3\u001b[0m export type MiddlewareFn<C extends Context<U>, U extends Update = Update> = (ctx: C, next: () => Promise<void>) => Promise<unknown> | void;\n        \u001b[7m \u001b[0m \u001b[96m                                                                                     ~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n        An argument for 'next' was not provided.\n    \u001b[96m__tests__/scenes/emailWizard.test.ts\u001b[0m:\u001b[93m59\u001b[0m:\u001b[93m23\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'emailHandler' does not exist on type 'BaseScene<MyContext>'.\n\n    \u001b[7m59\u001b[0m     await emailWizard.emailHandler(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m                      ~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/emailWizard.test.ts\u001b[0m:\u001b[93m85\u001b[0m:\u001b[93m23\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'emailHandler' does not exist on type 'BaseScene<MyContext>'.\n\n    \u001b[7m85\u001b[0m     await emailWizard.emailHandler(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m                      ~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/scenes/getEmailWizard.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/scenes/getEmailWizard.test.ts\u001b[0m:\u001b[93m6\u001b[0m:\u001b[93m32\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2307: \u001b[0mCannot find module '../../src/scenes/getEmailWizard/index' or its corresponding type declarations.\n\n    \u001b[7m6\u001b[0m import { getEmailWizard } from '../../src/scenes/getEmailWizard/index'\n    \u001b[7m \u001b[0m \u001b[91m                               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/getEmailWizard.test.ts\u001b[0m:\u001b[93m18\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m18\u001b[0m     ctx.from = { id: 1, language_code: 'ru' }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/getEmailWizard.test.ts\u001b[0m:\u001b[93m28\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m28\u001b[0m     ctx.message = { text: 'anything' } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/getEmailWizard.test.ts\u001b[0m:\u001b[93m37\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m37\u001b[0m     ctx.message = { text: 'whatever' } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/getEmailWizard.test.ts\u001b[0m:\u001b[93m48\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m48\u001b[0m     ctx.message = { text: 'text' } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/getEmailWizard.test.ts\u001b[0m:\u001b[93m49\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2322: \u001b[0mType '\"invalid\"' is not assignable to type 'SubscriptionType'.\n\n    \u001b[7m49\u001b[0m     ctx.session.subscription = 'invalid'\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/scenes/menuScene.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/scenes/menuScene.test.ts\u001b[0m:\u001b[93m36\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m36\u001b[0m     await step0(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/scenes/neuroCoderScene.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/scenes/neuroCoderScene.test.ts\u001b[0m:\u001b[93m22\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m22\u001b[0m     ctx.from = { id: 10, language_code: 'ru' }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroCoderScene.test.ts\u001b[0m:\u001b[93m23\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'chat' because it is a read-only property.\n\n    \u001b[7m23\u001b[0m     ctx.chat = { id: 20 } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroCoderScene.test.ts\u001b[0m:\u001b[93m24\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'botInfo' because it is a read-only property.\n\n    \u001b[7m24\u001b[0m     ctx.botInfo = { username: 'bot' }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroCoderScene.test.ts\u001b[0m:\u001b[93m31\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m31\u001b[0m     await step0(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroCoderScene.test.ts\u001b[0m:\u001b[93m43\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m43\u001b[0m     await step1(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroCoderScene.test.ts\u001b[0m:\u001b[93m48\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m48\u001b[0m     ctx.from = undefined as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroCoderScene.test.ts\u001b[0m:\u001b[93m49\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m49\u001b[0m     ctx.message = undefined as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroCoderScene.test.ts\u001b[0m:\u001b[93m53\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m53\u001b[0m     await step1(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroCoderScene.test.ts\u001b[0m:\u001b[93m62\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m62\u001b[0m     ctx.message = { text: '3' } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroCoderScene.test.ts\u001b[0m:\u001b[93m66\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m66\u001b[0m     await step1(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/scenes/chatWithAvatarWizard.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/scenes/chatWithAvatarWizard.test.ts\u001b[0m:\u001b[93m44\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m44\u001b[0m     await step0(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/chatWithAvatarWizard.test.ts\u001b[0m:\u001b[93m56\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m56\u001b[0m     ctx.message = undefined\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/chatWithAvatarWizard.test.ts\u001b[0m:\u001b[93m59\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m59\u001b[0m     await step1(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/chatWithAvatarWizard.test.ts\u001b[0m:\u001b[93m64\u001b[0m:\u001b[93m39\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2353: \u001b[0mObject literal may only specify known properties, and 'message' does not exist in type 'Partial<MySession>'.\n\n    \u001b[7m64\u001b[0m     const ctx = makeMockContext({}, { message: { text: 'hi' } })\n    \u001b[7m  \u001b[0m \u001b[91m                                      ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/chatWithAvatarWizard.test.ts\u001b[0m:\u001b[93m68\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m68\u001b[0m     await step1(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/chatWithAvatarWizard.test.ts\u001b[0m:\u001b[93m74\u001b[0m:\u001b[93m39\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2353: \u001b[0mObject literal may only specify known properties, and 'message' does not exist in type 'Partial<MySession>'.\n\n    \u001b[7m74\u001b[0m     const ctx = makeMockContext({}, { message: { text: 'hello' } })\n    \u001b[7m  \u001b[0m \u001b[91m                                      ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/chatWithAvatarWizard.test.ts\u001b[0m:\u001b[93m82\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m82\u001b[0m     await step1(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/chatWithAvatarWizard.test.ts\u001b[0m:\u001b[93m89\u001b[0m:\u001b[93m39\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2353: \u001b[0mObject literal may only specify known properties, and 'message' does not exist in type 'Partial<MySession>'.\n\n    \u001b[7m89\u001b[0m     const ctx = makeMockContext({}, { message: { text: 'hello' } })\n    \u001b[7m  \u001b[0m \u001b[91m                                      ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/chatWithAvatarWizard.test.ts\u001b[0m:\u001b[93m97\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m97\u001b[0m     await step1(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/chatWithAvatarWizard.test.ts\u001b[0m:\u001b[93m107\u001b[0m:\u001b[93m39\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2353: \u001b[0mObject literal may only specify known properties, and 'message' does not exist in type 'Partial<MySession>'.\n\n    \u001b[7m107\u001b[0m     const ctx = makeMockContext({}, { message: { text: 'hello' } })\n    \u001b[7m   \u001b[0m \u001b[91m                                      ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/chatWithAvatarWizard.test.ts\u001b[0m:\u001b[93m113\u001b[0m:\u001b[93m18\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m113\u001b[0m     await expect(step1(ctx)).rejects.toThrow(\n    \u001b[7m   \u001b[0m \u001b[91m                 ~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/scenes/generateImageWizard.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/scenes/generateImageWizard.test.ts\u001b[0m:\u001b[93m6\u001b[0m:\u001b[93m37\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2307: \u001b[0mCannot find module '@/scenes/generateImageWizard' or its corresponding type declarations.\n\n    \u001b[7m6\u001b[0m import { generateImageWizard } from '@/scenes/generateImageWizard'\n    \u001b[7m \u001b[0m \u001b[91m                                    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/generateImageWizard.test.ts\u001b[0m:\u001b[93m17\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m17\u001b[0m     ctx.from = { id: 1, language_code: 'ru' }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/generateImageWizard.test.ts\u001b[0m:\u001b[93m44\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m44\u001b[0m     ctx.message = {} as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/generateImageWizard.test.ts\u001b[0m:\u001b[93m56\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m56\u001b[0m     ctx.message = { text: 'a'.repeat(1001) } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/generateImageWizard.test.ts\u001b[0m:\u001b[93m68\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m68\u001b[0m     ctx.message = { text: 'test prompt' } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/generateImageWizard.test.ts\u001b[0m:\u001b[93m84\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'callbackQuery' because it is a read-only property.\n\n    \u001b[7m84\u001b[0m     ctx.callbackQuery = { data: 'cancel' } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/generateImageWizard.test.ts\u001b[0m:\u001b[93m94\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'callbackQuery' because it is a read-only property.\n\n    \u001b[7m94\u001b[0m     ctx.callbackQuery = { data: 'foo' } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/generateImageWizard.test.ts\u001b[0m:\u001b[93m108\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'callbackQuery' because it is a read-only property.\n\n    \u001b[7m108\u001b[0m     ctx.callbackQuery = { data: 'size_512' } as any\n    \u001b[7m   \u001b[0m \u001b[91m        ~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/generateImageWizard.test.ts\u001b[0m:\u001b[93m110\u001b[0m:\u001b[93m33\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2353: \u001b[0mObject literal may only specify known properties, and 'prompt' does not exist in type '{ step: number; }'.\n\n    \u001b[7m110\u001b[0m     ctx.scene.session.state = { prompt: 'hello' }\n    \u001b[7m   \u001b[0m \u001b[91m                                ~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/scenes/uploadTrainFluxModelScene.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/scenes/uploadTrainFluxModelScene.test.ts\u001b[0m:\u001b[93m20\u001b[0m:\u001b[93m10\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2724: \u001b[0m'\"@/scenes/uploadTrainFluxModelScene\"' has no exported member named 'uploadTrainFluxModelSceneHandler'. Did you mean 'uploadTrainFluxModelScene'?\n\n    \u001b[7m20\u001b[0m import { uploadTrainFluxModelSceneHandler } from '@/scenes/uploadTrainFluxModelScene'\n    \u001b[7m  \u001b[0m \u001b[91m         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n\n      \u001b[96msrc/scenes/uploadTrainFluxModelScene/index.ts\u001b[0m:\u001b[93m10\u001b[0m:\u001b[93m14\u001b[0m\n        \u001b[7m10\u001b[0m export const uploadTrainFluxModelScene = new Scenes.BaseScene<MyContext>(\n        \u001b[7m  \u001b[0m \u001b[96m             ~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n        'uploadTrainFluxModelScene' is declared here.\n    \u001b[96m__tests__/scenes/uploadTrainFluxModelScene.test.ts\u001b[0m:\u001b[93m41\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'botInfo' because it is a read-only property.\n\n    \u001b[7m41\u001b[0m     ctx.botInfo = { username: 'botY' } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/scenes/imageToVideoWizard.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/scenes/imageToVideoWizard.test.ts\u001b[0m:\u001b[93m40\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m40\u001b[0m     await step0(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/imageToVideoWizard.test.ts\u001b[0m:\u001b[93m50\u001b[0m:\u001b[93m39\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2353: \u001b[0mObject literal may only specify known properties, and 'message' does not exist in type 'Partial<MySession>'.\n\n    \u001b[7m50\u001b[0m     const ctx = makeMockContext({}, { message: { text: 'отмена' } })\n    \u001b[7m  \u001b[0m \u001b[91m                                      ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/imageToVideoWizard.test.ts\u001b[0m:\u001b[93m54\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m54\u001b[0m     await step1(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/imageToVideoWizard.test.ts\u001b[0m:\u001b[93m61\u001b[0m:\u001b[93m39\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2353: \u001b[0mObject literal may only specify known properties, and 'message' does not exist in type 'Partial<MySession>'.\n\n    \u001b[7m61\u001b[0m     const ctx = makeMockContext({}, { message: { text: 'model1' } })\n    \u001b[7m  \u001b[0m \u001b[91m                                      ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/imageToVideoWizard.test.ts\u001b[0m:\u001b[93m68\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m68\u001b[0m     await step1(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/imageToVideoWizard.test.ts\u001b[0m:\u001b[93m88\u001b[0m:\u001b[93m39\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2353: \u001b[0mObject literal may only specify known properties, and 'message' does not exist in type 'Partial<MySession>'.\n\n    \u001b[7m88\u001b[0m     const ctx = makeMockContext({}, { message: {} })\n    \u001b[7m  \u001b[0m \u001b[91m                                      ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/imageToVideoWizard.test.ts\u001b[0m:\u001b[93m92\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m92\u001b[0m     await step1(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/scenes/inviteScene.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/scenes/inviteScene.test.ts\u001b[0m:\u001b[93m4\u001b[0m:\u001b[93m10\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2724: \u001b[0m'\"@/scenes/inviteScene\"' has no exported member named 'inviteEnter'. Did you mean 'inviteScene'?\n\n    \u001b[7m4\u001b[0m import { inviteEnter } from '@/scenes/inviteScene'\n    \u001b[7m \u001b[0m \u001b[91m         ~~~~~~~~~~~\u001b[0m\n\n      \u001b[96msrc/scenes/inviteScene/index.ts\u001b[0m:\u001b[93m6\u001b[0m:\u001b[93m14\u001b[0m\n        \u001b[7m6\u001b[0m export const inviteScene = new Scenes.BaseScene<MyContext>('inviteScene')\n        \u001b[7m \u001b[0m \u001b[96m             ~~~~~~~~~~~\u001b[0m\n        'inviteScene' is declared here.\n    \u001b[96m__tests__/scenes/inviteScene.test.ts\u001b[0m:\u001b[93m14\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m14\u001b[0m     ctx.from = { id: 123, language_code: 'ru' }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/inviteScene.test.ts\u001b[0m:\u001b[93m15\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'botInfo' because it is a read-only property.\n\n    \u001b[7m15\u001b[0m     ctx.botInfo = { username: 'myBot' }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/scenes/helpScene.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m38\u001b[0m:\u001b[93m23\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'steps' does not exist on type 'BaseScene<MyContext>'.\n\n    \u001b[7m38\u001b[0m     step0 = helpScene.steps[0]\n    \u001b[7m  \u001b[0m \u001b[91m                      ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m42\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m42\u001b[0m     ctx.from = { id: 42, language_code: 'ru' }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m43\u001b[0m:\u001b[93m21\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2322: \u001b[0mType '\"\"' is not assignable to type 'ModeEnum'.\n\n    \u001b[7m43\u001b[0m     ctx.session = { mode: '' }\n    \u001b[7m  \u001b[0m \u001b[91m                    ~~~~\u001b[0m\n\n      \u001b[96msrc/interfaces/telegram-bot.interface.ts\u001b[0m:\u001b[93m154\u001b[0m:\u001b[93m3\u001b[0m\n        \u001b[7m154\u001b[0m   mode?: ModeEnum\n        \u001b[7m   \u001b[0m \u001b[96m  ~~~~\u001b[0m\n        The expected type comes from property 'mode' which is declared here on type 'MySession'\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m50\u001b[0m:\u001b[93m16\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'ru' does not exist on type '({ isRu, inviteCount, subscription, level, ctx, }: { isRu: boolean; inviteCount: number; subscription: SubscriptionType; level: number; ctx: MyContext; }) => Promise<Markup<ReplyKeyboardMarkup>>'.\n\n    \u001b[7m50\u001b[0m       mainMenu.ru.text,\n    \u001b[7m  \u001b[0m \u001b[91m               ~~\u001b[0m\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m51\u001b[0m:\u001b[93m16\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'ru' does not exist on type '({ isRu, inviteCount, subscription, level, ctx, }: { isRu: boolean; inviteCount: number; subscription: SubscriptionType; level: number; ctx: MyContext; }) => Promise<Markup<ReplyKeyboardMarkup>>'.\n\n    \u001b[7m51\u001b[0m       mainMenu.ru.keyboard\n    \u001b[7m  \u001b[0m \u001b[91m               ~~\u001b[0m\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m56\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m56\u001b[0m     ctx.from = { id: 43, language_code: 'en' }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m57\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2739: \u001b[0mType '{ mode: ModeEnum.DigitalAvatarBodyV2; }' is missing the following properties from type 'MySession': cursor, images, targetUserId, userModel\n\n    \u001b[7m57\u001b[0m     ctx.session = { mode: ModeEnum.DigitalAvatarBodyV2 } // Используем ModeEnum\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m64\u001b[0m:\u001b[93m16\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'en' does not exist on type '({ isRu, inviteCount, subscription, level, ctx, }: { isRu: boolean; inviteCount: number; subscription: SubscriptionType; level: number; ctx: MyContext; }) => Promise<Markup<ReplyKeyboardMarkup>>'.\n\n    \u001b[7m64\u001b[0m       mainMenu.en.text,\n    \u001b[7m  \u001b[0m \u001b[91m               ~~\u001b[0m\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m65\u001b[0m:\u001b[93m16\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'en' does not exist on type '({ isRu, inviteCount, subscription, level, ctx, }: { isRu: boolean; inviteCount: number; subscription: SubscriptionType; level: number; ctx: MyContext; }) => Promise<Markup<ReplyKeyboardMarkup>>'.\n\n    \u001b[7m65\u001b[0m       mainMenu.en.keyboard\n    \u001b[7m  \u001b[0m \u001b[91m               ~~\u001b[0m\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m70\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m70\u001b[0m     ctx.from = { id: 44, language_code: 'en' }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m71\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2739: \u001b[0mType '{ mode: ModeEnum.Help; }' is missing the following properties from type 'MySession': cursor, images, targetUserId, userModel\n\n    \u001b[7m71\u001b[0m     ctx.session = { mode: ModeEnum.Help } // Используем ModeEnum\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m83\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m83\u001b[0m     ctx.from = { id: 45, language_code: 'ru' }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m84\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2739: \u001b[0mType '{ mode: ModeEnum.DigitalAvatarBodyV2; }' is missing the following properties from type 'MySession': cursor, images, targetUserId, userModel\n\n    \u001b[7m84\u001b[0m     ctx.session = { mode: ModeEnum.DigitalAvatarBodyV2 } // Используем ModeEnum\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m91\u001b[0m:\u001b[93m16\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'ru' does not exist on type '({ isRu, inviteCount, subscription, level, ctx, }: { isRu: boolean; inviteCount: number; subscription: SubscriptionType; level: number; ctx: MyContext; }) => Promise<Markup<ReplyKeyboardMarkup>>'.\n\n    \u001b[7m91\u001b[0m       mainMenu.ru.text,\n    \u001b[7m  \u001b[0m \u001b[91m               ~~\u001b[0m\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m92\u001b[0m:\u001b[93m16\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'ru' does not exist on type '({ isRu, inviteCount, subscription, level, ctx, }: { isRu: boolean; inviteCount: number; subscription: SubscriptionType; level: number; ctx: MyContext; }) => Promise<Markup<ReplyKeyboardMarkup>>'.\n\n    \u001b[7m92\u001b[0m       mainMenu.ru.keyboard\n    \u001b[7m  \u001b[0m \u001b[91m               ~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/scenes/levelQuestWizardHandlers.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/scenes/levelQuestWizardHandlers.test.ts\u001b[0m:\u001b[93m21\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m21\u001b[0m     ctx.from = { id: 99, language_code: 'ru' }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/scenes/imageToPromptWizard.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/scenes/imageToPromptWizard.test.ts\u001b[0m:\u001b[93m24\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m24\u001b[0m     await step0(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/imageToPromptWizard.test.ts\u001b[0m:\u001b[93m35\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m35\u001b[0m     await step0(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/imageToPromptWizard.test.ts\u001b[0m:\u001b[93m50\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m50\u001b[0m     await step1(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/imageToPromptWizard.test.ts\u001b[0m:\u001b[93m58\u001b[0m:\u001b[93m42\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2353: \u001b[0mObject literal may only specify known properties, and 'message' does not exist in type 'Partial<MySession>'.\n\n    \u001b[7m58\u001b[0m     const msgCtx = makeMockContext({}, { message: { text: 'foo' } })\n    \u001b[7m  \u001b[0m \u001b[91m                                         ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/imageToPromptWizard.test.ts\u001b[0m:\u001b[93m62\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m62\u001b[0m     await step1(msgCtx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/imageToPromptWizard.test.ts\u001b[0m:\u001b[93m71\u001b[0m:\u001b[93m7\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2353: \u001b[0mObject literal may only specify known properties, and 'message' does not exist in type 'Partial<MySession>'.\n\n    \u001b[7m71\u001b[0m       message: { photo: [{ file_id: 'fid1' }, { file_id: 'fid2' }] }\n    \u001b[7m  \u001b[0m \u001b[91m      ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/imageToPromptWizard.test.ts\u001b[0m:\u001b[93m77\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m77\u001b[0m     await step1(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/scenes/levelQuestWizard.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/scenes/levelQuestWizard.test.ts\u001b[0m:\u001b[93m42\u001b[0m:\u001b[93m15\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'match' does not exist on type 'MyContext & DebugExtension'.\n\n    \u001b[7m42\u001b[0m     await ctx.match('➡️ Далее шаг 1')\n    \u001b[7m  \u001b[0m \u001b[91m              ~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/scenes/lipSyncWizard.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/scenes/lipSyncWizard.test.ts\u001b[0m:\u001b[93m22\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m22\u001b[0m     await step0(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/lipSyncWizard.test.ts\u001b[0m:\u001b[93m31\u001b[0m:\u001b[93m39\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2353: \u001b[0mObject literal may only specify known properties, and 'message' does not exist in type 'Partial<MySession>'.\n\n    \u001b[7m31\u001b[0m     const ctx = makeMockContext({}, { message: { video: { file_id: 'file123' } } })\n    \u001b[7m  \u001b[0m \u001b[91m                                      ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/lipSyncWizard.test.ts\u001b[0m:\u001b[93m36\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m36\u001b[0m     await step1(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/lipSyncWizard.test.ts\u001b[0m:\u001b[93m45\u001b[0m:\u001b[93m39\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2353: \u001b[0mObject literal may only specify known properties, and 'message' does not exist in type 'Partial<MySession>'.\n\n    \u001b[7m45\u001b[0m     const ctx = makeMockContext({}, { message: { text: url } })\n    \u001b[7m  \u001b[0m \u001b[91m                                      ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/lipSyncWizard.test.ts\u001b[0m:\u001b[93m48\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m48\u001b[0m     await step1(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/lipSyncWizard.test.ts\u001b[0m:\u001b[93m60\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m60\u001b[0m     await step2(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/lipSyncWizard.test.ts\u001b[0m:\u001b[93m70\u001b[0m:\u001b[93m39\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2353: \u001b[0mObject literal may only specify known properties, and 'message' does not exist in type 'Partial<MySession>'.\n\n    \u001b[7m70\u001b[0m     const ctx = makeMockContext({}, { message: { text: audio } })\n    \u001b[7m  \u001b[0m \u001b[91m                                      ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/lipSyncWizard.test.ts\u001b[0m:\u001b[93m77\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m77\u001b[0m     await step2(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/scenes/selectModelWizard.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/scenes/selectModelWizard.test.ts\u001b[0m:\u001b[93m17\u001b[0m:\u001b[93m10\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2724: \u001b[0m'\"../../src/core/supabase\"' has no exported member named 'setModel'. Did you mean 'getModel'?\n\n    \u001b[7m17\u001b[0m import { setModel, getUserByTelegramId, updateUserLevelPlusOne } from '../../src/core/supabase'\n    \u001b[7m  \u001b[0m \u001b[91m         ~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/selectModelWizard.test.ts\u001b[0m:\u001b[93m32\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m32\u001b[0m     await step0(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/selectModelWizard.test.ts\u001b[0m:\u001b[93m46\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m46\u001b[0m     await step1(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/selectModelWizard.test.ts\u001b[0m:\u001b[93m58\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m58\u001b[0m     await step1(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/scenes/neuroPhotoWizard.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/scenes/neuroPhotoWizard.test.ts\u001b[0m:\u001b[93m66\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m66\u001b[0m     await step(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroPhotoWizard.test.ts\u001b[0m:\u001b[93m97\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m97\u001b[0m     await step(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroPhotoWizard.test.ts\u001b[0m:\u001b[93m124\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m124\u001b[0m     await step(ctx)\n    \u001b[7m   \u001b[0m \u001b[91m          ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroPhotoWizard.test.ts\u001b[0m:\u001b[93m134\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2353: \u001b[0mObject literal may only specify known properties, and 'session' does not exist in type 'Partial<MySession>'.\n\n    \u001b[7m134\u001b[0m       { session: { userModel }, message: { text: 'hello' } }\n    \u001b[7m   \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroPhotoWizard.test.ts\u001b[0m:\u001b[93m147\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m147\u001b[0m     await step(ctx)\n    \u001b[7m   \u001b[0m \u001b[91m          ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroPhotoWizard.test.ts\u001b[0m:\u001b[93m159\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m159\u001b[0m     await step(ctx)\n    \u001b[7m   \u001b[0m \u001b[91m          ~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/scenes/sizeWizard.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/scenes/sizeWizard.test.ts\u001b[0m:\u001b[93m15\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m15\u001b[0m     ctx.from = { id: 1, language_code: 'ru' }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/sizeWizard.test.ts\u001b[0m:\u001b[93m22\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m22\u001b[0m     await step0(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/sizeWizard.test.ts\u001b[0m:\u001b[93m31\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m31\u001b[0m     ctx.message = undefined\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/sizeWizard.test.ts\u001b[0m:\u001b[93m34\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m34\u001b[0m     await step1(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/sizeWizard.test.ts\u001b[0m:\u001b[93m40\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m40\u001b[0m     ctx.message = { text: 'foo' } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/sizeWizard.test.ts\u001b[0m:\u001b[93m43\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m43\u001b[0m     await step1(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/sizeWizard.test.ts\u001b[0m:\u001b[93m50\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m50\u001b[0m     ctx.message = { text: '16:9' } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/sizeWizard.test.ts\u001b[0m:\u001b[93m54\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m54\u001b[0m     await step1(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/scenes/textToImageWizard.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/scenes/textToImageWizard.test.ts\u001b[0m:\u001b[93m31\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m31\u001b[0m     await step0(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/textToImageWizard.test.ts\u001b[0m:\u001b[93m38\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m38\u001b[0m     await step0(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/textToImageWizard.test.ts\u001b[0m:\u001b[93m52\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m52\u001b[0m     await step2(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/textToImageWizard.test.ts\u001b[0m:\u001b[93m63\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m63\u001b[0m     await step2(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/scenes/subscriptionCheckScene.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/scenes/subscriptionCheckScene.test.ts\u001b[0m:\u001b[93m11\u001b[0m:\u001b[93m8\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1141: \u001b[0mString literal expected.\n\n    \u001b[7m11\u001b[0m import { subscriptionCheckScene } from '../../src/scenes/subscriptionCheckScene'\n    \u001b[7m  \u001b[0m \u001b[91m       ~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/subscriptionCheckScene.test.ts\u001b[0m:\u001b[93m11\u001b[0m:\u001b[93m35\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2304: \u001b[0mCannot find name 'from'.\n\n    \u001b[7m11\u001b[0m import { subscriptionCheckScene } from '../../src/scenes/subscriptionCheckScene'\n    \u001b[7m  \u001b[0m \u001b[91m                                  ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/subscriptionCheckScene.test.ts\u001b[0m:\u001b[93m19\u001b[0m:\u001b[93m3\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2459: \u001b[0mModule '\"@/interfaces/telegram-bot.interface\"' declares 'SubscriptionType' locally, but it is not exported.\n\n    \u001b[7m19\u001b[0m   SubscriptionType,\n    \u001b[7m  \u001b[0m \u001b[91m  ~~~~~~~~~~~~~~~~\u001b[0m\n\n      \u001b[96msrc/interfaces/telegram-bot.interface.ts\u001b[0m:\u001b[93m7\u001b[0m:\u001b[93m10\u001b[0m\n        \u001b[7m7\u001b[0m import { SubscriptionType } from './subscription.interface'\n        \u001b[7m \u001b[0m \u001b[96m         ~~~~~~~~~~~~~~~~\u001b[0m\n        'SubscriptionType' is declared here.\n    \u001b[96m__tests__/scenes/subscriptionCheckScene.test.ts\u001b[0m:\u001b[93m23\u001b[0m:\u001b[93m3\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2614: \u001b[0mModule '\"../utils/makeMockContext\"' has no exported member 'MockContextOptions'. Did you mean to use 'import MockContextOptions from \"../utils/makeMockContext\"' instead?\n\n    \u001b[7m23\u001b[0m   MockContextOptions,\n    \u001b[7m  \u001b[0m \u001b[91m  ~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/subscriptionCheckScene.test.ts\u001b[0m:\u001b[93m29\u001b[0m:\u001b[93m28\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2307: \u001b[0mCannot find module '@/constants' or its corresponding type declarations.\n\n    \u001b[7m29\u001b[0m import * as constants from '@/constants'\n    \u001b[7m  \u001b[0m \u001b[91m                           ~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/subscriptionCheckScene.test.ts\u001b[0m:\u001b[93m82\u001b[0m:\u001b[93m29\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2353: \u001b[0mObject literal may only specify known properties, and 'from' does not exist in type 'Partial<Update> & { message?: Partial<TextMessage>; callback_query?: Partial<CallbackQuery>; inline_query?: Partial<InlineQuery>; pre_checkout_query?: Partial<...>; }'.\n\n    \u001b[7m82\u001b[0m     ctx = makeMockContext({ from: { id: adminId } })\n    \u001b[7m  \u001b[0m \u001b[91m                            ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/subscriptionCheckScene.test.ts\u001b[0m:\u001b[93m90\u001b[0m:\u001b[93m29\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2353: \u001b[0mObject literal may only specify known properties, and 'from' does not exist in type 'Partial<Update> & { message?: Partial<TextMessage>; callback_query?: Partial<CallbackQuery>; inline_query?: Partial<InlineQuery>; pre_checkout_query?: Partial<...>; }'.\n\n    \u001b[7m90\u001b[0m     ctx = makeMockContext({ from: { id: userId } })\n    \u001b[7m  \u001b[0m \u001b[91m                            ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/subscriptionCheckScene.test.ts\u001b[0m:\u001b[93m98\u001b[0m:\u001b[93m29\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2353: \u001b[0mObject literal may only specify known properties, and 'from' does not exist in type 'Partial<Update> & { message?: Partial<TextMessage>; callback_query?: Partial<CallbackQuery>; inline_query?: Partial<InlineQuery>; pre_checkout_query?: Partial<...>; }'.\n\n    \u001b[7m98\u001b[0m     ctx = makeMockContext({ from: { id: userId } })\n    \u001b[7m  \u001b[0m \u001b[91m                            ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/subscriptionCheckScene.test.ts\u001b[0m:\u001b[93m107\u001b[0m:\u001b[93m29\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2353: \u001b[0mObject literal may only specify known properties, and 'from' does not exist in type 'Partial<Update> & { message?: Partial<TextMessage>; callback_query?: Partial<CallbackQuery>; inline_query?: Partial<InlineQuery>; pre_checkout_query?: Partial<...>; }'.\n\n    \u001b[7m107\u001b[0m     ctx = makeMockContext({ from: { id: userId } })\n    \u001b[7m   \u001b[0m \u001b[91m                            ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/subscriptionCheckScene.test.ts\u001b[0m:\u001b[93m116\u001b[0m:\u001b[93m29\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2353: \u001b[0mObject literal may only specify known properties, and 'from' does not exist in type 'Partial<Update> & { message?: Partial<TextMessage>; callback_query?: Partial<CallbackQuery>; inline_query?: Partial<InlineQuery>; pre_checkout_query?: Partial<...>; }'.\n\n    \u001b[7m116\u001b[0m     ctx = makeMockContext({ from: { id: userId } })\n    \u001b[7m   \u001b[0m \u001b[91m                            ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/subscriptionCheckScene.test.ts\u001b[0m:\u001b[93m135\u001b[0m:\u001b[93m12\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'checkSubscriptionByTelegramId' does not exist on type 'SupabaseMock'.\n\n    \u001b[7m135\u001b[0m     spMock.checkSubscriptionByTelegramId.mockRejectedValue(err)\n    \u001b[7m   \u001b[0m \u001b[91m           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/subscriptionCheckScene.test.ts\u001b[0m:\u001b[93m142\u001b[0m:\u001b[93m12\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'checkSubscriptionByTelegramId' does not exist on type 'SupabaseMock'.\n\n    \u001b[7m142\u001b[0m     spMock.checkSubscriptionByTelegramId = jest\n    \u001b[7m   \u001b[0m \u001b[91m           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/subscriptionCheckScene.test.ts\u001b[0m:\u001b[93m146\u001b[0m:\u001b[93m29\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2353: \u001b[0mObject literal may only specify known properties, and 'from' does not exist in type 'Partial<Update> & { message?: Partial<TextMessage>; callback_query?: Partial<CallbackQuery>; inline_query?: Partial<InlineQuery>; pre_checkout_query?: Partial<...>; }'.\n\n    \u001b[7m146\u001b[0m     ctx = makeMockContext({ from: { id: 123, language_code: 'ru' } }) // ID админа из mockAdminIdsArray\n    \u001b[7m   \u001b[0m \u001b[91m                            ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/subscriptionCheckScene.test.ts\u001b[0m:\u001b[93m151\u001b[0m:\u001b[93m19\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'checkSubscriptionByTelegramId' does not exist on type 'SupabaseMock'.\n\n    \u001b[7m151\u001b[0m     expect(spMock.checkSubscriptionByTelegramId).not.toHaveBeenCalled() // Проверка подписки не должна вызываться для админа\n    \u001b[7m   \u001b[0m \u001b[91m                  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/subscriptionCheckScene.test.ts\u001b[0m:\u001b[93m11\u001b[0m:\u001b[93m1\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1003: \u001b[0mIdentifier expected.\n\n    \u001b[7m11\u001b[0m import { subscriptionCheckScene } from '../../src/scenes/subscriptionCheckScene'\n    \u001b[7m  \u001b[0m \u001b[91m~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/subscriptionCheckScene.test.ts\u001b[0m:\u001b[93m11\u001b[0m:\u001b[93m8\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1005: \u001b[0m',' expected.\n\n    \u001b[7m11\u001b[0m import { subscriptionCheckScene } from '../../src/scenes/subscriptionCheckScene'\n    \u001b[7m  \u001b[0m \u001b[91m       ~\u001b[0m\n    \u001b[96m__tests__/scenes/subscriptionCheckScene.test.ts\u001b[0m:\u001b[93m11\u001b[0m:\u001b[93m35\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1005: \u001b[0m';' expected.\n\n    \u001b[7m11\u001b[0m import { subscriptionCheckScene } from '../../src/scenes/subscriptionCheckScene'\n    \u001b[7m  \u001b[0m \u001b[91m                                  ~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/scenes/textToVideoWizard.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/scenes/textToVideoWizard.test.ts\u001b[0m:\u001b[93m30\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m30\u001b[0m     ctx.from = { id: 7, username: 'user', language_code: 'ru' }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/textToVideoWizard.test.ts\u001b[0m:\u001b[93m31\u001b[0m:\u001b[93m18\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'token' because it is a read-only property.\n\n    \u001b[7m31\u001b[0m     ctx.telegram.token = 'TOKEN'\n    \u001b[7m  \u001b[0m \u001b[91m                 ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/textToVideoWizard.test.ts\u001b[0m:\u001b[93m40\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m40\u001b[0m     await step0(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/textToVideoWizard.test.ts\u001b[0m:\u001b[93m53\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m53\u001b[0m     await step0(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/textToVideoWizard.test.ts\u001b[0m:\u001b[93m59\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m59\u001b[0m     ctx.message = { }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/textToVideoWizard.test.ts\u001b[0m:\u001b[93m62\u001b[0m:\u001b[93m18\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m62\u001b[0m     await expect(step1(ctx)).rejects.toThrow('Could not identify model')\n    \u001b[7m  \u001b[0m \u001b[91m                 ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/textToVideoWizard.test.ts\u001b[0m:\u001b[93m66\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m66\u001b[0m     ctx.message = { text: 'cancel' }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/textToVideoWizard.test.ts\u001b[0m:\u001b[93m75\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m75\u001b[0m     await step1(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/textToVideoWizard.test.ts\u001b[0m:\u001b[93m80\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m80\u001b[0m     ctx.message = { text: 'modelx' }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/textToVideoWizard.test.ts\u001b[0m:\u001b[93m87\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m87\u001b[0m     await step1(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/textToVideoWizard.test.ts\u001b[0m:\u001b[93m93\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m93\u001b[0m     ctx.message = { text: 'modelx' }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/textToVideoWizard.test.ts\u001b[0m:\u001b[93m100\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m100\u001b[0m     await step1(ctx)\n    \u001b[7m   \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/textToVideoWizard.test.ts\u001b[0m:\u001b[93m108\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m108\u001b[0m     ctx.message = { text: 'hello' }\n    \u001b[7m   \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/textToVideoWizard.test.ts\u001b[0m:\u001b[93m113\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m113\u001b[0m     await step2(ctx)\n    \u001b[7m   \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/textToVideoWizard.test.ts\u001b[0m:\u001b[93m123\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m123\u001b[0m     ctx.message = {}\n    \u001b[7m   \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/textToVideoWizard.test.ts\u001b[0m:\u001b[93m127\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m127\u001b[0m     await step2(ctx)\n    \u001b[7m   \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/services/downloadFile.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    Failed to load .env file at /Users/playra/999-multibots-telegraf/.env\n\n    \u001b[0m \u001b[90m 23 |\u001b[39m   } \u001b[36melse\u001b[39m {\n     \u001b[90m 24 |\u001b[39m     \u001b[90m// Для dev режима бросим ошибку, чтобы nodemon показал проблему\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 25 |\u001b[39m     \u001b[36mthrow\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(\u001b[32m`Failed to load .env file at ${envPath}`\u001b[39m)\n     \u001b[90m    |\u001b[39m           \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 26 |\u001b[39m   }\n     \u001b[90m 27 |\u001b[39m } \u001b[36melse\u001b[39m \u001b[36mif\u001b[39m (\u001b[33m!\u001b[39mloadResult\u001b[33m.\u001b[39mparsed \u001b[33m||\u001b[39m \u001b[33mObject\u001b[39m\u001b[33m.\u001b[39mkeys(loadResult\u001b[33m.\u001b[39mparsed)\u001b[33m.\u001b[39mlength \u001b[33m===\u001b[39m \u001b[35m0\u001b[39m) {\n     \u001b[90m 28 |\u001b[39m   console\u001b[33m.\u001b[39merror(\u001b[0m\n\n      \u001b[2mat Object.<anonymous> (\u001b[22msrc/config/index.ts\u001b[2m:25:11)\u001b[22m\n      \u001b[2mat Object.require (\u001b[22msrc/services/generateLipSync.ts\u001b[2m:3:1)\u001b[22m\n      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[0m\u001b[36m__tests__/services/downloadFile.test.ts\u001b[39m\u001b[0m\u001b[2m:6:1)\u001b[22m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/scenes/trainFluxModelWizard.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/scenes/trainFluxModelWizard.test.ts\u001b[0m:\u001b[93m28\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m28\u001b[0m     await step0(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/trainFluxModelWizard.test.ts\u001b[0m:\u001b[93m46\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m46\u001b[0m     await step0(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/trainFluxModelWizard.test.ts\u001b[0m:\u001b[93m59\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m59\u001b[0m     await step1(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/trainFluxModelWizard.test.ts\u001b[0m:\u001b[93m73\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m73\u001b[0m     await step1(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/trainFluxModelWizard.test.ts\u001b[0m:\u001b[93m83\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m83\u001b[0m     await step1(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/scenes/uploadVideoScene.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/scenes/uploadVideoScene.test.ts\u001b[0m:\u001b[93m22\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m22\u001b[0m     await step0(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/uploadVideoScene.test.ts\u001b[0m:\u001b[93m32\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m32\u001b[0m     ctx.from = { id: 1, language_code: 'ru' }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/uploadVideoScene.test.ts\u001b[0m:\u001b[93m34\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2322: \u001b[0mType 'Mock<Promise<{ file_path: string; }>, [], any>' is not assignable to type '(fileId: string) => Promise<File>'.\n      Type 'Promise<{ file_path: string; }>' is not assignable to type 'Promise<File>'.\n        Type '{ file_path: string; }' is missing the following properties from type 'File': file_id, file_unique_id\n\n    \u001b[7m34\u001b[0m     ctx.telegram.getFile = jest.fn(() => Promise.resolve(fakeFile))\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/uploadVideoScene.test.ts\u001b[0m:\u001b[93m35\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m35\u001b[0m     ctx.message = { video: { file_id: 'vid1', file_size: 100 } }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/uploadVideoScene.test.ts\u001b[0m:\u001b[93m38\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m38\u001b[0m     await step1(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/uploadVideoScene.test.ts\u001b[0m:\u001b[93m47\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m47\u001b[0m     ctx.from = { id: 1, language_code: 'ru' }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/uploadVideoScene.test.ts\u001b[0m:\u001b[93m48\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m48\u001b[0m     ctx.message = { video: { file_id: 'vid1', file_size: 60 * 1024 * 1024 } }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/uploadVideoScene.test.ts\u001b[0m:\u001b[93m51\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m51\u001b[0m     await step1(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/uploadVideoScene.test.ts\u001b[0m:\u001b[93m60\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m60\u001b[0m     ctx.from = { id: 1, language_code: 'ru' }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/uploadVideoScene.test.ts\u001b[0m:\u001b[93m61\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m61\u001b[0m     ctx.message = { text: 'hello' }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/uploadVideoScene.test.ts\u001b[0m:\u001b[93m64\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m64\u001b[0m     await step1(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/uploadVideoScene.test.ts\u001b[0m:\u001b[93m73\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m73\u001b[0m     ctx.from = { id: 2, language_code: 'ru' }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/uploadVideoScene.test.ts\u001b[0m:\u001b[93m74\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2739: \u001b[0mType '{ videoUrl: string; }' is missing the following properties from type 'MySession': cursor, images, targetUserId, userModel\n\n    \u001b[7m74\u001b[0m     ctx.session = { videoUrl: 'url.mp4' }\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/uploadVideoScene.test.ts\u001b[0m:\u001b[93m81\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m81\u001b[0m     await step2(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/uploadVideoScene.test.ts\u001b[0m:\u001b[93m95\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m95\u001b[0m     ctx.from = { id: 3, language_code: 'ru' }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/uploadVideoScene.test.ts\u001b[0m:\u001b[93m96\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2739: \u001b[0mType '{ videoUrl: string; }' is missing the following properties from type 'MySession': cursor, images, targetUserId, userModel\n\n    \u001b[7m96\u001b[0m     ctx.session = { videoUrl: 'url.mp4' }\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/uploadVideoScene.test.ts\u001b[0m:\u001b[93m103\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m103\u001b[0m     await step2(ctx)\n    \u001b[7m   \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/services/downloadFile.unit.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    Failed to load .env file at /Users/playra/999-multibots-telegraf/.env\n\n    \u001b[0m \u001b[90m 23 |\u001b[39m   } \u001b[36melse\u001b[39m {\n     \u001b[90m 24 |\u001b[39m     \u001b[90m// Для dev режима бросим ошибку, чтобы nodemon показал проблему\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 25 |\u001b[39m     \u001b[36mthrow\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(\u001b[32m`Failed to load .env file at ${envPath}`\u001b[39m)\n     \u001b[90m    |\u001b[39m           \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 26 |\u001b[39m   }\n     \u001b[90m 27 |\u001b[39m } \u001b[36melse\u001b[39m \u001b[36mif\u001b[39m (\u001b[33m!\u001b[39mloadResult\u001b[33m.\u001b[39mparsed \u001b[33m||\u001b[39m \u001b[33mObject\u001b[39m\u001b[33m.\u001b[39mkeys(loadResult\u001b[33m.\u001b[39mparsed)\u001b[33m.\u001b[39mlength \u001b[33m===\u001b[39m \u001b[35m0\u001b[39m) {\n     \u001b[90m 28 |\u001b[39m   console\u001b[33m.\u001b[39merror(\u001b[0m\n\n      \u001b[2mat Object.<anonymous> (\u001b[22msrc/config/index.ts\u001b[2m:25:11)\u001b[22m\n      \u001b[2mat Object.require (\u001b[22msrc/services/generateLipSync.ts\u001b[2m:3:1)\u001b[22m\n      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[0m\u001b[36m__tests__/services/downloadFile.unit.test.ts\u001b[39m\u001b[0m\u001b[2m:10:1)\u001b[22m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/scenes/neuroPhotoWizardV2.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/scenes/neuroPhotoWizardV2.test.ts\u001b[0m:\u001b[93m41\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m41\u001b[0m     await step0(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroPhotoWizardV2.test.ts\u001b[0m:\u001b[93m59\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m59\u001b[0m     await step0(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroPhotoWizardV2.test.ts\u001b[0m:\u001b[93m71\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m71\u001b[0m     await step1(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/scenes/voiceAvatarWizard.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/scenes/voiceAvatarWizard.test.ts\u001b[0m:\u001b[93m48\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m48\u001b[0m     await step0(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/voiceAvatarWizard.test.ts\u001b[0m:\u001b[93m57\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m57\u001b[0m     ctx.from = { id: 10, language_code: 'ru' }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/voiceAvatarWizard.test.ts\u001b[0m:\u001b[93m63\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m63\u001b[0m     await step0(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/config/debug.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/config/debug.test.ts\u001b[0m:\u001b[93m1\u001b[0m:\u001b[93m8\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2300: \u001b[0mDuplicate identifier 'fs'.\n\n    \u001b[7m1\u001b[0m import fs from 'fs'\n    \u001b[7m \u001b[0m \u001b[91m       ~~\u001b[0m\n    \u001b[96m__tests__/config/debug.test.ts\u001b[0m:\u001b[93m2\u001b[0m:\u001b[93m8\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2300: \u001b[0mDuplicate identifier 'path'.\n\n    \u001b[7m2\u001b[0m import path from 'path'\n    \u001b[7m \u001b[0m \u001b[91m       ~~~~\u001b[0m\n    \u001b[96m__tests__/config/debug.test.ts\u001b[0m:\u001b[93m3\u001b[0m:\u001b[93m8\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2300: \u001b[0mDuplicate identifier 'fs'.\n\n    \u001b[7m3\u001b[0m import fs from 'fs'\n    \u001b[7m \u001b[0m \u001b[91m       ~~\u001b[0m\n    \u001b[96m__tests__/config/debug.test.ts\u001b[0m:\u001b[93m4\u001b[0m:\u001b[93m8\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2300: \u001b[0mDuplicate identifier 'path'.\n\n    \u001b[7m4\u001b[0m import path from 'path'\n    \u001b[7m \u001b[0m \u001b[91m       ~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/services/createModelTraining.unit.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/services/createModelTraining.unit.test.ts\u001b[0m:\u001b[93m72\u001b[0m:\u001b[93m17\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Type 'Error' has no call signatures.\n\n    \u001b[7m72\u001b[0m     const err = new Error('xyz')\n    \u001b[7m  \u001b[0m \u001b[91m                ~~~~~~~~~~~~~~~~\u001b[0m\n\n      \u001b[96m__tests__/services/createModelTraining.unit.test.ts\u001b[0m:\u001b[93m72\u001b[0m:\u001b[93m17\u001b[0m\n        \u001b[7m72\u001b[0m     const err = new Error('xyz')\n        \u001b[7m  \u001b[0m \u001b[96m                ~~~~~~~~~~~~~~~~\u001b[0m\n        Are you missing a semicolon?\n    \u001b[96m__tests__/services/createModelTraining.unit.test.ts\u001b[0m:\u001b[93m73\u001b[0m:\u001b[93m49\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2448: \u001b[0mBlock-scoped variable 'err' used before its declaration.\n\n    \u001b[7m73\u001b[0m     (axios.post as jest.Mock).mockRejectedValue(err)\n    \u001b[7m  \u001b[0m \u001b[91m                                                ~~~\u001b[0m\n\n      \u001b[96m__tests__/services/createModelTraining.unit.test.ts\u001b[0m:\u001b[93m72\u001b[0m:\u001b[93m11\u001b[0m\n        \u001b[7m72\u001b[0m     const err = new Error('xyz')\n        \u001b[7m  \u001b[0m \u001b[96m          ~~~\u001b[0m\n        'err' is declared here.\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/services/generateTextToSpeech.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/services/generateTextToSpeech.test.ts\u001b[0m:\u001b[93m2\u001b[0m:\u001b[93m3\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2614: \u001b[0mModule '\"axios\"' has no exported member 'describe'. Did you mean to use 'import describe from \"axios\"' instead?\n\n    \u001b[7m2\u001b[0m   describe,\n    \u001b[7m \u001b[0m \u001b[91m  ~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateTextToSpeech.test.ts\u001b[0m:\u001b[93m3\u001b[0m:\u001b[93m3\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2614: \u001b[0mModule '\"axios\"' has no exported member 'it'. Did you mean to use 'import it from \"axios\"' instead?\n\n    \u001b[7m3\u001b[0m   it,\n    \u001b[7m \u001b[0m \u001b[91m  ~~\u001b[0m\n    \u001b[96m__tests__/services/generateTextToSpeech.test.ts\u001b[0m:\u001b[93m4\u001b[0m:\u001b[93m3\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2614: \u001b[0mModule '\"axios\"' has no exported member 'expect'. Did you mean to use 'import expect from \"axios\"' instead?\n\n    \u001b[7m4\u001b[0m   expect,\n    \u001b[7m \u001b[0m \u001b[91m  ~~~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateTextToSpeech.test.ts\u001b[0m:\u001b[93m5\u001b[0m:\u001b[93m3\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2614: \u001b[0mModule '\"axios\"' has no exported member 'jest'. Did you mean to use 'import jest from \"axios\"' instead?\n\n    \u001b[7m5\u001b[0m   jest,\n    \u001b[7m \u001b[0m \u001b[91m  ~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateTextToSpeech.test.ts\u001b[0m:\u001b[93m6\u001b[0m:\u001b[93m3\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2614: \u001b[0mModule '\"axios\"' has no exported member 'beforeEach'. Did you mean to use 'import beforeEach from \"axios\"' instead?\n\n    \u001b[7m6\u001b[0m   beforeEach,\n    \u001b[7m \u001b[0m \u001b[91m  ~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateTextToSpeech.test.ts\u001b[0m:\u001b[93m7\u001b[0m:\u001b[93m3\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2614: \u001b[0mModule '\"axios\"' has no exported member 'afterEach'. Did you mean to use 'import afterEach from \"axios\"' instead?\n\n    \u001b[7m7\u001b[0m   afterEach,\n    \u001b[7m \u001b[0m \u001b[91m  ~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateTextToSpeech.test.ts\u001b[0m:\u001b[93m8\u001b[0m:\u001b[93m1\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2614: \u001b[0mModule '\"axios\"' has no exported member 'import'. Did you mean to use 'import import from \"axios\"' instead?\n\n    \u001b[7m8\u001b[0m import axios from 'axios'\n    \u001b[7m \u001b[0m \u001b[91m~~~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateTextToSpeech.test.ts\u001b[0m:\u001b[93m8\u001b[0m:\u001b[93m8\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2440: \u001b[0mImport declaration conflicts with local declaration of 'axios'.\n\n    \u001b[7m8\u001b[0m import axios from 'axios'\n    \u001b[7m \u001b[0m \u001b[91m       ~~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateTextToSpeech.test.ts\u001b[0m:\u001b[93m9\u001b[0m:\u001b[93m29\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2307: \u001b[0mCannot find module '../../../__tests__/utils/mockTelegrafContext' or its corresponding type declarations.\n\n    \u001b[7m9\u001b[0m import makeMockContext from '../../../__tests__/utils/mockTelegrafContext'\n    \u001b[7m \u001b[0m \u001b[91m                            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateTextToSpeech.test.ts\u001b[0m:\u001b[93m33\u001b[0m:\u001b[93m7\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2440: \u001b[0mImport declaration conflicts with local declaration of 'axios'.\n\n    \u001b[7m33\u001b[0m const axios = require('axios') // Теперь можно require\n    \u001b[7m  \u001b[0m \u001b[91m      ~~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateTextToSpeech.test.ts\u001b[0m:\u001b[93m8\u001b[0m:\u001b[93m1\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1003: \u001b[0mIdentifier expected.\n\n    \u001b[7m8\u001b[0m import axios from 'axios'\n    \u001b[7m \u001b[0m \u001b[91m~~~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateTextToSpeech.test.ts\u001b[0m:\u001b[93m8\u001b[0m:\u001b[93m8\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1005: \u001b[0m',' expected.\n\n    \u001b[7m8\u001b[0m import axios from 'axios'\n    \u001b[7m \u001b[0m \u001b[91m       ~~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateTextToSpeech.test.ts\u001b[0m:\u001b[93m8\u001b[0m:\u001b[93m14\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1005: \u001b[0m',' expected.\n\n    \u001b[7m8\u001b[0m import axios from 'axios'\n    \u001b[7m \u001b[0m \u001b[91m             ~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/services/generateLipSync.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/services/generateLipSync.test.ts\u001b[0m:\u001b[93m61\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Type 'typeof jest' has no call signatures.\n\n    \u001b[7m61\u001b[0m     jest.doMock('@/config', () => ({ isDev: false, ELESTIO_URL: 'https://api', LOCAL_SERVER_URL: 'http://localhost', SECRET_API_KEY: 'secret' }))\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n\n      \u001b[96m__tests__/services/generateLipSync.test.ts\u001b[0m:\u001b[93m61\u001b[0m:\u001b[93m5\u001b[0m\n        \u001b[7m61\u001b[0m     jest.doMock('@/config', () => ({ isDev: false, ELESTIO_URL: 'https://api', LOCAL_SERVER_URL: 'http://localhost', SECRET_API_KEY: 'secret' }))\n        \u001b[7m  \u001b[0m \u001b[96m    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n        Are you missing a semicolon?\n    \u001b[96m__tests__/services/generateLipSync.test.ts\u001b[0m:\u001b[93m83\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Type 'typeof jest' has no call signatures.\n\n    \u001b[7m83\u001b[0m     jest.doMock('axios', () => axios)\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n\n      \u001b[96m__tests__/services/generateLipSync.test.ts\u001b[0m:\u001b[93m83\u001b[0m:\u001b[93m5\u001b[0m\n        \u001b[7m83\u001b[0m     jest.doMock('axios', () => axios)\n        \u001b[7m  \u001b[0m \u001b[96m    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n        Are you missing a semicolon?\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/services/generateImageToPrompt.unit.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/services/generateImageToPrompt.unit.test.ts\u001b[0m:\u001b[93m25\u001b[0m:\u001b[93m76\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'boolean' is not assignable to parameter of type 'string'.\n\n    \u001b[7m25\u001b[0m     const result = await generateImageToPrompt(imageUrl, telegram_id, ctx, true, 'bot')\n    \u001b[7m  \u001b[0m \u001b[91m                                                                           ~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateImageToPrompt.unit.test.ts\u001b[0m:\u001b[93m33\u001b[0m:\u001b[93m6\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2352: \u001b[0mConversion of type '<T = any, D = any>(payload: any) => payload is AxiosError<T, D>' to type 'Mock<any, any, any>' may be a mistake because neither type sufficiently overlaps with the other. If this was intentional, convert the expression to 'unknown' first.\n      Type '<T = any, D = any>(payload: any) => payload is AxiosError<T, D>' is missing the following properties from type 'Mock<any, any, any>': getMockName, mock, mockClear, mockReset, and 13 more.\n\n    \u001b[7m33\u001b[0m     (axios.isAxiosError as jest.Mock).mockReturnValue(false)\n    \u001b[7m  \u001b[0m \u001b[91m     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateImageToPrompt.unit.test.ts\u001b[0m:\u001b[93m34\u001b[0m:\u001b[93m76\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'boolean' is not assignable to parameter of type 'string'.\n\n    \u001b[7m34\u001b[0m     const result = await generateImageToPrompt(imageUrl, telegram_id, ctx, false, 'bot')\n    \u001b[7m  \u001b[0m \u001b[91m                                                                           ~~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateImageToPrompt.unit.test.ts\u001b[0m:\u001b[93m58\u001b[0m:\u001b[93m6\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2352: \u001b[0mConversion of type '<T = any, D = any>(payload: any) => payload is AxiosError<T, D>' to type 'Mock<any, any, any>' may be a mistake because neither type sufficiently overlaps with the other. If this was intentional, convert the expression to 'unknown' first.\n      Type '<T = any, D = any>(payload: any) => payload is AxiosError<T, D>' is missing the following properties from type 'Mock<any, any, any>': getMockName, mock, mockClear, mockReset, and 13 more.\n\n    \u001b[7m58\u001b[0m     (axios.isAxiosError as jest.Mock).mockReturnValue(true)\n    \u001b[7m  \u001b[0m \u001b[91m     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateImageToPrompt.unit.test.ts\u001b[0m:\u001b[93m59\u001b[0m:\u001b[93m61\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'boolean' is not assignable to parameter of type 'string'.\n\n    \u001b[7m59\u001b[0m     await generateImageToPrompt(imageUrl, telegram_id, ctx, true, 'bot')\n    \u001b[7m  \u001b[0m \u001b[91m                                                            ~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateImageToPrompt.unit.test.ts\u001b[0m:\u001b[93m67\u001b[0m:\u001b[93m17\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Type 'Error' has no call signatures.\n\n    \u001b[7m67\u001b[0m     const err = new Error('boom')\n    \u001b[7m  \u001b[0m \u001b[91m                ~~~~~~~~~~~~~~~~~\u001b[0m\n\n      \u001b[96m__tests__/services/generateImageToPrompt.unit.test.ts\u001b[0m:\u001b[93m67\u001b[0m:\u001b[93m17\u001b[0m\n        \u001b[7m67\u001b[0m     const err = new Error('boom')\n        \u001b[7m  \u001b[0m \u001b[96m                ~~~~~~~~~~~~~~~~~\u001b[0m\n        Are you missing a semicolon?\n    \u001b[96m__tests__/services/generateImageToPrompt.unit.test.ts\u001b[0m:\u001b[93m68\u001b[0m:\u001b[93m49\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2448: \u001b[0mBlock-scoped variable 'err' used before its declaration.\n\n    \u001b[7m68\u001b[0m     (axios.post as jest.Mock).mockRejectedValue(err)\n    \u001b[7m  \u001b[0m \u001b[91m                                                ~~~\u001b[0m\n\n      \u001b[96m__tests__/services/generateImageToPrompt.unit.test.ts\u001b[0m:\u001b[93m67\u001b[0m:\u001b[93m11\u001b[0m\n        \u001b[7m67\u001b[0m     const err = new Error('boom')\n        \u001b[7m  \u001b[0m \u001b[96m          ~~~\u001b[0m\n        'err' is declared here.\n    \u001b[96m__tests__/services/generateImageToPrompt.unit.test.ts\u001b[0m:\u001b[93m69\u001b[0m:\u001b[93m6\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2352: \u001b[0mConversion of type '<T = any, D = any>(payload: any) => payload is AxiosError<T, D>' to type 'Mock<any, any, any>' may be a mistake because neither type sufficiently overlaps with the other. If this was intentional, convert the expression to 'unknown' first.\n      Type '<T = any, D = any>(payload: any) => payload is AxiosError<T, D>' is missing the following properties from type 'Mock<any, any, any>': getMockName, mock, mockClear, mockReset, and 13 more.\n\n    \u001b[7m69\u001b[0m     (axios.isAxiosError as jest.Mock).mockReturnValue(false)\n    \u001b[7m  \u001b[0m \u001b[91m     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateImageToPrompt.unit.test.ts\u001b[0m:\u001b[93m71\u001b[0m:\u001b[93m57\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'boolean' is not assignable to parameter of type 'string'.\n\n    \u001b[7m71\u001b[0m       generateImageToPrompt(imageUrl, telegram_id, ctx, false, 'bot')\n    \u001b[7m  \u001b[0m \u001b[91m                                                        ~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/price/helpers/processBalanceOperation.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/price/helpers/processBalanceOperation.test.ts\u001b[0m:\u001b[93m4\u001b[0m:\u001b[93m36\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2743: \u001b[0mNo overload expects 1 type arguments, but overloads do exist that expect either 0 or 2 type arguments.\n\n    \u001b[7m4\u001b[0m const mockGetUserBalance = jest.fn<() => Promise<number>>() // С указанием типа\n    \u001b[7m \u001b[0m \u001b[91m                                   ~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/price/helpers/processBalanceOperation.test.ts\u001b[0m:\u001b[93m5\u001b[0m:\u001b[93m39\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2743: \u001b[0mNo overload expects 1 type arguments, but overloads do exist that expect either 0 or 2 type arguments.\n\n    \u001b[7m5\u001b[0m const mockUpdateUserBalance = jest.fn<() => Promise<void>>() // С указанием типа\n    \u001b[7m \u001b[0m \u001b[91m                                      ~~~~~~~~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/services/generateTextToImage.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/services/generateTextToImage.test.ts\u001b[0m:\u001b[93m12\u001b[0m:\u001b[93m61\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '() => void' is not assignable to parameter of type '(infoObject: object) => Logger'.\n      Type 'void' is not assignable to type 'Logger'.\n\n    \u001b[7m12\u001b[0m     infoSpy = jest.spyOn(logger, 'info').mockImplementation(() => {})\n    \u001b[7m  \u001b[0m \u001b[91m                                                            ~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/price/refundUser.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/price/refundUser.test.ts\u001b[0m:\u001b[93m44\u001b[0m:\u001b[93m30\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Type 'String' has no call signatures.\n\n    \u001b[7m44\u001b[0m     ctx.from.language_code = 'en'\n    \u001b[7m  \u001b[0m \u001b[91m                             ~~~~\u001b[0m\n\n      \u001b[96m__tests__/price/refundUser.test.ts\u001b[0m:\u001b[93m44\u001b[0m:\u001b[93m30\u001b[0m\n        \u001b[7m44\u001b[0m     ctx.from.language_code = 'en'\n        \u001b[7m  \u001b[0m \u001b[96m                             ~~~~\u001b[0m\n        Are you missing a semicolon?\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/price/processBalanceVideoOperation.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/price/processBalanceVideoOperation.test.ts\u001b[0m:\u001b[93m15\u001b[0m:\u001b[93m23\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2554: \u001b[0mExpected 3 arguments, but got 1.\n\n    \u001b[7m15\u001b[0m     const res = await processBalanceVideoOperation({\n    \u001b[7m  \u001b[0m \u001b[91m                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n\n      \u001b[96msrc/price/helpers/processBalanceVideoOperation.ts\u001b[0m:\u001b[93m19\u001b[0m:\u001b[93m3\u001b[0m\n        \u001b[7m19\u001b[0m   videoModelName: VideoModel,\n        \u001b[7m  \u001b[0m \u001b[96m  ~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n        An argument for 'videoModelName' was not provided.\n    \u001b[96m__tests__/price/processBalanceVideoOperation.test.ts\u001b[0m:\u001b[93m30\u001b[0m:\u001b[93m23\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2554: \u001b[0mExpected 3 arguments, but got 1.\n\n    \u001b[7m30\u001b[0m     const res = await processBalanceVideoOperation({\n    \u001b[7m  \u001b[0m \u001b[91m                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n\n      \u001b[96msrc/price/helpers/processBalanceVideoOperation.ts\u001b[0m:\u001b[93m19\u001b[0m:\u001b[93m3\u001b[0m\n        \u001b[7m19\u001b[0m   videoModelName: VideoModel,\n        \u001b[7m  \u001b[0m \u001b[96m  ~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n        An argument for 'videoModelName' was not provided.\n    \u001b[96m__tests__/price/processBalanceVideoOperation.test.ts\u001b[0m:\u001b[93m48\u001b[0m:\u001b[93m23\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2554: \u001b[0mExpected 3 arguments, but got 1.\n\n    \u001b[7m48\u001b[0m     const res = await processBalanceVideoOperation({\n    \u001b[7m  \u001b[0m \u001b[91m                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n\n      \u001b[96msrc/price/helpers/processBalanceVideoOperation.ts\u001b[0m:\u001b[93m19\u001b[0m:\u001b[93m3\u001b[0m\n        \u001b[7m19\u001b[0m   videoModelName: VideoModel,\n        \u001b[7m  \u001b[0m \u001b[96m  ~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n        An argument for 'videoModelName' was not provided.\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/handlers/paymentActions.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/handlers/paymentActions.test.ts\u001b[0m:\u001b[93m14\u001b[0m:\u001b[93m23\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'handlePaymentPolicyInfo' does not exist on type 'typeof import(\"/Users/playra/999-multibots-telegraf/src/handlers/paymentHandlers/index\")'.\n\n    \u001b[7m14\u001b[0m       paymentHandlers.handlePaymentPolicyInfo\n    \u001b[7m  \u001b[0m \u001b[91m                      ~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/paymentActions.test.ts\u001b[0m:\u001b[93m20\u001b[0m:\u001b[93m23\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'handleTopUp' does not exist on type 'typeof import(\"/Users/playra/999-multibots-telegraf/src/handlers/paymentHandlers/index\")'.\n\n    \u001b[7m20\u001b[0m       paymentHandlers.handleTopUp\n    \u001b[7m  \u001b[0m \u001b[91m                      ~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/paymentActions.test.ts\u001b[0m:\u001b[93m26\u001b[0m:\u001b[93m23\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'handlePreCheckoutQuery' does not exist on type 'typeof import(\"/Users/playra/999-multibots-telegraf/src/handlers/paymentHandlers/index\")'.\n\n    \u001b[7m26\u001b[0m       paymentHandlers.handlePreCheckoutQuery\n    \u001b[7m  \u001b[0m \u001b[91m                      ~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/price/sendMessages.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/price/sendMessages.test.ts\u001b[0m:\u001b[93m17\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2554: \u001b[0mExpected 5 arguments, but got 4.\n\n    \u001b[7m17\u001b[0m     await sendBalanceMessage(ctx, 50, 10, true)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~~~~~~~~~~~~~~\u001b[0m\n\n      \u001b[96msrc/price/helpers/sendBalanceMessage.ts\u001b[0m:\u001b[93m8\u001b[0m:\u001b[93m3\u001b[0m\n        \u001b[7m8\u001b[0m   bot_name: string\n        \u001b[7m \u001b[0m \u001b[96m  ~~~~~~~~~~~~~~~~\u001b[0m\n        An argument for 'bot_name' was not provided.\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/handlers/handleMenu.branches.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/handlers/handleMenu.branches.test.ts\u001b[0m:\u001b[93m50\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m50\u001b[0m       ctx.message = { text: c.text }\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/handleMenu.branches.test.ts\u001b[0m:\u001b[93m59\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m59\u001b[0m     ctx.message = { text: 'unknown' }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/handlers/paymentFlow.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/handlers/paymentFlow.test.ts\u001b[0m:\u001b[93m24\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2322: \u001b[0mType 'Mock<Promise<void>, [], any>' is not assignable to type '(ok: boolean, errorMessage?: string) => Promise<true>'.\n      Type 'Promise<void>' is not assignable to type 'Promise<true>'.\n        Type 'void' is not assignable to type 'true'.\n\n    \u001b[7m24\u001b[0m     ctx.answerPreCheckoutQuery = jest.fn(() => Promise.resolve())\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/handlers/getSubScribeChannel.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    TypeError: Cannot read properties of undefined (reading 'info')\n\n    \u001b[0m \u001b[90m 66 |\u001b[39m \u001b[36mexport\u001b[39m \u001b[36mconst\u001b[39m defaultBot \u001b[33m=\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mTelegraf\u001b[39m\u001b[33m<\u001b[39m\u001b[33mMyContext\u001b[39m\u001b[33m>\u001b[39m(\u001b[33mDEFAULT_BOT_TOKEN\u001b[39m)\n     \u001b[90m 67 |\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 68 |\u001b[39m logger\u001b[33m.\u001b[39minfo(\u001b[32m'🤖 Инициализация defaultBot:'\u001b[39m\u001b[33m,\u001b[39m {\n     \u001b[90m    |\u001b[39m        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 69 |\u001b[39m   description\u001b[33m:\u001b[39m \u001b[32m'DefaultBot initialization'\u001b[39m\u001b[33m,\u001b[39m\n     \u001b[90m 70 |\u001b[39m   tokenLength\u001b[33m:\u001b[39m \u001b[33mDEFAULT_BOT_TOKEN\u001b[39m\u001b[33m.\u001b[39mlength\u001b[33m,\u001b[39m\n     \u001b[90m 71 |\u001b[39m })\u001b[0m\n\n      \u001b[2mat Object.info (\u001b[22msrc/core/bot/index.ts\u001b[2m:68:8)\u001b[22m\n      \u001b[2mat Object.require (\u001b[22msrc/core/supabase/sendPaymentInfo.ts\u001b[2m:4:1)\u001b[22m\n      \u001b[2mat Object.require (\u001b[22msrc/core/supabase/index.ts\u001b[2m:39:1)\u001b[22m\n      \u001b[2mat Object.require (\u001b[22msrc/handlers/getSubScribeChannel.ts\u001b[2m:3:1)\u001b[22m\n      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[0m\u001b[36m__tests__/handlers/getSubScribeChannel.test.ts\u001b[39m\u001b[0m\u001b[2m:9:1)\u001b[22m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/handlers/index.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/handlers/index.test.ts\u001b[0m:\u001b[93m21\u001b[0m:\u001b[93m28\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'registerHearsActions' does not exist on type 'typeof import(\"/Users/playra/999-multibots-telegraf/src/handlers/index\")'.\n\n    \u001b[7m21\u001b[0m     expect(typeof handlers.registerHearsActions).toBe('function')\n    \u001b[7m  \u001b[0m \u001b[91m                           ~~~~~~~~~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/handlers/hearsHandlers.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/handlers/hearsHandlers.test.ts\u001b[0m:\u001b[93m3\u001b[0m:\u001b[93m27\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2307: \u001b[0mCannot find module '../src/interfaces' or its corresponding type declarations.\n\n    \u001b[7m3\u001b[0m import { MyContext } from '../src/interfaces'\n    \u001b[7m \u001b[0m \u001b[91m                          ~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/hearsHandlers.test.ts\u001b[0m:\u001b[93m25\u001b[0m:\u001b[93m36\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2307: \u001b[0mCannot find module '../src/hearsHandlers' or its corresponding type declarations.\n\n    \u001b[7m25\u001b[0m import { setupHearsHandlers } from '../src/hearsHandlers'\n    \u001b[7m  \u001b[0m \u001b[91m                                   ~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/hearsHandlers.test.ts\u001b[0m:\u001b[93m26\u001b[0m:\u001b[93m24\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2307: \u001b[0mCannot find module '../src/menu' or its corresponding type declarations.\n\n    \u001b[7m26\u001b[0m import { levels } from '../src/menu' // Импортируем levels\n    \u001b[7m  \u001b[0m \u001b[91m                       ~~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":2,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745171924180,"runtime":1992,"slow":false,"start":1745171922188},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/handlers/handleHelpCancel.test.ts","failureMessage":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mhandleHelpCancel › handles Russian cancel command\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32m\"menuScene\"\u001b[39m\n    Received: \u001b[31m\"main_menu\"\u001b[39m\n\n    Number of calls: \u001b[31m1\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 24 |\u001b[39m     expect(result)\u001b[33m.\u001b[39mtoBe(\u001b[36mtrue\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 25 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mreply)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[32m'❌ Процесс отменён.'\u001b[39m)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 26 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mscene\u001b[33m.\u001b[39menter)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[32m'menuScene'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                             \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 27 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mscene\u001b[33m.\u001b[39mleave)\u001b[33m.\u001b[39mnot\u001b[33m.\u001b[39mtoHaveBeenCalled()\u001b[22m\n\u001b[2m     \u001b[90m 28 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 29 |\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/handlers/handleHelpCancel.test.ts\u001b[39m\u001b[0m\u001b[2m:26:29\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n\n\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mhandleHelpCancel › handles English cancel command\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\n    Expected: \u001b[32m\"menuScene\"\u001b[39m\n    Received: \u001b[31m\"main_menu\"\u001b[39m\n\n    Number of calls: \u001b[31m1\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 44 |\u001b[39m     expect(result)\u001b[33m.\u001b[39mtoBe(\u001b[36mtrue\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m 45 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mreply)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[32m'❌ Process cancelled.'\u001b[39m)\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 46 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mscene\u001b[33m.\u001b[39menter)\u001b[33m.\u001b[39mtoHaveBeenCalledWith(\u001b[32m'menuScene'\u001b[39m)\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                             \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 47 |\u001b[39m     expect(ctx\u001b[33m.\u001b[39mscene\u001b[33m.\u001b[39mleave)\u001b[33m.\u001b[39mnot\u001b[33m.\u001b[39mtoHaveBeenCalled()\u001b[22m\n\u001b[2m     \u001b[90m 48 |\u001b[39m   })\u001b[22m\n\u001b[2m     \u001b[90m 49 |\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m\u001b[0m\u001b[36m__tests__/handlers/handleHelpCancel.test.ts\u001b[39m\u001b[0m\u001b[2m:46:29\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat fulfilled (\u001b[22m\u001b[2mnode_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js\u001b[2m:167:62)\u001b[22m\u001b[2m\u001b[22m\n","testResults":[{"ancestorTitles":["handleHelpCancel"],"duration":7,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m\"menuScene\"\u001b[39m\nReceived: \u001b[31m\"main_menu\"\u001b[39m\n\nNumber of calls: \u001b[31m1\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/handlers/handleHelpCancel.test.ts:26:29\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"handleHelpCancel handles Russian cancel command","status":"failed","title":"handles Russian cancel command"},{"ancestorTitles":["handleHelpCancel"],"duration":28,"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mjest.fn()\u001b[39m\u001b[2m).\u001b[22mtoHaveBeenCalledWith\u001b[2m(\u001b[22m\u001b[32m...expected\u001b[39m\u001b[2m)\u001b[22m\n\nExpected: \u001b[32m\"menuScene\"\u001b[39m\nReceived: \u001b[31m\"main_menu\"\u001b[39m\n\nNumber of calls: \u001b[31m1\u001b[39m\n    at /Users/playra/999-multibots-telegraf/__tests__/handlers/handleHelpCancel.test.ts:46:29\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playra/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"handleHelpCancel handles English cancel command","status":"failed","title":"handles English cancel command"},{"ancestorTitles":["handleHelpCancel"],"duration":8,"failureMessages":[],"fullName":"handleHelpCancel handles Russian help for the command","status":"passed","title":"handles Russian help for the command"},{"ancestorTitles":["handleHelpCancel"],"duration":0,"failureMessages":[],"fullName":"handleHelpCancel handles English help for the command","status":"passed","title":"handles English help for the command"},{"ancestorTitles":["handleHelpCancel"],"duration":0,"failureMessages":[],"fullName":"handleHelpCancel returns false for non-matching text","status":"passed","title":"returns false for non-matching text"},{"ancestorTitles":["handleHelpCancel"],"duration":0,"failureMessages":[],"fullName":"handleHelpCancel returns false when message is missing","status":"passed","title":"returns false when message is missing"}]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/helpers/index.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/helpers/index.test.ts\u001b[0m:\u001b[93m16\u001b[0m:\u001b[93m27\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'language' does not exist on type 'typeof import(\"/Users/playra/999-multibots-telegraf/src/helpers/index\")'.\n\n    \u001b[7m16\u001b[0m     expect(typeof helpers.language).toBe('function')\n    \u001b[7m  \u001b[0m \u001b[91m                          ~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/helpers/pulse.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/helpers/pulse.test.ts\u001b[0m:\u001b[93m15\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2322: \u001b[0mType 'Mock<Promise<void>, [], any>' is not assignable to type '(chatId: string | number, photo: string | InputFile, extra?: { message_thread_id?: number; parse_mode?: ParseMode; caption_entities?: MessageEntity[]; ... 5 more ...; caption?: string | FmtString<...>; }) => Promise<...>'.\n      Type 'Promise<void>' is not assignable to type 'Promise<PhotoMessage>'.\n        Type 'void' is not assignable to type 'PhotoMessage'.\n\n    \u001b[7m15\u001b[0m     ctx.telegram.sendPhoto = jest.fn(() => Promise.resolve())\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/helpers/pulse.test.ts\u001b[0m:\u001b[93m16\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2322: \u001b[0mType 'Mock<Promise<void>, [], any>' is not assignable to type '(chatId: string | number, text: string | FmtString<string>, extra?: Omit<{ chat_id: string | number; message_thread_id?: number; text: string; parse_mode?: ParseMode; ... 5 more ...; reply_markup?: InlineKeyboardMarkup | ... 2 more ... | ForceReply; }, \"text\" | \"chat_id\">) => Promise<...>'.\n      Type 'Promise<void>' is not assignable to type 'Promise<TextMessage>'.\n        Type 'void' is not assignable to type 'TextMessage'.\n\n    \u001b[7m16\u001b[0m     ctx.telegram.sendMessage = jest.fn(() => Promise.resolve())\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/helpers/pulse.test.ts\u001b[0m:\u001b[93m22\u001b[0m:\u001b[93m17\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'MyContext & DebugExtension' is not assignable to parameter of type 'string | PulseOptions'.\n\n    \u001b[7m22\u001b[0m     await pulse(ctx, base64Image, prompt, command)\n    \u001b[7m  \u001b[0m \u001b[91m                ~~~\u001b[0m\n    \u001b[96m__tests__/helpers/pulse.test.ts\u001b[0m:\u001b[93m29\u001b[0m:\u001b[93m17\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'MyContext & DebugExtension' is not assignable to parameter of type 'string | PulseOptions'.\n\n    \u001b[7m29\u001b[0m     await pulse(ctx, base64Image, prompt, command)\n    \u001b[7m  \u001b[0m \u001b[91m                ~~~\u001b[0m\n    \u001b[96m__tests__/helpers/pulse.test.ts\u001b[0m:\u001b[93m42\u001b[0m:\u001b[93m17\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'MyContext & DebugExtension' is not assignable to parameter of type 'string | PulseOptions'.\n\n    \u001b[7m42\u001b[0m     await pulse(ctx, null, prompt, command)\n    \u001b[7m  \u001b[0m \u001b[91m                ~~~\u001b[0m\n    \u001b[96m__tests__/helpers/pulse.test.ts\u001b[0m:\u001b[93m58\u001b[0m:\u001b[93m17\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'MyContext & DebugExtension' is not assignable to parameter of type 'string | PulseOptions'.\n\n    \u001b[7m58\u001b[0m     await pulse(ctx, base64Image, prompt, command)\n    \u001b[7m  \u001b[0m \u001b[91m                ~~~\u001b[0m\n    \u001b[96m__tests__/helpers/pulse.test.ts\u001b[0m:\u001b[93m66\u001b[0m:\u001b[93m24\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'MyContext & DebugExtension' is not assignable to parameter of type 'string | PulseOptions'.\n\n    \u001b[7m66\u001b[0m     await expect(pulse(ctx, null, prompt, command)).rejects.toThrow(\n    \u001b[7m  \u001b[0m \u001b[91m                       ~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/helpers/error/errorHandler.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/helpers/error/errorHandler.test.ts\u001b[0m:\u001b[93m10\u001b[0m:\u001b[93m52\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '() => void' is not assignable to parameter of type '(infoObject: object) => Logger'.\n      Type 'void' is not assignable to type 'Logger'.\n\n    \u001b[7m10\u001b[0m     jest.spyOn(logger, 'error').mockImplementation(() => {});\n    \u001b[7m  \u001b[0m \u001b[91m                                                   ~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/helpers/error/errorHandler.test.ts\u001b[0m:\u001b[93m11\u001b[0m:\u001b[93m51\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '() => void' is not assignable to parameter of type '(infoObject: object) => Logger'.\n      Type 'void' is not assignable to type 'Logger'.\n\n    \u001b[7m11\u001b[0m     jest.spyOn(logger, 'warn').mockImplementation(() => {});\n    \u001b[7m  \u001b[0m \u001b[91m                                                  ~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/integration/robokassa.integration.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/integration/robokassa.integration.test.ts\u001b[0m:\u001b[93m6\u001b[0m:\u001b[93m10\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2459: \u001b[0mModule '\"@/config\"' declares 'config' locally, but it is not exported.\n\n    \u001b[7m6\u001b[0m import { config as appConfig } from '@/config'\n    \u001b[7m \u001b[0m \u001b[91m         ~~~~~~\u001b[0m\n\n      \u001b[96msrc/config/index.ts\u001b[0m:\u001b[93m1\u001b[0m:\u001b[93m10\u001b[0m\n        \u001b[7m1\u001b[0m import { config } from 'dotenv'\n        \u001b[7m \u001b[0m \u001b[96m         ~~~~~~\u001b[0m\n        'config' is declared here.\n    \u001b[96m__tests__/integration/robokassa.integration.test.ts\u001b[0m:\u001b[93m162\u001b[0m:\u001b[93m71\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2304: \u001b[0mCannot find name 'password2'.\n\n    \u001b[7m162\u001b[0m     const signatureValue = calculateRobokassaSignature(outSum, invId, password2)\n    \u001b[7m   \u001b[0m \u001b[91m                                                                      ~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/integration/robokassa.integration.test.ts\u001b[0m:\u001b[93m188\u001b[0m:\u001b[93m7\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2304: \u001b[0mCannot find name 'password2'.\n\n    \u001b[7m188\u001b[0m       password2\n    \u001b[7m   \u001b[0m \u001b[91m      ~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/utils/removeWebhooks.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/utils/removeWebhooks.test.ts\u001b[0m:\u001b[93m12\u001b[0m:\u001b[93m61\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '(_message: any, _meta: any) => void' is not assignable to parameter of type '(infoObject: object) => Logger'.\n      Target signature provides too few arguments. Expected 2 or more, but got 1.\n\n    \u001b[7m12\u001b[0m     infoSpy = jest.spyOn(logger, 'info').mockImplementation((_message, _meta) => {})\n    \u001b[7m  \u001b[0m \u001b[91m                                                            ~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/utils/removeWebhooks.test.ts\u001b[0m:\u001b[93m13\u001b[0m:\u001b[93m63\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '(_message: any, _meta: any) => void' is not assignable to parameter of type '(infoObject: object) => Logger'.\n      Target signature provides too few arguments. Expected 2 or more, but got 1.\n\n    \u001b[7m13\u001b[0m     errorSpy = jest.spyOn(logger, 'error').mockImplementation((_message, _meta) => {})\n    \u001b[7m  \u001b[0m \u001b[91m                                                              ~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/utils/logger.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/utils/logger.test.ts\u001b[0m:\u001b[93m6\u001b[0m:\u001b[93m61\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '() => void' is not assignable to parameter of type '(infoObject: object) => Logger'.\n      Type 'void' is not assignable to type 'Logger'.\n\n    \u001b[7m6\u001b[0m     infoSpy = jest.spyOn(logger, 'info').mockImplementation(() => {})\n    \u001b[7m \u001b[0m \u001b[91m                                                            ~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/utils/logger.test.ts\u001b[0m:\u001b[93m16\u001b[0m:\u001b[93m67\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '() => void' is not assignable to parameter of type '(infoObject: object) => Logger'.\n      Type 'void' is not assignable to type 'Logger'.\n\n    \u001b[7m16\u001b[0m     const warnSpy = jest.spyOn(logger, 'warn').mockImplementation(() => {})\n    \u001b[7m  \u001b[0m \u001b[91m                                                                  ~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/utils/logger.test.ts\u001b[0m:\u001b[93m22\u001b[0m:\u001b[93m69\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '() => void' is not assignable to parameter of type '(infoObject: object) => Logger'.\n      Type 'void' is not assignable to type 'Logger'.\n\n    \u001b[7m22\u001b[0m     const errorSpy = jest.spyOn(logger, 'error').mockImplementation(() => {})\n    \u001b[7m  \u001b[0m \u001b[91m                                                                    ~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/utils/logger.test.ts\u001b[0m:\u001b[93m28\u001b[0m:\u001b[93m69\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '() => void' is not assignable to parameter of type '(infoObject: object) => Logger'.\n      Type 'void' is not assignable to type 'Logger'.\n\n    \u001b[7m28\u001b[0m     const debugSpy = jest.spyOn(logger, 'debug').mockImplementation(() => {})\n    \u001b[7m  \u001b[0m \u001b[91m                                                                    ~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/utils/logger.test.ts\u001b[0m:\u001b[93m38\u001b[0m:\u001b[93m69\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '() => void' is not assignable to parameter of type '(infoObject: object) => Logger'.\n      Type 'void' is not assignable to type 'Logger'.\n\n    \u001b[7m38\u001b[0m     warnSpy = jest.spyOn(securityLogger, 'warn').mockImplementation(() => {})\n    \u001b[7m  \u001b[0m \u001b[91m                                                                    ~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/utils/logger.test.ts\u001b[0m:\u001b[93m52\u001b[0m:\u001b[93m75\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '() => void' is not assignable to parameter of type '(infoObject: object) => Logger'.\n      Type 'void' is not assignable to type 'Logger'.\n\n    \u001b[7m52\u001b[0m     const infoSpy = jest.spyOn(securityLogger, 'info').mockImplementation(() => {})\n    \u001b[7m  \u001b[0m \u001b[91m                                                                          ~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/menu/sendGenerationCancelledMessage.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/menu/sendGenerationCancelledMessage.test.ts\u001b[0m:\u001b[93m33\u001b[0m:\u001b[93m54\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'boolean' is not assignable to parameter of type 'string'.\n\n    \u001b[7m33\u001b[0m     await sendGenerationCancelledMessage(ctx as any, true)\n    \u001b[7m  \u001b[0m \u001b[91m                                                     ~~~~\u001b[0m\n    \u001b[96m__tests__/menu/sendGenerationCancelledMessage.test.ts\u001b[0m:\u001b[93m68\u001b[0m:\u001b[93m56\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'boolean' is not assignable to parameter of type 'string'.\n\n    \u001b[7m68\u001b[0m     await sendGenerationCancelledMessage(ctxEn as any, false)\n    \u001b[7m  \u001b[0m \u001b[91m                                                       ~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/menu/sendGenerationMessages.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/menu/sendGenerationMessages.test.ts\u001b[0m:\u001b[93m20\u001b[0m:\u001b[93m54\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'boolean' is not assignable to parameter of type 'string'.\n\n    \u001b[7m20\u001b[0m     await sendGenerationCancelledMessage(ctx as any, true)\n    \u001b[7m  \u001b[0m \u001b[91m                                                     ~~~~\u001b[0m\n    \u001b[96m__tests__/menu/sendGenerationMessages.test.ts\u001b[0m:\u001b[93m56\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2554: \u001b[0mExpected 3 arguments, but got 1.\n\n    \u001b[7m56\u001b[0m     await sendPhotoDescriptionRequest(ctx as any)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n\n      \u001b[96msrc/menu/sendPhotoDescriptionRequest.ts\u001b[0m:\u001b[93m6\u001b[0m:\u001b[93m3\u001b[0m\n        \u001b[7m6\u001b[0m   isRu: boolean,\n        \u001b[7m \u001b[0m \u001b[96m  ~~~~~~~~~~~~~\u001b[0m\n        An argument for 'isRu' was not provided.\n    \u001b[96m__tests__/menu/sendGenerationMessages.test.ts\u001b[0m:\u001b[93m68\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2554: \u001b[0mExpected 2 arguments, but got 1.\n\n    \u001b[7m68\u001b[0m     await sendPromptImprovementFailureMessage(ctx as any)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n\n      \u001b[96msrc/menu/sendPromptImprovementFailureMessage.ts\u001b[0m:\u001b[93m5\u001b[0m:\u001b[93m3\u001b[0m\n        \u001b[7m5\u001b[0m   isRu: boolean\n        \u001b[7m \u001b[0m \u001b[96m  ~~~~~~~~~~~~~\u001b[0m\n        An argument for 'isRu' was not provided.\n    \u001b[96m__tests__/menu/sendGenerationMessages.test.ts\u001b[0m:\u001b[93m77\u001b[0m:\u001b[93m52\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'string' is not assignable to parameter of type 'boolean'.\n\n    \u001b[7m77\u001b[0m     await sendPromptImprovementMessage(ctx as any, 'new prompt')\n    \u001b[7m  \u001b[0m \u001b[91m                                                   ~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/bot.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    TypeError: Cannot read properties of undefined (reading 'WizardScene')\n\n    \u001b[0m \u001b[90m 14 |\u001b[39m }\n     \u001b[90m 15 |\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 16 |\u001b[39m \u001b[36mexport\u001b[39m \u001b[36mconst\u001b[39m avatarBrainWizard \u001b[33m=\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mScenes\u001b[39m\u001b[33m.\u001b[39m\u001b[33mWizardScene\u001b[39m\u001b[33m<\u001b[39m\u001b[33mMyContext\u001b[39m\u001b[33m>\u001b[39m(\n     \u001b[90m    |\u001b[39m                                             \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 17 |\u001b[39m   \u001b[32m'avatar_brain'\u001b[39m\u001b[33m,\u001b[39m\n     \u001b[90m 18 |\u001b[39m   \u001b[36masync\u001b[39m ctx \u001b[33m=>\u001b[39m {\n     \u001b[90m 19 |\u001b[39m     \u001b[36mconst\u001b[39m isRu \u001b[33m=\u001b[39m isRussian(ctx)\u001b[0m\n\n      \u001b[2mat Object.WizardScene (\u001b[22msrc/scenes/avatarBrainWizard/index.ts\u001b[2m:16:45)\u001b[22m\n      \u001b[2mat Object.require (\u001b[22msrc/scenes/index.ts\u001b[2m:1:1)\u001b[22m\n      \u001b[2mat Object.require (\u001b[22msrc/registerCommands.ts\u001b[2m:11:1)\u001b[22m\n      \u001b[2mat Object.require (\u001b[22msrc/bot.ts\u001b[2m:14:1)\u001b[22m\n      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[0m\u001b[36m__tests__/bot.test.ts\u001b[39m\u001b[0m\u001b[2m:2:1)\u001b[22m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/menu/menu.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/menu/menu.test.ts\u001b[0m:\u001b[93m131\u001b[0m:\u001b[93m36\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'mock' does not exist on type '(text: string | FmtString<string>, extra?: Omit<{ chat_id: string | number; message_thread_id?: number; text: string; parse_mode?: ParseMode; entities?: MessageEntity[]; ... 4 more ...; reply_markup?: ReplyKeyboardMarkup | ... 2 more ... | ForceReply; }, \"chat_id\" | \"text\">) => Promise<...>'.\n\n    \u001b[7m131\u001b[0m     const [msg, extra] = ctx.reply.mock.calls[0]\n    \u001b[7m   \u001b[0m \u001b[91m                                   ~~~~\u001b[0m\n    \u001b[96m__tests__/menu/menu.test.ts\u001b[0m:\u001b[93m141\u001b[0m:\u001b[93m36\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'mock' does not exist on type '(text: string | FmtString<string>, extra?: Omit<{ chat_id: string | number; message_thread_id?: number; text: string; parse_mode?: ParseMode; entities?: MessageEntity[]; ... 4 more ...; reply_markup?: ReplyKeyboardMarkup | ... 2 more ... | ForceReply; }, \"chat_id\" | \"text\">) => Promise<...>'.\n\n    \u001b[7m141\u001b[0m     const [msg, extra] = ctx.reply.mock.calls[0]\n    \u001b[7m   \u001b[0m \u001b[91m                                   ~~~~\u001b[0m\n    \u001b[96m__tests__/menu/menu.test.ts\u001b[0m:\u001b[93m217\u001b[0m:\u001b[93m1\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1128: \u001b[0mDeclaration or statement expected.\n\n    \u001b[7m217\u001b[0m })\n    \u001b[7m   \u001b[0m \u001b[91m~\u001b[0m\n    \u001b[96m__tests__/menu/menu.test.ts\u001b[0m:\u001b[93m217\u001b[0m:\u001b[93m2\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1128: \u001b[0mDeclaration or statement expected.\n\n    \u001b[7m217\u001b[0m })\n    \u001b[7m   \u001b[0m \u001b[91m ~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/menu/createHelpCancelKeyboard.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/menu/createHelpCancelKeyboard.test.ts\u001b[0m:\u001b[93m1\u001b[0m:\u001b[93m10\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2305: \u001b[0mModule '\"@/menu/createHelpCancelKeyboard\"' has no exported member 'createHelpCancelKeyboard'.\n\n    \u001b[7m1\u001b[0m import { createHelpCancelKeyboard } from '@/menu/createHelpCancelKeyboard'\n    \u001b[7m \u001b[0m \u001b[91m         ~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/menu/mainMenu.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/menu/mainMenu.test.ts\u001b[0m:\u001b[93m28\u001b[0m:\u001b[93m7\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2353: \u001b[0mObject literal may only specify known properties, and 'inviteCount' does not exist in type 'MySession'.\n\n    \u001b[7m28\u001b[0m       inviteCount: 0,\n    \u001b[7m  \u001b[0m \u001b[91m      ~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/hearsHandlers.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/hearsHandlers.test.ts\u001b[0m:\u001b[93m2\u001b[0m:\u001b[93m10\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2305: \u001b[0mModule '\"../src/bot\"' has no exported member 'hearsHandlers'.\n\n    \u001b[7m2\u001b[0m import { hearsHandlers } from '../src/bot';\n    \u001b[7m \u001b[0m \u001b[91m         ~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/hearsHandlers.test.ts\u001b[0m:\u001b[93m10\u001b[0m:\u001b[93m35\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'messageHandlers' does not exist on type 'Telegram'.\n\n    \u001b[7m10\u001b[0m     const handlers = bot.telegram.messageHandlers;\n    \u001b[7m  \u001b[0m \u001b[91m                                  ~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/hearsHandlers.test.ts\u001b[0m:\u001b[93m14\u001b[0m:\u001b[93m45\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2839: \u001b[0mThis condition will always return 'false' since JavaScript compares objects by reference, not value.\n\n    \u001b[7m14\u001b[0m     const startHandler = handlers.find(h => h.regex?.pattern === /^\\/start/);\n    \u001b[7m  \u001b[0m \u001b[91m                                            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playra/999-multibots-telegraf/__tests__/payments/starPaymentScene.test.ts","failureMessage":"  \u001b[1m● \u001b[22mTest suite failed to run\n\n    \u001b[96m__tests__/payments/starPaymentScene.test.ts\u001b[0m:\u001b[93m179\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1308: \u001b[0m'await' expressions are only allowed within async functions and at the top levels of modules.\n\n    \u001b[7m179\u001b[0m     await starPaymentScene.middleware()(ctx, jest.fn() as any)\n    \u001b[7m   \u001b[0m \u001b[91m    ~~~~~\u001b[0m\n\n      \u001b[96m__tests__/payments/starPaymentScene.test.ts\u001b[0m:\u001b[93m103\u001b[0m:\u001b[93m14\u001b[0m\n        \u001b[7m103\u001b[0m   beforeEach(() => {\n        \u001b[7m   \u001b[0m \u001b[96m             ~~~~~~~\u001b[0m\n        Did you mean to mark this function as 'async'?\n    \u001b[96m__tests__/payments/starPaymentScene.test.ts\u001b[0m:\u001b[93m220\u001b[0m:\u001b[93m38\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'actionHandlers' does not exist on type 'BaseScene<MyContext>'.\n\n    \u001b[7m220\u001b[0m     const handler = starPaymentScene.actionHandlers.find(h => {\n    \u001b[7m   \u001b[0m \u001b[91m                                     ~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/payments/starPaymentScene.test.ts\u001b[0m:\u001b[93m260\u001b[0m:\u001b[93m38\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'actionHandlers' does not exist on type 'BaseScene<MyContext>'.\n\n    \u001b[7m260\u001b[0m     const handler = starPaymentScene.actionHandlers.find(h => {\n    \u001b[7m   \u001b[0m \u001b[91m                                     ~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/payments/starPaymentScene.test.ts\u001b[0m:\u001b[93m431\u001b[0m:\u001b[93m25\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'error' does not exist on type 'object'.\n\n    \u001b[7m431\u001b[0m     expect(loggedObject.error).toBeInstanceOf(Error)\n    \u001b[7m   \u001b[0m \u001b[91m                        ~~~~~\u001b[0m\n    \u001b[96m__tests__/payments/starPaymentScene.test.ts\u001b[0m:\u001b[93m432\u001b[0m:\u001b[93m22\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'error' does not exist on type 'object'.\n\n    \u001b[7m432\u001b[0m     if (loggedObject.error instanceof Error) {\n    \u001b[7m   \u001b[0m \u001b[91m                     ~~~~~\u001b[0m\n    \u001b[96m__tests__/payments/starPaymentScene.test.ts\u001b[0m:\u001b[93m433\u001b[0m:\u001b[93m27\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'error' does not exist on type 'object'.\n\n    \u001b[7m433\u001b[0m       expect(loggedObject.error.message).toBe(errorMessage)\n    \u001b[7m   \u001b[0m \u001b[91m                          ~~~~~\u001b[0m\n","testResults":[]}],"config":{"bail":0,"changedFilesWithAncestor":false,"ci":false,"collectCoverage":true,"collectCoverageFrom":[],"coverageDirectory":"/Users/playra/999-multibots-telegraf/coverage","coverageProvider":"babel","coverageReporters":["json","text","lcov","clover"],"detectLeaks":false,"detectOpenHandles":false,"errorOnDeprecated":false,"expand":false,"findRelatedTests":false,"forceExit":false,"globalSetup":"/Users/playra/999-multibots-telegraf/jest.globalSetup.js","json":false,"lastCommit":false,"listTests":false,"logHeapUsage":false,"maxConcurrency":5,"maxWorkers":7,"noStackTrace":false,"nonFlagArgs":[],"notify":false,"notifyMode":"failure-change","onlyChanged":false,"onlyFailures":false,"openHandlesTimeout":1000,"passWithNoTests":false,"projects":[],"reporters":[["default",{}],["/Users/playra/999-multibots-telegraf/node_modules/.pnpm/jest-html-reporters@3.1.7/node_modules/jest-html-reporters/index.js",{"publicPath":"./html-report","filename":"report.html","expand":true}]],"rootDir":"/Users/playra/999-multibots-telegraf","runTestsByPath":false,"seed":2007227024,"silent":false,"skipFilter":false,"snapshotFormat":{"escapeString":false,"printBasicPrototype":false},"testFailureExitCode":1,"testPathPattern":"","testSequencer":"/Users/playra/999-multibots-telegraf/node_modules/.pnpm/@jest+test-sequencer@29.7.0/node_modules/@jest/test-sequencer/build/index.js","updateSnapshot":"new","useStderr":false,"verbose":true,"watch":false,"watchAll":false,"watchman":true,"workerThreads":false,"coverageLinkPath":"../coverage/lcov-report/index.html"},"endTime":1745171926130,"_reporterOptions":{"publicPath":"./html-report","filename":"report.html","expand":true,"pageTitle":"","hideIcon":false,"testCommand":"","openReport":false,"failureMessageOnly":0,"enableMergeData":false,"dataMergeLevel":1,"inlineSource":false,"urlForTestFiles":"","darkTheme":false,"includeConsoleLog":false,"stripSkippedTest":false},"logInfoMapping":{},"attachInfos":{}})