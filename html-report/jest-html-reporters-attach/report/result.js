window.jest_html_reporters_callback__({"numFailedTestSuites":121,"numFailedTests":200,"numPassedTestSuites":141,"numPassedTests":487,"numPendingTestSuites":0,"numPendingTests":4,"numRuntimeErrorTestSuites":53,"numTodoTests":0,"numTotalTestSuites":262,"numTotalTests":691,"startTime":1745172248736,"success":false,"testResults":[{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172259955,"runtime":10422,"slow":true,"start":1745172249533},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/payments/rublePaymentScene.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["rublePaymentScene"],"duration":10,"failureMessages":[],"fullName":"rublePaymentScene should run a basic test","status":"passed","title":"should run a basic test"}]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/payments/starPaymentScene.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/payments/starPaymentScene.test.ts\u001b[0m:\u001b[93m179\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1308: \u001b[0m'await' expressions are only allowed within async functions and at the top levels of modules.\n\n    \u001b[7m179\u001b[0m     await starPaymentScene.middleware()(ctx, jest.fn() as any)\n    \u001b[7m   \u001b[0m \u001b[91m    ~~~~~\u001b[0m\n\n      \u001b[96m__tests__/payments/starPaymentScene.test.ts\u001b[0m:\u001b[93m103\u001b[0m:\u001b[93m14\u001b[0m\n        \u001b[7m103\u001b[0m   beforeEach(() => {\n        \u001b[7m   \u001b[0m \u001b[96m             ~~~~~~~\u001b[0m\n        Did you mean to mark this function as 'async'?\n    \u001b[96m__tests__/payments/starPaymentScene.test.ts\u001b[0m:\u001b[93m220\u001b[0m:\u001b[93m38\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'actionHandlers' does not exist on type 'BaseScene<MyContext>'.\n\n    \u001b[7m220\u001b[0m     const handler = starPaymentScene.actionHandlers.find(h => {\n    \u001b[7m   \u001b[0m \u001b[91m                                     ~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/payments/starPaymentScene.test.ts\u001b[0m:\u001b[93m260\u001b[0m:\u001b[93m38\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'actionHandlers' does not exist on type 'BaseScene<MyContext>'.\n\n    \u001b[7m260\u001b[0m     const handler = starPaymentScene.actionHandlers.find(h => {\n    \u001b[7m   \u001b[0m \u001b[91m                                     ~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/payments/starPaymentScene.test.ts\u001b[0m:\u001b[93m431\u001b[0m:\u001b[93m25\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'error' does not exist on type 'object'.\n\n    \u001b[7m431\u001b[0m     expect(loggedObject.error).toBeInstanceOf(Error)\n    \u001b[7m   \u001b[0m \u001b[91m                        ~~~~~\u001b[0m\n    \u001b[96m__tests__/payments/starPaymentScene.test.ts\u001b[0m:\u001b[93m432\u001b[0m:\u001b[93m22\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'error' does not exist on type 'object'.\n\n    \u001b[7m432\u001b[0m     if (loggedObject.error instanceof Error) {\n    \u001b[7m   \u001b[0m \u001b[91m                     ~~~~~\u001b[0m\n    \u001b[96m__tests__/payments/starPaymentScene.test.ts\u001b[0m:\u001b[93m433\u001b[0m:\u001b[93m27\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'error' does not exist on type 'object'.\n\n    \u001b[7m433\u001b[0m       expect(loggedObject.error.message).toBe(errorMessage)\n    \u001b[7m   \u001b[0m \u001b[91m                          ~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":3,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172260688,"runtime":11312,"slow":true,"start":1745172249376},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/services/generateImageToPrompt.test.ts","failureMessage":"  ● generateImageToPrompt › skips API call and replies when ELESTIO_URL not set\n\n    supabaseUrl is required.\n\n       9 |\n      10 | // Создаем клиент с service role key\n    > 11 | export const supabase = createClient(SUPABASE_URL, SUPABASE_SERVICE_KEY)\n         |                                     ^\n      12 |\n      13 | export const supabaseAdmin = createClient(\n      14 |   SUPABASE_URL,\n\n      at new SupabaseClient (node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/SupabaseClient.ts:75:29)\n      at createClient (node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/index.ts:40:10)\n      at Object.<anonymous> (src/core/supabase/client.ts:11:37)\n      at Object.require (src/core/supabase/index.ts:1:1)\n      at Object.require (src/services/plan_b/generateImageToPrompt.ts:2:1)\n      at Object.require (src/services/generateImageToPrompt.ts:1:1)\n      at Object.<anonymous> (__tests__/services/generateImageToPrompt.test.ts:26:17)\n      at __tests__/services/generateImageToPrompt.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/services/generateImageToPrompt.test.ts:3:12)\n      at Object.<anonymous> (__tests__/services/generateImageToPrompt.test.ts:22:72)\n\n  ● generateImageToPrompt › makes API call when ELESTIO_URL is set\n\n    supabaseUrl is required.\n\n       9 |\n      10 | // Создаем клиент с service role key\n    > 11 | export const supabase = createClient(SUPABASE_URL, SUPABASE_SERVICE_KEY)\n         |                                     ^\n      12 |\n      13 | export const supabaseAdmin = createClient(\n      14 |   SUPABASE_URL,\n\n      at new SupabaseClient (node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/SupabaseClient.ts:75:29)\n      at createClient (node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/index.ts:40:10)\n      at Object.<anonymous> (src/core/supabase/client.ts:11:37)\n      at Object.require (src/core/supabase/index.ts:1:1)\n      at Object.require (src/services/plan_b/generateImageToPrompt.ts:2:1)\n      at Object.require (src/services/generateImageToPrompt.ts:1:1)\n      at Object.<anonymous> (__tests__/services/generateImageToPrompt.test.ts:39:17)\n      at __tests__/services/generateImageToPrompt.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/services/generateImageToPrompt.test.ts:3:12)\n      at Object.<anonymous> (__tests__/services/generateImageToPrompt.test.ts:34:59)\n\n  ● generateImageToPrompt › replies with error message on axios error\n\n    supabaseUrl is required.\n\n       9 |\n      10 | // Создаем клиент с service role key\n    > 11 | export const supabase = createClient(SUPABASE_URL, SUPABASE_SERVICE_KEY)\n         |                                     ^\n      12 |\n      13 | export const supabaseAdmin = createClient(\n      14 |   SUPABASE_URL,\n\n      at new SupabaseClient (node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/SupabaseClient.ts:75:29)\n      at createClient (node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/index.ts:40:10)\n      at Object.<anonymous> (src/core/supabase/client.ts:11:37)\n      at Object.require (src/core/supabase/index.ts:1:1)\n      at Object.require (src/services/plan_b/generateImageToPrompt.ts:2:1)\n      at Object.require (src/services/generateImageToPrompt.ts:1:1)\n      at Object.<anonymous> (__tests__/services/generateImageToPrompt.test.ts:57:17)\n      at __tests__/services/generateImageToPrompt.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/services/generateImageToPrompt.test.ts:3:12)\n      at Object.<anonymous> (__tests__/services/generateImageToPrompt.test.ts:51:62)\n","testResults":[{"ancestorTitles":["generateImageToPrompt"],"duration":2476,"failureMessages":["Error: supabaseUrl is required.\n    at new SupabaseClient (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/SupabaseClient.ts:75:29)\n    at createClient (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/index.ts:40:10)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/src/core/supabase/client.ts:11:37)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playom/999-multibots-telegraf/src/core/supabase/index.ts:1:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playom/999-multibots-telegraf/src/services/plan_b/generateImageToPrompt.ts:2:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playom/999-multibots-telegraf/src/services/generateImageToPrompt.ts:1:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/services/generateImageToPrompt.test.ts:26:17)\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/__tests__/services/generateImageToPrompt.test.ts:7:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/playom/999-multibots-telegraf/__tests__/services/generateImageToPrompt.test.ts:3:12)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/services/generateImageToPrompt.test.ts:22:72)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"generateImageToPrompt skips API call and replies when ELESTIO_URL not set","status":"failed","title":"skips API call and replies when ELESTIO_URL not set"},{"ancestorTitles":["generateImageToPrompt"],"duration":21,"failureMessages":["Error: supabaseUrl is required.\n    at new SupabaseClient (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/SupabaseClient.ts:75:29)\n    at createClient (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/index.ts:40:10)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/src/core/supabase/client.ts:11:37)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playom/999-multibots-telegraf/src/core/supabase/index.ts:1:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playom/999-multibots-telegraf/src/services/plan_b/generateImageToPrompt.ts:2:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playom/999-multibots-telegraf/src/services/generateImageToPrompt.ts:1:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/services/generateImageToPrompt.test.ts:39:17)\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/__tests__/services/generateImageToPrompt.test.ts:7:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/playom/999-multibots-telegraf/__tests__/services/generateImageToPrompt.test.ts:3:12)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/services/generateImageToPrompt.test.ts:34:59)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"generateImageToPrompt makes API call when ELESTIO_URL is set","status":"failed","title":"makes API call when ELESTIO_URL is set"},{"ancestorTitles":["generateImageToPrompt"],"duration":74,"failureMessages":["Error: supabaseUrl is required.\n    at new SupabaseClient (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/SupabaseClient.ts:75:29)\n    at createClient (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/index.ts:40:10)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/src/core/supabase/client.ts:11:37)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playom/999-multibots-telegraf/src/core/supabase/index.ts:1:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playom/999-multibots-telegraf/src/services/plan_b/generateImageToPrompt.ts:2:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playom/999-multibots-telegraf/src/services/generateImageToPrompt.ts:1:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/services/generateImageToPrompt.test.ts:57:17)\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/__tests__/services/generateImageToPrompt.test.ts:7:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/playom/999-multibots-telegraf/__tests__/services/generateImageToPrompt.test.ts:3:12)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/services/generateImageToPrompt.test.ts:51:62)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"generateImageToPrompt replies with error message on axios error","status":"failed","title":"replies with error message on axios error"}]},{"numFailingTests":5,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172262800,"runtime":13417,"slow":true,"start":1745172249383},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/services/generateNeuroImage.test.ts","failureMessage":"  ● generateNeuroImage › throws error when ctx.session.prompt missing\n\n    supabaseUrl is required.\n\n       9 |\n      10 | // Создаем клиент с service role key\n    > 11 | export const supabase = createClient(SUPABASE_URL, SUPABASE_SERVICE_KEY)\n         |                                     ^\n      12 |\n      13 | export const supabaseAdmin = createClient(\n      14 |   SUPABASE_URL,\n\n      at new SupabaseClient (node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/SupabaseClient.ts:75:29)\n      at createClient (node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/index.ts:40:10)\n      at Object.<anonymous> (src/core/supabase/client.ts:11:37)\n      at Object.require (src/core/supabase/index.ts:1:1)\n      at Object.require (src/core/bot/index.ts:10:1)\n      at Object.require (src/services/generateNeuroPhotoDirect.ts:5:1)\n      at Object.require (src/services/generateNeuroImage.ts:1:1)\n      at Object.<anonymous> (__tests__/services/generateNeuroImage.test.ts:34:26)\n\n  ● generateNeuroImage › throws error when ctx.session.userModel missing\n\n    supabaseUrl is required.\n\n       9 |\n      10 | // Создаем клиент с service role key\n    > 11 | export const supabase = createClient(SUPABASE_URL, SUPABASE_SERVICE_KEY)\n         |                                     ^\n      12 |\n      13 | export const supabaseAdmin = createClient(\n      14 |   SUPABASE_URL,\n\n      at new SupabaseClient (node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/SupabaseClient.ts:75:29)\n      at createClient (node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/index.ts:40:10)\n      at Object.<anonymous> (src/core/supabase/client.ts:11:37)\n      at Object.require (src/core/supabase/index.ts:1:1)\n      at Object.require (src/core/bot/index.ts:10:1)\n      at Object.require (src/services/generateNeuroPhotoDirect.ts:5:1)\n      at Object.require (src/services/generateNeuroImage.ts:1:1)\n      at Object.<anonymous> (__tests__/services/generateNeuroImage.test.ts:34:26)\n\n  ● generateNeuroImage › throws error when numImages is zero\n\n    supabaseUrl is required.\n\n       9 |\n      10 | // Создаем клиент с service role key\n    > 11 | export const supabase = createClient(SUPABASE_URL, SUPABASE_SERVICE_KEY)\n         |                                     ^\n      12 |\n      13 | export const supabaseAdmin = createClient(\n      14 |   SUPABASE_URL,\n\n      at new SupabaseClient (node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/SupabaseClient.ts:75:29)\n      at createClient (node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/index.ts:40:10)\n      at Object.<anonymous> (src/core/supabase/client.ts:11:37)\n      at Object.require (src/core/supabase/index.ts:1:1)\n      at Object.require (src/core/bot/index.ts:10:1)\n      at Object.require (src/services/generateNeuroPhotoDirect.ts:5:1)\n      at Object.require (src/services/generateNeuroImage.ts:1:1)\n      at Object.<anonymous> (__tests__/services/generateNeuroImage.test.ts:34:26)\n\n  ● generateNeuroImage › calls axios.post and returns data on success\n\n    supabaseUrl is required.\n\n       9 |\n      10 | // Создаем клиент с service role key\n    > 11 | export const supabase = createClient(SUPABASE_URL, SUPABASE_SERVICE_KEY)\n         |                                     ^\n      12 |\n      13 | export const supabaseAdmin = createClient(\n      14 |   SUPABASE_URL,\n\n      at new SupabaseClient (node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/SupabaseClient.ts:75:29)\n      at createClient (node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/index.ts:40:10)\n      at Object.<anonymous> (src/core/supabase/client.ts:11:37)\n      at Object.require (src/core/supabase/index.ts:1:1)\n      at Object.require (src/core/bot/index.ts:10:1)\n      at Object.require (src/services/generateNeuroPhotoDirect.ts:5:1)\n      at Object.require (src/services/generateNeuroImage.ts:1:1)\n      at Object.<anonymous> (__tests__/services/generateNeuroImage.test.ts:34:26)\n\n  ● generateNeuroImage › handles axios error, logs and replies\n\n    supabaseUrl is required.\n\n       9 |\n      10 | // Создаем клиент с service role key\n    > 11 | export const supabase = createClient(SUPABASE_URL, SUPABASE_SERVICE_KEY)\n         |                                     ^\n      12 |\n      13 | export const supabaseAdmin = createClient(\n      14 |   SUPABASE_URL,\n\n      at new SupabaseClient (node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/SupabaseClient.ts:75:29)\n      at createClient (node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/index.ts:40:10)\n      at Object.<anonymous> (src/core/supabase/client.ts:11:37)\n      at Object.require (src/core/supabase/index.ts:1:1)\n      at Object.require (src/core/bot/index.ts:10:1)\n      at Object.require (src/services/generateNeuroPhotoDirect.ts:5:1)\n      at Object.require (src/services/generateNeuroImage.ts:1:1)\n      at Object.<anonymous> (__tests__/services/generateNeuroImage.test.ts:34:26)\n","testResults":[{"ancestorTitles":["generateNeuroImage"],"duration":3660,"failureMessages":["Error: supabaseUrl is required.\n    at new SupabaseClient (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/SupabaseClient.ts:75:29)\n    at createClient (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/index.ts:40:10)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/src/core/supabase/client.ts:11:37)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playom/999-multibots-telegraf/src/core/supabase/index.ts:1:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playom/999-multibots-telegraf/src/core/bot/index.ts:10:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playom/999-multibots-telegraf/src/services/generateNeuroPhotoDirect.ts:5:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playom/999-multibots-telegraf/src/services/generateNeuroImage.ts:1:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/services/generateNeuroImage.test.ts:34:26)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusHook (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:281:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:246:5)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"generateNeuroImage throws error when ctx.session.prompt missing","status":"failed","title":"throws error when ctx.session.prompt missing"},{"ancestorTitles":["generateNeuroImage"],"duration":125,"failureMessages":["Error: supabaseUrl is required.\n    at new SupabaseClient (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/SupabaseClient.ts:75:29)\n    at createClient (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/index.ts:40:10)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/src/core/supabase/client.ts:11:37)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playom/999-multibots-telegraf/src/core/supabase/index.ts:1:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playom/999-multibots-telegraf/src/core/bot/index.ts:10:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playom/999-multibots-telegraf/src/services/generateNeuroPhotoDirect.ts:5:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playom/999-multibots-telegraf/src/services/generateNeuroImage.ts:1:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/services/generateNeuroImage.test.ts:34:26)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusHook (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:281:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:246:5)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"generateNeuroImage throws error when ctx.session.userModel missing","status":"failed","title":"throws error when ctx.session.userModel missing"},{"ancestorTitles":["generateNeuroImage"],"duration":183,"failureMessages":["Error: supabaseUrl is required.\n    at new SupabaseClient (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/SupabaseClient.ts:75:29)\n    at createClient (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/index.ts:40:10)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/src/core/supabase/client.ts:11:37)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playom/999-multibots-telegraf/src/core/supabase/index.ts:1:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playom/999-multibots-telegraf/src/core/bot/index.ts:10:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playom/999-multibots-telegraf/src/services/generateNeuroPhotoDirect.ts:5:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playom/999-multibots-telegraf/src/services/generateNeuroImage.ts:1:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/services/generateNeuroImage.test.ts:34:26)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusHook (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:281:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:246:5)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"generateNeuroImage throws error when numImages is zero","status":"failed","title":"throws error when numImages is zero"},{"ancestorTitles":["generateNeuroImage"],"duration":152,"failureMessages":["Error: supabaseUrl is required.\n    at new SupabaseClient (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/SupabaseClient.ts:75:29)\n    at createClient (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/index.ts:40:10)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/src/core/supabase/client.ts:11:37)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playom/999-multibots-telegraf/src/core/supabase/index.ts:1:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playom/999-multibots-telegraf/src/core/bot/index.ts:10:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playom/999-multibots-telegraf/src/services/generateNeuroPhotoDirect.ts:5:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playom/999-multibots-telegraf/src/services/generateNeuroImage.ts:1:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/services/generateNeuroImage.test.ts:34:26)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusHook (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:281:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:246:5)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"generateNeuroImage calls axios.post and returns data on success","status":"failed","title":"calls axios.post and returns data on success"},{"ancestorTitles":["generateNeuroImage"],"duration":61,"failureMessages":["Error: supabaseUrl is required.\n    at new SupabaseClient (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/SupabaseClient.ts:75:29)\n    at createClient (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/@supabase+supabase-js@2.49.4/node_modules/@supabase/supabase-js/src/index.ts:40:10)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/src/core/supabase/client.ts:11:37)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playom/999-multibots-telegraf/src/core/supabase/index.ts:1:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playom/999-multibots-telegraf/src/core/bot/index.ts:10:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playom/999-multibots-telegraf/src/services/generateNeuroPhotoDirect.ts:5:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playom/999-multibots-telegraf/src/services/generateNeuroImage.ts:1:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/services/generateNeuroImage.test.ts:34:26)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusHook (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:281:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:246:5)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"generateNeuroImage handles axios error, logs and replies","status":"failed","title":"handles axios error, logs and replies"}]},{"numFailingTests":3,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172266988,"runtime":4117,"slow":false,"start":1745172262871},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.test.ts","failureMessage":"  ● updateUserSubscription › updates subscription and returns data on success\n\n    expect(received).toEqual(expected) // deep equality\n\n    Expected: [{\"subscription\": \"vip\"}]\n    Received: undefined\n\n      24 |     builder.eq.mockResolvedValue({ data: resultData, error: null })\n      25 |     const res = await updateUserSubscription(userId, subscription)\n    > 26 |     expect(res).toEqual(resultData)\n         |                 ^\n      27 |     const { supabase } = require('@/core/supabase')\n      28 |     expect(supabase.from).toHaveBeenCalledWith('users')\n      29 |     expect(builder.update).toHaveBeenCalledWith({ subscription })\n\n      at Object.<anonymous> (__tests__/core/supabase/updateUserSubscription.test.ts:26:17)\n      at fulfilled (__tests__/core/supabase/updateUserSubscription.test.ts:4:58)\n\n  ● updateUserSubscription › throws and logs error when update error occurs\n\n    expect(received).rejects.toEqual(expected) // deep equality\n\n    - Expected  - 3\n    + Received  + 1\n\n    - Object {\n    -   \"message\": \"fail\",\n    - }\n    + [Error: Не удалось обновить подписку пользователя]\n\n      34 |     const err = { message: 'fail' }\n      35 |     builder.eq.mockResolvedValue({ data: null, error: err })\n    > 36 |     await expect(updateUserSubscription(userId, subscription)).rejects.toEqual(err)\n         |                                                                        ^\n      37 |     expect(console.error).toHaveBeenCalledWith('Error updating subscription:', err)\n      38 |   })\n      39 |\n\n      at Object.toEqual (node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n      at Object.<anonymous> (__tests__/core/supabase/updateUserSubscription.test.ts:36:72)\n      at __tests__/core/supabase/updateUserSubscription.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/core/supabase/updateUserSubscription.test.ts:3:12)\n      at Object.<anonymous> (__tests__/core/supabase/updateUserSubscription.test.ts:33:67)\n\n  ● updateUserSubscription › throws and logs error when exception occurs\n\n    expect(received).rejects.toThrow(expected)\n\n    Expected substring: \"oops\"\n    Received message:   \"Не удалось обновить подписку пользователя\"\n\n          17 |   } catch (error) {\n          18 |     console.error('Ошибка при обновлении подписки пользователя:', error)\n        > 19 |     throw new Error('Не удалось обновить подписку пользователя')\n             |           ^\n          20 |   }\n          21 | }\n          22 |\n\n      at src/core/supabase/updateUserSubscription.ts:19:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at __awaiter (src/core/supabase/updateUserSubscription.ts:6:20)\n      at Object.<anonymous> (__tests__/core/supabase/updateUserSubscription.test.ts:42:18)\n      at __tests__/core/supabase/updateUserSubscription.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/core/supabase/updateUserSubscription.test.ts:3:12)\n      at Object.<anonymous> (__tests__/core/supabase/updateUserSubscription.test.ts:40:64)\n      at Object.toThrow (node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n      at Object.<anonymous> (__tests__/core/supabase/updateUserSubscription.test.ts:42:72)\n      at __tests__/core/supabase/updateUserSubscription.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/core/supabase/updateUserSubscription.test.ts:3:12)\n      at Object.<anonymous> (__tests__/core/supabase/updateUserSubscription.test.ts:40:64)\n","testResults":[{"ancestorTitles":["updateUserSubscription"],"duration":2681,"failureMessages":["Error: expect(received).toEqual(expected) // deep equality\n\nExpected: [{\"subscription\": \"vip\"}]\nReceived: undefined\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.test.ts:26:17)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.test.ts:4:58)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"updateUserSubscription updates subscription and returns data on success","status":"failed","title":"updates subscription and returns data on success"},{"ancestorTitles":["updateUserSubscription"],"duration":480,"failureMessages":["Error: expect(received).rejects.toEqual(expected) // deep equality\n\n- Expected  - 3\n+ Received  + 1\n\n- Object {\n-   \"message\": \"fail\",\n- }\n+ [Error: Не удалось обновить подписку пользователя]\n    at Object.toEqual (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.test.ts:36:72)\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.test.ts:7:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.test.ts:3:12)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.test.ts:33:67)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"updateUserSubscription throws and logs error when update error occurs","status":"failed","title":"throws and logs error when update error occurs"},{"ancestorTitles":["updateUserSubscription"],"duration":266,"failureMessages":["Error: expect(received).rejects.toThrow(expected)\n\nExpected substring: \"oops\"\nReceived message:   \"Не удалось обновить подписку пользователя\"\n\n      17 |   } catch (error) {\n      18 |     console.error('Ошибка при обновлении подписки пользователя:', error)\n    > 19 |     throw new Error('Не удалось обновить подписку пользователя')\n         |           ^\n      20 |   }\n      21 | }\n      22 |\n\n      at src/core/supabase/updateUserSubscription.ts:19:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at __awaiter (src/core/supabase/updateUserSubscription.ts:6:20)\n      at Object.<anonymous> (__tests__/core/supabase/updateUserSubscription.test.ts:42:18)\n      at __tests__/core/supabase/updateUserSubscription.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/core/supabase/updateUserSubscription.test.ts:3:12)\n      at Object.<anonymous> (__tests__/core/supabase/updateUserSubscription.test.ts:40:64)\n    at Object.toThrow (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.test.ts:42:72)\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.test.ts:7:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.test.ts:3:12)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.test.ts:40:64)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"updateUserSubscription throws and logs error when exception occurs","status":"failed","title":"throws and logs error when exception occurs"}]},{"numFailingTests":2,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172267801,"runtime":7094,"slow":true,"start":1745172260707},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserBalance.test.ts","failureMessage":"  ● updateUserBalance › should update user balance and return no error on success\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"users\"\n\n    Number of calls: 0\n\n      33 |\n      34 |     const result = await updateUserBalance(telegram_id, new_balance, 'money_income')\n    > 35 |     expect(mockFrom).toHaveBeenCalledWith('users')\n         |                      ^\n      36 |     expect(mockUpdate).toHaveBeenCalledWith({ balance: 100 })\n      37 |     expect(mockEq).toHaveBeenCalledWith('telegram_id', '42')\n      38 |   })\n\n      at __tests__/core/supabase/updateUserBalance.test.ts:35:22\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● updateUserBalance › should return an error if Supabase update fails\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"Ошибка обновления баланса:\", Any<Object>\n\n    Number of calls: 0\n\n      47 |\n      48 |     const result = await updateUserBalance(telegram_id, new_balance, 'money_income')\n    > 49 |     expect(console.error).toHaveBeenCalledWith(\n         |                           ^\n      50 |       'Ошибка обновления баланса:',\n      51 |       expect.any(Object)\n      52 |     )\n\n      at __tests__/core/supabase/updateUserBalance.test.ts:49:27\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["updateUserBalance"],"duration":1449,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"users\"\n\nNumber of calls: 0\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserBalance.test.ts:35:22\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"updateUserBalance should update user balance and return no error on success","status":"failed","title":"should update user balance and return no error on success"},{"ancestorTitles":["updateUserBalance"],"duration":400,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"Ошибка обновления баланса:\", Any<Object>\n\nNumber of calls: 0\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserBalance.test.ts:49:27\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"updateUserBalance should return an error if Supabase update fails","status":"failed","title":"should return an error if Supabase update fails"}]},{"numFailingTests":4,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172267619,"runtime":7366,"slow":true,"start":1745172260253},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/avatarBrainWizard.test.ts","failureMessage":"  ● avatarBrainWizard › step 3: should save skills, update soul, check level <= 2 and leave\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"555\", \"AcmeCorp\", \"Developer\", \"JS, TS\"\n\n    Number of calls: 0\n\n      124 |     await (step3 as MiddlewareFn<MyContext>)(ctx, mockNext)\n      125 |\n    > 126 |     expect(mockedUpdateUserSoul).toHaveBeenCalledWith(\n          |                                  ^\n      127 |       '555',        // userId\n      128 |       'AcmeCorp',   // company (из state)\n      129 |       'Developer',  // position (из state)\n\n      at __tests__/scenes/avatarBrainWizard.test.ts:126:34\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● avatarBrainWizard › step 3: should save skills, update soul, check level = 3, update level and leave\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"666\", \"BigCorp\", \"Manager\", \"Leadership\"\n\n    Number of calls: 0\n\n      150 |     await (step3 as MiddlewareFn<MyContext>)(ctx, mockNext)\n      151 |\n    > 152 |     expect(mockedUpdateUserSoul).toHaveBeenCalledWith('666', 'BigCorp', 'Manager', 'Leadership')\n          |                                  ^\n      153 |     expect(ctx.reply).toHaveBeenCalledWith(expect.stringContaining('✅ Аватар успешно получил информацию'), { parse_mode: 'HTML' })\n      154 |     expect(mockedGetUserByTelegramId).toHaveBeenCalledWith(ctx)\n      155 |     expect(mockedUpdateUserLevelPlusOne).toHaveBeenCalledWith('666', 3) // Уровень должен обновиться\n\n      at __tests__/scenes/avatarBrainWizard.test.ts:152:34\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● avatarBrainWizard › step 3: should save skills, update soul, check level > 3 and leave\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"777\", \"Startup\", \"CTO\", \"Strategy\"\n\n    Number of calls: 0\n\n      168 |     await (step3 as MiddlewareFn<MyContext>)(ctx, mockNext)\n      169 |\n    > 170 |     expect(mockedUpdateUserSoul).toHaveBeenCalledWith('777', 'Startup', 'CTO', 'Strategy')\n          |                                  ^\n      171 |     expect(ctx.reply).toHaveBeenCalledWith(expect.stringContaining('✅ Аватар успешно получил информацию'), { parse_mode: 'HTML' })\n      172 |     expect(mockedGetUserByTelegramId).toHaveBeenCalledWith(ctx)\n      173 |     expect(mockedUpdateUserLevelPlusOne).not.toHaveBeenCalled() // Уровень не должен обновляться\n\n      at __tests__/scenes/avatarBrainWizard.test.ts:170:34\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● avatarBrainWizard › step 3: should throw error if user not found\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"404\", \"Ghost Inc.\", \"Phantom\", \"Invisibility\"\n\n    Number of calls: 0\n\n      189 |\n      190 |     // Проверяем, что updateUserSoul был вызван до ошибки\n    > 191 |     expect(mockedUpdateUserSoul).toHaveBeenCalledWith('404', 'Ghost Inc.', 'Phantom', 'Invisibility')\n          |                                  ^\n      192 |     expect(mockedUpdateUserLevelPlusOne).not.toHaveBeenCalled()\n      193 |     expect(ctx.scene.leave).not.toHaveBeenCalled() // Не должен выйти штатно\n      194 |   })\n\n      at __tests__/scenes/avatarBrainWizard.test.ts:191:34\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["avatarBrainWizard"],"duration":35,"failureMessages":[],"fullName":"avatarBrainWizard step 0: should ask for company name","status":"passed","title":"step 0: should ask for company name"},{"ancestorTitles":["avatarBrainWizard"],"duration":159,"failureMessages":[],"fullName":"avatarBrainWizard step 1: should save company and ask for position","status":"passed","title":"step 1: should save company and ask for position"},{"ancestorTitles":["avatarBrainWizard"],"duration":2,"failureMessages":[],"fullName":"avatarBrainWizard step 2: should save position and ask for skills","status":"passed","title":"step 2: should save position and ask for skills"},{"ancestorTitles":["avatarBrainWizard"],"duration":3,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"555\", \"AcmeCorp\", \"Developer\", \"JS, TS\"\n\nNumber of calls: 0\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/avatarBrainWizard.test.ts:126:34\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"avatarBrainWizard step 3: should save skills, update soul, check level <= 2 and leave","status":"failed","title":"step 3: should save skills, update soul, check level <= 2 and leave"},{"ancestorTitles":["avatarBrainWizard"],"duration":3,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"666\", \"BigCorp\", \"Manager\", \"Leadership\"\n\nNumber of calls: 0\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/avatarBrainWizard.test.ts:152:34\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"avatarBrainWizard step 3: should save skills, update soul, check level = 3, update level and leave","status":"failed","title":"step 3: should save skills, update soul, check level = 3, update level and leave"},{"ancestorTitles":["avatarBrainWizard"],"duration":3,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"777\", \"Startup\", \"CTO\", \"Strategy\"\n\nNumber of calls: 0\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/avatarBrainWizard.test.ts:170:34\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"avatarBrainWizard step 3: should save skills, update soul, check level > 3 and leave","status":"failed","title":"step 3: should save skills, update soul, check level > 3 and leave"},{"ancestorTitles":["avatarBrainWizard"],"duration":35,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"404\", \"Ghost Inc.\", \"Phantom\", \"Invisibility\"\n\nNumber of calls: 0\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/avatarBrainWizard.test.ts:191:34\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"avatarBrainWizard step 3: should throw error if user not found","status":"failed","title":"step 3: should throw error if user not found"}]},{"numFailingTests":2,"numPassingTests":8,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172268411,"runtime":19036,"slow":true,"start":1745172249375},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/voiceAvatarWizard.test.ts","failureMessage":"  ● voiceAvatarWizard › step 1: should handle voice message, generate avatar and leave\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    - Expected\n    + Received\n\n      \"https://api.telegram.org/file/botmock_token/path/to/file\",\n    - \"No text provided\",\n    + \"\",\n      \"123\",\n      {\"answerCbQuery\": [Function mockConstructor], \"answerPreCheckoutQuery\": [Function mockConstructor], \"botInfo\": {\"can_join_groups\": false, \"can_read_all_group_messages\": false, \"first_name\": \"Bot\", \"id\": 1, \"is_bot\": true, \"supports_inline_queries\": false, \"username\": \"test_bot\"}, \"callback_query\": undefined, \"chat\": {\"first_name\": \"Test\", \"id\": 12345, \"type\": \"private\", \"username\": \"testuser\"}, \"debug\": {\"currentScene\": \"\", \"replies\": [], \"replyMessages\": [Function replyMessages]}, \"from\": {\"first_name\": \"Tester\", \"id\": 123, \"is_bot\": false, \"language_code\": \"ru\", \"username\": \"testuser\"}, \"match\": [Function mockConstructor], \"message\": {\"chat\": {\"first_name\": \"Test\", \"id\": 12345, \"type\": \"private\", \"username\": \"testuser\"}, \"date\": 1745172268.145, \"from\": {\"first_name\": \"Tester\", \"id\": 123, \"is_bot\": false, \"language_code\": \"ru\", \"username\": \"testuser\"}, \"message_id\": 1, \"text\": \"\", \"voice\": {\"file_id\": \"voice_file_id\"}}, \"reply\": [Function mockConstructor], \"replyWithInvoice\": [Function mockConstructor], \"replyWithPhoto\": [Function mockConstructor], \"scene\": {\"enter\": [Function mockConstructor], \"leave\": [Function mockConstructor], \"reenter\": [Function mockConstructor], \"session\": {\"state\": {}}}, \"session\": {\"cursor\": 0, \"images\": [], \"targetUserId\": \"12345\", \"userModel\": {\"model_name\": \"test-model\", \"model_url\": \"org/repo:version\", \"trigger_word\": \"test\"}}, \"telegram\": {\"callApi\": [Function mockConstructor], \"getFile\": [Function mockConstructor], \"sendChatAction\": [Function mockConstructor], \"sendMessage\": [Function mockConstructor], \"token\": \"mock_token\"}, \"update\": {\"message\": {\"chat\": {\"first_name\": \"Test\", \"id\": 12345, \"type\": \"private\", \"username\": \"testuser\"}, \"date\": 1745172268.145, \"from\": {\"first_name\": \"Tester\", \"id\": 123, \"is_bot\": false, \"language_code\": \"ru\", \"username\": \"testuser\"}, \"message_id\": 1, \"text\": \"\", \"voice\": {\"file_id\": \"voice_file_id\"}}, \"update_id\": 1}, \"wizard\": {\"back\": [Function mockConstructor], \"cursor\": 0, \"next\": [Function mockConstructor], \"state\": {}, \"steps\": []}},\n      true,\n      \"test_bot\",\n\n    Number of calls: 1\n\n      172 |     expect(mockedHandleHelpCancel).toHaveBeenCalledWith(ctx)\n      173 |     expect(mockGetFile).toHaveBeenCalledWith('voice_file_id')\n    > 174 |     expect(mockedGenerateVoiceAvatar).toHaveBeenCalledWith(\n          |                                       ^\n      175 |       `https://api.telegram.org/file/bot${ctx.telegram.token}/path/to/file`,\n      176 |       'No text provided',\n      177 |       '123',\n\n      at __tests__/scenes/voiceAvatarWizard.test.ts:174:39\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● voiceAvatarWizard › step 1: should handle audio message, generate avatar and leave\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    - Expected\n    + Received\n\n      \"https://api.telegram.org/file/botmock_token/path/to/file\",\n    - \"No text provided\",\n    + \"\",\n      \"123\",\n      {\"answerCbQuery\": [Function mockConstructor], \"answerPreCheckoutQuery\": [Function mockConstructor], \"botInfo\": {\"can_join_groups\": false, \"can_read_all_group_messages\": false, \"first_name\": \"Bot\", \"id\": 1, \"is_bot\": true, \"supports_inline_queries\": false, \"username\": \"test_bot\"}, \"callback_query\": undefined, \"chat\": {\"first_name\": \"Test\", \"id\": 12345, \"type\": \"private\", \"username\": \"testuser\"}, \"debug\": {\"currentScene\": \"\", \"replies\": [], \"replyMessages\": [Function replyMessages]}, \"from\": {\"first_name\": \"Tester\", \"id\": 123, \"is_bot\": false, \"language_code\": \"ru\", \"username\": \"testuser\"}, \"match\": [Function mockConstructor], \"message\": {\"audio\": {\"file_id\": \"audio_file_id\"}, \"chat\": {\"first_name\": \"Test\", \"id\": 12345, \"type\": \"private\", \"username\": \"testuser\"}, \"date\": 1745172268.325, \"from\": {\"first_name\": \"Tester\", \"id\": 123, \"is_bot\": false, \"language_code\": \"ru\", \"username\": \"testuser\"}, \"message_id\": 1, \"text\": \"\"}, \"reply\": [Function mockConstructor], \"replyWithInvoice\": [Function mockConstructor], \"replyWithPhoto\": [Function mockConstructor], \"scene\": {\"enter\": [Function mockConstructor], \"leave\": [Function mockConstructor], \"reenter\": [Function mockConstructor], \"session\": {\"state\": {}}}, \"session\": {\"cursor\": 0, \"images\": [], \"targetUserId\": \"12345\", \"userModel\": {\"model_name\": \"test-model\", \"model_url\": \"org/repo:version\", \"trigger_word\": \"test\"}}, \"telegram\": {\"callApi\": [Function mockConstructor], \"getFile\": [Function mockConstructor], \"sendChatAction\": [Function mockConstructor], \"sendMessage\": [Function mockConstructor], \"token\": \"mock_token\"}, \"update\": {\"message\": {\"audio\": {\"file_id\": \"audio_file_id\"}, \"chat\": {\"first_name\": \"Test\", \"id\": 12345, \"type\": \"private\", \"username\": \"testuser\"}, \"date\": 1745172268.325, \"from\": {\"first_name\": \"Tester\", \"id\": 123, \"is_bot\": false, \"language_code\": \"ru\", \"username\": \"testuser\"}, \"message_id\": 1, \"text\": \"\"}, \"update_id\": 1}, \"wizard\": {\"back\": [Function mockConstructor], \"cursor\": 0, \"next\": [Function mockConstructor], \"state\": {}, \"steps\": []}},\n      true,\n      \"test_bot\",\n\n    Number of calls: 1\n\n      197 |     expect(mockedHandleHelpCancel).toHaveBeenCalledWith(ctx)\n      198 |     expect(mockGetFile).toHaveBeenCalledWith('audio_file_id')\n    > 199 |     expect(mockedGenerateVoiceAvatar).toHaveBeenCalledWith(\n          |                                       ^\n      200 |       `https://api.telegram.org/file/bot${ctx.telegram.token}/path/to/file`,\n      201 |       'No text provided',\n      202 |       '123',\n\n      at __tests__/scenes/voiceAvatarWizard.test.ts:199:39\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["voiceAvatarWizard"],"duration":30,"failureMessages":[],"fullName":"voiceAvatarWizard step 0: should leave if no user ID","status":"passed","title":"step 0: should leave if no user ID"},{"ancestorTitles":["voiceAvatarWizard"],"duration":12,"failureMessages":[],"fullName":"voiceAvatarWizard step 0: should leave if balance is insufficient","status":"passed","title":"step 0: should leave if balance is insufficient"},{"ancestorTitles":["voiceAvatarWizard"],"duration":4,"failureMessages":[],"fullName":"voiceAvatarWizard step 0: should prompt for voice, send balance and advance if balance sufficient","status":"passed","title":"step 0: should prompt for voice, send balance and advance if balance sufficient"},{"ancestorTitles":["voiceAvatarWizard"],"duration":2,"failureMessages":[],"fullName":"voiceAvatarWizard step 1: should prompt if message is invalid (no voice/audio/text)","status":"passed","title":"step 1: should prompt if message is invalid (no voice/audio/text)"},{"ancestorTitles":["voiceAvatarWizard"],"duration":2,"failureMessages":[],"fullName":"voiceAvatarWizard step 1: should leave if handleHelpCancel returns true","status":"passed","title":"step 1: should leave if handleHelpCancel returns true"},{"ancestorTitles":["voiceAvatarWizard"],"duration":56,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n- Expected\n+ Received\n\n  \"https://api.telegram.org/file/botmock_token/path/to/file\",\n- \"No text provided\",\n+ \"\",\n  \"123\",\n  {\"answerCbQuery\": [Function mockConstructor], \"answerPreCheckoutQuery\": [Function mockConstructor], \"botInfo\": {\"can_join_groups\": false, \"can_read_all_group_messages\": false, \"first_name\": \"Bot\", \"id\": 1, \"is_bot\": true, \"supports_inline_queries\": false, \"username\": \"test_bot\"}, \"callback_query\": undefined, \"chat\": {\"first_name\": \"Test\", \"id\": 12345, \"type\": \"private\", \"username\": \"testuser\"}, \"debug\": {\"currentScene\": \"\", \"replies\": [], \"replyMessages\": [Function replyMessages]}, \"from\": {\"first_name\": \"Tester\", \"id\": 123, \"is_bot\": false, \"language_code\": \"ru\", \"username\": \"testuser\"}, \"match\": [Function mockConstructor], \"message\": {\"chat\": {\"first_name\": \"Test\", \"id\": 12345, \"type\": \"private\", \"username\": \"testuser\"}, \"date\": 1745172268.145, \"from\": {\"first_name\": \"Tester\", \"id\": 123, \"is_bot\": false, \"language_code\": \"ru\", \"username\": \"testuser\"}, \"message_id\": 1, \"text\": \"\", \"voice\": {\"file_id\": \"voice_file_id\"}}, \"reply\": [Function mockConstructor], \"replyWithInvoice\": [Function mockConstructor], \"replyWithPhoto\": [Function mockConstructor], \"scene\": {\"enter\": [Function mockConstructor], \"leave\": [Function mockConstructor], \"reenter\": [Function mockConstructor], \"session\": {\"state\": {}}}, \"session\": {\"cursor\": 0, \"images\": [], \"targetUserId\": \"12345\", \"userModel\": {\"model_name\": \"test-model\", \"model_url\": \"org/repo:version\", \"trigger_word\": \"test\"}}, \"telegram\": {\"callApi\": [Function mockConstructor], \"getFile\": [Function mockConstructor], \"sendChatAction\": [Function mockConstructor], \"sendMessage\": [Function mockConstructor], \"token\": \"mock_token\"}, \"update\": {\"message\": {\"chat\": {\"first_name\": \"Test\", \"id\": 12345, \"type\": \"private\", \"username\": \"testuser\"}, \"date\": 1745172268.145, \"from\": {\"first_name\": \"Tester\", \"id\": 123, \"is_bot\": false, \"language_code\": \"ru\", \"username\": \"testuser\"}, \"message_id\": 1, \"text\": \"\", \"voice\": {\"file_id\": \"voice_file_id\"}}, \"update_id\": 1}, \"wizard\": {\"back\": [Function mockConstructor], \"cursor\": 0, \"next\": [Function mockConstructor], \"state\": {}, \"steps\": []}},\n  true,\n  \"test_bot\",\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/voiceAvatarWizard.test.ts:174:39\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"voiceAvatarWizard step 1: should handle voice message, generate avatar and leave","status":"failed","title":"step 1: should handle voice message, generate avatar and leave"},{"ancestorTitles":["voiceAvatarWizard"],"duration":3,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n- Expected\n+ Received\n\n  \"https://api.telegram.org/file/botmock_token/path/to/file\",\n- \"No text provided\",\n+ \"\",\n  \"123\",\n  {\"answerCbQuery\": [Function mockConstructor], \"answerPreCheckoutQuery\": [Function mockConstructor], \"botInfo\": {\"can_join_groups\": false, \"can_read_all_group_messages\": false, \"first_name\": \"Bot\", \"id\": 1, \"is_bot\": true, \"supports_inline_queries\": false, \"username\": \"test_bot\"}, \"callback_query\": undefined, \"chat\": {\"first_name\": \"Test\", \"id\": 12345, \"type\": \"private\", \"username\": \"testuser\"}, \"debug\": {\"currentScene\": \"\", \"replies\": [], \"replyMessages\": [Function replyMessages]}, \"from\": {\"first_name\": \"Tester\", \"id\": 123, \"is_bot\": false, \"language_code\": \"ru\", \"username\": \"testuser\"}, \"match\": [Function mockConstructor], \"message\": {\"audio\": {\"file_id\": \"audio_file_id\"}, \"chat\": {\"first_name\": \"Test\", \"id\": 12345, \"type\": \"private\", \"username\": \"testuser\"}, \"date\": 1745172268.325, \"from\": {\"first_name\": \"Tester\", \"id\": 123, \"is_bot\": false, \"language_code\": \"ru\", \"username\": \"testuser\"}, \"message_id\": 1, \"text\": \"\"}, \"reply\": [Function mockConstructor], \"replyWithInvoice\": [Function mockConstructor], \"replyWithPhoto\": [Function mockConstructor], \"scene\": {\"enter\": [Function mockConstructor], \"leave\": [Function mockConstructor], \"reenter\": [Function mockConstructor], \"session\": {\"state\": {}}}, \"session\": {\"cursor\": 0, \"images\": [], \"targetUserId\": \"12345\", \"userModel\": {\"model_name\": \"test-model\", \"model_url\": \"org/repo:version\", \"trigger_word\": \"test\"}}, \"telegram\": {\"callApi\": [Function mockConstructor], \"getFile\": [Function mockConstructor], \"sendChatAction\": [Function mockConstructor], \"sendMessage\": [Function mockConstructor], \"token\": \"mock_token\"}, \"update\": {\"message\": {\"audio\": {\"file_id\": \"audio_file_id\"}, \"chat\": {\"first_name\": \"Test\", \"id\": 12345, \"type\": \"private\", \"username\": \"testuser\"}, \"date\": 1745172268.325, \"from\": {\"first_name\": \"Tester\", \"id\": 123, \"is_bot\": false, \"language_code\": \"ru\", \"username\": \"testuser\"}, \"message_id\": 1, \"text\": \"\"}, \"update_id\": 1}, \"wizard\": {\"back\": [Function mockConstructor], \"cursor\": 0, \"next\": [Function mockConstructor], \"state\": {}, \"steps\": []}},\n  true,\n  \"test_bot\",\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/voiceAvatarWizard.test.ts:199:39\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"voiceAvatarWizard step 1: should handle audio message, generate avatar and leave","status":"failed","title":"step 1: should handle audio message, generate avatar and leave"},{"ancestorTitles":["voiceAvatarWizard"],"duration":1,"failureMessages":[],"fullName":"voiceAvatarWizard step 1: should reply with error and leave if text message is not help/cancel","status":"passed","title":"step 1: should reply with error and leave if text message is not help/cancel"},{"ancestorTitles":["voiceAvatarWizard"],"duration":9,"failureMessages":[],"fullName":"voiceAvatarWizard step 1: should handle getFile error","status":"passed","title":"step 1: should handle getFile error"},{"ancestorTitles":["voiceAvatarWizard"],"duration":4,"failureMessages":[],"fullName":"voiceAvatarWizard step 1: should handle generateVoiceAvatar error","status":"passed","title":"step 1: should handle generateVoiceAvatar error"}]},{"numFailingTests":7,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172269325,"runtime":9292,"slow":true,"start":1745172260033},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/payments/paymentScene.test.ts","failureMessage":"  ● Payment Scene › should enter the scene and show payment options for RU user\n\n    next(ctx) called with invalid context\n\n      66 |\n      67 |   it('should enter the scene and show payment options for RU user', async () => {\n    > 68 |     await paymentScene.enterMiddleware()(ctx, jest.fn())\n         |                                         ^\n      69 |\n      70 |     expect(replyMock).toHaveBeenCalledTimes(1)\n      71 |     expect(replyMock).toHaveBeenCalledWith(\n\n      at execute (node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:511:27)\n      at node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:507:20\n      at __tests__/payments/paymentScene.test.ts:68:41\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/payments/paymentScene.test.ts:67:80)\n\n  ● Payment Scene › should enter the scene and show payment options for EN user\n\n    next(ctx) called with invalid context\n\n       98 |   it('should enter the scene and show payment options for EN user', async () => {\n       99 |     mockedIsRussian.mockReturnValue(false)\n    > 100 |     await paymentScene.enterMiddleware()(ctx, jest.fn())\n          |                                         ^\n      101 |\n      102 |     expect(replyMock).toHaveBeenCalledTimes(1)\n      103 |     expect(replyMock).toHaveBeenCalledWith(\n\n      at execute (node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:511:27)\n      at node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:507:20\n      at __tests__/payments/paymentScene.test.ts:100:41\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/payments/paymentScene.test.ts:98:80)\n\n  ● Payment Scene › should handle \"⭐️ Звездами\" and enter StarPaymentScene\n\n    next(ctx) called with invalid context\n\n      145 |     // We rely on makeMockContext to provide ctx.scene\n      146 |\n    > 147 |     await paymentScene.middleware()(ctx, jest.fn())\n          |                                    ^\n      148 |     expect(ctx.scene.enter).toHaveBeenCalledWith(ModeEnum.StarPaymentScene)\n      149 |   })\n      150 |\n\n      at execute (node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:511:27)\n      at node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:507:20\n      at __tests__/payments/paymentScene.test.ts:147:36\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/payments/paymentScene.test.ts:126:75)\n\n  ● Payment Scene › should handle \"💳 Рублями\" and enter RublePaymentScene\n\n    next(ctx) called with invalid context\n\n      170 |     // We rely on makeMockContext to provide ctx.scene\n      171 |\n    > 172 |     await paymentScene.middleware()(ctx, jest.fn())\n          |                                    ^\n      173 |     expect(ctx.scene.enter).toHaveBeenCalledWith(ModeEnum.RublePaymentScene)\n      174 |     expect(mockedLogger.info).toHaveBeenCalledWith(\n      175 |       expect.stringContaining('User chose Rubles. Entering'),\n\n      at execute (node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:511:27)\n      at node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:507:20\n      at __tests__/payments/paymentScene.test.ts:172:36\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/payments/paymentScene.test.ts:151:75)\n\n  ● Payment Scene › should handle \"🏠 Главное меню\" and enter MenuScene\n\n    next(ctx) called with invalid context\n\n      199 |     // We rely on makeMockContext to provide ctx.scene\n      200 |\n    > 201 |     await paymentScene.middleware()(ctx, jest.fn())\n          |                                    ^\n      202 |     expect(ctx.scene.enter).toHaveBeenCalledWith(ModeEnum.MenuScene)\n      203 |     expect(mockedLogger.info).toHaveBeenCalledWith(\n      204 |       expect.stringContaining('Leaving scene via Main Menu button'),\n\n      at execute (node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:511:27)\n      at node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:507:20\n      at __tests__/payments/paymentScene.test.ts:201:36\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/payments/paymentScene.test.ts:180:72)\n\n  ● Payment Scene › should handle unexpected message\n\n    next(ctx) called with invalid context\n\n      231 |     // We rely on makeMockContext to provide ctx.scene\n      232 |\n    > 233 |     await paymentScene.middleware()(ctx, jest.fn())\n          |                                    ^\n      234 |     expect(replyMock).toHaveBeenCalledWith(\n      235 |       'Пожалуйста, выберите способ оплаты (⭐️ или 💳) или вернитесь в главное меню.',\n      236 |       expect.any(Object)\n\n      at execute (node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:511:27)\n      at node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:507:20\n      at __tests__/payments/paymentScene.test.ts:233:36\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/payments/paymentScene.test.ts:210:53)\n\n  ● Payment Scene › should handle error during enterMiddleware and leave scene\n\n    next(ctx) called with invalid context\n\n      258 |     })\n      259 |\n    > 260 |     await paymentScene.enterMiddleware()(ctx, jest.fn())\n          |                                         ^\n      261 |\n      262 |     expect(replyMock).toHaveBeenCalledTimes(2)\n      263 |     expect(replyMock).toHaveBeenNthCalledWith(\n\n      at execute (node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:511:27)\n      at node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:507:20\n      at __tests__/payments/paymentScene.test.ts:260:41\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/payments/paymentScene.test.ts:246:79)\n","testResults":[{"ancestorTitles":["Payment Scene"],"duration":3,"failureMessages":["Error: next(ctx) called with invalid context\n    at execute (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:511:27)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:507:20\n    at /Users/playom/999-multibots-telegraf/__tests__/payments/paymentScene.test.ts:68:41\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/payments/paymentScene.test.ts:67:80)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"Payment Scene should enter the scene and show payment options for RU user","status":"failed","title":"should enter the scene and show payment options for RU user"},{"ancestorTitles":["Payment Scene"],"duration":2,"failureMessages":["Error: next(ctx) called with invalid context\n    at execute (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:511:27)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:507:20\n    at /Users/playom/999-multibots-telegraf/__tests__/payments/paymentScene.test.ts:100:41\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/payments/paymentScene.test.ts:98:80)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"Payment Scene should enter the scene and show payment options for EN user","status":"failed","title":"should enter the scene and show payment options for EN user"},{"ancestorTitles":["Payment Scene"],"duration":23,"failureMessages":["Error: next(ctx) called with invalid context\n    at execute (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:511:27)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:507:20\n    at /Users/playom/999-multibots-telegraf/__tests__/payments/paymentScene.test.ts:147:36\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/payments/paymentScene.test.ts:126:75)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"Payment Scene should handle \"⭐️ Звездами\" and enter StarPaymentScene","status":"failed","title":"should handle \"⭐️ Звездами\" and enter StarPaymentScene"},{"ancestorTitles":["Payment Scene"],"duration":4,"failureMessages":["Error: next(ctx) called with invalid context\n    at execute (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:511:27)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:507:20\n    at /Users/playom/999-multibots-telegraf/__tests__/payments/paymentScene.test.ts:172:36\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/payments/paymentScene.test.ts:151:75)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"Payment Scene should handle \"💳 Рублями\" and enter RublePaymentScene","status":"failed","title":"should handle \"💳 Рублями\" and enter RublePaymentScene"},{"ancestorTitles":["Payment Scene"],"duration":3,"failureMessages":["Error: next(ctx) called with invalid context\n    at execute (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:511:27)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:507:20\n    at /Users/playom/999-multibots-telegraf/__tests__/payments/paymentScene.test.ts:201:36\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/payments/paymentScene.test.ts:180:72)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"Payment Scene should handle \"🏠 Главное меню\" and enter MenuScene","status":"failed","title":"should handle \"🏠 Главное меню\" and enter MenuScene"},{"ancestorTitles":["Payment Scene"],"duration":2,"failureMessages":["Error: next(ctx) called with invalid context\n    at execute (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:511:27)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:507:20\n    at /Users/playom/999-multibots-telegraf/__tests__/payments/paymentScene.test.ts:233:36\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/payments/paymentScene.test.ts:210:53)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"Payment Scene should handle unexpected message","status":"failed","title":"should handle unexpected message"},{"ancestorTitles":["Payment Scene"],"duration":7,"failureMessages":["Error: next(ctx) called with invalid context\n    at execute (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:511:27)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/lib/composer.js:507:20\n    at /Users/playom/999-multibots-telegraf/__tests__/payments/paymentScene.test.ts:260:41\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/payments/paymentScene.test.ts:246:79)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"Payment Scene should handle error during enterMiddleware and leave scene","status":"failed","title":"should handle error during enterMiddleware and leave scene"}]},{"numFailingTests":3,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172269458,"runtime":20043,"slow":true,"start":1745172249415},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/levelQuestWizardHandlers.test.ts","failureMessage":"  ● levelQuestWizard handlers › handleQuestRules › calls errorMessage on exception\n\n    fail\n\n      94 |       ctx = makeMockContext({ message: { from: mockFrom } }, sessionData)\n      95 |       mockedIsRussian.mockReturnValue(false)\n    > 96 |       mockedGetSubChannel.mockImplementation(() => { throw new Error('fail') })\n         |                                                            ^\n      97 |\n      98 |       // Обработчик сам ловит ошибку, поэтому не используем rejects.toThrow\n      99 |       await handleQuestRules(ctx)\n\n      at __tests__/scenes/levelQuestWizardHandlers.test.ts:96:60\n      at src/scenes/levelQuestWizard/handlers.ts:11:53\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at handleQuestRules (src/scenes/levelQuestWizard/handlers.ts:4947:18)\n      at __tests__/scenes/levelQuestWizardHandlers.test.ts:99:29\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/levelQuestWizardHandlers.test.ts:92:54)\n\n  ● levelQuestWizard handlers › handleQuestComplete › replies with completion message and keyboard\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    - Expected\n    + Received\n\n    - StringContaining \"NeuroQuest completed\",\n    + \"🎉 Поздравляем! Вы завершили обучение.\",\n      {\"reply_markup\": {\"keyboard\": [[\"m\"]]}},\n\n    Number of calls: 1\n\n      113 |       await handleQuestComplete(ctx)\n      114 |\n    > 115 |       expect(ctx.reply).toHaveBeenCalledWith(\n          |                         ^\n      116 |         expect.stringContaining('NeuroQuest completed'),\n      117 |         { reply_markup: { keyboard: [['m']] } }\n      118 |       )\n\n      at __tests__/scenes/levelQuestWizardHandlers.test.ts:115:25\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● levelQuestWizard handlers › handleQuestComplete › calls errorMessage on exception\n\n    oops\n\n      123 |       ctx = makeMockContext({ message: { from: mockFrom } }, sessionData)\n      124 |       mockedIsRussian.mockReturnValue(true)\n    > 125 |       const error = new Error('oops')\n          |                     ^\n      126 |       mockedGetReferals.mockRejectedValue(error)\n      127 |\n      128 |       await handleQuestComplete(ctx)\n\n      at __tests__/scenes/levelQuestWizardHandlers.test.ts:125:21\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/levelQuestWizardHandlers.test.ts:121:54)\n","testResults":[{"ancestorTitles":["levelQuestWizard handlers","handleQuestRules"],"duration":10,"failureMessages":[],"fullName":"levelQuestWizard handlers handleQuestRules replies with rules message in Russian","status":"passed","title":"replies with rules message in Russian"},{"ancestorTitles":["levelQuestWizard handlers","handleQuestRules"],"duration":2,"failureMessages":["Error: fail\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/levelQuestWizardHandlers.test.ts:96:60\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-mock@29.7.0/node_modules/jest-mock/build/index.js:397:39\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-mock@29.7.0/node_modules/jest-mock/build/index.js:404:13\n    at mockConstructor (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-mock@29.7.0/node_modules/jest-mock/build/index.js:148:19)\n    at getSubScribeChannel (eval at _createMockFunction (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-mock@29.7.0/node_modules/jest-mock/build/index.js:566:31), <anonymous>:3:65)\n    at /Users/playom/999-multibots-telegraf/src/scenes/levelQuestWizard/handlers.ts:11:53\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at handleQuestRules (/Users/playom/999-multibots-telegraf/src/scenes/levelQuestWizard/handlers.ts:4947:18)\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/levelQuestWizardHandlers.test.ts:99:29\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/levelQuestWizardHandlers.test.ts:92:54)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"levelQuestWizard handlers handleQuestRules calls errorMessage on exception","status":"failed","title":"calls errorMessage on exception"},{"ancestorTitles":["levelQuestWizard handlers","handleQuestComplete"],"duration":70,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n- Expected\n+ Received\n\n- StringContaining \"NeuroQuest completed\",\n+ \"🎉 Поздравляем! Вы завершили обучение.\",\n  {\"reply_markup\": {\"keyboard\": [[\"m\"]]}},\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/levelQuestWizardHandlers.test.ts:115:25\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"levelQuestWizard handlers handleQuestComplete replies with completion message and keyboard","status":"failed","title":"replies with completion message and keyboard"},{"ancestorTitles":["levelQuestWizard handlers","handleQuestComplete"],"duration":19,"failureMessages":["Error: oops\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/levelQuestWizardHandlers.test.ts:125:21\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/levelQuestWizardHandlers.test.ts:121:54)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"levelQuestWizard handlers handleQuestComplete calls errorMessage on exception","status":"failed","title":"calls errorMessage on exception"}]},{"numFailingTests":6,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172269909,"runtime":1557,"slow":false,"start":1745172268352},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts","failureMessage":"  ● createUser › throws if inviter check fails\n\n    expect(received).rejects.toThrow(expected)\n\n    Expected substring: \"Ошибка при проверке инвайтера: invite error\"\n    Received message:   \"Cannot read properties of undefined (reading 'select')\"\n\n          38 |         bot_name,\n          39 |       },\n        > 40 |     ])\n             |       ^\n          41 |     .select()\n          42 |\n          43 |   if (error) {\n\n      at src/core/supabase/createUser.ts:40:7\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at __awaiter (src/core/supabase/createUser.ts:19:22)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:68:18)\n      at __tests__/core/supabase/createUser.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/core/supabase/createUser.test.ts:3:12)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:63:50)\n      at Object.toThrow (node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:68:44)\n      at __tests__/core/supabase/createUser.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/core/supabase/createUser.test.ts:3:12)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:63:50)\n\n  ● createUser › throws if existing user select fails\n\n    expect(received).rejects.toThrow(expected)\n\n    Expected substring: \"Ошибка при проверке существующего пользователя: select error\"\n    Received message:   \"Cannot read properties of undefined (reading 'select')\"\n\n          38 |         bot_name,\n          39 |       },\n        > 40 |     ])\n             |       ^\n          41 |     .select()\n          42 |\n          43 |   if (error) {\n\n      at src/core/supabase/createUser.ts:40:7\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at __awaiter (src/core/supabase/createUser.ts:19:22)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:75:18)\n      at __tests__/core/supabase/createUser.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/core/supabase/createUser.test.ts:3:12)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:71:57)\n      at Object.toThrow (node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:75:48)\n      at __tests__/core/supabase/createUser.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/core/supabase/createUser.test.ts:3:12)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:71:57)\n\n  ● createUser › updates existing user when found without inviter\n\n    TypeError: Cannot read properties of undefined (reading 'select')\n\n      38 |         bot_name,\n      39 |       },\n    > 40 |     ])\n         |       ^\n      41 |     .select()\n      42 |\n      43 |   if (error) {\n\n      at src/core/supabase/createUser.ts:40:7\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at __awaiter (src/core/supabase/createUser.ts:19:22)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:84:26)\n      at __tests__/core/supabase/createUser.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/core/supabase/createUser.test.ts:3:12)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:78:69)\n\n  ● createUser › inserts new user when not exists\n\n    TypeError: supabase_1.supabase.from(...).insert(...).select is not a function\n\n      39 |       },\n      40 |     ])\n    > 41 |     .select()\n         |      ^\n      42 |\n      43 |   if (error) {\n      44 |     console.error('Error creating user:', error)\n\n      at select (src/core/supabase/createUser.ts:41:6)\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at __awaiter (src/core/supabase/createUser.ts:19:22)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:93:26)\n      at __tests__/core/supabase/createUser.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/core/supabase/createUser.test.ts:3:12)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:90:53)\n\n  ● createUser › throws on update error\n\n    expect(received).rejects.toThrow(expected)\n\n    Expected substring: \"Ошибка при обновлении пользователя: upd error\"\n    Received message:   \"Cannot read properties of undefined (reading 'select')\"\n\n          38 |         bot_name,\n          39 |       },\n        > 40 |     ])\n             |       ^\n          41 |     .select()\n          42 |\n          43 |   if (error) {\n\n      at src/core/supabase/createUser.ts:40:7\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at __awaiter (src/core/supabase/createUser.ts:19:22)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:103:18)\n      at __tests__/core/supabase/createUser.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/core/supabase/createUser.test.ts:3:12)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:98:43)\n      at Object.toThrow (node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:103:48)\n      at __tests__/core/supabase/createUser.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/core/supabase/createUser.test.ts:3:12)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:98:43)\n\n  ● createUser › throws on insert error\n\n    expect(received).rejects.toThrow(expected)\n\n    Expected substring: \"Ошибка при добавлении пользователя: ins error\"\n    Received message:   \"supabase_1.supabase.from(...).insert(...).select is not a function\"\n\n          39 |       },\n          40 |     ])\n        > 41 |     .select()\n             |      ^\n          42 |\n          43 |   if (error) {\n          44 |     console.error('Error creating user:', error)\n\n      at select (src/core/supabase/createUser.ts:41:6)\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at __awaiter (src/core/supabase/createUser.ts:19:22)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:110:18)\n      at __tests__/core/supabase/createUser.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/core/supabase/createUser.test.ts:3:12)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:106:43)\n      at Object.toThrow (node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:110:48)\n      at __tests__/core/supabase/createUser.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/core/supabase/createUser.test.ts:3:12)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:106:43)\n","testResults":[{"ancestorTitles":["createUser"],"duration":212,"failureMessages":["Error: expect(received).rejects.toThrow(expected)\n\nExpected substring: \"Ошибка при проверке инвайтера: invite error\"\nReceived message:   \"Cannot read properties of undefined (reading 'select')\"\n\n      38 |         bot_name,\n      39 |       },\n    > 40 |     ])\n         |       ^\n      41 |     .select()\n      42 |\n      43 |   if (error) {\n\n      at src/core/supabase/createUser.ts:40:7\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at __awaiter (src/core/supabase/createUser.ts:19:22)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:68:18)\n      at __tests__/core/supabase/createUser.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/core/supabase/createUser.test.ts:3:12)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:63:50)\n    at Object.toThrow (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:68:44)\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:7:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:3:12)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:63:50)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"createUser throws if inviter check fails","status":"failed","title":"throws if inviter check fails"},{"ancestorTitles":["createUser"],"duration":17,"failureMessages":["Error: expect(received).rejects.toThrow(expected)\n\nExpected substring: \"Ошибка при проверке существующего пользователя: select error\"\nReceived message:   \"Cannot read properties of undefined (reading 'select')\"\n\n      38 |         bot_name,\n      39 |       },\n    > 40 |     ])\n         |       ^\n      41 |     .select()\n      42 |\n      43 |   if (error) {\n\n      at src/core/supabase/createUser.ts:40:7\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at __awaiter (src/core/supabase/createUser.ts:19:22)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:75:18)\n      at __tests__/core/supabase/createUser.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/core/supabase/createUser.test.ts:3:12)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:71:57)\n    at Object.toThrow (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:75:48)\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:7:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:3:12)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:71:57)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"createUser throws if existing user select fails","status":"failed","title":"throws if existing user select fails"},{"ancestorTitles":["createUser"],"duration":8,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'select')\n    at /Users/playom/999-multibots-telegraf/src/core/supabase/createUser.ts:40:7\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at __awaiter (/Users/playom/999-multibots-telegraf/src/core/supabase/createUser.ts:19:22)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:84:26)\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:7:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:3:12)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:78:69)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"createUser updates existing user when found without inviter","status":"failed","title":"updates existing user when found without inviter"},{"ancestorTitles":["createUser"],"duration":6,"failureMessages":["TypeError: supabase_1.supabase.from(...).insert(...).select is not a function\n    at select (/Users/playom/999-multibots-telegraf/src/core/supabase/createUser.ts:41:6)\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at __awaiter (/Users/playom/999-multibots-telegraf/src/core/supabase/createUser.ts:19:22)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:93:26)\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:7:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:3:12)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:90:53)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"createUser inserts new user when not exists","status":"failed","title":"inserts new user when not exists"},{"ancestorTitles":["createUser"],"duration":9,"failureMessages":["Error: expect(received).rejects.toThrow(expected)\n\nExpected substring: \"Ошибка при обновлении пользователя: upd error\"\nReceived message:   \"Cannot read properties of undefined (reading 'select')\"\n\n      38 |         bot_name,\n      39 |       },\n    > 40 |     ])\n         |       ^\n      41 |     .select()\n      42 |\n      43 |   if (error) {\n\n      at src/core/supabase/createUser.ts:40:7\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at __awaiter (src/core/supabase/createUser.ts:19:22)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:103:18)\n      at __tests__/core/supabase/createUser.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/core/supabase/createUser.test.ts:3:12)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:98:43)\n    at Object.toThrow (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:103:48)\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:7:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:3:12)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:98:43)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"createUser throws on update error","status":"failed","title":"throws on update error"},{"ancestorTitles":["createUser"],"duration":8,"failureMessages":["Error: expect(received).rejects.toThrow(expected)\n\nExpected substring: \"Ошибка при добавлении пользователя: ins error\"\nReceived message:   \"supabase_1.supabase.from(...).insert(...).select is not a function\"\n\n      39 |       },\n      40 |     ])\n    > 41 |     .select()\n         |      ^\n      42 |\n      43 |   if (error) {\n      44 |     console.error('Error creating user:', error)\n\n      at select (src/core/supabase/createUser.ts:41:6)\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at __awaiter (src/core/supabase/createUser.ts:19:22)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:110:18)\n      at __tests__/core/supabase/createUser.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/core/supabase/createUser.test.ts:3:12)\n      at Object.<anonymous> (__tests__/core/supabase/createUser.test.ts:106:43)\n    at Object.toThrow (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:110:48)\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:7:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:3:12)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/createUser.test.ts:106:43)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"createUser throws on insert error","status":"failed","title":"throws on insert error"}]},{"numFailingTests":1,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172270162,"runtime":2221,"slow":false,"start":1745172267941},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/processBalanceOperation.test.ts","failureMessage":"  ● processBalanceOperation › returns success and updates balance\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: true\n    Received: false\n\n      32 |       is_ru: true,\n      33 |     })\n    > 34 |     expect(res.success).toBe(true)\n         |                         ^\n      35 |     expect(res.newBalance).toBe(15)\n      36 |     expect(spyUpdate).toHaveBeenCalledWith(telegram_id, 15)\n      37 |   })\n\n      at __tests__/price/processBalanceOperation.test.ts:34:25\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["processBalanceOperation"],"duration":312,"failureMessages":[],"fullName":"processBalanceOperation returns error when balance insufficient","status":"passed","title":"returns error when balance insufficient"},{"ancestorTitles":["processBalanceOperation"],"duration":6,"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: true\nReceived: false\n    at /Users/playom/999-multibots-telegraf/__tests__/price/processBalanceOperation.test.ts:34:25\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"processBalanceOperation returns success and updates balance","status":"failed","title":"returns success and updates balance"}]},{"numFailingTests":2,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172271198,"runtime":910,"slow":false,"start":1745172270288},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getHistory.unit.test.ts","failureMessage":"  ● getHistory › returns empty array on error\n\n    TypeError: supabase_1.supabase.from(...).select(...).order(...).limit(...).eq(...).eq is not a function\n\n      12 |     .limit(10)\n      13 |     .eq('brand', brand)\n    > 14 |     .eq('command', command)\n         |      ^\n      15 |     .eq('type', type)\n      16 |\n      17 |   if (error) {\n\n      at eq (src/core/supabase/getHistory.ts:14:6)\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at __awaiter (src/core/supabase/getHistory.ts:7:5)\n      at __tests__/core/supabase/getHistory.unit.test.ts:26:36\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/core/supabase/getHistory.unit.test.ts:16:49)\n\n  ● getHistory › returns data on success\n\n    TypeError: supabase_1.supabase.from(...).select(...).order(...).limit(...).eq(...).eq is not a function\n\n      12 |     .limit(10)\n      13 |     .eq('brand', brand)\n    > 14 |     .eq('command', command)\n         |      ^\n      15 |     .eq('type', type)\n      16 |\n      17 |   if (error) {\n\n      at eq (src/core/supabase/getHistory.ts:14:6)\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at __awaiter (src/core/supabase/getHistory.ts:7:5)\n      at __tests__/core/supabase/getHistory.unit.test.ts:42:36\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/core/supabase/getHistory.unit.test.ts:32:44)\n","testResults":[{"ancestorTitles":["getHistory"],"duration":4,"failureMessages":["TypeError: supabase_1.supabase.from(...).select(...).order(...).limit(...).eq(...).eq is not a function\n    at eq (/Users/playom/999-multibots-telegraf/src/core/supabase/getHistory.ts:14:6)\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at __awaiter (/Users/playom/999-multibots-telegraf/src/core/supabase/getHistory.ts:7:5)\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/getHistory.unit.test.ts:26:36\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getHistory.unit.test.ts:16:49)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"getHistory returns empty array on error","status":"failed","title":"returns empty array on error"},{"ancestorTitles":["getHistory"],"duration":2,"failureMessages":["TypeError: supabase_1.supabase.from(...).select(...).order(...).limit(...).eq(...).eq is not a function\n    at eq (/Users/playom/999-multibots-telegraf/src/core/supabase/getHistory.ts:14:6)\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at __awaiter (/Users/playom/999-multibots-telegraf/src/core/supabase/getHistory.ts:7:5)\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/getHistory.unit.test.ts:42:36\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getHistory.unit.test.ts:32:44)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"getHistory returns data on success","status":"failed","title":"returns data on success"}]},{"numFailingTests":6,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172271764,"runtime":4418,"slow":false,"start":1745172267346},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/subscriptionCheckScene.test.ts","failureMessage":"  ● subscriptionCheckScene › should enter main menu if user is admin\n\n    TypeError: step is not a function\n\n      85 |     // Передаем from через message\n      86 |     ctx = makeMockContext({ message: { from: { id: adminId, is_bot: false, first_name: 'Admin' } } }, sessionData)\n    > 87 |     await step(ctx, mockNext)\n         |           ^\n      88 |     expect(ctx.scene.enter).toHaveBeenCalledWith(ModeEnum.MainMenu)\n      89 |     expect(mockedCheckSubscription).not.toHaveBeenCalled()\n      90 |     expect(ctx.reply).not.toHaveBeenCalled() // Не должно быть сообщения об ошибке\n\n      at __tests__/scenes/subscriptionCheckScene.test.ts:87:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/subscriptionCheckScene.test.ts:82:60)\n\n  ● subscriptionCheckScene › should call checkSubscription for non-admin user\n\n    TypeError: step is not a function\n\n       95 |     ctx = makeMockContext({ message: { from: { id: userId, is_bot: false, first_name: 'User' } } }, sessionData)\n       96 |     mockedCheckSubscription.mockResolvedValue(SubscriptionType.NEUROBASE) // Пример уровня\n    >  97 |     await step(ctx, mockNext)\n          |           ^\n       98 |     expect(mockedCheckSubscription).toHaveBeenCalledWith(userId.toString())\n       99 |     // Ожидаем вход в MainMenu, т.к. подписка есть\n      100 |     expect(ctx.scene.enter).toHaveBeenCalledWith(ModeEnum.MainMenu)\n\n      at __tests__/scenes/subscriptionCheckScene.test.ts:97:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/subscriptionCheckScene.test.ts:93:69)\n\n  ● subscriptionCheckScene › should enter subscription scene if check returns unsubscribed\n\n    TypeError: step is not a function\n\n      107 |     ctx = makeMockContext({ message: { from: { id: userId, is_bot: false, first_name: 'User' } } }, sessionData)\n      108 |     mockedCheckSubscription.mockResolvedValue('unsubscribed')\n    > 109 |     await step(ctx, mockNext)\n          |           ^\n      110 |     expect(ctx.scene.enter).toHaveBeenCalledWith(ModeEnum.SubscriptionScene)\n      111 |     expect(mockedCheckSubscription).toHaveBeenCalledWith(userId.toString())\n      112 |     expect(ctx.reply).toHaveBeenCalledWith(expect.stringContaining('необходимо продлить подписку'), expect.anything())\n\n      at __tests__/scenes/subscriptionCheckScene.test.ts:109:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/subscriptionCheckScene.test.ts:105:82)\n\n  ● subscriptionCheckScene › should enter main menu if check returns a valid level\n\n    TypeError: step is not a function\n\n      118 |     ctx = makeMockContext({ message: { from: { id: userId, is_bot: false, first_name: 'User' } } }, sessionData)\n      119 |     mockedCheckSubscription.mockResolvedValue(level)\n    > 120 |     await step(ctx, mockNext)\n          |           ^\n      121 |     expect(ctx.scene.enter).toHaveBeenCalledWith(ModeEnum.MainMenu)\n      122 |     expect(ctx.session.subscription).toBe(level)\n      123 |     expect(mockedCheckSubscription).toHaveBeenCalledWith(userId.toString())\n\n      at __tests__/scenes/subscriptionCheckScene.test.ts:120:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/subscriptionCheckScene.test.ts:115:74)\n\n  ● subscriptionCheckScene › should enter subscription scene on checkSubscription error\n\n    TypeError: step is not a function\n\n      130 |     const error = new Error('DB failed')\n      131 |     mockedCheckSubscription.mockRejectedValue(error)\n    > 132 |     await step(ctx, mockNext)\n          |           ^\n      133 |     expect(ctx.scene.enter).toHaveBeenCalledWith(ModeEnum.SubscriptionScene)\n      134 |     expect(mockedCheckSubscription).toHaveBeenCalledWith(userId.toString())\n      135 |     expect(ctx.reply).toHaveBeenCalledWith(expect.stringContaining('Ошибка проверки статуса'), expect.anything())\n\n      at __tests__/scenes/subscriptionCheckScene.test.ts:132:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/subscriptionCheckScene.test.ts:127:79)\n\n  ● subscriptionCheckScene › should enter subscription scene if user ID is missing\n\n    TypeError: step is not a function\n\n      140 |     // Не передаем from\n      141 |     ctx = makeMockContext({}, sessionData)\n    > 142 |     await step(ctx, mockNext)\n          |           ^\n      143 |     expect(ctx.scene.enter).toHaveBeenCalledWith(ModeEnum.SubscriptionScene)\n      144 |     expect(mockedCheckSubscription).not.toHaveBeenCalled()\n      145 |     expect(ctx.reply).toHaveBeenCalledWith(expect.stringContaining('Не удалось определить пользователя'), expect.anything())\n\n      at __tests__/scenes/subscriptionCheckScene.test.ts:142:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/subscriptionCheckScene.test.ts:138:74)\n","testResults":[{"ancestorTitles":["subscriptionCheckScene"],"duration":4,"failureMessages":["TypeError: step is not a function\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/subscriptionCheckScene.test.ts:87:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/subscriptionCheckScene.test.ts:82:60)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"subscriptionCheckScene should enter main menu if user is admin","status":"failed","title":"should enter main menu if user is admin"},{"ancestorTitles":["subscriptionCheckScene"],"duration":1,"failureMessages":["TypeError: step is not a function\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/subscriptionCheckScene.test.ts:97:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/subscriptionCheckScene.test.ts:93:69)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"subscriptionCheckScene should call checkSubscription for non-admin user","status":"failed","title":"should call checkSubscription for non-admin user"},{"ancestorTitles":["subscriptionCheckScene"],"duration":1,"failureMessages":["TypeError: step is not a function\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/subscriptionCheckScene.test.ts:109:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/subscriptionCheckScene.test.ts:105:82)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"subscriptionCheckScene should enter subscription scene if check returns unsubscribed","status":"failed","title":"should enter subscription scene if check returns unsubscribed"},{"ancestorTitles":["subscriptionCheckScene"],"duration":1,"failureMessages":["TypeError: step is not a function\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/subscriptionCheckScene.test.ts:120:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/subscriptionCheckScene.test.ts:115:74)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"subscriptionCheckScene should enter main menu if check returns a valid level","status":"failed","title":"should enter main menu if check returns a valid level"},{"ancestorTitles":["subscriptionCheckScene"],"duration":1,"failureMessages":["TypeError: step is not a function\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/subscriptionCheckScene.test.ts:132:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/subscriptionCheckScene.test.ts:127:79)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"subscriptionCheckScene should enter subscription scene on checkSubscription error","status":"failed","title":"should enter subscription scene on checkSubscription error"},{"ancestorTitles":["subscriptionCheckScene"],"duration":1,"failureMessages":["TypeError: step is not a function\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/subscriptionCheckScene.test.ts:142:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/subscriptionCheckScene.test.ts:138:74)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"subscriptionCheckScene should enter subscription scene if user ID is missing","status":"failed","title":"should enter subscription scene if user ID is missing"}]},{"numFailingTests":4,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172272206,"runtime":2288,"slow":false,"start":1745172269918},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/services/createModelTraining.test.ts","failureMessage":"  ● createModelTraining › posts form data to create-model-training endpoint and unlinks file\n\n    TypeError: Cannot read properties of undefined (reading 'data')\n\n      69 |\n      70 |     await fs.promises.unlink(requestData.filePath)\n    > 71 |     console.log('Model training response:', response.data)\n         |                                                      ^\n      72 |     return response.data\n      73 |   } catch (error) {\n      74 |     // if (axios.isAxiosError(error)) {\n\n      at data (src/services/createModelTraining.ts:71:54)\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● createModelTraining › uses create-model-training-v2 for other mode\n\n    TypeError: Cannot read properties of undefined (reading 'data')\n\n      69 |\n      70 |     await fs.promises.unlink(requestData.filePath)\n    > 71 |     console.log('Model training response:', response.data)\n         |                                                      ^\n      72 |     return response.data\n      73 |   } catch (error) {\n      74 |     // if (axios.isAxiosError(error)) {\n\n      at data (src/services/createModelTraining.ts:71:54)\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● createModelTraining › propagates axios errors and does not unlink file\n\n    expect(received).rejects.toThrow(expected)\n\n    Expected substring: \"net fail\"\n    Received message:   \"Cannot read properties of undefined (reading 'data')\"\n\n          69 |\n          70 |     await fs.promises.unlink(requestData.filePath)\n        > 71 |     console.log('Model training response:', response.data)\n             |                                                      ^\n          72 |     return response.data\n          73 |   } catch (error) {\n          74 |     // if (axios.isAxiosError(error)) {\n\n      at data (src/services/createModelTraining.ts:71:54)\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n      at Object.toThrow (node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n      at __tests__/services/createModelTraining.test.ts:75:15\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/services/createModelTraining.test.ts:71:69)\n\n  ● createModelTraining › uses ELESTIO_URL when in production mode\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"https://ele.stio/generate/create-model-training\", Any<FormData>, ObjectContaining {\"headers\": ObjectContaining {\"x-secret-key\": \"secret-key\"}}\n    Received: \"https://ele.stio/generate/create-model-training\", {\"_boundary\": \"--------------------------823346246969332150562399\", \"_currentStream\": null, \"_insideLoop\": false, \"_overheadLength\": 851, \"_pendingNext\": false, \"_released\": false, \"_streams\": [\"----------------------------823346246969332150562399·\n    Content-Disposition: form-data; name=\\\"type\\\"···\n    \", \"model\", [Function bound ], \"----------------------------823346246969332150562399·\n    Content-Disposition: form-data; name=\\\"telegram_id\\\"···\n    \", \"u\", [Function bound ], \"----------------------------823346246969332150562399·\n    Content-Disposition: form-data; name=\\\"zipUrl\\\"···\n    \", \"<stream>\", [Function bound ], \"----------------------------823346246969332150562399·\n    Content-Disposition: form-data; name=\\\"triggerWord\\\"···\n    \", …], \"_valueLength\": 22, \"_valuesToMeasure\": [], \"dataSize\": 0, \"maxDataSize\": 2097152, \"pauseStreams\": true, \"readable\": true, \"writable\": false}, {\"headers\": {\"Content-Type\": \"multipart/form-data\", \"content-type\": \"multipart/form-data; boundary=--------------------------823346246969332150562399\", \"x-secret-key\": \"secret-key\"}}\n\n    Number of calls: 1\n\n      103 |     await expect(createModelTraining(req, ctxProd)).resolves.toEqual({ m: 'ok' })\n      104 |     // Assert URL called correctly\n    > 105 |     expect(axiosMock.post).toHaveBeenCalledWith(\n          |                            ^\n      106 |       'https://ele.stio/generate/create-model-training',\n      107 |       expect.any(FormData),\n      108 |       expect.objectContaining({ headers: expect.objectContaining({ 'x-secret-key': 'secret-key' }) })\n\n      at __tests__/services/createModelTraining.test.ts:105:28\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["createModelTraining"],"duration":324,"failureMessages":[],"fullName":"createModelTraining throws error if file does not exist","status":"passed","title":"throws error if file does not exist"},{"ancestorTitles":["createModelTraining"],"duration":62,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'data')\n    at data (/Users/playom/999-multibots-telegraf/src/services/createModelTraining.ts:71:54)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"createModelTraining posts form data to create-model-training endpoint and unlinks file","status":"failed","title":"posts form data to create-model-training endpoint and unlinks file"},{"ancestorTitles":["createModelTraining"],"duration":60,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'data')\n    at data (/Users/playom/999-multibots-telegraf/src/services/createModelTraining.ts:71:54)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"createModelTraining uses create-model-training-v2 for other mode","status":"failed","title":"uses create-model-training-v2 for other mode"},{"ancestorTitles":["createModelTraining"],"duration":125,"failureMessages":["Error: expect(received).rejects.toThrow(expected)\n\nExpected substring: \"net fail\"\nReceived message:   \"Cannot read properties of undefined (reading 'data')\"\n\n      69 |\n      70 |     await fs.promises.unlink(requestData.filePath)\n    > 71 |     console.log('Model training response:', response.data)\n         |                                                      ^\n      72 |     return response.data\n      73 |   } catch (error) {\n      74 |     // if (axios.isAxiosError(error)) {\n\n      at data (src/services/createModelTraining.ts:71:54)\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at Object.toThrow (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n    at /Users/playom/999-multibots-telegraf/__tests__/services/createModelTraining.test.ts:75:15\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/services/createModelTraining.test.ts:71:69)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"createModelTraining propagates axios errors and does not unlink file","status":"failed","title":"propagates axios errors and does not unlink file"},{"ancestorTitles":["createModelTraining"],"duration":53,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"https://ele.stio/generate/create-model-training\", Any<FormData>, ObjectContaining {\"headers\": ObjectContaining {\"x-secret-key\": \"secret-key\"}}\nReceived: \"https://ele.stio/generate/create-model-training\", {\"_boundary\": \"--------------------------823346246969332150562399\", \"_currentStream\": null, \"_insideLoop\": false, \"_overheadLength\": 851, \"_pendingNext\": false, \"_released\": false, \"_streams\": [\"----------------------------823346246969332150562399·\nContent-Disposition: form-data; name=\\\"type\\\"···\n\", \"model\", [Function bound ], \"----------------------------823346246969332150562399·\nContent-Disposition: form-data; name=\\\"telegram_id\\\"···\n\", \"u\", [Function bound ], \"----------------------------823346246969332150562399·\nContent-Disposition: form-data; name=\\\"zipUrl\\\"···\n\", \"<stream>\", [Function bound ], \"----------------------------823346246969332150562399·\nContent-Disposition: form-data; name=\\\"triggerWord\\\"···\n\", …], \"_valueLength\": 22, \"_valuesToMeasure\": [], \"dataSize\": 0, \"maxDataSize\": 2097152, \"pauseStreams\": true, \"readable\": true, \"writable\": false}, {\"headers\": {\"Content-Type\": \"multipart/form-data\", \"content-type\": \"multipart/form-data; boundary=--------------------------823346246969332150562399\", \"x-secret-key\": \"secret-key\"}}\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/services/createModelTraining.test.ts:105:28\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"createModelTraining uses ELESTIO_URL when in production mode","status":"failed","title":"uses ELESTIO_URL when in production mode"}]},{"numFailingTests":4,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172272956,"runtime":4070,"slow":false,"start":1745172268886},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/textToImageWizard.test.ts","failureMessage":"  ● textToImageWizard steps › step 0: leaves when no user ID\n\n    TypeError: step0 is not a function\n\n      91 |     // @ts-ignore - убираем ctx.from = undefined\n      92 |\n    > 93 |     await step0(ctx, mockNext)\n         |           ^\n      94 |\n      95 |     expect(ctx.reply).toHaveBeenCalledWith('❌ Не удалось определить пользователя')\n      96 |     expect(ctx.scene.leave).toHaveBeenCalled()\n\n      at __tests__/scenes/textToImageWizard.test.ts:93:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/textToImageWizard.test.ts:87:51)\n\n  ● textToImageWizard steps › step 0: prompts and advances\n\n    TypeError: step0 is not a function\n\n      102 |     ctx = makeMockContext({ message: { from: mockFrom } }, sessionData, { botInfo: mockBotInfo })\n      103 |\n    > 104 |     await step0(ctx, mockNext)\n          |           ^\n      105 |\n      106 |     expect(ctx.reply).toHaveBeenCalledWith(\n      107 |       '🎨 Выберите модель для генерации:',\n\n      at __tests__/scenes/textToImageWizard.test.ts:104:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/textToImageWizard.test.ts:99:49)\n\n  ● textToImageWizard steps › step 2: invalid prompt leaves\n\n    TypeError: step2 is not a function\n\n      117 |     // @ts-ignore - убираем ctx.message = {} as any\n      118 |\n    > 119 |     await step2(ctx, mockNext)\n          |           ^\n      120 |\n      121 |     expect(ctx.reply).toHaveBeenCalledWith('❌ Некорректный промпт')\n      122 |     expect(ctx.scene.leave).toHaveBeenCalled()\n\n      at __tests__/scenes/textToImageWizard.test.ts:119:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/textToImageWizard.test.ts:113:50)\n\n  ● textToImageWizard steps › step 2: valid prompt generates image and leaves\n\n    TypeError: step2 is not a function\n\n      130 |     mockedGenerateTextToImage.mockResolvedValue(undefined)\n      131 |\n    > 132 |     await step2(ctx, mockNext)\n          |           ^\n      133 |\n      134 |     expect(mockedGenerateTextToImage).toHaveBeenCalledWith(\n      135 |       'hello',\n\n      at __tests__/scenes/textToImageWizard.test.ts:132:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/textToImageWizard.test.ts:126:68)\n","testResults":[{"ancestorTitles":["textToImageWizard steps"],"duration":3,"failureMessages":["TypeError: step0 is not a function\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/textToImageWizard.test.ts:93:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/textToImageWizard.test.ts:87:51)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"textToImageWizard steps step 0: leaves when no user ID","status":"failed","title":"step 0: leaves when no user ID"},{"ancestorTitles":["textToImageWizard steps"],"duration":0,"failureMessages":["TypeError: step0 is not a function\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/textToImageWizard.test.ts:104:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/textToImageWizard.test.ts:99:49)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"textToImageWizard steps step 0: prompts and advances","status":"failed","title":"step 0: prompts and advances"},{"ancestorTitles":["textToImageWizard steps"],"duration":0,"failureMessages":["TypeError: step2 is not a function\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/textToImageWizard.test.ts:119:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/textToImageWizard.test.ts:113:50)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"textToImageWizard steps step 2: invalid prompt leaves","status":"failed","title":"step 2: invalid prompt leaves"},{"ancestorTitles":["textToImageWizard steps"],"duration":36,"failureMessages":["TypeError: step2 is not a function\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/textToImageWizard.test.ts:132:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/textToImageWizard.test.ts:126:68)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"textToImageWizard steps step 2: valid prompt generates image and leaves","status":"failed","title":"step 2: valid prompt generates image and leaves"}]},{"numFailingTests":0,"numPassingTests":9,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172274589,"runtime":4849,"slow":false,"start":1745172269740},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/payments/robokassaWebhook.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["handleRobokassaWebhook"],"duration":21,"failureMessages":[],"fullName":"handleRobokassaWebhook should process a valid webhook successfully","status":"passed","title":"should process a valid webhook successfully"},{"ancestorTitles":["handleRobokassaWebhook"],"duration":2,"failureMessages":[],"fullName":"handleRobokassaWebhook should return 400 if signature is invalid","status":"passed","title":"should return 400 if signature is invalid"},{"ancestorTitles":["handleRobokassaWebhook"],"duration":159,"failureMessages":[],"fullName":"handleRobokassaWebhook should return 200 if payment is not found (PENDING) but COMPLETED exists","status":"passed","title":"should return 200 if payment is not found (PENDING) but COMPLETED exists"},{"ancestorTitles":["handleRobokassaWebhook"],"duration":5,"failureMessages":[],"fullName":"handleRobokassaWebhook should return 200 if payment is not found (PENDING and COMPLETED)","status":"passed","title":"should return 200 if payment is not found (PENDING and COMPLETED)"},{"ancestorTitles":["handleRobokassaWebhook"],"duration":18,"failureMessages":[],"fullName":"handleRobokassaWebhook should return 500 if database error occurs during PENDING payment fetch","status":"passed","title":"should return 500 if database error occurs during PENDING payment fetch"},{"ancestorTitles":["handleRobokassaWebhook"],"duration":2,"failureMessages":[],"fullName":"handleRobokassaWebhook should return 400 if amount mismatches","status":"passed","title":"should return 400 if amount mismatches"},{"ancestorTitles":["handleRobokassaWebhook"],"duration":6,"failureMessages":[],"fullName":"handleRobokassaWebhook should return 500 if database error occurs during payment status update","status":"passed","title":"should return 500 if database error occurs during payment status update"},{"ancestorTitles":["handleRobokassaWebhook"],"duration":2,"failureMessages":[],"fullName":"handleRobokassaWebhook should return 200 (but log CRITICAL) if database error occurs during user balance update","status":"passed","title":"should return 200 (but log CRITICAL) if database error occurs during user balance update"},{"ancestorTitles":["handleRobokassaWebhook"],"duration":1,"failureMessages":[],"fullName":"handleRobokassaWebhook should handle missing shp_ parameters in query","status":"passed","title":"should handle missing shp_ parameters in query"}]},{"numFailingTests":3,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172274582,"runtime":2146,"slow":false,"start":1745172272436},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getReferalsCountAndUserData.test.ts","failureMessage":"  ● getReferalsCountAndUserData › returns default when user lookup fails\n\n    expect(received).toEqual(expected) // deep equality\n\n    - Expected  - 1\n    + Received  + 1\n\n      Object {\n        \"count\": 0,\n        \"isExist\": false,\n        \"level\": 0,\n    -   \"subscription\": \"stars\",\n    +   \"subscriptionType\": \"stars\",\n        \"userData\": null,\n      }\n\n      30 |     mockBuilderUser.single.mockResolvedValue({ data: null, error: { message: 'fail' } })\n      31 |     const res = await getReferalsCountAndUserData(telegram_id)\n    > 32 |     expect(res).toEqual({ count: 0, subscription: 'stars', level: 0, userData: null, isExist: false })\n         |                 ^\n      33 |   })\n      34 |\n      35 |   it('returns default when referral query errors', async () => {\n\n      at Object.<anonymous> (__tests__/core/supabase/getReferalsCountAndUserData.test.ts:32:17)\n      at fulfilled (__tests__/core/supabase/getReferalsCountAndUserData.test.ts:4:58)\n\n  ● getReferalsCountAndUserData › returns default when referral query errors\n\n    expect(received).toEqual(expected) // deep equality\n\n    - Expected  - 4\n    + Received  + 8\n\n      Object {\n        \"count\": 0,\n    -   \"isExist\": false,\n    -   \"level\": 0,\n    -   \"subscription\": \"stars\",\n    -   \"userData\": null,\n    +   \"isExist\": true,\n    +   \"level\": 5,\n    +   \"subscriptionType\": \"stars\",\n    +   \"userData\": Object {\n    +     \"level\": 5,\n    +     \"subscription\": \"premium\",\n    +     \"user_id\": \"u1\",\n    +   },\n      }\n\n      39 |     mockBuilderRef.eq.mockReturnValue(Promise.resolve({ data: null, error: { message: 'fail' } }))\n      40 |     const res = await getReferalsCountAndUserData(telegram_id)\n    > 41 |     expect(res).toEqual({ count: 0, subscription: 'stars', level: 0, userData: null, isExist: false })\n         |                 ^\n      42 |   })\n      43 |\n      44 |   it('returns correct count and user data on success', async () => {\n\n      at Object.<anonymous> (__tests__/core/supabase/getReferalsCountAndUserData.test.ts:41:17)\n      at fulfilled (__tests__/core/supabase/getReferalsCountAndUserData.test.ts:4:58)\n\n  ● getReferalsCountAndUserData › returns correct count and user data on success\n\n    expect(received).toEqual(expected) // deep equality\n\n    - Expected  - 1\n    + Received  + 1\n\n    @@ -1,10 +1,10 @@\n      Object {\n        \"count\": 2,\n        \"isExist\": true,\n        \"level\": 5,\n    -   \"subscription\": \"premium\",\n    +   \"subscriptionType\": \"stars\",\n        \"userData\": Object {\n          \"level\": 5,\n          \"subscription\": \"premium\",\n          \"user_id\": \"u1\",\n        },\n\n      46 |     mockBuilderRef.eq.mockReturnValue(Promise.resolve({ data: refs, error: null }))\n      47 |     const res = await getReferalsCountAndUserData(telegram_id)\n    > 48 |     expect(res).toEqual({\n         |                 ^\n      49 |       count: refs.length,\n      50 |       level: userData.level,\n      51 |       subscription: userData.subscription,\n\n      at Object.<anonymous> (__tests__/core/supabase/getReferalsCountAndUserData.test.ts:48:17)\n      at fulfilled (__tests__/core/supabase/getReferalsCountAndUserData.test.ts:4:58)\n","testResults":[{"ancestorTitles":["getReferalsCountAndUserData"],"duration":44,"failureMessages":["Error: expect(received).toEqual(expected) // deep equality\n\n- Expected  - 1\n+ Received  + 1\n\n  Object {\n    \"count\": 0,\n    \"isExist\": false,\n    \"level\": 0,\n-   \"subscription\": \"stars\",\n+   \"subscriptionType\": \"stars\",\n    \"userData\": null,\n  }\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getReferalsCountAndUserData.test.ts:32:17)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getReferalsCountAndUserData.test.ts:4:58)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"getReferalsCountAndUserData returns default when user lookup fails","status":"failed","title":"returns default when user lookup fails"},{"ancestorTitles":["getReferalsCountAndUserData"],"duration":294,"failureMessages":["Error: expect(received).toEqual(expected) // deep equality\n\n- Expected  - 4\n+ Received  + 8\n\n  Object {\n    \"count\": 0,\n-   \"isExist\": false,\n-   \"level\": 0,\n-   \"subscription\": \"stars\",\n-   \"userData\": null,\n+   \"isExist\": true,\n+   \"level\": 5,\n+   \"subscriptionType\": \"stars\",\n+   \"userData\": Object {\n+     \"level\": 5,\n+     \"subscription\": \"premium\",\n+     \"user_id\": \"u1\",\n+   },\n  }\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getReferalsCountAndUserData.test.ts:41:17)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getReferalsCountAndUserData.test.ts:4:58)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"getReferalsCountAndUserData returns default when referral query errors","status":"failed","title":"returns default when referral query errors"},{"ancestorTitles":["getReferalsCountAndUserData"],"duration":135,"failureMessages":["Error: expect(received).toEqual(expected) // deep equality\n\n- Expected  - 1\n+ Received  + 1\n\n@@ -1,10 +1,10 @@\n  Object {\n    \"count\": 2,\n    \"isExist\": true,\n    \"level\": 5,\n-   \"subscription\": \"premium\",\n+   \"subscriptionType\": \"stars\",\n    \"userData\": Object {\n      \"level\": 5,\n      \"subscription\": \"premium\",\n      \"user_id\": \"u1\",\n    },\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getReferalsCountAndUserData.test.ts:48:17)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getReferalsCountAndUserData.test.ts:4:58)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"getReferalsCountAndUserData returns correct count and user data on success","status":"failed","title":"returns correct count and user data on success"}]},{"numFailingTests":2,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172275759,"runtime":1074,"slow":false,"start":1745172274685},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getLatestUserModel.unit.test.ts","failureMessage":"  ● getLatestUserModel › returns null on error\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    - Expected\n    + Received\n\n      \"Error getting user model:\",\n    - Object {\n    -   \"message\": \"err\",\n    - }\n    + [TypeError: supabase_1.supabase.from(...).select(...).eq is not a function],\n\n    Number of calls: 1\n\n      19 |     const result = await getLatestUserModel(telegram_id, api)\n      20 |     expect(result).toBeNull()\n    > 21 |     expect(consoleErrorSpy).toHaveBeenCalledWith('Error getting user model:', { message: 'err' })\n         |                             ^\n      22 |     consoleErrorSpy.mockRestore()\n      23 |   })\n      24 |\n\n      at __tests__/core/supabase/getLatestUserModel.unit.test.ts:21:29\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● getLatestUserModel › returns data on success\n\n    expect(received).toEqual(expected) // deep equality\n\n    Expected: {\"api\": \"apiX\", \"id\": \"x\", \"status\": \"SUCCESS\", \"telegram_id\": 10}\n    Received: null\n\n      30 |     const consoleLogSpy = jest.spyOn(console, 'log').mockImplementation(() => {})\n      31 |     const result = await getLatestUserModel(telegram_id, api)\n    > 32 |     expect(result).toEqual(modelTraining)\n         |                    ^\n      33 |     expect(consoleLogSpy).toHaveBeenCalledWith(modelTraining, 'getLatestUserModel')\n      34 |     consoleLogSpy.mockRestore()\n      35 |   })\n\n      at __tests__/core/supabase/getLatestUserModel.unit.test.ts:32:20\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["getLatestUserModel"],"duration":5,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n- Expected\n+ Received\n\n  \"Error getting user model:\",\n- Object {\n-   \"message\": \"err\",\n- }\n+ [TypeError: supabase_1.supabase.from(...).select(...).eq is not a function],\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/getLatestUserModel.unit.test.ts:21:29\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"getLatestUserModel returns null on error","status":"failed","title":"returns null on error"},{"ancestorTitles":["getLatestUserModel"],"duration":1,"failureMessages":["Error: expect(received).toEqual(expected) // deep equality\n\nExpected: {\"api\": \"apiX\", \"id\": \"x\", \"status\": \"SUCCESS\", \"telegram_id\": 10}\nReceived: null\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/getLatestUserModel.unit.test.ts:32:20\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"getLatestUserModel returns data on success","status":"failed","title":"returns data on success"},{"ancestorTitles":["getLatestUserModel"],"duration":1,"failureMessages":[],"fullName":"getLatestUserModel returns null on exception","status":"passed","title":"returns null on exception"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172275801,"runtime":1175,"slow":false,"start":1745172274626},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/elevenlabs/index.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["core/elevenlabs client creation"],"duration":32,"failureMessages":[],"fullName":"core/elevenlabs client creation uses mock client when API key is not set","status":"passed","title":"uses mock client when API key is not set"},{"ancestorTitles":["core/elevenlabs client creation"],"duration":118,"failureMessages":[],"fullName":"core/elevenlabs client creation uses real client when API key is set and module exists","status":"passed","title":"uses real client when API key is set and module exists"},{"ancestorTitles":["core/elevenlabs client creation"],"duration":9,"failureMessages":[],"fullName":"core/elevenlabs client creation falls back to mock client when real client creation throws","status":"passed","title":"falls back to mock client when real client creation throws"}]},{"numFailingTests":2,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172275460,"runtime":5538,"slow":true,"start":1745172269922},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/textToSpeechWizard.test.ts","failureMessage":"  ● textToSpeechWizard › step 0: prompts and calls next()\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"🎙️ Отправьте текст, для преобразования его в голос\"\n    Received: \"🎙️ Отправьте текст, для преобразования его в голос\", {\"reply_markup\": {\"keyboard\": [[\"Справка по команде\"], [\"Отмена\"]], \"resize_keyboard\": true}}\n\n    Number of calls: 1\n\n      31 |     await step0(ctx, async () => {})\n      32 |     expect(isRussianSpy).toHaveBeenCalledWith(ctx)\n    > 33 |     expect(ctx.reply).toHaveBeenCalledWith(\n         |                       ^\n      34 |       '🎙️ Отправьте текст, для преобразования его в голос'\n      35 |     )\n      36 |   })\n\n      at __tests__/scenes/textToSpeechWizard.test.ts:33:23\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● textToSpeechWizard › step 1: no text message prompts ask\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"✍️ Please send text\"\n    Received: \"🎯 For correct operation, train the avatar using 🎤 Voice for avatar in the main menu\"\n\n    Number of calls: 1\n\n      43 |     await step1(ctx, async () => {})\n      44 |     expect(isRussianSpy).toHaveBeenCalledWith(ctx)\n    > 45 |     expect(ctx.reply).toHaveBeenCalledWith('✍️ Please send text')\n         |                       ^\n      46 |   })\n      47 |\n      48 |   it('step 1: cancel leaves scene', async () => {\n\n      at __tests__/scenes/textToSpeechWizard.test.ts:45:23\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["textToSpeechWizard"],"duration":15,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"🎙️ Отправьте текст, для преобразования его в голос\"\nReceived: \"🎙️ Отправьте текст, для преобразования его в голос\", {\"reply_markup\": {\"keyboard\": [[\"Справка по команде\"], [\"Отмена\"]], \"resize_keyboard\": true}}\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/textToSpeechWizard.test.ts:33:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"textToSpeechWizard step 0: prompts and calls next()","status":"failed","title":"step 0: prompts and calls next()"},{"ancestorTitles":["textToSpeechWizard"],"duration":623,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"✍️ Please send text\"\nReceived: \"🎯 For correct operation, train the avatar using 🎤 Voice for avatar in the main menu\"\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/textToSpeechWizard.test.ts:45:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"textToSpeechWizard step 1: no text message prompts ask","status":"failed","title":"step 1: no text message prompts ask"},{"ancestorTitles":["textToSpeechWizard"],"duration":15,"failureMessages":[],"fullName":"textToSpeechWizard step 1: cancel leaves scene","status":"passed","title":"step 1: cancel leaves scene"},{"ancestorTitles":["textToSpeechWizard"],"duration":4,"failureMessages":[],"fullName":"textToSpeechWizard step 1: no voice_id prompts training message and leaves","status":"passed","title":"step 1: no voice_id prompts training message and leaves"},{"ancestorTitles":["textToSpeechWizard"],"duration":9,"failureMessages":[],"fullName":"textToSpeechWizard step 1: generates text to speech and leaves","status":"passed","title":"step 1: generates text to speech and leaves"}]},{"numFailingTests":1,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172276148,"runtime":2361,"slow":false,"start":1745172273787},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/services/generateNeuroImage.prod.test.ts","failureMessage":"  ● generateNeuroImage production branch › uses ELESTIO_URL when isDev is false\n\n    expect(received).toEqual(expected) // deep equality\n\n    Expected: {\"data\": \"prodOK\"}\n    Received: null\n\n      20 |     const ctx = { session: { prompt: 'p', userModel: 'm' }, from: { username: 'u' }, reply: jest.fn() }\n      21 |     const res = await generateNeuroImage('prompt', 'modelUrl', 1, 'tid', ctx, 'bot')\n    > 22 |     expect(res).toEqual({ data: 'prodOK' })\n         |                 ^\n      23 |     expect(axios.post).toHaveBeenCalledWith(\n      24 |       'https://api.example.com/generate/neuro-photo',\n      25 |       expect.any(Object),\n\n      at Object.<anonymous> (__tests__/services/generateNeuroImage.prod.test.ts:22:17)\n      at fulfilled (__tests__/services/generateNeuroImage.prod.test.ts:4:58)\n","testResults":[{"ancestorTitles":["generateNeuroImage production branch"],"duration":184,"failureMessages":["Error: expect(received).toEqual(expected) // deep equality\n\nExpected: {\"data\": \"prodOK\"}\nReceived: null\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/services/generateNeuroImage.prod.test.ts:22:17)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/__tests__/services/generateNeuroImage.prod.test.ts:4:58)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"generateNeuroImage production branch uses ELESTIO_URL when isDev is false","status":"failed","title":"uses ELESTIO_URL when isDev is false"}]},{"numFailingTests":4,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172276172,"runtime":4189,"slow":false,"start":1745172271983},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/sizeWizard.test.ts","failureMessage":"  ● sizeWizard steps › step 0: prompts for image size and advances\n\n    TypeError: step0 is not a function\n\n      67 |     mockedIsRussian.mockReturnValueOnce(true)\n      68 |\n    > 69 |     await step0(ctx, mockNext)\n         |           ^\n      70 |\n      71 |     expect(ctx.reply).toHaveBeenCalledWith(\n      72 |       'Выберите размер изображения:',\n\n      at __tests__/scenes/sizeWizard.test.ts:69:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/sizeWizard.test.ts:64:64)\n\n  ● sizeWizard steps › step 1: leaves when no message\n\n    TypeError: step1 is not a function\n\n      82 |     // @ts-ignore - Убираем ctx.message = undefined\n      83 |\n    > 84 |     await step1(ctx, mockNext)\n         |           ^\n      85 |\n      86 |     expect(mockedHandleSizeSelection).not.toHaveBeenCalled()\n      87 |     expect(ctx.scene.leave).toHaveBeenCalled()\n\n      at __tests__/scenes/sizeWizard.test.ts:84:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/sizeWizard.test.ts:78:51)\n\n  ● sizeWizard steps › step 1: rejects invalid size and stays\n\n    TypeError: step1 is not a function\n\n      94 |     mockedIsRussian.mockReturnValueOnce(true)\n      95 |\n    > 96 |     await step1(ctx, mockNext)\n         |           ^\n      97 |\n      98 |     expect(ctx.reply).toHaveBeenCalledWith(\n      99 |       expect.stringContaining('Неверный размер')\n\n      at __tests__/scenes/sizeWizard.test.ts:96:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/sizeWizard.test.ts:90:59)\n\n  ● sizeWizard steps › step 1: handles valid size and leaves\n\n    TypeError: step1 is not a function\n\n      109 |     mockedIsRussian.mockReturnValueOnce(false)\n      110 |\n    > 111 |     await step1(ctx, mockNext)\n          |           ^\n      112 |\n      113 |     expect(mockedHandleSizeSelection).toHaveBeenCalledWith(ctx, '16:9')\n      114 |     expect(ctx.scene.leave).toHaveBeenCalled()\n\n      at __tests__/scenes/sizeWizard.test.ts:111:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/sizeWizard.test.ts:105:58)\n","testResults":[{"ancestorTitles":["sizeWizard steps"],"duration":1,"failureMessages":["TypeError: step0 is not a function\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/sizeWizard.test.ts:69:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/sizeWizard.test.ts:64:64)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"sizeWizard steps step 0: prompts for image size and advances","status":"failed","title":"step 0: prompts for image size and advances"},{"ancestorTitles":["sizeWizard steps"],"duration":0,"failureMessages":["TypeError: step1 is not a function\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/sizeWizard.test.ts:84:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/sizeWizard.test.ts:78:51)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"sizeWizard steps step 1: leaves when no message","status":"failed","title":"step 1: leaves when no message"},{"ancestorTitles":["sizeWizard steps"],"duration":0,"failureMessages":["TypeError: step1 is not a function\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/sizeWizard.test.ts:96:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/sizeWizard.test.ts:90:59)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"sizeWizard steps step 1: rejects invalid size and stays","status":"failed","title":"step 1: rejects invalid size and stays"},{"ancestorTitles":["sizeWizard steps"],"duration":1,"failureMessages":["TypeError: step1 is not a function\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/sizeWizard.test.ts:111:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/sizeWizard.test.ts:105:58)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"sizeWizard steps step 1: handles valid size and leaves","status":"failed","title":"step 1: handles valid size and leaves"}]},{"numFailingTests":6,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172277149,"runtime":5863,"slow":true,"start":1745172271286},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/subscriptionScene.test.ts","failureMessage":"  ● subscriptionScene › step 0: displays subscription info and options\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"HTML\"\n    Received: \"Markdown\"\n\n      32 |       : [ctx.debug.replies[0].message, {}]\n      33 |     expect(typeof text).toBe('string')\n    > 34 |     expect(opts.parse_mode).toBe('HTML')\n         |                             ^\n      35 |     expect(opts.reply_markup).toBeDefined()\n      36 |     expect(ctx.wizard.next).toHaveBeenCalled()\n      37 |   })\n\n      at __tests__/scenes/subscriptionScene.test.ts:34:29\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● subscriptionScene › step 0: handles error during data fetch\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"Error displaying tariffs.\"\n    Received: \"💫 Для получения полного доступа ко всем нейрокомандам, выберите одну из предложенных месячных подписок:·\n    📸 НейроФото - Цена: 1110 ₽\n    - Самостоятельное обучение по нейросетям с ИИ аватаром\n    - Учитесь в удобное время\n    - Включает видеоуроки, текстовые материалы\n    - Поддержка и актуальные технологии\n    - Доступ к чату с ментором\n    - 476 звезды на баланс бота·\n    📚 НейроБаза - Цена: 2999 ₽\n    - 📖 Уроки по нейросетям·\n    - 📸 Нейрофото·\n    - 🎥 Генерация видео·\n    - 🗣️ Озвучка Аватара·\n    - 🔧 Поддержка куратора·\n    - 💬 Доступ к чату с ментором\n    - 1303 звезд на баланс бота\n    \", {\"parse_mode\": \"Markdown\", \"reply_markup\": {\"inline_keyboard\": [[{\"callback_data\": \"neurophoto\", \"remove_keyboard\": true, \"text\": \"🎨 НейроФото - 10 $\"}], [{\"callback_data\": \"neurobase\", \"remove_keyboard\": true, \"text\": \"📚 НейроБаза - 33 $\"}]]}}\n\n    Number of calls: 1\n\n      51 |     await step0(ctx, async () => {})\n      52 |     // После ошибки должен быть отправлен текст об ошибке и exit\n    > 53 |     expect(ctx.reply).toHaveBeenCalledWith('Error displaying tariffs.')\n         |                       ^\n      54 |     expect(ctx.scene.leave).toHaveBeenCalled()\n      55 |   })\n      56 |\n\n      at __tests__/scenes/subscriptionScene.test.ts:53:23\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● subscriptionScene › step 1: processes valid callback data\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"neurobase\"\n    Received: \"NEUROBASE\"\n\n      63 |     const step1 = Composer.unwrap(subscriptionScene.steps[1])\n      64 |     await step1(ctx, async () => {})\n    > 65 |     expect(ctx.session.subscription).toBe('neurobase')\n         |                                      ^\n      66 |     expect(ctx.scene.enter).toHaveBeenCalledWith('paymentScene')\n      67 |   })\n      68 |\n\n      at __tests__/scenes/subscriptionScene.test.ts:65:38\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● subscriptionScene › step 1: leaves scene on mainmenu callback\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"menuScene\"\n    Received: \"main_menu\"\n\n    Number of calls: 1\n\n      75 |     const step1 = Composer.unwrap(subscriptionScene.steps[1])\n      76 |     await step1(ctx, async () => {})\n    > 77 |     expect(ctx.scene.enter).toHaveBeenCalledWith('menuScene')\n         |                             ^\n      78 |   })\n      79 |\n      80 |   it('step 1: replies on unknown callback data', async () => {\n\n      at __tests__/scenes/subscriptionScene.test.ts:77:29\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● subscriptionScene › step 1: replies on unknown callback data\n\n    expect(jest.fn()).toHaveBeenCalled()\n\n    Expected number of calls: >= 1\n    Received number of calls:    0\n\n      86 |     const step1 = Composer.unwrap(subscriptionScene.steps[1])\n      87 |     await step1(ctx, async () => {})\n    > 88 |     expect(ctx.answerCbQuery).toHaveBeenCalled()\n         |                               ^\n      89 |     expect(ctx.reply).toHaveBeenCalledWith(\n      90 |       'Неизвестный выбор. Пожалуйста, используйте кнопки.'\n      91 |     )\n\n      at __tests__/scenes/subscriptionScene.test.ts:88:31\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● subscriptionScene › step 1: handles message instead of callback\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"Please select a tariff using the buttons.\"\n\n    Number of calls: 0\n\n      101 |     const step1 = Composer.unwrap(subscriptionScene.steps[1])\n      102 |     await step1(ctx, async () => {})\n    > 103 |     expect(ctx.reply).toHaveBeenCalledWith(\n          |                       ^\n      104 |       'Please select a tariff using the buttons.'\n      105 |     )\n      106 |     expect(ctx.scene.leave).toHaveBeenCalled()\n\n      at __tests__/scenes/subscriptionScene.test.ts:103:23\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["subscriptionScene"],"duration":305,"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: \"HTML\"\nReceived: \"Markdown\"\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/subscriptionScene.test.ts:34:29\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"subscriptionScene step 0: displays subscription info and options","status":"failed","title":"step 0: displays subscription info and options"},{"ancestorTitles":["subscriptionScene"],"duration":307,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"Error displaying tariffs.\"\nReceived: \"💫 Для получения полного доступа ко всем нейрокомандам, выберите одну из предложенных месячных подписок:·\n📸 НейроФото - Цена: 1110 ₽\n- Самостоятельное обучение по нейросетям с ИИ аватаром\n- Учитесь в удобное время\n- Включает видеоуроки, текстовые материалы\n- Поддержка и актуальные технологии\n- Доступ к чату с ментором\n- 476 звезды на баланс бота·\n📚 НейроБаза - Цена: 2999 ₽\n- 📖 Уроки по нейросетям·\n- 📸 Нейрофото·\n- 🎥 Генерация видео·\n- 🗣️ Озвучка Аватара·\n- 🔧 Поддержка куратора·\n- 💬 Доступ к чату с ментором\n- 1303 звезд на баланс бота\n\", {\"parse_mode\": \"Markdown\", \"reply_markup\": {\"inline_keyboard\": [[{\"callback_data\": \"neurophoto\", \"remove_keyboard\": true, \"text\": \"🎨 НейроФото - 10 $\"}], [{\"callback_data\": \"neurobase\", \"remove_keyboard\": true, \"text\": \"📚 НейроБаза - 33 $\"}]]}}\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/subscriptionScene.test.ts:53:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"subscriptionScene step 0: handles error during data fetch","status":"failed","title":"step 0: handles error during data fetch"},{"ancestorTitles":["subscriptionScene"],"duration":22,"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: \"neurobase\"\nReceived: \"NEUROBASE\"\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/subscriptionScene.test.ts:65:38\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"subscriptionScene step 1: processes valid callback data","status":"failed","title":"step 1: processes valid callback data"},{"ancestorTitles":["subscriptionScene"],"duration":20,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"menuScene\"\nReceived: \"main_menu\"\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/subscriptionScene.test.ts:77:29\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"subscriptionScene step 1: leaves scene on mainmenu callback","status":"failed","title":"step 1: leaves scene on mainmenu callback"},{"ancestorTitles":["subscriptionScene"],"duration":64,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalled()\n\nExpected number of calls: >= 1\nReceived number of calls:    0\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/subscriptionScene.test.ts:88:31\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"subscriptionScene step 1: replies on unknown callback data","status":"failed","title":"step 1: replies on unknown callback data"},{"ancestorTitles":["subscriptionScene"],"duration":28,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"Please select a tariff using the buttons.\"\n\nNumber of calls: 0\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/subscriptionScene.test.ts:103:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"subscriptionScene step 1: handles message instead of callback","status":"failed","title":"step 1: handles message instead of callback"}]},{"numFailingTests":1,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172277611,"runtime":1779,"slow":false,"start":1745172275832},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/setupLevelHandlers.test.ts","failureMessage":"  ● setupLevelHandlers › registers 12 actions for levels and completion\n\n    expect(jest.fn()).toHaveBeenCalledTimes(expected)\n\n    Expected number of calls: 12\n    Received number of calls: 14\n\n      25 |       'level_complete',\n      26 |     ]\n    > 27 |     expect(bot.action).toHaveBeenCalledTimes(expectedActions.length)\n         |                        ^\n      28 |     expectedActions.forEach((action, idx) => {\n      29 |       expect(bot.action).toHaveBeenNthCalledWith(\n      30 |         idx + 1,\n\n      at Object.<anonymous> (__tests__/handlers/setupLevelHandlers.test.ts:27:24)\n","testResults":[{"ancestorTitles":["setupLevelHandlers"],"duration":3,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledTimes(expected)\n\nExpected number of calls: 12\nReceived number of calls: 14\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/handlers/setupLevelHandlers.test.ts:27:24)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"setupLevelHandlers registers 12 actions for levels and completion","status":"failed","title":"registers 12 actions for levels and completion"}]},{"numFailingTests":3,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172278034,"runtime":1565,"slow":false,"start":1745172276469},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/sendPaymentInfo.test.ts","failureMessage":"  ● sendPaymentInfo › returns data when insert succeeds\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"payments\"\n    Received: \"payments_v2\"\n\n    Number of calls: 1\n\n      32 |     builder.single.mockResolvedValueOnce({ data: dataObj, error: null })\n      33 |     const result = await sendPaymentInfo('u1', 'gold')\n    > 34 |     expect(mockFrom).toHaveBeenCalledWith('payments')\n         |                      ^\n      35 |     expect(builder.insert).toHaveBeenCalledWith([{ user_id: 'u1', level: 'gold' }])\n      36 |     expect(builder.single).toHaveBeenCalled()\n      37 |     expect(consoleLog).toHaveBeenCalledWith('Payment info sent successfully:', dataObj)\n\n      at Object.<anonymous> (__tests__/core/supabase/sendPaymentInfo.test.ts:34:22)\n      at fulfilled (__tests__/core/supabase/sendPaymentInfo.test.ts:4:58)\n\n  ● sendPaymentInfo › throws error when insert returns error\n\n    expect(received).rejects.toThrow()\n\n    Received promise resolved instead of rejected\n    Resolved to value: false\n\n      42 |     const err = new Error('insert fail')\n      43 |     builder.single.mockResolvedValueOnce({ data: null, error: err })\n    > 44 |     await expect(sendPaymentInfo('u2', 'silver')).rejects.toThrow(\n         |           ^\n      45 |       `Failed to send payment info: ${err.message}`\n      46 |     )\n      47 |     expect(consoleError).toHaveBeenCalledWith('Error sending payment info:', err)\n\n      at expect (node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:113:15)\n      at Object.<anonymous> (__tests__/core/supabase/sendPaymentInfo.test.ts:44:11)\n      at __tests__/core/supabase/sendPaymentInfo.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/core/supabase/sendPaymentInfo.test.ts:3:12)\n      at Object.<anonymous> (__tests__/core/supabase/sendPaymentInfo.test.ts:41:59)\n\n  ● sendPaymentInfo › throws error when no data returned\n\n    expect(received).rejects.toThrow()\n\n    Received promise resolved instead of rejected\n    Resolved to value: false\n\n      50 |   it('throws error when no data returned', async () => {\n      51 |     builder.single.mockResolvedValueOnce({ data: null, error: null })\n    > 52 |     await expect(sendPaymentInfo('u3', 'bronze')).rejects.toThrow(\n         |           ^\n      53 |       'No data returned after inserting payment info.'\n      54 |     )\n      55 |   })\n\n      at expect (node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:113:15)\n      at Object.<anonymous> (__tests__/core/supabase/sendPaymentInfo.test.ts:52:11)\n      at __tests__/core/supabase/sendPaymentInfo.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/core/supabase/sendPaymentInfo.test.ts:3:12)\n      at Object.<anonymous> (__tests__/core/supabase/sendPaymentInfo.test.ts:50:55)\n","testResults":[{"ancestorTitles":["sendPaymentInfo"],"duration":153,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"payments\"\nReceived: \"payments_v2\"\n\nNumber of calls: 1\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/sendPaymentInfo.test.ts:34:22)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/sendPaymentInfo.test.ts:4:58)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"sendPaymentInfo returns data when insert succeeds","status":"failed","title":"returns data when insert succeeds"},{"ancestorTitles":["sendPaymentInfo"],"duration":173,"failureMessages":["Error: expect(received).rejects.toThrow()\n\nReceived promise resolved instead of rejected\nResolved to value: false\n    at expect (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:113:15)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/sendPaymentInfo.test.ts:44:11)\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/sendPaymentInfo.test.ts:7:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/sendPaymentInfo.test.ts:3:12)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/sendPaymentInfo.test.ts:41:59)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"sendPaymentInfo throws error when insert returns error","status":"failed","title":"throws error when insert returns error"},{"ancestorTitles":["sendPaymentInfo"],"duration":127,"failureMessages":["Error: expect(received).rejects.toThrow()\n\nReceived promise resolved instead of rejected\nResolved to value: false\n    at expect (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:113:15)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/sendPaymentInfo.test.ts:52:11)\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/sendPaymentInfo.test.ts:7:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/sendPaymentInfo.test.ts:3:12)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/sendPaymentInfo.test.ts:50:55)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"sendPaymentInfo throws error when no data returned","status":"failed","title":"throws error when no data returned"}]},{"numFailingTests":2,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172277984,"runtime":2013,"slow":false,"start":1745172275971},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserBalance.unit.test.ts","failureMessage":"  ● getUserBalance Unit Tests › should throw error if user not found (simulated via rpc returning null data/error)\n\n    expect(received).rejects.toThrow()\n\n    Received promise resolved instead of rejected\n    Resolved to value: 0\n\n      40 |     mockedRpc.mockResolvedValue({ data: null, error: rpcError, count: null, status: 500, statusText: 'Internal Server Error' })\n      41 |\n    > 42 |     await expect(getUserBalance('123')).rejects.toThrow(\n         |                 ^\n      43 |       'Не удалось получить баланс пользователя: User balance function error'\n      44 |     )\n      45 |     expect(mockedRpc).toHaveBeenCalledWith('get_user_balance', {\n\n      at expect (node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:113:15)\n      at __tests__/core/supabase/getUserBalance.unit.test.ts:42:17\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/core/supabase/getUserBalance.unit.test.ts:36:103)\n\n  ● getUserBalance Unit Tests › should throw generic error for other Supabase RPC errors\n\n    expect(received).rejects.toThrow()\n\n    Received promise resolved instead of rejected\n    Resolved to value: 0\n\n      53 |     mockedRpc.mockResolvedValue({ data: null, error, count: null, status: 500, statusText: 'Internal Server Error' })\n      54 |\n    > 55 |     await expect(getUserBalance('456')).rejects.toThrow(\n         |                 ^\n      56 |       'Не удалось получить баланс пользователя: Generic DB error'\n      57 |     )\n      58 |     expect(mockedRpc).toHaveBeenCalledWith('get_user_balance', {\n\n      at expect (node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:113:15)\n      at __tests__/core/supabase/getUserBalance.unit.test.ts:55:17\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/core/supabase/getUserBalance.unit.test.ts:50:77)\n","testResults":[{"ancestorTitles":["getUserBalance Unit Tests"],"duration":4,"failureMessages":["Error: expect(received).rejects.toThrow()\n\nReceived promise resolved instead of rejected\nResolved to value: 0\n    at expect (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:113:15)\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserBalance.unit.test.ts:42:17\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserBalance.unit.test.ts:36:103)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"getUserBalance Unit Tests should throw error if user not found (simulated via rpc returning null data/error)","status":"failed","title":"should throw error if user not found (simulated via rpc returning null data/error)"},{"ancestorTitles":["getUserBalance Unit Tests"],"duration":1,"failureMessages":["Error: expect(received).rejects.toThrow()\n\nReceived promise resolved instead of rejected\nResolved to value: 0\n    at expect (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:113:15)\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserBalance.unit.test.ts:55:17\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserBalance.unit.test.ts:50:77)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"getUserBalance Unit Tests should throw generic error for other Supabase RPC errors","status":"failed","title":"should throw generic error for other Supabase RPC errors"},{"ancestorTitles":["getUserBalance Unit Tests"],"duration":4,"failureMessages":[],"fullName":"getUserBalance Unit Tests should return balance when user exists and balance is number","status":"passed","title":"should return balance when user exists and balance is number"},{"ancestorTitles":["getUserBalance Unit Tests"],"duration":12,"failureMessages":[],"fullName":"getUserBalance Unit Tests should return 0 when user exists but balance is null/undefined from rpc","status":"passed","title":"should return 0 when user exists but balance is null/undefined from rpc"},{"ancestorTitles":["getUserBalance Unit Tests"],"duration":21,"failureMessages":[],"fullName":"getUserBalance Unit Tests should return 0 when user exists but balance is 0 from rpc","status":"passed","title":"should return 0 when user exists but balance is 0 from rpc"}]},{"numFailingTests":4,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172278017,"runtime":1468,"slow":false,"start":1745172276549},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserBalance.test.ts","failureMessage":"  ● getUserBalance › should return balance for existing user\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 100\n    Received: 0\n\n      43 |\n      44 |     const balance = await getUserBalance('99')\n    > 45 |     expect(balance).toBe(100)\n         |                     ^\n      46 |     expect(mockedFrom).toHaveBeenCalledWith('users')\n      47 |     // Используем as any для обхода ошибки типа\n      48 |     expect((mockedFrom('users') as any).select).toHaveBeenCalledWith('balance') \n\n      at __tests__/core/supabase/getUserBalance.test.ts:45:21\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● getUserBalance › should return 0 if user has no balance field (or null)\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"telegram_id\", \"55\"\n\n    Number of calls: 0\n\n      56 |     const balance = await getUserBalance('55')\n      57 |     expect(balance).toBe(0)\n    > 58 |     expect(mockSelectReturn.eq).toHaveBeenCalledWith('telegram_id', '55')\n         |                                 ^\n      59 |   })\n      60 |\n      61 |   it('should throw error if user not found', async () => {\n\n      at __tests__/core/supabase/getUserBalance.test.ts:58:33\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● getUserBalance › should throw error if user not found\n\n    expect(received).rejects.toThrow()\n\n    Received promise resolved instead of rejected\n    Resolved to value: 0\n\n      62 |     mockEqReturn.single.mockResolvedValue({ data: null, error: null })\n      63 |\n    > 64 |     await expect(getUserBalance('1')).rejects.toThrow('Пользователь не найден')\n         |                 ^\n      65 |     expect(mockSelectReturn.eq).toHaveBeenCalledWith('telegram_id', '1')\n      66 |   })\n      67 |\n\n      at expect (node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:113:15)\n      at __tests__/core/supabase/getUserBalance.test.ts:64:17\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/core/supabase/getUserBalance.test.ts:61:57)\n\n  ● getUserBalance › should throw error if supabase query fails\n\n    expect(received).rejects.toThrow()\n\n    Received promise resolved instead of rejected\n    Resolved to value: 0\n\n      70 |     mockEqReturn.single.mockResolvedValue({ data: null, error })\n      71 |\n    > 72 |     await expect(getUserBalance('2')).rejects.toThrow('Не удалось получить баланс пользователя: Supabase error')\n         |                 ^\n      73 |     expect(mockSelectReturn.eq).toHaveBeenCalledWith('telegram_id', '2')\n      74 |   })\n      75 | })\n\n      at expect (node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:113:15)\n      at __tests__/core/supabase/getUserBalance.test.ts:72:17\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/core/supabase/getUserBalance.test.ts:68:63)\n","testResults":[{"ancestorTitles":["getUserBalance"],"duration":2,"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 100\nReceived: 0\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserBalance.test.ts:45:21\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"getUserBalance should return balance for existing user","status":"failed","title":"should return balance for existing user"},{"ancestorTitles":["getUserBalance"],"duration":12,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"telegram_id\", \"55\"\n\nNumber of calls: 0\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserBalance.test.ts:58:33\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"getUserBalance should return 0 if user has no balance field (or null)","status":"failed","title":"should return 0 if user has no balance field (or null)"},{"ancestorTitles":["getUserBalance"],"duration":13,"failureMessages":["Error: expect(received).rejects.toThrow()\n\nReceived promise resolved instead of rejected\nResolved to value: 0\n    at expect (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:113:15)\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserBalance.test.ts:64:17\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserBalance.test.ts:61:57)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"getUserBalance should throw error if user not found","status":"failed","title":"should throw error if user not found"},{"ancestorTitles":["getUserBalance"],"duration":1,"failureMessages":["Error: expect(received).rejects.toThrow()\n\nReceived promise resolved instead of rejected\nResolved to value: 0\n    at expect (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:113:15)\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserBalance.test.ts:72:17\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserBalance.test.ts:68:63)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"getUserBalance should throw error if supabase query fails","status":"failed","title":"should throw error if supabase query fails"}]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/getSubScribeChannel.test.ts","failureMessage":"  ● Test suite failed to run\n\n    TypeError: Cannot read properties of undefined (reading 'info')\n\n      66 | export const defaultBot = new Telegraf<MyContext>(DEFAULT_BOT_TOKEN)\n      67 |\n    > 68 | logger.info('🤖 Инициализация defaultBot:', {\n         |        ^\n      69 |   description: 'DefaultBot initialization',\n      70 |   tokenLength: DEFAULT_BOT_TOKEN.length,\n      71 | })\n\n      at Object.info (src/core/bot/index.ts:68:8)\n      at Object.require (src/core/supabase/sendPaymentInfo.ts:4:1)\n      at Object.require (src/core/supabase/index.ts:39:1)\n      at Object.require (src/handlers/getSubScribeChannel.ts:3:1)\n      at Object.<anonymous> (__tests__/handlers/getSubScribeChannel.test.ts:9:1)\n","testResults":[]},{"numFailingTests":12,"numPassingTests":6,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172278199,"runtime":28824,"slow":true,"start":1745172249375},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/registerCommands.test.ts","failureMessage":"  ● registerCommands › should register hears handlers for menu items\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: [\"level_103_ru\", \"level_103_en\"], Any<Function>\n    Received\n           1\n              Array [\n            -   \"level_103_ru\",\n            -   \"level_103_en\",\n            +   \"💬 Техподдержка\",\n            +   \"💬 Support\",\n              ],\n              [Function anonymous],\n           2\n              Array [\n            -   \"level_103_ru\",\n            -   \"level_103_en\",\n            +   \"💫 Оформить подписку\",\n            +   \"💫 Subscribe\",\n              ],\n              [Function anonymous],\n           3\n              Array [\n            -   \"level_103_ru\",\n            -   \"level_103_en\",\n            +   \"💎 Пополнить баланс\",\n            +   \"💎 Top up balance\",\n              ],\n              [Function anonymous],\n\n    Number of calls: 4\n\n       99 |\n      100 |   it('should register hears handlers for menu items', () => {\n    > 101 |     expect(bot.hears).toHaveBeenCalledWith(\n          |                       ^\n      102 |       [levels[103].title_ru, levels[103].title_en],\n      103 |       expect.any(Function)\n      104 |     )\n\n      at Object.<anonymous> (__tests__/registerCommands.test.ts:101:23)\n\n  ● registerCommands › command callbacks › /start should reset session and enter startScene\n\n    expect(received).toEqual(expected) // deep equality\n\n    - Expected  -  1\n    + Received  + 38\n\n    - Object {}\n    + Object {\n    +   \"amount\": 0,\n    +   \"attempts\": 0,\n    +   \"audioUrl\": \"\",\n    +   \"buttons\": Array [],\n    +   \"cursor\": 0,\n    +   \"email\": \"\",\n    +   \"imageUrl\": \"\",\n    +   \"images\": Array [],\n    +   \"memory\": Object {\n    +     \"messages\": Array [],\n    +   },\n    +   \"mode\": \"start_scene\",\n    +   \"modelName\": \"\",\n    +   \"neuroPhotoInitialized\": false,\n    +   \"prompt\": \"\",\n    +   \"selectedModel\": \"\",\n    +   \"selectedPayment\": Object {\n    +     \"amount\": 0,\n    +     \"stars\": 0,\n    +     \"subscription\": \"stars\",\n    +     \"type\": \"system\",\n    +   },\n    +   \"selectedSize\": \"\",\n    +   \"steps\": 0,\n    +   \"subscription\": \"stars\",\n    +   \"targetUserId\": \"0\",\n    +   \"translations\": Array [],\n    +   \"triggerWord\": \"\",\n    +   \"userModel\": Object {\n    +     \"finetune_id\": \"\",\n    +     \"model_name\": \"\",\n    +     \"model_url\": \"placeholder/placeholder:placeholder\",\n    +     \"trigger_word\": \"\",\n    +   },\n    +   \"videoModel\": \"\",\n    +   \"videoUrl\": \"\",\n    + }\n\n      122 |       const mockCtx = { session: { someData: 'test' }, scene: { enter: jest.fn() } }\n      123 |       await startCallback(mockCtx)\n    > 124 |       expect(mockCtx.session).toEqual({}) // Session should be reset\n          |                               ^\n      125 |       expect(mockCtx.scene.enter).toHaveBeenCalledWith(ModeEnum.StartScene)\n      126 |     })\n      127 |\n\n      at __tests__/registerCommands.test.ts:124:31\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● registerCommands › command callbacks › /menu should check subscription and enter correct scene (active)\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: 456\n    Received: \"456\"\n\n    Number of calls: 1\n\n      146 |       }\n      147 |       await menuCallback(mockCtx)\n    > 148 |       expect(getUserDetails).toHaveBeenCalledWith(456)\n          |                              ^\n      149 |       expect(mockCtx.scene.enter).toHaveBeenCalledWith(ModeEnum.MainMenu) // Должен войти в главное меню\n      150 |     })\n      151 |\n\n      at __tests__/registerCommands.test.ts:148:30\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● registerCommands › command callbacks › /menu should check subscription and enter correct scene (inactive)\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: 789\n    Received: \"789\"\n\n    Number of calls: 1\n\n      161 |       }\n      162 |       await menuCallback(mockCtx)\n    > 163 |       expect(getUserDetails).toHaveBeenCalledWith(789)\n          |                              ^\n      164 |       expect(mockCtx.scene.enter).toHaveBeenCalledWith(ModeEnum.SubscriptionScene) // Должен войти в сцену подписки\n      165 |     })\n      166 |\n\n      at __tests__/registerCommands.test.ts:163:30\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● registerCommands › command callbacks › /invite should reply with invite message\n\n    TypeError: Cannot read properties of undefined (reading 'enter')\n\n      215 |   bot.command('invite', async ctx => {\n      216 |     console.log('CASE: invite')\n    > 217 |     await ctx.scene.enter('inviteScene')\n          |                     ^\n      218 |   })\n      219 |\n      220 |   bot.command('balance', async ctx => {\n\n      at enter (src/registerCommands.ts:217:21)\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at __awaiter (src/registerCommands.ts:215:37)\n      at __tests__/registerCommands.test.ts:184:13\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/registerCommands.test.ts:179:63)\n\n  ● registerCommands › command callbacks › /balance should reply with balance info\n\n    TypeError: Cannot read properties of undefined (reading 'enter')\n\n      220 |   bot.command('balance', async ctx => {\n      221 |     console.log('CASE: balance')\n    > 222 |     await ctx.scene.enter('balanceScene')\n          |                     ^\n      223 |   })\n      224 |\n      225 |   bot.command('help', async ctx => {\n\n      at enter (src/registerCommands.ts:222:21)\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at __awaiter (src/registerCommands.ts:220:38)\n      at __tests__/registerCommands.test.ts:193:13\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/registerCommands.test.ts:188:62)\n\n  ● registerCommands › command callbacks › /help should reply with help message\n\n    TypeError: Cannot read properties of undefined (reading 'enter')\n\n      224 |\n      225 |   bot.command('help', async ctx => {\n    > 226 |     await ctx.scene.enter('step0')\n          |                     ^\n      227 |   })\n      228 |\n      229 |   bot.command('neuro_coder', async ctx => {\n\n      at enter (src/registerCommands.ts:226:21)\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at __awaiter (src/registerCommands.ts:225:35)\n      at __tests__/registerCommands.test.ts:202:13\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/registerCommands.test.ts:197:59)\n\n  ● registerCommands › command callbacks › /neuro_coder should reply with neuro_coder info\n\n    TypeError: Cannot read properties of undefined (reading 'enter')\n\n      228 |\n      229 |   bot.command('neuro_coder', async ctx => {\n    > 230 |     await ctx.scene.enter('neuroCoderScene')\n          |                     ^\n      231 |   })\n      232 |\n      233 |   // --- РЕГИСТРАЦИЯ ГЛОБАЛЬНОГО ОБРАБОТЧИКА ДЛЯ ПОКУПКИ ЗВЕЗД ---\n\n      at enter (src/registerCommands.ts:230:21)\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at __awaiter (src/registerCommands.ts:229:42)\n      at __tests__/registerCommands.test.ts:211:13\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/registerCommands.test.ts:206:70)\n\n  ● registerCommands › hears callbacks › support hears should call handleTechSupport\n\n    TypeError: Cannot read properties of undefined (reading '1')\n\n      218 |       const supportHearsCallback = bot.hears.mock.calls.find(\n      219 |         (call: any) => call[0][0] === levels[103].title_ru\n    > 220 |       )[1]\n          |        ^\n      221 |       const mockCtx = {}\n      222 |       await supportHearsCallback(mockCtx)\n      223 |       expect(handleTechSupport).toHaveBeenCalledWith(mockCtx)\n\n      at __tests__/registerCommands.test.ts:220:8\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/registerCommands.test.ts:217:66)\n\n  ● registerCommands › hears callbacks › subscribe hears should enter SubscriptionScene\n\n    TypeError: Cannot read properties of undefined (reading '1')\n\n      227 |       const subscribeHearsCallback = bot.hears.mock.calls.find(\n      228 |         (call: any) => call[0][0] === levels[105].title_ru\n    > 229 |       )[1]\n          |        ^\n      230 |       const mockCtx = { scene: { enter: jest.fn() } }\n      231 |       await subscribeHearsCallback(mockCtx)\n      232 |       expect(mockCtx.scene.enter).toHaveBeenCalledWith(ModeEnum.SubscriptionScene)\n\n      at __tests__/registerCommands.test.ts:229:8\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/registerCommands.test.ts:226:69)\n\n  ● registerCommands › action callbacks › top_up action should enter PaymentScene with correct subscription type\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"payment_scene\", {\"subscriptionType\": \"stars\"}\n\n    Number of calls: 0\n\n      248 |       await topUpActionCallback(mockCtx)\n      249 |\n    > 250 |       expect(mockCtx.scene.enter).toHaveBeenCalledWith(ModeEnum.PaymentScene, {\n          |                                   ^\n      251 |         subscriptionType: 'stars', // Проверяем, что передается правильный тип подписки\n      252 |       })\n      253 |       expect(mockCtx.answerCbQuery).toHaveBeenCalled() // Проверяем, что answerCbQuery был вызван\n\n      at __tests__/registerCommands.test.ts:250:35\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● registerCommands › command callbacks for /get100 › /get100 command should send \"get100\"\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"get100\"\n\n    Number of calls: 0\n\n      262 |       const mockCtx = { reply: jest.fn() }\n      263 |       await get100CommandCallback(mockCtx)\n    > 264 |       expect(mockCtx.reply).toHaveBeenCalledWith('get100')\n          |                             ^\n      265 |     })\n      266 |   })\n      267 | })\n\n      at __tests__/registerCommands.test.ts:264:29\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["registerCommands"],"duration":18,"failureMessages":[],"fullName":"registerCommands should register session middleware","status":"passed","title":"should register session middleware"},{"ancestorTitles":["registerCommands"],"duration":0,"failureMessages":[],"fullName":"registerCommands should register stage middleware","status":"passed","title":"should register stage middleware"},{"ancestorTitles":["registerCommands"],"duration":4,"failureMessages":[],"fullName":"registerCommands should register basic commands","status":"passed","title":"should register basic commands"},{"ancestorTitles":["registerCommands"],"duration":80,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: [\"level_103_ru\", \"level_103_en\"], Any<Function>\nReceived\n       1\n          Array [\n        -   \"level_103_ru\",\n        -   \"level_103_en\",\n        +   \"💬 Техподдержка\",\n        +   \"💬 Support\",\n          ],\n          [Function anonymous],\n       2\n          Array [\n        -   \"level_103_ru\",\n        -   \"level_103_en\",\n        +   \"💫 Оформить подписку\",\n        +   \"💫 Subscribe\",\n          ],\n          [Function anonymous],\n       3\n          Array [\n        -   \"level_103_ru\",\n        -   \"level_103_en\",\n        +   \"💎 Пополнить баланс\",\n        +   \"💎 Top up balance\",\n          ],\n          [Function anonymous],\n\nNumber of calls: 4\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/registerCommands.test.ts:101:23)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"registerCommands should register hears handlers for menu items","status":"failed","title":"should register hears handlers for menu items"},{"ancestorTitles":["registerCommands"],"duration":3,"failureMessages":[],"fullName":"registerCommands should register action handler for top_up","status":"passed","title":"should register action handler for top_up"},{"ancestorTitles":["registerCommands","command callbacks"],"duration":9,"failureMessages":["Error: expect(received).toEqual(expected) // deep equality\n\n- Expected  -  1\n+ Received  + 38\n\n- Object {}\n+ Object {\n+   \"amount\": 0,\n+   \"attempts\": 0,\n+   \"audioUrl\": \"\",\n+   \"buttons\": Array [],\n+   \"cursor\": 0,\n+   \"email\": \"\",\n+   \"imageUrl\": \"\",\n+   \"images\": Array [],\n+   \"memory\": Object {\n+     \"messages\": Array [],\n+   },\n+   \"mode\": \"start_scene\",\n+   \"modelName\": \"\",\n+   \"neuroPhotoInitialized\": false,\n+   \"prompt\": \"\",\n+   \"selectedModel\": \"\",\n+   \"selectedPayment\": Object {\n+     \"amount\": 0,\n+     \"stars\": 0,\n+     \"subscription\": \"stars\",\n+     \"type\": \"system\",\n+   },\n+   \"selectedSize\": \"\",\n+   \"steps\": 0,\n+   \"subscription\": \"stars\",\n+   \"targetUserId\": \"0\",\n+   \"translations\": Array [],\n+   \"triggerWord\": \"\",\n+   \"userModel\": Object {\n+     \"finetune_id\": \"\",\n+     \"model_name\": \"\",\n+     \"model_url\": \"placeholder/placeholder:placeholder\",\n+     \"trigger_word\": \"\",\n+   },\n+   \"videoModel\": \"\",\n+   \"videoUrl\": \"\",\n+ }\n    at /Users/playom/999-multibots-telegraf/__tests__/registerCommands.test.ts:124:31\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"registerCommands command callbacks /start should reset session and enter startScene","status":"failed","title":"/start should reset session and enter startScene"},{"ancestorTitles":["registerCommands","command callbacks"],"duration":7,"failureMessages":[],"fullName":"registerCommands command callbacks /support should call handleTechSupport","status":"passed","title":"/support should call handleTechSupport"},{"ancestorTitles":["registerCommands","command callbacks"],"duration":6,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: 456\nReceived: \"456\"\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/registerCommands.test.ts:148:30\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"registerCommands command callbacks /menu should check subscription and enter correct scene (active)","status":"failed","title":"/menu should check subscription and enter correct scene (active)"},{"ancestorTitles":["registerCommands","command callbacks"],"duration":3,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: 789\nReceived: \"789\"\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/registerCommands.test.ts:163:30\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"registerCommands command callbacks /menu should check subscription and enter correct scene (inactive)","status":"failed","title":"/menu should check subscription and enter correct scene (inactive)"},{"ancestorTitles":["registerCommands","command callbacks"],"duration":4,"failureMessages":[],"fullName":"registerCommands command callbacks /buy should set session and enter payment scene","status":"passed","title":"/buy should set session and enter payment scene"},{"ancestorTitles":["registerCommands","command callbacks"],"duration":2,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'enter')\n    at enter (/Users/playom/999-multibots-telegraf/src/registerCommands.ts:217:21)\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at __awaiter (/Users/playom/999-multibots-telegraf/src/registerCommands.ts:215:37)\n    at /Users/playom/999-multibots-telegraf/__tests__/registerCommands.test.ts:184:13\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/registerCommands.test.ts:179:63)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"registerCommands command callbacks /invite should reply with invite message","status":"failed","title":"/invite should reply with invite message"},{"ancestorTitles":["registerCommands","command callbacks"],"duration":6,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'enter')\n    at enter (/Users/playom/999-multibots-telegraf/src/registerCommands.ts:222:21)\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at __awaiter (/Users/playom/999-multibots-telegraf/src/registerCommands.ts:220:38)\n    at /Users/playom/999-multibots-telegraf/__tests__/registerCommands.test.ts:193:13\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/registerCommands.test.ts:188:62)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"registerCommands command callbacks /balance should reply with balance info","status":"failed","title":"/balance should reply with balance info"},{"ancestorTitles":["registerCommands","command callbacks"],"duration":0,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'enter')\n    at enter (/Users/playom/999-multibots-telegraf/src/registerCommands.ts:226:21)\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at __awaiter (/Users/playom/999-multibots-telegraf/src/registerCommands.ts:225:35)\n    at /Users/playom/999-multibots-telegraf/__tests__/registerCommands.test.ts:202:13\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/registerCommands.test.ts:197:59)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"registerCommands command callbacks /help should reply with help message","status":"failed","title":"/help should reply with help message"},{"ancestorTitles":["registerCommands","command callbacks"],"duration":1,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'enter')\n    at enter (/Users/playom/999-multibots-telegraf/src/registerCommands.ts:230:21)\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at __awaiter (/Users/playom/999-multibots-telegraf/src/registerCommands.ts:229:42)\n    at /Users/playom/999-multibots-telegraf/__tests__/registerCommands.test.ts:211:13\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/registerCommands.test.ts:206:70)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"registerCommands command callbacks /neuro_coder should reply with neuro_coder info","status":"failed","title":"/neuro_coder should reply with neuro_coder info"},{"ancestorTitles":["registerCommands","hears callbacks"],"duration":1,"failureMessages":["TypeError: Cannot read properties of undefined (reading '1')\n    at /Users/playom/999-multibots-telegraf/__tests__/registerCommands.test.ts:220:8\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/registerCommands.test.ts:217:66)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"registerCommands hears callbacks support hears should call handleTechSupport","status":"failed","title":"support hears should call handleTechSupport"},{"ancestorTitles":["registerCommands","hears callbacks"],"duration":0,"failureMessages":["TypeError: Cannot read properties of undefined (reading '1')\n    at /Users/playom/999-multibots-telegraf/__tests__/registerCommands.test.ts:229:8\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/registerCommands.test.ts:226:69)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"registerCommands hears callbacks subscribe hears should enter SubscriptionScene","status":"failed","title":"subscribe hears should enter SubscriptionScene"},{"ancestorTitles":["registerCommands","action callbacks"],"duration":48,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"payment_scene\", {\"subscriptionType\": \"stars\"}\n\nNumber of calls: 0\n    at /Users/playom/999-multibots-telegraf/__tests__/registerCommands.test.ts:250:35\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"registerCommands action callbacks top_up action should enter PaymentScene with correct subscription type","status":"failed","title":"top_up action should enter PaymentScene with correct subscription type"},{"ancestorTitles":["registerCommands","command callbacks for /get100"],"duration":3,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"get100\"\n\nNumber of calls: 0\n    at /Users/playom/999-multibots-telegraf/__tests__/registerCommands.test.ts:264:29\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"registerCommands command callbacks for /get100 /get100 command should send \"get100\"","status":"failed","title":"/get100 command should send \"get100\""}]},{"numFailingTests":5,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172278635,"runtime":2857,"slow":false,"start":1745172275778},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/improvePromptWizard.test.ts","failureMessage":"  ● improvePromptWizard › step 0: missing ctx.from leaves scene\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"User identification error\"\n\n    Number of calls: 0\n\n      50 |     const step0 = Composer.unwrap(improvePromptWizard.steps[0])\n      51 |     await step0(ctx, async () => {})\n    > 52 |     expect(ctx.reply).toHaveBeenCalledWith('User identification error')\n         |                       ^\n      53 |     expect(ctx.scene.leave).toHaveBeenCalled()\n      54 |   })\n      55 |\n\n      at __tests__/scenes/improvePromptWizard.test.ts:52:23\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● improvePromptWizard › step 1: yes generate for neuro_photo\n\n    improvePromptWizard: Неизвестный режим\n\n      153 |               break\n      154 |             default:\n    > 155 |               throw new Error(\n          |                     ^\n      156 |                 isRu\n      157 |                   ? 'improvePromptWizard: Неизвестный режим'\n      158 |                   : 'improvePromptWizard: Unknown mode'\n\n      at src/scenes/improvePromptWizard/index.ts:155:21\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at __awaiter (src/scenes/improvePromptWizard/index.ts:65:15)\n      at __tests__/scenes/improvePromptWizard.test.ts:121:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/improvePromptWizard.test.ts:110:57)\n\n  ● improvePromptWizard › should navigate to menuScene if no mode in session\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"An error occurred.\"\n\n    Number of calls: 0\n\n      141 |     const step1 = Composer.unwrap(improvePromptWizard.steps[1])\n      142 |     await step1(ctx, async () => {})\n    > 143 |     expect(ctx.reply).toHaveBeenCalledWith('An error occurred.')\n          |                       ^\n      144 |     expect(ctx.scene.leave).toHaveBeenCalled()\n      145 |   })\n      146 |\n\n      at __tests__/scenes/improvePromptWizard.test.ts:143:23\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● improvePromptWizard › should navigate to menuScene if userModel not in session\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"An error occurred.\"\n\n    Number of calls: 0\n\n      155 |     const step1 = Composer.unwrap(improvePromptWizard.steps[1])\n      156 |     await step1(ctx, async () => {})\n    > 157 |     expect(ctx.reply).toHaveBeenCalledWith('An error occurred.')\n          |                       ^\n      158 |     expect(ctx.scene.leave).toHaveBeenCalled()\n      159 |   })\n      160 |\n\n      at __tests__/scenes/improvePromptWizard.test.ts:157:23\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● improvePromptWizard › should call generateImageFromPrompt for neuro_photo mode (RU)\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: {\"answerCbQuery\": [Function mockConstructor], \"answerPreCheckoutQuery\": [Function mockConstructor], \"callback_query\": undefined, \"chat\": {\"first_name\": \"Test\", \"id\": 12345, \"type\": \"private\", \"username\": \"testuser\"}, \"debug\": {\"currentScene\": \"\", \"replies\": [], \"replyMessages\": [Function replyMessages]}, \"from\": {\"first_name\": \"Test\", \"id\": 1, \"is_bot\": false, \"language_code\": \"ru\", \"username\": \"u\"}, \"match\": [Function mockConstructor], \"message\": {\"chat\": {\"first_name\": \"Test\", \"id\": 12345, \"type\": \"private\", \"username\": \"testuser\"}, \"date\": 1745172278.61, \"from\": {\"first_name\": \"Test\", \"id\": 1, \"is_bot\": false, \"language_code\": \"ru\", \"username\": \"u\"}, \"message_id\": 1, \"text\": \"any\"}, \"reply\": [Function mockConstructor], \"replyWithInvoice\": [Function mockConstructor], \"replyWithPhoto\": [Function mockConstructor], \"scene\": {\"enter\": [Function mockConstructor], \"leave\": [Function mockConstructor], \"reenter\": [Function mockConstructor], \"session\": {\"state\": {}}}, \"session\": {\"mode\": \"neuro_photo_v2\", \"prompt\": \"pr\", \"userModel\": {\"model_name\": \"test_model\", \"model_url\": \"a/b:c\", \"trigger_word\": \"test_trigger\"}}, \"telegram\": {\"callApi\": [Function mockConstructor], \"sendChatAction\": [Function mockConstructor], \"sendMessage\": [Function mockConstructor], \"token\": \"mock_token\"}, \"update\": {\"message\": {\"chat\": {\"first_name\": \"Test\", \"id\": 12345, \"type\": \"private\", \"username\": \"testuser\"}, \"date\": 1745172278.61, \"from\": {\"first_name\": \"Test\", \"id\": 1, \"is_bot\": false, \"language_code\": \"ru\", \"username\": \"u\"}, \"message_id\": 1, \"text\": \"any\"}, \"update_id\": 1}, \"wizard\": {\"back\": [Function mockConstructor], \"cursor\": 0, \"next\": [Function mockConstructor], \"state\": {}, \"steps\": []}}, \"a/b:c\", \"pr\", true\n\n    Number of calls: 0\n\n      172 |     const step1 = Composer.unwrap(improvePromptWizard.steps[1])\n      173 |     await step1(ctx, async () => {})\n    > 174 |     expect(generateImageFromPrompt).toHaveBeenCalledWith(\n          |                                     ^\n      175 |       ctx,\n      176 |       'a/b:c',\n      177 |       'pr',\n\n      at __tests__/scenes/improvePromptWizard.test.ts:174:37\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["improvePromptWizard"],"duration":6,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"User identification error\"\n\nNumber of calls: 0\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/improvePromptWizard.test.ts:52:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"improvePromptWizard step 0: missing ctx.from leaves scene","status":"failed","title":"step 0: missing ctx.from leaves scene"},{"ancestorTitles":["improvePromptWizard"],"duration":8,"failureMessages":[],"fullName":"improvePromptWizard step 0: upgradePrompt fails -> failure message and leave","status":"passed","title":"step 0: upgradePrompt fails -> failure message and leave"},{"ancestorTitles":["improvePromptWizard"],"duration":26,"failureMessages":[],"fullName":"improvePromptWizard step 0: upgradePrompt succeeds -> reply improved and next","status":"passed","title":"step 0: upgradePrompt succeeds -> reply improved and next"},{"ancestorTitles":["improvePromptWizard"],"duration":2,"failureMessages":[],"fullName":"improvePromptWizard step 1: no message leaves scene","status":"passed","title":"step 1: no message leaves scene"},{"ancestorTitles":["improvePromptWizard"],"duration":7,"failureMessages":[],"fullName":"improvePromptWizard step 1: cancel case","status":"passed","title":"step 1: cancel case"},{"ancestorTitles":["improvePromptWizard"],"duration":6,"failureMessages":["Error: improvePromptWizard: Неизвестный режим\n    at /Users/playom/999-multibots-telegraf/src/scenes/improvePromptWizard/index.ts:155:21\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at __awaiter (/Users/playom/999-multibots-telegraf/src/scenes/improvePromptWizard/index.ts:65:15)\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/improvePromptWizard.test.ts:121:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/improvePromptWizard.test.ts:110:57)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"improvePromptWizard step 1: yes generate for neuro_photo","status":"failed","title":"step 1: yes generate for neuro_photo"},{"ancestorTitles":["improvePromptWizard"],"duration":3,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"An error occurred.\"\n\nNumber of calls: 0\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/improvePromptWizard.test.ts:143:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"improvePromptWizard should navigate to menuScene if no mode in session","status":"failed","title":"should navigate to menuScene if no mode in session"},{"ancestorTitles":["improvePromptWizard"],"duration":3,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"An error occurred.\"\n\nNumber of calls: 0\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/improvePromptWizard.test.ts:157:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"improvePromptWizard should navigate to menuScene if userModel not in session","status":"failed","title":"should navigate to menuScene if userModel not in session"},{"ancestorTitles":["improvePromptWizard"],"duration":10,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: {\"answerCbQuery\": [Function mockConstructor], \"answerPreCheckoutQuery\": [Function mockConstructor], \"callback_query\": undefined, \"chat\": {\"first_name\": \"Test\", \"id\": 12345, \"type\": \"private\", \"username\": \"testuser\"}, \"debug\": {\"currentScene\": \"\", \"replies\": [], \"replyMessages\": [Function replyMessages]}, \"from\": {\"first_name\": \"Test\", \"id\": 1, \"is_bot\": false, \"language_code\": \"ru\", \"username\": \"u\"}, \"match\": [Function mockConstructor], \"message\": {\"chat\": {\"first_name\": \"Test\", \"id\": 12345, \"type\": \"private\", \"username\": \"testuser\"}, \"date\": 1745172278.61, \"from\": {\"first_name\": \"Test\", \"id\": 1, \"is_bot\": false, \"language_code\": \"ru\", \"username\": \"u\"}, \"message_id\": 1, \"text\": \"any\"}, \"reply\": [Function mockConstructor], \"replyWithInvoice\": [Function mockConstructor], \"replyWithPhoto\": [Function mockConstructor], \"scene\": {\"enter\": [Function mockConstructor], \"leave\": [Function mockConstructor], \"reenter\": [Function mockConstructor], \"session\": {\"state\": {}}}, \"session\": {\"mode\": \"neuro_photo_v2\", \"prompt\": \"pr\", \"userModel\": {\"model_name\": \"test_model\", \"model_url\": \"a/b:c\", \"trigger_word\": \"test_trigger\"}}, \"telegram\": {\"callApi\": [Function mockConstructor], \"sendChatAction\": [Function mockConstructor], \"sendMessage\": [Function mockConstructor], \"token\": \"mock_token\"}, \"update\": {\"message\": {\"chat\": {\"first_name\": \"Test\", \"id\": 12345, \"type\": \"private\", \"username\": \"testuser\"}, \"date\": 1745172278.61, \"from\": {\"first_name\": \"Test\", \"id\": 1, \"is_bot\": false, \"language_code\": \"ru\", \"username\": \"u\"}, \"message_id\": 1, \"text\": \"any\"}, \"update_id\": 1}, \"wizard\": {\"back\": [Function mockConstructor], \"cursor\": 0, \"next\": [Function mockConstructor], \"state\": {}, \"steps\": []}}, \"a/b:c\", \"pr\", true\n\nNumber of calls: 0\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/improvePromptWizard.test.ts:174:37\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"improvePromptWizard should call generateImageFromPrompt for neuro_photo mode (RU)","status":"failed","title":"should call generateImageFromPrompt for neuro_photo mode (RU)"}]},{"numFailingTests":10,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172279090,"runtime":1016,"slow":false,"start":1745172278074},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts","failureMessage":"  ● checkPaymentStatus › returns false if ctx or ctx.from.id is missing\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: false\n    Received: null\n\n      69 |   it('returns false if ctx or ctx.from.id is missing', async () => {\n      70 |     const result = await checkPaymentStatus({}, 'basic')\n    > 71 |     expect(result).toBe(false)\n         |                    ^\n      72 |   })\n      73 |\n      74 |   it('returns false when payment query errors', async () => {\n\n      at Object.<anonymous> (__tests__/core/supabase/checkPaymentStatus.test.ts:71:20)\n      at fulfilled (__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)\n\n  ● checkPaymentStatus › returns false when payment query errors\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"payments\"\n\n    Number of calls: 0\n\n      75 |     mockSinglePayments.mockResolvedValueOnce({ data: null, error: new Error('fail') })\n      76 |     const result = await checkPaymentStatus(ctx, 'basic')\n    > 77 |     expect(mockFromPayments).toHaveBeenCalledWith('payments')\n         |                              ^\n      78 |     expect(result).toBe(false)\n      79 |   })\n      80 |\n\n      at Object.<anonymous> (__tests__/core/supabase/checkPaymentStatus.test.ts:77:30)\n      at fulfilled (__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)\n\n  ● checkPaymentStatus › returns true and updates subscription when last payment older than 30 days\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: true\n    Received: null\n\n      84 |     mockSinglePayments.mockResolvedValueOnce({ data: { payment_date: oldDate }, error: null })\n      85 |     const result = await checkPaymentStatus(ctx, 'basic')\n    > 86 |     expect(result).toBe(true)\n         |                    ^\n      87 |     expect(mockFromUsers).toHaveBeenCalledWith('users')\n      88 |     expect(mockUpdateUsers).toHaveBeenCalledWith({ subscription: 'stars' })\n      89 |     expect(mockEqUsers).toHaveBeenCalledWith('telegram_id', '42')\n\n      at Object.<anonymous> (__tests__/core/supabase/checkPaymentStatus.test.ts:86:20)\n      at fulfilled (__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)\n\n  ● checkPaymentStatus › returns false and replies when last payment within 30 days and full access\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: false\n    Received: null\n\n       97 |     process.env.NODE_ENV = 'production'\n       98 |     const result = await checkPaymentStatus(ctx, 'basic')\n    >  99 |     expect(result).toBe(false)\n          |                    ^\n      100 |     expect(ctx.reply).toHaveBeenCalled()\n      101 |   })\n      102 |   \n\n      at Object.<anonymous> (__tests__/core/supabase/checkPaymentStatus.test.ts:99:20)\n      at fulfilled (__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)\n\n  ● checkPaymentStatus › replies English message when subscription expired and not Russian\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"🤑Your subscription has expired. Please update your subscription to continue using the service.\"\n\n    Number of calls: 0\n\n      112 |     process.env.NODE_ENV = 'production'\n      113 |     await checkPaymentStatus(ctx, 'basic')\n    > 114 |     expect(ctx.reply).toHaveBeenCalledWith(\n          |                       ^\n      115 |       '🤑Your subscription has expired. Please update your subscription to continue using the service.'\n      116 |     )\n      117 |   })\n\n      at Object.<anonymous> (__tests__/core/supabase/checkPaymentStatus.test.ts:114:23)\n      at fulfilled (__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)\n\n  ● checkPaymentStatus › returns true and updates when recent payment but no full access\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: true\n    Received: null\n\n      125 |     cf.mockReturnValue(false)\n      126 |     const result = await checkPaymentStatus(ctx, 'basic')\n    > 127 |     expect(result).toBe(true)\n          |                    ^\n      128 |     expect(mockFromUsers).toHaveBeenCalledWith('users')\n      129 |     expect(mockUpdateUsers).toHaveBeenCalledWith({ subscription: 'stars' })\n      130 |   })\n\n      at Object.<anonymous> (__tests__/core/supabase/checkPaymentStatus.test.ts:127:20)\n      at fulfilled (__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)\n\n  ● checkPaymentStatus › returns false without reply when in development environment\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: false\n    Received: null\n\n      140 |     process.env.NODE_ENV = 'development'\n      141 |     const result = await checkPaymentStatus(ctx, 'basic')\n    > 142 |     expect(result).toBe(false)\n          |                    ^\n      143 |     // Reply should NOT be called in dev\n      144 |     expect(ctx.reply).not.toHaveBeenCalled()\n      145 |   })\n\n      at Object.<anonymous> (__tests__/core/supabase/checkPaymentStatus.test.ts:142:20)\n      at fulfilled (__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)\n\n  ● checkPaymentStatus › does not reply when subscription is neurotester\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: false\n    Received: null\n\n      155 |     process.env.NODE_ENV = 'production'\n      156 |     const result = await checkPaymentStatus(ctx, 'neurotester')\n    > 157 |     expect(result).toBe(false)\n          |                    ^\n      158 |     // Should not reply for 'neurotester'\n      159 |     expect(ctx.reply).not.toHaveBeenCalled()\n      160 |   })\n\n      at Object.<anonymous> (__tests__/core/supabase/checkPaymentStatus.test.ts:157:20)\n      at fulfilled (__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)\n\n  ● checkPaymentStatus › logs error and returns true when updateError present\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: true\n    Received: null\n\n      168 |     const errorSpy = jest.spyOn(console, 'error').mockImplementation(() => {})\n      169 |     const result = await checkPaymentStatus(ctx, 'basic')\n    > 170 |     expect(result).toBe(true)\n          |                    ^\n      171 |     expect(errorSpy).toHaveBeenCalledWith(\n      172 |       'Ошибка при обновлении уровня подписки:',\n      173 |       expect.any(Error)\n\n      at Object.<anonymous> (__tests__/core/supabase/checkPaymentStatus.test.ts:170:20)\n      at fulfilled (__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)\n\n  ● checkPaymentStatus › logs error and returns false when update throws exception\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: false\n    Received: null\n\n      184 |     const errorSpy = jest.spyOn(console, 'error').mockImplementation(() => {})\n      185 |     const result = await checkPaymentStatus(ctx, 'basic')\n    > 186 |     expect(result).toBe(false)\n          |                    ^\n      187 |     expect(errorSpy).toHaveBeenCalledWith('Ошибка при проверке статуса оплаты:', expect.any(Error))\n      188 |     errorSpy.mockRestore()\n      189 |   })\n\n      at Object.<anonymous> (__tests__/core/supabase/checkPaymentStatus.test.ts:186:20)\n      at fulfilled (__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)\n","testResults":[{"ancestorTitles":["checkPaymentStatus"],"duration":8,"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: false\nReceived: null\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:71:20)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"checkPaymentStatus returns false if ctx or ctx.from.id is missing","status":"failed","title":"returns false if ctx or ctx.from.id is missing"},{"ancestorTitles":["checkPaymentStatus"],"duration":3,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"payments\"\n\nNumber of calls: 0\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:77:30)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"checkPaymentStatus returns false when payment query errors","status":"failed","title":"returns false when payment query errors"},{"ancestorTitles":["checkPaymentStatus"],"duration":2,"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: true\nReceived: null\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:86:20)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"checkPaymentStatus returns true and updates subscription when last payment older than 30 days","status":"failed","title":"returns true and updates subscription when last payment older than 30 days"},{"ancestorTitles":["checkPaymentStatus"],"duration":3,"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: false\nReceived: null\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:99:20)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"checkPaymentStatus returns false and replies when last payment within 30 days and full access","status":"failed","title":"returns false and replies when last payment within 30 days and full access"},{"ancestorTitles":["checkPaymentStatus"],"duration":4,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"🤑Your subscription has expired. Please update your subscription to continue using the service.\"\n\nNumber of calls: 0\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:114:23)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"checkPaymentStatus replies English message when subscription expired and not Russian","status":"failed","title":"replies English message when subscription expired and not Russian"},{"ancestorTitles":["checkPaymentStatus"],"duration":6,"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: true\nReceived: null\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:127:20)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"checkPaymentStatus returns true and updates when recent payment but no full access","status":"failed","title":"returns true and updates when recent payment but no full access"},{"ancestorTitles":["checkPaymentStatus"],"duration":6,"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: false\nReceived: null\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:142:20)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"checkPaymentStatus returns false without reply when in development environment","status":"failed","title":"returns false without reply when in development environment"},{"ancestorTitles":["checkPaymentStatus"],"duration":4,"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: false\nReceived: null\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:157:20)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"checkPaymentStatus does not reply when subscription is neurotester","status":"failed","title":"does not reply when subscription is neurotester"},{"ancestorTitles":["checkPaymentStatus"],"duration":4,"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: true\nReceived: null\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:170:20)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"checkPaymentStatus logs error and returns true when updateError present","status":"failed","title":"logs error and returns true when updateError present"},{"ancestorTitles":["checkPaymentStatus"],"duration":4,"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: false\nReceived: null\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:186:20)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkPaymentStatus.test.ts:4:58)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"checkPaymentStatus logs error and returns false when update throws exception","status":"failed","title":"logs error and returns false when update throws exception"}]},{"numFailingTests":1,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172279177,"runtime":964,"slow":false,"start":1745172278213},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/digitalAvatarBodyWizard.test.ts","failureMessage":"  ● digitalAvatarBodyWizard › step 0: sends cost message and next\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: [10, 20, 30], true\n    Received: undefined, true, \"v1\"\n\n    Number of calls: 1\n\n      28 |     getStepSelectionMenu.mockReturnValue({ keyboard: [] })\n      29 |     await steps[0](ctx)\n    > 30 |     expect(generateCostMessage).toHaveBeenCalledWith([10,20,30], true)\n         |                                 ^\n      31 |     expect(ctx.reply).toHaveBeenCalledWith('cost msg', {keyboard: []})\n      32 |     expect(ctx.wizard.next).toHaveBeenCalled()\n      33 |   })\n\n      at __tests__/scenes/digitalAvatarBodyWizard.test.ts:30:33\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["digitalAvatarBodyWizard"],"duration":4,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: [10, 20, 30], true\nReceived: undefined, true, \"v1\"\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/digitalAvatarBodyWizard.test.ts:30:33\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"digitalAvatarBodyWizard step 0: sends cost message and next","status":"failed","title":"step 0: sends cost message and next"},{"ancestorTitles":["digitalAvatarBodyWizard"],"duration":19,"failureMessages":[],"fullName":"digitalAvatarBodyWizard step 1: numeric input, leaveScene=false","status":"passed","title":"step 1: numeric input, leaveScene=false"},{"ancestorTitles":["digitalAvatarBodyWizard"],"duration":65,"failureMessages":[],"fullName":"digitalAvatarBodyWizard step 1: numeric input, leaveScene=true","status":"passed","title":"step 1: numeric input, leaveScene=true"},{"ancestorTitles":["digitalAvatarBodyWizard"],"duration":6,"failureMessages":[],"fullName":"digitalAvatarBodyWizard step 1: non-numeric input and cancel","status":"passed","title":"step 1: non-numeric input and cancel"},{"ancestorTitles":["digitalAvatarBodyWizard"],"duration":4,"failureMessages":[],"fullName":"digitalAvatarBodyWizard step 1: non-numeric input and not cancel","status":"passed","title":"step 1: non-numeric input and not cancel"}]},{"numFailingTests":5,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172279270,"runtime":1327,"slow":false,"start":1745172277943},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getBotsFromSupabase.test.ts","failureMessage":"  ● core/supabase getBotsFromSupabase › returns empty array and warns if not configured\n\n    TypeError: Cannot read properties of undefined (reading 'error')\n\n      14 | const loadResult = config({ path: envPath })\n      15 |\n    > 16 | if (loadResult.error) {\n         |                ^\n      17 |   console.error(\n      18 |     `[CONFIG] CRITICAL ERROR: Failed to load primary .env file from ${envPath}. Error: ${loadResult.error.message}`\n      19 |   )\n\n      at Object.error (src/config/index.ts:16:16)\n      at Object.require (src/core/supabase/client.ts:2:1)\n      at Object.require (src/core/supabase/index.ts:1:1)\n      at Object.<anonymous> (__tests__/core/supabase/getBotsFromSupabase.test.ts:12:22)\n\n  ● core/supabase getBotsFromSupabase › returns empty array and logs error on query error\n\n    TypeError: Cannot read properties of undefined (reading 'error')\n\n      14 | const loadResult = config({ path: envPath })\n      15 |\n    > 16 | if (loadResult.error) {\n         |                ^\n      17 |   console.error(\n      18 |     `[CONFIG] CRITICAL ERROR: Failed to load primary .env file from ${envPath}. Error: ${loadResult.error.message}`\n      19 |   )\n\n      at Object.error (src/config/index.ts:16:16)\n      at Object.require (src/core/supabase/client.ts:2:1)\n      at Object.require (src/core/supabase/index.ts:1:1)\n      at Object.<anonymous> (__tests__/core/supabase/getBotsFromSupabase.test.ts:12:22)\n\n  ● core/supabase getBotsFromSupabase › returns empty array and logs info when no data\n\n    TypeError: Cannot read properties of undefined (reading 'error')\n\n      14 | const loadResult = config({ path: envPath })\n      15 |\n    > 16 | if (loadResult.error) {\n         |                ^\n      17 |   console.error(\n      18 |     `[CONFIG] CRITICAL ERROR: Failed to load primary .env file from ${envPath}. Error: ${loadResult.error.message}`\n      19 |   )\n\n      at Object.error (src/config/index.ts:16:16)\n      at Object.require (src/core/supabase/client.ts:2:1)\n      at Object.require (src/core/supabase/index.ts:1:1)\n      at Object.<anonymous> (__tests__/core/supabase/getBotsFromSupabase.test.ts:12:22)\n\n  ● core/supabase getBotsFromSupabase › returns data array and logs info on success\n\n    TypeError: Cannot read properties of undefined (reading 'error')\n\n      14 | const loadResult = config({ path: envPath })\n      15 |\n    > 16 | if (loadResult.error) {\n         |                ^\n      17 |   console.error(\n      18 |     `[CONFIG] CRITICAL ERROR: Failed to load primary .env file from ${envPath}. Error: ${loadResult.error.message}`\n      19 |   )\n\n      at Object.error (src/config/index.ts:16:16)\n      at Object.require (src/core/supabase/client.ts:2:1)\n      at Object.require (src/core/supabase/index.ts:1:1)\n      at Object.<anonymous> (__tests__/core/supabase/getBotsFromSupabase.test.ts:12:22)\n\n  ● core/supabase getBotsFromSupabase › logs error and returns empty array when supabaseAdmin throws exception\n\n    TypeError: Cannot read properties of undefined (reading 'error')\n\n      14 | const loadResult = config({ path: envPath })\n      15 |\n    > 16 | if (loadResult.error) {\n         |                ^\n      17 |   console.error(\n      18 |     `[CONFIG] CRITICAL ERROR: Failed to load primary .env file from ${envPath}. Error: ${loadResult.error.message}`\n      19 |   )\n\n      at Object.error (src/config/index.ts:16:16)\n      at Object.require (src/core/supabase/client.ts:2:1)\n      at Object.require (src/core/supabase/index.ts:1:1)\n      at Object.<anonymous> (__tests__/core/supabase/getBotsFromSupabase.test.ts:12:22)\n","testResults":[{"ancestorTitles":["core/supabase getBotsFromSupabase"],"duration":93,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'error')\n    at Object.error (/Users/playom/999-multibots-telegraf/src/config/index.ts:16:16)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playom/999-multibots-telegraf/src/core/supabase/client.ts:2:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playom/999-multibots-telegraf/src/core/supabase/index.ts:1:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getBotsFromSupabase.test.ts:12:22)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusHook (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:281:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:246:5)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"core/supabase getBotsFromSupabase returns empty array and warns if not configured","status":"failed","title":"returns empty array and warns if not configured"},{"ancestorTitles":["core/supabase getBotsFromSupabase"],"duration":53,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'error')\n    at Object.error (/Users/playom/999-multibots-telegraf/src/config/index.ts:16:16)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playom/999-multibots-telegraf/src/core/supabase/client.ts:2:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playom/999-multibots-telegraf/src/core/supabase/index.ts:1:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getBotsFromSupabase.test.ts:12:22)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusHook (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:281:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:246:5)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"core/supabase getBotsFromSupabase returns empty array and logs error on query error","status":"failed","title":"returns empty array and logs error on query error"},{"ancestorTitles":["core/supabase getBotsFromSupabase"],"duration":64,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'error')\n    at Object.error (/Users/playom/999-multibots-telegraf/src/config/index.ts:16:16)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playom/999-multibots-telegraf/src/core/supabase/client.ts:2:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playom/999-multibots-telegraf/src/core/supabase/index.ts:1:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getBotsFromSupabase.test.ts:12:22)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusHook (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:281:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:246:5)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"core/supabase getBotsFromSupabase returns empty array and logs info when no data","status":"failed","title":"returns empty array and logs info when no data"},{"ancestorTitles":["core/supabase getBotsFromSupabase"],"duration":112,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'error')\n    at Object.error (/Users/playom/999-multibots-telegraf/src/config/index.ts:16:16)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playom/999-multibots-telegraf/src/core/supabase/client.ts:2:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playom/999-multibots-telegraf/src/core/supabase/index.ts:1:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getBotsFromSupabase.test.ts:12:22)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusHook (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:281:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:246:5)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"core/supabase getBotsFromSupabase returns data array and logs info on success","status":"failed","title":"returns data array and logs info on success"},{"ancestorTitles":["core/supabase getBotsFromSupabase"],"duration":84,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'error')\n    at Object.error (/Users/playom/999-multibots-telegraf/src/config/index.ts:16:16)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playom/999-multibots-telegraf/src/core/supabase/client.ts:2:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playom/999-multibots-telegraf/src/core/supabase/index.ts:1:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getBotsFromSupabase.test.ts:12:22)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusHook (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:281:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:246:5)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"core/supabase getBotsFromSupabase logs error and returns empty array when supabaseAdmin throws exception","status":"failed","title":"logs error and returns empty array when supabaseAdmin throws exception"}]},{"numFailingTests":3,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172279369,"runtime":1209,"slow":false,"start":1745172278160},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/handleSelectStars.test.ts","failureMessage":"  ● handleSelectStars › renders a single row of three stars in English\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    - Expected\n    + Received\n\n      \"Choose the number of stars to buy:\",\n    - Object {\n    + Markup {\n        \"reply_markup\": Object {\n          \"inline_keyboard\": Array [\n            Array [\n              Object {\n                \"callback_data\": \"top_up_10\",\n    -           \"text\": \"10⭐️\",\n    +           \"hide\": false,\n    +           \"text\": \"⭐️ 10\",\n              },\n    +       ],\n    +       Array [\n              Object {\n                \"callback_data\": \"top_up_20\",\n    -           \"text\": \"20⭐️\",\n    +           \"hide\": false,\n    +           \"text\": \"⭐️ 20\",\n              },\n    +       ],\n    +       Array [\n              Object {\n                \"callback_data\": \"top_up_30\",\n    -           \"text\": \"30⭐️\",\n    +           \"hide\": false,\n    +           \"text\": \"⭐️ 30\",\n              },\n            ],\n          ],\n        },\n      },\n\n    Number of calls: 1\n\n      12 |   it('renders a single row of three stars in English', async () => {\n      13 |     await handleSelectStars({ ctx: ctx as any, starAmounts: [10, 20, 30], isRu: false })\n    > 14 |     expect(ctx.reply).toHaveBeenCalledWith(\n         |                       ^\n      15 |       'Choose the number of stars to buy:',\n      16 |       {\n      17 |         reply_markup: {\n\n      at __tests__/handlers/handleSelectStars.test.ts:14:23\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● handleSelectStars › renders a single row of two stars in Russian\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    - Expected\n    + Received\n\n      \"Выберите количество звезд для покупки:\",\n    - Object {\n    + Markup {\n        \"reply_markup\": Object {\n          \"inline_keyboard\": Array [\n            Array [\n              Object {\n                \"callback_data\": \"top_up_5\",\n    -           \"text\": \"5⭐️\",\n    +           \"hide\": false,\n    +           \"text\": \"⭐️ 5\",\n              },\n    +       ],\n    +       Array [\n              Object {\n                \"callback_data\": \"top_up_15\",\n    -           \"text\": \"15⭐️\",\n    +           \"hide\": false,\n    +           \"text\": \"⭐️ 15\",\n              },\n            ],\n          ],\n        },\n      },\n\n    Number of calls: 1\n\n      30 |   it('renders a single row of two stars in Russian', async () => {\n      31 |     await handleSelectStars({ ctx: ctx as any, starAmounts: [5, 15], isRu: true })\n    > 32 |     expect(ctx.reply).toHaveBeenCalledWith(\n         |                       ^\n      33 |       'Выберите количество звезд для покупки:',\n      34 |       {\n      35 |         reply_markup: {\n\n      at __tests__/handlers/handleSelectStars.test.ts:32:23\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● handleSelectStars › renders multiple rows with leftover items\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    - Expected\n    + Received\n\n      \"Choose the number of stars to buy:\",\n    - Object {\n    + Markup {\n        \"reply_markup\": Object {\n          \"inline_keyboard\": Array [\n            Array [\n              Object {\n                \"callback_data\": \"top_up_1\",\n    -           \"text\": \"1⭐️\",\n    +           \"hide\": false,\n    +           \"text\": \"⭐️ 1\",\n              },\n    +       ],\n    +       Array [\n              Object {\n                \"callback_data\": \"top_up_2\",\n    -           \"text\": \"2⭐️\",\n    +           \"hide\": false,\n    +           \"text\": \"⭐️ 2\",\n              },\n    +       ],\n    +       Array [\n              Object {\n                \"callback_data\": \"top_up_3\",\n    -           \"text\": \"3⭐️\",\n    +           \"hide\": false,\n    +           \"text\": \"⭐️ 3\",\n              },\n            ],\n            Array [\n              Object {\n                \"callback_data\": \"top_up_4\",\n    -           \"text\": \"4⭐️\",\n    +           \"hide\": false,\n    +           \"text\": \"⭐️ 4\",\n              },\n            ],\n          ],\n        },\n      },\n\n    Number of calls: 1\n\n      47 |   it('renders multiple rows with leftover items', async () => {\n      48 |     await handleSelectStars({ ctx: ctx as any, starAmounts: [1, 2, 3, 4], isRu: false })\n    > 49 |     expect(ctx.reply).toHaveBeenCalledWith(\n         |                       ^\n      50 |       'Choose the number of stars to buy:',\n      51 |       {\n      52 |         reply_markup: {\n\n      at __tests__/handlers/handleSelectStars.test.ts:49:23\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["handleSelectStars"],"duration":46,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n- Expected\n+ Received\n\n  \"Choose the number of stars to buy:\",\n- Object {\n+ Markup {\n    \"reply_markup\": Object {\n      \"inline_keyboard\": Array [\n        Array [\n          Object {\n            \"callback_data\": \"top_up_10\",\n-           \"text\": \"10⭐️\",\n+           \"hide\": false,\n+           \"text\": \"⭐️ 10\",\n          },\n+       ],\n+       Array [\n          Object {\n            \"callback_data\": \"top_up_20\",\n-           \"text\": \"20⭐️\",\n+           \"hide\": false,\n+           \"text\": \"⭐️ 20\",\n          },\n+       ],\n+       Array [\n          Object {\n            \"callback_data\": \"top_up_30\",\n-           \"text\": \"30⭐️\",\n+           \"hide\": false,\n+           \"text\": \"⭐️ 30\",\n          },\n        ],\n      ],\n    },\n  },\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/handlers/handleSelectStars.test.ts:14:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"handleSelectStars renders a single row of three stars in English","status":"failed","title":"renders a single row of three stars in English"},{"ancestorTitles":["handleSelectStars"],"duration":12,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n- Expected\n+ Received\n\n  \"Выберите количество звезд для покупки:\",\n- Object {\n+ Markup {\n    \"reply_markup\": Object {\n      \"inline_keyboard\": Array [\n        Array [\n          Object {\n            \"callback_data\": \"top_up_5\",\n-           \"text\": \"5⭐️\",\n+           \"hide\": false,\n+           \"text\": \"⭐️ 5\",\n          },\n+       ],\n+       Array [\n          Object {\n            \"callback_data\": \"top_up_15\",\n-           \"text\": \"15⭐️\",\n+           \"hide\": false,\n+           \"text\": \"⭐️ 15\",\n          },\n        ],\n      ],\n    },\n  },\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/handlers/handleSelectStars.test.ts:32:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"handleSelectStars renders a single row of two stars in Russian","status":"failed","title":"renders a single row of two stars in Russian"},{"ancestorTitles":["handleSelectStars"],"duration":52,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n- Expected\n+ Received\n\n  \"Choose the number of stars to buy:\",\n- Object {\n+ Markup {\n    \"reply_markup\": Object {\n      \"inline_keyboard\": Array [\n        Array [\n          Object {\n            \"callback_data\": \"top_up_1\",\n-           \"text\": \"1⭐️\",\n+           \"hide\": false,\n+           \"text\": \"⭐️ 1\",\n          },\n+       ],\n+       Array [\n          Object {\n            \"callback_data\": \"top_up_2\",\n-           \"text\": \"2⭐️\",\n+           \"hide\": false,\n+           \"text\": \"⭐️ 2\",\n          },\n+       ],\n+       Array [\n          Object {\n            \"callback_data\": \"top_up_3\",\n-           \"text\": \"3⭐️\",\n+           \"hide\": false,\n+           \"text\": \"⭐️ 3\",\n          },\n        ],\n        Array [\n          Object {\n            \"callback_data\": \"top_up_4\",\n-           \"text\": \"4⭐️\",\n+           \"hide\": false,\n+           \"text\": \"⭐️ 4\",\n          },\n        ],\n      ],\n    },\n  },\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/handlers/handleSelectStars.test.ts:49:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"handleSelectStars renders multiple rows with leftover items","status":"failed","title":"renders multiple rows with leftover items"},{"ancestorTitles":["handleSelectStars"],"duration":14,"failureMessages":[],"fullName":"handleSelectStars throws error when ctx.reply fails","status":"passed","title":"throws error when ctx.reply fails"}]},{"numFailingTests":1,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172280198,"runtime":1361,"slow":false,"start":1745172278837},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/services/uploadVideoToServer.test.ts","failureMessage":"  ● uploadVideoToServer › posts to LOCAL_SERVER_URL when in dev\n\n    expect(received).resolves.toBeUndefined()\n\n    Received promise rejected instead of resolved\n    Rejected to value: [TypeError: Cannot read properties of undefined (reading 'data')]\n\n      38 |     mockedAxios.post.mockResolvedValue({ data: {} })\n      39 |     const req = { videoUrl: 'v', telegram_id: '1', fileName: 'f' }\n    > 40 |     await expect(uploadDev(req)).resolves.toBeUndefined()\n         |           ^\n      41 |     expect(mockedAxios.post).toHaveBeenCalledWith(\n      42 |       'http://localhost/video/upload',\n      43 |       req,\n\n      at expect (node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:113:15)\n      at __tests__/services/uploadVideoToServer.test.ts:40:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/services/uploadVideoToServer.test.ts:34:58)\n","testResults":[{"ancestorTitles":["uploadVideoToServer"],"duration":73,"failureMessages":[],"fullName":"uploadVideoToServer posts video upload request to server URL in production","status":"passed","title":"posts video upload request to server URL in production"},{"ancestorTitles":["uploadVideoToServer"],"duration":21,"failureMessages":["Error: expect(received).resolves.toBeUndefined()\n\nReceived promise rejected instead of resolved\nRejected to value: [TypeError: Cannot read properties of undefined (reading 'data')]\n    at expect (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:113:15)\n    at /Users/playom/999-multibots-telegraf/__tests__/services/uploadVideoToServer.test.ts:40:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/services/uploadVideoToServer.test.ts:34:58)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"uploadVideoToServer posts to LOCAL_SERVER_URL when in dev","status":"failed","title":"posts to LOCAL_SERVER_URL when in dev"},{"ancestorTitles":["uploadVideoToServer"],"duration":11,"failureMessages":[],"fullName":"uploadVideoToServer throws and logs error when axios.post fails","status":"passed","title":"throws and logs error when axios.post fails"}]},{"numFailingTests":2,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172280381,"runtime":1317,"slow":false,"start":1745172279064},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/handleTrainingCost.test.ts","failureMessage":"  ● handleTrainingCost › should prompt and set leaveScene=true when balance is insufficient (RU)\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: 4, Any<Object>\n\n    Number of calls: 0\n\n      34 |\n      35 |     const result = await handleTrainingCost(ctx, steps, isRu)\n    > 36 |     expect(calculateCostInStars).toHaveBeenCalledWith(steps, expect.any(Object))\n         |                                  ^\n      37 |     expect(getUserBalance).toHaveBeenCalledWith(123)\n      38 |     expect(ctx.reply).toHaveBeenCalledWith(\n      39 |       expect.stringContaining('❌ Недостаточно звезд для обучения модели!'),\n\n      at __tests__/price/handleTrainingCost.test.ts:36:34\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● handleTrainingCost › should return leaveScene=false when balance is sufficient\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 1\n    Received: 0.88\n\n      52 |     const result = await handleTrainingCost(ctx, steps, false)\n      53 |     expect(result.leaveScene).toBe(false)\n    > 54 |     expect(result.trainingCostInStars).toBe(steps * 0.25)\n         |                                        ^\n      55 |     expect(result.currentBalance).toBe(steps * 0.25 + 10)\n      56 |     expect(ctx.reply).not.toHaveBeenCalled()\n      57 |   })\n\n      at __tests__/price/handleTrainingCost.test.ts:54:40\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["handleTrainingCost"],"duration":3,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: 4, Any<Object>\n\nNumber of calls: 0\n    at /Users/playom/999-multibots-telegraf/__tests__/price/handleTrainingCost.test.ts:36:34\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"handleTrainingCost should prompt and set leaveScene=true when balance is insufficient (RU)","status":"failed","title":"should prompt and set leaveScene=true when balance is insufficient (RU)"},{"ancestorTitles":["handleTrainingCost"],"duration":2,"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 1\nReceived: 0.88\n    at /Users/playom/999-multibots-telegraf/__tests__/price/handleTrainingCost.test.ts:54:40\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"handleTrainingCost should return leaveScene=false when balance is sufficient","status":"failed","title":"should return leaveScene=false when balance is sufficient"}]},{"numFailingTests":2,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172280457,"runtime":1151,"slow":false,"start":1745172279306},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/menu/cancelMenu.test.ts","failureMessage":"  ● cancelMenu › creates keyboard with Cancel in English\n\n    expect(received).toEqual(expected) // deep equality\n\n    - Expected  - 0\n    + Received  + 1\n\n      Array [\n        Array [\n          Object {\n    +       \"hide\": false,\n            \"text\": \"Cancel\",\n          },\n        ],\n      ]\n\n       5 |     const markup = cancelMenu(false)\n       6 |     // @ts-ignore\n    >  7 |     expect(markup.reply_markup.keyboard).toEqual([[{ text: 'Cancel' }]])\n         |                                          ^\n       8 |   })\n       9 |\n      10 |   it('creates keyboard with Отмена in Russian', () => {\n\n      at Object.<anonymous> (__tests__/menu/cancelMenu.test.ts:7:42)\n\n  ● cancelMenu › creates keyboard with Отмена in Russian\n\n    expect(received).toEqual(expected) // deep equality\n\n    - Expected  - 0\n    + Received  + 1\n\n      Array [\n        Array [\n          Object {\n    +       \"hide\": false,\n            \"text\": \"Отмена\",\n          },\n        ],\n      ]\n\n      11 |     const markup = cancelMenu(true)\n      12 |     // @ts-ignore\n    > 13 |     expect(markup.reply_markup.keyboard).toEqual([[{ text: 'Отмена' }]])\n         |                                          ^\n      14 |   })\n      15 | })\n\n      at Object.<anonymous> (__tests__/menu/cancelMenu.test.ts:13:42)\n","testResults":[{"ancestorTitles":["cancelMenu"],"duration":9,"failureMessages":["Error: expect(received).toEqual(expected) // deep equality\n\n- Expected  - 0\n+ Received  + 1\n\n  Array [\n    Array [\n      Object {\n+       \"hide\": false,\n        \"text\": \"Cancel\",\n      },\n    ],\n  ]\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/menu/cancelMenu.test.ts:7:42)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"cancelMenu creates keyboard with Cancel in English","status":"failed","title":"creates keyboard with Cancel in English"},{"ancestorTitles":["cancelMenu"],"duration":3,"failureMessages":["Error: expect(received).toEqual(expected) // deep equality\n\n- Expected  - 0\n+ Received  + 1\n\n  Array [\n    Array [\n      Object {\n+       \"hide\": false,\n        \"text\": \"Отмена\",\n      },\n    ],\n  ]\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/menu/cancelMenu.test.ts:13:42)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"cancelMenu creates keyboard with Отмена in Russian","status":"failed","title":"creates keyboard with Отмена in Russian"}]},{"numFailingTests":4,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172280790,"runtime":1313,"slow":false,"start":1745172279477},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getTranslation.test.ts","failureMessage":"  ● getTranslation › returns translation when first fetch succeeds\n\n    expect(received).toEqual(expected) // deep equality\n\n    - Expected  - 0\n    + Received  + 1\n\n      Object {\n    +   \"buttons\": Array [],\n        \"translation\": \"t1\",\n        \"url\": \"u1\",\n      }\n\n      37 |     mockSingle.mockResolvedValue({ data: { translation: 't1', url: 'u1' }, error: null })\n      38 |     const res = await getTranslation({ key, ctx, bot_name: 'bot1' })\n    > 39 |     expect(res).toEqual({ translation: 't1', url: 'u1' })\n         |                 ^\n      40 |   })\n      41 |\n      42 |   it('falls back to default bot when first fetch errors and default succeeds', async () => {\n\n      at Object.<anonymous> (__tests__/core/supabase/getTranslation.test.ts:39:17)\n      at fulfilled (__tests__/core/supabase/getTranslation.test.ts:4:58)\n\n  ● getTranslation › falls back to default bot when first fetch errors and default succeeds\n\n    expect(received).toEqual(expected) // deep equality\n\n    - Expected  - 0\n    + Received  + 1\n\n      Object {\n    +   \"buttons\": Array [],\n        \"translation\": \"t2\",\n        \"url\": \"u2\",\n      }\n\n      47 |     const res = await getTranslation({ key, ctx, bot_name: undefined })\n      48 |     expect(gtbt).toHaveBeenCalledWith('tok1')\n    > 49 |     expect(res).toEqual({ translation: 't2', url: 'u2' })\n         |                 ^\n      50 |   })\n      51 |\n      52 |   it('returns fallback when both fetches error', async () => {\n\n      at Object.<anonymous> (__tests__/core/supabase/getTranslation.test.ts:49:17)\n      at fulfilled (__tests__/core/supabase/getTranslation.test.ts:4:58)\n\n  ● getTranslation › returns fallback when both fetches error\n\n    expect(received).toEqual(expected) // deep equality\n\n    - Expected  - 1\n    + Received  + 2\n\n      Object {\n    -   \"translation\": \"Добро пожаловать в NeuroBot! Бот готов помочь вам с нейросетями.\",\n    +   \"buttons\": Array [],\n    +   \"translation\": \"Добро пожаловать! Бот готов помочь.\",\n        \"url\": \"\",\n      }\n\n      53 |     mockSingle.mockResolvedValue({ data: null, error: { message: 'e' } })\n      54 |     const res = await getTranslation({ key, ctx, bot_name: undefined })\n    > 55 |     expect(res).toEqual(expectedFallback)\n         |                 ^\n      56 |   })\n      57 |\n      58 |   it('returns fallback on exception', async () => {\n\n      at Object.<anonymous> (__tests__/core/supabase/getTranslation.test.ts:55:17)\n      at fulfilled (__tests__/core/supabase/getTranslation.test.ts:4:58)\n\n  ● getTranslation › returns fallback on exception\n\n    expect(received).toEqual(expected) // deep equality\n\n    - Expected  - 1\n    + Received  + 2\n\n      Object {\n    -   \"translation\": \"Добро пожаловать в NeuroBot! Бот готов помочь вам с нейросетями.\",\n    +   \"buttons\": Array [],\n    +   \"translation\": \"Добро пожаловать! Бот готов помочь.\",\n        \"url\": \"\",\n      }\n\n      59 |     mockSelect.mockImplementation(() => { throw new Error('oops') })\n      60 |     const res = await getTranslation({ key, ctx, bot_name: 'bot1' })\n    > 61 |     expect(res).toEqual(expectedFallback)\n         |                 ^\n      62 |   })\n      63 | })\n\n      at Object.<anonymous> (__tests__/core/supabase/getTranslation.test.ts:61:17)\n      at fulfilled (__tests__/core/supabase/getTranslation.test.ts:4:58)\n","testResults":[{"ancestorTitles":["getTranslation"],"duration":31,"failureMessages":["Error: expect(received).toEqual(expected) // deep equality\n\n- Expected  - 0\n+ Received  + 1\n\n  Object {\n+   \"buttons\": Array [],\n    \"translation\": \"t1\",\n    \"url\": \"u1\",\n  }\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getTranslation.test.ts:39:17)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getTranslation.test.ts:4:58)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"getTranslation returns translation when first fetch succeeds","status":"failed","title":"returns translation when first fetch succeeds"},{"ancestorTitles":["getTranslation"],"duration":8,"failureMessages":["Error: expect(received).toEqual(expected) // deep equality\n\n- Expected  - 0\n+ Received  + 1\n\n  Object {\n+   \"buttons\": Array [],\n    \"translation\": \"t2\",\n    \"url\": \"u2\",\n  }\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getTranslation.test.ts:49:17)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getTranslation.test.ts:4:58)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"getTranslation falls back to default bot when first fetch errors and default succeeds","status":"failed","title":"falls back to default bot when first fetch errors and default succeeds"},{"ancestorTitles":["getTranslation"],"duration":39,"failureMessages":["Error: expect(received).toEqual(expected) // deep equality\n\n- Expected  - 1\n+ Received  + 2\n\n  Object {\n-   \"translation\": \"Добро пожаловать в NeuroBot! Бот готов помочь вам с нейросетями.\",\n+   \"buttons\": Array [],\n+   \"translation\": \"Добро пожаловать! Бот готов помочь.\",\n    \"url\": \"\",\n  }\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getTranslation.test.ts:55:17)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getTranslation.test.ts:4:58)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"getTranslation returns fallback when both fetches error","status":"failed","title":"returns fallback when both fetches error"},{"ancestorTitles":["getTranslation"],"duration":60,"failureMessages":["Error: expect(received).toEqual(expected) // deep equality\n\n- Expected  - 1\n+ Received  + 2\n\n  Object {\n-   \"translation\": \"Добро пожаловать в NeuroBot! Бот готов помочь вам с нейросетями.\",\n+   \"buttons\": Array [],\n+   \"translation\": \"Добро пожаловать! Бот готов помочь.\",\n    \"url\": \"\",\n  }\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getTranslation.test.ts:61:17)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getTranslation.test.ts:4:58)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"getTranslation returns fallback on exception","status":"failed","title":"returns fallback on exception"}]},{"numFailingTests":5,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172280851,"runtime":1732,"slow":false,"start":1745172279119},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/digitalAvatarBodyWizardV2.test.ts","failureMessage":"  ● digitalAvatarBodyWizardV2 › первый шаг: отправляет сообщение со стоимостью и вызывает next()\n\n    TypeError: step0 is not a function\n\n      62 |     menu.mockReturnValue({ reply_markup: { keyboard: [['step']] } })\n      63 |     // @ts-ignore\n    > 64 |     await step0(ctx, jest.fn())\n         |           ^\n      65 |     // Проверяем вызовы\n      66 |     expect(calc).toHaveBeenCalledTimes(stepsOpt.length)\n      67 |     expect(genMsg).toHaveBeenCalledWith([5, 5, 5], true)\n\n      at __tests__/scenes/digitalAvatarBodyWizardV2.test.ts:64:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/digitalAvatarBodyWizardV2.test.ts:46:85)\n\n  ● digitalAvatarBodyWizardV2 › второй шаг: при валидном вводе шагов переходит в trainFluxModelWizard\n\n    TypeError: step1 is not a function\n\n      85 |     })\n      86 |     // @ts-ignore\n    > 87 |     await step1(ctx, jest.fn())\n         |           ^\n      88 |     expect(ctx.session.steps).toBe(2)\n      89 |     expect(costHelper).toHaveBeenCalledWith(ctx, 2, false)\n      90 |     expect(ctx.scene.enter).toHaveBeenCalledWith('trainFluxModelWizard')\n\n      at __tests__/scenes/digitalAvatarBodyWizardV2.test.ts:87:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/digitalAvatarBodyWizardV2.test.ts:73:90)\n\n  ● digitalAvatarBodyWizardV2 › второй шаг: при leaveScene=true выходит из сцены\n\n    TypeError: step1 is not a function\n\n      105 |     })\n      106 |     // @ts-ignore\n    > 107 |     await step1(ctx, jest.fn())\n          |           ^\n      108 |     expect(ctx.scene.leave).toHaveBeenCalled()\n      109 |   })\n      110 |\n\n      at __tests__/scenes/digitalAvatarBodyWizardV2.test.ts:107:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/digitalAvatarBodyWizardV2.test.ts:93:69)\n\n  ● digitalAvatarBodyWizardV2 › второй шаг: невалидный ввод и отмена => выход из сцены\n\n    TypeError: step1 is not a function\n\n      119 |     cancel.mockResolvedValueOnce(true)\n      120 |     // @ts-ignore\n    > 121 |     await step1(ctx, jest.fn())\n          |           ^\n      122 |     expect(ctx.scene.leave).toHaveBeenCalled()\n      123 |   })\n      124 |\n\n      at __tests__/scenes/digitalAvatarBodyWizardV2.test.ts:121:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/digitalAvatarBodyWizardV2.test.ts:111:75)\n\n  ● digitalAvatarBodyWizardV2 › второй шаг: невалидный ввод без отмены => просит выбрать шаги\n\n    TypeError: step1 is not a function\n\n      133 |     cancel.mockResolvedValueOnce(false)\n      134 |     // @ts-ignore\n    > 135 |     await step1(ctx, jest.fn())\n          |           ^\n      136 |     expect(ctx.reply).toHaveBeenCalledWith(\n      137 |       '🔢 Please select the number of steps to proceed with model training.'\n      138 |     )\n\n      at __tests__/scenes/digitalAvatarBodyWizardV2.test.ts:135:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/digitalAvatarBodyWizardV2.test.ts:125:82)\n","testResults":[{"ancestorTitles":["digitalAvatarBodyWizardV2"],"duration":4,"failureMessages":["TypeError: step0 is not a function\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/digitalAvatarBodyWizardV2.test.ts:64:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/digitalAvatarBodyWizardV2.test.ts:46:85)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"digitalAvatarBodyWizardV2 первый шаг: отправляет сообщение со стоимостью и вызывает next()","status":"failed","title":"первый шаг: отправляет сообщение со стоимостью и вызывает next()"},{"ancestorTitles":["digitalAvatarBodyWizardV2"],"duration":2,"failureMessages":["TypeError: step1 is not a function\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/digitalAvatarBodyWizardV2.test.ts:87:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/digitalAvatarBodyWizardV2.test.ts:73:90)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"digitalAvatarBodyWizardV2 второй шаг: при валидном вводе шагов переходит в trainFluxModelWizard","status":"failed","title":"второй шаг: при валидном вводе шагов переходит в trainFluxModelWizard"},{"ancestorTitles":["digitalAvatarBodyWizardV2"],"duration":1,"failureMessages":["TypeError: step1 is not a function\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/digitalAvatarBodyWizardV2.test.ts:107:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/digitalAvatarBodyWizardV2.test.ts:93:69)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"digitalAvatarBodyWizardV2 второй шаг: при leaveScene=true выходит из сцены","status":"failed","title":"второй шаг: при leaveScene=true выходит из сцены"},{"ancestorTitles":["digitalAvatarBodyWizardV2"],"duration":1,"failureMessages":["TypeError: step1 is not a function\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/digitalAvatarBodyWizardV2.test.ts:121:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/digitalAvatarBodyWizardV2.test.ts:111:75)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"digitalAvatarBodyWizardV2 второй шаг: невалидный ввод и отмена => выход из сцены","status":"failed","title":"второй шаг: невалидный ввод и отмена => выход из сцены"},{"ancestorTitles":["digitalAvatarBodyWizardV2"],"duration":0,"failureMessages":["TypeError: step1 is not a function\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/digitalAvatarBodyWizardV2.test.ts:135:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/digitalAvatarBodyWizardV2.test.ts:125:82)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"digitalAvatarBodyWizardV2 второй шаг: невалидный ввод без отмены => просит выбрать шаги","status":"failed","title":"второй шаг: невалидный ввод без отмены => просит выбрать шаги"}]},{"numFailingTests":5,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172280717,"runtime":1473,"slow":false,"start":1745172279244},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/utils/pulse.test.ts","failureMessage":"  ● pulse helper › sends photo when image is provided\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"-4166575919\", {\"source\": Any<Buffer>}, {\"caption\": StringContaining \"test prompt\"}\n\n    Number of calls: 0\n\n      29 |   it('sends photo when image is provided', async () => {\n      30 |     await pulse(ctx, image, prompt, command)\n    > 31 |     expect(ctx.telegram.sendPhoto).toHaveBeenCalledWith(\n         |                                    ^\n      32 |       '-4166575919',\n      33 |       { source: expect.any(Buffer) },\n      34 |       { caption: expect.stringContaining(prompt) }\n\n      at __tests__/utils/pulse.test.ts:31:36\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● pulse helper › sends message when image is null\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"-4166575919\", StringContaining \"использовал команду\"\n\n    Number of calls: 0\n\n      38 |   it('sends message when image is null', async () => {\n      39 |     await pulse(ctx, null, prompt, command)\n    > 40 |     expect(ctx.telegram.sendMessage).toHaveBeenCalledWith(\n         |                                      ^\n      41 |       '-4166575919',\n      42 |       expect.stringContaining('использовал команду')\n      43 |     )\n\n      at __tests__/utils/pulse.test.ts:40:38\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● pulse helper › retries sendPhoto on migrate_to_chat_id error\n\n    expect(jest.fn()).toHaveBeenCalledTimes(expected)\n\n    Expected number of calls: 2\n    Received number of calls: 0\n\n      51 |       .mockResolvedValue(undefined)\n      52 |     await pulse(ctx, image, prompt, command)\n    > 53 |     expect(ctx.telegram.sendPhoto).toHaveBeenCalledTimes(2)\n         |                                    ^\n      54 |     expect(ctx.telegram.sendPhoto).toHaveBeenLastCalledWith(\n      55 |       'new_chat',\n      56 |       { source: expect.any(Buffer) },\n\n      at __tests__/utils/pulse.test.ts:53:36\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● pulse helper › retries sendMessage on migrate_to_chat_id error\n\n    expect(jest.fn()).toHaveBeenCalledTimes(expected)\n\n    Expected number of calls: 2\n    Received number of calls: 0\n\n      66 |       .mockResolvedValue(undefined)\n      67 |     await pulse(ctx, null, prompt, command)\n    > 68 |     expect(ctx.telegram.sendMessage).toHaveBeenCalledTimes(2)\n         |                                      ^\n      69 |     expect(ctx.telegram.sendMessage).toHaveBeenLastCalledWith(\n      70 |       'new_chat',\n      71 |       expect.stringContaining('использовал команду')\n\n      at __tests__/utils/pulse.test.ts:68:38\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● pulse helper › throws on non-migration error\n\n    expect(received).rejects.toThrow()\n\n    Received promise resolved instead of rejected\n    Resolved to value: undefined\n\n      77 |     randomError.response = { parameters: {} }\n      78 |     ctx.telegram.sendMessage = jest.fn().mockRejectedValue(randomError)\n    > 79 |     await expect(pulse(ctx, null, prompt, command))\n         |           ^\n      80 |       .rejects.toThrow('Ошибка при отправке пульса')\n      81 |   })\n      82 | })\n\n      at expect (node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:113:15)\n      at __tests__/utils/pulse.test.ts:79:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/utils/pulse.test.ts:75:50)\n","testResults":[{"ancestorTitles":["pulse helper"],"duration":69,"failureMessages":[],"fullName":"pulse helper does nothing in development environment","status":"passed","title":"does nothing in development environment"},{"ancestorTitles":["pulse helper"],"duration":32,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"-4166575919\", {\"source\": Any<Buffer>}, {\"caption\": StringContaining \"test prompt\"}\n\nNumber of calls: 0\n    at /Users/playom/999-multibots-telegraf/__tests__/utils/pulse.test.ts:31:36\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"pulse helper sends photo when image is provided","status":"failed","title":"sends photo when image is provided"},{"ancestorTitles":["pulse helper"],"duration":1,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"-4166575919\", StringContaining \"использовал команду\"\n\nNumber of calls: 0\n    at /Users/playom/999-multibots-telegraf/__tests__/utils/pulse.test.ts:40:38\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"pulse helper sends message when image is null","status":"failed","title":"sends message when image is null"},{"ancestorTitles":["pulse helper"],"duration":1,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledTimes(expected)\n\nExpected number of calls: 2\nReceived number of calls: 0\n    at /Users/playom/999-multibots-telegraf/__tests__/utils/pulse.test.ts:53:36\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"pulse helper retries sendPhoto on migrate_to_chat_id error","status":"failed","title":"retries sendPhoto on migrate_to_chat_id error"},{"ancestorTitles":["pulse helper"],"duration":2,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledTimes(expected)\n\nExpected number of calls: 2\nReceived number of calls: 0\n    at /Users/playom/999-multibots-telegraf/__tests__/utils/pulse.test.ts:68:38\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"pulse helper retries sendMessage on migrate_to_chat_id error","status":"failed","title":"retries sendMessage on migrate_to_chat_id error"},{"ancestorTitles":["pulse helper"],"duration":4,"failureMessages":["Error: expect(received).rejects.toThrow()\n\nReceived promise resolved instead of rejected\nResolved to value: undefined\n    at expect (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:113:15)\n    at /Users/playom/999-multibots-telegraf/__tests__/utils/pulse.test.ts:79:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/utils/pulse.test.ts:75:50)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"pulse helper throws on non-migration error","status":"failed","title":"throws on non-migration error"}]},{"numFailingTests":3,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172281506,"runtime":2519,"slow":false,"start":1745172278987},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/startScene.test.ts","failureMessage":"  ● startScene › должна отправить приветственное сообщение с фото и клавиатурой\n\n    TypeError: Cannot read properties of undefined (reading 'username')\n\n      21 |\n      22 |     const isRu = ctx.from?.language_code === 'ru'\n    > 23 |     const botName = ctx.botInfo.username\n         |                                 ^\n      24 |\n      25 |     logger.info({\n      26 |       message: '📡 [StartScene] Получение перевода для стартового сообщения',\n\n      at username (src/scenes/startScene/index.ts:23:33)\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at __awaiter (src/scenes/startScene/index.ts:11:15)\n      at __tests__/scenes/startScene.test.ts:59:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/startScene.test.ts:51:83)\n\n  ● startScene › должна перейти на menuScene при наличии подписки\n\n    TypeError: secondHandler is not a function\n\n      87 |     const secondHandler = startScene.steps[1]\n      88 |     // @ts-ignore - игнорируем ошибку типов для тестов\n    > 89 |     await secondHandler(ctx)\n         |           ^\n      90 |\n      91 |     // Проверяем, что был осуществлен переход на menuScene\n      92 |     expect(ctx.scene.enter).toHaveBeenCalledWith('menuScene')\n\n      at __tests__/scenes/startScene.test.ts:89:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/startScene.test.ts:75:69)\n\n  ● startScene › должна перейти на subscriptionScene при отсутствии подписки\n\n    TypeError: secondHandler is not a function\n\n      107 |     const secondHandler = startScene.steps[1]\n      108 |     // @ts-ignore - игнорируем ошибку типов для тестов\n    > 109 |     await secondHandler(ctx)\n          |           ^\n      110 |\n      111 |     // Проверяем, что был осуществлен переход на subscriptionScene\n      112 |     expect(ctx.scene.enter).toHaveBeenCalledWith('subscriptionScene')\n\n      at __tests__/scenes/startScene.test.ts:109:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/startScene.test.ts:95:80)\n","testResults":[{"ancestorTitles":["startScene"],"duration":6,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'username')\n    at username (/Users/playom/999-multibots-telegraf/src/scenes/startScene/index.ts:23:33)\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at __awaiter (/Users/playom/999-multibots-telegraf/src/scenes/startScene/index.ts:11:15)\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/startScene.test.ts:59:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/startScene.test.ts:51:83)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"startScene должна отправить приветственное сообщение с фото и клавиатурой","status":"failed","title":"должна отправить приветственное сообщение с фото и клавиатурой"},{"ancestorTitles":["startScene"],"duration":2,"failureMessages":["TypeError: secondHandler is not a function\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/startScene.test.ts:89:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/startScene.test.ts:75:69)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"startScene должна перейти на menuScene при наличии подписки","status":"failed","title":"должна перейти на menuScene при наличии подписки"},{"ancestorTitles":["startScene"],"duration":1,"failureMessages":["TypeError: secondHandler is not a function\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/startScene.test.ts:109:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/startScene.test.ts:95:80)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"startScene должна перейти на subscriptionScene при отсутствии подписки","status":"failed","title":"должна перейти на subscriptionScene при отсутствии подписки"}]},{"numFailingTests":2,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172281848,"runtime":1439,"slow":false,"start":1745172280409},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/config/indexExports.test.ts","failureMessage":"  ● config index exports › defaults CREDENTIALS to false and NODE_ENV undefined\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: false\n    Received: true\n\n      16 |   it('defaults CREDENTIALS to false and NODE_ENV undefined', () => {\n      17 |     const config = require('../../src/config')\n    > 18 |     expect(config.CREDENTIALS).toBe(false)\n         |                                ^\n      19 |     expect(config.NODE_ENV).toBeUndefined()\n      20 |   })\n      21 |\n\n      at Object.<anonymous> (__tests__/config/indexExports.test.ts:18:32)\n\n  ● config index exports › sets isSupabaseConfigured to false when supabase vars missing\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: false\n    Received: true\n\n      47 |     process.env.SUPABASE_SERVICE_ROLE_KEY = 'role'\n      48 |     const config = require('../../src/config')\n    > 49 |     expect(config.isSupabaseConfigured).toBe(false)\n         |                                         ^\n      50 |   })\n      51 | })\n\n      at Object.<anonymous> (__tests__/config/indexExports.test.ts:49:41)\n","testResults":[{"ancestorTitles":["config index exports"],"duration":53,"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: false\nReceived: true\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/config/indexExports.test.ts:18:32)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"config index exports defaults CREDENTIALS to false and NODE_ENV undefined","status":"failed","title":"defaults CREDENTIALS to false and NODE_ENV undefined"},{"ancestorTitles":["config index exports"],"duration":41,"failureMessages":[],"fullName":"config index exports parses CREDENTIALS from env","status":"passed","title":"parses CREDENTIALS from env"},{"ancestorTitles":["config index exports"],"duration":129,"failureMessages":[],"fullName":"config index exports exports PORT and WEBHOOK_URL when set","status":"passed","title":"exports PORT and WEBHOOK_URL when set"},{"ancestorTitles":["config index exports"],"duration":28,"failureMessages":[],"fullName":"config index exports sets isSupabaseConfigured to true when all supabase vars are present","status":"passed","title":"sets isSupabaseConfigured to true when all supabase vars are present"},{"ancestorTitles":["config index exports"],"duration":37,"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: false\nReceived: true\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/config/indexExports.test.ts:49:41)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"config index exports sets isSupabaseConfigured to false when supabase vars missing","status":"failed","title":"sets isSupabaseConfigured to false when supabase vars missing"}]},{"numFailingTests":1,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172282077,"runtime":1606,"slow":false,"start":1745172280471},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/replicate/index.test.ts","failureMessage":"  ● core/replicate index › modelPricing has entries for all defined models\n\n    expect(received).toHaveProperty(path)\n\n    Expected path: \"black-forest-labs/flux-1.1-pro-ultra\"\n    Received path: []\n\n    Received value: {\"black-forest-labs/flux-1.1-pro\": \"$0.040 / image\", \"black-forest-labs/flux-1.1-pro-ultra\": \"$0.060 / image\", \"black-forest-labs/flux-canny-dev\": \"$0.025 / image\", \"black-forest-labs/flux-canny-pro\": \"$0.050 / image\", \"black-forest-labs/flux-depth-dev\": \"$0.025 / image\", \"black-forest-labs/flux-depth-pro\": \"$0.050 / image\", \"black-forest-labs/flux-dev\": \"$0.025 / image\", \"black-forest-labs/flux-dev-lora\": \"$0.032 / image\", \"black-forest-labs/flux-fill-dev\": \"$0.040 / image\", \"black-forest-labs/flux-fill-pro\": \"$0.050 / image\", \"black-forest-labs/flux-pro\": \"$0.055 / image\", \"black-forest-labs/flux-redux-dev\": \"$0.025 / image\", \"black-forest-labs/flux-redux-schnell\": \"$0.003 / image\", \"black-forest-labs/flux-schnell\": \"$0.003 / image\", \"black-forest-labs/flux-schnell-lora\": \"$0.020 / image\", \"ideogram-ai/ideogram-v2\": \"$0.080 / image\", \"ideogram-ai/ideogram-v2-turbo\": \"$0.050 / image\", \"luma/photon\": \"$0.030 / image\", \"luma/photon-flash\": \"$0.010 / image\", \"recraft-ai/recraft-20b\": \"$0.022 / image\", \"recraft-ai/recraft-20b-svg\": \"$0.044 / image\", \"recraft-ai/recraft-v3\": \"$0.040 / image\", \"recraft-ai/recraft-v3-svg\": \"$0.080 / image\", \"stability-ai/stable-diffusion-3\": \"$0.035 / image\", \"stability-ai/stable-diffusion-3.5-large\": \"$0.065 / image\", \"stability-ai/stable-diffusion-3.5-large-turbo\": \"$0.040 / image\", \"stability-ai/stable-diffusion-3.5-medium\": \"$0.035 / image\"}\n\n      57 |     // For each model config, ensure its key exists in pricing map\n      58 |     Object.values(models).forEach((mc) => {\n    > 59 |       expect(modelPricing).toHaveProperty(mc.key)\n         |                            ^\n      60 |     })\n      61 |   })\n      62 |\n\n      at __tests__/core/replicate/index.test.ts:59:28\n          at Array.forEach (<anonymous>)\n      at Object.<anonymous> (__tests__/core/replicate/index.test.ts:58:27)\n","testResults":[{"ancestorTitles":["core/replicate index"],"duration":9,"failureMessages":[],"fullName":"core/replicate index initializes Replicate with auth from env","status":"passed","title":"initializes Replicate with auth from env"},{"ancestorTitles":["core/replicate index"],"duration":1,"failureMessages":[],"fullName":"core/replicate index exports modelPricing mapping","status":"passed","title":"exports modelPricing mapping"},{"ancestorTitles":["core/replicate index"],"duration":44,"failureMessages":[],"fullName":"core/replicate index models.getInput returns correct dimensions for various aspect ratios","status":"passed","title":"models.getInput returns correct dimensions for various aspect ratios"},{"ancestorTitles":["core/replicate index"],"duration":5,"failureMessages":["Error: expect(received).toHaveProperty(path)\n\nExpected path: \"black-forest-labs/flux-1.1-pro-ultra\"\nReceived path: []\n\nReceived value: {\"black-forest-labs/flux-1.1-pro\": \"$0.040 / image\", \"black-forest-labs/flux-1.1-pro-ultra\": \"$0.060 / image\", \"black-forest-labs/flux-canny-dev\": \"$0.025 / image\", \"black-forest-labs/flux-canny-pro\": \"$0.050 / image\", \"black-forest-labs/flux-depth-dev\": \"$0.025 / image\", \"black-forest-labs/flux-depth-pro\": \"$0.050 / image\", \"black-forest-labs/flux-dev\": \"$0.025 / image\", \"black-forest-labs/flux-dev-lora\": \"$0.032 / image\", \"black-forest-labs/flux-fill-dev\": \"$0.040 / image\", \"black-forest-labs/flux-fill-pro\": \"$0.050 / image\", \"black-forest-labs/flux-pro\": \"$0.055 / image\", \"black-forest-labs/flux-redux-dev\": \"$0.025 / image\", \"black-forest-labs/flux-redux-schnell\": \"$0.003 / image\", \"black-forest-labs/flux-schnell\": \"$0.003 / image\", \"black-forest-labs/flux-schnell-lora\": \"$0.020 / image\", \"ideogram-ai/ideogram-v2\": \"$0.080 / image\", \"ideogram-ai/ideogram-v2-turbo\": \"$0.050 / image\", \"luma/photon\": \"$0.030 / image\", \"luma/photon-flash\": \"$0.010 / image\", \"recraft-ai/recraft-20b\": \"$0.022 / image\", \"recraft-ai/recraft-20b-svg\": \"$0.044 / image\", \"recraft-ai/recraft-v3\": \"$0.040 / image\", \"recraft-ai/recraft-v3-svg\": \"$0.080 / image\", \"stability-ai/stable-diffusion-3\": \"$0.035 / image\", \"stability-ai/stable-diffusion-3.5-large\": \"$0.065 / image\", \"stability-ai/stable-diffusion-3.5-large-turbo\": \"$0.040 / image\", \"stability-ai/stable-diffusion-3.5-medium\": \"$0.035 / image\"}\n    at /Users/playom/999-multibots-telegraf/__tests__/core/replicate/index.test.ts:59:28\n    at Array.forEach (<anonymous>)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/replicate/index.test.ts:58:27)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"core/replicate index modelPricing has entries for all defined models","status":"failed","title":"modelPricing has entries for all defined models"},{"ancestorTitles":["core/replicate index"],"duration":96,"failureMessages":[],"fullName":"core/replicate index getInput works for all models","status":"passed","title":"getInput works for all models"}]},{"numFailingTests":2,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172282107,"runtime":1857,"slow":false,"start":1745172280250},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/services/generateVoiceAvatar.test.ts","failureMessage":"  ● generateVoiceAvatar › fallback branch when ELESTIO_URL not set\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"Функция создания голосового аватара временно недоступна.\"\n\n    Number of calls: 0\n\n      34 |   test('fallback branch when ELESTIO_URL not set', async () => {\n      35 |     const response = await generateVoiceAvatar('img', 'prompt', '42', ctx, true, 'bot')\n    > 36 |     expect(ctx.reply).toHaveBeenCalledWith('Функция создания голосового аватара временно недоступна.')\n         |                       ^\n      37 |     expect(response).toEqual({ success: false, message: 'Функция временно недоступна' })\n      38 |   })\n      39 |\n\n      at __tests__/services/generateVoiceAvatar.test.ts:36:23\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● generateVoiceAvatar › production branch calls axios.post and returns data\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    - Expected\n    + Received\n\n    - \"https://api.prod/generate/voice-avatar\",\n    + \"http://localhost:3000/generate/voice-avatar\",\n      {\"bot_name\": \"botName\", \"imageUrl\": \"imgUrl\", \"is_ru\": false, \"prompt\": \"desc\", \"telegram_id\": \"99\", \"username\": \"user\"},\n      {\"headers\": {\"Content-Type\": \"application/json\", \"x-secret-key\": \"secret\"}},\n\n    Number of calls: 1\n\n      52 |     const result = await generateVoiceAvatar('imgUrl', 'desc', '99', ctx2, false, 'botName')\n      53 |     expect(result).toEqual({ success: true, message: 'ok' })\n    > 54 |     expect(axios.post).toHaveBeenCalledWith(\n         |                        ^\n      55 |       'https://api.prod/generate/voice-avatar',\n      56 |       {\n      57 |         imageUrl: 'imgUrl', prompt: 'desc', telegram_id: '99', username: 'user', is_ru: false, bot_name: 'botName'\n\n      at __tests__/services/generateVoiceAvatar.test.ts:54:24\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["generateVoiceAvatar"],"duration":43,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"Функция создания голосового аватара временно недоступна.\"\n\nNumber of calls: 0\n    at /Users/playom/999-multibots-telegraf/__tests__/services/generateVoiceAvatar.test.ts:36:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"generateVoiceAvatar fallback branch when ELESTIO_URL not set","status":"failed","title":"fallback branch when ELESTIO_URL not set"},{"ancestorTitles":["generateVoiceAvatar"],"duration":12,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n- Expected\n+ Received\n\n- \"https://api.prod/generate/voice-avatar\",\n+ \"http://localhost:3000/generate/voice-avatar\",\n  {\"bot_name\": \"botName\", \"imageUrl\": \"imgUrl\", \"is_ru\": false, \"prompt\": \"desc\", \"telegram_id\": \"99\", \"username\": \"user\"},\n  {\"headers\": {\"Content-Type\": \"application/json\", \"x-secret-key\": \"secret\"}},\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/services/generateVoiceAvatar.test.ts:54:24\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"generateVoiceAvatar production branch calls axios.post and returns data","status":"failed","title":"production branch calls axios.post and returns data"},{"ancestorTitles":["generateVoiceAvatar"],"duration":13,"failureMessages":[],"fullName":"generateVoiceAvatar error branch calls sendGenericErrorMessage and returns null","status":"passed","title":"error branch calls sendGenericErrorMessage and returns null"}]},{"numFailingTests":4,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172283890,"runtime":2987,"slow":false,"start":1745172280903},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getReferalsCountAndUserData.unit.test.ts","failureMessage":"  ● getReferalsCountAndUserData › returns defaults when user fetch errors\n\n    expect(received).toEqual(expected) // deep equality\n\n    - Expected  - 1\n    + Received  + 1\n\n      Object {\n        \"count\": 0,\n        \"isExist\": false,\n        \"level\": 0,\n    -   \"subscription\": \"stars\",\n    +   \"subscriptionType\": \"stars\",\n        \"userData\": null,\n      }\n\n      18 |     ;(supabase.from as jest.Mock).mockReturnValue({ select: selectMock })\n      19 |     const result = await getReferalsCountAndUserData(telegram_id)\n    > 20 |     expect(result).toEqual({ count: 0, subscription: 'stars', level: 0, userData: null, isExist: false })\n         |                    ^\n      21 |   })\n      22 |\n      23 |   it('returns defaults when referals fetch errors', async () => {\n\n      at __tests__/core/supabase/getReferalsCountAndUserData.unit.test.ts:20:20\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● getReferalsCountAndUserData › returns defaults when referals fetch errors\n\n    expect(received).toEqual(expected) // deep equality\n\n    - Expected  - 4\n    + Received  + 8\n\n      Object {\n        \"count\": 0,\n    -   \"isExist\": false,\n    -   \"level\": 0,\n    -   \"subscription\": \"stars\",\n    -   \"userData\": null,\n    +   \"isExist\": true,\n    +   \"level\": 2,\n    +   \"subscriptionType\": \"stars\",\n    +   \"userData\": Object {\n    +     \"level\": 2,\n    +     \"subscription\": \"gold\",\n    +     \"user_id\": 5,\n    +   },\n      }\n\n      33 |     fromMock.mockReturnValueOnce({ select: selectRefs })\n      34 |     const result = await getReferalsCountAndUserData(telegram_id)\n    > 35 |     expect(result).toEqual({ count: 0, subscription: 'stars', level: 0, userData: null, isExist: false })\n         |                    ^\n      36 |   })\n      37 |\n      38 |   it('returns correct data on success', async () => {\n\n      at __tests__/core/supabase/getReferalsCountAndUserData.unit.test.ts:35:20\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● getReferalsCountAndUserData › returns correct data on success\n\n    expect(received).toEqual(expected) // deep equality\n\n    - Expected  - 1\n    + Received  + 1\n\n    @@ -1,10 +1,10 @@\n      Object {\n        \"count\": 2,\n        \"isExist\": true,\n        \"level\": 3,\n    -   \"subscription\": \"silver\",\n    +   \"subscriptionType\": \"stars\",\n        \"userData\": Object {\n          \"level\": 3,\n          \"subscription\": \"silver\",\n          \"user_id\": 10,\n        },\n\n      47 |     fromMock.mockReturnValueOnce({ select: selectRefs })\n      48 |     const result = await getReferalsCountAndUserData(telegram_id)\n    > 49 |     expect(result).toEqual({ count: 2, level: 3, subscription: 'silver', userData, isExist: true })\n         |                    ^\n      50 |   })\n      51 |\n      52 |   it('returns defaults on exception', async () => {\n\n      at __tests__/core/supabase/getReferalsCountAndUserData.unit.test.ts:49:20\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● getReferalsCountAndUserData › returns defaults on exception\n\n    expect(received).toEqual(expected) // deep equality\n\n    - Expected  - 1\n    + Received  + 1\n\n      Object {\n        \"count\": 0,\n        \"isExist\": false,\n        \"level\": 0,\n    -   \"subscription\": \"stars\",\n    +   \"subscriptionType\": \"stars\",\n        \"userData\": null,\n      }\n\n      53 |     ;(supabase.from as jest.Mock).mockImplementation(() => { throw new Error('boom') })\n      54 |     const result = await getReferalsCountAndUserData(telegram_id)\n    > 55 |     expect(result).toEqual({ count: 0, subscription: 'stars', level: 0, userData: null, isExist: false })\n         |                    ^\n      56 |     expect(logger.error).toHaveBeenCalledWith('Ошибка в getReferalsCountAndUserData:', expect.any(Error))\n      57 |   })\n      58 | })\n\n      at __tests__/core/supabase/getReferalsCountAndUserData.unit.test.ts:55:20\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["getReferalsCountAndUserData"],"duration":505,"failureMessages":["Error: expect(received).toEqual(expected) // deep equality\n\n- Expected  - 1\n+ Received  + 1\n\n  Object {\n    \"count\": 0,\n    \"isExist\": false,\n    \"level\": 0,\n-   \"subscription\": \"stars\",\n+   \"subscriptionType\": \"stars\",\n    \"userData\": null,\n  }\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/getReferalsCountAndUserData.unit.test.ts:20:20\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"getReferalsCountAndUserData returns defaults when user fetch errors","status":"failed","title":"returns defaults when user fetch errors"},{"ancestorTitles":["getReferalsCountAndUserData"],"duration":134,"failureMessages":["Error: expect(received).toEqual(expected) // deep equality\n\n- Expected  - 4\n+ Received  + 8\n\n  Object {\n    \"count\": 0,\n-   \"isExist\": false,\n-   \"level\": 0,\n-   \"subscription\": \"stars\",\n-   \"userData\": null,\n+   \"isExist\": true,\n+   \"level\": 2,\n+   \"subscriptionType\": \"stars\",\n+   \"userData\": Object {\n+     \"level\": 2,\n+     \"subscription\": \"gold\",\n+     \"user_id\": 5,\n+   },\n  }\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/getReferalsCountAndUserData.unit.test.ts:35:20\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"getReferalsCountAndUserData returns defaults when referals fetch errors","status":"failed","title":"returns defaults when referals fetch errors"},{"ancestorTitles":["getReferalsCountAndUserData"],"duration":11,"failureMessages":["Error: expect(received).toEqual(expected) // deep equality\n\n- Expected  - 1\n+ Received  + 1\n\n@@ -1,10 +1,10 @@\n  Object {\n    \"count\": 2,\n    \"isExist\": true,\n    \"level\": 3,\n-   \"subscription\": \"silver\",\n+   \"subscriptionType\": \"stars\",\n    \"userData\": Object {\n      \"level\": 3,\n      \"subscription\": \"silver\",\n      \"user_id\": 10,\n    },\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/getReferalsCountAndUserData.unit.test.ts:49:20\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"getReferalsCountAndUserData returns correct data on success","status":"failed","title":"returns correct data on success"},{"ancestorTitles":["getReferalsCountAndUserData"],"duration":38,"failureMessages":["Error: expect(received).toEqual(expected) // deep equality\n\n- Expected  - 1\n+ Received  + 1\n\n  Object {\n    \"count\": 0,\n    \"isExist\": false,\n    \"level\": 0,\n-   \"subscription\": \"stars\",\n+   \"subscriptionType\": \"stars\",\n    \"userData\": null,\n  }\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/getReferalsCountAndUserData.unit.test.ts:55:20\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"getReferalsCountAndUserData returns defaults on exception","status":"failed","title":"returns defaults on exception"}]},{"numFailingTests":2,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172284829,"runtime":3182,"slow":false,"start":1745172281647},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/menu/startMenu.test.ts","failureMessage":"  ● startMenu › replies with Russian text and keyboard\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"Выберите действие в меню:\", ObjectContaining {\"reply_markup\": ObjectContaining {\"keyboard\": [[{\"text\": \"🏠 Главное меню\"}]]}}\n    Received: \"Выберите действие в меню:\", {\"reply_markup\": {\"keyboard\": [[{\"hide\": false, \"text\": \"🏠 Главное меню\"}]], \"resize_keyboard\": true}}\n\n    Number of calls: 1\n\n      12 |   it('replies with Russian text and keyboard', async () => {\n      13 |     await startMenu(ctx as any, true)\n    > 14 |     expect(ctx.reply).toHaveBeenCalledWith(\n         |                       ^\n      15 |       'Выберите действие в меню:',\n      16 |       expect.objectContaining({\n      17 |         reply_markup: expect.objectContaining({\n\n      at __tests__/menu/startMenu.test.ts:14:23\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● startMenu › replies with English text and keyboard\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"Choose an action in the menu:\", ObjectContaining {\"reply_markup\": ObjectContaining {\"keyboard\": [[{\"text\": \"🏠 Main menu\"}]]}}\n    Received: \"Choose an action in the menu:\", {\"reply_markup\": {\"keyboard\": [[{\"hide\": false, \"text\": \"🏠 Main menu\"}]], \"resize_keyboard\": true}}\n\n    Number of calls: 1\n\n      24 |   it('replies with English text and keyboard', async () => {\n      25 |     await startMenu(ctx as any, false)\n    > 26 |     expect(ctx.reply).toHaveBeenCalledWith(\n         |                       ^\n      27 |       'Choose an action in the menu:',\n      28 |       expect.objectContaining({\n      29 |         reply_markup: expect.objectContaining({\n\n      at __tests__/menu/startMenu.test.ts:26:23\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["startMenu"],"duration":12,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"Выберите действие в меню:\", ObjectContaining {\"reply_markup\": ObjectContaining {\"keyboard\": [[{\"text\": \"🏠 Главное меню\"}]]}}\nReceived: \"Выберите действие в меню:\", {\"reply_markup\": {\"keyboard\": [[{\"hide\": false, \"text\": \"🏠 Главное меню\"}]], \"resize_keyboard\": true}}\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/menu/startMenu.test.ts:14:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"startMenu replies with Russian text and keyboard","status":"failed","title":"replies with Russian text and keyboard"},{"ancestorTitles":["startMenu"],"duration":1,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"Choose an action in the menu:\", ObjectContaining {\"reply_markup\": ObjectContaining {\"keyboard\": [[{\"text\": \"🏠 Main menu\"}]]}}\nReceived: \"Choose an action in the menu:\", {\"reply_markup\": {\"keyboard\": [[{\"hide\": false, \"text\": \"🏠 Main menu\"}]], \"resize_keyboard\": true}}\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/menu/startMenu.test.ts:26:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"startMenu replies with English text and keyboard","status":"failed","title":"replies with English text and keyboard"}]},{"numFailingTests":3,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172284880,"runtime":2705,"slow":false,"start":1745172282175},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/bot/getBotByName.test.ts","failureMessage":"  ● getBotByName › returns error when bot name not in configuration\n\n    TypeError: Cannot read properties of undefined (reading 'error')\n\n      14 | const loadResult = config({ path: envPath })\n      15 |\n    > 16 | if (loadResult.error) {\n         |                ^\n      17 |   console.error(\n      18 |     `[CONFIG] CRITICAL ERROR: Failed to load primary .env file from ${envPath}. Error: ${loadResult.error.message}`\n      19 |   )\n\n      at Object.error (src/config/index.ts:16:16)\n      at Object.require (src/core/bot/index.ts:5:1)\n      at Object.<anonymous> (__tests__/core/bot/getBotByName.test.ts:24:30)\n\n  ● getBotByName › returns bot instance when bot name exists\n\n    TypeError: Cannot read properties of undefined (reading 'error')\n\n      14 | const loadResult = config({ path: envPath })\n      15 |\n    > 16 | if (loadResult.error) {\n         |                ^\n      17 |   console.error(\n      18 |     `[CONFIG] CRITICAL ERROR: Failed to load primary .env file from ${envPath}. Error: ${loadResult.error.message}`\n      19 |   )\n\n      at Object.error (src/config/index.ts:16:16)\n      at Object.require (src/core/bot/index.ts:5:1)\n      at Object.<anonymous> (__tests__/core/bot/getBotByName.test.ts:32:48)\n\n  ● getBotByName › recreates bot instance when existing one lacks telegram.sendMessage\n\n    TypeError: Cannot read properties of undefined (reading 'error')\n\n      14 | const loadResult = config({ path: envPath })\n      15 |\n    > 16 | if (loadResult.error) {\n         |                ^\n      17 |   console.error(\n      18 |     `[CONFIG] CRITICAL ERROR: Failed to load primary .env file from ${envPath}. Error: ${loadResult.error.message}`\n      19 |   )\n\n      at Object.error (src/config/index.ts:16:16)\n      at Object.require (src/core/bot/index.ts:5:1)\n      at Object.<anonymous> (__tests__/core/bot/getBotByName.test.ts:42:17)\n","testResults":[{"ancestorTitles":["getBotByName"],"duration":65,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'error')\n    at Object.error (/Users/playom/999-multibots-telegraf/src/config/index.ts:16:16)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playom/999-multibots-telegraf/src/core/bot/index.ts:5:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/bot/getBotByName.test.ts:24:30)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"getBotByName returns error when bot name not in configuration","status":"failed","title":"returns error when bot name not in configuration"},{"ancestorTitles":["getBotByName"],"duration":55,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'error')\n    at Object.error (/Users/playom/999-multibots-telegraf/src/config/index.ts:16:16)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playom/999-multibots-telegraf/src/core/bot/index.ts:5:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/bot/getBotByName.test.ts:32:48)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"getBotByName returns bot instance when bot name exists","status":"failed","title":"returns bot instance when bot name exists"},{"ancestorTitles":["getBotByName"],"duration":24,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'error')\n    at Object.error (/Users/playom/999-multibots-telegraf/src/config/index.ts:16:16)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.require (/Users/playom/999-multibots-telegraf/src/core/bot/index.ts:5:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/bot/getBotByName.test.ts:42:17)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"getBotByName recreates bot instance when existing one lacks telegram.sendMessage","status":"failed","title":"recreates bot instance when existing one lacks telegram.sendMessage"}]},{"numFailingTests":3,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172284903,"runtime":2802,"slow":false,"start":1745172282101},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.unit.test.ts","failureMessage":"  ● updateUserSubscription › resolves data on successful update\n\n    Не удалось обновить подписку пользователя\n\n      17 |   } catch (error) {\n      18 |     console.error('Ошибка при обновлении подписки пользователя:', error)\n    > 19 |     throw new Error('Не удалось обновить подписку пользователя')\n         |           ^\n      20 |   }\n      21 | }\n      22 |\n\n      at src/core/supabase/updateUserSubscription.ts:19:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at __awaiter (src/core/supabase/updateUserSubscription.ts:6:20)\n      at __tests__/core/supabase/updateUserSubscription.unit.test.ts:21:48\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/core/supabase/updateUserSubscription.unit.test.ts:15:55)\n\n  ● updateUserSubscription › throws error when update returns error\n\n    expect(received).rejects.toBe(expected) // Object.is equality\n\n    - Expected  - 3\n    + Received  + 1\n\n    - Object {\n    -   \"message\": \"errSub\",\n    - }\n    + [Error: Не удалось обновить подписку пользователя]\n\n      30 |     const updateMock = jest.fn().mockResolvedValue({ data: null, error: err })\n      31 |     ;(supabase.from as jest.Mock).mockReturnValue({ update: updateMock, eq: eqMock })\n    > 32 |     await expect(updateUserSubscription(userId, subscription)).rejects.toBe(err)\n         |                                                                        ^\n      33 |   })\n      34 |\n      35 |   it('throws error on unexpected exception', async () => {\n\n      at Object.toBe (node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n      at __tests__/core/supabase/updateUserSubscription.unit.test.ts:32:72\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/core/supabase/updateUserSubscription.unit.test.ts:27:59)\n\n  ● updateUserSubscription › throws error on unexpected exception\n\n    expect(received).rejects.toThrow(expected)\n\n    Expected substring: \"boom\"\n    Received message:   \"Не удалось обновить подписку пользователя\"\n\n          17 |   } catch (error) {\n          18 |     console.error('Ошибка при обновлении подписки пользователя:', error)\n        > 19 |     throw new Error('Не удалось обновить подписку пользователя')\n             |           ^\n          20 |   }\n          21 | }\n          22 |\n\n      at src/core/supabase/updateUserSubscription.ts:19:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at __awaiter (src/core/supabase/updateUserSubscription.ts:6:20)\n      at __tests__/core/supabase/updateUserSubscription.unit.test.ts:37:40\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/core/supabase/updateUserSubscription.unit.test.ts:35:57)\n      at Object.toThrow (node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n      at __tests__/core/supabase/updateUserSubscription.unit.test.ts:37:72\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/core/supabase/updateUserSubscription.unit.test.ts:35:57)\n","testResults":[{"ancestorTitles":["updateUserSubscription"],"duration":64,"failureMessages":["Error: Не удалось обновить подписку пользователя\n    at /Users/playom/999-multibots-telegraf/src/core/supabase/updateUserSubscription.ts:19:11\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at __awaiter (/Users/playom/999-multibots-telegraf/src/core/supabase/updateUserSubscription.ts:6:20)\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.unit.test.ts:21:48\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.unit.test.ts:15:55)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"updateUserSubscription resolves data on successful update","status":"failed","title":"resolves data on successful update"},{"ancestorTitles":["updateUserSubscription"],"duration":16,"failureMessages":["Error: expect(received).rejects.toBe(expected) // Object.is equality\n\n- Expected  - 3\n+ Received  + 1\n\n- Object {\n-   \"message\": \"errSub\",\n- }\n+ [Error: Не удалось обновить подписку пользователя]\n    at Object.toBe (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.unit.test.ts:32:72\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.unit.test.ts:27:59)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"updateUserSubscription throws error when update returns error","status":"failed","title":"throws error when update returns error"},{"ancestorTitles":["updateUserSubscription"],"duration":21,"failureMessages":["Error: expect(received).rejects.toThrow(expected)\n\nExpected substring: \"boom\"\nReceived message:   \"Не удалось обновить подписку пользователя\"\n\n      17 |   } catch (error) {\n      18 |     console.error('Ошибка при обновлении подписки пользователя:', error)\n    > 19 |     throw new Error('Не удалось обновить подписку пользователя')\n         |           ^\n      20 |   }\n      21 | }\n      22 |\n\n      at src/core/supabase/updateUserSubscription.ts:19:11\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at __awaiter (src/core/supabase/updateUserSubscription.ts:6:20)\n      at __tests__/core/supabase/updateUserSubscription.unit.test.ts:37:40\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/core/supabase/updateUserSubscription.unit.test.ts:35:57)\n    at Object.toThrow (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.unit.test.ts:37:72\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserSubscription.unit.test.ts:35:57)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"updateUserSubscription throws error on unexpected exception","status":"failed","title":"throws error on unexpected exception"}]},{"numFailingTests":1,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172284972,"runtime":3996,"slow":false,"start":1745172280976},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/bot/createBotByName.test.ts","failureMessage":"  ● createBotByName › returns undefined and logs error when bot instance not found\n\n    Property `error` does not exist in the provided object\n\n      51 |     // Spy on logger.error\n      52 |     const logger = require('@/utils/logger')\n    > 53 |     const spyErr = jest.spyOn(logger, 'error').mockImplementation(() => {})\n         |                         ^\n      54 |     const result = await createBotByName(botName)\n      55 |     expect(result).toBeUndefined()\n      56 |     expect(spyErr).toHaveBeenCalledWith(\n\n      at ModuleMocker.spyOn (node_modules/.pnpm/jest-mock@29.7.0/node_modules/jest-mock/build/index.js:731:13)\n      at Object.<anonymous> (__tests__/core/bot/createBotByName.test.ts:53:25)\n      at __tests__/core/bot/createBotByName.test.ts:7:71\n      at Object.<anonymous>.__awaiter (__tests__/core/bot/createBotByName.test.ts:3:12)\n      at Object.<anonymous> (__tests__/core/bot/createBotByName.test.ts:43:81)\n","testResults":[{"ancestorTitles":["createBotByName"],"duration":1241,"failureMessages":[],"fullName":"createBotByName returns token, groupId and bot for valid bot name","status":"passed","title":"returns token, groupId and bot for valid bot name"},{"ancestorTitles":["createBotByName"],"duration":978,"failureMessages":[],"fullName":"createBotByName returns undefined for invalid bot name","status":"passed","title":"returns undefined for invalid bot name"},{"ancestorTitles":["createBotByName"],"duration":233,"failureMessages":["Error: Property `error` does not exist in the provided object\n    at ModuleMocker.spyOn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-mock@29.7.0/node_modules/jest-mock/build/index.js:731:13)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/bot/createBotByName.test.ts:53:25)\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/__tests__/core/bot/createBotByName.test.ts:7:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/playom/999-multibots-telegraf/__tests__/core/bot/createBotByName.test.ts:3:12)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/bot/createBotByName.test.ts:43:81)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"createBotByName returns undefined and logs error when bot instance not found","status":"failed","title":"returns undefined and logs error when bot instance not found"}]},{"numFailingTests":3,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172284947,"runtime":4140,"slow":false,"start":1745172280807},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/neuroPhotoWizardV2.test.ts","failureMessage":"  ● neuroPhotoWizardV2 › step 0: no model replies and leaves\n\n    Property `createHelpCancelKeyboard` does not exist in the provided object\n\n      41 |     const mockReferals = getReferalsCountAndUserData as jest.Mock;\n      42 |     mockReferals.mockResolvedValueOnce({ count: 0, subscription: '', level: 0 });\n    > 43 |     const createKb = jest.spyOn(menu, 'createHelpCancelKeyboard').mockReturnValue({} as any)\n         |                           ^\n      44 |\n      45 |     const step0 = Composer.unwrap(neuroPhotoWizardV2.steps[0])\n      46 |     await step0(ctx, async () => {})\n\n      at ModuleMocker.spyOn (node_modules/.pnpm/jest-mock@29.7.0/node_modules/jest-mock/build/index.js:731:13)\n      at __tests__/scenes/neuroPhotoWizardV2.test.ts:43:27\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/neuroPhotoWizardV2.test.ts:38:56)\n\n  ● neuroPhotoWizardV2 › step 0: with model sends description request and next()\n\n    Property `createHelpCancelKeyboard` does not exist in the provided object\n\n      60 |     const mockCancel = handleHelpCancel as jest.Mock;\n      61 |     mockCancel.mockResolvedValueOnce(false);\n    > 62 |     const createKb = jest.spyOn(menu, 'createHelpCancelKeyboard').mockReturnValue({} as any)\n         |                           ^\n      63 |\n      64 |     const step0 = Composer.unwrap(neuroPhotoWizardV2.steps[0])\n      65 |     await step0(ctx, async () => {})\n\n      at ModuleMocker.spyOn (node_modules/.pnpm/jest-mock@29.7.0/node_modules/jest-mock/build/index.js:731:13)\n      at __tests__/scenes/neuroPhotoWizardV2.test.ts:62:27\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/neuroPhotoWizardV2.test.ts:54:76)\n\n  ● neuroPhotoWizardV2 › step 1: valid prompt generates image and leaves\n\n    Property `handleHelpCancel` does not exist in the provided object\n\n      72 |     ctx.message = { text: 'desc' };\n      73 |     ctx.session.userModel = { trigger_word: 'x' };\n    > 74 |     const handleHelpCancel = jest.spyOn(handlers, 'handleHelpCancel').mockResolvedValue(false)\n         |                                   ^\n      75 |     const getModel = jest.spyOn(supabase, 'getModel').mockResolvedValue('some_model')\n      76 |\n      77 |     const step1 = Composer.unwrap(neuroPhotoWizardV2.steps[1])\n\n      at ModuleMocker.spyOn (node_modules/.pnpm/jest-mock@29.7.0/node_modules/jest-mock/build/index.js:731:13)\n      at __tests__/scenes/neuroPhotoWizardV2.test.ts:74:35\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/scenes/neuroPhotoWizardV2.test.ts:71:68)\n","testResults":[{"ancestorTitles":["neuroPhotoWizardV2"],"duration":15,"failureMessages":["Error: Property `createHelpCancelKeyboard` does not exist in the provided object\n    at ModuleMocker.spyOn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-mock@29.7.0/node_modules/jest-mock/build/index.js:731:13)\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/neuroPhotoWizardV2.test.ts:43:27\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/neuroPhotoWizardV2.test.ts:38:56)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"neuroPhotoWizardV2 step 0: no model replies and leaves","status":"failed","title":"step 0: no model replies and leaves"},{"ancestorTitles":["neuroPhotoWizardV2"],"duration":2,"failureMessages":["Error: Property `createHelpCancelKeyboard` does not exist in the provided object\n    at ModuleMocker.spyOn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-mock@29.7.0/node_modules/jest-mock/build/index.js:731:13)\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/neuroPhotoWizardV2.test.ts:62:27\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/neuroPhotoWizardV2.test.ts:54:76)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"neuroPhotoWizardV2 step 0: with model sends description request and next()","status":"failed","title":"step 0: with model sends description request and next()"},{"ancestorTitles":["neuroPhotoWizardV2"],"duration":1,"failureMessages":["Error: Property `handleHelpCancel` does not exist in the provided object\n    at ModuleMocker.spyOn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-mock@29.7.0/node_modules/jest-mock/build/index.js:731:13)\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/neuroPhotoWizardV2.test.ts:74:35\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/scenes/neuroPhotoWizardV2.test.ts:71:68)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"neuroPhotoWizardV2 step 1: valid prompt generates image and leaves","status":"failed","title":"step 1: valid prompt generates image and leaves"}]},{"numFailingTests":2,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172285220,"runtime":3302,"slow":false,"start":1745172281918},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserLevel.unit.test.ts","failureMessage":"  ● getUserLevel › returns null on supabase error\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    - Expected\n    + Received\n\n    - \"Ошибка при получении уровня пользователя:\",\n    + \"Ошибка в функции getUserLevel:\",\n    - Object {\n    -   \"message\": \"err\",\n    - }\n    + [TypeError: supabase_1.supabase.from(...).select(...).eq is not a function],\n\n    Number of calls: 1\n\n      18 |     const result = await getUserLevel(telegram_id)\n      19 |     expect(result).toBeNull()\n    > 20 |     expect(consoleErrorSpy).toHaveBeenCalledWith('Ошибка при получении уровня пользователя:', { message: 'err' })\n         |                             ^\n      21 |     consoleErrorSpy.mockRestore()\n      22 |   })\n      23 |\n\n      at __tests__/core/supabase/getUserLevel.unit.test.ts:20:29\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● getUserLevel › returns level when data present\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 7\n    Received: null\n\n      28 |     ;(supabase.from as jest.Mock).mockReturnValue({ select: selectMock })\n      29 |     const result = await getUserLevel(telegram_id)\n    > 30 |     expect(result).toBe(7)\n         |                    ^\n      31 |   })\n      32 |\n      33 |   it('returns null when data is null', async () => {\n\n      at __tests__/core/supabase/getUserLevel.unit.test.ts:30:20\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["getUserLevel"],"duration":9,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n- Expected\n+ Received\n\n- \"Ошибка при получении уровня пользователя:\",\n+ \"Ошибка в функции getUserLevel:\",\n- Object {\n-   \"message\": \"err\",\n- }\n+ [TypeError: supabase_1.supabase.from(...).select(...).eq is not a function],\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserLevel.unit.test.ts:20:29\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"getUserLevel returns null on supabase error","status":"failed","title":"returns null on supabase error"},{"ancestorTitles":["getUserLevel"],"duration":2,"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 7\nReceived: null\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserLevel.unit.test.ts:30:20\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"getUserLevel returns level when data present","status":"failed","title":"returns level when data present"},{"ancestorTitles":["getUserLevel"],"duration":2,"failureMessages":[],"fullName":"getUserLevel returns null when data is null","status":"passed","title":"returns null when data is null"},{"ancestorTitles":["getUserLevel"],"duration":8,"failureMessages":[],"fullName":"getUserLevel returns null on exception","status":"passed","title":"returns null on exception"}]},{"numFailingTests":1,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172285825,"runtime":920,"slow":false,"start":1745172284905},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/config/index.test.ts","failureMessage":"  ● src/config/index.ts › exports correct default flags and constants\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: false\n    Received: true\n\n       9 |     expect(config.isDev).toBe(false)\n      10 |     // Credentials flag false when not set\n    > 11 |     expect(config.CREDENTIALS).toBe(false)\n         |                                ^\n      12 |     // Supabase configured flag false without env vars\n      13 |     expect(config.isSupabaseConfigured).toBe(false)\n      14 |     // NODE_ENV should reflect process.env.NODE_ENV (undefined => undefined)\n\n      at Object.<anonymous> (__tests__/config/index.test.ts:11:32)\n","testResults":[{"ancestorTitles":["src/config/index.ts"],"duration":83,"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: false\nReceived: true\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/config/index.test.ts:11:32)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"src/config/index.ts exports correct default flags and constants","status":"failed","title":"exports correct default flags and constants"}]},{"numFailingTests":1,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172285900,"runtime":891,"slow":false,"start":1745172285009},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/config/prod.test.ts","failureMessage":"  ● config production logging block › logs token existence and supabase warning in production\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"BOT_TOKEN_1 exists:\", false\n    Received\n           1: \"--- Debugging .env loading --- \"\n           2: \"[CONFIG] Current Working Directory: /Users/playom/999-multibots-telegraf\"\n           3: \"[CONFIG] Attempting to load primary env file from: /Users/playom/999-multibots-telegraf/.env\"\n\n    Number of calls: 19\n\n      29 |     expect(logSpy).toHaveBeenCalledWith('Bot tokens check in ENV:')\n      30 |     // Should log existence of BOT_TOKEN_1 (undefined => false)\n    > 31 |     expect(logSpy).toHaveBeenCalledWith('BOT_TOKEN_1 exists:', false)\n         |                    ^\n      32 |     // Should warn about missing Supabase config\n      33 |     expect(warnSpy).toHaveBeenCalledWith(\n      34 |       '⚠️ ВНИМАНИЕ: Не настроены параметры Supabase. Боты будут загружены из переменных окружения.'\n\n      at Object.<anonymous> (__tests__/config/prod.test.ts:31:20)\n","testResults":[{"ancestorTitles":["config production logging block"],"duration":52,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"BOT_TOKEN_1 exists:\", false\nReceived\n       1: \"--- Debugging .env loading --- \"\n       2: \"[CONFIG] Current Working Directory: /Users/playom/999-multibots-telegraf\"\n       3: \"[CONFIG] Attempting to load primary env file from: /Users/playom/999-multibots-telegraf/.env\"\n\nNumber of calls: 19\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/config/prod.test.ts:31:20)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"config production logging block logs token existence and supabase warning in production","status":"failed","title":"logs token existence and supabase warning in production"}]},{"numFailingTests":2,"numPassingTests":0,"numPendingTests":4,"numTodoTests":0,"perfStats":{"end":1745172285996,"runtime":1701,"slow":false,"start":1745172284295},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/utils/logger.test.ts","failureMessage":"  ● logSecurityEvent › logs security event with default severity warn\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"Событие безопасности: EVT\", ObjectContaining {\"eventType\": \"EVT\", \"foo\": \"bar\"}\n\n    Number of calls: 0\n\n      73 |     logSecurityEvent('EVT', details)\n      74 |     // Проверяем вызов метода у мока securityLogger\n    > 75 |     expect(mockedSecurityLogger.warn).toHaveBeenCalledWith(\n         |                                       ^\n      76 |       'Событие безопасности: EVT',\n      77 |       expect.objectContaining({ ...details, eventType: 'EVT' })\n      78 |     )\n\n      at Object.<anonymous> (__tests__/utils/logger.test.ts:75:39)\n\n  ● logSecurityEvent › logs security event with specified severity\n\n    expect(jest.fn()).toHaveBeenCalled()\n\n    Expected number of calls: >= 1\n    Received number of calls:    0\n\n      82 |     logSecurityEvent('INFO_EVT', { a: 1 }, 'info')\n      83 |     // Проверяем вызов метода у мока securityLogger\n    > 84 |     expect(mockedSecurityLogger.info).toHaveBeenCalled()\n         |                                       ^\n      85 |   })\n      86 | })\n\n      at Object.<anonymous> (__tests__/utils/logger.test.ts:84:39)\n","testResults":[{"ancestorTitles":["botLogger"],"duration":null,"failureMessages":[],"fullName":"botLogger info logs with bot name prefix","status":"pending","title":"info logs with bot name prefix"},{"ancestorTitles":["botLogger"],"duration":null,"failureMessages":[],"fullName":"botLogger warn logs with bot name prefix","status":"pending","title":"warn logs with bot name prefix"},{"ancestorTitles":["botLogger"],"duration":null,"failureMessages":[],"fullName":"botLogger error logs with bot name prefix","status":"pending","title":"error logs with bot name prefix"},{"ancestorTitles":["botLogger"],"duration":null,"failureMessages":[],"fullName":"botLogger debug logs with bot name prefix","status":"pending","title":"debug logs with bot name prefix"},{"ancestorTitles":["logSecurityEvent"],"duration":97,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"Событие безопасности: EVT\", ObjectContaining {\"eventType\": \"EVT\", \"foo\": \"bar\"}\n\nNumber of calls: 0\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/utils/logger.test.ts:75:39)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"logSecurityEvent logs security event with default severity warn","status":"failed","title":"logs security event with default severity warn"},{"ancestorTitles":["logSecurityEvent"],"duration":6,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalled()\n\nExpected number of calls: >= 1\nReceived number of calls:    0\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/utils/logger.test.ts:84:39)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"logSecurityEvent logs security event with specified severity","status":"failed","title":"logs security event with specified severity"}]},{"numFailingTests":1,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172285951,"runtime":918,"slow":false,"start":1745172285033},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/bot/getBotByName.error.test.ts","failureMessage":"  ● getBotByName error handling › returns error when recreated bot instance lacks telegram.sendMessage\n\n    TypeError: Cannot read properties of undefined (reading 'error')\n\n      14 | const loadResult = config({ path: envPath })\n      15 |\n    > 16 | if (loadResult.error) {\n         |                ^\n      17 |   console.error(\n      18 |     `[CONFIG] CRITICAL ERROR: Failed to load primary .env file from ${envPath}. Error: ${loadResult.error.message}`\n      19 |   )\n\n      at Object.error (src/config/index.ts:16:16)\n      at Object.require (src/core/bot/index.ts:5:1)\n      at __tests__/core/bot/getBotByName.error.test.ts:33:11\n      at Object.<anonymous> (__tests__/core/bot/getBotByName.error.test.ts:12:10)\n","testResults":[{"ancestorTitles":["getBotByName error handling"],"duration":35,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'error')\n    at Object.error (/Users/playom/999-multibots-telegraf/src/config/index.ts:16:16)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime._generateMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1690:34)\n    at Runtime.requireMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:996:39)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1046:21)\n    at Object.require (/Users/playom/999-multibots-telegraf/src/core/bot/index.ts:5:1)\n    at Runtime._execModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1439:24)\n    at Runtime._loadModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1022:12)\n    at Runtime.requireModule (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:882:12)\n    at Runtime.requireModuleOrMock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1048:21)\n    at /Users/playom/999-multibots-telegraf/__tests__/core/bot/getBotByName.error.test.ts:33:11\n    at Runtime.isolateModules (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1082:7)\n    at Object.isolateModules (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runtime@29.7.0/node_modules/jest-runtime/build/index.js:1992:12)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/bot/getBotByName.error.test.ts:12:10)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"getBotByName error handling returns error when recreated bot instance lacks telegram.sendMessage","status":"failed","title":"returns error when recreated bot instance lacks telegram.sendMessage"}]},{"numFailingTests":1,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172286133,"runtime":1090,"slow":false,"start":1745172285043},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/bot/index.error.test.ts","failureMessage":"  ● core/bot index environment validation › throws error if BOT_TOKEN_TEST_2 is not set\n\n    expect(received).toThrow(expected)\n\n    Expected substring: \"BOT_TOKEN_TEST_2 is not set\"\n    Received message:   \"Cannot read properties of undefined (reading 'error')\"\n\n          14 | const loadResult = config({ path: envPath })\n          15 |\n        > 16 | if (loadResult.error) {\n             |                ^\n          17 |   console.error(\n          18 |     `[CONFIG] CRITICAL ERROR: Failed to load primary .env file from ${envPath}. Error: ${loadResult.error.message}`\n          19 |   )\n\n      at Object.error (src/config/index.ts:16:16)\n      at Object.require (src/core/bot/index.ts:5:1)\n      at __tests__/core/bot/index.error.test.ts:26:9\n      at __tests__/core/bot/index.error.test.ts:25:12\n      at Object.<anonymous> (node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/toThrowMatchers.js:74:11)\n      at Object.throwingMatcher [as toThrow] (node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:320:21)\n      at Object.<anonymous> (__tests__/core/bot/index.error.test.ts:28:8)\n      at Object.<anonymous> (__tests__/core/bot/index.error.test.ts:28:8)\n","testResults":[{"ancestorTitles":["core/bot index environment validation"],"duration":113,"failureMessages":["Error: expect(received).toThrow(expected)\n\nExpected substring: \"BOT_TOKEN_TEST_2 is not set\"\nReceived message:   \"Cannot read properties of undefined (reading 'error')\"\n\n      14 | const loadResult = config({ path: envPath })\n      15 |\n    > 16 | if (loadResult.error) {\n         |                ^\n      17 |   console.error(\n      18 |     `[CONFIG] CRITICAL ERROR: Failed to load primary .env file from ${envPath}. Error: ${loadResult.error.message}`\n      19 |   )\n\n      at Object.error (src/config/index.ts:16:16)\n      at Object.require (src/core/bot/index.ts:5:1)\n      at __tests__/core/bot/index.error.test.ts:26:9\n      at __tests__/core/bot/index.error.test.ts:25:12\n      at Object.<anonymous> (node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/toThrowMatchers.js:74:11)\n      at Object.throwingMatcher [as toThrow] (node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:320:21)\n      at Object.<anonymous> (__tests__/core/bot/index.error.test.ts:28:8)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/bot/index.error.test.ts:28:8)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"core/bot index environment validation throws error if BOT_TOKEN_TEST_2 is not set","status":"failed","title":"throws error if BOT_TOKEN_TEST_2 is not set"}]},{"numFailingTests":1,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172286206,"runtime":1276,"slow":false,"start":1745172284930},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserData.unit.test.ts","failureMessage":"  ● getUserData › throws error on supabase error\n\n    expect(received).rejects.toThrow(expected)\n\n    Expected substring: \"Ошибка при получении данных пользователя: [object Object]\"\n    Received message:   \"Ошибка при получении данных пользователя: err\"\n\n          11 |\n          12 |   if (error) {\n        > 13 |     throw new Error(\n             |           ^\n          14 |       `Ошибка при получении данных пользователя: ${error.message}`\n          15 |     )\n          16 |   }\n\n      at src/core/supabase/getUserData.ts:13:11\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n      at Object.toThrow (node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n      at __tests__/core/supabase/getUserData.unit.test.ts:28:52\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/core/supabase/getUserData.unit.test.ts:25:51)\n","testResults":[{"ancestorTitles":["getUserData"],"duration":28,"failureMessages":["Error: expect(received).rejects.toThrow(expected)\n\nExpected substring: \"Ошибка при получении данных пользователя: [object Object]\"\nReceived message:   \"Ошибка при получении данных пользователя: err\"\n\n      11 |\n      12 |   if (error) {\n    > 13 |     throw new Error(\n         |           ^\n      14 |       `Ошибка при получении данных пользователя: ${error.message}`\n      15 |     )\n      16 |   }\n\n      at src/core/supabase/getUserData.ts:13:11\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at Object.toThrow (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserData.unit.test.ts:28:52\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserData.unit.test.ts:25:51)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"getUserData throws error on supabase error","status":"failed","title":"throws error on supabase error"},{"ancestorTitles":["getUserData"],"duration":2,"failureMessages":[],"fullName":"getUserData returns data when successful","status":"passed","title":"returns data when successful"},{"ancestorTitles":["getUserData"],"duration":2,"failureMessages":[],"fullName":"getUserData returns null when user not found","status":"passed","title":"returns null when user not found"}]},{"numFailingTests":1,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172286334,"runtime":1090,"slow":false,"start":1745172285244},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/middlewares/checkSubscription.test.ts","failureMessage":"  ● checkSubscription › returns true for member statuses\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"@mychannel\", 123\n    Received: \"mychannel\", 123\n\n    Number of calls: 1\n\n      15 |     ;(ctx.telegram.getChatMember as jest.Mock).mockResolvedValue({ status: 'member' })\n      16 |     await expect(checkSubscription(ctx, channel)).resolves.toBe(true)\n    > 17 |     expect(ctx.telegram.getChatMember).toHaveBeenCalledWith('@mychannel', 123)\n         |                                        ^\n      18 |   })\n      19 |\n      20 |   it('returns false for non-member statuses', async () => {\n\n      at __tests__/middlewares/checkSubscription.test.ts:17:40\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["checkSubscription"],"duration":25,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"@mychannel\", 123\nReceived: \"mychannel\", 123\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/middlewares/checkSubscription.test.ts:17:40\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"checkSubscription returns true for member statuses","status":"failed","title":"returns true for member statuses"},{"ancestorTitles":["checkSubscription"],"duration":4,"failureMessages":[],"fullName":"checkSubscription returns false for non-member statuses","status":"passed","title":"returns false for non-member statuses"},{"ancestorTitles":["checkSubscription"],"duration":28,"failureMessages":[],"fullName":"checkSubscription throws error when from.id undefined","status":"passed","title":"throws error when from.id undefined"},{"ancestorTitles":["checkSubscription"],"duration":19,"failureMessages":[],"fullName":"checkSubscription propagates error from getChatMember","status":"passed","title":"propagates error from getChatMember"}]},{"numFailingTests":1,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172286983,"runtime":1035,"slow":false,"start":1745172285948},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/models/imageModelPrices.test.ts","failureMessage":"  ● imageModelPrices mapping › contains pro model with correct costPerImage\n\n    expect(received).toHaveProperty(path)\n\n    Expected path: \"black-forest-labs/flux-1.1-pro\"\n    Received path: []\n\n    Received value: {\"black-forest-labs/flux-1.1-pro\": [Object], \"black-forest-labs/flux-1.1-pro-ultra\": [Object], \"black-forest-labs/flux-canny-dev\": [Object], \"black-forest-labs/flux-canny-pro\": [Object], \"black-forest-labs/flux-depth-dev\": [Object], \"black-forest-labs/flux-depth-pro\": [Object], \"black-forest-labs/flux-dev\": [Object], \"black-forest-labs/flux-dev-lora\": [Object], \"black-forest-labs/flux-fill-dev\": [Object], \"black-forest-labs/flux-fill-pro\": [Object], \"black-forest-labs/flux-pro\": [Object], \"black-forest-labs/flux-redux-dev\": [Object], \"black-forest-labs/flux-redux-schnell\": [Object], \"black-forest-labs/flux-schnell\": [Object], \"black-forest-labs/flux-schnell-lora\": [Object], \"ideogram-ai/ideogram-v2\": [Object], \"ideogram-ai/ideogram-v2-turbo\": [Object], \"luma/photon\": [Object], \"luma/photon-flash\": [Object], \"recraft-ai/recraft-20b\": [Object], \"recraft-ai/recraft-20b-svg\": [Object], \"recraft-ai/recraft-v3\": [Object], \"recraft-ai/recraft-v3-svg\": [Object], \"stability-ai/stable-diffusion-3\": [Object], \"stability-ai/stable-diffusion-3.5-large\": [Object], \"stability-ai/stable-diffusion-3.5-large-turbo\": [Object], \"stability-ai/stable-diffusion-3.5-medium\": [Object]}\n\n       5 |   it('contains pro model with correct costPerImage', () => {\n       6 |     const key = 'black-forest-labs/flux-1.1-pro'\n    >  7 |     expect(imageModelPrices).toHaveProperty(key)\n         |                              ^\n       8 |     const info = imageModelPrices[key]\n       9 |     expect(info.costPerImage).toBe(\n      10 |       calculateFinalImageCostInStars(0.04)\n\n      at Object.<anonymous> (__tests__/price/models/imageModelPrices.test.ts:7:30)\n","testResults":[{"ancestorTitles":["imageModelPrices mapping"],"duration":11,"failureMessages":["Error: expect(received).toHaveProperty(path)\n\nExpected path: \"black-forest-labs/flux-1.1-pro\"\nReceived path: []\n\nReceived value: {\"black-forest-labs/flux-1.1-pro\": [Object], \"black-forest-labs/flux-1.1-pro-ultra\": [Object], \"black-forest-labs/flux-canny-dev\": [Object], \"black-forest-labs/flux-canny-pro\": [Object], \"black-forest-labs/flux-depth-dev\": [Object], \"black-forest-labs/flux-depth-pro\": [Object], \"black-forest-labs/flux-dev\": [Object], \"black-forest-labs/flux-dev-lora\": [Object], \"black-forest-labs/flux-fill-dev\": [Object], \"black-forest-labs/flux-fill-pro\": [Object], \"black-forest-labs/flux-pro\": [Object], \"black-forest-labs/flux-redux-dev\": [Object], \"black-forest-labs/flux-redux-schnell\": [Object], \"black-forest-labs/flux-schnell\": [Object], \"black-forest-labs/flux-schnell-lora\": [Object], \"ideogram-ai/ideogram-v2\": [Object], \"ideogram-ai/ideogram-v2-turbo\": [Object], \"luma/photon\": [Object], \"luma/photon-flash\": [Object], \"recraft-ai/recraft-20b\": [Object], \"recraft-ai/recraft-20b-svg\": [Object], \"recraft-ai/recraft-v3\": [Object], \"recraft-ai/recraft-v3-svg\": [Object], \"stability-ai/stable-diffusion-3\": [Object], \"stability-ai/stable-diffusion-3.5-large\": [Object], \"stability-ai/stable-diffusion-3.5-large-turbo\": [Object], \"stability-ai/stable-diffusion-3.5-medium\": [Object]}\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/price/models/imageModelPrices.test.ts:7:30)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"imageModelPrices mapping contains pro model with correct costPerImage","status":"failed","title":"contains pro model with correct costPerImage"},{"ancestorTitles":["imageModelPrices mapping"],"duration":4,"failureMessages":[],"fullName":"imageModelPrices mapping contains ultra pro model with correct cost","status":"passed","title":"contains ultra pro model with correct cost"}]},{"numFailingTests":1,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172287135,"runtime":1120,"slow":false,"start":1745172286015},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/helpers/delay.test.ts","failureMessage":"  ● delay › resolves after the specified time\n\n    expect(jest.fn()).toHaveBeenCalled()\n\n    Expected number of calls: >= 1\n    Received number of calls:    0\n\n       9 |     promise.then(callback);\n      10 |     jest.advanceTimersByTime(100);\n    > 11 |     expect(callback).toHaveBeenCalled();\n         |                      ^\n      12 |   });\n      13 | });\n\n      at __tests__/helpers/delay.test.ts:11:22\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/helpers/delay.test.ts:6:56)\n","testResults":[{"ancestorTitles":["delay"],"duration":9,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalled()\n\nExpected number of calls: >= 1\nReceived number of calls:    0\n    at /Users/playom/999-multibots-telegraf/__tests__/helpers/delay.test.ts:11:22\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/helpers/delay.test.ts:6:56)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"delay resolves after the specified time","status":"failed","title":"resolves after the specified time"}]},{"numFailingTests":1,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172287136,"runtime":1110,"slow":false,"start":1745172286026},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/commands/getAvailableModels.test.ts","failureMessage":"  ● getAvailableModels › filters only GPT models and sorts them\n\n    expect(received).toEqual(expected) // deep equality\n\n    - Expected  - 2\n    + Received  + 1\n\n      Array [\n    -   \"gpt-3.5\",\n    -   \"gpt-3.5-turbo\",\n        \"gpt-4\",\n        \"gpt-4-turbo\",\n    +   \"gpt-3.5-turbo\",\n      ]\n\n      31 |     const result = await getAvailableModels()\n      32 |     // Expect only ids including 'gpt', excluding 'instruct', '0613'\n    > 33 |     expect(result).toEqual([\n         |                    ^\n      34 |       'gpt-3.5',\n      35 |       'gpt-3.5-turbo',\n      36 |       'gpt-4',\n\n      at __tests__/commands/getAvailableModels.test.ts:33:20\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["getAvailableModels"],"duration":44,"failureMessages":["Error: expect(received).toEqual(expected) // deep equality\n\n- Expected  - 2\n+ Received  + 1\n\n  Array [\n-   \"gpt-3.5\",\n-   \"gpt-3.5-turbo\",\n    \"gpt-4\",\n    \"gpt-4-turbo\",\n+   \"gpt-3.5-turbo\",\n  ]\n    at /Users/playom/999-multibots-telegraf/__tests__/commands/getAvailableModels.test.ts:33:20\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"getAvailableModels filters only GPT models and sorts them","status":"failed","title":"filters only GPT models and sorts them"},{"ancestorTitles":["getAvailableModels"],"duration":50,"failureMessages":[],"fullName":"getAvailableModels returns fallback on error","status":"passed","title":"returns fallback on error"}]},{"numFailingTests":1,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172287352,"runtime":1508,"slow":false,"start":1745172285844},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getAspectRatio.test.ts","failureMessage":"  ● getAspectRatio › returns null when single throws\n\n    exception\n\n      30 |\n      31 |   it('returns null when single throws', async () => {\n    > 32 |     mockSingle.mockRejectedValue(new Error('exception'))\n         |                                  ^\n      33 |     const result = await getAspectRatio(0)\n      34 |     expect(result).toBeNull()\n      35 |   })\n\n      at __tests__/core/supabase/getAspectRatio.test.ts:32:34\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/core/supabase/getAspectRatio.test.ts:31:52)\n","testResults":[{"ancestorTitles":["getAspectRatio"],"duration":130,"failureMessages":[],"fullName":"getAspectRatio returns aspect_ratio when data exists and no error","status":"passed","title":"returns aspect_ratio when data exists and no error"},{"ancestorTitles":["getAspectRatio"],"duration":12,"failureMessages":[],"fullName":"getAspectRatio returns null when supabase returns error","status":"passed","title":"returns null when supabase returns error"},{"ancestorTitles":["getAspectRatio"],"duration":1,"failureMessages":["Error: exception\n    at /Users/playom/999-multibots-telegraf/__tests__/core/supabase/getAspectRatio.test.ts:32:34\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getAspectRatio.test.ts:31:52)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"getAspectRatio returns null when single throws","status":"failed","title":"returns null when single throws"}]},{"numFailingTests":1,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172287453,"runtime":1210,"slow":false,"start":1745172286243},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/utils/url.test.ts","failureMessage":"  ● urlJoin › skips empty or falsy segments\n\n    TypeError: Cannot read properties of null (reading 'startsWith')\n\n      20 |\n      21 |       // Удаляем начальный слеш, если он есть\n    > 22 |       if (normalizedPath.startsWith('/')) {\n         |                          ^\n      23 |         normalizedPath = normalizedPath.slice(1)\n      24 |       }\n      25 |\n\n      at startsWith (src/utils/url.ts:22:26)\n          at Array.map (<anonymous>)\n      at map (src/utils/url.ts:17:6)\n      at Object.<anonymous> (__tests__/utils/url.test.ts:15:19)\n","testResults":[{"ancestorTitles":["urlJoin"],"duration":4,"failureMessages":[],"fullName":"urlJoin joins base URL and paths without extra slashes","status":"passed","title":"joins base URL and paths without extra slashes"},{"ancestorTitles":["urlJoin"],"duration":1,"failureMessages":[],"fullName":"urlJoin returns base URL when no paths provided","status":"passed","title":"returns base URL when no paths provided"},{"ancestorTitles":["urlJoin"],"duration":0,"failureMessages":["TypeError: Cannot read properties of null (reading 'startsWith')\n    at startsWith (/Users/playom/999-multibots-telegraf/src/utils/url.ts:22:26)\n    at Array.map (<anonymous>)\n    at map (/Users/playom/999-multibots-telegraf/src/utils/url.ts:17:6)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/utils/url.test.ts:15:19)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"urlJoin skips empty or falsy segments","status":"failed","title":"skips empty or falsy segments"}]},{"numFailingTests":1,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172287980,"runtime":1821,"slow":false,"start":1745172286159},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/commands/setCommands.test.ts","failureMessage":"  ● setBotCommands › should set commands and return true on success\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    - Expected\n    + Received\n\n    @@ -5,6 +5,10 @@\n        },\n        Object {\n          \"command\": \"menu\",\n          \"description\": \"👤 Menu / Главное меню\",\n        },\n    +   Object {\n    +     \"command\": \"support\",\n    +     \"description\": \"👤 Support / Техподдержка\",\n    +   },\n      ],\n\n    Number of calls: 1\n\n      20 |   it('should set commands and return true on success', async () => {\n      21 |     const result = await setBotCommands(mockBot as Telegraf<MyContext>)\n    > 22 |     expect(mockBot.telegram.setMyCommands).toHaveBeenCalledWith([\n         |                                            ^\n      23 |       { command: 'start', description: '👤 Start / Начать' },\n      24 |       { command: 'menu', description: '👤 Menu / Главное меню' },\n      25 |     ])\n\n      at __tests__/commands/setCommands.test.ts:22:44\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["setBotCommands"],"duration":5,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n- Expected\n+ Received\n\n@@ -5,6 +5,10 @@\n    },\n    Object {\n      \"command\": \"menu\",\n      \"description\": \"👤 Menu / Главное меню\",\n    },\n+   Object {\n+     \"command\": \"support\",\n+     \"description\": \"👤 Support / Техподдержка\",\n+   },\n  ],\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/commands/setCommands.test.ts:22:44\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"setBotCommands should set commands and return true on success","status":"failed","title":"should set commands and return true on success"},{"ancestorTitles":["setBotCommands"],"duration":1,"failureMessages":[],"fullName":"setBotCommands should return false and log error on failure","status":"passed","title":"should return false and log error on failure"}]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/hearsHandlers.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/hearsHandlers.test.ts\u001b[0m:\u001b[93m2\u001b[0m:\u001b[93m10\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2305: \u001b[0mModule '\"../src/bot\"' has no exported member 'hearsHandlers'.\n\n    \u001b[7m2\u001b[0m import { hearsHandlers } from '../src/bot';\n    \u001b[7m \u001b[0m \u001b[91m         ~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/hearsHandlers.test.ts\u001b[0m:\u001b[93m10\u001b[0m:\u001b[93m35\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'messageHandlers' does not exist on type 'Telegram'.\n\n    \u001b[7m10\u001b[0m     const handlers = bot.telegram.messageHandlers;\n    \u001b[7m  \u001b[0m \u001b[91m                                  ~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/hearsHandlers.test.ts\u001b[0m:\u001b[93m14\u001b[0m:\u001b[93m45\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2839: \u001b[0mThis condition will always return 'false' since JavaScript compares objects by reference, not value.\n\n    \u001b[7m14\u001b[0m     const startHandler = handlers.find(h => h.regex?.pattern === /^\\/start/);\n    \u001b[7m  \u001b[0m \u001b[91m                                            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/webhooks.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/webhooks.test.ts\u001b[0m:\u001b[93m14\u001b[0m:\u001b[93m44\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '{ username: string; }' is not assignable to parameter of type 'never'.\n\n    \u001b[7m14\u001b[0m         getMe: jest.fn().mockResolvedValue({ username: 'test_bot' })\n    \u001b[7m  \u001b[0m \u001b[91m                                           ~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":9,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172289942,"runtime":2572,"slow":false,"start":1745172287370},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/utils/config.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["config utils"],"duration":389,"failureMessages":[],"fullName":"config utils validateToken should reject invalid formats","status":"passed","title":"validateToken should reject invalid formats"},{"ancestorTitles":["config utils"],"duration":55,"failureMessages":[],"fullName":"config utils validateToken should accept valid token","status":"passed","title":"validateToken should accept valid token"},{"ancestorTitles":["config utils"],"duration":38,"failureMessages":[],"fullName":"config utils generateSecretKey should return hex string of length 64","status":"passed","title":"generateSecretKey should return hex string of length 64"},{"ancestorTitles":["config utils"],"duration":35,"failureMessages":[],"fullName":"config utils getWebhookConfig should read env variables","status":"passed","title":"getWebhookConfig should read env variables"},{"ancestorTitles":["config utils","loadConfig"],"duration":333,"failureMessages":[],"fullName":"config utils loadConfig should return no bots if no tokens","status":"passed","title":"should return no bots if no tokens"},{"ancestorTitles":["config utils","loadConfig"],"duration":166,"failureMessages":[],"fullName":"config utils loadConfig should include BOT_TOKEN env var","status":"passed","title":"should include BOT_TOKEN env var"},{"ancestorTitles":["config utils","loadBotsConfig"],"duration":180,"failureMessages":[],"fullName":"config utils loadBotsConfig should return empty array when file missing","status":"passed","title":"should return empty array when file missing"},{"ancestorTitles":["config utils","loadBotsConfig"],"duration":91,"failureMessages":[],"fullName":"config utils loadBotsConfig should disable invalid tokens and duplicates","status":"passed","title":"should disable invalid tokens and duplicates"},{"ancestorTitles":["config utils"],"duration":43,"failureMessages":[],"fullName":"config utils loadSecurityConfig should return defaults when no file","status":"passed","title":"loadSecurityConfig should return defaults when no file"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172290025,"runtime":2541,"slow":false,"start":1745172287484},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getVoiceId.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getVoiceId"],"duration":599,"failureMessages":[],"fullName":"getVoiceId returns voice_id when present","status":"passed","title":"returns voice_id when present"},{"ancestorTitles":["getVoiceId"],"duration":379,"failureMessages":[],"fullName":"getVoiceId returns undefined when no data","status":"passed","title":"returns undefined when no data"},{"ancestorTitles":["getVoiceId"],"duration":551,"failureMessages":[],"fullName":"getVoiceId throws when error","status":"passed","title":"throws when error"}]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/integration/robokassa.integration.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/integration/robokassa.integration.test.ts\u001b[0m:\u001b[93m6\u001b[0m:\u001b[93m10\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2459: \u001b[0mModule '\"@/config\"' declares 'config' locally, but it is not exported.\n\n    \u001b[7m6\u001b[0m import { config as appConfig } from '@/config'\n    \u001b[7m \u001b[0m \u001b[91m         ~~~~~~\u001b[0m\n\n      \u001b[96msrc/config/index.ts\u001b[0m:\u001b[93m1\u001b[0m:\u001b[93m10\u001b[0m\n        \u001b[7m1\u001b[0m import { config } from 'dotenv'\n        \u001b[7m \u001b[0m \u001b[96m         ~~~~~~\u001b[0m\n        'config' is declared here.\n    \u001b[96m__tests__/integration/robokassa.integration.test.ts\u001b[0m:\u001b[93m162\u001b[0m:\u001b[93m71\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2304: \u001b[0mCannot find name 'password2'.\n\n    \u001b[7m162\u001b[0m     const signatureValue = calculateRobokassaSignature(outSum, invId, password2)\n    \u001b[7m   \u001b[0m \u001b[91m                                                                      ~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/integration/robokassa.integration.test.ts\u001b[0m:\u001b[93m188\u001b[0m:\u001b[93m7\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2304: \u001b[0mCannot find name 'password2'.\n\n    \u001b[7m188\u001b[0m       password2\n    \u001b[7m   \u001b[0m \u001b[91m      ~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172290159,"runtime":3003,"slow":false,"start":1745172287156},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserSoul.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["updateUserSoul"],"duration":673,"failureMessages":[],"fullName":"updateUserSoul calls update and eq and resolves on success","status":"passed","title":"calls update and eq and resolves on success"},{"ancestorTitles":["updateUserSoul"],"duration":374,"failureMessages":[],"fullName":"updateUserSoul logs and resolves on update error","status":"passed","title":"logs and resolves on update error"},{"ancestorTitles":["updateUserSoul"],"duration":1084,"failureMessages":[],"fullName":"updateUserSoul logs and resolves on exception","status":"passed","title":"logs and resolves on exception"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172291799,"runtime":3521,"slow":false,"start":1745172288278},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/isLimitAi.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["isLimitAi"],"duration":728,"failureMessages":[],"fullName":"isLimitAi returns false when user lookup error","status":"passed","title":"returns false when user lookup error"},{"ancestorTitles":["isLimitAi"],"duration":705,"failureMessages":[],"fullName":"isLimitAi inserts new record when no limitData or stale date and returns false","status":"passed","title":"inserts new record when no limitData or stale date and returns false"},{"ancestorTitles":["isLimitAi"],"duration":430,"failureMessages":[],"fullName":"isLimitAi updates count when under daily limit and returns false","status":"passed","title":"updates count when under daily limit and returns false"},{"ancestorTitles":["isLimitAi"],"duration":505,"failureMessages":[],"fullName":"isLimitAi returns true when daily limit reached","status":"passed","title":"returns true when daily limit reached"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172292429,"runtime":1987,"slow":false,"start":1745172290442},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/setModel.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["setModel"],"duration":741,"failureMessages":[],"fullName":"setModel calls update, eq, and select, and resolves","status":"passed","title":"calls update, eq, and select, and resolves"},{"ancestorTitles":["setModel"],"duration":302,"failureMessages":[],"fullName":"setModel throws when supabase.select rejects","status":"passed","title":"throws when supabase.select rejects"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172292373,"runtime":4381,"slow":false,"start":1745172287992},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/utils/helpersIndex.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["helpers index exports"],"duration":2815,"failureMessages":[],"fullName":"helpers index exports exports isDev based on NODE_ENV","status":"passed","title":"exports isDev based on NODE_ENV"},{"ancestorTitles":["helpers index exports"],"duration":466,"failureMessages":[],"fullName":"helpers index exports re-exports helper functions correctly","status":"passed","title":"re-exports helper functions correctly"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172292459,"runtime":1844,"slow":false,"start":1745172290615},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/incrementBalance.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["incrementBalance"],"duration":476,"failureMessages":[],"fullName":"incrementBalance throws when select errors or no data","status":"passed","title":"throws when select errors or no data"},{"ancestorTitles":["incrementBalance"],"duration":333,"failureMessages":[],"fullName":"incrementBalance resolves when update succeeds","status":"passed","title":"resolves when update succeeds"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172292820,"runtime":2376,"slow":false,"start":1745172290444},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserLevelPlusOne.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["updateUserLevelPlusOne"],"duration":506,"failureMessages":[],"fullName":"updateUserLevelPlusOne increments level and logs success when no error","status":"passed","title":"increments level and logs success when no error"},{"ancestorTitles":["updateUserLevelPlusOne"],"duration":320,"failureMessages":[],"fullName":"updateUserLevelPlusOne logs error when update returns error","status":"passed","title":"logs error when update returns error"},{"ancestorTitles":["updateUserLevelPlusOne"],"duration":215,"failureMessages":[],"fullName":"updateUserLevelPlusOne catches exception and logs it","status":"passed","title":"catches exception and logs it"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172293823,"runtime":1015,"slow":false,"start":1745172292808},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/utils/createImagesZip.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["createImagesZip helper"],"duration":95,"failureMessages":[],"fullName":"createImagesZip helper creates a zip file containing provided images","status":"passed","title":"creates a zip file containing provided images"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172294032,"runtime":2012,"slow":false,"start":1745172292020},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/utils/imagesIndex.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["helpers/images index exports"],"duration":13,"failureMessages":[],"fullName":"helpers/images index exports exports createImagesZip and isValidImage","status":"passed","title":"exports createImagesZip and isValidImage"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172294538,"runtime":1915,"slow":false,"start":1745172292623},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateModelTraining.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["updateModelTraining"],"duration":517,"failureMessages":[],"fullName":"updateModelTraining resolves when update has no error","status":"passed","title":"resolves when update has no error"},{"ancestorTitles":["updateModelTraining"],"duration":823,"failureMessages":[],"fullName":"updateModelTraining throws when update returns error","status":"passed","title":"throws when update returns error"}]},{"numFailingTests":0,"numPassingTests":5,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172294892,"runtime":2158,"slow":false,"start":1745172292734},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/sceneFactory.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["composeWizardScene"],"duration":5,"failureMessages":[],"fullName":"composeWizardScene returns a function to create WizardScene","status":"passed","title":"returns a function to create WizardScene"},{"ancestorTitles":["composeWizardScene"],"duration":5,"failureMessages":[],"fullName":"composeWizardScene creates WizardScene with sceneType and handlers","status":"passed","title":"creates WizardScene with sceneType and handlers"},{"ancestorTitles":["composeWizardScene"],"duration":4,"failureMessages":[],"fullName":"composeWizardScene handlers skip when no message and no callbackQuery","status":"passed","title":"handlers skip when no message and no callbackQuery"},{"ancestorTitles":["composeWizardScene"],"duration":5,"failureMessages":[],"fullName":"composeWizardScene calls step and enter next scene when message present","status":"passed","title":"calls step and enter next scene when message present"},{"ancestorTitles":["composeWizardScene"],"duration":1,"failureMessages":[],"fullName":"composeWizardScene calls leave when nextScene returns undefined","status":"passed","title":"calls leave when nextScene returns undefined"}]},{"numFailingTests":0,"numPassingTests":7,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172295423,"runtime":1566,"slow":false,"start":1745172293857},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/services/generateNeuroImageV2.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["generateNeuroImageV2"],"duration":50,"failureMessages":[],"fullName":"generateNeuroImageV2 throws if ctx.session.prompt missing","status":"passed","title":"throws if ctx.session.prompt missing"},{"ancestorTitles":["generateNeuroImageV2"],"duration":19,"failureMessages":[],"fullName":"generateNeuroImageV2 throws if ctx.session.userModel missing","status":"passed","title":"throws if ctx.session.userModel missing"},{"ancestorTitles":["generateNeuroImageV2"],"duration":4,"failureMessages":[],"fullName":"generateNeuroImageV2 throws if numImages is zero","status":"passed","title":"throws if numImages is zero"},{"ancestorTitles":["generateNeuroImageV2"],"duration":7,"failureMessages":[],"fullName":"generateNeuroImageV2 calls API and returns data on success","status":"passed","title":"calls API and returns data on success"},{"ancestorTitles":["generateNeuroImageV2"],"duration":5,"failureMessages":[],"fullName":"generateNeuroImageV2 replies specific message on NSFW axios error","status":"passed","title":"replies specific message on NSFW axios error"},{"ancestorTitles":["generateNeuroImageV2"],"duration":6,"failureMessages":[],"fullName":"generateNeuroImageV2 replies generic message on other axios error","status":"passed","title":"replies generic message on other axios error"},{"ancestorTitles":["generateNeuroImageV2"],"duration":4,"failureMessages":[],"fullName":"generateNeuroImageV2 throws original error on non-axios error","status":"passed","title":"throws original error on non-axios error"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172295613,"runtime":1503,"slow":false,"start":1745172294110},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/lint/noTsNocheck.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["TS-NOCHECK ban in tests"],"duration":133,"failureMessages":[],"fullName":"TS-NOCHECK ban in tests should not contain @ts-nocheck in any test file","status":"passed","title":"should not contain @ts-nocheck in any test file"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172294930,"runtime":6096,"slow":true,"start":1745172288834},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/index.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["scenes index"],"duration":5,"failureMessages":[],"fullName":"scenes index exports scene modules","status":"passed","title":"exports scene modules"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172295454,"runtime":2431,"slow":false,"start":1745172293023},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/commands/index.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["commands index re-exports"],"duration":8,"failureMessages":[],"fullName":"commands index re-exports should export get100Command","status":"passed","title":"should export get100Command"},{"ancestorTitles":["commands index re-exports"],"duration":1,"failureMessages":[],"fullName":"commands index re-exports should export selectModelCommand","status":"passed","title":"should export selectModelCommand"},{"ancestorTitles":["commands index re-exports"],"duration":30,"failureMessages":[],"fullName":"commands index re-exports should export priceCommand","status":"passed","title":"should export priceCommand"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172296115,"runtime":1205,"slow":false,"start":1745172294910},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getBotGroupFromAvatars.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getBotGroupFromAvatars"],"duration":59,"failureMessages":[],"fullName":"getBotGroupFromAvatars returns group when data found","status":"passed","title":"returns group when data found"},{"ancestorTitles":["getBotGroupFromAvatars"],"duration":304,"failureMessages":[],"fullName":"getBotGroupFromAvatars returns null when error in response","status":"passed","title":"returns null when error in response"},{"ancestorTitles":["getBotGroupFromAvatars"],"duration":38,"failureMessages":[],"fullName":"getBotGroupFromAvatars returns null when exception thrown","status":"passed","title":"returns null when exception thrown"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172295971,"runtime":1211,"slow":false,"start":1745172294760},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/validateAndCalculateImageModelPrice.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["validateAndCalculateImageModelPrice"],"duration":3,"failureMessages":[],"fullName":"validateAndCalculateImageModelPrice returns null and prompts when imageModel is empty or invalid","status":"passed","title":"returns null and prompts when imageModel is empty or invalid"},{"ancestorTitles":["validateAndCalculateImageModelPrice"],"duration":6,"failureMessages":[],"fullName":"validateAndCalculateImageModelPrice returns null and prompts when modelInfo not found","status":"passed","title":"returns null and prompts when modelInfo not found"},{"ancestorTitles":["validateAndCalculateImageModelPrice"],"duration":67,"failureMessages":[],"fullName":"validateAndCalculateImageModelPrice returns null and prompts when currentBalance is insufficient","status":"passed","title":"returns null and prompts when currentBalance is insufficient"},{"ancestorTitles":["validateAndCalculateImageModelPrice"],"duration":5,"failureMessages":[],"fullName":"validateAndCalculateImageModelPrice returns price when model is valid and balance is sufficient","status":"passed","title":"returns price when model is valid and balance is sufficient"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172296547,"runtime":1111,"slow":false,"start":1745172295436},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/helpers/images/createImagesZip.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["createImagesZip"],"duration":19,"failureMessages":[],"fullName":"createImagesZip creates zip with images","status":"passed","title":"creates zip with images"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172297042,"runtime":909,"slow":false,"start":1745172296133},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/pinata.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["core/pinata client"],"duration":47,"failureMessages":[],"fullName":"core/pinata client constructs PinataSDK with correct options","status":"passed","title":"constructs PinataSDK with correct options"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172297250,"runtime":1625,"slow":false,"start":1745172295625},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/menu/index.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["menu index exports"],"duration":73,"failureMessages":[],"fullName":"menu index exports should export all menu builder and send functions","status":"passed","title":"should export all menu builder and send functions"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172297871,"runtime":1578,"slow":false,"start":1745172296293},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/utils/tokenStorage.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["tokenStorage utils"],"duration":28,"failureMessages":[],"fullName":"tokenStorage utils stores and retrieves a valid token","status":"passed","title":"stores and retrieves a valid token"},{"ancestorTitles":["tokenStorage utils"],"duration":2,"failureMessages":[],"fullName":"tokenStorage utils getToken returns undefined for nonexistent bot","status":"passed","title":"getToken returns undefined for nonexistent bot"},{"ancestorTitles":["tokenStorage utils"],"duration":10,"failureMessages":[],"fullName":"tokenStorage utils removes a stored token","status":"passed","title":"removes a stored token"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172298016,"runtime":1457,"slow":false,"start":1745172296559},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/openai/getMeditationSteps.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getMeditationSteps"],"duration":21,"failureMessages":[],"fullName":"getMeditationSteps returns parsed JSON when response has valid JSON content","status":"passed","title":"returns parsed JSON when response has valid JSON content"},{"ancestorTitles":["getMeditationSteps"],"duration":108,"failureMessages":[],"fullName":"getMeditationSteps throws error when content is null","status":"passed","title":"throws error when content is null"}]},{"numFailingTests":0,"numPassingTests":5,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172298257,"runtime":2481,"slow":false,"start":1745172295776},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/handleModelCallback.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["handleModelCallback"],"duration":9,"failureMessages":[],"fullName":"handleModelCallback должен вызывать updateUserModel с правильными аргументами","status":"passed","title":"должен вызывать updateUserModel с правильными аргументами"},{"ancestorTitles":["handleModelCallback"],"duration":27,"failureMessages":[],"fullName":"handleModelCallback должен вызывать reply с сообщением об ошибке, если updateUserModel падает","status":"passed","title":"должен вызывать reply с сообщением об ошибке, если updateUserModel падает"},{"ancestorTitles":["handleModelCallback"],"duration":6,"failureMessages":[],"fullName":"handleModelCallback должен использовать английский текст, если язык не ru","status":"passed","title":"должен использовать английский текст, если язык не ru"},{"ancestorTitles":["handleModelCallback"],"duration":4,"failureMessages":[],"fullName":"handleModelCallback должен использовать английский текст ошибки, если язык не ru","status":"passed","title":"должен использовать английский текст ошибки, если язык не ru"},{"ancestorTitles":["handleModelCallback"],"duration":28,"failureMessages":[],"fullName":"handleModelCallback не должен падать, если ctx.from не определен (хотя TS не позволяет)","status":"passed","title":"не должен падать, если ctx.from не определен (хотя TS не позволяет)"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172298401,"runtime":2548,"slow":false,"start":1745172295853},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/index.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["core index"],"duration":10,"failureMessages":[],"fullName":"core index exports key core modules","status":"passed","title":"exports key core modules"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172298637,"runtime":1586,"slow":false,"start":1745172297051},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/openai/getAinews.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getAinews"],"duration":10,"failureMessages":[],"fullName":"getAinews returns content when response has valid content","status":"passed","title":"returns content when response has valid content"},{"ancestorTitles":["getAinews"],"duration":13,"failureMessages":[],"fullName":"getAinews throws error when content is null","status":"passed","title":"throws error when content is null"},{"ancestorTitles":["getAinews"],"duration":13,"failureMessages":[],"fullName":"getAinews throws when OpenAI request fails","status":"passed","title":"throws when OpenAI request fails"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172298828,"runtime":1412,"slow":false,"start":1745172297416},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/openai/getTriggerReel.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getTriggerReel"],"duration":21,"failureMessages":[],"fullName":"getTriggerReel returns content when response has valid content","status":"passed","title":"returns content when response has valid content"},{"ancestorTitles":["getTriggerReel"],"duration":16,"failureMessages":[],"fullName":"getTriggerReel throws error when content is null","status":"passed","title":"throws error when content is null"}]},{"numFailingTests":0,"numPassingTests":13,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172298863,"runtime":962,"slow":false,"start":1745172297901},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/utils/env.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["env utils","isWebhookEnv"],"duration":4,"failureMessages":[],"fullName":"env utils isWebhookEnv returns true in production","status":"passed","title":"returns true in production"},{"ancestorTitles":["env utils","isWebhookEnv"],"duration":1,"failureMessages":[],"fullName":"env utils isWebhookEnv returns true when WEBHOOK_DOMAIN is set","status":"passed","title":"returns true when WEBHOOK_DOMAIN is set"},{"ancestorTitles":["env utils","isWebhookEnv"],"duration":0,"failureMessages":[],"fullName":"env utils isWebhookEnv returns false otherwise","status":"passed","title":"returns false otherwise"},{"ancestorTitles":["env utils","getEnvNumber"],"duration":1,"failureMessages":[],"fullName":"env utils getEnvNumber returns default when not defined","status":"passed","title":"returns default when not defined"},{"ancestorTitles":["env utils","getEnvNumber"],"duration":0,"failureMessages":[],"fullName":"env utils getEnvNumber parses integer values","status":"passed","title":"parses integer values"},{"ancestorTitles":["env utils","getEnvNumber"],"duration":0,"failureMessages":[],"fullName":"env utils getEnvNumber returns default on NaN","status":"passed","title":"returns default on NaN"},{"ancestorTitles":["env utils","getEnvBoolean"],"duration":1,"failureMessages":[],"fullName":"env utils getEnvBoolean returns default when not defined","status":"passed","title":"returns default when not defined"},{"ancestorTitles":["env utils","getEnvBoolean"],"duration":1,"failureMessages":[],"fullName":"env utils getEnvBoolean parses truthy strings (case-insensitive)","status":"passed","title":"parses truthy strings (case-insensitive)"},{"ancestorTitles":["env utils","getEnvBoolean"],"duration":1,"failureMessages":[],"fullName":"env utils getEnvBoolean returns false for non-truthy values","status":"passed","title":"returns false for non-truthy values"},{"ancestorTitles":["env utils","getEnvString"],"duration":3,"failureMessages":[],"fullName":"env utils getEnvString returns default when not defined","status":"passed","title":"returns default when not defined"},{"ancestorTitles":["env utils","getEnvString"],"duration":0,"failureMessages":[],"fullName":"env utils getEnvString returns value when defined","status":"passed","title":"returns value when defined"},{"ancestorTitles":["env utils","isDevelopment & isProduction"],"duration":1,"failureMessages":[],"fullName":"env utils isDevelopment & isProduction isDevelopment true when not production","status":"passed","title":"isDevelopment true when not production"},{"ancestorTitles":["env utils","isDevelopment & isProduction"],"duration":1,"failureMessages":[],"fullName":"env utils isDevelopment & isProduction isProduction true when production","status":"passed","title":"isProduction true when production"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172299102,"runtime":1045,"slow":false,"start":1745172298057},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/openai/upgradePrompt.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["upgradePrompt"],"duration":3,"failureMessages":[],"fullName":"upgradePrompt returns upgraded prompt from OpenAI","status":"passed","title":"returns upgraded prompt from OpenAI"},{"ancestorTitles":["upgradePrompt"],"duration":10,"failureMessages":[],"fullName":"upgradePrompt throws error when OpenAI request fails","status":"passed","title":"throws error when OpenAI request fails"}]},{"numFailingTests":0,"numPassingTests":6,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172299681,"runtime":1017,"slow":false,"start":1745172298664},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/isLimitAi.unit.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["isLimitAi"],"duration":15,"failureMessages":[],"fullName":"isLimitAi returns false when user query error","status":"passed","title":"returns false when user query error"},{"ancestorTitles":["isLimitAi"],"duration":6,"failureMessages":[],"fullName":"isLimitAi returns false when limit query error not PGRST116","status":"passed","title":"returns false when limit query error not PGRST116"},{"ancestorTitles":["isLimitAi"],"duration":2,"failureMessages":[],"fullName":"isLimitAi inserts new record when no limitData or date mismatch, return false on success","status":"passed","title":"inserts new record when no limitData or date mismatch, return false on success"},{"ancestorTitles":["isLimitAi"],"duration":12,"failureMessages":[],"fullName":"isLimitAi returns false when insert new record fails","status":"passed","title":"returns false when insert new record fails"},{"ancestorTitles":["isLimitAi"],"duration":3,"failureMessages":[],"fullName":"isLimitAi updates existing record when count < limit and returns false","status":"passed","title":"updates existing record when count < limit and returns false"},{"ancestorTitles":["isLimitAi"],"duration":3,"failureMessages":[],"fullName":"isLimitAi returns true when limit reached","status":"passed","title":"returns true when limit reached"}]},{"numFailingTests":0,"numPassingTests":7,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172299735,"runtime":1206,"slow":false,"start":1745172298529},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/replicate.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["core/replicate client and utilities"],"duration":18,"failureMessages":[],"fullName":"core/replicate client and utilities constructs Replicate with auth token","status":"passed","title":"constructs Replicate with auth token"},{"ancestorTitles":["core/replicate client and utilities"],"duration":3,"failureMessages":[],"fullName":"core/replicate client and utilities modelPricing contains expected entries","status":"passed","title":"modelPricing contains expected entries"},{"ancestorTitles":["core/replicate client and utilities","models.flux.getInput"],"duration":22,"failureMessages":[],"fullName":"core/replicate client and utilities models.flux.getInput defaults to 16:9","status":"passed","title":"defaults to 16:9"},{"ancestorTitles":["core/replicate client and utilities","models.flux.getInput"],"duration":5,"failureMessages":[],"fullName":"core/replicate client and utilities models.flux.getInput handles 1:1","status":"passed","title":"handles 1:1"},{"ancestorTitles":["core/replicate client and utilities","models.flux.getInput"],"duration":4,"failureMessages":[],"fullName":"core/replicate client and utilities models.flux.getInput handles 9:16","status":"passed","title":"handles 9:16"},{"ancestorTitles":["core/replicate client and utilities","models.flux.getInput"],"duration":5,"failureMessages":[],"fullName":"core/replicate client and utilities models.flux.getInput defaults dims for unknown ratio","status":"passed","title":"defaults dims for unknown ratio"},{"ancestorTitles":["core/replicate client and utilities"],"duration":109,"failureMessages":[],"fullName":"core/replicate client and utilities invokes getInput wrapper for all models","status":"passed","title":"invokes getInput wrapper for all models"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172300567,"runtime":1986,"slow":false,"start":1745172298581},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/services/generateImageToVideo.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["generateImageToVideo"],"duration":242,"failureMessages":[],"fullName":"generateImageToVideo throws if required parameters missing","status":"passed","title":"throws if required parameters missing"},{"ancestorTitles":["generateImageToVideo"],"duration":23,"failureMessages":[],"fullName":"generateImageToVideo calls axios.post and returns data on success","status":"passed","title":"calls axios.post and returns data on success"},{"ancestorTitles":["generateImageToVideo"],"duration":7,"failureMessages":[],"fullName":"generateImageToVideo throws localized error on axios error","status":"passed","title":"throws localized error on axios error"},{"ancestorTitles":["generateImageToVideo"],"duration":6,"failureMessages":[],"fullName":"generateImageToVideo throws original error on non-axios error","status":"passed","title":"throws original error on non-axios error"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172300715,"runtime":1869,"slow":false,"start":1745172298846},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/openai/getSubtitles.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getSubtitles"],"duration":26,"failureMessages":[],"fullName":"getSubtitles returns parsed JSON when response has valid JSON content","status":"passed","title":"returns parsed JSON when response has valid JSON content"},{"ancestorTitles":["getSubtitles"],"duration":6,"failureMessages":[],"fullName":"getSubtitles throws error when content is null","status":"passed","title":"throws error when content is null"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172301135,"runtime":2213,"slow":false,"start":1745172298922},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/openai/getSlides.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getSlides"],"duration":55,"failureMessages":[],"fullName":"getSlides returns parsed JSON when response has valid JSON content","status":"passed","title":"returns parsed JSON when response has valid JSON content"},{"ancestorTitles":["getSlides"],"duration":27,"failureMessages":[],"fullName":"getSlides throws error when content is null","status":"passed","title":"throws error when content is null"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172301374,"runtime":1669,"slow":false,"start":1745172299705},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getTelegramIdByUserId.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getTelegramIdByUserId"],"duration":4,"failureMessages":[],"fullName":"getTelegramIdByUserId returns telegram_id when found","status":"passed","title":"returns telegram_id when found"},{"ancestorTitles":["getTelegramIdByUserId"],"duration":258,"failureMessages":[],"fullName":"getTelegramIdByUserId returns null on error","status":"passed","title":"returns null on error"},{"ancestorTitles":["getTelegramIdByUserId"],"duration":4,"failureMessages":[],"fullName":"getTelegramIdByUserId returns null when no data","status":"passed","title":"returns null when no data"},{"ancestorTitles":["getTelegramIdByUserId"],"duration":65,"failureMessages":[],"fullName":"getTelegramIdByUserId throws on exception","status":"passed","title":"throws on exception"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172301296,"runtime":2011,"slow":false,"start":1745172299285},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/commands/selectModelCommand.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["selectModelCommand"],"duration":7,"failureMessages":[],"fullName":"selectModelCommand replies with model selection keyboard in Russian","status":"passed","title":"replies with model selection keyboard in Russian"},{"ancestorTitles":["selectModelCommand"],"duration":1,"failureMessages":[],"fullName":"selectModelCommand replies with model selection keyboard in English","status":"passed","title":"replies with model selection keyboard in English"},{"ancestorTitles":["selectModelCommand"],"duration":38,"failureMessages":[],"fullName":"selectModelCommand calls sendGenericErrorMessage on failure","status":"passed","title":"calls sendGenericErrorMessage on failure"}]},{"numFailingTests":1,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172301835,"runtime":2085,"slow":false,"start":1745172299750},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkSubscriptionByTelegramId.test.ts","failureMessage":"  ● checkSubscriptionByTelegramId › returns unsubscribed and logs error if query error\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"payments\"\n    Received: \"payments_v2\"\n\n    Number of calls: 1\n\n      34 |     mockSingle.mockResolvedValueOnce({ data: null, error: err })\n      35 |     const result = await checkSubscriptionByTelegramId('42')\n    > 36 |     expect(mockFrom).toHaveBeenCalledWith('payments')\n         |                      ^\n      37 |     expect(mockSelect).toHaveBeenCalledWith('*')\n      38 |     expect(mockEq).toHaveBeenCalledWith('telegram_id', '42')\n      39 |     expect(console.error).toHaveBeenCalledWith('Ошибка при получении информации о подписке:', err)\n\n      at Object.<anonymous> (__tests__/core/supabase/checkSubscriptionByTelegramId.test.ts:36:22)\n      at fulfilled (__tests__/core/supabase/checkSubscriptionByTelegramId.test.ts:4:58)\n","testResults":[{"ancestorTitles":["checkSubscriptionByTelegramId"],"duration":38,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"payments\"\nReceived: \"payments_v2\"\n\nNumber of calls: 1\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkSubscriptionByTelegramId.test.ts:36:22)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/__tests__/core/supabase/checkSubscriptionByTelegramId.test.ts:4:58)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"checkSubscriptionByTelegramId returns unsubscribed and logs error if query error","status":"failed","title":"returns unsubscribed and logs error if query error"},{"ancestorTitles":["checkSubscriptionByTelegramId"],"duration":3,"failureMessages":[],"fullName":"checkSubscriptionByTelegramId returns unsubscribed when no data","status":"passed","title":"returns unsubscribed when no data"},{"ancestorTitles":["checkSubscriptionByTelegramId"],"duration":3,"failureMessages":[],"fullName":"checkSubscriptionByTelegramId returns unsubscribed when last payment older than 30 days","status":"passed","title":"returns unsubscribed when last payment older than 30 days"},{"ancestorTitles":["checkSubscriptionByTelegramId"],"duration":2,"failureMessages":[],"fullName":"checkSubscriptionByTelegramId returns level when last payment within 30 days","status":"passed","title":"returns level when last payment within 30 days"}]},{"numFailingTests":0,"numPassingTests":5,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172302164,"runtime":1411,"slow":false,"start":1745172300753},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/incrementGeneratedImages.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["incrementGeneratedImages"],"duration":21,"failureMessages":[],"fullName":"incrementGeneratedImages inserts new user when error code PGRST116 and insert succeeds","status":"passed","title":"inserts new user when error code PGRST116 and insert succeeds"},{"ancestorTitles":["incrementGeneratedImages"],"duration":3,"failureMessages":[],"fullName":"incrementGeneratedImages returns false when insert fails","status":"passed","title":"returns false when insert fails"},{"ancestorTitles":["incrementGeneratedImages"],"duration":6,"failureMessages":[],"fullName":"incrementGeneratedImages updates existing user when data present and update succeeds","status":"passed","title":"updates existing user when data present and update succeeds"},{"ancestorTitles":["incrementGeneratedImages"],"duration":5,"failureMessages":[],"fullName":"incrementGeneratedImages returns false when update fails","status":"passed","title":"returns false when update fails"},{"ancestorTitles":["incrementGeneratedImages"],"duration":6,"failureMessages":[],"fullName":"incrementGeneratedImages returns false when error not PGRST116 and no data","status":"passed","title":"returns false when error not PGRST116 and no data"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172302354,"runtime":1511,"slow":false,"start":1745172300843},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getModel.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getModel"],"duration":32,"failureMessages":[],"fullName":"getModel returns model when data exists","status":"passed","title":"returns model when data exists"},{"ancestorTitles":["getModel"],"duration":9,"failureMessages":[],"fullName":"getModel throws error when response has error","status":"passed","title":"throws error when response has error"},{"ancestorTitles":["getModel"],"duration":14,"failureMessages":[],"fullName":"getModel throws error when response has no data","status":"passed","title":"throws error when response has no data"},{"ancestorTitles":["getModel"],"duration":4,"failureMessages":[],"fullName":"getModel throws error when supabase chain rejects","status":"passed","title":"throws error when supabase chain rejects"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172302674,"runtime":1120,"slow":false,"start":1745172301554},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/menu/getStepSelectionMenuV2.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getStepSelectionMenuV2"],"duration":10,"failureMessages":[],"fullName":"getStepSelectionMenuV2 builds Russian keyboard correctly","status":"passed","title":"builds Russian keyboard correctly"},{"ancestorTitles":["getStepSelectionMenuV2"],"duration":13,"failureMessages":[],"fullName":"getStepSelectionMenuV2 builds English keyboard correctly","status":"passed","title":"builds English keyboard correctly"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172302724,"runtime":1345,"slow":false,"start":1745172301379},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/handleBuySubscription.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["handleBuySubscription"],"duration":10,"failureMessages":[],"fullName":"handleBuySubscription should send invoice for neurophoto subscription and leave scene","status":"passed","title":"should send invoice for neurophoto subscription and leave scene"},{"ancestorTitles":["handleBuySubscription"],"duration":1,"failureMessages":[],"fullName":"handleBuySubscription should default title and description when subscription type unknown","status":"passed","title":"should default title and description when subscription type unknown"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172303076,"runtime":1830,"slow":false,"start":1745172301246},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/axios/fetchImage.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["fetchImage"],"duration":7,"failureMessages":[],"fullName":"fetchImage should return buffer from response data","status":"passed","title":"should return buffer from response data"},{"ancestorTitles":["fetchImage"],"duration":12,"failureMessages":[],"fullName":"fetchImage should throw error when axios.get rejects","status":"passed","title":"should throw error when axios.get rejects"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172303485,"runtime":1273,"slow":false,"start":1745172302212},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/openai/requests.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["answerAi"],"duration":6,"failureMessages":[],"fullName":"answerAi returns content when GPT provides a message","status":"passed","title":"returns content when GPT provides a message"},{"ancestorTitles":["answerAi"],"duration":10,"failureMessages":[],"fullName":"answerAi throws error when content is empty","status":"passed","title":"throws error when content is empty"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172304174,"runtime":1242,"slow":false,"start":1745172302932},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/savePrompt.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["savePrompt"],"duration":15,"failureMessages":[],"fullName":"savePrompt returns null when select throws error","status":"passed","title":"returns null when select throws error"},{"ancestorTitles":["savePrompt"],"duration":4,"failureMessages":[],"fullName":"savePrompt returns existing prompt_id when found","status":"passed","title":"returns existing prompt_id when found"},{"ancestorTitles":["savePrompt"],"duration":6,"failureMessages":[],"fullName":"savePrompt inserts and returns new prompt_id when not found","status":"passed","title":"inserts and returns new prompt_id when not found"},{"ancestorTitles":["savePrompt"],"duration":4,"failureMessages":[],"fullName":"savePrompt returns null when insert fails","status":"passed","title":"returns null when insert fails"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172304218,"runtime":1853,"slow":false,"start":1745172302365},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/ensureSupabaseAuth.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["ensureSupabaseAuth"],"duration":99,"failureMessages":[],"fullName":"ensureSupabaseAuth resolves when no error from supabase","status":"passed","title":"resolves when no error from supabase"},{"ancestorTitles":["ensureSupabaseAuth"],"duration":12,"failureMessages":[],"fullName":"ensureSupabaseAuth throws new Error when supabase returns error","status":"passed","title":"throws new Error when supabase returns error"},{"ancestorTitles":["ensureSupabaseAuth"],"duration":3,"failureMessages":[],"fullName":"ensureSupabaseAuth throws new Error on exception","status":"passed","title":"throws new Error on exception"}]},{"numFailingTests":0,"numPassingTests":5,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172304296,"runtime":1544,"slow":false,"start":1745172302752},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUidInviter.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getUidInviter"],"duration":28,"failureMessages":[],"fullName":"getUidInviter returns null and warns when no telegram_id provided","status":"passed","title":"returns null and warns when no telegram_id provided"},{"ancestorTitles":["getUidInviter"],"duration":4,"failureMessages":[],"fullName":"getUidInviter returns null and logs error when supabase returns error","status":"passed","title":"returns null and logs error when supabase returns error"},{"ancestorTitles":["getUidInviter"],"duration":3,"failureMessages":[],"fullName":"getUidInviter returns inviter info when data returned","status":"passed","title":"returns inviter info when data returned"},{"ancestorTitles":["getUidInviter"],"duration":5,"failureMessages":[],"fullName":"getUidInviter returns null fields when data empty","status":"passed","title":"returns null fields when data empty"},{"ancestorTitles":["getUidInviter"],"duration":5,"failureMessages":[],"fullName":"getUidInviter returns null and logs error on exception","status":"passed","title":"returns null and logs error on exception"}]},{"numFailingTests":0,"numPassingTests":5,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172304714,"runtime":1600,"slow":false,"start":1745172303114},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUid.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getUid"],"duration":10,"failureMessages":[],"fullName":"getUid returns null and warns when no telegram_id provided","status":"passed","title":"returns null and warns when no telegram_id provided"},{"ancestorTitles":["getUid"],"duration":3,"failureMessages":[],"fullName":"getUid returns null and logs error when supabase returns error","status":"passed","title":"returns null and logs error when supabase returns error"},{"ancestorTitles":["getUid"],"duration":4,"failureMessages":[],"fullName":"getUid returns null and logs error on exception","status":"passed","title":"returns null and logs error on exception"},{"ancestorTitles":["getUid"],"duration":4,"failureMessages":[],"fullName":"getUid returns user_id and username when data returned","status":"passed","title":"returns user_id and username when data returned"},{"ancestorTitles":["getUid"],"duration":4,"failureMessages":[],"fullName":"getUid returns null user_id and username when data empty","status":"passed","title":"returns null user_id and username when data empty"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172304787,"runtime":2833,"slow":false,"start":1745172301954},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/utils/launch.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["Launch Utilities"],"duration":11,"failureMessages":[],"fullName":"Launch Utilities development: deletes webhook and launches bot, logs info","status":"passed","title":"development: deletes webhook and launches bot, logs info"},{"ancestorTitles":["Launch Utilities"],"duration":9,"failureMessages":[],"fullName":"Launch Utilities development: logs error and rethrows on failure","status":"passed","title":"development: logs error and rethrows on failure"},{"ancestorTitles":["Launch Utilities"],"duration":2,"failureMessages":[],"fullName":"Launch Utilities production: sets up webhook and starts express server","status":"passed","title":"production: sets up webhook and starts express server"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172304914,"runtime":1405,"slow":false,"start":1745172303509},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserData.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getUserData"],"duration":9,"failureMessages":[],"fullName":"getUserData returns user data when found","status":"passed","title":"returns user data when found"},{"ancestorTitles":["getUserData"],"duration":8,"failureMessages":[],"fullName":"getUserData throws error when supabase returns error","status":"passed","title":"throws error when supabase returns error"},{"ancestorTitles":["getUserData"],"duration":5,"failureMessages":[],"fullName":"getUserData returns undefined when no data and no error","status":"passed","title":"returns undefined when no data and no error"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172305237,"runtime":914,"slow":false,"start":1745172304323},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/validateAndCalculateVideoModelPrice.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["validateAndCalculateVideoModelPrice"],"duration":3,"failureMessages":[],"fullName":"validateAndCalculateVideoModelPrice returns null and prompts when videoModel is empty or invalid","status":"passed","title":"returns null and prompts when videoModel is empty or invalid"},{"ancestorTitles":["validateAndCalculateVideoModelPrice"],"duration":1,"failureMessages":[],"fullName":"validateAndCalculateVideoModelPrice returns null and prompts when model not in videoModelPrices","status":"passed","title":"returns null and prompts when model not in videoModelPrices"},{"ancestorTitles":["validateAndCalculateVideoModelPrice"],"duration":2,"failureMessages":[],"fullName":"validateAndCalculateVideoModelPrice returns null and prompts when currentBalance is insufficient","status":"passed","title":"returns null and prompts when currentBalance is insufficient"},{"ancestorTitles":["validateAndCalculateVideoModelPrice"],"duration":1,"failureMessages":[],"fullName":"validateAndCalculateVideoModelPrice returns price when model valid and balance sufficient","status":"passed","title":"returns price when model valid and balance sufficient"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172305286,"runtime":997,"slow":false,"start":1745172304289},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getGeneratedImages.unit.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getGeneratedImages"],"duration":4,"failureMessages":[],"fullName":"getGeneratedImages returns default when error","status":"passed","title":"returns default when error"},{"ancestorTitles":["getGeneratedImages"],"duration":1,"failureMessages":[],"fullName":"getGeneratedImages returns parsed numbers when data present","status":"passed","title":"returns parsed numbers when data present"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172305286,"runtime":1042,"slow":false,"start":1745172304244},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/menu/videoModelMenu.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["videoModelKeyboard"],"duration":2,"failureMessages":[],"fullName":"videoModelKeyboard builds keyboard with model names and control buttons in Russian","status":"passed","title":"builds keyboard with model names and control buttons in Russian"},{"ancestorTitles":["videoModelKeyboard"],"duration":1,"failureMessages":[],"fullName":"videoModelKeyboard builds keyboard with model names and control buttons in English","status":"passed","title":"builds keyboard with model names and control buttons in English"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172305574,"runtime":834,"slow":false,"start":1745172304740},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getTelegramIdByUserId.unit.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getTelegramIdByUserId"],"duration":2,"failureMessages":[],"fullName":"getTelegramIdByUserId returns null on error","status":"passed","title":"returns null on error"},{"ancestorTitles":["getTelegramIdByUserId"],"duration":1,"failureMessages":[],"fullName":"getTelegramIdByUserId returns telegram_id when data present","status":"passed","title":"returns telegram_id when data present"},{"ancestorTitles":["getTelegramIdByUserId"],"duration":13,"failureMessages":[],"fullName":"getTelegramIdByUserId throws on exception","status":"passed","title":"throws on exception"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172305670,"runtime":867,"slow":false,"start":1745172304803},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getHistory.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getHistory"],"duration":25,"failureMessages":[],"fullName":"getHistory returns data when query successful","status":"passed","title":"returns data when query successful"},{"ancestorTitles":["getHistory"],"duration":6,"failureMessages":[],"fullName":"getHistory returns empty array when error","status":"passed","title":"returns empty array when error"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172305955,"runtime":1035,"slow":false,"start":1745172304920},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getGeneratedImages.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getGeneratedImages"],"duration":10,"failureMessages":[],"fullName":"getGeneratedImages returns count and limit when data exists","status":"passed","title":"returns count and limit when data exists"},{"ancestorTitles":["getGeneratedImages"],"duration":5,"failureMessages":[],"fullName":"getGeneratedImages returns default when error occurs","status":"passed","title":"returns default when error occurs"},{"ancestorTitles":["getGeneratedImages"],"duration":2,"failureMessages":[],"fullName":"getGeneratedImages returns default when no data and no error","status":"passed","title":"returns default when no data and no error"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172306166,"runtime":912,"slow":false,"start":1745172305254},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/handlePreCheckoutQuery.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["handlePreCheckoutQuery"],"duration":3,"failureMessages":[],"fullName":"handlePreCheckoutQuery calls answerPreCheckoutQuery with true","status":"passed","title":"calls answerPreCheckoutQuery with true"},{"ancestorTitles":["handlePreCheckoutQuery"],"duration":5,"failureMessages":[],"fullName":"handlePreCheckoutQuery propagates error when answerPreCheckoutQuery rejects","status":"passed","title":"propagates error when answerPreCheckoutQuery rejects"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172306309,"runtime":967,"slow":false,"start":1745172305342},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/menu/sendPhotoDescriptionRequest.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["sendPhotoDescriptionRequest"],"duration":7,"failureMessages":[],"fullName":"sendPhotoDescriptionRequest sends Russian prompt for neuro_photo mode","status":"passed","title":"sends Russian prompt for neuro_photo mode"},{"ancestorTitles":["sendPhotoDescriptionRequest"],"duration":3,"failureMessages":[],"fullName":"sendPhotoDescriptionRequest sends Russian prompt for other mode","status":"passed","title":"sends Russian prompt for other mode"},{"ancestorTitles":["sendPhotoDescriptionRequest"],"duration":1,"failureMessages":[],"fullName":"sendPhotoDescriptionRequest sends English prompt for neuro_photo mode","status":"passed","title":"sends English prompt for neuro_photo mode"},{"ancestorTitles":["sendPhotoDescriptionRequest"],"duration":1,"failureMessages":[],"fullName":"sendPhotoDescriptionRequest sends English prompt for other mode","status":"passed","title":"sends English prompt for other mode"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172306468,"runtime":866,"slow":false,"start":1745172305602},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/menu/getStepSelectionMenu.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getStepSelectionMenu"],"duration":3,"failureMessages":[],"fullName":"getStepSelectionMenu builds Russian keyboard correctly","status":"passed","title":"builds Russian keyboard correctly"},{"ancestorTitles":["getStepSelectionMenu"],"duration":1,"failureMessages":[],"fullName":"getStepSelectionMenu builds English keyboard correctly","status":"passed","title":"builds English keyboard correctly"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172306685,"runtime":1375,"slow":false,"start":1745172305310},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/handleCallback.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["handleCallback"],"duration":13,"failureMessages":[],"fullName":"handleCallback should answer callback query and return on valid data","status":"passed","title":"should answer callback query and return on valid data"},{"ancestorTitles":["handleCallback"],"duration":9,"failureMessages":[],"fullName":"handleCallback should swallow answerCbQuery error but still return on data present","status":"passed","title":"should swallow answerCbQuery error but still return on data present"},{"ancestorTitles":["handleCallback"],"duration":23,"failureMessages":[],"fullName":"handleCallback should throw and answerCbQuery on missing callbackQuery","status":"passed","title":"should throw and answerCbQuery on missing callbackQuery"},{"ancestorTitles":["handleCallback"],"duration":54,"failureMessages":[],"fullName":"handleCallback should throw and call sendGenericErrorMessage on answerCbQuery failure in catch","status":"passed","title":"should throw and call sendGenericErrorMessage on answerCbQuery failure in catch"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172306973,"runtime":791,"slow":false,"start":1745172306182},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/middlewares/getUserPhotoUrl.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getUserPhotoUrl"],"duration":8,"failureMessages":[],"fullName":"getUserPhotoUrl returns null when no photos","status":"passed","title":"returns null when no photos"},{"ancestorTitles":["getUserPhotoUrl"],"duration":1,"failureMessages":[],"fullName":"getUserPhotoUrl returns null when file_path missing","status":"passed","title":"returns null when file_path missing"},{"ancestorTitles":["getUserPhotoUrl"],"duration":2,"failureMessages":[],"fullName":"getUserPhotoUrl returns full URL when file_path present","status":"passed","title":"returns full URL when file_path present"},{"ancestorTitles":["getUserPhotoUrl"],"duration":13,"failureMessages":[],"fullName":"getUserPhotoUrl throws error when getUserProfilePhotos errors","status":"passed","title":"throws error when getUserProfilePhotos errors"}]},{"numFailingTests":0,"numPassingTests":5,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172307078,"runtime":1108,"slow":false,"start":1745172305970},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/utils/webhooks.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["configureWebhooks util"],"duration":8,"failureMessages":[],"fullName":"configureWebhooks util returns false when disabled","status":"passed","title":"returns false when disabled"},{"ancestorTitles":["configureWebhooks util"],"duration":0,"failureMessages":[],"fullName":"configureWebhooks util returns false when domain missing","status":"passed","title":"returns false when domain missing"},{"ancestorTitles":["configureWebhooks util"],"duration":3,"failureMessages":[],"fullName":"configureWebhooks util sets webhook when enabled and domain present","status":"passed","title":"sets webhook when enabled and domain present"},{"ancestorTitles":["removeWebhook util"],"duration":1,"failureMessages":[],"fullName":"removeWebhook util deletes webhook and logs info","status":"passed","title":"deletes webhook and logs info"},{"ancestorTitles":["removeWebhook util"],"duration":1,"failureMessages":[],"fullName":"removeWebhook util logs error on delete failure","status":"passed","title":"logs error on delete failure"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172307306,"runtime":967,"slow":false,"start":1745172306339},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getLatestUserModel.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getLatestUserModel"],"duration":25,"failureMessages":[],"fullName":"getLatestUserModel returns model data on success","status":"passed","title":"returns model data on success"},{"ancestorTitles":["getLatestUserModel"],"duration":5,"failureMessages":[],"fullName":"getLatestUserModel returns null on error","status":"passed","title":"returns null on error"},{"ancestorTitles":["getLatestUserModel"],"duration":29,"failureMessages":[],"fullName":"getLatestUserModel returns null on exception","status":"passed","title":"returns null on exception"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172307310,"runtime":836,"slow":false,"start":1745172306474},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getPrompt.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getPrompt"],"duration":18,"failureMessages":[],"fullName":"getPrompt returns data when found and no error","status":"passed","title":"returns data when found and no error"},{"ancestorTitles":["getPrompt"],"duration":3,"failureMessages":[],"fullName":"getPrompt returns null and logs error when error in response","status":"passed","title":"returns null and logs error when error in response"},{"ancestorTitles":["getPrompt"],"duration":2,"failureMessages":[],"fullName":"getPrompt returns null and logs error when no data","status":"passed","title":"returns null and logs error when no data"}]},{"numFailingTests":0,"numPassingTests":5,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172307324,"runtime":1636,"slow":false,"start":1745172305688},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/utils/removeWebhooks.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["removeWebhooks util"],"duration":3,"failureMessages":[],"fullName":"removeWebhooks util resolves true and logs info when no webhook set","status":"passed","title":"resolves true and logs info when no webhook set"},{"ancestorTitles":["removeWebhooks util"],"duration":1,"failureMessages":[],"fullName":"removeWebhooks util deletes webhook and logs info when webhook exists","status":"passed","title":"deletes webhook and logs info when webhook exists"},{"ancestorTitles":["removeWebhooks util"],"duration":1,"failureMessages":[],"fullName":"removeWebhooks util returns false on unauthorized error without retry","status":"passed","title":"returns false on unauthorized error without retry"},{"ancestorTitles":["removeWebhooks util"],"duration":6,"failureMessages":[],"fullName":"removeWebhooks util retries deleteWebhook on other errors and succeeds","status":"passed","title":"retries deleteWebhook on other errors and succeeds"},{"ancestorTitles":["removeWebhooks util"],"duration":8,"failureMessages":[],"fullName":"removeWebhooks util returns false when retry deletion fails","status":"passed","title":"returns false when retry deletion fails"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172307526,"runtime":821,"slow":false,"start":1745172306705},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/deleteFileFromSupabase.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["deleteFileFromSupabase"],"duration":12,"failureMessages":[],"fullName":"deleteFileFromSupabase calls remove with correct bucket and filename","status":"passed","title":"calls remove with correct bucket and filename"},{"ancestorTitles":["deleteFileFromSupabase"],"duration":3,"failureMessages":[],"fullName":"deleteFileFromSupabase handles Supabase error without throwing","status":"passed","title":"handles Supabase error without throwing"},{"ancestorTitles":["deleteFileFromSupabase"],"duration":7,"failureMessages":[],"fullName":"deleteFileFromSupabase catches exception and does not throw","status":"passed","title":"catches exception and does not throw"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172307728,"runtime":736,"slow":false,"start":1745172306992},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/saveUserEmail.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["saveUserEmail"],"duration":12,"failureMessages":[],"fullName":"saveUserEmail resolves when update succeeds","status":"passed","title":"resolves when update succeeds"},{"ancestorTitles":["saveUserEmail"],"duration":9,"failureMessages":[],"fullName":"saveUserEmail throws and logs error when update fails","status":"passed","title":"throws and logs error when update fails"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172307982,"runtime":877,"slow":false,"start":1745172307105},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getPrompt.unit.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getPrompt"],"duration":4,"failureMessages":[],"fullName":"getPrompt returns null on error","status":"passed","title":"returns null on error"},{"ancestorTitles":["getPrompt"],"duration":3,"failureMessages":[],"fullName":"getPrompt returns data when present","status":"passed","title":"returns data when present"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172308137,"runtime":801,"slow":false,"start":1745172307336},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/createModelTraining.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["createModelTraining"],"duration":24,"failureMessages":[],"fullName":"createModelTraining resolves when insert succeeds","status":"passed","title":"resolves when insert succeeds"},{"ancestorTitles":["createModelTraining"],"duration":9,"failureMessages":[],"fullName":"createModelTraining throws error when insert fails","status":"passed","title":"throws error when insert fails"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172308137,"runtime":788,"slow":false,"start":1745172307349},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserSoul.unit.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["updateUserSoul"],"duration":28,"failureMessages":[],"fullName":"updateUserSoul calls supabase.update with correct data and handles success","status":"passed","title":"calls supabase.update with correct data and handles success"},{"ancestorTitles":["updateUserSoul"],"duration":1,"failureMessages":[],"fullName":"updateUserSoul logs error when supabase update returns error and does not throw","status":"passed","title":"logs error when supabase update returns error and does not throw"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172308204,"runtime":819,"slow":false,"start":1745172307385},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getBotGroupFromAvatars.unit.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getBotGroupFromAvatars"],"duration":2,"failureMessages":[],"fullName":"getBotGroupFromAvatars returns group when data present","status":"passed","title":"returns group when data present"},{"ancestorTitles":["getBotGroupFromAvatars"],"duration":1,"failureMessages":[],"fullName":"getBotGroupFromAvatars returns null on error and logs","status":"passed","title":"returns null on error and logs"},{"ancestorTitles":["getBotGroupFromAvatars"],"duration":2,"failureMessages":[],"fullName":"getBotGroupFromAvatars returns null on exception and logs","status":"passed","title":"returns null on exception and logs"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172308497,"runtime":964,"slow":false,"start":1745172307533},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserByTelegramId.unit.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getUserByTelegramId"],"duration":36,"failureMessages":[],"fullName":"getUserByTelegramId returns null if select returns error","status":"passed","title":"returns null if select returns error"},{"ancestorTitles":["getUserByTelegramId"],"duration":2,"failureMessages":[],"fullName":"getUserByTelegramId returns data and does not update if bot_name matches","status":"passed","title":"returns data and does not update if bot_name matches"},{"ancestorTitles":["getUserByTelegramId"],"duration":7,"failureMessages":[],"fullName":"getUserByTelegramId updates bot_name when differs and returns data","status":"passed","title":"updates bot_name when differs and returns data"},{"ancestorTitles":["getUserByTelegramId"],"duration":28,"failureMessages":[],"fullName":"getUserByTelegramId returns null on unexpected exception","status":"passed","title":"returns null on unexpected exception"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172308567,"runtime":819,"slow":false,"start":1745172307748},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserModel.unit.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getUserModel"],"duration":80,"failureMessages":[],"fullName":"getUserModel returns default model when supabase returns error","status":"passed","title":"returns default model when supabase returns error"},{"ancestorTitles":["getUserModel"],"duration":6,"failureMessages":[],"fullName":"getUserModel returns user model when data is present","status":"passed","title":"returns user model when data is present"},{"ancestorTitles":["getUserModel"],"duration":1,"failureMessages":[],"fullName":"getUserModel returns default model when data.model is undefined","status":"passed","title":"returns default model when data.model is undefined"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172308901,"runtime":909,"slow":false,"start":1745172307992},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/setAspectRatio.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["setAspectRatio"],"duration":40,"failureMessages":[],"fullName":"setAspectRatio returns true on successful update","status":"passed","title":"returns true on successful update"},{"ancestorTitles":["setAspectRatio"],"duration":16,"failureMessages":[],"fullName":"setAspectRatio returns false on error","status":"passed","title":"returns false on error"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172308918,"runtime":759,"slow":false,"start":1745172308159},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/bot/index.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["core/bot index"],"duration":31,"failureMessages":[],"fullName":"core/bot index exports core bot utilities correctly","status":"passed","title":"exports core bot utilities correctly"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172308974,"runtime":814,"slow":false,"start":1745172308160},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/menu/sendPromptImprovementFailureMessage.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["sendPromptImprovementFailureMessage"],"duration":7,"failureMessages":[],"fullName":"sendPromptImprovementFailureMessage sends Russian failure message when isRu true","status":"passed","title":"sends Russian failure message when isRu true"},{"ancestorTitles":["sendPromptImprovementFailureMessage"],"duration":1,"failureMessages":[],"fullName":"sendPromptImprovementFailureMessage sends English failure message when isRu false","status":"passed","title":"sends English failure message when isRu false"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172309056,"runtime":836,"slow":false,"start":1745172308220},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/imageModelPrices.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["imageModelPrices"],"duration":4,"failureMessages":[],"fullName":"imageModelPrices should contain key flux-1.1-pro with correct cost","status":"passed","title":"should contain key flux-1.1-pro with correct cost"},{"ancestorTitles":["imageModelPrices"],"duration":88,"failureMessages":[],"fullName":"imageModelPrices should have valid inputType array","status":"passed","title":"should have valid inputType array"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172309289,"runtime":759,"slow":false,"start":1745172308530},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/utils/errorMessageAdmin.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["errorMessageAdmin"],"duration":7,"failureMessages":[],"fullName":"errorMessageAdmin should send admin notification when not development","status":"passed","title":"should send admin notification when not development"},{"ancestorTitles":["errorMessageAdmin"],"duration":9,"failureMessages":[],"fullName":"errorMessageAdmin should not send when development mode","status":"passed","title":"should not send when development mode"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172309347,"runtime":748,"slow":false,"start":1745172308599},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getModel.unit.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getModel"],"duration":8,"failureMessages":[],"fullName":"getModel throws error on supabase error","status":"passed","title":"throws error on supabase error"},{"ancestorTitles":["getModel"],"duration":3,"failureMessages":[],"fullName":"getModel throws error when data null","status":"passed","title":"throws error when data null"},{"ancestorTitles":["getModel"],"duration":4,"failureMessages":[],"fullName":"getModel returns data.model on success","status":"passed","title":"returns data.model on success"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172309640,"runtime":704,"slow":false,"start":1745172308936},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/services/generateTextToVideo.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["generateTextToVideo"],"duration":12,"failureMessages":[],"fullName":"generateTextToVideo logs info with Russian flag","status":"passed","title":"logs info with Russian flag"},{"ancestorTitles":["generateTextToVideo"],"duration":1,"failureMessages":[],"fullName":"generateTextToVideo logs info with English flag","status":"passed","title":"logs info with English flag"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172309881,"runtime":955,"slow":false,"start":1745172308926},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/cleanupOldArchives.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["cleanupOldArchives"],"duration":47,"failureMessages":[],"fullName":"cleanupOldArchives does nothing when list errors","status":"passed","title":"does nothing when list errors"},{"ancestorTitles":["cleanupOldArchives"],"duration":8,"failureMessages":[],"fullName":"cleanupOldArchives does nothing when only one file exists","status":"passed","title":"does nothing when only one file exists"},{"ancestorTitles":["cleanupOldArchives"],"duration":42,"failureMessages":[],"fullName":"cleanupOldArchives removes all but latest file","status":"passed","title":"removes all but latest file"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172309885,"runtime":877,"slow":false,"start":1745172309008},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/helpers/error/processApiResponse.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["processApiResponse"],"duration":4,"failureMessages":[],"fullName":"processApiResponse returns string if output is string","status":"passed","title":"returns string if output is string"},{"ancestorTitles":["processApiResponse"],"duration":0,"failureMessages":[],"fullName":"processApiResponse returns first element if output is array","status":"passed","title":"returns first element if output is array"},{"ancestorTitles":["processApiResponse"],"duration":1,"failureMessages":[],"fullName":"processApiResponse returns output property if output is object with output","status":"passed","title":"returns output property if output is object with output"},{"ancestorTitles":["processApiResponse"],"duration":11,"failureMessages":[],"fullName":"processApiResponse throws error for invalid api response","status":"passed","title":"throws error for invalid api response"}]},{"numFailingTests":0,"numPassingTests":7,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172310030,"runtime":722,"slow":false,"start":1745172309308},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/checkFullAccess.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["checkFullAccess"],"duration":32,"failureMessages":[],"fullName":"checkFullAccess returns true for subscription 'neurophoto'","status":"passed","title":"returns true for subscription 'neurophoto'"},{"ancestorTitles":["checkFullAccess"],"duration":1,"failureMessages":[],"fullName":"checkFullAccess returns true for subscription 'neurobase'","status":"passed","title":"returns true for subscription 'neurobase'"},{"ancestorTitles":["checkFullAccess"],"duration":1,"failureMessages":[],"fullName":"checkFullAccess returns true for subscription 'neuromeeting'","status":"passed","title":"returns true for subscription 'neuromeeting'"},{"ancestorTitles":["checkFullAccess"],"duration":1,"failureMessages":[],"fullName":"checkFullAccess returns true for subscription 'neuroblogger'","status":"passed","title":"returns true for subscription 'neuroblogger'"},{"ancestorTitles":["checkFullAccess"],"duration":0,"failureMessages":[],"fullName":"checkFullAccess returns true for subscription 'neurotester'","status":"passed","title":"returns true for subscription 'neurotester'"},{"ancestorTitles":["checkFullAccess"],"duration":0,"failureMessages":[],"fullName":"checkFullAccess returns false for unknown subscription","status":"passed","title":"returns false for unknown subscription"},{"ancestorTitles":["checkFullAccess"],"duration":0,"failureMessages":[],"fullName":"checkFullAccess returns false for empty string","status":"passed","title":"returns false for empty string"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172310087,"runtime":1013,"slow":false,"start":1745172309074},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/helpers/deleteFile.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["deleteFile"],"duration":9,"failureMessages":[],"fullName":"deleteFile should call unlink and log success","status":"passed","title":"should call unlink and log success"},{"ancestorTitles":["deleteFile"],"duration":4,"failureMessages":[],"fullName":"deleteFile should catch and log error when unlink throws","status":"passed","title":"should catch and log error when unlink throws"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172310283,"runtime":925,"slow":false,"start":1745172309358},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/handleBuy.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["handlers/handleBuy"],"duration":68,"failureMessages":[],"fullName":"handlers/handleBuy sends invoice for matching amount in English","status":"passed","title":"sends invoice for matching amount in English"},{"ancestorTitles":["handlers/handleBuy"],"duration":16,"failureMessages":[],"fullName":"handlers/handleBuy sends invoice for matching amount in Russian","status":"passed","title":"sends invoice for matching amount in Russian"},{"ancestorTitles":["handlers/handleBuy"],"duration":11,"failureMessages":[],"fullName":"handlers/handleBuy does not send invoice when data does not match any amount","status":"passed","title":"does not send invoice when data does not match any amount"},{"ancestorTitles":["handlers/handleBuy"],"duration":21,"failureMessages":[],"fullName":"handlers/handleBuy propagates error when replyWithInvoice throws","status":"passed","title":"propagates error when replyWithInvoice throws"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172310664,"runtime":768,"slow":false,"start":1745172309896},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/menu/sendGenerationErrorMessage.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["sendGenerationErrorMessage"],"duration":38,"failureMessages":[],"fullName":"sendGenerationErrorMessage replies with Russian message when isRu true","status":"passed","title":"replies with Russian message when isRu true"},{"ancestorTitles":["sendGenerationErrorMessage"],"duration":1,"failureMessages":[],"fullName":"sendGenerationErrorMessage replies with English message when isRu false","status":"passed","title":"replies with English message when isRu false"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172310762,"runtime":1074,"slow":false,"start":1745172309688},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/commands/priceCommand.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["priceCommand"],"duration":50,"failureMessages":[],"fullName":"priceCommand replies with English price message for non-Russian user","status":"passed","title":"replies with English price message for non-Russian user"},{"ancestorTitles":["priceCommand"],"duration":3,"failureMessages":[],"fullName":"priceCommand replies with Russian price message for Russian user","status":"passed","title":"replies with Russian price message for Russian user"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172311092,"runtime":787,"slow":false,"start":1745172310305},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getAspectRatio.unit.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getAspectRatio"],"duration":4,"failureMessages":[],"fullName":"getAspectRatio returns null on error","status":"passed","title":"returns null on error"},{"ancestorTitles":["getAspectRatio"],"duration":17,"failureMessages":[],"fullName":"getAspectRatio returns null when data is null","status":"passed","title":"returns null when data is null"},{"ancestorTitles":["getAspectRatio"],"duration":2,"failureMessages":[],"fullName":"getAspectRatio returns aspect_ratio when data present","status":"passed","title":"returns aspect_ratio when data present"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172311239,"runtime":1130,"slow":false,"start":1745172310109},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/middlewares/verifySubscription.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["verifySubscription"],"duration":4,"failureMessages":[],"fullName":"verifySubscription returns true and does not call handleSubscriptionMessage when subscribed","status":"passed","title":"returns true and does not call handleSubscriptionMessage when subscribed"},{"ancestorTitles":["verifySubscription"],"duration":2,"failureMessages":[],"fullName":"verifySubscription calls handleSubscriptionMessage and returns false when not subscribed","status":"passed","title":"calls handleSubscriptionMessage and returns false when not subscribed"},{"ancestorTitles":["verifySubscription"],"duration":159,"failureMessages":[],"fullName":"verifySubscription propagates error from checkSubscription","status":"passed","title":"propagates error from checkSubscription"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172311185,"runtime":1249,"slow":false,"start":1745172309936},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/inviteScene.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["inviteScene enter handler logic"],"duration":7,"failureMessages":[],"fullName":"inviteScene enter handler logic sends invitation text and link, then enters MainMenu","status":"passed","title":"sends invitation text and link, then enters MainMenu"},{"ancestorTitles":["inviteScene enter handler logic"],"duration":45,"failureMessages":[],"fullName":"inviteScene enter handler logic handles error by notifying user","status":"passed","title":"handles error by notifying user"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172311829,"runtime":1095,"slow":false,"start":1745172310734},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserVoice.unit.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["updateUserVoice"],"duration":8,"failureMessages":[],"fullName":"updateUserVoice resolves when update succeeds","status":"passed","title":"resolves when update succeeds"},{"ancestorTitles":["updateUserVoice"],"duration":8,"failureMessages":[],"fullName":"updateUserVoice throws error when update returns error","status":"passed","title":"throws error when update returns error"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172311806,"runtime":1465,"slow":false,"start":1745172310341},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/utils/errorMessage.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["errorMessage"],"duration":5,"failureMessages":[],"fullName":"errorMessage sends Russian error message","status":"passed","title":"sends Russian error message"},{"ancestorTitles":["errorMessage"],"duration":2,"failureMessages":[],"fullName":"errorMessage sends English error message","status":"passed","title":"sends English error message"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172311848,"runtime":657,"slow":false,"start":1745172311191},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/incrementLimit.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["incrementLimit"],"duration":1,"failureMessages":[],"fullName":"incrementLimit TODO: implement tests for incrementLimit","status":"passed","title":"TODO: implement tests for incrementLimit"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172311908,"runtime":894,"slow":false,"start":1745172311014},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getPaymentsInfoByTelegramId.unit.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getPaymentsInfoByTelegramId"],"duration":5,"failureMessages":[],"fullName":"getPaymentsInfoByTelegramId returns empty array on error","status":"passed","title":"returns empty array on error"},{"ancestorTitles":["getPaymentsInfoByTelegramId"],"duration":2,"failureMessages":[],"fullName":"getPaymentsInfoByTelegramId returns payments data when present","status":"passed","title":"returns payments data when present"},{"ancestorTitles":["getPaymentsInfoByTelegramId"],"duration":1,"failureMessages":[],"fullName":"getPaymentsInfoByTelegramId returns empty array when no payments found","status":"passed","title":"returns empty array when no payments found"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172311935,"runtime":668,"slow":false,"start":1745172311267},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/elevenlabs.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["core/elevenlabs client"],"duration":33,"failureMessages":[],"fullName":"core/elevenlabs client getVoices returns an object with voices array","status":"passed","title":"getVoices returns an object with voices array"},{"ancestorTitles":["core/elevenlabs client"],"duration":19,"failureMessages":[],"fullName":"core/elevenlabs client generateVoiceSpeech returns a buffer of length 1","status":"passed","title":"generateVoiceSpeech returns a buffer of length 1"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172312083,"runtime":770,"slow":false,"start":1745172311313},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/services/generateImageFromPrompt.unit.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["generateImageFromPrompt"],"duration":3,"failureMessages":[],"fullName":"generateImageFromPrompt logs the input parameters and returns fake URL","status":"passed","title":"logs the input parameters and returns fake URL"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172312413,"runtime":547,"slow":false,"start":1745172311866},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/index.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["Price Module","calculateDiscountedPrice"],"duration":3,"failureMessages":[],"fullName":"Price Module calculateDiscountedPrice applies discount correctly within range","status":"passed","title":"applies discount correctly within range"},{"ancestorTitles":["Price Module","module constants"],"duration":1,"failureMessages":[],"fullName":"Price Module module constants exports correct interestRate and basePrice","status":"passed","title":"exports correct interestRate and basePrice"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172312483,"runtime":601,"slow":false,"start":1745172311882},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/openai/getCaptionForNews.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getCaptionForNews"],"duration":26,"failureMessages":[],"fullName":"getCaptionForNews should call OpenAI chat completion with correct parameters and return content","status":"passed","title":"should call OpenAI chat completion with correct parameters and return content"},{"ancestorTitles":["getCaptionForNews"],"duration":11,"failureMessages":[],"fullName":"getCaptionForNews should throw if OpenAI returns null content","status":"passed","title":"should throw if OpenAI returns null content"},{"ancestorTitles":["getCaptionForNews"],"duration":18,"failureMessages":[],"fullName":"getCaptionForNews should propagate errors from the OpenAI client","status":"passed","title":"should propagate errors from the OpenAI client"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172312543,"runtime":680,"slow":false,"start":1745172311863},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/helpers/calculateStars.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["calculateStars"],"duration":2,"failureMessages":[],"fullName":"calculateStars floors the division of payment by star cost","status":"passed","title":"floors the division of payment by star cost"},{"ancestorTitles":["calculateStars"],"duration":0,"failureMessages":[],"fullName":"calculateStars returns zero when payment less than star cost","status":"passed","title":"returns zero when payment less than star cost"},{"ancestorTitles":["calculateStars"],"duration":0,"failureMessages":[],"fullName":"calculateStars exact division returns exact result","status":"passed","title":"exact division returns exact result"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172312591,"runtime":668,"slow":false,"start":1745172311923},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserModel.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getUserModel"],"duration":2,"failureMessages":[],"fullName":"getUserModel TODO: implement tests for getUserModel","status":"passed","title":"TODO: implement tests for getUserModel"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172312631,"runtime":669,"slow":false,"start":1745172311962},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getPaymentsInfoByTelegramId.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getPaymentsInfoByTelegramId"],"duration":3,"failureMessages":[],"fullName":"getPaymentsInfoByTelegramId returns payment data when query succeeds","status":"passed","title":"returns payment data when query succeeds"},{"ancestorTitles":["getPaymentsInfoByTelegramId"],"duration":9,"failureMessages":[],"fullName":"getPaymentsInfoByTelegramId returns empty array and logs error when query fails","status":"passed","title":"returns empty array and logs error when query fails"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172312715,"runtime":605,"slow":false,"start":1745172312110},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/services/generateImageFromPrompt.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["generateImageFromPrompt"],"duration":3,"failureMessages":[],"fullName":"generateImageFromPrompt returns dummy URL and logs parameters with all args","status":"passed","title":"returns dummy URL and logs parameters with all args"},{"ancestorTitles":["generateImageFromPrompt"],"duration":0,"failureMessages":[],"fullName":"generateImageFromPrompt works without optional args","status":"passed","title":"works without optional args"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172313176,"runtime":745,"slow":false,"start":1745172312431},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/helpers/error/errorMessageAdmin.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["errorMessageAdmin"],"duration":2,"failureMessages":[],"fullName":"errorMessageAdmin sends message when not in dev","status":"passed","title":"sends message when not in dev"},{"ancestorTitles":["errorMessageAdmin"],"duration":0,"failureMessages":[],"fullName":"errorMessageAdmin does not send message when in dev","status":"passed","title":"does not send message when in dev"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172313394,"runtime":899,"slow":false,"start":1745172312495},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/helpers/language.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["isRussian"],"duration":2,"failureMessages":[],"fullName":"isRussian returns true when language_code is ru","status":"passed","title":"returns true when language_code is ru"},{"ancestorTitles":["isRussian"],"duration":0,"failureMessages":[],"fullName":"isRussian returns false when language_code is not ru","status":"passed","title":"returns false when language_code is not ru"},{"ancestorTitles":["isRussian"],"duration":0,"failureMessages":[],"fullName":"isRussian returns false when ctx.from is undefined","status":"passed","title":"returns false when ctx.from is undefined"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172313481,"runtime":919,"slow":false,"start":1745172312562},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/helpers/calculateCostInStars.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["calculateCostInStars"],"duration":3,"failureMessages":[],"fullName":"calculateCostInStars returns 0 when costInDollars is 0","status":"passed","title":"returns 0 when costInDollars is 0"},{"ancestorTitles":["calculateCostInStars"],"duration":0,"failureMessages":[],"fullName":"calculateCostInStars returns 1 when costInDollars equals starCost","status":"passed","title":"returns 1 when costInDollars equals starCost"},{"ancestorTitles":["calculateCostInStars"],"duration":1,"failureMessages":[],"fullName":"calculateCostInStars calculates correctly for arbitrary cost","status":"passed","title":"calculates correctly for arbitrary cost"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172313588,"runtime":986,"slow":false,"start":1745172312602},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/models/calculateFinalImageCostInStars.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["calculateFinalImageCostInStars"],"duration":2,"failureMessages":[],"fullName":"calculateFinalImageCostInStars returns 0 when baseCost is 0","status":"passed","title":"returns 0 when baseCost is 0"},{"ancestorTitles":["calculateFinalImageCostInStars"],"duration":0,"failureMessages":[],"fullName":"calculateFinalImageCostInStars calculates correct number of stars","status":"passed","title":"calculates correct number of stars"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172313819,"runtime":1069,"slow":false,"start":1745172312750},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/videoModelPrices.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["videoModelPrices"],"duration":3,"failureMessages":[],"fullName":"videoModelPrices should contain known model names with expected values","status":"passed","title":"should contain known model names with expected values"},{"ancestorTitles":["videoModelPrices"],"duration":20,"failureMessages":[],"fullName":"videoModelPrices should not include unexpected models","status":"passed","title":"should not include unexpected models"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172313918,"runtime":1275,"slow":false,"start":1745172312643},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/calculateFinalImageCostInStars.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["calculateFinalImageCostInStars"],"duration":5,"failureMessages":[],"fullName":"calculateFinalImageCostInStars calculates correct cost for baseCost = 1","status":"passed","title":"calculates correct cost for baseCost = 1"},{"ancestorTitles":["calculateFinalImageCostInStars"],"duration":1,"failureMessages":[],"fullName":"calculateFinalImageCostInStars returns 0 for baseCost = 0","status":"passed","title":"returns 0 for baseCost = 0"},{"ancestorTitles":["calculateFinalImageCostInStars"],"duration":1,"failureMessages":[],"fullName":"calculateFinalImageCostInStars handles fractional baseCost","status":"passed","title":"handles fractional baseCost"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172314308,"runtime":1096,"slow":false,"start":1745172313212},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/utils/delay.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["delay"],"duration":3,"failureMessages":[],"fullName":"delay resolves after given ms","status":"passed","title":"resolves after given ms"},{"ancestorTitles":["delay"],"duration":0,"failureMessages":[],"fullName":"delay resolves on zero ms","status":"passed","title":"resolves on zero ms"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172314438,"runtime":1031,"slow":false,"start":1745172313407},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/utils/isValidImage.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["isValidImage"],"duration":16,"failureMessages":[],"fullName":"isValidImage returns true for JPEG header","status":"passed","title":"returns true for JPEG header"},{"ancestorTitles":["isValidImage"],"duration":4,"failureMessages":[],"fullName":"isValidImage returns true for PNG header","status":"passed","title":"returns true for PNG header"},{"ancestorTitles":["isValidImage"],"duration":3,"failureMessages":[],"fullName":"isValidImage returns false for other header","status":"passed","title":"returns false for other header"},{"ancestorTitles":["isValidImage"],"duration":27,"failureMessages":[],"fullName":"isValidImage returns false on error","status":"passed","title":"returns false on error"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172314594,"runtime":982,"slow":false,"start":1745172313612},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/utils/language.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["isRussian"],"duration":10,"failureMessages":[],"fullName":"isRussian should return true for ru language_code","status":"passed","title":"should return true for ru language_code"},{"ancestorTitles":["isRussian"],"duration":1,"failureMessages":[],"fullName":"isRussian should return false for non-ru language_code","status":"passed","title":"should return false for non-ru language_code"},{"ancestorTitles":["isRussian"],"duration":0,"failureMessages":[],"fullName":"isRussian should return false if from is undefined","status":"passed","title":"should return false if from is undefined"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172314909,"runtime":1408,"slow":false,"start":1745172313501},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/utils/ensureDirectoryExistence.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["ensureDirectoryExistence"],"duration":32,"failureMessages":[],"fullName":"ensureDirectoryExistence should call fs.promises.mkdir with recursive true","status":"passed","title":"should call fs.promises.mkdir with recursive true"},{"ancestorTitles":["ensureDirectoryExistence"],"duration":67,"failureMessages":[],"fullName":"ensureDirectoryExistence should throw if fs.promises.mkdir rejects","status":"passed","title":"should throw if fs.promises.mkdir rejects"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172315197,"runtime":1268,"slow":false,"start":1745172313929},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/utils/getConfig.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getConfig"],"duration":86,"failureMessages":[],"fullName":"getConfig returns default values when no env vars are set","status":"passed","title":"returns default values when no env vars are set"},{"ancestorTitles":["getConfig"],"duration":4,"failureMessages":[],"fullName":"getConfig parses PORT and uses provided env vars","status":"passed","title":"parses PORT and uses provided env vars"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172315237,"runtime":1282,"slow":false,"start":1745172313955},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserVoice.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["updateUserVoice"],"duration":1,"failureMessages":[],"fullName":"updateUserVoice TODO: implement tests for updateUserVoice","status":"passed","title":"TODO: implement tests for updateUserVoice"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172315533,"runtime":1210,"slow":false,"start":1745172314323},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/menu/sendPromptImprovementMessage.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["sendPromptImprovementMessage"],"duration":6,"failureMessages":[],"fullName":"sendPromptImprovementMessage sends Russian start message when isRu true","status":"passed","title":"sends Russian start message when isRu true"},{"ancestorTitles":["sendPromptImprovementMessage"],"duration":29,"failureMessages":[],"fullName":"sendPromptImprovementMessage sends English start message when isRu false","status":"passed","title":"sends English start message when isRu false"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172315579,"runtime":1104,"slow":false,"start":1745172314475},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/menu/cancelHelpArray.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["cancelHelpArray"],"duration":10,"failureMessages":[],"fullName":"cancelHelpArray returns Russian array when isRu true","status":"passed","title":"returns Russian array when isRu true"},{"ancestorTitles":["cancelHelpArray"],"duration":1,"failureMessages":[],"fullName":"cancelHelpArray returns English array when isRu false","status":"passed","title":"returns English array when isRu false"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172315704,"runtime":1088,"slow":false,"start":1745172314616},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/models/videoModelPrices.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["videoModelPrices mapping"],"duration":2,"failureMessages":[],"fullName":"videoModelPrices mapping matches expected video model price mappings","status":"passed","title":"matches expected video model price mappings"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172316086,"runtime":1105,"slow":false,"start":1745172314981},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/starAmounts.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["starAmounts constant"],"duration":2,"failureMessages":[],"fullName":"starAmounts constant should contain the expected star amounts","status":"passed","title":"should contain the expected star amounts"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172316175,"runtime":961,"slow":false,"start":1745172315214},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/models.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["Image Model Prices"],"duration":31,"failureMessages":[],"fullName":"Image Model Prices should have at least one model entry with the correct structure","status":"passed","title":"should have at least one model entry with the correct structure"},{"ancestorTitles":["Video Model Prices"],"duration":1,"failureMessages":[],"fullName":"Video Model Prices should have correct base prices for known video models","status":"passed","title":"should have correct base prices for known video models"},{"ancestorTitles":["calculateFinalImageCostInStars"],"duration":0,"failureMessages":[],"fullName":"calculateFinalImageCostInStars calculates ceiling of (baseCost * (1 + interestRate) / starCost)","status":"passed","title":"calculates ceiling of (baseCost * (1 + interestRate) / starCost)"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172316213,"runtime":957,"slow":false,"start":1745172315256},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/voiceConversationCost.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["voiceConversationCost constant"],"duration":4,"failureMessages":[],"fullName":"voiceConversationCost constant should equal calculateCostInStars(0.99)","status":"passed","title":"should equal calculateCostInStars(0.99)"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172316391,"runtime":818,"slow":false,"start":1745172315573},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/interestRate.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["interestRate constant"],"duration":5,"failureMessages":[],"fullName":"interestRate constant should be a positive number equal to 0.5","status":"passed","title":"should be a positive number equal to 0.5"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172316522,"runtime":927,"slow":false,"start":1745172315595},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/starCost.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["starCost constant"],"duration":3,"failureMessages":[],"fullName":"starCost constant should be a positive number equal to 0.016","status":"passed","title":"should be a positive number equal to 0.016"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172316689,"runtime":815,"slow":false,"start":1745172315874},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/utils/deleteFile.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["deleteFile"],"duration":21,"failureMessages":[],"fullName":"deleteFile should call fs.promises.unlink with given path","status":"passed","title":"should call fs.promises.unlink with given path"},{"ancestorTitles":["deleteFile"],"duration":30,"failureMessages":[],"fullName":"deleteFile should not throw when unlink rejects","status":"passed","title":"should not throw when unlink rejects"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172316817,"runtime":626,"slow":false,"start":1745172316191},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/video.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["video"],"duration":1,"failureMessages":[],"fullName":"video TODO: implement tests for video","status":"passed","title":"TODO: implement tests for video"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172316900,"runtime":781,"slow":false,"start":1745172316119},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserLevel.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getUserLevel"],"duration":5,"failureMessages":[],"fullName":"getUserLevel TODO: implement tests for getUserLevel","status":"passed","title":"TODO: implement tests for getUserLevel"}]},{"numFailingTests":0,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172316998,"runtime":774,"slow":false,"start":1745172316224},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/updateUserLevel.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["updateUserLevel"],"duration":1,"failureMessages":[],"fullName":"updateUserLevel TODO: implement tests for updateUserLevel","status":"passed","title":"TODO: implement tests for updateUserLevel"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172317186,"runtime":748,"slow":false,"start":1745172316438},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/helpers/ensureDirectoryExistence.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["ensureDirectoryExistence"],"duration":7,"failureMessages":[],"fullName":"ensureDirectoryExistence should create directory and log messages","status":"passed","title":"should create directory and log messages"},{"ancestorTitles":["ensureDirectoryExistence"],"duration":1,"failureMessages":[],"fullName":"ensureDirectoryExistence should log error and rethrow when mkdir fails","status":"passed","title":"should log error and rethrow when mkdir fails"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172317406,"runtime":709,"slow":false,"start":1745172316697},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/handleSuccessfulPayment.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["handlePreCheckoutQuery"],"duration":9,"failureMessages":[],"fullName":"handlePreCheckoutQuery calls answerPreCheckoutQuery with true","status":"passed","title":"calls answerPreCheckoutQuery with true"},{"ancestorTitles":["handlePreCheckoutQuery"],"duration":10,"failureMessages":[],"fullName":"handlePreCheckoutQuery propagates errors from answerPreCheckoutQuery","status":"passed","title":"propagates errors from answerPreCheckoutQuery"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172317513,"runtime":642,"slow":false,"start":1745172316871},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/helpers/error/errorMessage.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["errorMessage"],"duration":4,"failureMessages":[],"fullName":"errorMessage sends Russian message when isRu true","status":"passed","title":"sends Russian message when isRu true"},{"ancestorTitles":["errorMessage"],"duration":2,"failureMessages":[],"fullName":"errorMessage sends English message when isRu false","status":"passed","title":"sends English message when isRu false"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172317638,"runtime":1099,"slow":false,"start":1745172316539},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/commands/get100Command.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["get100Command"],"duration":12,"failureMessages":[],"fullName":"get100Command should throw error when from.id missing","status":"passed","title":"should throw error when from.id missing"},{"ancestorTitles":["get100Command"],"duration":2,"failureMessages":[],"fullName":"get100Command should reply error and return when chat.id is missing","status":"passed","title":"should reply error and return when chat.id is missing"},{"ancestorTitles":["get100Command"],"duration":2,"failureMessages":[],"fullName":"get100Command should call generateNeuroImage and deleteMessage on success","status":"passed","title":"should call generateNeuroImage and deleteMessage on success"}]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172317668,"runtime":759,"slow":false,"start":1745172316909},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/getPhotoUrl.unit.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getPhotoUrl unit tests"],"duration":3,"failureMessages":[],"fullName":"getPhotoUrl unit tests returns URL for first token","status":"passed","title":"returns URL for first token"},{"ancestorTitles":["getPhotoUrl unit tests"],"duration":0,"failureMessages":[],"fullName":"getPhotoUrl unit tests returns URL for second token","status":"passed","title":"returns URL for second token"},{"ancestorTitles":["getPhotoUrl unit tests"],"duration":0,"failureMessages":[],"fullName":"getPhotoUrl unit tests returns URL for third token","status":"passed","title":"returns URL for third token"},{"ancestorTitles":["getPhotoUrl unit tests"],"duration":0,"failureMessages":[],"fullName":"getPhotoUrl unit tests falls back to default for unknown token","status":"passed","title":"falls back to default for unknown token"}]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/services/downloadFile.unit.test.ts","failureMessage":"  ● Test suite failed to run\n\n    Failed to load .env file at /Users/playom/999-multibots-telegraf/.env\n\n      23 |   } else {\n      24 |     // Для dev режима бросим ошибку, чтобы nodemon показал проблему\n    > 25 |     throw new Error(`Failed to load .env file at ${envPath}`)\n         |           ^\n      26 |   }\n      27 | } else if (!loadResult.parsed || Object.keys(loadResult.parsed).length === 0) {\n      28 |   console.error(\n\n      at Object.<anonymous> (src/config/index.ts:25:11)\n      at Object.require (src/services/generateLipSync.ts:3:1)\n      at Object.<anonymous> (__tests__/services/downloadFile.unit.test.ts:10:1)\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/services/generateTextToSpeech.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/services/generateTextToSpeech.test.ts\u001b[0m:\u001b[93m2\u001b[0m:\u001b[93m3\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2614: \u001b[0mModule '\"axios\"' has no exported member 'describe'. Did you mean to use 'import describe from \"axios\"' instead?\n\n    \u001b[7m2\u001b[0m   describe,\n    \u001b[7m \u001b[0m \u001b[91m  ~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateTextToSpeech.test.ts\u001b[0m:\u001b[93m3\u001b[0m:\u001b[93m3\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2614: \u001b[0mModule '\"axios\"' has no exported member 'it'. Did you mean to use 'import it from \"axios\"' instead?\n\n    \u001b[7m3\u001b[0m   it,\n    \u001b[7m \u001b[0m \u001b[91m  ~~\u001b[0m\n    \u001b[96m__tests__/services/generateTextToSpeech.test.ts\u001b[0m:\u001b[93m4\u001b[0m:\u001b[93m3\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2614: \u001b[0mModule '\"axios\"' has no exported member 'expect'. Did you mean to use 'import expect from \"axios\"' instead?\n\n    \u001b[7m4\u001b[0m   expect,\n    \u001b[7m \u001b[0m \u001b[91m  ~~~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateTextToSpeech.test.ts\u001b[0m:\u001b[93m5\u001b[0m:\u001b[93m3\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2614: \u001b[0mModule '\"axios\"' has no exported member 'jest'. Did you mean to use 'import jest from \"axios\"' instead?\n\n    \u001b[7m5\u001b[0m   jest,\n    \u001b[7m \u001b[0m \u001b[91m  ~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateTextToSpeech.test.ts\u001b[0m:\u001b[93m6\u001b[0m:\u001b[93m3\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2614: \u001b[0mModule '\"axios\"' has no exported member 'beforeEach'. Did you mean to use 'import beforeEach from \"axios\"' instead?\n\n    \u001b[7m6\u001b[0m   beforeEach,\n    \u001b[7m \u001b[0m \u001b[91m  ~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateTextToSpeech.test.ts\u001b[0m:\u001b[93m7\u001b[0m:\u001b[93m3\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2614: \u001b[0mModule '\"axios\"' has no exported member 'afterEach'. Did you mean to use 'import afterEach from \"axios\"' instead?\n\n    \u001b[7m7\u001b[0m   afterEach,\n    \u001b[7m \u001b[0m \u001b[91m  ~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateTextToSpeech.test.ts\u001b[0m:\u001b[93m8\u001b[0m:\u001b[93m1\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2614: \u001b[0mModule '\"axios\"' has no exported member 'import'. Did you mean to use 'import import from \"axios\"' instead?\n\n    \u001b[7m8\u001b[0m import axios from 'axios'\n    \u001b[7m \u001b[0m \u001b[91m~~~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateTextToSpeech.test.ts\u001b[0m:\u001b[93m8\u001b[0m:\u001b[93m8\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2440: \u001b[0mImport declaration conflicts with local declaration of 'axios'.\n\n    \u001b[7m8\u001b[0m import axios from 'axios'\n    \u001b[7m \u001b[0m \u001b[91m       ~~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateTextToSpeech.test.ts\u001b[0m:\u001b[93m9\u001b[0m:\u001b[93m29\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2307: \u001b[0mCannot find module '../../../__tests__/utils/mockTelegrafContext' or its corresponding type declarations.\n\n    \u001b[7m9\u001b[0m import makeMockContext from '../../../__tests__/utils/mockTelegrafContext'\n    \u001b[7m \u001b[0m \u001b[91m                            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateTextToSpeech.test.ts\u001b[0m:\u001b[93m33\u001b[0m:\u001b[93m7\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2440: \u001b[0mImport declaration conflicts with local declaration of 'axios'.\n\n    \u001b[7m33\u001b[0m const axios = require('axios') // Теперь можно require\n    \u001b[7m  \u001b[0m \u001b[91m      ~~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateTextToSpeech.test.ts\u001b[0m:\u001b[93m8\u001b[0m:\u001b[93m1\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1003: \u001b[0mIdentifier expected.\n\n    \u001b[7m8\u001b[0m import axios from 'axios'\n    \u001b[7m \u001b[0m \u001b[91m~~~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateTextToSpeech.test.ts\u001b[0m:\u001b[93m8\u001b[0m:\u001b[93m8\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1005: \u001b[0m',' expected.\n\n    \u001b[7m8\u001b[0m import axios from 'axios'\n    \u001b[7m \u001b[0m \u001b[91m       ~~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateTextToSpeech.test.ts\u001b[0m:\u001b[93m8\u001b[0m:\u001b[93m14\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1005: \u001b[0m',' expected.\n\n    \u001b[7m8\u001b[0m import axios from 'axios'\n    \u001b[7m \u001b[0m \u001b[91m             ~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/services/generateTextToImage.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/services/generateTextToImage.test.ts\u001b[0m:\u001b[93m12\u001b[0m:\u001b[93m61\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '() => void' is not assignable to parameter of type '(infoObject: object) => Logger'.\n      Type 'void' is not assignable to type 'Logger'.\n\n    \u001b[7m12\u001b[0m     infoSpy = jest.spyOn(logger, 'info').mockImplementation(() => {})\n    \u001b[7m  \u001b[0m \u001b[91m                                                            ~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/services/generateImageToPrompt.unit.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/services/generateImageToPrompt.unit.test.ts\u001b[0m:\u001b[93m25\u001b[0m:\u001b[93m76\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'boolean' is not assignable to parameter of type 'string'.\n\n    \u001b[7m25\u001b[0m     const result = await generateImageToPrompt(imageUrl, telegram_id, ctx, true, 'bot')\n    \u001b[7m  \u001b[0m \u001b[91m                                                                           ~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateImageToPrompt.unit.test.ts\u001b[0m:\u001b[93m33\u001b[0m:\u001b[93m6\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2352: \u001b[0mConversion of type '<T = any, D = any>(payload: any) => payload is AxiosError<T, D>' to type 'Mock<any, any, any>' may be a mistake because neither type sufficiently overlaps with the other. If this was intentional, convert the expression to 'unknown' first.\n      Type '<T = any, D = any>(payload: any) => payload is AxiosError<T, D>' is missing the following properties from type 'Mock<any, any, any>': getMockName, mock, mockClear, mockReset, and 13 more.\n\n    \u001b[7m33\u001b[0m     (axios.isAxiosError as jest.Mock).mockReturnValue(false)\n    \u001b[7m  \u001b[0m \u001b[91m     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateImageToPrompt.unit.test.ts\u001b[0m:\u001b[93m34\u001b[0m:\u001b[93m76\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'boolean' is not assignable to parameter of type 'string'.\n\n    \u001b[7m34\u001b[0m     const result = await generateImageToPrompt(imageUrl, telegram_id, ctx, false, 'bot')\n    \u001b[7m  \u001b[0m \u001b[91m                                                                           ~~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateImageToPrompt.unit.test.ts\u001b[0m:\u001b[93m58\u001b[0m:\u001b[93m6\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2352: \u001b[0mConversion of type '<T = any, D = any>(payload: any) => payload is AxiosError<T, D>' to type 'Mock<any, any, any>' may be a mistake because neither type sufficiently overlaps with the other. If this was intentional, convert the expression to 'unknown' first.\n      Type '<T = any, D = any>(payload: any) => payload is AxiosError<T, D>' is missing the following properties from type 'Mock<any, any, any>': getMockName, mock, mockClear, mockReset, and 13 more.\n\n    \u001b[7m58\u001b[0m     (axios.isAxiosError as jest.Mock).mockReturnValue(true)\n    \u001b[7m  \u001b[0m \u001b[91m     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateImageToPrompt.unit.test.ts\u001b[0m:\u001b[93m59\u001b[0m:\u001b[93m61\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'boolean' is not assignable to parameter of type 'string'.\n\n    \u001b[7m59\u001b[0m     await generateImageToPrompt(imageUrl, telegram_id, ctx, true, 'bot')\n    \u001b[7m  \u001b[0m \u001b[91m                                                            ~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateImageToPrompt.unit.test.ts\u001b[0m:\u001b[93m67\u001b[0m:\u001b[93m17\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Type 'Error' has no call signatures.\n\n    \u001b[7m67\u001b[0m     const err = new Error('boom')\n    \u001b[7m  \u001b[0m \u001b[91m                ~~~~~~~~~~~~~~~~~\u001b[0m\n\n      \u001b[96m__tests__/services/generateImageToPrompt.unit.test.ts\u001b[0m:\u001b[93m67\u001b[0m:\u001b[93m17\u001b[0m\n        \u001b[7m67\u001b[0m     const err = new Error('boom')\n        \u001b[7m  \u001b[0m \u001b[96m                ~~~~~~~~~~~~~~~~~\u001b[0m\n        Are you missing a semicolon?\n    \u001b[96m__tests__/services/generateImageToPrompt.unit.test.ts\u001b[0m:\u001b[93m68\u001b[0m:\u001b[93m49\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2448: \u001b[0mBlock-scoped variable 'err' used before its declaration.\n\n    \u001b[7m68\u001b[0m     (axios.post as jest.Mock).mockRejectedValue(err)\n    \u001b[7m  \u001b[0m \u001b[91m                                                ~~~\u001b[0m\n\n      \u001b[96m__tests__/services/generateImageToPrompt.unit.test.ts\u001b[0m:\u001b[93m67\u001b[0m:\u001b[93m11\u001b[0m\n        \u001b[7m67\u001b[0m     const err = new Error('boom')\n        \u001b[7m  \u001b[0m \u001b[96m          ~~~\u001b[0m\n        'err' is declared here.\n    \u001b[96m__tests__/services/generateImageToPrompt.unit.test.ts\u001b[0m:\u001b[93m69\u001b[0m:\u001b[93m6\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2352: \u001b[0mConversion of type '<T = any, D = any>(payload: any) => payload is AxiosError<T, D>' to type 'Mock<any, any, any>' may be a mistake because neither type sufficiently overlaps with the other. If this was intentional, convert the expression to 'unknown' first.\n      Type '<T = any, D = any>(payload: any) => payload is AxiosError<T, D>' is missing the following properties from type 'Mock<any, any, any>': getMockName, mock, mockClear, mockReset, and 13 more.\n\n    \u001b[7m69\u001b[0m     (axios.isAxiosError as jest.Mock).mockReturnValue(false)\n    \u001b[7m  \u001b[0m \u001b[91m     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/services/generateImageToPrompt.unit.test.ts\u001b[0m:\u001b[93m71\u001b[0m:\u001b[93m57\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'boolean' is not assignable to parameter of type 'string'.\n\n    \u001b[7m71\u001b[0m       generateImageToPrompt(imageUrl, telegram_id, ctx, false, 'bot')\n    \u001b[7m  \u001b[0m \u001b[91m                                                        ~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/services/generateLipSync.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/services/generateLipSync.test.ts\u001b[0m:\u001b[93m61\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Type 'typeof jest' has no call signatures.\n\n    \u001b[7m61\u001b[0m     jest.doMock('@/config', () => ({ isDev: false, ELESTIO_URL: 'https://api', LOCAL_SERVER_URL: 'http://localhost', SECRET_API_KEY: 'secret' }))\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n\n      \u001b[96m__tests__/services/generateLipSync.test.ts\u001b[0m:\u001b[93m61\u001b[0m:\u001b[93m5\u001b[0m\n        \u001b[7m61\u001b[0m     jest.doMock('@/config', () => ({ isDev: false, ELESTIO_URL: 'https://api', LOCAL_SERVER_URL: 'http://localhost', SECRET_API_KEY: 'secret' }))\n        \u001b[7m  \u001b[0m \u001b[96m    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n        Are you missing a semicolon?\n    \u001b[96m__tests__/services/generateLipSync.test.ts\u001b[0m:\u001b[93m83\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Type 'typeof jest' has no call signatures.\n\n    \u001b[7m83\u001b[0m     jest.doMock('axios', () => axios)\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n\n      \u001b[96m__tests__/services/generateLipSync.test.ts\u001b[0m:\u001b[93m83\u001b[0m:\u001b[93m5\u001b[0m\n        \u001b[7m83\u001b[0m     jest.doMock('axios', () => axios)\n        \u001b[7m  \u001b[0m \u001b[96m    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n        Are you missing a semicolon?\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/services/downloadFile.test.ts","failureMessage":"  ● Test suite failed to run\n\n    Failed to load .env file at /Users/playom/999-multibots-telegraf/.env\n\n      23 |   } else {\n      24 |     // Для dev режима бросим ошибку, чтобы nodemon показал проблему\n    > 25 |     throw new Error(`Failed to load .env file at ${envPath}`)\n         |           ^\n      26 |   }\n      27 | } else if (!loadResult.parsed || Object.keys(loadResult.parsed).length === 0) {\n      28 |   console.error(\n\n      at Object.<anonymous> (src/config/index.ts:25:11)\n      at Object.require (src/services/generateLipSync.ts:3:1)\n      at Object.<anonymous> (__tests__/services/downloadFile.test.ts:6:1)\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/services/createModelTraining.unit.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/services/createModelTraining.unit.test.ts\u001b[0m:\u001b[93m72\u001b[0m:\u001b[93m17\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Type 'Error' has no call signatures.\n\n    \u001b[7m72\u001b[0m     const err = new Error('xyz')\n    \u001b[7m  \u001b[0m \u001b[91m                ~~~~~~~~~~~~~~~~\u001b[0m\n\n      \u001b[96m__tests__/services/createModelTraining.unit.test.ts\u001b[0m:\u001b[93m72\u001b[0m:\u001b[93m17\u001b[0m\n        \u001b[7m72\u001b[0m     const err = new Error('xyz')\n        \u001b[7m  \u001b[0m \u001b[96m                ~~~~~~~~~~~~~~~~\u001b[0m\n        Are you missing a semicolon?\n    \u001b[96m__tests__/services/createModelTraining.unit.test.ts\u001b[0m:\u001b[93m73\u001b[0m:\u001b[93m49\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2448: \u001b[0mBlock-scoped variable 'err' used before its declaration.\n\n    \u001b[7m73\u001b[0m     (axios.post as jest.Mock).mockRejectedValue(err)\n    \u001b[7m  \u001b[0m \u001b[91m                                                ~~~\u001b[0m\n\n      \u001b[96m__tests__/services/createModelTraining.unit.test.ts\u001b[0m:\u001b[93m72\u001b[0m:\u001b[93m11\u001b[0m\n        \u001b[7m72\u001b[0m     const err = new Error('xyz')\n        \u001b[7m  \u001b[0m \u001b[96m          ~~~\u001b[0m\n        'err' is declared here.\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/helpers/index.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/helpers/index.test.ts\u001b[0m:\u001b[93m16\u001b[0m:\u001b[93m27\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'language' does not exist on type 'typeof import(\"/Users/playom/999-multibots-telegraf/src/helpers/index\")'.\n\n    \u001b[7m16\u001b[0m     expect(typeof helpers.language).toBe('function')\n    \u001b[7m  \u001b[0m \u001b[91m                          ~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/helpers/pulse.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/helpers/pulse.test.ts\u001b[0m:\u001b[93m15\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2322: \u001b[0mType 'Mock<Promise<void>, [], any>' is not assignable to type '(chatId: string | number, photo: string | InputFile, extra?: { message_thread_id?: number; parse_mode?: ParseMode; caption_entities?: MessageEntity[]; ... 5 more ...; caption?: string | FmtString<...>; }) => Promise<...>'.\n      Type 'Promise<void>' is not assignable to type 'Promise<PhotoMessage>'.\n        Type 'void' is not assignable to type 'PhotoMessage'.\n\n    \u001b[7m15\u001b[0m     ctx.telegram.sendPhoto = jest.fn(() => Promise.resolve())\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/helpers/pulse.test.ts\u001b[0m:\u001b[93m16\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2322: \u001b[0mType 'Mock<Promise<void>, [], any>' is not assignable to type '(chatId: string | number, text: string | FmtString<string>, extra?: Omit<{ chat_id: string | number; message_thread_id?: number; text: string; parse_mode?: ParseMode; ... 5 more ...; reply_markup?: InlineKeyboardMarkup | ... 2 more ... | ForceReply; }, \"text\" | \"chat_id\">) => Promise<...>'.\n      Type 'Promise<void>' is not assignable to type 'Promise<TextMessage>'.\n        Type 'void' is not assignable to type 'TextMessage'.\n\n    \u001b[7m16\u001b[0m     ctx.telegram.sendMessage = jest.fn(() => Promise.resolve())\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/helpers/pulse.test.ts\u001b[0m:\u001b[93m22\u001b[0m:\u001b[93m17\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'MyContext & DebugExtension' is not assignable to parameter of type 'string | PulseOptions'.\n\n    \u001b[7m22\u001b[0m     await pulse(ctx, base64Image, prompt, command)\n    \u001b[7m  \u001b[0m \u001b[91m                ~~~\u001b[0m\n    \u001b[96m__tests__/helpers/pulse.test.ts\u001b[0m:\u001b[93m29\u001b[0m:\u001b[93m17\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'MyContext & DebugExtension' is not assignable to parameter of type 'string | PulseOptions'.\n\n    \u001b[7m29\u001b[0m     await pulse(ctx, base64Image, prompt, command)\n    \u001b[7m  \u001b[0m \u001b[91m                ~~~\u001b[0m\n    \u001b[96m__tests__/helpers/pulse.test.ts\u001b[0m:\u001b[93m42\u001b[0m:\u001b[93m17\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'MyContext & DebugExtension' is not assignable to parameter of type 'string | PulseOptions'.\n\n    \u001b[7m42\u001b[0m     await pulse(ctx, null, prompt, command)\n    \u001b[7m  \u001b[0m \u001b[91m                ~~~\u001b[0m\n    \u001b[96m__tests__/helpers/pulse.test.ts\u001b[0m:\u001b[93m58\u001b[0m:\u001b[93m17\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'MyContext & DebugExtension' is not assignable to parameter of type 'string | PulseOptions'.\n\n    \u001b[7m58\u001b[0m     await pulse(ctx, base64Image, prompt, command)\n    \u001b[7m  \u001b[0m \u001b[91m                ~~~\u001b[0m\n    \u001b[96m__tests__/helpers/pulse.test.ts\u001b[0m:\u001b[93m66\u001b[0m:\u001b[93m24\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'MyContext & DebugExtension' is not assignable to parameter of type 'string | PulseOptions'.\n\n    \u001b[7m66\u001b[0m     await expect(pulse(ctx, null, prompt, command)).rejects.toThrow(\n    \u001b[7m  \u001b[0m \u001b[91m                       ~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/helpers/error/errorHandler.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/helpers/error/errorHandler.test.ts\u001b[0m:\u001b[93m10\u001b[0m:\u001b[93m52\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '() => void' is not assignable to parameter of type '(infoObject: object) => Logger'.\n      Type 'void' is not assignable to type 'Logger'.\n\n    \u001b[7m10\u001b[0m     jest.spyOn(logger, 'error').mockImplementation(() => {});\n    \u001b[7m  \u001b[0m \u001b[91m                                                   ~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/helpers/error/errorHandler.test.ts\u001b[0m:\u001b[93m11\u001b[0m:\u001b[93m51\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '() => void' is not assignable to parameter of type '(infoObject: object) => Logger'.\n      Type 'void' is not assignable to type 'Logger'.\n\n    \u001b[7m11\u001b[0m     jest.spyOn(logger, 'warn').mockImplementation(() => {});\n    \u001b[7m  \u001b[0m \u001b[91m                                                  ~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/hearsHandlers.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/handlers/hearsHandlers.test.ts\u001b[0m:\u001b[93m3\u001b[0m:\u001b[93m27\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2307: \u001b[0mCannot find module '../src/interfaces' or its corresponding type declarations.\n\n    \u001b[7m3\u001b[0m import { MyContext } from '../src/interfaces'\n    \u001b[7m \u001b[0m \u001b[91m                          ~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/hearsHandlers.test.ts\u001b[0m:\u001b[93m25\u001b[0m:\u001b[93m36\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2307: \u001b[0mCannot find module '../src/hearsHandlers' or its corresponding type declarations.\n\n    \u001b[7m25\u001b[0m import { setupHearsHandlers } from '../src/hearsHandlers'\n    \u001b[7m  \u001b[0m \u001b[91m                                   ~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/hearsHandlers.test.ts\u001b[0m:\u001b[93m26\u001b[0m:\u001b[93m24\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2307: \u001b[0mCannot find module '../src/menu' or its corresponding type declarations.\n\n    \u001b[7m26\u001b[0m import { levels } from '../src/menu' // Импортируем levels\n    \u001b[7m  \u001b[0m \u001b[91m                       ~~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/index.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/handlers/index.test.ts\u001b[0m:\u001b[93m21\u001b[0m:\u001b[93m28\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'registerHearsActions' does not exist on type 'typeof import(\"/Users/playom/999-multibots-telegraf/src/handlers/index\")'.\n\n    \u001b[7m21\u001b[0m     expect(typeof handlers.registerHearsActions).toBe('function')\n    \u001b[7m  \u001b[0m \u001b[91m                           ~~~~~~~~~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":3,"numPassingTests":1,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172320068,"runtime":1449,"slow":false,"start":1745172318619},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/handleMenu.test.ts","failureMessage":"  ● handleMenu › handles subscription button in Russian\n\n    TypeError: Cannot read properties of undefined (reading 'title_ru')\n\n      19 |\n      20 |   it('handles subscription button in Russian', async () => {\n    > 21 |     const text = levels[0].title_ru\n         |                            ^\n      22 |     const testCtx = makeMockContext({\n      23 |       message: {\n      24 |         text,\n\n      at __tests__/handlers/handleMenu.test.ts:21:28\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/handlers/handleMenu.test.ts:20:59)\n\n  ● handleMenu › handles subscription button in English\n\n    TypeError: Cannot read properties of undefined (reading 'title_en')\n\n      40 |\n      41 |   it('handles subscription button in English', async () => {\n    > 42 |     const text = levels[0].title_en\n         |                            ^\n      43 |     const testCtx = makeMockContext({\n      44 |       message: {\n      45 |         text,\n\n      at __tests__/handlers/handleMenu.test.ts:42:28\n      at node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n      at Object.__awaiter (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n      at Object.<anonymous> (__tests__/handlers/handleMenu.test.ts:41:59)\n\n  ● handleMenu › does nothing for unknown text\n\n    expect(received).toBeUndefined()\n\n    Received: \"text_to_image\"\n\n       98 |\n       99 |     await handleMenu(testCtx as any)\n    > 100 |     expect(testCtx.session.mode).toBeUndefined()\n          |                                  ^\n      101 |     expect(testCtx.scene.enter).not.toHaveBeenCalled()\n      102 |   })\n      103 | })\n\n      at __tests__/handlers/handleMenu.test.ts:100:34\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["handleMenu"],"duration":1,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'title_ru')\n    at /Users/playom/999-multibots-telegraf/__tests__/handlers/handleMenu.test.ts:21:28\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/handlers/handleMenu.test.ts:20:59)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"handleMenu handles subscription button in Russian","status":"failed","title":"handles subscription button in Russian"},{"ancestorTitles":["handleMenu"],"duration":1,"failureMessages":["TypeError: Cannot read properties of undefined (reading 'title_en')\n    at /Users/playom/999-multibots-telegraf/__tests__/handlers/handleMenu.test.ts:42:28\n    at Generator.next (<anonymous>)\n    at /Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:170:75\n    at new Promise (<anonymous>)\n    at Object.__awaiter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:166:16)\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/handlers/handleMenu.test.ts:41:59)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"handleMenu handles subscription button in English","status":"failed","title":"handles subscription button in English"},{"ancestorTitles":["handleMenu"],"duration":160,"failureMessages":[],"fullName":"handleMenu handles slash price command","status":"passed","title":"handles slash price command"},{"ancestorTitles":["handleMenu"],"duration":17,"failureMessages":["Error: expect(received).toBeUndefined()\n\nReceived: \"text_to_image\"\n    at /Users/playom/999-multibots-telegraf/__tests__/handlers/handleMenu.test.ts:100:34\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"handleMenu does nothing for unknown text","status":"failed","title":"does nothing for unknown text"}]},{"numFailingTests":2,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172320210,"runtime":1485,"slow":false,"start":1745172318725},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/paymentHandlers.test.ts","failureMessage":"  ● handleSelectStars › sends inline keyboard with star packages (RU)\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 2\n    Received: 4\n\n      57 |     const reply = ctx.debug.replies[0]\n      58 |     const markup = reply.extra.reply_markup\n    > 59 |     expect(markup.inline_keyboard.length).toBe(2)\n         |                                           ^\n      60 |     expect(markup.inline_keyboard[0].map((b: any) => b.callback_data)).toEqual([\n      61 |       'top_up_5',\n      62 |       'top_up_10',\n\n      at __tests__/handlers/paymentHandlers.test.ts:59:43\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● handleSelectStars › sends inline keyboard with star packages (EN)\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 1\n    Received: 3\n\n      73 |     const reply = ctx.debug.replies[0]\n      74 |     const markup = reply.extra.reply_markup\n    > 75 |     expect(markup.inline_keyboard.length).toBe(1)\n         |                                           ^\n      76 |     expect(markup.inline_keyboard[0].map((b: any) => b.text)).toEqual([\n      77 |       '1⭐️',\n      78 |       '2⭐️',\n\n      at __tests__/handlers/paymentHandlers.test.ts:75:43\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["handleBuySubscription"],"duration":13,"failureMessages":[],"fullName":"handleBuySubscription sends invoice and leaves scene for neurophoto subscription (RU)","status":"passed","title":"sends invoice and leaves scene for neurophoto subscription (RU)"},{"ancestorTitles":["handleBuySubscription"],"duration":2,"failureMessages":[],"fullName":"handleBuySubscription sends invoice and leaves scene for neurobase subscription (EN)","status":"passed","title":"sends invoice and leaves scene for neurobase subscription (EN)"},{"ancestorTitles":["handleSelectStars"],"duration":59,"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 2\nReceived: 4\n    at /Users/playom/999-multibots-telegraf/__tests__/handlers/paymentHandlers.test.ts:59:43\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"handleSelectStars sends inline keyboard with star packages (RU)","status":"failed","title":"sends inline keyboard with star packages (RU)"},{"ancestorTitles":["handleSelectStars"],"duration":9,"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 1\nReceived: 3\n    at /Users/playom/999-multibots-telegraf/__tests__/handlers/paymentHandlers.test.ts:75:43\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"handleSelectStars sends inline keyboard with star packages (EN)","status":"failed","title":"sends inline keyboard with star packages (EN)"}]},{"numFailingTests":2,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172320380,"runtime":1136,"slow":false,"start":1745172319244},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/hearsActions.test.ts","failureMessage":"  ● registerHearsActions › handler for main_menu sets session.mode and enters scene\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"menuScene\"\n    Received: \"main_menu\"\n\n    Number of calls: 1\n\n      49 |     await handler(ctx)\n      50 |     expect(ctx.session.mode).toBe(ModeEnum.MainMenu)\n    > 51 |     expect(ctx.scene.enter).toHaveBeenCalledWith(ModeEnum.MenuScene)\n         |                             ^\n      52 |   })\n      53 |\n      54 |   it('handler for generate new video enters correct scene based on mode', async () => {\n\n      at __tests__/handlers/hearsActions.test.ts:51:29\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● registerHearsActions › handler for generate new video enters correct scene based on mode\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: StringContaining \"You cannot generate a new video in this mode\"\n    Received: \"Вы не можете сгенерировать новое видео в этом режиме\"\n\n    Number of calls: 1\n\n      72 |     jest.clearAllMocks()\n      73 |     await handler(ctx)\n    > 74 |     expect(ctx.reply).toHaveBeenCalledWith(\n         |                       ^\n      75 |       expect.stringContaining('You cannot generate a new video in this mode')\n      76 |     )\n      77 |   })\n\n      at __tests__/handlers/hearsActions.test.ts:74:23\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["registerHearsActions"],"duration":28,"failureMessages":[],"fullName":"registerHearsActions registers three hears actions","status":"passed","title":"registers three hears actions"},{"ancestorTitles":["registerHearsActions"],"duration":6,"failureMessages":[],"fullName":"registerHearsActions handler for text_to_speech sets session.mode and enters scene","status":"passed","title":"handler for text_to_speech sets session.mode and enters scene"},{"ancestorTitles":["registerHearsActions"],"duration":7,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"menuScene\"\nReceived: \"main_menu\"\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/handlers/hearsActions.test.ts:51:29\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"registerHearsActions handler for main_menu sets session.mode and enters scene","status":"failed","title":"handler for main_menu sets session.mode and enters scene"},{"ancestorTitles":["registerHearsActions"],"duration":29,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: StringContaining \"You cannot generate a new video in this mode\"\nReceived: \"Вы не можете сгенерировать новое видео в этом режиме\"\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/handlers/hearsActions.test.ts:74:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"registerHearsActions handler for generate new video enters correct scene based on mode","status":"failed","title":"handler for generate new video enters correct scene based on mode"}]},{"numFailingTests":1,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172320703,"runtime":1304,"slow":false,"start":1745172319399},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/getBotToken.test.ts","failureMessage":"  ● getBotToken › returns first BOT_TOKENS[0] by default\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"firstToken\"\n    Received: \"unknown\"\n\n      17 |       telegram: { token: 'unknown' } as any,\n      18 |     }\n    > 19 |     expect(getBotToken(ctx as MyContext)).toBe(BOT_TOKENS[0])\n         |                                           ^\n      20 |   })\n      21 |   it('returns BOT_TOKENS[0] when token matches', () => {\n      22 |     const ctx: Partial<MyContext> = {\n\n      at Object.<anonymous> (__tests__/handlers/getBotToken.test.ts:19:43)\n","testResults":[{"ancestorTitles":["getBotToken"],"duration":3,"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: \"firstToken\"\nReceived: \"unknown\"\n    at Object.<anonymous> (/Users/playom/999-multibots-telegraf/__tests__/handlers/getBotToken.test.ts:19:43)\n    at Promise.then.completed (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/testWorker.js:106:12)"],"fullName":"getBotToken returns first BOT_TOKENS[0] by default","status":"failed","title":"returns first BOT_TOKENS[0] by default"},{"ancestorTitles":["getBotToken"],"duration":1,"failureMessages":[],"fullName":"getBotToken returns BOT_TOKENS[0] when token matches","status":"passed","title":"returns BOT_TOKENS[0] when token matches"},{"ancestorTitles":["getBotToken"],"duration":0,"failureMessages":[],"fullName":"getBotToken returns BOT_TOKENS[1] when token matches second","status":"passed","title":"returns BOT_TOKENS[1] when token matches second"}]},{"numFailingTests":2,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172320806,"runtime":1131,"slow":false,"start":1745172319675},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/handleHelpCancel.test.ts","failureMessage":"  ● handleHelpCancel › handles Russian cancel command\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"menuScene\"\n    Received: \"main_menu\"\n\n    Number of calls: 1\n\n      24 |     expect(result).toBe(true)\n      25 |     expect(ctx.reply).toHaveBeenCalledWith('❌ Процесс отменён.')\n    > 26 |     expect(ctx.scene.enter).toHaveBeenCalledWith('menuScene')\n         |                             ^\n      27 |     expect(ctx.scene.leave).not.toHaveBeenCalled()\n      28 |   })\n      29 |\n\n      at __tests__/handlers/handleHelpCancel.test.ts:26:29\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● handleHelpCancel › handles English cancel command\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"menuScene\"\n    Received: \"main_menu\"\n\n    Number of calls: 1\n\n      44 |     expect(result).toBe(true)\n      45 |     expect(ctx.reply).toHaveBeenCalledWith('❌ Process cancelled.')\n    > 46 |     expect(ctx.scene.enter).toHaveBeenCalledWith('menuScene')\n         |                             ^\n      47 |     expect(ctx.scene.leave).not.toHaveBeenCalled()\n      48 |   })\n      49 |\n\n      at __tests__/handlers/handleHelpCancel.test.ts:46:29\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["handleHelpCancel"],"duration":10,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"menuScene\"\nReceived: \"main_menu\"\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/handlers/handleHelpCancel.test.ts:26:29\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"handleHelpCancel handles Russian cancel command","status":"failed","title":"handles Russian cancel command"},{"ancestorTitles":["handleHelpCancel"],"duration":2,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"menuScene\"\nReceived: \"main_menu\"\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/handlers/handleHelpCancel.test.ts:46:29\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"handleHelpCancel handles English cancel command","status":"failed","title":"handles English cancel command"},{"ancestorTitles":["handleHelpCancel"],"duration":2,"failureMessages":[],"fullName":"handleHelpCancel handles Russian help for the command","status":"passed","title":"handles Russian help for the command"},{"ancestorTitles":["handleHelpCancel"],"duration":5,"failureMessages":[],"fullName":"handleHelpCancel handles English help for the command","status":"passed","title":"handles English help for the command"},{"ancestorTitles":["handleHelpCancel"],"duration":3,"failureMessages":[],"fullName":"handleHelpCancel returns false for non-matching text","status":"passed","title":"returns false for non-matching text"},{"ancestorTitles":["handleHelpCancel"],"duration":1,"failureMessages":[],"fullName":"handleHelpCancel returns false when message is missing","status":"passed","title":"returns false when message is missing"}]},{"numFailingTests":0,"numPassingTests":3,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172320986,"runtime":728,"slow":false,"start":1745172320258},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/getUserInfo.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["getUserInfo"],"duration":3,"failureMessages":[],"fullName":"getUserInfo returns userId and telegramId when ctx.from.id exists","status":"passed","title":"returns userId and telegramId when ctx.from.id exists"},{"ancestorTitles":["getUserInfo"],"duration":18,"failureMessages":[],"fullName":"getUserInfo replies error and leaves scene when ctx.from.id is missing","status":"passed","title":"replies error and leaves scene when ctx.from.id is missing"},{"ancestorTitles":["getUserInfo"],"duration":1,"failureMessages":[],"fullName":"getUserInfo uses English message when language_code is not ru","status":"passed","title":"uses English message when language_code is not ru"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172321432,"runtime":960,"slow":false,"start":1745172320472},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/handlePaymentPolicyInfo.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["handlePaymentPolicyInfo"],"duration":6,"failureMessages":[],"fullName":"handlePaymentPolicyInfo answers callback query and replies with policy in Russian","status":"passed","title":"answers callback query and replies with policy in Russian"},{"ancestorTitles":["handlePaymentPolicyInfo"],"duration":2,"failureMessages":[],"fullName":"handlePaymentPolicyInfo replies with policy in English when language_code is not ru","status":"passed","title":"replies with policy in English when language_code is not ru"}]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172321529,"runtime":1406,"slow":false,"start":1745172320123},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/handleTopUp.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["handleTopUp"],"duration":36,"failureMessages":[],"fullName":"handleTopUp calls handleBuy with correct parameters for Russian","status":"passed","title":"calls handleBuy with correct parameters for Russian"},{"ancestorTitles":["handleTopUp"],"duration":64,"failureMessages":[],"fullName":"handleTopUp calls handleBuy with correct parameters for English","status":"passed","title":"calls handleBuy with correct parameters for English"}]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/paymentActions.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/handlers/paymentActions.test.ts\u001b[0m:\u001b[93m14\u001b[0m:\u001b[93m23\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'handlePaymentPolicyInfo' does not exist on type 'typeof import(\"/Users/playom/999-multibots-telegraf/src/handlers/paymentHandlers/index\")'.\n\n    \u001b[7m14\u001b[0m       paymentHandlers.handlePaymentPolicyInfo\n    \u001b[7m  \u001b[0m \u001b[91m                      ~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/paymentActions.test.ts\u001b[0m:\u001b[93m20\u001b[0m:\u001b[93m23\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'handleTopUp' does not exist on type 'typeof import(\"/Users/playom/999-multibots-telegraf/src/handlers/paymentHandlers/index\")'.\n\n    \u001b[7m20\u001b[0m       paymentHandlers.handleTopUp\n    \u001b[7m  \u001b[0m \u001b[91m                      ~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/paymentActions.test.ts\u001b[0m:\u001b[93m26\u001b[0m:\u001b[93m23\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'handlePreCheckoutQuery' does not exist on type 'typeof import(\"/Users/playom/999-multibots-telegraf/src/handlers/paymentHandlers/index\")'.\n\n    \u001b[7m26\u001b[0m       paymentHandlers.handlePreCheckoutQuery\n    \u001b[7m  \u001b[0m \u001b[91m                      ~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":7,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172321883,"runtime":1573,"slow":false,"start":1745172320310},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/handleTextMessage.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["handleTextMessage"],"duration":25,"failureMessages":[],"fullName":"handleTextMessage skips commands starting with slash","status":"passed","title":"skips commands starting with slash"},{"ancestorTitles":["handleTextMessage"],"duration":26,"failureMessages":[],"fullName":"handleTextMessage replies error when message missing","status":"passed","title":"replies error when message missing"},{"ancestorTitles":["handleTextMessage"],"duration":14,"failureMessages":[],"fullName":"handleTextMessage replies error when text empty","status":"passed","title":"replies error when text empty"},{"ancestorTitles":["handleTextMessage"],"duration":16,"failureMessages":[],"fullName":"handleTextMessage processes message with existing user","status":"passed","title":"processes message with existing user"},{"ancestorTitles":["handleTextMessage"],"duration":13,"failureMessages":[],"fullName":"handleTextMessage uses fallback when user not found","status":"passed","title":"uses fallback when user not found"},{"ancestorTitles":["handleTextMessage"],"duration":63,"failureMessages":[],"fullName":"handleTextMessage replies GPT error when answerAi returns falsy","status":"passed","title":"replies GPT error when answerAi returns falsy"},{"ancestorTitles":["handleTextMessage"],"duration":25,"failureMessages":[],"fullName":"handleTextMessage replies and throws on exception","status":"passed","title":"replies and throws on exception"}]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/handleMenu.branches.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/handlers/handleMenu.branches.test.ts\u001b[0m:\u001b[93m50\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m50\u001b[0m       ctx.message = { text: c.text }\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/handlers/handleMenu.branches.test.ts\u001b[0m:\u001b[93m59\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m59\u001b[0m     ctx.message = { text: 'unknown' }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":2,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172322170,"runtime":1137,"slow":false,"start":1745172321033},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/handleSizeSelection.test.ts","failureMessage":"  ● handleSizeSelection › handles neuro_photo mode in Russian\n\n    TypeError: Cannot destructure property 'count' of '((cov_cppksg2f3(...).s[20]++) , (intermediate value))' as it is undefined.\n\n      21 |     console.log('CASE: Неизвестный режим')\n      22 |     const telegram_id = ctx.from?.id?.toString() || ''\n    > 23 |     const { count, subscriptionType, level, isExist } =\n         |             ^\n      24 |       await getReferalsCountAndUserData(telegram_id)\n      25 |\n      26 |     if (isExist) {\n\n      at count (src/handlers/handleSizeSelection/index.ts:23:13)\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● handleSizeSelection › calls mainMenu when mode unknown and user exists\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: 3\n    Received: \"3\"\n\n    Number of calls: 1\n\n      100 |     await handleSizeSelection(testCtx as any, '4:3')\n      101 |     expect(setAspectRatio).toHaveBeenCalledWith(3, '4:3')\n    > 102 |     expect(getReferalsCountAndUserData).toHaveBeenCalledWith(3)\n          |                                         ^\n      103 |     expect(mainMenu).toHaveBeenCalledWith({\n      104 |       isRu: false,\n      105 |       inviteCount: 5,\n\n      at __tests__/handlers/handleSizeSelection.test.ts:102:41\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["handleSizeSelection"],"duration":17,"failureMessages":["TypeError: Cannot destructure property 'count' of '((cov_cppksg2f3(...).s[20]++) , (intermediate value))' as it is undefined.\n    at count (/Users/playom/999-multibots-telegraf/src/handlers/handleSizeSelection/index.ts:23:13)\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"handleSizeSelection handles neuro_photo mode in Russian","status":"failed","title":"handles neuro_photo mode in Russian"},{"ancestorTitles":["handleSizeSelection"],"duration":3,"failureMessages":[],"fullName":"handleSizeSelection handles text_to_image mode in English","status":"passed","title":"handles text_to_image mode in English"},{"ancestorTitles":["handleSizeSelection"],"duration":6,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: 3\nReceived: \"3\"\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/handlers/handleSizeSelection.test.ts:102:41\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"handleSizeSelection calls mainMenu when mode unknown and user exists","status":"failed","title":"calls mainMenu when mode unknown and user exists"},{"ancestorTitles":["handleSizeSelection"],"duration":2,"failureMessages":[],"fullName":"handleSizeSelection enters helpScene when mode unknown and user does not exist","status":"passed","title":"enters helpScene when mode unknown and user does not exist"}]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/menu/createHelpCancelKeyboard.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/menu/createHelpCancelKeyboard.test.ts\u001b[0m:\u001b[93m1\u001b[0m:\u001b[93m10\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2305: \u001b[0mModule '\"@/menu/createHelpCancelKeyboard\"' has no exported member 'createHelpCancelKeyboard'.\n\n    \u001b[7m1\u001b[0m import { createHelpCancelKeyboard } from '@/menu/createHelpCancelKeyboard'\n    \u001b[7m \u001b[0m \u001b[91m         ~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172322549,"runtime":1079,"slow":false,"start":1745172321470},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/menu/sendGenericErrorMessage.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["sendGenericErrorMessage"],"duration":3,"failureMessages":[],"fullName":"sendGenericErrorMessage sends generic Russian message without error details","status":"passed","title":"sends generic Russian message without error details"},{"ancestorTitles":["sendGenericErrorMessage"],"duration":3,"failureMessages":[],"fullName":"sendGenericErrorMessage logs error and sends generic message when error provided","status":"passed","title":"logs error and sends generic message when error provided"},{"ancestorTitles":["sendGenericErrorMessage"],"duration":3,"failureMessages":[],"fullName":"sendGenericErrorMessage includes error details in development mode","status":"passed","title":"includes error details in development mode"},{"ancestorTitles":["sendGenericErrorMessage"],"duration":1,"failureMessages":[],"fullName":"sendGenericErrorMessage logs sendError when reply throws","status":"passed","title":"logs sendError when reply throws"}]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/menu/sendGenerationCancelledMessage.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/menu/sendGenerationCancelledMessage.test.ts\u001b[0m:\u001b[93m33\u001b[0m:\u001b[93m54\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'boolean' is not assignable to parameter of type 'string'.\n\n    \u001b[7m33\u001b[0m     await sendGenerationCancelledMessage(ctx as any, true)\n    \u001b[7m  \u001b[0m \u001b[91m                                                     ~~~~\u001b[0m\n    \u001b[96m__tests__/menu/sendGenerationCancelledMessage.test.ts\u001b[0m:\u001b[93m68\u001b[0m:\u001b[93m56\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'boolean' is not assignable to parameter of type 'string'.\n\n    \u001b[7m68\u001b[0m     await sendGenerationCancelledMessage(ctxEn as any, false)\n    \u001b[7m  \u001b[0m \u001b[91m                                                       ~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/menu/mainMenu.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/menu/mainMenu.test.ts\u001b[0m:\u001b[93m35\u001b[0m:\u001b[93m35\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '{ isRu: true; subscription: SubscriptionType.STARS; level: number; ctx: any; }' is not assignable to parameter of type '{ isRu: boolean; inviteCount: number; subscription: SubscriptionType; level: number; ctx: MyContext; }'.\n      Property 'inviteCount' is missing in type '{ isRu: true; subscription: SubscriptionType.STARS; level: number; ctx: any; }' but required in type '{ isRu: boolean; inviteCount: number; subscription: SubscriptionType; level: number; ctx: MyContext; }'.\n\n    \u001b[7m 35\u001b[0m     const markup = await mainMenu({\n    \u001b[7m   \u001b[0m \u001b[91m                                  ~\u001b[0m\n    \u001b[7m 36\u001b[0m       isRu: true,\n    \u001b[7m   \u001b[0m \u001b[91m~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[7m...\u001b[0m \n    \u001b[7m 39\u001b[0m       ctx: ctx as any,\n    \u001b[7m   \u001b[0m \u001b[91m~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[7m 40\u001b[0m     })\n    \u001b[7m   \u001b[0m \u001b[91m~~~~~\u001b[0m\n\n      \u001b[96msrc/menu/mainMenu.ts\u001b[0m:\u001b[93m118\u001b[0m:\u001b[93m3\u001b[0m\n        \u001b[7m118\u001b[0m   inviteCount: number\n        \u001b[7m   \u001b[0m \u001b[96m  ~~~~~~~~~~~\u001b[0m\n        'inviteCount' is declared here.\n    \u001b[96m__tests__/menu/mainMenu.test.ts\u001b[0m:\u001b[93m49\u001b[0m:\u001b[93m35\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '{ isRu: false; subscription: SubscriptionType.NEUROTESTER; level: number; ctx: any; }' is not assignable to parameter of type '{ isRu: boolean; inviteCount: number; subscription: SubscriptionType; level: number; ctx: MyContext; }'.\n      Property 'inviteCount' is missing in type '{ isRu: false; subscription: SubscriptionType.NEUROTESTER; level: number; ctx: any; }' but required in type '{ isRu: boolean; inviteCount: number; subscription: SubscriptionType; level: number; ctx: MyContext; }'.\n\n    \u001b[7m 49\u001b[0m     const markup = await mainMenu({\n    \u001b[7m   \u001b[0m \u001b[91m                                  ~\u001b[0m\n    \u001b[7m 50\u001b[0m       isRu: false,\n    \u001b[7m   \u001b[0m \u001b[91m~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[7m...\u001b[0m \n    \u001b[7m 53\u001b[0m       ctx: ctx as any,\n    \u001b[7m   \u001b[0m \u001b[91m~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[7m 54\u001b[0m     })\n    \u001b[7m   \u001b[0m \u001b[91m~~~~~\u001b[0m\n\n      \u001b[96msrc/menu/mainMenu.ts\u001b[0m:\u001b[93m118\u001b[0m:\u001b[93m3\u001b[0m\n        \u001b[7m118\u001b[0m   inviteCount: number\n        \u001b[7m   \u001b[0m \u001b[96m  ~~~~~~~~~~~\u001b[0m\n        'inviteCount' is declared here.\n    \u001b[96m__tests__/menu/mainMenu.test.ts\u001b[0m:\u001b[93m64\u001b[0m:\u001b[93m35\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '{ isRu: false; subscription: SubscriptionType.NEUROTESTER; level: number; ctx: any; }' is not assignable to parameter of type '{ isRu: boolean; inviteCount: number; subscription: SubscriptionType; level: number; ctx: MyContext; }'.\n      Property 'inviteCount' is missing in type '{ isRu: false; subscription: SubscriptionType.NEUROTESTER; level: number; ctx: any; }' but required in type '{ isRu: boolean; inviteCount: number; subscription: SubscriptionType; level: number; ctx: MyContext; }'.\n\n    \u001b[7m 64\u001b[0m     const markup = await mainMenu({\n    \u001b[7m   \u001b[0m \u001b[91m                                  ~\u001b[0m\n    \u001b[7m 65\u001b[0m       isRu: false,\n    \u001b[7m   \u001b[0m \u001b[91m~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[7m...\u001b[0m \n    \u001b[7m 68\u001b[0m       ctx: ctx as any,\n    \u001b[7m   \u001b[0m \u001b[91m~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[7m 69\u001b[0m     })\n    \u001b[7m   \u001b[0m \u001b[91m~~~~~\u001b[0m\n\n      \u001b[96msrc/menu/mainMenu.ts\u001b[0m:\u001b[93m118\u001b[0m:\u001b[93m3\u001b[0m\n        \u001b[7m118\u001b[0m   inviteCount: number\n        \u001b[7m   \u001b[0m \u001b[96m  ~~~~~~~~~~~\u001b[0m\n        'inviteCount' is declared here.\n    \u001b[96m__tests__/menu/mainMenu.test.ts\u001b[0m:\u001b[93m81\u001b[0m:\u001b[93m35\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '{ isRu: true; subscription: any; level: number; ctx: any; }' is not assignable to parameter of type '{ isRu: boolean; inviteCount: number; subscription: SubscriptionType; level: number; ctx: MyContext; }'.\n      Property 'inviteCount' is missing in type '{ isRu: true; subscription: any; level: number; ctx: any; }' but required in type '{ isRu: boolean; inviteCount: number; subscription: SubscriptionType; level: number; ctx: MyContext; }'.\n\n    \u001b[7m 81\u001b[0m     const markup = await mainMenu({\n    \u001b[7m   \u001b[0m \u001b[91m                                  ~\u001b[0m\n    \u001b[7m 82\u001b[0m       isRu: true,\n    \u001b[7m   \u001b[0m \u001b[91m~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[7m...\u001b[0m \n    \u001b[7m 85\u001b[0m       ctx: ctx as any,\n    \u001b[7m   \u001b[0m \u001b[91m~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[7m 86\u001b[0m     })\n    \u001b[7m   \u001b[0m \u001b[91m~~~~~\u001b[0m\n\n      \u001b[96msrc/menu/mainMenu.ts\u001b[0m:\u001b[93m118\u001b[0m:\u001b[93m3\u001b[0m\n        \u001b[7m118\u001b[0m   inviteCount: number\n        \u001b[7m   \u001b[0m \u001b[96m  ~~~~~~~~~~~\u001b[0m\n        'inviteCount' is declared here.\n","testResults":[]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172322949,"runtime":989,"slow":false,"start":1745172321960},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/menu/imageModelMenu.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["imageModelMenu"],"duration":5,"failureMessages":[],"fullName":"imageModelMenu replies with Russian text and correct keyboard","status":"passed","title":"replies with Russian text and correct keyboard"},{"ancestorTitles":["imageModelMenu"],"duration":4,"failureMessages":[],"fullName":"imageModelMenu replies with English text and correct keyboard","status":"passed","title":"replies with English text and correct keyboard"}]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/menu/menu.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/menu/menu.test.ts\u001b[0m:\u001b[93m131\u001b[0m:\u001b[93m36\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'mock' does not exist on type '(text: string | FmtString<string>, extra?: Omit<{ chat_id: string | number; message_thread_id?: number; text: string; parse_mode?: ParseMode; entities?: MessageEntity[]; ... 4 more ...; reply_markup?: ReplyKeyboardMarkup | ... 2 more ... | ForceReply; }, \"chat_id\" | \"text\">) => Promise<...>'.\n\n    \u001b[7m131\u001b[0m     const [msg, extra] = ctx.reply.mock.calls[0]\n    \u001b[7m   \u001b[0m \u001b[91m                                   ~~~~\u001b[0m\n    \u001b[96m__tests__/menu/menu.test.ts\u001b[0m:\u001b[93m141\u001b[0m:\u001b[93m36\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'mock' does not exist on type '(text: string | FmtString<string>, extra?: Omit<{ chat_id: string | number; message_thread_id?: number; text: string; parse_mode?: ParseMode; entities?: MessageEntity[]; ... 4 more ...; reply_markup?: ReplyKeyboardMarkup | ... 2 more ... | ForceReply; }, \"chat_id\" | \"text\">) => Promise<...>'.\n\n    \u001b[7m141\u001b[0m     const [msg, extra] = ctx.reply.mock.calls[0]\n    \u001b[7m   \u001b[0m \u001b[91m                                   ~~~~\u001b[0m\n    \u001b[96m__tests__/menu/menu.test.ts\u001b[0m:\u001b[93m217\u001b[0m:\u001b[93m1\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1128: \u001b[0mDeclaration or statement expected.\n\n    \u001b[7m217\u001b[0m })\n    \u001b[7m   \u001b[0m \u001b[91m~\u001b[0m\n    \u001b[96m__tests__/menu/menu.test.ts\u001b[0m:\u001b[93m217\u001b[0m:\u001b[93m2\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1128: \u001b[0mDeclaration or statement expected.\n\n    \u001b[7m217\u001b[0m })\n    \u001b[7m   \u001b[0m \u001b[91m ~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/helpers/processBalanceOperation.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/price/helpers/processBalanceOperation.test.ts\u001b[0m:\u001b[93m4\u001b[0m:\u001b[93m36\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2743: \u001b[0mNo overload expects 1 type arguments, but overloads do exist that expect either 0 or 2 type arguments.\n\n    \u001b[7m4\u001b[0m const mockGetUserBalance = jest.fn<() => Promise<number>>() // С указанием типа\n    \u001b[7m \u001b[0m \u001b[91m                                   ~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/price/helpers/processBalanceOperation.test.ts\u001b[0m:\u001b[93m5\u001b[0m:\u001b[93m39\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2743: \u001b[0mNo overload expects 1 type arguments, but overloads do exist that expect either 0 or 2 type arguments.\n\n    \u001b[7m5\u001b[0m const mockUpdateUserBalance = jest.fn<() => Promise<void>>() // С указанием типа\n    \u001b[7m \u001b[0m \u001b[91m                                      ~~~~~~~~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":7,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172323608,"runtime":996,"slow":false,"start":1745172322612},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/priceCalculator.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["calculateCost"],"duration":2,"failureMessages":[],"fullName":"calculateCost calculates correct cost details","status":"passed","title":"calculates correct cost details"},{"ancestorTitles":["formatCost"],"duration":1,"failureMessages":[],"fullName":"formatCost formats cost for Russian locale","status":"passed","title":"formats cost for Russian locale"},{"ancestorTitles":["formatCost"],"duration":0,"failureMessages":[],"fullName":"formatCost formats cost for English locale","status":"passed","title":"formats cost for English locale"},{"ancestorTitles":["generateCostMessage"],"duration":2,"failureMessages":[],"fullName":"generateCostMessage generates message with list of costs for Russian locale","status":"passed","title":"generates message with list of costs for Russian locale"},{"ancestorTitles":["generateCostMessage"],"duration":1,"failureMessages":[],"fullName":"generateCostMessage generates message with list of costs for English locale","status":"passed","title":"generates message with list of costs for English locale"},{"ancestorTitles":["stepOptions and costDetails arrays"],"duration":0,"failureMessages":[],"fullName":"stepOptions and costDetails arrays stepOptions and costDetails have same length","status":"passed","title":"stepOptions and costDetails have same length"},{"ancestorTitles":["stepOptions and costDetails arrays"],"duration":5,"failureMessages":[],"fullName":"stepOptions and costDetails arrays costDetails elements match calculateCost for corresponding steps","status":"passed","title":"costDetails elements match calculateCost for corresponding steps"}]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/refundUser.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/price/refundUser.test.ts\u001b[0m:\u001b[93m44\u001b[0m:\u001b[93m30\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Type 'String' has no call signatures.\n\n    \u001b[7m44\u001b[0m     ctx.from.language_code = 'en'\n    \u001b[7m  \u001b[0m \u001b[91m                             ~~~~\u001b[0m\n\n      \u001b[96m__tests__/price/refundUser.test.ts\u001b[0m:\u001b[93m44\u001b[0m:\u001b[93m30\u001b[0m\n        \u001b[7m44\u001b[0m     ctx.from.language_code = 'en'\n        \u001b[7m  \u001b[0m \u001b[96m                             ~~~~\u001b[0m\n        Are you missing a semicolon?\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/helpers.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/price/helpers.test.ts\u001b[0m:\u001b[93m73\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2322: \u001b[0mType 'Mock<UnknownFunction>' is not assignable to type '(text: string | FmtString<string>, extra?: Omit<{ chat_id: string | number; message_thread_id?: number; text: string; parse_mode?: ParseMode; entities?: MessageEntity[]; ... 4 more ...; reply_markup?: InlineKeyboardMarkup | ... 2 more ... | ForceReply; }, \"text\" | \"chat_id\">) => Promise<...>'.\n      Type '{}' is missing the following properties from type 'Promise<TextMessage>': then, catch, finally, [Symbol.toStringTag]\n\n    \u001b[7m73\u001b[0m     ctx.reply = jest.fn().mockResolvedValue(undefined) as jest.Mock;\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/price/helpers.test.ts\u001b[0m:\u001b[93m73\u001b[0m:\u001b[93m45\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'undefined' is not assignable to parameter of type 'never'.\n\n    \u001b[7m73\u001b[0m     ctx.reply = jest.fn().mockResolvedValue(undefined) as jest.Mock;\n    \u001b[7m  \u001b[0m \u001b[91m                                            ~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/price/helpers.test.ts\u001b[0m:\u001b[93m144\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2322: \u001b[0mType 'Mock<UnknownFunction>' is not assignable to type '(text: string | FmtString<string>, extra?: Omit<{ chat_id: string | number; message_thread_id?: number; text: string; parse_mode?: ParseMode; entities?: MessageEntity[]; ... 4 more ...; reply_markup?: InlineKeyboardMarkup | ... 2 more ... | ForceReply; }, \"text\" | \"chat_id\">) => Promise<...>'.\n      Type '{}' is missing the following properties from type 'Promise<TextMessage>': then, catch, finally, [Symbol.toStringTag]\n\n    \u001b[7m144\u001b[0m     ctx.reply = jest.fn().mockResolvedValue(undefined) as jest.Mock;\n    \u001b[7m   \u001b[0m \u001b[91m    ~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/price/helpers.test.ts\u001b[0m:\u001b[93m144\u001b[0m:\u001b[93m45\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'undefined' is not assignable to parameter of type 'never'.\n\n    \u001b[7m144\u001b[0m     ctx.reply = jest.fn().mockResolvedValue(undefined) as jest.Mock;\n    \u001b[7m   \u001b[0m \u001b[91m                                            ~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/price/helpers.test.ts\u001b[0m:\u001b[93m218\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2322: \u001b[0mType 'Mock<UnknownFunction>' is not assignable to type '(text: string | FmtString<string>, extra?: Omit<{ chat_id: string | number; message_thread_id?: number; text: string; parse_mode?: ParseMode; entities?: MessageEntity[]; ... 4 more ...; reply_markup?: InlineKeyboardMarkup | ... 2 more ... | ForceReply; }, \"text\" | \"chat_id\">) => Promise<...>'.\n      Type '{}' is missing the following properties from type 'Promise<TextMessage>': then, catch, finally, [Symbol.toStringTag]\n\n    \u001b[7m218\u001b[0m     ctx.reply = jest.fn().mockResolvedValue(undefined) as jest.Mock;\n    \u001b[7m   \u001b[0m \u001b[91m    ~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/price/helpers.test.ts\u001b[0m:\u001b[93m218\u001b[0m:\u001b[93m45\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'undefined' is not assignable to parameter of type 'never'.\n\n    \u001b[7m218\u001b[0m     ctx.reply = jest.fn().mockResolvedValue(undefined) as jest.Mock;\n    \u001b[7m   \u001b[0m \u001b[91m                                            ~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/price/processBalanceVideoOperation.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/price/processBalanceVideoOperation.test.ts\u001b[0m:\u001b[93m15\u001b[0m:\u001b[93m23\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2554: \u001b[0mExpected 3 arguments, but got 1.\n\n    \u001b[7m15\u001b[0m     const res = await processBalanceVideoOperation({\n    \u001b[7m  \u001b[0m \u001b[91m                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n\n      \u001b[96msrc/price/helpers/processBalanceVideoOperation.ts\u001b[0m:\u001b[93m19\u001b[0m:\u001b[93m3\u001b[0m\n        \u001b[7m19\u001b[0m   videoModelName: VideoModel,\n        \u001b[7m  \u001b[0m \u001b[96m  ~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n        An argument for 'videoModelName' was not provided.\n    \u001b[96m__tests__/price/processBalanceVideoOperation.test.ts\u001b[0m:\u001b[93m30\u001b[0m:\u001b[93m23\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2554: \u001b[0mExpected 3 arguments, but got 1.\n\n    \u001b[7m30\u001b[0m     const res = await processBalanceVideoOperation({\n    \u001b[7m  \u001b[0m \u001b[91m                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n\n      \u001b[96msrc/price/helpers/processBalanceVideoOperation.ts\u001b[0m:\u001b[93m19\u001b[0m:\u001b[93m3\u001b[0m\n        \u001b[7m19\u001b[0m   videoModelName: VideoModel,\n        \u001b[7m  \u001b[0m \u001b[96m  ~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n        An argument for 'videoModelName' was not provided.\n    \u001b[96m__tests__/price/processBalanceVideoOperation.test.ts\u001b[0m:\u001b[93m48\u001b[0m:\u001b[93m23\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2554: \u001b[0mExpected 3 arguments, but got 1.\n\n    \u001b[7m48\u001b[0m     const res = await processBalanceVideoOperation({\n    \u001b[7m  \u001b[0m \u001b[91m                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n\n      \u001b[96msrc/price/helpers/processBalanceVideoOperation.ts\u001b[0m:\u001b[93m19\u001b[0m:\u001b[93m3\u001b[0m\n        \u001b[7m19\u001b[0m   videoModelName: VideoModel,\n        \u001b[7m  \u001b[0m \u001b[96m  ~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n        An argument for 'videoModelName' was not provided.\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/chatWithAvatarWizard.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/scenes/chatWithAvatarWizard.test.ts\u001b[0m:\u001b[93m44\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m44\u001b[0m     await step0(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/chatWithAvatarWizard.test.ts\u001b[0m:\u001b[93m56\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m56\u001b[0m     ctx.message = undefined\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/chatWithAvatarWizard.test.ts\u001b[0m:\u001b[93m59\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m59\u001b[0m     await step1(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/chatWithAvatarWizard.test.ts\u001b[0m:\u001b[93m64\u001b[0m:\u001b[93m39\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2353: \u001b[0mObject literal may only specify known properties, and 'message' does not exist in type 'Partial<MySession>'.\n\n    \u001b[7m64\u001b[0m     const ctx = makeMockContext({}, { message: { text: 'hi' } })\n    \u001b[7m  \u001b[0m \u001b[91m                                      ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/chatWithAvatarWizard.test.ts\u001b[0m:\u001b[93m68\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m68\u001b[0m     await step1(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/chatWithAvatarWizard.test.ts\u001b[0m:\u001b[93m74\u001b[0m:\u001b[93m39\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2353: \u001b[0mObject literal may only specify known properties, and 'message' does not exist in type 'Partial<MySession>'.\n\n    \u001b[7m74\u001b[0m     const ctx = makeMockContext({}, { message: { text: 'hello' } })\n    \u001b[7m  \u001b[0m \u001b[91m                                      ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/chatWithAvatarWizard.test.ts\u001b[0m:\u001b[93m82\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m82\u001b[0m     await step1(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/chatWithAvatarWizard.test.ts\u001b[0m:\u001b[93m89\u001b[0m:\u001b[93m39\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2353: \u001b[0mObject literal may only specify known properties, and 'message' does not exist in type 'Partial<MySession>'.\n\n    \u001b[7m89\u001b[0m     const ctx = makeMockContext({}, { message: { text: 'hello' } })\n    \u001b[7m  \u001b[0m \u001b[91m                                      ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/chatWithAvatarWizard.test.ts\u001b[0m:\u001b[93m97\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m97\u001b[0m     await step1(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/chatWithAvatarWizard.test.ts\u001b[0m:\u001b[93m107\u001b[0m:\u001b[93m39\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2353: \u001b[0mObject literal may only specify known properties, and 'message' does not exist in type 'Partial<MySession>'.\n\n    \u001b[7m107\u001b[0m     const ctx = makeMockContext({}, { message: { text: 'hello' } })\n    \u001b[7m   \u001b[0m \u001b[91m                                      ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/chatWithAvatarWizard.test.ts\u001b[0m:\u001b[93m113\u001b[0m:\u001b[93m18\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m113\u001b[0m     await expect(step1(ctx)).rejects.toThrow(\n    \u001b[7m   \u001b[0m \u001b[91m                 ~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/uploadVideoScene.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/scenes/uploadVideoScene.test.ts\u001b[0m:\u001b[93m6\u001b[0m:\u001b[93m57\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2307: \u001b[0mCannot find module '../utils/mockContext' or its corresponding type declarations.\n\n    \u001b[7m6\u001b[0m import { makeMockContext, MockContextWithSession } from '../utils/mockContext'\n    \u001b[7m \u001b[0m \u001b[91m                                                        ~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/trainFluxModelWizard.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/scenes/trainFluxModelWizard.test.ts\u001b[0m:\u001b[93m6\u001b[0m:\u001b[93m57\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2307: \u001b[0mCannot find module '../utils/mockContext' or its corresponding type declarations.\n\n    \u001b[7m6\u001b[0m import { makeMockContext, MockContextWithSession } from '../utils/mockContext'\n    \u001b[7m \u001b[0m \u001b[91m                                                        ~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/balanceScene.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/scenes/balanceScene.test.ts\u001b[0m:\u001b[93m26\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m26\u001b[0m     await step(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/balanceScene.test.ts\u001b[0m:\u001b[93m48\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m48\u001b[0m     await step(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/balanceScene.test.ts\u001b[0m:\u001b[93m67\u001b[0m:\u001b[93m18\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m67\u001b[0m     await expect(step(ctx)).rejects.toThrow('fetch failed')\n    \u001b[7m  \u001b[0m \u001b[91m                 ~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/menuScene.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/scenes/menuScene.test.ts\u001b[0m:\u001b[93m36\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m36\u001b[0m     await step0(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/neuroCoderScene.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/scenes/neuroCoderScene.test.ts\u001b[0m:\u001b[93m22\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m22\u001b[0m     ctx.from = { id: 10, language_code: 'ru' }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroCoderScene.test.ts\u001b[0m:\u001b[93m23\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'chat' because it is a read-only property.\n\n    \u001b[7m23\u001b[0m     ctx.chat = { id: 20 } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroCoderScene.test.ts\u001b[0m:\u001b[93m24\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'botInfo' because it is a read-only property.\n\n    \u001b[7m24\u001b[0m     ctx.botInfo = { username: 'bot' }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroCoderScene.test.ts\u001b[0m:\u001b[93m31\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m31\u001b[0m     await step0(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroCoderScene.test.ts\u001b[0m:\u001b[93m43\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m43\u001b[0m     await step1(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroCoderScene.test.ts\u001b[0m:\u001b[93m48\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m48\u001b[0m     ctx.from = undefined as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroCoderScene.test.ts\u001b[0m:\u001b[93m49\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m49\u001b[0m     ctx.message = undefined as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroCoderScene.test.ts\u001b[0m:\u001b[93m53\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m53\u001b[0m     await step1(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroCoderScene.test.ts\u001b[0m:\u001b[93m62\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'message' because it is a read-only property.\n\n    \u001b[7m62\u001b[0m     ctx.message = { text: '3' } as any\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroCoderScene.test.ts\u001b[0m:\u001b[93m66\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m66\u001b[0m     await step1(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/getRuBillWizard.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/scenes/getRuBillWizard.test.ts\u001b[0m:\u001b[93m44\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2322: \u001b[0mType 'number' is not assignable to type 'string'.\n\n    \u001b[7m44\u001b[0m     targetUserId: 0,\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~~\u001b[0m\n\n      \u001b[96msrc/interfaces/telegram-bot.interface.ts\u001b[0m:\u001b[93m161\u001b[0m:\u001b[93m3\u001b[0m\n        \u001b[7m161\u001b[0m   targetUserId: string\n        \u001b[7m   \u001b[0m \u001b[96m  ~~~~~~~~~~~~\u001b[0m\n        The expected type comes from property 'targetUserId' which is declared here on type 'MySession'\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/textToVideoWizard.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/scenes/textToVideoWizard.test.ts\u001b[0m:\u001b[93m5\u001b[0m:\u001b[93m57\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2307: \u001b[0mCannot find module '../utils/mockContext' or its corresponding type declarations.\n\n    \u001b[7m5\u001b[0m import { makeMockContext, MockContextWithSession } from '../utils/mockContext'\n    \u001b[7m \u001b[0m \u001b[91m                                                        ~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/uploadTrainFluxModelScene.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/scenes/uploadTrainFluxModelScene.test.ts\u001b[0m:\u001b[93m4\u001b[0m:\u001b[93m31\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2307: \u001b[0mCannot find module 'telegraf/typings/manage' or its corresponding type declarations.\n\n    \u001b[7m4\u001b[0m import { UserFromGetMe } from 'telegraf/typings/manage' // Импорт для типа UserFromGetMe\n    \u001b[7m \u001b[0m \u001b[91m                              ~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/uploadTrainFluxModelScene.test.ts\u001b[0m:\u001b[93m63\u001b[0m:\u001b[93m7\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2322: \u001b[0mType 'number' is not assignable to type 'string'.\n\n    \u001b[7m63\u001b[0m       targetUserId: 5678,\n    \u001b[7m  \u001b[0m \u001b[91m      ~~~~~~~~~~~~\u001b[0m\n\n      \u001b[96msrc/interfaces/telegram-bot.interface.ts\u001b[0m:\u001b[93m161\u001b[0m:\u001b[93m3\u001b[0m\n        \u001b[7m161\u001b[0m   targetUserId: string\n        \u001b[7m   \u001b[0m \u001b[96m  ~~~~~~~~~~~~\u001b[0m\n        The expected type comes from property 'targetUserId' which is declared here on type 'MySession'\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/helpScene.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m42\u001b[0m:\u001b[93m23\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'steps' does not exist on type 'BaseScene<MyContext>'.\n\n    \u001b[7m42\u001b[0m     step0 = helpScene.steps[0]\n    \u001b[7m  \u001b[0m \u001b[91m                      ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m46\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m46\u001b[0m     ctx.from = { id: 42, language_code: 'ru' }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m47\u001b[0m:\u001b[93m21\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2322: \u001b[0mType '\"\"' is not assignable to type 'ModeEnum'.\n\n    \u001b[7m47\u001b[0m     ctx.session = { mode: '' }\n    \u001b[7m  \u001b[0m \u001b[91m                    ~~~~\u001b[0m\n\n      \u001b[96msrc/interfaces/telegram-bot.interface.ts\u001b[0m:\u001b[93m154\u001b[0m:\u001b[93m3\u001b[0m\n        \u001b[7m154\u001b[0m   mode?: ModeEnum\n        \u001b[7m   \u001b[0m \u001b[96m  ~~~~\u001b[0m\n        The expected type comes from property 'mode' which is declared here on type 'MySession'\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m54\u001b[0m:\u001b[93m16\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'ru' does not exist on type '({ isRu, inviteCount, subscription, level, ctx, }: { isRu: boolean; inviteCount: number; subscription: SubscriptionType; level: number; ctx: MyContext; }) => Promise<Markup<ReplyKeyboardMarkup>>'.\n\n    \u001b[7m54\u001b[0m       mainMenu.ru.text,\n    \u001b[7m  \u001b[0m \u001b[91m               ~~\u001b[0m\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m55\u001b[0m:\u001b[93m16\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'ru' does not exist on type '({ isRu, inviteCount, subscription, level, ctx, }: { isRu: boolean; inviteCount: number; subscription: SubscriptionType; level: number; ctx: MyContext; }) => Promise<Markup<ReplyKeyboardMarkup>>'.\n\n    \u001b[7m55\u001b[0m       mainMenu.ru.keyboard\n    \u001b[7m  \u001b[0m \u001b[91m               ~~\u001b[0m\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m60\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m60\u001b[0m     ctx.from = { id: 43, language_code: 'en' }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m61\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2739: \u001b[0mType '{ mode: ModeEnum.DigitalAvatarBodyV2; }' is missing the following properties from type 'MySession': cursor, images, targetUserId, userModel\n\n    \u001b[7m61\u001b[0m     ctx.session = { mode: ModeEnum.DigitalAvatarBodyV2 } // Используем ModeEnum\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m68\u001b[0m:\u001b[93m16\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'en' does not exist on type '({ isRu, inviteCount, subscription, level, ctx, }: { isRu: boolean; inviteCount: number; subscription: SubscriptionType; level: number; ctx: MyContext; }) => Promise<Markup<ReplyKeyboardMarkup>>'.\n\n    \u001b[7m68\u001b[0m       mainMenu.en.text,\n    \u001b[7m  \u001b[0m \u001b[91m               ~~\u001b[0m\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m69\u001b[0m:\u001b[93m16\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'en' does not exist on type '({ isRu, inviteCount, subscription, level, ctx, }: { isRu: boolean; inviteCount: number; subscription: SubscriptionType; level: number; ctx: MyContext; }) => Promise<Markup<ReplyKeyboardMarkup>>'.\n\n    \u001b[7m69\u001b[0m       mainMenu.en.keyboard\n    \u001b[7m  \u001b[0m \u001b[91m               ~~\u001b[0m\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m74\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m74\u001b[0m     ctx.from = { id: 44, language_code: 'en' }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m75\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2739: \u001b[0mType '{ mode: ModeEnum.Help; }' is missing the following properties from type 'MySession': cursor, images, targetUserId, userModel\n\n    \u001b[7m75\u001b[0m     ctx.session = { mode: ModeEnum.Help } // Используем ModeEnum\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m78\u001b[0m:\u001b[93m53\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'Error' is not assignable to parameter of type 'never'.\n\n    \u001b[7m78\u001b[0m     ;(ctx.reply as jest.Mock).mockRejectedValueOnce(error)\n    \u001b[7m  \u001b[0m \u001b[91m                                                    ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m87\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'from' because it is a read-only property.\n\n    \u001b[7m87\u001b[0m     ctx.from = { id: 45, language_code: 'ru' }\n    \u001b[7m  \u001b[0m \u001b[91m        ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m88\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2739: \u001b[0mType '{ mode: ModeEnum.DigitalAvatarBodyV2; }' is missing the following properties from type 'MySession': cursor, images, targetUserId, userModel\n\n    \u001b[7m88\u001b[0m     ctx.session = { mode: ModeEnum.DigitalAvatarBodyV2 } // Используем ModeEnum\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m95\u001b[0m:\u001b[93m16\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'ru' does not exist on type '({ isRu, inviteCount, subscription, level, ctx, }: { isRu: boolean; inviteCount: number; subscription: SubscriptionType; level: number; ctx: MyContext; }) => Promise<Markup<ReplyKeyboardMarkup>>'.\n\n    \u001b[7m95\u001b[0m       mainMenu.ru.text,\n    \u001b[7m  \u001b[0m \u001b[91m               ~~\u001b[0m\n    \u001b[96m__tests__/scenes/helpScene.test.ts\u001b[0m:\u001b[93m96\u001b[0m:\u001b[93m16\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'ru' does not exist on type '({ isRu, inviteCount, subscription, level, ctx, }: { isRu: boolean; inviteCount: number; subscription: SubscriptionType; level: number; ctx: MyContext; }) => Promise<Markup<ReplyKeyboardMarkup>>'.\n\n    \u001b[7m96\u001b[0m       mainMenu.ru.keyboard\n    \u001b[7m  \u001b[0m \u001b[91m               ~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/checkBalanceScene.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/scenes/checkBalanceScene.test.ts\u001b[0m:\u001b[93m29\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2739: \u001b[0mType '{ mode: any; }' is missing the following properties from type 'MySession': cursor, images, targetUserId, userModel\n\n    \u001b[7m29\u001b[0m     ctx.session = { mode: ModeEnum.NeuroPhoto }\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/checkBalanceScene.test.ts\u001b[0m:\u001b[93m29\u001b[0m:\u001b[93m27\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2304: \u001b[0mCannot find name 'ModeEnum'.\n\n    \u001b[7m29\u001b[0m     ctx.session = { mode: ModeEnum.NeuroPhoto }\n    \u001b[7m  \u001b[0m \u001b[91m                          ~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/checkBalanceScene.test.ts\u001b[0m:\u001b[93m34\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2304: \u001b[0mCannot find name 'checkBalanceSceneEnterHandler'.\n\n    \u001b[7m34\u001b[0m     await checkBalanceSceneEnterHandler(ctx as any)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/checkBalanceScene.test.ts\u001b[0m:\u001b[93m41\u001b[0m:\u001b[93m50\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2304: \u001b[0mCannot find name 'ModeEnum'.\n\n    \u001b[7m41\u001b[0m     expect(ctx.scene.enter).toHaveBeenCalledWith(ModeEnum.NeuroPhoto)\n    \u001b[7m  \u001b[0m \u001b[91m                                                 ~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/checkBalanceScene.test.ts\u001b[0m:\u001b[93m46\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2304: \u001b[0mCannot find name 'checkBalanceSceneEnterHandler'.\n\n    \u001b[7m46\u001b[0m     await checkBalanceSceneEnterHandler(ctx as any)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/checkBalanceScene.test.ts\u001b[0m:\u001b[93m56\u001b[0m:\u001b[93m17\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Type 'Error' has no call signatures.\n\n    \u001b[7m56\u001b[0m     const err = new Error('DB error')(\n    \u001b[7m  \u001b[0m \u001b[91m                ~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/checkBalanceScene.test.ts\u001b[0m:\u001b[93m58\u001b[0m:\u001b[93m25\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2448: \u001b[0mBlock-scoped variable 'err' used before its declaration.\n\n    \u001b[7m58\u001b[0m     ).mockRejectedValue(err)\n    \u001b[7m  \u001b[0m \u001b[91m                        ~~~\u001b[0m\n\n      \u001b[96m__tests__/scenes/checkBalanceScene.test.ts\u001b[0m:\u001b[93m56\u001b[0m:\u001b[93m11\u001b[0m\n        \u001b[7m56\u001b[0m     const err = new Error('DB error')(\n        \u001b[7m  \u001b[0m \u001b[96m          ~~~\u001b[0m\n        'err' is declared here.\n    \u001b[96m__tests__/scenes/checkBalanceScene.test.ts\u001b[0m:\u001b[93m59\u001b[0m:\u001b[93m18\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2304: \u001b[0mCannot find name 'checkBalanceSceneEnterHandler'.\n\n    \u001b[7m59\u001b[0m     await expect(checkBalanceSceneEnterHandler(ctx as any)).rejects.toThrow(\n    \u001b[7m  \u001b[0m \u001b[91m                 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/imageToVideoWizard.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/scenes/imageToVideoWizard.test.ts\u001b[0m:\u001b[93m6\u001b[0m:\u001b[93m40\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2305: \u001b[0mModule '\"@/price/helpers/processBalanceVideoOperation\"' has no exported member 'ProcessBalanceResult'.\n\n    \u001b[7m6\u001b[0m import { processBalanceVideoOperation, ProcessBalanceResult } from '@/price/helpers/processBalanceVideoOperation'\n    \u001b[7m \u001b[0m \u001b[91m                                       ~~~~~~~~~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":12,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172328951,"runtime":5192,"slow":true,"start":1745172323759},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/lipSyncWizard.test.ts","failureMessage":"  ● lipSyncWizard › should ask for audio file on entry\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    - Expected\n    + Received\n\n    - \"Пожалуйста, пришлите аудиофайл (MP3, WAV).\",\n    + \"Send a video or video URL\",\n      {\"reply_markup\": {\"remove_keyboard\": true}},\n\n    Number of calls: 1\n\n      104 |     ctx = createMockContextWithScene(update)\n      105 |     await step0(ctx, mockNext)\n    > 106 |     expect(ctx.reply).toHaveBeenCalledWith('Пожалуйста, пришлите аудиофайл (MP3, WAV).', {\n          |                       ^\n      107 |       reply_markup: { remove_keyboard: true }\n      108 |     })\n      109 |     expect(ctx.wizard.next).toHaveBeenCalled()\n\n      at __tests__/scenes/lipSyncWizard.test.ts:106:23\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● lipSyncWizard › should ask for video file after receiving audio\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"audio_file_id\"\n    Received: undefined\n\n      117 |     ctx = createMockContextWithScene(update, mockSession)\n      118 |     await step1(ctx, mockNext)\n    > 119 |     expect((ctx.session.__scenes.state as LipSyncWizardState).audioUrl).toBe('audio_file_id')\n          |                                                                         ^\n      120 |     expect(ctx.reply).toHaveBeenCalledWith('Отлично! Теперь пришлите видеофайл (MP4).')\n      121 |     expect(ctx.wizard.next).toHaveBeenCalled()\n      122 |   })\n\n      at __tests__/scenes/lipSyncWizard.test.ts:119:73\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● lipSyncWizard › should handle missing audio file gracefully\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"Пожалуйста, пришлите аудиофайл.\"\n    Received: \"Send an audio, voice message, or audio URL\"\n\n    Number of calls: 1\n\n      126 |     ctx = createMockContextWithScene(update, { __scenes: { state: { step: 1 }, cursor: 1 } })\n      127 |     await step1(ctx, mockNext)\n    > 128 |     expect(ctx.reply).toHaveBeenCalledWith('Пожалуйста, пришлите аудиофайл.')\n          |                       ^\n      129 |     expect(ctx.wizard.next).not.toHaveBeenCalled()\n      130 |   })\n      131 |\n\n      at __tests__/scenes/lipSyncWizard.test.ts:128:23\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● lipSyncWizard › should process audio and video and leave scene\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"video_file_id\"\n    Received: undefined\n\n      138 |     mockedGenerateLipSync.mockResolvedValueOnce(undefined)\n      139 |     await step2(ctx, mockNext)\n    > 140 |     expect((ctx.session.__scenes.state as LipSyncWizardState).videoUrl).toBe('video_file_id')\n          |                                                                         ^\n      141 |     expect(ctx.reply).toHaveBeenCalledWith('Начинаю обработку... Это может занять некоторое время.')\n      142 |     expect(ctx.scene.leave).toHaveBeenCalled()\n      143 |   })\n\n      at __tests__/scenes/lipSyncWizard.test.ts:140:73\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● lipSyncWizard › should handle missing video file gracefully\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"Пожалуйста, пришлите видеофайл.\"\n    Received: \"🎥 Video sent for processing. Wait for the result\"\n\n    Number of calls: 1\n\n      150 |     ctx = createMockContextWithScene(update, mockSession)\n      151 |     await step2(ctx, mockNext)\n    > 152 |     expect(ctx.reply).toHaveBeenCalledWith('Пожалуйста, пришлите видеофайл.')\n          |                       ^\n      153 |     expect(ctx.scene.leave).not.toHaveBeenCalled()\n      154 |   })\n      155 |\n\n      at __tests__/scenes/lipSyncWizard.test.ts:152:23\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● lipSyncWizard › should handle /cancel command in step 0\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"Действие отменено.\"\n    Received: \"Send a video or video URL\", {\"reply_markup\": {\"remove_keyboard\": true}}\n\n    Number of calls: 1\n\n      158 |     ctx = createMockContextWithScene(update)\n      159 |     await step0(ctx, mockNext)\n    > 160 |     expect(ctx.reply).toHaveBeenCalledWith('Действие отменено.')\n          |                       ^\n      161 |     expect(ctx.scene.leave).toHaveBeenCalled()\n      162 |   })\n      163 |\n\n      at __tests__/scenes/lipSyncWizard.test.ts:160:23\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● lipSyncWizard › should handle /cancel command in step 1\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"Действие отменено.\"\n    Received: \"Send an audio, voice message, or audio URL\"\n\n    Number of calls: 1\n\n      169 |     ctx = createMockContextWithScene(update, mockSession)\n      170 |     await step1(ctx, mockNext)\n    > 171 |     expect(ctx.reply).toHaveBeenCalledWith('Действие отменено.')\n          |                       ^\n      172 |     expect(ctx.scene.leave).toHaveBeenCalled()\n      173 |   })\n      174 |\n\n      at __tests__/scenes/lipSyncWizard.test.ts:171:23\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● lipSyncWizard › should handle /help command in step 0\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"Пришлите аудио, затем видео для синхронизации губ.\", Any<Object>\n    Received: \"Send a video or video URL\", {\"reply_markup\": {\"remove_keyboard\": true}}\n\n    Number of calls: 1\n\n      178 |     ;(createHelpCancelKeyboard as jest.Mock).mockReturnValue({ reply_markup: { inline_keyboard: [[{ text: 'Help', callback_data: 'help' }]] } });\n      179 |     await step0(ctx, mockNext)\n    > 180 |     expect(ctx.reply).toHaveBeenCalledWith('Пришлите аудио, затем видео для синхронизации губ.', expect.any(Object))\n          |                       ^\n      181 |     expect(ctx.scene.leave).not.toHaveBeenCalled()\n      182 |   })\n      183 |\n\n      at __tests__/scenes/lipSyncWizard.test.ts:180:23\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● lipSyncWizard › should handle /help command in step 1\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"Пришлите аудио, затем видео для синхронизации губ.\", Any<Object>\n    Received: \"Send an audio, voice message, or audio URL\"\n\n    Number of calls: 1\n\n      190 |     ;(createHelpCancelKeyboard as jest.Mock).mockReturnValue({ reply_markup: { inline_keyboard: [[{ text: 'Help', callback_data: 'help' }]] } });\n      191 |     await step1(ctx, mockNext)\n    > 192 |     expect(ctx.reply).toHaveBeenCalledWith('Пришлите аудио, затем видео для синхронизации губ.', expect.any(Object))\n          |                       ^\n      193 |     expect(ctx.scene.leave).not.toHaveBeenCalled()\n      194 |   })\n      195 |\n\n      at __tests__/scenes/lipSyncWizard.test.ts:192:23\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● lipSyncWizard › should handle unsupported audio format (document)\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"Пожалуйста, пришлите аудиофайл (MP3, WAV).\"\n    Received: \"Error: video not provided\"\n\n    Number of calls: 1\n\n      198 |     ctx = createMockContextWithScene(update, { __scenes: { state: { step: 1 }, cursor: 1 } })\n      199 |     await step1(ctx, mockNext)\n    > 200 |     expect(ctx.reply).toHaveBeenCalledWith('Пожалуйста, пришлите аудиофайл (MP3, WAV).')\n          |                       ^\n      201 |     expect(ctx.wizard.next).not.toHaveBeenCalled()\n      202 |   })\n      203 |\n\n      at __tests__/scenes/lipSyncWizard.test.ts:200:23\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● lipSyncWizard › should handle unsupported video format (document)\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"Пожалуйста, пришлите видеофайл (MP4).\"\n    Received: \"Error: audio not provided\"\n\n    Number of calls: 1\n\n      209 |      ctx = createMockContextWithScene(update, mockSession)\n      210 |      await step2(ctx, mockNext)\n    > 211 |      expect(ctx.reply).toHaveBeenCalledWith('Пожалуйста, пришлите видеофайл (MP4).')\n          |                        ^\n      212 |      expect(ctx.scene.leave).not.toHaveBeenCalled()\n      213 |    })\n      214 |\n\n      at __tests__/scenes/lipSyncWizard.test.ts:211:24\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n\n  ● lipSyncWizard › should handle error during processing step (step 2)\n\n    expect(jest.fn()).toHaveBeenCalled()\n\n    Expected number of calls: >= 1\n    Received number of calls:    0\n\n      225 |         await step2(ctx, mockNext);\n      226 |\n    > 227 |         expect(mockedGenerateLipSync).toHaveBeenCalled();\n          |                                       ^\n      228 |\n      229 |         expect(ctx.reply).toHaveBeenCalledWith(expect.stringContaining('Ошибка обработки'));\n      230 |         expect(ctx.scene.leave).toHaveBeenCalled();\n\n      at __tests__/scenes/lipSyncWizard.test.ts:227:39\n      at fulfilled (node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n","testResults":[{"ancestorTitles":["lipSyncWizard"],"duration":6,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n- Expected\n+ Received\n\n- \"Пожалуйста, пришлите аудиофайл (MP3, WAV).\",\n+ \"Send a video or video URL\",\n  {\"reply_markup\": {\"remove_keyboard\": true}},\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/lipSyncWizard.test.ts:106:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"lipSyncWizard should ask for audio file on entry","status":"failed","title":"should ask for audio file on entry"},{"ancestorTitles":["lipSyncWizard"],"duration":18,"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: \"audio_file_id\"\nReceived: undefined\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/lipSyncWizard.test.ts:119:73\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"lipSyncWizard should ask for video file after receiving audio","status":"failed","title":"should ask for video file after receiving audio"},{"ancestorTitles":["lipSyncWizard"],"duration":4,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"Пожалуйста, пришлите аудиофайл.\"\nReceived: \"Send an audio, voice message, or audio URL\"\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/lipSyncWizard.test.ts:128:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"lipSyncWizard should handle missing audio file gracefully","status":"failed","title":"should handle missing audio file gracefully"},{"ancestorTitles":["lipSyncWizard"],"duration":3,"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: \"video_file_id\"\nReceived: undefined\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/lipSyncWizard.test.ts:140:73\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"lipSyncWizard should process audio and video and leave scene","status":"failed","title":"should process audio and video and leave scene"},{"ancestorTitles":["lipSyncWizard"],"duration":3,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"Пожалуйста, пришлите видеофайл.\"\nReceived: \"🎥 Video sent for processing. Wait for the result\"\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/lipSyncWizard.test.ts:152:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"lipSyncWizard should handle missing video file gracefully","status":"failed","title":"should handle missing video file gracefully"},{"ancestorTitles":["lipSyncWizard"],"duration":2,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"Действие отменено.\"\nReceived: \"Send a video or video URL\", {\"reply_markup\": {\"remove_keyboard\": true}}\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/lipSyncWizard.test.ts:160:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"lipSyncWizard should handle /cancel command in step 0","status":"failed","title":"should handle /cancel command in step 0"},{"ancestorTitles":["lipSyncWizard"],"duration":5,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"Действие отменено.\"\nReceived: \"Send an audio, voice message, or audio URL\"\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/lipSyncWizard.test.ts:171:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"lipSyncWizard should handle /cancel command in step 1","status":"failed","title":"should handle /cancel command in step 1"},{"ancestorTitles":["lipSyncWizard"],"duration":1,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"Пришлите аудио, затем видео для синхронизации губ.\", Any<Object>\nReceived: \"Send a video or video URL\", {\"reply_markup\": {\"remove_keyboard\": true}}\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/lipSyncWizard.test.ts:180:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"lipSyncWizard should handle /help command in step 0","status":"failed","title":"should handle /help command in step 0"},{"ancestorTitles":["lipSyncWizard"],"duration":3,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"Пришлите аудио, затем видео для синхронизации губ.\", Any<Object>\nReceived: \"Send an audio, voice message, or audio URL\"\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/lipSyncWizard.test.ts:192:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"lipSyncWizard should handle /help command in step 1","status":"failed","title":"should handle /help command in step 1"},{"ancestorTitles":["lipSyncWizard"],"duration":9,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"Пожалуйста, пришлите аудиофайл (MP3, WAV).\"\nReceived: \"Error: video not provided\"\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/lipSyncWizard.test.ts:200:23\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"lipSyncWizard should handle unsupported audio format (document)","status":"failed","title":"should handle unsupported audio format (document)"},{"ancestorTitles":["lipSyncWizard"],"duration":2,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"Пожалуйста, пришлите видеофайл (MP4).\"\nReceived: \"Error: audio not provided\"\n\nNumber of calls: 1\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/lipSyncWizard.test.ts:211:24\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"lipSyncWizard should handle unsupported video format (document)","status":"failed","title":"should handle unsupported video format (document)"},{"ancestorTitles":["lipSyncWizard"],"duration":151,"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalled()\n\nExpected number of calls: >= 1\nReceived number of calls:    0\n    at /Users/playom/999-multibots-telegraf/__tests__/scenes/lipSyncWizard.test.ts:227:39\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/playom/999-multibots-telegraf/node_modules/.pnpm/tslib@2.8.1/node_modules/tslib/tslib.js:167:62)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"lipSyncWizard should handle error during processing step (step 2)","status":"failed","title":"should handle error during processing step (step 2)"}]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/neuroPhotoWizard.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/scenes/neuroPhotoWizard.test.ts\u001b[0m:\u001b[93m33\u001b[0m:\u001b[93m24\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2352: \u001b[0mConversion of type '({ isRu, inviteCount, subscription, level, ctx, }: { isRu: boolean; inviteCount: number; subscription: SubscriptionType; level: number; ctx: MyContext; }) => Promise<Markup<ReplyKeyboardMarkup>>' to type 'Mock<() => Promise<{ text: string; keyboard: Markup<any>; }>>' may be a mistake because neither type sufficiently overlaps with the other. If this was intentional, convert the expression to 'unknown' first.\n      Type '({ isRu, inviteCount, subscription, level, ctx, }: { isRu: boolean; inviteCount: number; subscription: SubscriptionType; level: number; ctx: MyContext; }) => Promise<Markup<ReplyKeyboardMarkup>>' is missing the following properties from type 'Mock<() => Promise<{ text: string; keyboard: Markup<any>; }>>': _isMockFunction, _protoImpl, getMockImplementation, getMockName, and 15 more.\n\n    \u001b[7m33\u001b[0m const mockedMainMenu = mainMenu as jest.Mock<() => Promise<{text: string, keyboard: Markup.Markup<any>}>> // Типизируем mainMenu\n    \u001b[7m  \u001b[0m \u001b[91m                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroPhotoWizard.test.ts\u001b[0m:\u001b[93m43\u001b[0m:\u001b[93m54\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2739: \u001b[0mType 'ReplyKeyboardMarkup' is missing the following properties from type 'Markup<any>': reply_markup, placeholder, resize, oneTime, persistent\n\n    \u001b[7m43\u001b[0m     mockedMainMenu.mockResolvedValue({ text: 'Menu', keyboard: Markup.keyboard([['Btn']]).reply_markup })\n    \u001b[7m  \u001b[0m \u001b[91m                                                     ~~~~~~~~\u001b[0m\n\n      \u001b[96m__tests__/scenes/neuroPhotoWizard.test.ts\u001b[0m:\u001b[93m33\u001b[0m:\u001b[93m75\u001b[0m\n        \u001b[7m33\u001b[0m const mockedMainMenu = mainMenu as jest.Mock<() => Promise<{text: string, keyboard: Markup.Markup<any>}>> // Типизируем mainMenu\n        \u001b[7m  \u001b[0m \u001b[96m                                                                          ~~~~~~~~\u001b[0m\n        The expected type comes from property 'keyboard' which is declared here on type '{ text: string; keyboard: Markup<any>; }'\n    \u001b[96m__tests__/scenes/neuroPhotoWizard.test.ts\u001b[0m:\u001b[93m50\u001b[0m:\u001b[93m48\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'null' is not assignable to parameter of type 'never'.\n\n    \u001b[7m50\u001b[0m     mockedGetLatestModel.mockResolvedValueOnce(null)\n    \u001b[7m  \u001b[0m \u001b[91m                                               ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroPhotoWizard.test.ts\u001b[0m:\u001b[93m51\u001b[0m:\u001b[93m45\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '{ count: number; subscription: string; level: number; }' is not assignable to parameter of type 'never'.\n\n    \u001b[7m 51\u001b[0m     mockedGetReferals.mockResolvedValueOnce({\n    \u001b[7m   \u001b[0m \u001b[91m                                            ~\u001b[0m\n    \u001b[7m 52\u001b[0m       count: 0,\n    \u001b[7m   \u001b[0m \u001b[91m~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[7m...\u001b[0m \n    \u001b[7m 54\u001b[0m       level: 1,\n    \u001b[7m   \u001b[0m \u001b[91m~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[7m 55\u001b[0m     })\n    \u001b[7m   \u001b[0m \u001b[91m~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroPhotoWizard.test.ts\u001b[0m:\u001b[93m59\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m59\u001b[0m     await step(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroPhotoWizard.test.ts\u001b[0m:\u001b[93m67\u001b[0m:\u001b[93m48\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '{ model_url: string; trigger_word: string; }' is not assignable to parameter of type 'never'.\n\n    \u001b[7m67\u001b[0m     mockedGetLatestModel.mockResolvedValueOnce({\n    \u001b[7m  \u001b[0m \u001b[91m                                               ~\u001b[0m\n    \u001b[7m68\u001b[0m       model_url: 'url1',\n    \u001b[7m  \u001b[0m \u001b[91m~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[7m69\u001b[0m       trigger_word: 'tw',\n    \u001b[7m  \u001b[0m \u001b[91m~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[7m70\u001b[0m     })\n    \u001b[7m  \u001b[0m \u001b[91m~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroPhotoWizard.test.ts\u001b[0m:\u001b[93m71\u001b[0m:\u001b[93m45\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '{ count: number; subscription: string; level: number; }' is not assignable to parameter of type 'never'.\n\n    \u001b[7m 71\u001b[0m     mockedGetReferals.mockResolvedValueOnce({\n    \u001b[7m   \u001b[0m \u001b[91m                                            ~\u001b[0m\n    \u001b[7m 72\u001b[0m       count: 5,\n    \u001b[7m   \u001b[0m \u001b[91m~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[7m...\u001b[0m \n    \u001b[7m 74\u001b[0m       level: 2,\n    \u001b[7m   \u001b[0m \u001b[91m~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[7m 75\u001b[0m     })\n    \u001b[7m   \u001b[0m \u001b[91m~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroPhotoWizard.test.ts\u001b[0m:\u001b[93m79\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m79\u001b[0m     await step(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroPhotoWizard.test.ts\u001b[0m:\u001b[93m87\u001b[0m:\u001b[93m48\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '{ model_url: string; trigger_word: string; }' is not assignable to parameter of type 'never'.\n\n    \u001b[7m87\u001b[0m     mockedGetLatestModel.mockResolvedValueOnce({\n    \u001b[7m  \u001b[0m \u001b[91m                                               ~\u001b[0m\n    \u001b[7m88\u001b[0m       model_url: 'url2',\n    \u001b[7m  \u001b[0m \u001b[91m~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[7m89\u001b[0m       trigger_word: 'x',\n    \u001b[7m  \u001b[0m \u001b[91m~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[7m90\u001b[0m     })\n    \u001b[7m  \u001b[0m \u001b[91m~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroPhotoWizard.test.ts\u001b[0m:\u001b[93m91\u001b[0m:\u001b[93m45\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '{ count: number; subscription: string; level: number; }' is not assignable to parameter of type 'never'.\n\n    \u001b[7m 91\u001b[0m     mockedGetReferals.mockResolvedValueOnce({\n    \u001b[7m   \u001b[0m \u001b[91m                                            ~\u001b[0m\n    \u001b[7m 92\u001b[0m       count: 1,\n    \u001b[7m   \u001b[0m \u001b[91m~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[7m...\u001b[0m \n    \u001b[7m 94\u001b[0m       level: 1,\n    \u001b[7m   \u001b[0m \u001b[91m~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[7m 95\u001b[0m     })\n    \u001b[7m   \u001b[0m \u001b[91m~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroPhotoWizard.test.ts\u001b[0m:\u001b[93m99\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m99\u001b[0m     await step(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroPhotoWizard.test.ts\u001b[0m:\u001b[93m109\u001b[0m:\u001b[93m9\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2353: \u001b[0mObject literal may only specify known properties, and 'session' does not exist in type 'Partial<MySession>'.\n\n    \u001b[7m109\u001b[0m       { session: { userModel }, message: { text: 'hello' } }\n    \u001b[7m   \u001b[0m \u001b[91m        ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroPhotoWizard.test.ts\u001b[0m:\u001b[93m114\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m114\u001b[0m     await step(ctx)\n    \u001b[7m   \u001b[0m \u001b[91m          ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/neuroPhotoWizard.test.ts\u001b[0m:\u001b[93m126\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m126\u001b[0m     await step(ctx)\n    \u001b[7m   \u001b[0m \u001b[91m          ~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/selectModelWizard.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/scenes/selectModelWizard.test.ts\u001b[0m:\u001b[93m59\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2322: \u001b[0mType 'number' is not assignable to type 'string'.\n\n    \u001b[7m59\u001b[0m     targetUserId: 0,\n    \u001b[7m  \u001b[0m \u001b[91m    ~~~~~~~~~~~~\u001b[0m\n\n      \u001b[96msrc/interfaces/telegram-bot.interface.ts\u001b[0m:\u001b[93m161\u001b[0m:\u001b[93m3\u001b[0m\n        \u001b[7m161\u001b[0m   targetUserId: string\n        \u001b[7m   \u001b[0m \u001b[96m  ~~~~~~~~~~~~\u001b[0m\n        The expected type comes from property 'targetUserId' which is declared here on type 'MySession'\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/emailWizard.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/scenes/emailWizard.test.ts\u001b[0m:\u001b[93m20\u001b[0m:\u001b[93m29\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2352: \u001b[0mConversion of type '(telegram_id: string, email: string) => Promise<void>' to type 'Mock<(userId: string, email: string) => Promise<void>, any, any>' may be a mistake because neither type sufficiently overlaps with the other. If this was intentional, convert the expression to 'unknown' first.\n      Type '(telegram_id: string, email: string) => Promise<void>' is missing the following properties from type 'Mock<(userId: string, email: string) => Promise<void>, any, any>': getMockName, mock, mockClear, mockReset, and 13 more.\n\n    \u001b[7m20\u001b[0m const mockedSaveUserEmail = saveUserEmail as jest.Mock< (userId: string, email: string) => Promise<void> >\n    \u001b[7m  \u001b[0m \u001b[91m                            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/emailWizard.test.ts\u001b[0m:\u001b[93m21\u001b[0m:\u001b[93m25\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2352: \u001b[0mConversion of type '(ctx: Context) => boolean' to type 'Mock<() => boolean, any, any>' may be a mistake because neither type sufficiently overlaps with the other. If this was intentional, convert the expression to 'unknown' first.\n      Type '(ctx: Context<Update>) => boolean' is missing the following properties from type 'Mock<() => boolean, any, any>': getMockName, mock, mockClear, mockReset, and 13 more.\n\n    \u001b[7m21\u001b[0m const mockedIsRussian = isRussian as jest.Mock<() => boolean>\n    \u001b[7m  \u001b[0m \u001b[91m                        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/emailWizard.test.ts\u001b[0m:\u001b[93m22\u001b[0m:\u001b[93m28\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2352: \u001b[0mConversion of type '(ctx: MyContext) => Promise<boolean>' to type 'Mock<(...args: any[]) => Promise<boolean>, any, any>' may be a mistake because neither type sufficiently overlaps with the other. If this was intentional, convert the expression to 'unknown' first.\n      Type '(ctx: MyContext) => Promise<boolean>' is missing the following properties from type 'Mock<(...args: any[]) => Promise<boolean>, any, any>': getMockName, mock, mockClear, mockReset, and 13 more.\n\n    \u001b[7m22\u001b[0m const mockedHandleCancel = handleHelpCancel as jest.Mock<(...args: any[]) => Promise<boolean>>\n    \u001b[7m  \u001b[0m \u001b[91m                           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/emailWizard.test.ts\u001b[0m:\u001b[93m30\u001b[0m:\u001b[93m41\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'boolean' is not assignable to parameter of type '() => boolean'.\n\n    \u001b[7m30\u001b[0m     mockedIsRussian.mockReturnValueOnce(true)\n    \u001b[7m  \u001b[0m \u001b[91m                                        ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/emailWizard.test.ts\u001b[0m:\u001b[93m32\u001b[0m:\u001b[93m23\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2554: \u001b[0mExpected 2 arguments, but got 1.\n\n    \u001b[7m32\u001b[0m     await emailWizard.enterHandler(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m                      ~~~~~~~~~~~~\u001b[0m\n\n      \u001b[96mnode_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/typings/middleware.d.ts\u001b[0m:\u001b[93m3\u001b[0m:\u001b[93m86\u001b[0m\n        \u001b[7m3\u001b[0m export type MiddlewareFn<C extends Context<U>, U extends Update = Update> = (ctx: C, next: () => Promise<void>) => Promise<unknown> | void;\n        \u001b[7m \u001b[0m \u001b[96m                                                                                     ~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n        An argument for 'next' was not provided.\n    \u001b[96m__tests__/scenes/emailWizard.test.ts\u001b[0m:\u001b[93m44\u001b[0m:\u001b[93m41\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'boolean' is not assignable to parameter of type '() => boolean'.\n\n    \u001b[7m44\u001b[0m     mockedIsRussian.mockReturnValueOnce(false)\n    \u001b[7m  \u001b[0m \u001b[91m                                        ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/emailWizard.test.ts\u001b[0m:\u001b[93m46\u001b[0m:\u001b[93m23\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2554: \u001b[0mExpected 2 arguments, but got 1.\n\n    \u001b[7m46\u001b[0m     await emailWizard.enterHandler(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m                      ~~~~~~~~~~~~\u001b[0m\n\n      \u001b[96mnode_modules/.pnpm/telegraf@4.16.3_encoding@0.1.13/node_modules/telegraf/typings/middleware.d.ts\u001b[0m:\u001b[93m3\u001b[0m:\u001b[93m86\u001b[0m\n        \u001b[7m3\u001b[0m export type MiddlewareFn<C extends Context<U>, U extends Update = Update> = (ctx: C, next: () => Promise<void>) => Promise<unknown> | void;\n        \u001b[7m \u001b[0m \u001b[96m                                                                                     ~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n        An argument for 'next' was not provided.\n    \u001b[96m__tests__/scenes/emailWizard.test.ts\u001b[0m:\u001b[93m64\u001b[0m:\u001b[93m41\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'boolean' is not assignable to parameter of type '() => boolean'.\n\n    \u001b[7m64\u001b[0m     mockedIsRussian.mockReturnValueOnce(true)\n    \u001b[7m  \u001b[0m \u001b[91m                                        ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/emailWizard.test.ts\u001b[0m:\u001b[93m65\u001b[0m:\u001b[93m46\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'false' is not assignable to parameter of type 'never'.\n\n    \u001b[7m65\u001b[0m     mockedHandleCancel.mockResolvedValueOnce(false)\n    \u001b[7m  \u001b[0m \u001b[91m                                             ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/emailWizard.test.ts\u001b[0m:\u001b[93m66\u001b[0m:\u001b[93m47\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'undefined' is not assignable to parameter of type 'never'.\n\n    \u001b[7m66\u001b[0m     mockedSaveUserEmail.mockResolvedValueOnce(undefined)\n    \u001b[7m  \u001b[0m \u001b[91m                                              ~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/emailWizard.test.ts\u001b[0m:\u001b[93m70\u001b[0m:\u001b[93m23\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'emailHandler' does not exist on type 'BaseScene<MyContext>'.\n\n    \u001b[7m70\u001b[0m     await emailWizard.emailHandler(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m                      ~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/emailWizard.test.ts\u001b[0m:\u001b[93m90\u001b[0m:\u001b[93m41\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'boolean' is not assignable to parameter of type '() => boolean'.\n\n    \u001b[7m90\u001b[0m     mockedIsRussian.mockReturnValueOnce(false)\n    \u001b[7m  \u001b[0m \u001b[91m                                        ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/emailWizard.test.ts\u001b[0m:\u001b[93m96\u001b[0m:\u001b[93m23\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'emailHandler' does not exist on type 'BaseScene<MyContext>'.\n\n    \u001b[7m96\u001b[0m     await emailWizard.emailHandler(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m                      ~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/levelQuestWizard.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/scenes/levelQuestWizard.test.ts\u001b[0m:\u001b[93m42\u001b[0m:\u001b[93m15\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'match' does not exist on type 'MyContext & DebugExtension'.\n\n    \u001b[7m42\u001b[0m     await ctx.match('➡️ Далее шаг 1')\n    \u001b[7m  \u001b[0m \u001b[91m              ~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":10,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172330627,"runtime":40544,"slow":true,"start":1745172290083},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/handlers/allHandlers.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["handlers loadable modules"],"duration":31,"failureMessages":[],"fullName":"handlers loadable modules can require handler module checkFullAccess","status":"passed","title":"can require handler module checkFullAccess"},{"ancestorTitles":["handlers loadable modules"],"duration":9,"failureMessages":[],"fullName":"handlers loadable modules can require handler module getBotToken","status":"passed","title":"can require handler module getBotToken"},{"ancestorTitles":["handlers loadable modules"],"duration":1133,"failureMessages":[],"fullName":"handlers loadable modules can require handler module getPhotoUrl","status":"passed","title":"can require handler module getPhotoUrl"},{"ancestorTitles":["handlers loadable modules"],"duration":2,"failureMessages":[],"fullName":"handlers loadable modules can require handler module getSubScribeChannel","status":"passed","title":"can require handler module getSubScribeChannel"},{"ancestorTitles":["handlers loadable modules"],"duration":2,"failureMessages":[],"fullName":"handlers loadable modules can require handler module getUserInfo","status":"passed","title":"can require handler module getUserInfo"},{"ancestorTitles":["handlers loadable modules"],"duration":69,"failureMessages":[],"fullName":"handlers loadable modules can require handler module handleMenu","status":"passed","title":"can require handler module handleMenu"},{"ancestorTitles":["handlers loadable modules"],"duration":924,"failureMessages":[],"fullName":"handlers loadable modules can require handler module hearsActions","status":"passed","title":"can require handler module hearsActions"},{"ancestorTitles":["handlers loadable modules"],"duration":286,"failureMessages":[],"fullName":"handlers loadable modules can require handler module index","status":"passed","title":"can require handler module index"},{"ancestorTitles":["handlers loadable modules"],"duration":36675,"failureMessages":[],"fullName":"handlers loadable modules can require handler module paymentActions","status":"passed","title":"can require handler module paymentActions"},{"ancestorTitles":["handlers loadable modules"],"duration":92,"failureMessages":[],"fullName":"handlers loadable modules can require handler module сallbackActions","status":"passed","title":"can require handler module сallbackActions"}]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/index.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/core/supabase/index.test.ts\u001b[0m:\u001b[93m11\u001b[0m:\u001b[93m47\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '() => void' is not assignable to parameter of type '(infoObject: object) => Logger'.\n      Type 'void' is not assignable to type 'Logger'.\n\n    \u001b[7m11\u001b[0m jest.spyOn(logger, 'warn').mockImplementation(() => {})\n    \u001b[7m  \u001b[0m \u001b[91m                                              ~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/index.test.ts\u001b[0m:\u001b[93m12\u001b[0m:\u001b[93m48\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '() => void' is not assignable to parameter of type '(infoObject: object) => Logger'.\n      Type 'void' is not assignable to type 'Logger'.\n\n    \u001b[7m12\u001b[0m jest.spyOn(logger, 'error').mockImplementation(() => {})\n    \u001b[7m  \u001b[0m \u001b[91m                                               ~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/index.test.ts\u001b[0m:\u001b[93m13\u001b[0m:\u001b[93m47\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '() => void' is not assignable to parameter of type '(infoObject: object) => Logger'.\n      Type 'void' is not assignable to type 'Logger'.\n\n    \u001b[7m13\u001b[0m jest.spyOn(logger, 'info').mockImplementation(() => {})\n    \u001b[7m  \u001b[0m \u001b[91m                                              ~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/index.test.ts\u001b[0m:\u001b[93m19\u001b[0m:\u001b[93m12\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'SUPABASE_URL' because it is a read-only property.\n\n    \u001b[7m19\u001b[0m     config.SUPABASE_URL = 'http://supabase.test'\n    \u001b[7m  \u001b[0m \u001b[91m           ~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/index.test.ts\u001b[0m:\u001b[93m20\u001b[0m:\u001b[93m12\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'SUPABASE_SERVICE_KEY' because it is a read-only property.\n\n    \u001b[7m20\u001b[0m     config.SUPABASE_SERVICE_KEY = 'service-key'\n    \u001b[7m  \u001b[0m \u001b[91m           ~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/index.test.ts\u001b[0m:\u001b[93m21\u001b[0m:\u001b[93m12\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'SUPABASE_SERVICE_ROLE_KEY' because it is a read-only property.\n\n    \u001b[7m21\u001b[0m     config.SUPABASE_SERVICE_ROLE_KEY = 'service-role'\n    \u001b[7m  \u001b[0m \u001b[91m           ~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/index.test.ts\u001b[0m:\u001b[93m22\u001b[0m:\u001b[93m12\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2540: \u001b[0mCannot assign to 'isSupabaseConfigured' because it is a read-only property.\n\n    \u001b[7m22\u001b[0m     config.isSupabaseConfigured = true\n    \u001b[7m  \u001b[0m \u001b[91m           ~~~~~~~~~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/imageToPromptWizard.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/scenes/imageToPromptWizard.test.ts\u001b[0m:\u001b[93m27\u001b[0m:\u001b[93m24\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2352: \u001b[0mConversion of type '(ctx: MyContext) => string' to type 'Mock<() => [string, string]>' may be a mistake because neither type sufficiently overlaps with the other. If this was intentional, convert the expression to 'unknown' first.\n      Type '(ctx: MyContext) => string' is missing the following properties from type 'Mock<() => [string, string]>': _isMockFunction, _protoImpl, getMockImplementation, getMockName, and 15 more.\n\n    \u001b[7m27\u001b[0m const mockedGetToken = getBotToken as jest.Mock<() => [string, string] | null>\n    \u001b[7m  \u001b[0m \u001b[91m                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/imageToPromptWizard.test.ts\u001b[0m:\u001b[93m118\u001b[0m:\u001b[93m42\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2353: \u001b[0mObject literal may only specify known properties, and 'message' does not exist in type 'Partial<MySession>'.\n\n    \u001b[7m118\u001b[0m     const msgCtx = makeMockContext({}, { message: { text: 'foo' } })\n    \u001b[7m   \u001b[0m \u001b[91m                                         ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/imageToPromptWizard.test.ts\u001b[0m:\u001b[93m119\u001b[0m:\u001b[93m60\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'true' is not assignable to parameter of type 'never'.\n\n    \u001b[7m119\u001b[0m     ;(handleHelpCancel as jest.Mock).mockResolvedValueOnce(true)\n    \u001b[7m   \u001b[0m \u001b[91m                                                           ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/imageToPromptWizard.test.ts\u001b[0m:\u001b[93m122\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m122\u001b[0m     await step1(msgCtx)\n    \u001b[7m   \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/imageToPromptWizard.test.ts\u001b[0m:\u001b[93m127\u001b[0m:\u001b[93m56\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'false' is not assignable to parameter of type 'never'.\n\n    \u001b[7m127\u001b[0m     ;(handleHelpCancel as jest.Mock).mockResolvedValue(false)\n    \u001b[7m   \u001b[0m \u001b[91m                                                       ~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/imageToPromptWizard.test.ts\u001b[0m:\u001b[93m128\u001b[0m:\u001b[93m55\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'string[]' is not assignable to parameter of type 'never'.\n\n    \u001b[7m128\u001b[0m     ;(getBotToken as jest.Mock).mockResolvedValueOnce(['tok', 'botName'])\n    \u001b[7m   \u001b[0m \u001b[91m                                                      ~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/imageToPromptWizard.test.ts\u001b[0m:\u001b[93m129\u001b[0m:\u001b[93m55\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type 'string[]' is not assignable to parameter of type 'never'.\n\n    \u001b[7m129\u001b[0m     ;(getBotToken as jest.Mock).mockResolvedValueOnce(['tok', 'botName'])\n    \u001b[7m   \u001b[0m \u001b[91m                                                      ~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/imageToPromptWizard.test.ts\u001b[0m:\u001b[93m131\u001b[0m:\u001b[93m7\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2353: \u001b[0mObject literal may only specify known properties, and 'message' does not exist in type 'Partial<MySession>'.\n\n    \u001b[7m131\u001b[0m       message: { photo: [{ file_id: 'fid1' }, { file_id: 'fid2' }] }\n    \u001b[7m   \u001b[0m \u001b[91m      ~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/imageToPromptWizard.test.ts\u001b[0m:\u001b[93m134\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2322: \u001b[0mType 'Mock<UnknownFunction>' is not assignable to type '(fileId: string | File) => Promise<URL>'.\n      Type '{}' is missing the following properties from type 'Promise<URL>': then, catch, finally, [Symbol.toStringTag]\n\n    \u001b[7m134\u001b[0m     ctx.telegram.getFileLink = jest.fn().mockResolvedValue({ href: 'http://file.jpg' })\n    \u001b[7m   \u001b[0m \u001b[91m    ~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/imageToPromptWizard.test.ts\u001b[0m:\u001b[93m134\u001b[0m:\u001b[93m60\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '{ href: string; }' is not assignable to parameter of type 'never'.\n\n    \u001b[7m134\u001b[0m     ctx.telegram.getFileLink = jest.fn().mockResolvedValue({ href: 'http://file.jpg' })\n    \u001b[7m   \u001b[0m \u001b[91m                                                           ~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/imageToPromptWizard.test.ts\u001b[0m:\u001b[93m137\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m137\u001b[0m     await step1(ctx)\n    \u001b[7m   \u001b[0m \u001b[91m          ~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/scenes/cancelPredictionsWizard.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/scenes/cancelPredictionsWizard.test.ts\u001b[0m:\u001b[93m33\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m33\u001b[0m     await step(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~\u001b[0m\n    \u001b[96m__tests__/scenes/cancelPredictionsWizard.test.ts\u001b[0m:\u001b[93m45\u001b[0m:\u001b[93m11\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Not all constituents of type 'Middleware<MyContext>' are callable.\n        Type 'MiddlewareObj<MyContext, Update>' has no call signatures.\n\n    \u001b[7m45\u001b[0m     await step(ctx)\n    \u001b[7m  \u001b[0m \u001b[91m          ~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":2,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1745172331643,"runtime":1494,"slow":false,"start":1745172330149},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/middlewares/handleSubscriptionMessage.test.ts","failureMessage":null,"testResults":[{"ancestorTitles":["handleSubscriptionMessage"],"duration":7,"failureMessages":[],"fullName":"handleSubscriptionMessage sends Russian subscription message with inline keyboard","status":"passed","title":"sends Russian subscription message with inline keyboard"},{"ancestorTitles":["handleSubscriptionMessage"],"duration":2,"failureMessages":[],"fullName":"handleSubscriptionMessage sends English subscription message with inline keyboard","status":"passed","title":"sends English subscription message with inline keyboard"}]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/sendPaymentInfo.unit.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/core/supabase/sendPaymentInfo.unit.test.ts\u001b[0m:\u001b[93m19\u001b[0m:\u001b[93m43\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2554: \u001b[0mExpected 1 arguments, but got 2.\n\n    \u001b[7m19\u001b[0m     await expect(sendPaymentInfo(user_id, level))\n    \u001b[7m  \u001b[0m \u001b[91m                                          ~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/sendPaymentInfo.unit.test.ts\u001b[0m:\u001b[93m27\u001b[0m:\u001b[93m43\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2554: \u001b[0mExpected 1 arguments, but got 2.\n\n    \u001b[7m27\u001b[0m     await expect(sendPaymentInfo(user_id, level))\n    \u001b[7m  \u001b[0m \u001b[91m                                          ~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/sendPaymentInfo.unit.test.ts\u001b[0m:\u001b[93m37\u001b[0m:\u001b[93m51\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2554: \u001b[0mExpected 1 arguments, but got 2.\n\n    \u001b[7m37\u001b[0m     const result = await sendPaymentInfo(user_id, level)\n    \u001b[7m  \u001b[0m \u001b[91m                                                  ~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/setPayments.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/core/supabase/setPayments.test.ts\u001b[0m:\u001b[93m32\u001b[0m:\u001b[93m30\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '{ telegram_id: string; OutSum: string; InvId: string; currency: \"USD\"; stars: number; status: \"COMPLETED\"; payment_method: \"Stripe\"; bot_name: string; language: string; }' is not assignable to parameter of type 'PaymentParams'.\n      Property 'subscription' is missing in type '{ telegram_id: string; OutSum: string; InvId: string; currency: \"USD\"; stars: number; status: \"COMPLETED\"; payment_method: \"Stripe\"; bot_name: string; language: string; }' but required in type 'PaymentParams'.\n\n    \u001b[7m32\u001b[0m     await expect(setPayments(paymentArgs)).resolves.toBeUndefined()\n    \u001b[7m  \u001b[0m \u001b[91m                             ~~~~~~~~~~~\u001b[0m\n\n      \u001b[96msrc/core/supabase/setPayments.ts\u001b[0m:\u001b[93m16\u001b[0m:\u001b[93m3\u001b[0m\n        \u001b[7m16\u001b[0m   subscription: string | null // <-- СНОВА ДОБАВЛЯЕМ ЭТО ПОЛЕ\n        \u001b[7m  \u001b[0m \u001b[96m  ~~~~~~~~~~~~\u001b[0m\n        'subscription' is declared here.\n    \u001b[96m__tests__/core/supabase/setPayments.test.ts\u001b[0m:\u001b[93m54\u001b[0m:\u001b[93m30\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2345: \u001b[0mArgument of type '{ telegram_id: string; OutSum: string; InvId: string; currency: \"USD\"; stars: number; status: \"COMPLETED\"; payment_method: \"Stripe\"; bot_name: string; language: string; }' is not assignable to parameter of type 'PaymentParams'.\n      Property 'subscription' is missing in type '{ telegram_id: string; OutSum: string; InvId: string; currency: \"USD\"; stars: number; status: \"COMPLETED\"; payment_method: \"Stripe\"; bot_name: string; language: string; }' but required in type 'PaymentParams'.\n\n    \u001b[7m54\u001b[0m     await expect(setPayments(paymentArgs)).rejects.toBe(err)\n    \u001b[7m  \u001b[0m \u001b[91m                             ~~~~~~~~~~~\u001b[0m\n\n      \u001b[96msrc/core/supabase/setPayments.ts\u001b[0m:\u001b[93m16\u001b[0m:\u001b[93m3\u001b[0m\n        \u001b[7m16\u001b[0m   subscription: string | null // <-- СНОВА ДОБАВЛЯЕМ ЭТО ПОЛЕ\n        \u001b[7m  \u001b[0m \u001b[96m  ~~~~~~~~~~~~\u001b[0m\n        'subscription' is declared here.\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/ai.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/core/supabase/ai.test.ts\u001b[0m:\u001b[93m4\u001b[0m:\u001b[93m10\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2305: \u001b[0mModule '\"@/core/supabase/ai\"' has no exported member 'ai'.\n\n    \u001b[7m4\u001b[0m import { ai } from '@/core/supabase/ai'\n    \u001b[7m \u001b[0m \u001b[91m         ~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/pinata/index.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/core/pinata/index.test.ts\u001b[0m:\u001b[93m34\u001b[0m:\u001b[93m5\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1005: \u001b[0m'}' expected.\n\n    \u001b[7m34\u001b[0m   })\n    \u001b[7m  \u001b[0m \u001b[91m    \u001b[0m\n\n      \u001b[96m__tests__/core/pinata/index.test.ts\u001b[0m:\u001b[93m14\u001b[0m:\u001b[93m37\u001b[0m\n        \u001b[7m14\u001b[0m describe('core/pinata index', () => {\n        \u001b[7m  \u001b[0m \u001b[96m                                    ~\u001b[0m\n        The parser expected to find a '}' to match the '{' token here.\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/supabase/getUserByTelegramId.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/core/supabase/getUserByTelegramId.test.ts\u001b[0m:\u001b[93m36\u001b[0m:\u001b[93m28\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2349: \u001b[0mThis expression is not callable.\n      Type '{ select: any; }' has no call signatures.\n\n    \u001b[7m36\u001b[0m       .mockReturnValueOnce({ select: mockSelect: () => ({ eq: mockEq }) })\n    \u001b[7m  \u001b[0m \u001b[91m                           ~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/getUserByTelegramId.test.ts\u001b[0m:\u001b[93m36\u001b[0m:\u001b[93m38\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2552: \u001b[0mCannot find name 'mockSelect'. Did you mean 'onselect'?\n\n    \u001b[7m36\u001b[0m       .mockReturnValueOnce({ select: mockSelect: () => ({ eq: mockEq }) })\n    \u001b[7m  \u001b[0m \u001b[91m                                     ~~~~~~~~~~\u001b[0m\n\n      \u001b[96mnode_modules/.pnpm/typescript@5.8.3/node_modules/typescript/lib/lib.dom.d.ts\u001b[0m:\u001b[93m29165\u001b[0m:\u001b[93m13\u001b[0m\n        \u001b[7m29165\u001b[0m declare var onselect: ((this: Window, ev: Event) => any) | null;\n        \u001b[7m     \u001b[0m \u001b[96m            ~~~~~~~~\u001b[0m\n        'onselect' is declared here.\n    \u001b[96m__tests__/core/supabase/getUserByTelegramId.test.ts\u001b[0m:\u001b[93m37\u001b[0m:\u001b[93m8\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'mockReturnValueOnce' does not exist on type 'void'.\n\n    \u001b[7m37\u001b[0m       .mockReturnValueOnce({ update: mockUpdate, eq: mockEq })\n    \u001b[7m  \u001b[0m \u001b[91m       ~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/getUserByTelegramId.test.ts\u001b[0m:\u001b[93m37\u001b[0m:\u001b[93m38\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2304: \u001b[0mCannot find name 'mockUpdate'.\n\n    \u001b[7m37\u001b[0m       .mockReturnValueOnce({ update: mockUpdate, eq: mockEq })\n    \u001b[7m  \u001b[0m \u001b[91m                                     ~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/getUserByTelegramId.test.ts\u001b[0m:\u001b[93m37\u001b[0m:\u001b[93m54\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2304: \u001b[0mCannot find name 'mockEq'.\n\n    \u001b[7m37\u001b[0m       .mockReturnValueOnce({ update: mockUpdate, eq: mockEq })\n    \u001b[7m  \u001b[0m \u001b[91m                                                     ~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/getUserByTelegramId.test.ts\u001b[0m:\u001b[93m39\u001b[0m:\u001b[93m49\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2304: \u001b[0mCannot find name 'mockEq'.\n\n    \u001b[7m39\u001b[0m     const sel = jest.fn().mockReturnValue({ eq: mockEq })\n    \u001b[7m  \u001b[0m \u001b[91m                                                ~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/getUserByTelegramId.test.ts\u001b[0m:\u001b[93m42\u001b[0m:\u001b[93m38\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2304: \u001b[0mCannot find name 'mockUpdate'.\n\n    \u001b[7m42\u001b[0m       .mockReturnValueOnce({ update: mockUpdate })\n    \u001b[7m  \u001b[0m \u001b[91m                                     ~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/getUserByTelegramId.test.ts\u001b[0m:\u001b[93m44\u001b[0m:\u001b[93m12\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2304: \u001b[0mCannot find name 'mockUpdate'.\n\n    \u001b[7m44\u001b[0m     expect(mockUpdate).toHaveBeenCalled()\n    \u001b[7m  \u001b[0m \u001b[91m           ~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/getUserByTelegramId.test.ts\u001b[0m:\u001b[93m45\u001b[0m:\u001b[93m28\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2304: \u001b[0mCannot find name 'userData'.\n\n    \u001b[7m45\u001b[0m     expect(result).toEqual(userData)\n    \u001b[7m  \u001b[0m \u001b[91m                           ~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/getUserByTelegramId.test.ts\u001b[0m:\u001b[93m36\u001b[0m:\u001b[93m48\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1005: \u001b[0m',' expected.\n\n    \u001b[7m36\u001b[0m       .mockReturnValueOnce({ select: mockSelect: () => ({ eq: mockEq }) })\n    \u001b[7m  \u001b[0m \u001b[91m                                               ~\u001b[0m\n    \u001b[96m__tests__/core/supabase/getUserByTelegramId.test.ts\u001b[0m:\u001b[93m36\u001b[0m:\u001b[93m50\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1136: \u001b[0mProperty assignment expected.\n\n    \u001b[7m36\u001b[0m       .mockReturnValueOnce({ select: mockSelect: () => ({ eq: mockEq }) })\n    \u001b[7m  \u001b[0m \u001b[91m                                                 ~\u001b[0m\n    \u001b[96m__tests__/core/supabase/getUserByTelegramId.test.ts\u001b[0m:\u001b[93m36\u001b[0m:\u001b[93m53\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1005: \u001b[0m',' expected.\n\n    \u001b[7m36\u001b[0m       .mockReturnValueOnce({ select: mockSelect: () => ({ eq: mockEq }) })\n    \u001b[7m  \u001b[0m \u001b[91m                                                    ~~\u001b[0m\n    \u001b[96m__tests__/core/supabase/getUserByTelegramId.test.ts\u001b[0m:\u001b[93m47\u001b[0m:\u001b[93m1\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1128: \u001b[0mDeclaration or statement expected.\n\n    \u001b[7m47\u001b[0m })\n    \u001b[7m  \u001b[0m \u001b[91m~\u001b[0m\n    \u001b[96m__tests__/core/supabase/getUserByTelegramId.test.ts\u001b[0m:\u001b[93m47\u001b[0m:\u001b[93m2\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS1128: \u001b[0mDeclaration or statement expected.\n\n    \u001b[7m47\u001b[0m })\n    \u001b[7m  \u001b[0m \u001b[91m ~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/core/axios/fetchWithAxios.test.ts","failureMessage":"  ● Test suite failed to run\n\n    \u001b[96m__tests__/core/axios/fetchWithAxios.test.ts\u001b[0m:\u001b[93m15\u001b[0m:\u001b[93m17\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'mockResolvedValueOnce' does not exist on type 'Mocked<AxiosStatic>'.\n\n    \u001b[7m15\u001b[0m     mockedAxios.mockResolvedValueOnce(fakeResponse as any)\n    \u001b[7m  \u001b[0m \u001b[91m                ~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n    \u001b[96m__tests__/core/axios/fetchWithAxios.test.ts\u001b[0m:\u001b[93m23\u001b[0m:\u001b[93m17\u001b[0m - \u001b[91merror\u001b[0m\u001b[90m TS2339: \u001b[0mProperty 'mockRejectedValueOnce' does not exist on type 'Mocked<AxiosStatic>'.\n\n    \u001b[7m23\u001b[0m     mockedAxios.mockRejectedValueOnce(error)\n    \u001b[7m  \u001b[0m \u001b[91m                ~~~~~~~~~~~~~~~~~~~~~\u001b[0m\n","testResults":[]},{"numFailingTests":0,"numPassingTests":0,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":0,"runtime":0,"slow":false,"start":0},"testFilePath":"/Users/playom/999-multibots-telegraf/__tests__/bot.test.ts","failureMessage":"  ● Test suite failed to run\n\n    TypeError: Cannot read properties of undefined (reading 'WizardScene')\n\n      14 | }\n      15 |\n    > 16 | export const avatarBrainWizard = new Scenes.WizardScene<MyContext>(\n         |                                             ^\n      17 |   'avatar_brain',\n      18 |   async ctx => {\n      19 |     const isRu = isRussian(ctx)\n\n      at Object.WizardScene (src/scenes/avatarBrainWizard/index.ts:16:45)\n      at Object.require (src/scenes/index.ts:1:1)\n      at Object.require (src/registerCommands.ts:11:1)\n      at Object.require (src/bot.ts:14:1)\n      at Object.<anonymous> (__tests__/bot.test.ts:2:1)\n","testResults":[]}],"config":{"bail":0,"changedFilesWithAncestor":false,"ci":false,"collectCoverage":true,"collectCoverageFrom":[],"coverageDirectory":"/Users/playom/999-multibots-telegraf/coverage","coverageProvider":"babel","coverageReporters":["json","text","lcov","clover"],"detectLeaks":false,"detectOpenHandles":false,"errorOnDeprecated":false,"expand":false,"findRelatedTests":false,"forceExit":false,"globalSetup":"/Users/playom/999-multibots-telegraf/jest.globalSetup.js","json":false,"lastCommit":false,"listTests":false,"logHeapUsage":false,"maxConcurrency":5,"maxWorkers":7,"noStackTrace":false,"nonFlagArgs":[],"notify":false,"notifyMode":"failure-change","onlyChanged":false,"onlyFailures":false,"openHandlesTimeout":1000,"passWithNoTests":false,"projects":[],"reporters":[["default",{}],["/Users/playom/999-multibots-telegraf/node_modules/.pnpm/jest-html-reporters@3.1.7/node_modules/jest-html-reporters/index.js",{"publicPath":"./html-report","filename":"report.html","expand":true}]],"rootDir":"/Users/playom/999-multibots-telegraf","runTestsByPath":false,"seed":-804882810,"silent":false,"skipFilter":false,"snapshotFormat":{"escapeString":false,"printBasicPrototype":false},"testFailureExitCode":1,"testPathPattern":"","testSequencer":"/Users/playom/999-multibots-telegraf/node_modules/.pnpm/@jest+test-sequencer@29.7.0/node_modules/@jest/test-sequencer/build/index.js","updateSnapshot":"new","useStderr":false,"verbose":true,"watch":false,"watchAll":false,"watchman":true,"workerThreads":false,"coverageLinkPath":"../coverage/lcov-report/index.html"},"endTime":1745172334177,"_reporterOptions":{"publicPath":"./html-report","filename":"report.html","expand":true,"pageTitle":"","hideIcon":false,"testCommand":"","openReport":false,"failureMessageOnly":0,"enableMergeData":false,"dataMergeLevel":1,"inlineSource":false,"urlForTestFiles":"","darkTheme":false,"includeConsoleLog":false,"stripSkippedTest":false},"logInfoMapping":{},"attachInfos":{}})