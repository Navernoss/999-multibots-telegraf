server {
    listen 80;
    listen 443 ssl;
    server_name _;

    ssl_certificate /etc/pki/cert.crt;
    ssl_certificate_key /etc/pki/key.pem;

    # Общие настройки для всех прокси
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection 'upgrade';
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_cache_bypass $http_upgrade;

    # Основной порт приложения
    location / {
        proxy_pass http://app:2999;
    }

    # Бот @neuro_blogger_bot
    location = /neuro_blogger_bot {
        proxy_pass http://app:3001/neuro_blogger_bot;
    }

    # Бот @MetaMuse_Manifest_bot
    location = /MetaMuse_Manifest_bot {
        proxy_pass http://app:3002/MetaMuse_Manifest_bot;
    }

    # Бот @ZavaraBot
    location = /ZavaraBot {
        proxy_pass http://app:3003/ZavaraBot;
    }

    # Бот @LeeSolarbot
    location = /LeeSolarbot {
        proxy_pass http://app:3004/LeeSolarbot;
    }

    # Бот @NeuroLenaAssistant_bot
    location = /NeuroLenaAssistant_bot {
        proxy_pass http://app:3005/NeuroLenaAssistant_bot;
    }

    # Бот @NeurostylistShtogrina_bot
    location = /NeurostylistShtogrina_bot {
        proxy_pass http://app:3006/NeurostylistShtogrina_bot;
    }

    # Бот @Gaia_Kamskaia_bot
    location = /Gaia_Kamskaia_bot {
        proxy_pass http://app:3007/Gaia_Kamskaia_bot;
    }

    # Вебхуки для ботов - основной маршрут для путей с параметрами
    location ~ ^/neuro_blogger_bot(.*)$ {
        proxy_pass http://app:3001$1;
    }

    location ~ ^/MetaMuse_Manifest_bot(.*)$ {
        proxy_pass http://app:3002$1;
    }

    location ~ ^/ZavaraBot(.*)$ {
        proxy_pass http://app:3003$1;
    }

    location ~ ^/LeeSolarbot(.*)$ {
        proxy_pass http://app:3004$1;
    }

    location ~ ^/NeuroLenaAssistant_bot(.*)$ {
        proxy_pass http://app:3005$1;
    }

    location ~ ^/NeurostylistShtogrina_bot(.*)$ {
        proxy_pass http://app:3006$1;
    }

    location ~ ^/Gaia_Kamskaia_bot(.*)$ {
        proxy_pass http://app:3007$1;
    }

    # Отдельные порты для каждого бота (запасной вариант для старых клиентов)
    location /neuro_blogger_bot/ {
        proxy_pass http://app:3001/neuro_blogger_bot/;
    }

    location /MetaMuse_Manifest_bot/ {
        proxy_pass http://app:3002/MetaMuse_Manifest_bot/;
    }

    location /ZavaraBot/ {
        proxy_pass http://app:3003/ZavaraBot/;
    }

    location /LeeSolarbot/ {
        proxy_pass http://app:3004/LeeSolarbot/;
    }

    location /NeuroLenaAssistant_bot/ {
        proxy_pass http://app:3005/NeuroLenaAssistant_bot/;
    }

    location /NeurostylistShtogrina_bot/ {
        proxy_pass http://app:3006/NeurostylistShtogrina_bot/;
    }

    location /Gaia_Kamskaia_bot/ {
        proxy_pass http://app:3007/Gaia_Kamskaia_bot/;
    }
} 